(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{494:function(s,t,a){"use strict";a.r(t);var n=a(24),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("strong",{staticClass:"old-blog"},[s._v("Babel-polyfill")])]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#babel-preset-env-babel-polyfill和-babel-plugin-transform-runtime"}},[s._v("@babel/preset-env, @babel/polyfill和@babel/plugin-transform-runtime")])]),a("li",[a("a",{attrs:{href:"#polyfill了解下"}},[s._v("polyfill了解下")])]),a("li",[a("a",{attrs:{href:"#babel7中-corejs-和-corejs2-的区别"}},[s._v("babel7中 corejs 和 corejs2 的区别")])])])]),a("p"),s._v(" "),a("h3",{attrs:{id:"babel-preset-env-babel-polyfill和-babel-plugin-transform-runtime"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#babel-preset-env-babel-polyfill和-babel-plugin-transform-runtime"}},[s._v("#")]),s._v(" @babel/preset-env, @babel/polyfill和@babel/plugin-transform-runtime")]),s._v(" "),a("p",[s._v("这可以说是babel官方的得意之作，最早的时候没有这个包，有的是babel-preset-es2015这样的包，后来每次新标准发布之后，就要新加一个包。"),a("br"),s._v("\nbabel顺应民意，发布了babel-preset-env这个包，它一次性囊括了已发布的所有标准包。"),a("br"),s._v("\n首先我们需要明确一下，preset-env的首要作用，不是帮我们把ES6+代码转成ES5.它的首要作用是认读ES6+代码。"),a("br"),s._v("\n在使用preset-env之前，babel是无法认识ES6+代码的，运行时会报Token错误。在使用preset-env之后，babel才能认识这些代码语法，并将它们抽象出AST树。"),a("br"),s._v("\npreset-env本身包含了一大堆plugin，并通过配置来控制插件，从而控制转码效果"),a("br")]),s._v(" "),a("p",[a("strong",[a("code",[s._v("@babel/preset-env")])])]),s._v(" "),a("p",[a("strong",[s._v("targets")]),s._v("\n控制目标浏览器的版本")]),s._v(" "),a("p",[a("strong",[s._v("modules")]),s._v("\n默认为commonjs，设置为false时，不会转码模块加载，import from 语法不会转码")]),s._v(" "),a("p",[a("strong",[s._v("useBuiltIns")]),s._v("\n是否自动加载polyfill。它有三个值可选：false（默认）, entry, usage。")]),s._v(" "),a("p",[a("strong",[s._v("corejs")]),s._v("\n承接useBuiltIns，当useBuiltIns值为entry或usage时，有效。它可以设置为：2，3，{ version:2, proposals:true }")]),s._v(" "),a("p",[a("strong",[a("code",[s._v("@babel/polyfill")])]),s._v("\n这个包是一个纯运行时的包，不是babel插件。它的作用是直接改写全局变量，从而让运行环境支持经过present-env转码后的代码")]),s._v(" "),a("p",[a("strong",[a("code",[s._v("@babel/plugin-transform-runtime")])])]),s._v(" "),a("ul",[a("li",[s._v("它有两个作用：\n"),a("ul",[a("li",[s._v("将preset-env所产生的helpers函数提出到一个独立文件中，从而减少代码量")]),s._v(" "),a("li",[s._v("建立运行时沙盒，避免全局污染")])])])]),s._v(" "),a("p",[a("strong",[s._v("corejs")])]),s._v(" "),a("p",[a("strong",[s._v("helpers")]),s._v("\n是否要将所有helper函数提炼到另外一个公共文件中。默认为true。")]),s._v(" "),a("p",[s._v("当使用@babel/plugin-trasnform-runtime之后，原本babel会直接在文件中创建一个helper函数，现在会采用require的方式，从@babel/runtime中引入这些函数，这样就可以减少代码量")]),s._v(" "),a("h3",{attrs:{id:"polyfill了解下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#polyfill了解下"}},[s._v("#")]),s._v(" polyfill了解下")]),s._v(" "),a("p",[s._v("babel 编译时只转换语法，几乎可以编译所有时新的 JavaScript 语法，但并不会转化BOM里面不兼容的API"),a("br"),s._v("\n比如 "),a("strong",[s._v("Promise,Set,Symbol,Array.from,Array.is,async")]),s._v(" 等等的一些API"),a("br"),s._v("\n这时候就需要 polyfill 来转转化这些API"),a("br"),s._v("\nbabel 转译语法需要一些plugin"),a("br"),s._v("\n如"),a("strong",[s._v("babel-preset-es2015,stage-0,stage-1")]),s._v("等等"),a("br"),s._v("\n其中的 es2015 表示 babel会加载 es6 相关的编译模块，然后 stage-0 表示的是什么呢？"),a("br"),s._v("\nstage 系列集合了一些对 es7 的草案支持的插件，由于是草案，所以作为插件的形式提供。"),a("br")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Strawman"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" just an idea"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" possible Babel plugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nstage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Proposal"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v(" is worth working on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nstage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Draft"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" initial spec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nstage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Candidate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" complete spec and initial browser implementations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nstage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Finished"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" will be added to the next yearly release"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("stage 是向下兼容  0>1>2>3>4 所包含的插件数量依次减少")]),s._v(" "),a("p",[s._v("polyfill 有三种：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime\nbabel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("transform"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("runtime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("推荐"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("默认依赖于babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbabel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("polyfill\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("在webpack中，"),a("strong",[s._v("babel-plugin-transform-runtime 实际上是依赖babel-runtime")]),s._v(" "),a("br"),s._v("\n因为babel编译es6到es5的过程中，babel-plugin-transform-runtime这个插件会自动polyfill es5不支持的特性，"),a("br"),s._v("\n这些polyfill包就是在babel-runtime这个包里 core-js 、regenerator等  polyfill。"),a("br"),s._v("\nbabel-runtime和 babel-plugin-transform-runtime的区别是，相当一前者是手动挡而后者是自动挡，每当要转译一个api时都要手动加上require('babel-runtime')，"),a("br"),s._v("\n而babel-plugin-transform-runtime会由工具自动添加，主要的功能是为api提供沙箱的垫片方案，不会污染全局的api，因此适合用在第三方的开发产品中。"),a("br")]),s._v(" "),a("h3",{attrs:{id:"babel7中-corejs-和-corejs2-的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#babel7中-corejs-和-corejs2-的区别"}},[s._v("#")]),s._v(" babel7中 corejs 和 corejs2 的区别")]),s._v(" "),a("p",[s._v("最近在给项目升级babel7，有一些改变但是变化不大,在升级中发现 babel7 变化挺大的，包括插件和包。\n其中一项功能特别赞，就是  @babel/preset-env  中的  useBuiltIns  选项，如果你设置了  usage ，babel 编绎的时候就不用整个 polyfills , 只加载你使用 polyfills，这样就可以减少包的大小。\n在使用 babel 中还想减少代码，就需要引入 babel 的运行时：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("yarn add @babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("transform"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),s._v("\nyarn add @babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("runtime\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("需要注意的是：")]),s._v(" "),a("ol",[a("li",[s._v("两个包引入的范围不一样：一个在开发时引入，一个在运行时引入。")]),s._v(" "),a("li",[s._v("plugin-transform-runtime 已经默认包括了 @babel/polyfill，因此不用在独立引入。")])]),s._v(" "),a("p",[s._v("在 plugin-transform-runtime 中有一个 corejs 很奇怪，可以设置成 false 或者 2。这是为什么这样？"),a("br"),s._v("\n大家知道 corejs 是一个给低版本的浏览器提供接口的库，如 Promise, map, set 等。"),a("br"),s._v("\n在 babel 中你设置成 false 或者不设置，就是引入的是 corejs 中的库，而且在全局中引入，也就是说侵入了全局的变量。可以观察以下的代码：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这是你写的代码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("ms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// babel 编绎成的代码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"core-js/modules/es6.promise"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这里可以看出是全局引入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("ms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("如果你的全局有一个引入，防止引入的库影响全局，那你就需要引把 corejs 设置成2。下面就是设真置成2，编绎成的代码：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _interopRequireDefault "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/runtime-corejs2/helpers/interopRequireDefault"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _promise "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_interopRequireDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/runtime-corejs2/core-js/promise"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 独立变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("ms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("_promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("可以从编绎出的代码看到，Promise 代码变成了一个独立的变量 _promise，不会影响全局的 Promise。"),a("br"),s._v("\n这样的好处是，引入的库者自己引入了一个变量，这样如果你引入的第三方库会对 Promise 进行一些自定义操作，这样就可以避免第三方库报错。"),a("br"),s._v("\n还要注意一点是： 如果你设置了 corejs2，那你就需要加入下面的库:")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("span",{staticStyle:{display:"block","text-align":"left"}},[s._v(" corejs选项")])]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[a("span",{staticStyle:{display:"block","text-align":"left"}},[s._v(" 安装命令")])]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[a("span",{staticStyle:{display:"block","text-align":"left"}},[s._v("里面包含的文件")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("false")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("yarn add @babel/runtime")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("helpers、regenerator")])]),s._v(" "),a("tr",[a("td",[a("strong",[s._v("2")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[s._v("yarn add  @babel/runtime-corejs2")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("core-js、helpers、regenerator")])]),s._v(" "),a("tr",[a("td",[s._v("3")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("yarn add  @babel/runtime-corejs3")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("还支持实例属性（例如[].includes)")])])])]),s._v(" "),a("p",[s._v("参考文档："),a("br"),s._v(" "),a("a",{attrs:{href:"https://babeljs.io/docs/en/babel-preset-env/",target:"_blank",rel:"noopener noreferrer"}},[s._v("babel-preset-env"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://babeljs.io/docs/en/babel-plugin-transform-runtime",target:"_blank",rel:"noopener noreferrer"}},[s._v("babel-plugin-transform-runtime"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("runtime转换器插件主要做了三件事：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("当你使用generators"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v("方法、函数时自动调用babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("regenerator\n当你使用"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ES6")]),s._v(" 的Map或者内置的东西时自动调用babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("js\n移除内联babel helpers并替换使用babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("helpers来替换\n\n\ntransform"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime优点\n    不会污染全局变量\n    多次使用只会打包一次\n    依赖统一按需引入"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("无重复引入"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("无多余引入\n\ntransform"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime缺点\n   不支持实例化的方法Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("includes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 就不能转化\n   如果使用的"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("API")]),s._v("用的次数不是很多，那么transform"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime 引入polyfill的包会比不是transform"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime时大\n\nbabel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("polyfill则是通过改写全局prototype的方式实现，比较适合单独运行的项目。\n    开启babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("polyfill的方式，可以直接在代码中require，或者在webpack的entry中添加，也可以在babel的env中设置useBuildins为"),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("来开启。\n    但是babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("polyfill会有近"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("K，\n    打包后代码冗余量比较大，\n    对于现代的浏览器"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("有些不需要polyfill，造成流量浪费\n    污染了全局对象\n\n@babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("runtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("corejs2包含三个文件夹：\n    core"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("js  引用core"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("js这个npm包\n    helpers  定义了一些处理新的语法关键字的帮助函数\n    regenerator  仅仅是引用regenerator"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runtime这个npm包\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);