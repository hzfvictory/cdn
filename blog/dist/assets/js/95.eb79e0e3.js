(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{464:function(s,t,a){"use strict";a.r(t);var e=a(24),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("strong",{staticClass:"old-blog"},[s._v("聊一聊前端换肤")])]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#前言"}},[s._v("前言")])]),a("li",[a("a",{attrs:{href:"#如何实现"}},[s._v("如何实现")])]),a("li",[a("a",{attrs:{href:"#对于可供选择的颜色-主题样式换肤的实现"}},[s._v("对于可供选择的颜色/主题样式换肤的实现")])]),a("li",[a("a",{attrs:{href:"#对于制定动态色值换肤的实现"}},[s._v("对于制定动态色值换肤的实现")]),a("ul",[a("li",[a("a",{attrs:{href:"#element-ui的换肤功-示例预览-https-elementui-github-io-theme-preview-zh-cn"}},[s._v("Element-UI的换肤功 示例预览")])]),a("li",[a("a",{attrs:{href:"#less的-modifyvars方法"}},[s._v("less的 modifyVars方法")])]),a("li",[a("a",{attrs:{href:"#css-变量方法"}},[s._v("css 变量方法")])])])]),a("li",[a("a",{attrs:{href:"#总结"}},[s._v("总结")])])])]),a("p"),s._v(" "),a("h3",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("最近在写公司的组件库，遇到的动态更换主题的需求，顺带研究一波。")]),s._v(" "),a("p",[s._v("一般来说换肤的需求分为两种：")]),s._v(" "),a("ol",[a("li",[s._v("一种是几种可供选择的颜色/主题样式，进行选择切换，这种可供选择的主题切换不会很多")]),s._v(" "),a("li",[s._v("另一种是需要自定义色值（动态更换），或者通过取色板取色，可供选择的范围就很大了")])]),s._v(" "),a("h3",{attrs:{id:"如何实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何实现"}},[s._v("#")]),s._v(" 如何实现")]),s._v(" "),a("h3",{attrs:{id:"对于可供选择的颜色-主题样式换肤的实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对于可供选择的颜色-主题样式换肤的实现"}},[s._v("#")]),s._v(" 对于可供选择的颜色/主题样式换肤的实现")]),s._v(" "),a("ul",[a("li",[s._v("一个全局class控制样式切换")])]),s._v(" "),a("p",[s._v("切换的时候js控制样式的切换")]),s._v(" "),a("ul",[a("li",[s._v("JS改变href属性值切换样式表，例如：")])]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("link id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"theme"')]),s._v(" href"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"iread-theme.css"')]),s._v(" rel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stylesheet"')]),s._v(" type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/css"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// js")]),s._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#theme'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("href "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'iread-update.css'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这种方式需要维护几个主题样式表，js点击切换的时候通过改变css样式表链接来实现。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("这种实现对于，颜色和主题多了的时候，维护起来就很麻烦，需要同时维护 n 个样式文件，并且使用JS改变href属性会带来加载延迟，样式切换不流畅，体验也不好。")]),s._v(" "),a("h3",{attrs:{id:"对于制定动态色值换肤的实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对于制定动态色值换肤的实现"}},[s._v("#")]),s._v(" 对于制定动态色值换肤的实现")]),s._v(" "),a("p",[s._v("如果是要实现动态换肤，自定义色值，那上面的几种方式就不适合了。")]),s._v(" "),a("p",[s._v("先看下已有的实现有哪些方法")]),s._v(" "),a("h4",{attrs:{id:"element-ui的换肤功-示例预览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#element-ui的换肤功-示例预览"}},[s._v("#")]),s._v(" Element-UI的换肤功 "),a("a",{attrs:{href:"https://elementui.github.io/theme-preview/#/zh-CN",target:"_blank",rel:"noopener noreferrer"}},[s._v("示例预览"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("实现原理： "),a("a",{attrs:{href:"https://github.com/ElemeFE/element/issues/3054",target:"_blank",rel:"noopener noreferrer"}},[s._v(" 官方解释"),a("OutboundLink")],1)]),s._v(" "),a("ol",[a("li",[s._v("先把默认主题文件中涉及到颜色的 CSS 值替换成关键词：https://github.com/ElementUI/theme-preview/blob/master/src/app.vue#L250-L274")]),s._v(" "),a("li",[s._v("根据用户选择的主题色生成一系列对应的颜色值：https://github.com/ElementUI/theme-preview/blob/master/src/utils/formula.json")]),s._v(" "),a("li",[s._v("把关键词再换回刚刚生成的相应的颜色值：https://github.com/ElementUI/theme-preview/blob/master/src/utils/color.js")]),s._v(" "),a("li",[s._v("直接在页面上加 "),a("code",[s._v("style")]),s._v(" 标签，把生成的样式填进去：https://github.com/ElementUI/theme-preview/blob/master/src/app.vue#L198-L211")])]),s._v(" "),a("p",[s._v("实现原理十分暴力😂，还是比较麻烦的，看看还有没有更优雅的方法来实现。")]),s._v(" "),a("p",[a("strong",[s._v("在实战中发现的问题（不是基于开发组件库）:")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("spa跳转页面"),a("strong",[s._v("新增")]),s._v("的css没有捕获，所以部分主题色就会失效")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("监听head引入style的个数，重新走下流程 效率低")])]),s._v(" "),a("li",[a("p",[s._v("直接编译所有的css样式 (按需加载和直接引入)线上/开发  建议")])])])]),s._v(" "),a("li",[a("p",[s._v("行内的样式不能编译")])])]),s._v(" "),a("p",[s._v("当我们在写ui库的时候只要修改自身的样式就行了，不要干扰开发者定义的样式（比如行内样式，UI库的开发肯定不会用行内的😄）")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("饿了么的采用的方式是，直接编译所有的index.css，导出的时候，把所有的"),a("strong",[s._v("组件css")]),s._v("都编译过来然后在让开发者按需引入。")]),s._v(" "),a("h4",{attrs:{id:"less的-modifyvars方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#less的-modifyvars方法"}},[s._v("#")]),s._v(" less的 modifyVars方法")]),s._v(" "),a("p",[s._v("蚂蚁antd、有赞vant团队的更换主题色功能是用 less 提供的 "),a("a",{attrs:{href:"http://lesscss.org/usage/#using-less-in-the-browser-modify-variables",target:"_blank",rel:"noopener noreferrer"}},[s._v("modifyVars"),a("OutboundLink")],1),s._v(" 的方式进行覆盖变量来实现。")]),s._v(" "),a("p",[s._v("原理  : "),a("strong",[s._v("modifyVars方法是是基于 "),a("code",[s._v("less")]),s._v(" 在浏览器中可以直接 "),a("code",[s._v("编译css 变量")]),s._v(" 的特性来实现。"),a("strong",[s._v("所以在引入lessjs文件的时候需要")]),s._v("通过link方式引入")]),s._v("，然后基于less.js中的方法来进行修改变量。")]),s._v(" "),a("p",[s._v("link方式引入主题色文件")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("link rel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stylesheet/less"')]),s._v(" type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/css"')]),s._v(" href"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./iread-theme.less"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n  *\n  * 它会找到所有如下的less 样式标签，使用已编译的css同步创建 style 标签。\n  * 也就是说我们必须把代码中所有的less 都以link的方式来引入(可以统一导入一个less里面)，这样less.js 才能在浏览器端实现编译。\n  * 注：使用less 来实现换肤要注意 less 文件在 html 中编写的位置（优先级），不然很可能被其他css 文件所干扰导致换肤失败\n  * */")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("更改主题色事件")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// color 传入颜色值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleColorChange")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("color")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    less"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("modifyVars")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 调用 `less.modifyVars` 方法来改变变量值'")]),s._v("\n       @themeColor"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("color\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'修改成功'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("可在webpack配置更改变量")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    test"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.less$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    loader"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'less-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    options"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 若 less-loader 版本小于 6.0，请移除 lessOptions 这一级，直接配置选项。")]),s._v("\n      lessOptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        javascriptEnabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          modifyVars"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 直接覆盖变量")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text-color'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#111'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'border-color'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#eee'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("less方法仅限于用less的项目才能使用，查了下Sass是没有类似 less.modifyVars 这种方法的；")]),s._v(" "),a("p",[s._v("Sass 的变量不是纯声明式的，⽽是类似 JavaScript 的变量, 后面的更新不会影响前面的")]),s._v(" "),a("p",[s._v("也就是一个变量在不同阶段值是不同的。而 Less 中生效的只有最后一次赋值，统一修改 Sass 变量作用范围不明，不能确保符合预期")]),s._v(" "),a("p",[s._v("需要在 Sass 中抽取可定制的全局变量，需要使用 "),a("code",[s._v("!default")]),s._v(" 声明变量，然后把用来覆盖的变量声明写在"),a("strong",[s._v("前面")]),s._v(",例如：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1goo89u8g8pj30ik06et9h.jpg",alt:""}})]),s._v(" "),a("h4",{attrs:{id:"css-变量方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css-变量方法"}},[s._v("#")]),s._v(" css 变量方法")]),s._v(" "),a("p",[s._v("如果项目里用的不是less, 那么还是用css的方法，通用且容易操作，使用"),a("strong",[s._v("css变量")]),s._v("来进行主题色的修改，替换主题色变量，然后用setProperty来进行动态修改")]),s._v(" "),a("p",[s._v("用法就是给变量加"),a("code",[s._v("--")]),s._v("前缀，涉及到主题色的都改成"),a("code",[s._v("var(--themeColor)")]),s._v("这种方式")]),s._v(" "),a("p",[s._v("用之前看下兼容性")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1goo8hf6vwpj31g20kjjx7.jpg",alt:""}})]),s._v(" "),a("p",[s._v("大部分主流浏览器还是支持的，而且主要是操作起来够简便。")]),s._v(" "),a("p",[s._v("用法举例：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1goo8dm8qrpj30q40aoab1.jpg",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("个人更加偏向于 "),a("code",[s._v("antd")]),s._v(" 或者基于 "),a("code",[s._v("css 自定义变量")]),s._v(" 的写法，不过 "),a("code",[s._v("antd")]),s._v(" 基于 "),a("code",[s._v("less")]),s._v(" 在浏览器中的编译，less 官方文档中也说到了:")]),s._v(" "),a("blockquote",[a("p",[s._v("This is because less is a large javascript file and compiling less before the user can see the page means a delay for the user. In addition, consider that mobile devices will compile slower.")])]),s._v(" "),a("p",[s._v("所以编译速度是一个要考虑的问题。然后是css 自定义变量要考虑的可能就是浏览器中的兼容性问题了，不过感觉 css 自定义变量的支持度还是挺友好了的🤣🤣。")])])}),[],!1,null,null,null);t.default=n.exports}}]);