<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React-SSR | hzfvictory&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="æ”¶è—å¤¹">
    
    <link rel="preload" href="/assets/css/0.styles.f753ec98.css" as="style"><link rel="preload" href="/assets/js/app.f10080ab.js" as="script"><link rel="preload" href="/assets/js/2.83a81645.js" as="script"><link rel="preload" href="/assets/js/45.1fa66b9e.js" as="script"><link rel="prefetch" href="/assets/js/10.90112c20.js"><link rel="prefetch" href="/assets/js/100.5f07b6bd.js"><link rel="prefetch" href="/assets/js/101.c2e0237f.js"><link rel="prefetch" href="/assets/js/102.6efb88b7.js"><link rel="prefetch" href="/assets/js/103.b02b378e.js"><link rel="prefetch" href="/assets/js/104.3698bf21.js"><link rel="prefetch" href="/assets/js/105.8eaebac7.js"><link rel="prefetch" href="/assets/js/106.54c0415e.js"><link rel="prefetch" href="/assets/js/107.77c4c134.js"><link rel="prefetch" href="/assets/js/108.e9af5a6b.js"><link rel="prefetch" href="/assets/js/109.9428d290.js"><link rel="prefetch" href="/assets/js/11.5c230c41.js"><link rel="prefetch" href="/assets/js/110.b689c855.js"><link rel="prefetch" href="/assets/js/111.1193dc7c.js"><link rel="prefetch" href="/assets/js/112.0642cc91.js"><link rel="prefetch" href="/assets/js/113.61f3e04b.js"><link rel="prefetch" href="/assets/js/114.c0d1b88f.js"><link rel="prefetch" href="/assets/js/115.cfdd91c4.js"><link rel="prefetch" href="/assets/js/116.64849d2e.js"><link rel="prefetch" href="/assets/js/117.147b5644.js"><link rel="prefetch" href="/assets/js/118.8bc0e737.js"><link rel="prefetch" href="/assets/js/119.8dc4b265.js"><link rel="prefetch" href="/assets/js/12.e53cfda4.js"><link rel="prefetch" href="/assets/js/120.f662cea1.js"><link rel="prefetch" href="/assets/js/121.69178958.js"><link rel="prefetch" href="/assets/js/122.6616ca3e.js"><link rel="prefetch" href="/assets/js/123.c194b54c.js"><link rel="prefetch" href="/assets/js/124.961a6901.js"><link rel="prefetch" href="/assets/js/125.69d955cb.js"><link rel="prefetch" href="/assets/js/126.4a891400.js"><link rel="prefetch" href="/assets/js/127.efd879f5.js"><link rel="prefetch" href="/assets/js/128.b105a474.js"><link rel="prefetch" href="/assets/js/129.41a27d47.js"><link rel="prefetch" href="/assets/js/13.7cbb3221.js"><link rel="prefetch" href="/assets/js/130.cacb7301.js"><link rel="prefetch" href="/assets/js/131.e85fea4e.js"><link rel="prefetch" href="/assets/js/14.18c7e73e.js"><link rel="prefetch" href="/assets/js/15.c35b9909.js"><link rel="prefetch" href="/assets/js/16.80523435.js"><link rel="prefetch" href="/assets/js/17.46f91e7d.js"><link rel="prefetch" href="/assets/js/18.151010e8.js"><link rel="prefetch" href="/assets/js/19.d21d87a1.js"><link rel="prefetch" href="/assets/js/20.7d40e53f.js"><link rel="prefetch" href="/assets/js/21.3cf003b1.js"><link rel="prefetch" href="/assets/js/22.4d0ff102.js"><link rel="prefetch" href="/assets/js/23.2603cfd5.js"><link rel="prefetch" href="/assets/js/24.bc6b9f88.js"><link rel="prefetch" href="/assets/js/25.8d7d0122.js"><link rel="prefetch" href="/assets/js/26.c0c21392.js"><link rel="prefetch" href="/assets/js/27.f2e47bc0.js"><link rel="prefetch" href="/assets/js/28.fb776ee0.js"><link rel="prefetch" href="/assets/js/29.71198e7a.js"><link rel="prefetch" href="/assets/js/3.d3e33842.js"><link rel="prefetch" href="/assets/js/30.d21bc92f.js"><link rel="prefetch" href="/assets/js/31.67d8fe32.js"><link rel="prefetch" href="/assets/js/32.ed977240.js"><link rel="prefetch" href="/assets/js/33.70cc5cef.js"><link rel="prefetch" href="/assets/js/34.3aa2e1f4.js"><link rel="prefetch" href="/assets/js/35.8f933c67.js"><link rel="prefetch" href="/assets/js/36.f4d93868.js"><link rel="prefetch" href="/assets/js/37.f8eac823.js"><link rel="prefetch" href="/assets/js/38.c994262d.js"><link rel="prefetch" href="/assets/js/39.0b23da0f.js"><link rel="prefetch" href="/assets/js/4.aa1ea233.js"><link rel="prefetch" href="/assets/js/40.bf08e649.js"><link rel="prefetch" href="/assets/js/41.86aaa330.js"><link rel="prefetch" href="/assets/js/42.495137fe.js"><link rel="prefetch" href="/assets/js/43.9df4e78a.js"><link rel="prefetch" href="/assets/js/44.94c4d907.js"><link rel="prefetch" href="/assets/js/46.0e5ebe2a.js"><link rel="prefetch" href="/assets/js/47.ebcc2133.js"><link rel="prefetch" href="/assets/js/48.f3bb60b0.js"><link rel="prefetch" href="/assets/js/49.4ad21caf.js"><link rel="prefetch" href="/assets/js/5.d89be445.js"><link rel="prefetch" href="/assets/js/50.382f9bcc.js"><link rel="prefetch" href="/assets/js/51.27dcd19c.js"><link rel="prefetch" href="/assets/js/52.ba56fba7.js"><link rel="prefetch" href="/assets/js/53.1638a486.js"><link rel="prefetch" href="/assets/js/54.cd39f301.js"><link rel="prefetch" href="/assets/js/55.d30feb22.js"><link rel="prefetch" href="/assets/js/56.a116a063.js"><link rel="prefetch" href="/assets/js/57.e1b4f4cc.js"><link rel="prefetch" href="/assets/js/58.73a8422e.js"><link rel="prefetch" href="/assets/js/59.8418b5ff.js"><link rel="prefetch" href="/assets/js/6.8bbaeac6.js"><link rel="prefetch" href="/assets/js/60.225baa07.js"><link rel="prefetch" href="/assets/js/61.d99f8e68.js"><link rel="prefetch" href="/assets/js/62.71b97d03.js"><link rel="prefetch" href="/assets/js/63.ea4891ba.js"><link rel="prefetch" href="/assets/js/64.377ad22c.js"><link rel="prefetch" href="/assets/js/65.5a7f7749.js"><link rel="prefetch" href="/assets/js/66.6b2e8582.js"><link rel="prefetch" href="/assets/js/67.456f41bc.js"><link rel="prefetch" href="/assets/js/68.904ef4ae.js"><link rel="prefetch" href="/assets/js/69.e96eaa87.js"><link rel="prefetch" href="/assets/js/7.3927d8dd.js"><link rel="prefetch" href="/assets/js/70.10618c5d.js"><link rel="prefetch" href="/assets/js/71.06764c83.js"><link rel="prefetch" href="/assets/js/72.1b2d076f.js"><link rel="prefetch" href="/assets/js/73.1324c9b4.js"><link rel="prefetch" href="/assets/js/74.595c0cdb.js"><link rel="prefetch" href="/assets/js/75.750898cc.js"><link rel="prefetch" href="/assets/js/76.5c6e3625.js"><link rel="prefetch" href="/assets/js/77.fbcabff9.js"><link rel="prefetch" href="/assets/js/78.76788032.js"><link rel="prefetch" href="/assets/js/79.8d03aa7a.js"><link rel="prefetch" href="/assets/js/8.c493f6ee.js"><link rel="prefetch" href="/assets/js/80.68c76d36.js"><link rel="prefetch" href="/assets/js/81.634a4838.js"><link rel="prefetch" href="/assets/js/82.9d4afec7.js"><link rel="prefetch" href="/assets/js/83.53e49368.js"><link rel="prefetch" href="/assets/js/84.b14074d9.js"><link rel="prefetch" href="/assets/js/85.fd4bb5dd.js"><link rel="prefetch" href="/assets/js/86.82a23e8d.js"><link rel="prefetch" href="/assets/js/87.87aa9085.js"><link rel="prefetch" href="/assets/js/88.9d713258.js"><link rel="prefetch" href="/assets/js/89.a6c5f81e.js"><link rel="prefetch" href="/assets/js/9.b9da6731.js"><link rel="prefetch" href="/assets/js/90.5615a9b5.js"><link rel="prefetch" href="/assets/js/91.775ce84a.js"><link rel="prefetch" href="/assets/js/92.92db5dea.js"><link rel="prefetch" href="/assets/js/93.d61d2f27.js"><link rel="prefetch" href="/assets/js/94.146cf784.js"><link rel="prefetch" href="/assets/js/95.2f7bfb14.js"><link rel="prefetch" href="/assets/js/96.e4024288.js"><link rel="prefetch" href="/assets/js/97.52c769de.js"><link rel="prefetch" href="/assets/js/98.494880a7.js"><link rel="prefetch" href="/assets/js/99.49563d9a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f753ec98.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">hzfvictory's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Useful" class="dropdown-title"><span class="title">Useful</span> <span class="arrow down"></span></button> <button type="button" aria-label="Useful" class="mobile-dropdown-title"><span class="title">Useful</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workspace/Frame/vue/vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/workspace/Frame/react/react.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/workspace/Frame/taro/taroBase.html" class="nav-link">
  Taro
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Service" class="dropdown-title"><span class="title">Service</span> <span class="arrow down"></span></button> <button type="button" aria-label="Service" class="mobile-dropdown-title"><span class="title">Service</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workspace/Server/node/node-1.html" class="nav-link">
  Koa2
</a></li></ul></div></div> <a href="https://github.com/hzfvictory/file" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Useful" class="dropdown-title"><span class="title">Useful</span> <span class="arrow down"></span></button> <button type="button" aria-label="Useful" class="mobile-dropdown-title"><span class="title">Useful</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workspace/Frame/vue/vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/workspace/Frame/react/react.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/workspace/Frame/taro/taroBase.html" class="nav-link">
  Taro
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Service" class="dropdown-title"><span class="title">Service</span> <span class="arrow down"></span></button> <button type="button" aria-label="Service" class="mobile-dropdown-title"><span class="title">Service</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workspace/Server/node/node-1.html" class="nav-link">
  Koa2
</a></li></ul></div></div> <a href="https://github.com/hzfvictory/file" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Base</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Project </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>FEæ¡†æ¶</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>â˜ vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>â˜ react</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/workspace/Frame/react/react.html" class="sidebar-link">ReactåŸºæœ¬ç”¨æ³•</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/react-hooks.html" class="sidebar-link">Hooks</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/immer.html" class="sidebar-link">Immer</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/react-router.html" class="sidebar-link">RouteråŸç†</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/react-redux.html" class="sidebar-link">Reduxæºç è§£æ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/dva.html" class="sidebar-link">Dvaå°è£…</a></li><li><a href="/workspace/Frame/react/event.html" class="sidebar-link">reactäº‹ä»¶å§”æ‰˜æœºåˆ¶</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/fiber.html" class="sidebar-link">React16 Fiber</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/dom_diff.html" class="sidebar-link">VirtualDOM</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/ssr.html" aria-current="page" class="active sidebar-link">React-SSR</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/workspace/Frame/react/problem.html" class="sidebar-link">é—®é¢˜éªŒè¯è§£æ</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>â˜ taro</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>â˜ react-native</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>â˜ å•å…ƒæµ‹è¯•</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Server</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Other</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><strong class="old-blog">React-SSR</strong></p> <p></p><div class="table-of-contents"><ul><li><a href="#å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“">å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“</a></li><li><a href="#ssrçš„å®ç°æœ¬è´¨">SSRçš„å®ç°æœ¬è´¨</a></li><li><a href="#æ–¹æ¡ˆç­›é€‰">æ–¹æ¡ˆç­›é€‰</a></li><li><a href="#koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„ssr">Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR</a><ul><li><a href="#ä¸ä½¿ç”¨koa-router">ä¸ä½¿ç”¨koa-router</a></li><li><a href="#ä½¿ç”¨koa-router">ä½¿ç”¨koa-router</a></li></ul></li><li><a href="#å®ç°reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“">å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“</a><ul><li><a href="#webpack-base">Webpack base</a></li><li><a href="#æœåŠ¡å™¨ç«¯-webpack-é…ç½®">æœåŠ¡å™¨ç«¯ Webpack é…ç½®</a></li></ul></li><li><a href="#åŒæ„">åŒæ„</a><ul><li><a href="#å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…js">å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS</a></li><li><a href="#å®¢æˆ·ç«¯-webpack-é…ç½®">å®¢æˆ·ç«¯ Webpack é…ç½®</a></li><li><a href="#æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘">æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘</a></li></ul></li><li><a href="#cssæ ·å¼é—®é¢˜å¤„ç†">CSSæ ·å¼é—®é¢˜å¤„ç†</a></li><li><a href="#ssrä¸­å¼‚æ­¥æ•°æ®çš„è·å–-dvaçš„ä½¿ç”¨">SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨</a><ul><li><a href="#dvaçš„ä½¿ç”¨">Dvaçš„ä½¿ç”¨</a></li><li><a href="#æ•°æ®è·å–">æ•°æ®è·å–</a></li><li><a href="#æ³¨æ°´å’Œè„±æ°´">æ³¨æ°´å’Œè„±æ°´</a></li><li><a href="#é…ç½®ä»£ç†">é…ç½®ä»£ç†</a></li></ul></li><li><a href="#å¼•å…¥react-helmet">å¼•å…¥react-helmet</a></li><li><a href="#è¯·æ±‚tokenå¤„ç†">è¯·æ±‚tokenå¤„ç†</a></li><li><a href="#_404é¡µé¢">404é¡µé¢</a></li><li><a href="#å®‰å…¨é—®é¢˜">å®‰å…¨é—®é¢˜</a></li><li><a href="#ä¼˜åŒ–">ä¼˜åŒ–</a></li><li><a href="#é‡åˆ°çš„é—®é¢˜æ±‡æ€»">é‡åˆ°çš„é—®é¢˜æ±‡æ€»</a></li><li><a href="#å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</a></li></ul></div><p></p> <hr> <p>å…ˆé™„ä¸Šgithubåœ°å€https://github.com/hzfvictory/react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚</p> <p>æ¬¢è¿å¤§å®¶ç‚¹star,æissueï¼Œä¸€èµ·è¿›æ­¥ï¼ğŸ˜„</p> <h3 id="å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“"><a href="#å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“" class="header-anchor">#</a> å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“</h3> <p><strong>CSR:</strong></p> <p>é¡µé¢æ¸²æŸ“æ˜¯JSè´Ÿè´£è¿›è¡Œçš„</p> <p>æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›HTMLâ€“&gt;æµè§ˆå™¨å‘é€bundle.jsè¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›bundle.jsâ€“&gt;æµè§ˆå™¨æ‰§è¡Œbundle.jsä¸­çš„reactä»£ç å®Œæˆæ¸²æŸ“</p> <p><strong>SSR:</strong></p> <p>æœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›HTMLè®©æµè§ˆå™¨ç›´æ¥æ¸²æŸ“</p> <p>æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿è¡ŒReactä»£ç ç”Ÿæˆé¡µé¢â€“&gt;æœåŠ¡å™¨è¿”å›é¡µé¢</p> <p><strong>ä¼ ç»ŸCSRçš„å¼Šç«¯:</strong></p> <ol><li><p>ç”±äºé¡µé¢æ˜¾ç¤ºè¿‡ç¨‹è¦è¿›è¡ŒJSæ–‡ä»¶æ‹‰å–å’ŒReactä»£ç æ‰§è¡Œï¼Œåœ¨è¿™ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­è‡³å°‘æ¶‰åŠåˆ°ä¸¤ä¸ª HTTPè¯·æ±‚å‘¨æœŸï¼ˆhtml+jsï¼‰ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€å®šçš„è€—æ—¶ï¼Œé¦–å±åŠ è½½æ—¶é—´ä¼šæ¯”è¾ƒæ…¢ã€‚</p></li> <li><p>å¯¹äºSEO(Search Engine Optimazition,å³æœç´¢å¼•æ“ä¼˜åŒ–)ï¼Œå®Œå…¨æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæœç´¢å¼•æ“çˆ¬è™«åªè®¤è¯†htmlç»“æ„çš„å†…å®¹ï¼Œè€Œä¸èƒ½è¯†åˆ«JSä»£ç å†…å®¹ã€‚</p></li></ol> <p><strong>SSRçš„å¼Šç«¯:</strong></p> <p>ssrçš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›ä¼ ç»ŸCSRçš„å¼Šç«¯</p> <p>åœ¨ React ä¸­ä½¿ç”¨ ssr æŠ€æœ¯ï¼Œæˆ‘ä»¬è®© React ä»£ç åœ¨æœåŠ¡å™¨ç«¯å…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œä½¿å¾—ç”¨æˆ·ä¸‹è½½çš„ HTML å·²ç»åŒ…å«äº†æ‰€æœ‰çš„é¡µé¢å±•ç¤ºå†…å®¹ï¼Œè¿™æ ·ï¼Œé¡µé¢å±•ç¤ºçš„è¿‡ç¨‹åªéœ€è¦ç»å†ä¸€ä¸ª HTTP è¯·æ±‚å‘¨æœŸï¼ŒTTFPï¼ˆTime To First Pageï¼‰ æ—¶é—´å¾—åˆ°ä¸€å€ä»¥ä¸Šçš„ç¼©å‡</p> <p>ä½†æ˜¯ä½¿ç”¨ ssr è¿™ç§æŠ€æœ¯ï¼Œå°†ä½¿åŸæœ¬ç®€å•çš„ React é¡¹ç›®å˜å¾—éå¸¸å¤æ‚</p> <ol><li><p>ç›¸å¯¹äºä»…ä»…éœ€è¦æä¾›é™æ€æ–‡ä»¶çš„æœåŠ¡å™¨ï¼Œssrä¸­ä½¿ç”¨çš„æ¸²æŸ“ç¨‹åºè‡ªç„¶ä¼šå ç”¨æ›´å¤šçš„CPUå’Œå†…å­˜èµ„æº</p></li> <li><p>åœ¨æœåŠ¡å™¨ç”Ÿæˆçš„é¡µé¢æ‰€ä»¥ï¼Œä¸€äº›å¸¸ç”¨çš„æµè§ˆå™¨APIå¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚windowã€docmentå’Œalertç­‰ï¼Œå¦‚æœä½¿ç”¨çš„è¯éœ€è¦å¯¹è¿è¡Œçš„ç¯å¢ƒåŠ ä»¥åˆ¤æ–­</p></li> <li><p>å¼€å‘è°ƒè¯•ä¼šæœ‰ä¸€äº›éº»çƒ¦ï¼Œå› ä¸ºæ¶‰åŠäº†æµè§ˆå™¨åŠæœåŠ¡å™¨ï¼Œå¯¹äºSPAçš„ä¸€äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ä¼šå˜å¾—å¤æ‚</p></li> <li><p>å¯èƒ½ä¼šç”±äºæŸäº›å› ç´ å¯¼è‡´æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ç»“æœä¸æµè§ˆå™¨ç«¯çš„ç»“æœä¸ä¸€è‡´ï¼Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¼šé™ä½ï¼Œä»£ç é—®é¢˜çš„è¿½æº¯ä¹Ÿä¼šå˜å¾—å›°éš¾</p></li></ol> <p>æ‰€ä»¥ï¼Œä½¿ç”¨ ssr åœ¨è§£å†³é—®é¢˜çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¸¦æ¥éå¸¸å¤šçš„å‰¯ä½œç”¨ï¼Œæœ‰çš„æ—¶å€™ï¼Œè¿™äº›å‰¯ä½œç”¨çš„ä¼¤å®³æ¯”èµ· ssr æŠ€æœ¯å¸¦æ¥çš„ä¼˜åŠ¿è¦å¤§çš„å¤šã€‚ä¸€èˆ¬å»ºè®®ssrï¼Œé™¤éä½ çš„é¡¹ç›®ç‰¹åˆ«ä¾èµ–æœç´¢å¼•æ“æµé‡ï¼Œæˆ–è€…å¯¹é¦–å±æ—¶é—´æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨ ssr,å¦‚æœåªå¯¹seoæœ‰è¦æ±‚å¯ä½¿ç”¨ <a href="https://github.com/prerender/prerender" target="_blank" rel="noopener noreferrer">prerenderé¢„æ¸²æŸ“<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <h3 id="ssrçš„å®ç°æœ¬è´¨"><a href="#ssrçš„å®ç°æœ¬è´¨" class="header-anchor">#</a> SSRçš„å®ç°æœ¬è´¨</h3> <p>è¿™é‡Œä»‹ç»çš„æ˜¯ssrï¼Œæ˜¯åŸºäºReact çš„SPAé¡¹ç›®ï¼Œä¸æ˜¯åƒ thinkphpã€jspã€nodeJs+ejs è¿™ç§çº¯åç«¯ç›´å‡ºæ¸²æŸ“æ–¹å¼ï¼Œæ‰€ä»¥è¿™ç§å¤§å¤šæ•°åªæ˜¯é’ˆå¯¹é¦–å±çš„ssr,å› ä¸ºæµè§ˆå™¨çš„è·¯ç”±è·³è½¬æ–¹å¼æ˜¯ç”¨çš„H5çš„<code>history API</code>çš„<code>window.history.pushState()</code> ï¼Œä½¿å¾—æˆ‘ä»¬å³å¯ä»¥ä¿®æ”¹ <code>url</code> ä¹Ÿå¯ä»¥ä¸åˆ·æ–°é¡µé¢ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šèµ°æœåŠ¡ç«¯çš„ã€å¯ä»¥é€šè¿‡é¢„åŠ è½½è·å–éœ€è¦çš„æ•°æ®ã€‘ã€‚</p> <p><strong>ssr ä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºè™šæ‹Ÿ DOM çš„å­˜åœ¨</strong></p> <p>ssr çš„å·¥ç¨‹ä¸­ï¼ŒReact ä»£ç ä¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å„æ‰§è¡Œä¸€æ¬¡,å› ä¸ºä»£ç åœ¨ Node ç¯å¢ƒä¸‹æ˜¯æ²¡æœ‰DOMè¿™ä¸ªæ¦‚å¿µçš„ï¼Œæ‰€ä»¥åœ¨React æ¡†æ¶ä¸­å¼•å…¥äº†ä¸€ä¸ªæ¦‚å¿µå«åšè™šæ‹Ÿ DOMï¼ŒReact åœ¨åšé¡µé¢æ“ä½œæ—¶ï¼Œå®é™…ä¸Šä¸æ˜¯ç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯æ“ä½œè™šæ‹Ÿ DOMï¼Œä¹Ÿå°±æ˜¯æ“ä½œæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œè¿™å°±ä½¿å¾— ssr æˆä¸ºäº†å¯èƒ½ã€‚åœ¨æœåŠ¡å™¨ï¼Œæˆ‘å¯ä»¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œåˆ¤æ–­ç¯å¢ƒæ˜¯æœåŠ¡å™¨ç¯å¢ƒï¼Œæˆ‘ä»¬æŠŠè™šæ‹Ÿ DOM æ˜ å°„æˆå­—ç¬¦ä¸²è¾“å‡ºï¼›åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œåˆ¤æ–­ç¯å¢ƒæ˜¯å®¢æˆ·ç«¯ç¯å¢ƒï¼Œæˆ‘å°±ç›´æ¥å°†è™šæ‹Ÿ DOM æ˜ å°„æˆçœŸå® DOMï¼Œå®Œæˆé¡µé¢æŒ‚è½½ã€‚</p> <h3 id="æ–¹æ¡ˆç­›é€‰"><a href="#æ–¹æ¡ˆç­›é€‰" class="header-anchor">#</a> æ–¹æ¡ˆç­›é€‰</h3> <ul><li><a href="/workspace/Frame/react/[https://nextjs.frontendx.cn/docs/#å®‰è£…](https://nextjs.frontendx.cn/docs/#å®‰è£…)">next.js</a>/<a href="https://www.nuxtjs.cn/guide/installation" target="_blank" rel="noopener noreferrer">nuxt.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>      æˆæœ¬ä½,å®‰å¿ƒçš„å†™é¡µé¢å°±è¡Œäº†ï¼Œæ— éœ€è¿‡å¤šå…³å¿ƒæœåŠ¡ç«¯è·¯ç”±ï¼ˆå¤šé¡µé¢åº”ç”¨ï¼Œæ–°æ¡†æ¶ï¼‰</li> <li><a href="https://github.com/hzfvictory/prerender" target="_blank" rel="noopener noreferrer">prerender <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>å®ç°spaé¡¹ç›®çš„æœåŠ¡ç«¯é¢„æ¸²æŸ“</li> <li>ä½¿ç”¨è°·æ­Œ <a href="https://github.com/hzfvictory/rendertron" target="_blank" rel="noopener noreferrer">rendertron<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å®ç°spaé¡¹ç›®çš„æœåŠ¡ç«¯æ¸²æŸ“ ã€æ®è¯´ä¼šè¢«åˆ¤ä½œå¼Šçš„ï¼Œé™æƒå¤„ç†ã€‘</li> <li>ç§‰æ‰¿å­¦ä¹ çš„æ€åº¦äº†è§£ä¸‹åŸºæœ¬åŸç†ï¼Œé€‰æ‹©äº†è‡ªå·±å»æ­ï¼Œï¼ˆä¸­é—´æ–­äº†ä¸€æ®µæ—¶é—´ï¼Œç°åœ¨åˆé‡æ–°æ‹¾èµ·æ¥ï¼‰ï¼Œä¹‹å‰çœ‹åˆ°æœ‰äººç”¨ react + redux + Express æ­ssrçš„æ–‡ç« ï¼Œæ‰€ä»¥åŸºäºå¯¹dvaå’Œkoaçš„ç†Ÿæ‚‰å’Œç‰¹åˆ«å–œå¥½ï¼Œå°±ç›´æ¥é€‰æ‹©äº†dva-core + koa åšçŠ¶æ€ç®¡ç†æ­å»ºã€‚</li></ul> <h3 id="koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„ssr"><a href="#koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„ssr" class="header-anchor">#</a> Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR</h3> <h4 id="ä¸ä½¿ç”¨koa-router"><a href="#ä¸ä½¿ç”¨koa-router" class="header-anchor">#</a> ä¸ä½¿ç”¨koa-router</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
     &lt;html&gt;
       &lt;head&gt;
         &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;
       &lt;/head&gt;
       &lt;body&gt;
         &lt;h1&gt;hello&lt;/h1&gt;
         &lt;h2&gt;world&lt;/h2&gt;
       &lt;/body&gt;
     &lt;/html&gt;
     </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'9999'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>port<span class="token punctuation">}</span> <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="ä½¿ç”¨koa-router"><a href="#ä½¿ç”¨koa-router" class="header-anchor">#</a> ä½¿ç”¨koa-router</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-router&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°</span>

route<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
   &lt;html&gt;
       &lt;head&gt;
         &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;
       &lt;/head&gt;
       &lt;body&gt;
         &lt;h1&gt;hello&lt;/h1&gt;
         &lt;h2&gt;world&lt;/h2&gt;
       &lt;/body&gt;
     &lt;/html&gt;
    </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è‡ªåŠ¨è®¾ç½®å“åº”å¤´ctx.statuså®Œå–„responseå“åº”å¤´</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'9999'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>port<span class="token punctuation">}</span> <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>è¿™æ ·ä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯æ¸²æŸ“å°±æå®šäº†ï¼ŒæœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›HTMLè®©æµè§ˆå™¨ç›´æ¥æ¸²æŸ“ï¼Œè€Œä¸”ç½‘é¡µæºä»£ç ä¸­æ˜¯æœ‰è¿™äº›domä¿¡æ¯çš„å¯¹seoéå¸¸å‹å¥½ï¼Œæˆ‘ä»¬reactã€vueè¿™äº›éƒ½æ˜¯é€šè¿‡webpackå¼•å…¥äº†js,æ‰€æœ‰çš„åŠŸèƒ½é¡µé¢å±•ç¤ºç»Ÿç»Ÿç”±jså®Œæˆã€‚</p> <h3 id="å®ç°reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“"><a href="#å®ç°reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“" class="header-anchor">#</a> å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“</h3> <p>åˆ°è¿™ä¸€æ­¥å·²ç»ä¸èƒ½ç›´æ¥ç”¨nodeå¯åŠ¨æœåŠ¡äº†ï¼Œå› ä¸ºæ²¡æœ‰<code>babel</code>ï¼Œ  Reactä¸ä¼šè½¬åŒ–æˆ<code>createElement</code>çš„å½¢å¼ï¼Œè€Œä¸”ä½¿ç”¨nodeä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨importå¯¼å…¥æ–¹å¼ã€‚</p> <p>éšä¾¿ç¼–å†™ä¸€ä¸ªReactçš„ç»„ä»¶</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/pages/home</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">Home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Homeç»„ä»¶<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç„¶åæˆ‘ä»¬æŠŠå½“å‰ç»„ä»¶ï¼Œä½¿ç”¨æœåŠ¡å‘˜æ¸²æŸ“å‡ºæ¥ï¼Œçœ‹ä¸‹é¢é…ç½®ï¼š</p> <h4 id="webpack-base"><a href="#webpack-base" class="header-anchor">#</a> Webpack base</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/webpack.base.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js|jsx$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-react'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          targets<span class="token operator">:</span> <span class="token punctuation">{</span>
            browsers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 2 versions'</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="æœåŠ¡å™¨ç«¯-webpack-é…ç½®"><a href="#æœåŠ¡å™¨ç«¯-webpack-é…ç½®" class="header-anchor">#</a> æœåŠ¡å™¨ç«¯ Webpack é…ç½®</h4> <p>æœåŠ¡ç«¯è¿è¡Œçš„ä»£ç å¦‚æœéœ€è¦ä¾èµ– Node æ ¸å¿ƒæ¨¡å—æˆ–è€…ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œ<code>å°±ä¸å†éœ€è¦æŠŠå®¢æˆ·ç«¯çš„ä¸€äº›æ¨¡å—ä»£ç æ‰“åŒ…åˆ°æœ€ç»ˆä»£ç ä¸­äº†</code>ã€‚å› ä¸ºç¯å¢ƒå·²ç»å®‰è£…è¿™äº›ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±éœ€è¦æˆ‘ä»¬åœ¨ webpack ä¸­é…ç½®ï¼š<code>targetï¼šnode</code>ï¼Œå¹¶å€ŸåŠ© webpack-node-externals æ’ä»¶ï¼Œè§£å†³ç¬¬ä¸‰æ–¹ä¾èµ–æ‰“åŒ…çš„é—®é¢˜ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/webpack.server.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> nodeExternals <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-node-externals'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> serverConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  target<span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token comment">// ç¼–è¯‘å‡ºèƒ½è®©nodeè¯†åˆ«çš„ä»£ç   https://webpack.docschina.org/concepts/targets/</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token comment">// è¿™é‡Œçš„modeè¦ç‰¹åˆ«æ³¨æ„</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/server/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// å¯¹åº”æœåŠ¡ç«¯çš„ä»£ç </span>
  <span class="token comment">// https://webpack.docschina.org/configuration/externals/</span>
  externals<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">nodeExternals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ä¸ºäº†å¿½ç•¥node_modulesæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ¨¡å—</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../bundle'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> serverConfig<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>target: 'node' å’Œ target: 'web' çš„å¤§è‡´åŒºåˆ«</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// target: 'node'</span>
exports<span class="token punctuation">.</span>ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// target: 'web' </span>
<span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// server/index.js</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">'koa'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&quot;koa-router&quot;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span> <span class="token comment">// å¿…é¡»å¼•å…¥</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>renderToString<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span> <span class="token comment">// react-domæä¾›çš„æ–¹æ³•</span>

<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">&quot;../src/pages/home&quot;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Home<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;div id=&quot;root&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;
    </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'9999'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>port<span class="token punctuation">}</span> <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>ä»¥ä¸Šä½¿ç”¨äº†<strong>renderToString</strong>, æˆ‘ä»¬éƒ½çŸ¥é“react-domæä¾›äº†å››ç§æœåŠ¡ç«¯æ¸²æŸ“å‡½æ•°,å¦‚ä¸‹:</p> <ol><li><strong>renderToString</strong>ï¼šå°† React Component è½¬åŒ–ä¸º HTML å­—ç¬¦ä¸²ï¼Œç”Ÿæˆçš„ HTML çš„ DOM ä¼šå¸¦æœ‰é¢å¤–å±æ€§ï¼šå„ä¸ª DOM ä¼šæœ‰data-react-idå±æ€§ï¼Œç¬¬ä¸€ä¸ª DOM ä¼šæœ‰data-reactrootå±æ€§ã€‚</li> <li><strong>renderToStaticMarkup</strong>ï¼šå°† React Component è½¬åŒ–ä¸º HTML å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”Ÿæˆ HTML çš„ DOM ä¸ä¼šæœ‰é¢å¤–å±æ€§ï¼Œä»è€ŒèŠ‚çœ HTML å­—ç¬¦ä¸²çš„å¤§å°ã€‚</li> <li><strong>renderToNodeStream:</strong> ä»¥æµçš„å½¢å¼è¾“å‡ºhtml, ä¸ç”¨åƒrenderToStringç”Ÿæˆæ•´ä¸ªhtmlæ‰å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç›¸å¯¹äºrenderToStringèƒ½æ›´å¿«çš„å“åº”å®¢æˆ·ç«¯ï¼Œæå‡é¡µé¢æ¸²æŸ“é€Ÿåº¦ã€‚</li> <li><strong>renderToStaticNodeStream</strong>ï¼šå’Œ renderToNodeStreamä¸€æ ·ï¼Œä¹Ÿæ˜¯è¾“å‡ºæµï¼Œä½†æ˜¯htmlä¸­ä¸å¸¦data-reactrootç­‰å±æ€§ã€‚</li></ol> <p><strong>å¯¹äºæœåŠ¡ç«¯æ¸²æŸ“è€Œè¨€</strong></p> <ul><li><strong>renderToString</strong>æ–¹æ³•æ¸²æŸ“çš„èŠ‚ç‚¹ä¼šå¸¦æœ‰data-react-idå±æ€§, åœ¨å‰ç«¯ react åŠ è½½å®Œæˆå, å‰ç«¯ react ä¼šè®¤è¯†ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹, ä¸ä¼šé‡æ–°æ¸²æŸ“ DOM èŠ‚ç‚¹, å‰ç«¯ react ä¼šæ¥ç®¡é¡µé¢, æ‰§è¡Œ <code>componentDidMout</code> ç»‘å®šæµè§ˆå™¨äº‹ä»¶ç­‰ è¿™äº›åœ¨æœåŠ¡ç«¯æ²¡å®Œæˆä¹Ÿä¸å¯èƒ½æ‰§è¡Œä»»åŠ¡ã€‚</li> <li><strong>renderToStaticMarkup</strong> æ¸²æŸ“å‡ºçš„æ˜¯ä¸å¸¦<code>data-react-id</code>çš„çº¯ html åœ¨å‰ç«¯ react åŠ è½½å®Œæˆå, ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„é¡µé¢ä¼šæŠ¹æ‰ä¹‹å‰æœåŠ¡ç«¯çš„é‡æ–°æ¸²æŸ“(å¯èƒ½é¡µé¢ä¼šé—ªä¸€ä¸‹). æ¢å¥è¯è¯´ <strong>å‰ç«¯reactå°±æ ¹æœ¬å°±ä¸è®¤è¯†ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹</strong>, render æ–¹æ³•ä¼šä½¿ç”¨ innerHTML çš„æ–¹æ³•é‡å†™ #react-target é‡Œçš„å†…å®¹</li></ul> <p>åœ¨packageæ·»åŠ å¯åŠ¨é…ç½®</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// package.json</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm-run-all --parallel dev:build:server dev:start&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dev:build:server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config config/webpack.server.js --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dev:start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon ./bundle/bundle.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ‰§è¡Œ  yarn dev ,æ‰“å¼€ <a href="">http://localhost:9999/ </a>é¡µé¢ç›´æ¥åœ¨æµè§ˆä¸Šæ˜¾ç¤ºï¼Œ åˆ°æ­¤ï¼Œå°±åˆæ­¥å®ç°äº†ä¸€ä¸ªReactç»„ä»¶æ˜¯æœåŠ¡ç«¯æ¸²æŸ“,åŠ å…¥ä½ åœ¨ç»„ä»¶Homeé‡Œé¢æ·»åŠ ä¸€äº›æ–¹æ³•æˆ–è€…è°ƒå–æ¥å£ï¼Œä½ ä¼šå‘ç°è¿™äº›éƒ½æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ¥ä¸‹æ¥è¿›ä¸€æ­¥å®Œå–„ã€‚</p> <h3 id="åŒæ„"><a href="#åŒæ„" class="header-anchor">#</a> åŒæ„</h3> <p>è¦è§£å†³ä¸Šé¢ä¸Šé¢çš„é—®é¢˜ï¼Œå°±éœ€è¦åŒæ„äº†ï¼Œæ‰€è°“åŒæ„ï¼Œé€šä¿—çš„è®²ï¼Œå°±æ˜¯ä¸€å¥—Reactä»£ç åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€éï¼Œåˆ°æµè§ˆå™¨æ¸²æŸ“æ—¶åœ¨è¿è¡Œä¸€éï¼ŒæœåŠ¡ç«¯æ¸²æŸ“å®Œæˆé¡µé¢ç»“æ„ï¼Œæµè§ˆå™¨ç«¯æ¸²æŸ“å®Œæˆäº‹ä»¶ç»‘å®šæ¥å£è°ƒå–ï¼ˆé‡å¤åŠ è½½çš„jsæˆ–è€…csså®¢æˆ·ç«¯åè°ƒé˜¶æ®µæ—¶å€™ä¼šè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸€æ ·åˆ™ä¸æ¸²æŸ“äº†ï¼‰ã€‚</p> <h4 id="å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…js"><a href="#å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…js" class="header-anchor">#</a> å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS</h4> <p>æŠŠæ‰“åŒ…åçš„js,æ³¨å…¥åˆ°htmlä¸­ï¼Œè¿™æ ·åˆ°æµè§ˆå™¨å°±ä¼šå†æ¬¡è¯·æ±‚ï¼Œå°±å¯ä»¥å®Œæˆäº‹ä»¶ç»‘å®šç­‰è¡Œä¸ºæ“ä½œã€‚</p> <p>æˆ‘ä»¬è¦ç”¨åˆ°react-domçš„<code>hydrate</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// client/index.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>BrowserRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span> Switch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>renderRoutes<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">'react-loadable'</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œæ˜¯æˆ‘çš„ä¸€ä¸ªè·¯ç”±æ‹†åˆ†ï¼Œä½ ä»¬å¯ä»¥ä¸ç”¨</span>

<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">'../router'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Router<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token function">renderRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>routes<span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Loadable<span class="token punctuation">.</span><span class="token function">preloadReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactDom<span class="token punctuation">.</span><span class="token function">hydrate</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>hydrate() æè¿°çš„æ˜¯ ReactDOM å¤ç”¨ ReactDOMServer æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹æ—¶å°½å¯èƒ½ä¿ç•™ç»“æ„ï¼Œå¹¶è¡¥å……äº‹ä»¶ç»‘å®šç­‰ Client ç‰¹æœ‰å†…å®¹çš„è¿‡ç¨‹</p> <p>è¯´ç™½äº†<code>render()</code> æ ‡ç­¾ä¸Šæ²¡æœ‰å”¯ä¸€çš„å±æ€§ï¼Œä½†æ˜¯è¦å°½å¯èƒ½å¤ç”¨ ssr çš„ HTML ç»“æ„,æ‰€ä»¥å°±å‡ºç°äº†<code>hydrate()</code>,ä½†æ˜¯ç›®å‰ä¸¤è€…éƒ½æ˜¯å¯ä»¥ç”¨çš„ï¼Œ17ç‰ˆæœ¬<code>render()</code>å°±ä¸åœ¨æ”¯æŒ<code>ssr</code></p> <p><a href="https://www.zhihu.com/question/66068748" target="_blank" rel="noopener noreferrer">çŸ¥ä¹å¯¹ ReactDom.hydrate çš„è§£é‡Š<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ç„¶åé…ç½®å®¢æˆ·ç«¯çš„webpackå°†å…¶ç¼–è¯‘æ‰“åŒ…æˆjsï¼Œåœ¨æœåŠ¡ç«¯htmlé‡Œé¢å¼•å…¥ã€‚</p> <h4 id="å®¢æˆ·ç«¯-webpack-é…ç½®"><a href="#å®¢æˆ·ç«¯-webpack-é…ç½®" class="header-anchor">#</a> å®¢æˆ·ç«¯ Webpack é…ç½®</h4> <p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ‰“åŒ…åçš„è¾“å‡ºç›®å½•</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/outputPath </span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">OUTPUTCLIENT</span><span class="token operator">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>
  <span class="token constant">OUTPUTSERVER</span><span class="token operator">:</span> <span class="token string">'bundle'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/webpack.client.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token constant">OUTPUTCLIENT</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./outputPath&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> outputPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">OUTPUTCLIENT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> clientConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../client/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'index.[chunkhash:8].js'</span><span class="token punctuation">,</span> <span class="token comment">// è¿™é‡Œæˆ‘ç”¨çš„hashï¼Œç›®çš„æ˜¯é˜²æ­¢ç¼“å­˜</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> outputPath<span class="token punctuation">)</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">// è¿™é‡Œå»ºè®®ä½¿ç”¨style-loaderï¼Œå°‘é‡çš„cssç›´æ¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“äº†</span>
          loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            modules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// è¿™è¦è·ŸæœåŠ¡ç«¯ä¿æŒä¸€è‡´ï¼Œä¸ç„¶headé‡Œé¢æœ‰æ ·å¼ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰å¯¹åº”çš„class</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpeg|jpg|gif|svg)?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          limit<span class="token operator">:</span> <span class="token number">8000</span><span class="token punctuation">,</span>
          outputPath<span class="token operator">:</span> outputPath<span class="token punctuation">,</span> <span class="token comment">// è¾“å…¥è·¯å¾„</span>
          publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> clientConfig<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>ç„¶ååœ¨ä¸Šé¢çš„<code>package.json</code>,é‡Œé¢æ·»åŠ <code>&quot;dev:build:client&quot;: &quot;webpack --config webpack.client.js --watch&quot;</code>ï¼Œå°±èƒ½å¯¹æµè§ˆå™¨ç”¨åˆ°çš„ä¸€äº›jså®Œæˆæ‰“åŒ…ã€‚</p> <h4 id="æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘"><a href="#æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘" class="header-anchor">#</a> æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘</h4> <p>æœåŠ¡å™¨ç«¯è·¯ç”±ä»£ç ç›¸å¯¹è¦å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦ä½ æŠŠ <code>location</code>ï¼ˆå½“å‰è¯·æ±‚è·¯å¾„ï¼‰ä¼ é€’ç»™ <code>StaticRouter</code> ç»„ä»¶ï¼Œè¿™æ · <code>StaticRouter</code> æ‰èƒ½æ ¹æ®è·¯å¾„åˆ†æå‡ºå½“å‰æ‰€éœ€è¦çš„ç»„ä»¶æ˜¯è°ã€‚ï¼ˆPSï¼š<code>StaticRouter</code> æ˜¯ <code>React-Router</code>é’ˆå¯¹æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸“é—¨æä¾›çš„ä¸€ä¸ªè·¯ç”±ç»„ä»¶ã€‚ï¼‰</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// server/index.js</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">'koa'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&quot;koa-router&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>renderToString<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>StaticRouter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">'react-loadable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">'@/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>renderRoutes<span class="token punctuation">,</span> matchRoutes<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-config&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>renderHTML<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./tem&quot;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

route<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;/:route?&quot;</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/([\w|\d]+)\/.*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>
    <span class="token comment">// é‡ç‚¹æ˜¯è¿™</span>
    <span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token punctuation">{</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token function">renderRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>routes<span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token function">renderHTML</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// è¿™é‡Œè¦æ³¨æ„ä¸‹ä¸­é—´ä»¶çš„å…ˆåé¡ºåº</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/static'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Loadable<span class="token punctuation">.</span><span class="token function">preloadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'9999'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>port<span class="token punctuation">}</span> <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\x1B[33m\x1B[4mhttp://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\x1B[0m</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// server/tem.js</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> project <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/static/index.*.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">let</span> path <span class="token operator">=</span> project<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">renderHTML</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;!DOCTYPE html&gt;
    &lt;html lang=&quot;zh&quot;&gt;
      &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no&quot; /&gt;
        &lt;meta name=&quot;theme-color&quot; content=&quot;#000000&quot;&gt;
        &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
      &lt;div id=&quot;root&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
      &lt;script src=/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">[</span>path<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;/script&gt; // è¿™ä¸ª '/' ä¸€å®šè¦æ·»åŠ ï¼Œå‘äº†å¥½ä¹…
      &lt;/body&gt;
  &lt;/html&gt;
</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="cssæ ·å¼é—®é¢˜å¤„ç†"><a href="#cssæ ·å¼é—®é¢˜å¤„ç†" class="header-anchor">#</a> CSSæ ·å¼é—®é¢˜å¤„ç†</h3> <p>æ­£å¸¸çš„æœåŠ¡ç«¯æ¸²æŸ“åªæ˜¯è¿”å›äº† HTML å­—ç¬¦ä¸²ï¼Œæ ·å¼éœ€è¦æµè§ˆå™¨åŠ è½½å®Œ CSS åæ‰ä¼šåŠ ä¸Šï¼Œè¿™ä¸ªæ ·å¼æ·»åŠ çš„è¿‡ç¨‹å°±<code>ä¼šé€ æˆé¡µé¢çš„é—ªåŠ¨</code>ï¼Œæ‰€ä»¥åœ¨æœåŠ¡ç«¯é‡Œé¢ç›´æ¥æ·»åŠ éœ€è¦å¼•ç”¨çš„CSSã€‚</p> <p>æˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨ style-loader äº†ï¼Œå› ä¸ºè¿™ä¸ª webpack loader ä¼šåœ¨ç¼–è¯‘æ—¶å°†æ ·å¼æ¨¡å—è½½å…¥åˆ° HTML header ä¸­ã€‚ä½†æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“ç¯å¢ƒä¸‹ï¼Œæ²¡æœ‰ window å¯¹è±¡ï¼Œstyle-loader è¿›è€Œä¼šæŠ¥é”™ã€‚ä¸€èˆ¬æˆ‘ä»¬æ¢ç”¨ <code>isomorphic-style-loader</code> ,åŒæ—¶ <code>isomorphic-style-loader</code>ä¹Ÿä¼šè§£å†³é¡µé¢æ ·å¼é—ªåŠ¨çš„é—®é¢˜ï¼Œå®ƒçš„åŸç†ä¹Ÿä¸éš¾ç†è§£ï¼š<code>isomorphic-style-loader</code>åˆ©ç”¨ context APIï¼Œåœ¨æ¸²æŸ“é¡µé¢ç»„ä»¶æ—¶è·å–æ‰€æœ‰ React ç»„ä»¶çš„æ ·å¼ä¿¡æ¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯è¾“å‡º html å­—ç¬¦ä¸²çš„åŒæ—¶ï¼Œä¹Ÿå°†æ ·å¼æ’å…¥åˆ° html å­—ç¬¦ä¸²å½“ä¸­ï¼Œå°†ç»“æœä¸€åŒä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚</p> <p>å› ä¸ºæˆ‘ä»¬å·²ç»å¼€å¯äº†cssmodulesï¼Œæ‰€ä»¥ç›´æ¥å¯¼å…¥åˆ°headé‡Œé¢æ˜¯ä¸ä¼šå­˜åœ¨æ ·å¼å†²çªçš„é—®é¢˜ã€‚<code>isomorphic-style-loader</code>å·²ç»ç»™æˆ‘ä»¬æä¾›äº†ä¸€äº›å¯¼å…¥css çš„ é«˜é˜¶å‡½æ•° <code>withsSyles</code></p> <p>å’Œ hooks <code>useStyles</code>ï¼Œç”¨çš„æ—¶å€™æ¯”è¾ƒçœäº‹ã€‚</p> <p><strong>çœ‹ä¸‹ä»£ç é…ç½®</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/webpack.client.js</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css|less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token comment">// ä¹Ÿå¯ä»¥è·ŸæœåŠ¡ç«¯çš„ä¸€æ ·ï¼Œå°±æ˜¯éº»çƒ¦ç‚¹ï¼Œæ¯æ¬¡ä½¿ç”¨css,éƒ½éœ€è¦é¢å¤–çš„æ‰‹ç»­</span>
      <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          modules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/webpack.server.js</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css|less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'isomorphic-style-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          modules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">'less-loader'</span>  <span class="token comment">// å¿…é¡»é…ç½® ä¸ç„¶ä¼šå½“æˆcss,è§†è§‰å¯èƒ½çœ‹ä¸å‡ºæ¥ï¼Œå› ä¸ºå®¢æˆ·ç«¯é…ç½®äº†less</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>æœåŠ¡ç«¯é¦–é¡µ</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// server/index.js </span>
<span class="token comment">//  ...</span>
<span class="token keyword">const</span> css <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿™ä¸ªå¿…é¡»åœ¨è·¯ç”±å‡½æ•°é‡Œé¢ï¼Œåœ¨å¤–é¢çš„è¯ï¼Œå°±ä¼šç´¯åŠ å‡ºç°ä¹‹å‰çš„css</span>
<span class="token keyword">const</span> <span class="token function-variable function">insertCss</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>styles</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> styles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">style</span> <span class="token operator">=&gt;</span> css<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span><span class="token function">_getCss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token punctuation">{</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>StyleContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>insertCss<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span> 
           <span class="token punctuation">{</span><span class="token function">renderRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>routes<span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>StyleContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
 
ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token function">renderHTML</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> css<span class="token punctuation">)</span>
<span class="token comment">// ....</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>å®¢æˆ·ç«¯ä¹Ÿéœ€è¦é…ç½®</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// client/index.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>BrowserRouter <span class="token keyword">as</span> Router<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>renderRoutes<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">'react-loadable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> StyleContext <span class="token keyword">from</span> <span class="token string">'isomorphic-style-loader/StyleContext'</span>


<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">'../router'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">insertCss</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>styles</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> removeCss <span class="token operator">=</span> styles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">style</span> <span class="token operator">=&gt;</span> style<span class="token punctuation">.</span>_insertCss <span class="token operator">&amp;&amp;</span> style<span class="token punctuation">.</span><span class="token function">_insertCss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> removeCss<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">dispose</span> <span class="token operator">=&gt;</span> dispose <span class="token operator">&amp;&amp;</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Router<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token function">renderRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>routes<span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Loadable<span class="token punctuation">.</span><span class="token function">preloadReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactDom<span class="token punctuation">.</span><span class="token function">hydrate</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>StyleContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>insertCss<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>StyleContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>è¿™æ ·æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨<code>isomorphic-style-loader</code>çš„ä¸€äº›API, <strong>æœ‰äº›<code>ä¸é‡è¦</code>çš„é¡µé¢ï¼Œæˆ–è€…ä¸é‡è¦çš„csså¯ä»¥ç›´æ¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</strong>,å°±ä¸éœ€è¦å¼•å…¥é«˜é˜¶å‡½æ•°æˆ–è€…useStylesã€‚</p> <p>åœ¨é¡µé¢å†…å…·ä½“ä½¿ç”¨</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å‡½æ•°å¼ç»„ä»¶</span>
<span class="token keyword">import</span> useStyles <span class="token keyword">from</span> <span class="token string">'isomorphic-style-loader/useStyles'</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&quot;./index.css&quot;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Index</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">useStyles</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span>
<span class="token punctuation">}</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ç±»ç»„ä»¶ä½¿ç”¨</span>
<span class="token keyword">import</span> withStyles <span class="token keyword">from</span> <span class="token string">'isomorphic-style-loader/withStyles'</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&quot;./index.css&quot;</span>
@<span class="token function">withStyles</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span> <span class="token comment">// éœ€è¦åœ¨baseé‡Œé¢é¢å¤–é…ç½®</span>

<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ä½¿ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&quot;./index.css&quot;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Index</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨useStyles éƒ¨åˆ†ä½¿ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">[</span><span class="token string">'title-center'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>message<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'title-center'</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>message<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ç„¶åæ‰“å¼€ç½‘é¡µçš„æºä»£ç å°±å¯ä»¥çœ‹è§headé‡Œé¢å·²ç»æœ‰æˆ‘ä»¬éœ€è¦çš„cssäº†ã€‚</p> <p><img src="https://user-gold-cdn.xitu.io/2020/7/23/1737b44ea25a4b63?w=1251&amp;h=881&amp;f=png&amp;s=177846" alt="image-20200702185101916"></p> <h3 id="ssrä¸­å¼‚æ­¥æ•°æ®çš„è·å–-dvaçš„ä½¿ç”¨"><a href="#ssrä¸­å¼‚æ­¥æ•°æ®çš„è·å–-dvaçš„ä½¿ç”¨" class="header-anchor">#</a> SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨</h3> <h4 id="dvaçš„ä½¿ç”¨"><a href="#dvaçš„ä½¿ç”¨" class="header-anchor">#</a> Dvaçš„ä½¿ç”¨</h4> <p>ä¹‹å‰é¡¹ç›®ä¸€ç›´ç”¨çš„dvaï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨çš„dva-coreä»£æ›¿çš„reduxï¼Œä¸ä¼šé…ç½®çš„è‡ªè¡ŒæŸ¥ä¸‹æ–‡æ¡£ã€‚</p> <p>åˆ›å»º <code>Store</code>ï¼šè¿™ä¸€éƒ¨åˆ†æœ‰å‘ï¼Œè¦æ³¨æ„é¿å…ï¼Œå¤§å®¶çŸ¥é“ï¼Œåœ¨å®¢æˆ·ç«¯æ¸²æŸ“ä¸­ï¼Œç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ°¸è¿œåªå­˜åœ¨ä¸€ä¸ª <code>Store</code>ï¼Œæ‰€ä»¥ä»£ç ä¸Šä½ å¯ä»¥è¿™ä¹ˆå†™</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> dvaApp <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  initialState<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  models<span class="token operator">:</span> models<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> dvaApp<span class="token punctuation">.</span><span class="token function">getStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ç„¶è€Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿™ä¹ˆå†™å°±æœ‰é—®é¢˜äº†ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯çš„ <code>Store</code> æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½è¦ç”¨çš„ï¼Œå¦‚æœåƒä¸Šé¢è¿™æ ·æ„å»º <code>Store</code>ï¼Œ<code>Store</code> å˜æˆäº†ä¸€ä¸ªå•ä¾‹ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº« <code>Store</code>ï¼Œæ˜¾ç„¶å°±æœ‰é—®é¢˜äº†ã€‚æ‰€ä»¥åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸­ï¼Œ<code>Store</code> çš„åˆ›å»ºåº”è¯¥iåƒä¸‹é¢è¿™æ ·ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ¯ä¸ªç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä¸ºæ¯ä¸ªç”¨æˆ·æä¾›ä¸€ä¸ªç‹¬ç«‹çš„ <code>Store</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> dvaApp <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  initialState<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  models<span class="token operator">:</span> models<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getStore</span> <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> dvaApp<span class="token punctuation">.</span><span class="token function">getStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>åˆ«æ…Œï¼Œä½ å¦‚æœè¿™æ ·çš„åšçš„è¯ï¼Œreduxçš„æ•°æ®è¿˜æ˜¯æ‰€æœ‰å®¢æˆ·åŒæ­¥å…¬ç”¨ï¼Œå› ä¸ºä½ çš„modelæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯é™æ€å¯¼å…¥ï¼Œè¿™ä¸ªæ—¶å€™ä½ åº”è¯¥æŠŠmodelå†™æˆå‡½æ•°çš„å½¢å¼ï¼Œè¿™æ ·åå°æ¯æ¬¡éƒ½èƒ½è·å–åˆ°æœ€æ–°çš„æ•°æ®</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">menuTree</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    namespace<span class="token operator">:</span> <span class="token string">'menuTree'</span><span class="token punctuation">,</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span>
      routes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    effects<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token operator">*</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">{</span>call<span class="token punctuation">,</span> put<span class="token punctuation">,</span> select<span class="token punctuation">,</span> update<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// .........</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span>payload<span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> menuTree
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>æ¢æˆå‡½æ•°çš„å¯¼å‡ºå½¢å¼å°±OKäº†ï¼Œç„¶ååœ¨createAppçš„æ–¹æ³•ï¼ŒåŸæœ‰çš„<code>models.forEach(model =&gt; app.model(model);</code>è½¬æ¢æˆ <code>models.forEach(model =&gt; app.model(model()));</code> å°±OKäº†ã€‚</p> <h4 id="æ•°æ®è·å–"><a href="#æ•°æ®è·å–" class="header-anchor">#</a> æ•°æ®è·å–</h4> <p>æ•°æ®è·å–çš„è§£å†³æ–¹æ¡ˆæ˜¯é…ç½®è·¯ç”± route-router-configï¼Œç»“åˆ <code>matchRoutes</code>ï¼Œæ‰¾åˆ°é¡µé¢ä¸Šç›¸å…³ç»„ä»¶æ‰€éœ€çš„è¯·æ±‚æ¥å£çš„æ–¹æ³•å¹¶æ‰§è¡Œè¯·æ±‚ï¼Œè¿™å°±è¦æ±‚å¼€å‘è€…é€šè¿‡è·¯ç”±é…ç½®ä¿¡æ¯ï¼Œæ˜¾å¼åœ°å‘ŠçŸ¥æœåŠ¡ç«¯è¯·æ±‚å†…å®¹ã€‚</p> <p><strong>å®¢æˆ·ç«¯è·¯ç”±æ”¹é€ </strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// router/index.js</span>
<span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
  exact<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> Login<span class="token punctuation">,</span>
  loadData<span class="token operator">:</span> Login<span class="token punctuation">.</span>loadData<span class="token punctuation">,</span> <span class="token comment">// è¿™é‡Œå°±æ˜¯è¯·æ±‚æ•°æ®çš„æ–¹æ³•</span>
  title<span class="token operator">:</span> <span class="token string">'ç™»å½•é¡µ'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Index<span class="token punctuation">.</span><span class="token function-variable function">loadData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;menuTree/reset&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æˆ‘è¯•è¯•è¿™ä¸ªåˆ°åº•åŠ è½½ä¸'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Index
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>æœåŠ¡ç«¯ä»£ç </strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// server/index.js</span>

<span class="token comment">// è·å–è¯·æ±‚çš„æ–¹æ³•</span>
<span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

matchedRoutes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>route<span class="token punctuation">.</span>loadData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è¿™é‡Œç”¨äº†.then æ‰€ä»¥ç»„ä»¶é‡Œé¢å¿…é¡»ä½¿ç”¨asyncæˆ–è€…promise</span>
      item<span class="token punctuation">.</span>route<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜ï¼Œä½ çš„æ–¹æ³•å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¼šå‡ºç° ctx.body æ²¡æœ‰æ‰§è¡Œçš„é—®é¢˜ï¼Œæ‰€ä»¥è¦æŠŠè¿™ä¸ªä¸­é—´ä»¶è®¾ç½®ä¸ºå¼‚æ­¥çš„</span>

<span class="token comment">// ä¸ºäº†ç¡®ä¿ç»„ä»¶çš„loadDataçš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•</span>
<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> css <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é˜²æ­¢é’©å­å‡½æ•°æ‰§è¡Œä¸¤æ¬¡</span>
  <span class="token keyword">const</span> <span class="token function-variable function">insertCss</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>styles</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> styles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">style</span> <span class="token operator">=&gt;</span> css<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span><span class="token function">_getCss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> helmet <span class="token operator">=</span> Helmet<span class="token punctuation">.</span><span class="token function">renderStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token punctuation">{</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>StyleContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>insertCss<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token function">renderRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>routes<span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>StyleContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
     <span class="token punctuation">)</span>
     ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token function">renderHTML</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> store<span class="token punctuation">,</span> css<span class="token punctuation">,</span> helmet<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="æ³¨æ°´å’Œè„±æ°´"><a href="#æ³¨æ°´å’Œè„±æ°´" class="header-anchor">#</a> æ³¨æ°´å’Œè„±æ°´</h4> <p><strong>æ¶‰åŠåˆ°æ•°æ®çš„é¢„è·å–ï¼Œä¹Ÿæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„çœŸæ­£æ„ä¹‰ã€‚</strong></p> <p>ä¸Šé¢çš„ä»£ç æ­£å¸¸è¿è¡Œæ˜¯æ²¡é—®é¢˜äº†ï¼Œä½†æ˜¯å‘ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„storeï¼Œå­˜åœ¨ä¸åŒæ­¥çš„é—®é¢˜ã€‚</p> <p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å½“æœåŠ¡ç«¯æ‹¿åˆ°storeå¹¶è·å–æ•°æ®åï¼Œå®¢æˆ·ç«¯çš„jsä»£ç åˆæ‰§è¡Œä¸€éï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç æ‰§è¡Œçš„æ—¶å€™åˆåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„storeï¼Œä¸¤ä¸ªstoreçš„æ•°æ®ä¸èƒ½åŒæ­¥ã€‚</p> <p>æ‰€ä»¥ åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ï¼Œé¦–å…ˆæœåŠ¡ç«¯è¯·æ±‚æ¥å£æ‹¿åˆ°æ•°æ®ï¼Œå¹¶å¤„ç†å‡†å¤‡å¥½æ•°æ®çŠ¶æ€ï¼ˆå¦‚æœä½¿ç”¨ Reduxï¼Œå°±æ˜¯è¿›è¡Œ store çš„æ›´æ–°ï¼‰ï¼Œä¸ºäº†å‡å°‘å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™ä½è¿™ä¸ªçŠ¶æ€ã€‚ä¸€èˆ¬åšæ³•æ˜¯åœ¨æœåŠ¡å™¨ç«¯è¿”å› HTML å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå°†æ•°æ® JSON.stringify ä¸€å¹¶è¿”å›ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå«åšæ³¨æ°´ï¼›åœ¨å®¢æˆ·ç«¯ï¼Œå°±ä¸å†éœ€è¦è¿›è¡Œæ•°æ®çš„è¯·æ±‚äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœåŠ¡ç«¯ä¸‹å‘ä¸‹æ¥çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«è„±æ°´ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
   window<span class="token punctuation">.</span>context <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token comment">// è¿™é‡Œæ˜¯æ³¨æ°´</span>
   state<span class="token operator">:</span> $<span class="token punctuation">{</span><span class="token function">serialize</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token comment">// serialize æ˜¯ä¸ºäº†é˜²æ­¢xssçš„æ”»å‡»</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>create<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva-core'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// .....</span>
  <span class="token keyword">return</span> app<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æœåŠ¡ç«¯çš„redux</span>
<span class="token keyword">const</span> dvaApp <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  initialState<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  models<span class="token operator">:</span> models<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> dvaApp<span class="token punctuation">.</span><span class="token function">getStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å®¢æˆ·ç«¯çš„redux</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getClientStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// éœ€è¦å…ˆæ‹¿åˆ°æœåŠ¡ç«¯çš„æ•°æ®, è„±æ°´</span>
  <span class="token keyword">const</span> initialState <span class="token operator">=</span> window<span class="token punctuation">.</span>context <span class="token operator">?</span> window<span class="token punctuation">.</span>context<span class="token punctuation">.</span>state <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> dvaClientApp <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    initialState<span class="token punctuation">,</span>
    models<span class="token operator">:</span> models<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> dvaClientApp<span class="token punctuation">.</span><span class="token function">getStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="é…ç½®ä»£ç†"><a href="#é…ç½®ä»£ç†" class="header-anchor">#</a> é…ç½®ä»£ç†</h4> <p>æœåŠ¡ç«¯æ˜¯æ²¡æœ‰åŸŸçš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨å®¢æˆ·ç«¯è°ƒå–æ¥å£è¿˜å­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œæ‰€ä»¥è¿˜éœ€è¦é…ç½®ä¸‹ä»£ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> httpProxy <span class="token keyword">from</span> <span class="token string">'http-proxy-middleware'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> k2c <span class="token keyword">from</span> <span class="token string">&quot;koa2-connect&quot;</span>

<span class="token comment">// è½¬å‘ä»£ç†</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//åŒ¹é…æœ‰apiå­—æ®µçš„è¯·æ±‚url</span>
    ctx<span class="token punctuation">.</span>respond <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// ç»•è¿‡koaå†…ç½®å¯¹è±¡response ï¼Œå†™å…¥åŸå§‹reså¯¹è±¡ï¼Œè€Œä¸æ˜¯koaå¤„ç†è¿‡çš„response</span>
    <span class="token keyword">await</span> <span class="token function">k2c</span><span class="token punctuation">(</span><span class="token function">httpProxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">'https://api.xxxxx.xxx'</span><span class="token punctuation">,</span>
        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'^/api'</span><span class="token operator">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>è¿˜å¯ä»¥å®‰è£…koaçš„ä»£ç†æ¨¡å— <code>koa2-proxy-middleware</code>,ç”¨æ³•å¦‚ä¸‹ï¼š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa2-proxy-middleware'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  targets<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'/user'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// this is option of http-proxy-middleware</span>
      target<span class="token operator">:</span> <span class="token string">'http://localhost:3001'</span><span class="token punctuation">,</span> <span class="token comment">// target host</span>
      changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// needed for virtual hosted sites</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'/user/:id'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">'http://localhost:3001'</span><span class="token punctuation">,</span>
      changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'/api/*'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">'http://localhost:3001'</span><span class="token punctuation">,</span>
      changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'/passager/xx'</span><span class="token operator">:</span> <span class="token string">'/mPassenger/ee'</span><span class="token punctuation">,</span> <span class="token comment">// rewrite path</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">proxy</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>æºç ä¹Ÿæ²¡å‡ è¡Œï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹  <a href="https://github.com/sunyongjian/koa2-proxy-middleware/blob/master/lib/index.js" target="_blank" rel="noopener noreferrer">koa2-proxy-middleware<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="å¼•å…¥react-helmet"><a href="#å¼•å…¥react-helmet" class="header-anchor">#</a> å¼•å…¥react-helmet</h3> <p>åšæ›´å®Œæ•´çš„SEO</p> <p>App ç»„ä»¶åµŒå…¥åˆ° <code>document.getElementById('root')</code> èŠ‚ç‚¹å½“ä¸­ï¼Œä¸€èˆ¬æ˜¯ä¸åŒ…å« head æ ‡ç­¾çš„ï¼Œä½†æ˜¯å•é¡µåº”ç”¨åœ¨åˆ‡æ¢è·¯ç”±æ—¶ï¼Œå¯èƒ½ä¹Ÿä¼šéœ€è¦åŠ¨æ€ä¿®æ”¹ head æ ‡ç­¾ä¿¡æ¯ï¼Œæ¯”å¦‚ title å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šåœ¨å•é¡µé¢åº”ç”¨åˆ‡æ¢é¡µé¢ï¼Œä¸ä¼šç»è¿‡æœåŠ¡ç«¯æ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦æ›´æ”¹ document çš„ title å†…å®¹ã€‚</p> <p>å¦‚æœç›´æ¥æ”¹å®¢æˆ·ç«¯çš„title,ç›´æ¥å°±å¯ä»¥ä½¿ç”¨<code>document.title</code>,ä½†æ˜¯æˆ‘ä»¬ç°åœ¨è¦æŠŠSEOåšå¥½ï¼Œç„¶åæˆ‘ä»¬è¦æ›´æ”¹æœåŠ¡ç«¯headé‡Œé¢çš„meta titleç­‰å†…å®¹,è¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°  <a href="https://github.com/nfl/react-helmet" target="_blank" rel="noopener noreferrer">react-helmet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <p>å…·ä½“ä»£ç éå¸¸ç®€å•</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å®¢æˆ·ç«¯å®ç°æ–¹å¼</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>Component<span class="token punctuation">,</span> Fragment<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Helmet<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-helmet&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Fragment<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Helmet<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>è¿™æ˜¯loginé¡µ<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;description&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;è¿™é‡Œæ˜¯ç¦¾å£å’Œreact-ssrçš„è°ƒç ”&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Helmet<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Fragment<span class="token operator">&gt;</span>
     <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// æœåŠ¡ç«¯å®ç°</span>
<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">'koa'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&quot;koa-router&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>renderToString<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>StaticRouter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Helmet<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-helmet'</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œå¼•å…¥</span>
<span class="token comment">// ....</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

route<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;/:route?&quot;</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/([\w|\d]+)\/.*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ....</span>
  <span class="token keyword">const</span> helmet <span class="token operator">=</span> Helmet<span class="token punctuation">.</span><span class="token function">renderStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œè·å–ä¸‹å½“å‰çš„headä¿¡æ¯</span>

  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token punctuation">{</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>StyleContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>insertCss<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token function">renderRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>routes<span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>StyleContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
  
  
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;!DOCTYPE html&gt;
      &lt;html lang=&quot;zh-Hans-CN&quot;&gt;
        &lt;head&gt;
          &lt;meta charset=&quot;utf-8&quot;&gt;
          </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>helmet<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
          </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>helmet<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
          &lt;link rel=&quot;shortcut icon&quot; href=&quot;/favicon.ico&quot;&gt;
          &lt;style&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token operator">...</span>css<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
          &lt;div id=&quot;root&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
          &lt;script src=/index.js&gt;&lt;/script&gt;
        &lt;/body&gt;
    &lt;/html&gt;
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// ...  ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="è¯·æ±‚tokenå¤„ç†"><a href="#è¯·æ±‚tokenå¤„ç†" class="header-anchor">#</a> è¯·æ±‚tokenå¤„ç†</h3> <p>å®¢æˆ·ç«¯ç™»å½•çš„æ—¶å€™ï¼ŒæŠŠç™»å½•çš„tokenï¼Œæ”¾åˆ°æµè§ˆå™¨çš„cookieä¸­å¹¶ä¸”å­˜åˆ°reduxä¸€ä»½ï¼Œcookieåœ¨æœåŠ¡ç«¯å¯ä»¥é€šè¿‡è¯·æ±‚çš„é¡µé¢ç›´æ¥è·å–åˆ°ï¼›æ‰€ä»¥å½“ç”¨æˆ·åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡é¡µé¢è¯·æ±‚è·å–åˆ°token,ç„¶åå‘reduxé‡Œé¢å­˜æ”¾ä¸€ä»½ï¼Œè¿™æ ·å®¢æˆ·ç«¯æƒ³è¦è·å–tokenå°±å¯ä»¥ç›´æ¥åœ¨reduxé‡Œé¢æ‹¿äº†ï¼ŒloadDateå‡½æ•°å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ è¿›è·å–ã€‚</p> <p><img src="https://ae01.alicdn.com/kf/Hab97bac5556440f787abf0ecde0a0f349.jpg" alt=""></p> <h3 id="_404é¡µé¢"><a href="#_404é¡µé¢" class="header-anchor">#</a> 404é¡µé¢</h3> <p>ç”¨<code>react-router-config</code>çš„<code>matchRoutes</code>æ–¹æ³•ï¼Œå½“æ•è·ä¸ºç©ºæ•°ç»„çš„æ—¶å€™ï¼Œè¯´æ˜æ²¡æœ‰å½“å‰è·¯ç”±ï¼Œè·³è½¬åˆ°404 é¡µé¢ï¼Œè¿™é‡Œé¢æœ‰ä¸€ä¸ªæ³¨æ„çš„ç‚¹æ˜¯ï¼Œå¦‚è¯´æœ‰äºŒçº§æˆ–äºŒçº§ä»¥ä¸Šçš„è·¯ç”±ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½æ•è·ç¬¬ä¸€ä¸ªè·¯ç”±çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¦åˆ¤æ–­å½“å‰è·å–åˆ°çš„æ˜¯ä¸æ˜¯ä¸€çº§è·¯ç”±ï¼Œè€Œä¸”å½“å‰æ•°æ®è¿˜ä¸èƒ½ä¸ºç©ºã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// server/index.js  </span>
<span class="token comment">// åˆ¤æ–­404</span>
<span class="token keyword">let</span> hasRoute <span class="token operator">=</span> matchedRoutes<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>matchedRoutes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>routes
<span class="token keyword">if</span> <span class="token punctuation">(</span>hasRoute <span class="token operator">||</span> <span class="token operator">!</span>matchedRoutes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/404'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ·»åŠ  â€˜/â€™ é‡å®šå‘æ˜¯ä¸€æ ·çš„å¥—è·¯</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="header-anchor">#</a> å®‰å…¨é—®é¢˜</h3> <p>å®‰å…¨é—®é¢˜éå¸¸å…³é”®ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå¼€å‘è€…è¦æ ¼å¤–å°å¿ƒã€‚è¿™é‡Œæå‡ºä¸€ä¸ªç‚¹ï¼šæˆ‘ä»¬å‰é¢æåˆ°äº†æ³¨æ°´å’Œè„±æ°´è¿‡ç¨‹ï¼Œå…¶ä¸­çš„ä»£ç ï¼š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  window<span class="token punctuation">.</span>context <span class="token operator">=</span> <span class="token punctuation">{</span>
    initialState<span class="token operator">:</span> $<span class="token punctuation">{</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>éå¸¸å®¹æ˜“é­å— XSS æ”»å‡»ï¼ŒJSON.stringify å¯èƒ½ä¼šé€ æˆ script æ³¨å…¥,ä½¿ç”¨ serialize-javascript åº“è¿›è¡Œå¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯åŒæ„åº”ç”¨ä¸­æœ€å®¹æ˜“è¢«å¿½è§†çš„ç»†èŠ‚ã€‚</p> <p><strong>å¦ä¸€ä¸ªè§„é¿è¿™ç§ XSS é£é™©çš„åšæ³•æ˜¯</strong>ï¼šå°†æ•°æ®ä¼ é€’ä¸ªé¡µé¢ä¸­ä¸€ä¸ªéšè—çš„ textarea çš„ value ä¸­ï¼Œtextarea çš„ value è‡ªç„¶å°±ä¸æ€• XSS é£é™©äº†ã€‚</p> <h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="header-anchor">#</a> ä¼˜åŒ–</h3> <ol><li>å®¢æˆ·ç«¯jsæ‹†åŒ…ï¼Œå‹ç¼©ä»£ç </li> <li>å®¢æˆ·ç«¯æ‰“åŒ…çš„jså¸¦æœ‰hashåç¼€</li> <li>ä½¿ç”¨copy-webpack-pluginï¼Œç›´æ¥æŠŠéœ€è¦çš„æ–‡ä»¶ï¼Œæ‰“åŒ…åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ã€‚</li> <li>ä¸­é—´ä»¶è½¬å‘ä»£ç† è·¨åŸŸç­‰</li> <li>é™æ€èµ„æºä½¿ç”¨cdn</li> <li>æœåŠ¡ç«¯ä½¿ç”¨ç¼“å­˜</li> <li>å¯¹æœåŠ¡ç«¯å‹åŠ›è¿‡å¤§çš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°å®¢æˆ·ç«¯æ¸²æŸ“</li> <li>nodeJs/ReactJsçš„ç‰ˆæœ¬å‡çº§</li></ol> <h3 id="é‡åˆ°çš„é—®é¢˜æ±‡æ€»"><a href="#é‡åˆ°çš„é—®é¢˜æ±‡æ€»" class="header-anchor">#</a> é‡åˆ°çš„é—®é¢˜æ±‡æ€»</h3> <ol><li><p>äºŒçº§èœå•çš„æ—¶å€™è·å–åˆ°é™æ€èµ„æºçš„è·¯å¾„ï¼Œå¸¦ç€ç¬¬ä¸€çº§èœå•çš„è·¯å¾„</p></li> <li><p>æœåŠ¡ç«¯å¯¼å…¥css çš„æ—¶å€™ï¼Œcssæ˜¯æœ‰åšhash å¤„ç†ä¸èƒ½æ­£ç¡®çš„åŠ è½½css (cssmodules)</p></li> <li><p>æœåŠ¡ç«¯å¯¼å…¥cssæ—¶å‘ç”Ÿåœ¨componentWillMountå‘¨æœŸå‡½æ•°ï¼Œä¸èƒ½åœ¨componentDidMount,æ­¤æ—¶å·²ç»åˆ°å®¢æˆ·ç«¯äº†ã€‚</p></li> <li><p>koaçš„è·¯ç”±ä¸åƒexpressé‚£æ ·ä¸èƒ½ç›´æ¥ä½¿ç”¨ ***** ï¼Œ ï¼ˆå¯èƒ½å¯ä»¥ï¼Œåœ¨æˆ‘è¿™æŠ¥é”™ï¼‰</p></li> <li><p>ä¸­é—´ä»¶çš„é¡ºåºã€å’Œå¼‚æ­¥æ—¶ ctx.body='' çš„é—®é¢˜ï¼ˆå¦‚æœæœ‰å¼‚æ­¥æ“ä½œä¸­é—´ä»¶å°±å¿…é¡»å†™æˆ async å‡½æ•°ï¼‰</p></li> <li><p>react-helmet ä½¿ç”¨æ—¶ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰æ˜¾ç¤ºè®¾ç½®çš„titleç­‰ä¿¡æ¯  ï¼ˆåœ¨æœ€å¤–å±‚å¯¼å…¥ï¼‰</p></li> <li><p>æ³¨æ°´çš„æ—¶å€™ï¼Œæ³¨æ„reduxå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒºåˆ«å’Œè”ç³»</p></li> <li><p>æ³¨æ°´å¼‚æ­¥åŠ è½½çš„é—®é¢˜  promise.all()</p></li> <li><p>å®¢æˆ·ç«¯è·¯ç”±ä½¿ç”¨çš„history,è·³è½¬ä¸è®¿é—®koaçš„è·¯ç”±</p></li> <li><p>ssr éƒ¨ç½²ä»£ç ä½“ç§¯ç‰¹åˆ«å¤§ ,æ·»åŠ å¹¶å‘ï¼Œå…¬å…±å•ç‹¬æ‹†å‡ºã€ä½¿ç”¨cdn</p></li> <li><p>pm2ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œ</p></li> <li><p>å¼€å¯cssModulesåæŠŠantdçš„æ ·å¼ä¹Ÿç¼–è¯‘äº†</p></li> <li><p>æ·»åŠ ä¸€ä¸ªå¸¸é‡æ•°ç»„ï¼Œç”¨æ¥è¡¨ç¤ºé‚£äº›å¿…é¡»ç”¨æ¥æœåŠ¡ç«¯æ¸²æŸ“(æé«˜åŠ è½½é€Ÿåº¦)ï¼Œä¸èƒ½å¤ªå¤šï¼Œå½±å“æ€§èƒ½ã€è®°å¾—å»é‡ã€‘</p></li> <li><p>ä»åˆ«çš„é¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œä¸ºä»€ä¹ˆæ‰“å¼€ç½‘é¡µæºä»£ç æœ‰æ¸²æŸ“å¥½çš„html,ä¸åº”è¯¥åªæœ‰é¦–å±æ¸²æŸ“å—ï¼Ÿã€æ‰“å¼€æ§åˆ¶å°ç›¸å½“äºé‡æ–°æ¸²æŸ“äº†ã€‘</p></li> <li><p><a href="https://github.com/hzfvictory/react-ssr/blob/master/src/pages/home/model.js#L27" target="_blank" rel="noopener noreferrer">æœåŠ¡ç«¯è·å–äº†æ•°æ®ï¼Œå®¢æˆ·ç«¯æ€ä¹ˆåˆ¤æ–­å·²ç»è·å–äº†ï¼Œä¸å†è°ƒå–æ¥å£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>æœåŠ¡ç«¯æœ‰äº†csså®¢æˆ·ç«¯è¿˜éœ€è¦å—ï¼Ÿ</p> <p><strong>ç­”æ¡ˆæ˜¯éœ€è¦çš„ã€‚</strong></p> <p>æœåŠ¡ç«¯çš„csså…¶å®å°±æ˜¯å®¢æˆ·ç«¯ç»™çš„ï¼SSRçš„æ¸²æŸ“åªæ˜¯é’ˆå¯¹é¡µé¢çš„é¦–å±ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ· ç¬¬ä¸€æ¬¡æ‰“å¼€çš„é¡µé¢ï¼Œå½“ä»é¦–å±è·³è½¬åˆ°åˆ«çš„é¡µé¢çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¿˜æ˜¯éœ€è¦å®¢æˆ·ç«¯æ¥æ¸²æŸ“çš„ï¼Œheadçš„cssä¹Ÿæ˜¯é€šè¿‡jsçš„é«˜é˜¶å‡½æ•°ï¼Œä¼ è¿›å»çš„ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯æ²¡æœ‰äº†cssï¼ŒæœåŠ¡ç«¯ä¸€å®šæ˜¯æ²¡æœ‰cssçš„ã€‚åœ¨reactçš„é¡¹ç›®ä¸­æ˜¯æ²¡æœ‰çœŸæ­£çš„cssçš„ï¼Œæ‰€è°“çš„cssä¹Ÿæ˜¯é€šè¿‡jsæ¥å®ç°åŠ¨æ€å¼•å…¥ï¼Œæ‰€ä»¥cssä¹Ÿæ˜¯js,åŒ…æ‹¬å›¾ç‰‡ã€‚</p></li> <li><p>ssræ€ä¹ˆè¿›è¡Œå‚æ•°çš„ä¼ è¾“å’Œè·å–</p> <ul><li><strong>ç›´æ¥ä½¿ç”¨é—®å·ä¼ å‚</strong></li></ul> <p>å®¢æˆ·ç«¯pathï¼š /a/b?id=1008611
ç„¶åé€šè¿‡æ­£åˆ™æˆ–è€…ä½¿ç”¨qsè·å–åˆ°idçš„å€¼</p> <ul><li><strong>åœ°å€æ ä¼ å‚</strong></li></ul></li></ol> <p><strong>æ–¹æ³•ä¸€</strong></p> <div class="language- extra-class"><pre><code>æƒ³è¦ä¼ å‚å®¢æˆ·ç«¯è·¯ç”±åœ¨åå°è®¾ç½®ä¸‹ï¼Œä½¿å®ƒèƒ½ç›´æ¥è·å–åˆ°params
ä¾‹å¦‚ï¼šroute.get('detail/id:?'()=&gt;{}))
æœ€å¥½æ˜¯æŠŠå®¢æˆ·ç«¯æ‰€æœ‰è¦ä¼ å‚urléƒ½æ·»åŠ ä¸€æ ·çš„å‰ç¼€
é¡µé¢A menu/homeDetail/1212
é¡µé¢B menu/aboutDetail/3434

route.get('menu/:pageInfo?/:id?'()=&gt;{}))

 **æ–¹æ³•äºŒ**
 ä¹Ÿæ˜¯æˆ‘å†ç”¨çš„æ–¹æ³•ï¼Œè·å–åˆ°å½“å‰çš„è·¯ç”±pathå’Œè¯·æ±‚çš„url,é€šè¿‡æ­£åˆ™è·å–åˆ°å½“å‰çš„idä¹Ÿå¯ä»¥ç›´æ¥ç”¨`path-to-regexp`
</code></pre></div><blockquote><p>ä¸Šé¢çš„é—®é¢˜ï¼Œå‡å·²è§£å†³ï¼Œå¯èƒ½æ–‡ç« ä»‹ç»çš„ä¸å…·ä½“ï¼Œå…·ä½“ä»¥æºç ä¸ºå‡†ã€‚</p></blockquote> <p><code>å–œæ¬¢çš„markğŸ‘</code></p> <h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="header-anchor">#</a> å‚è€ƒæ–‡æ¡£</h3> <p><a href="http://blog.poetries.top/2018/11/18/react-ssr/?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">ä»é›¶åˆ°ä¸€æ­å»ºReact SSRå·¥ç¨‹æ¶æ„<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://zhuanlan.zhihu.com/p/66672794" target="_blank" rel="noopener noreferrer">çŸ¥ä¹ rendertron<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/hzfvictory/react-ssr" target="_blank" rel="noopener noreferrer">æœ¬æ–‡çš„githubåœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/hzfvictory/file/edit/devlop/docs/workspace/Frame/react/ssr.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/workspace/Frame/react/dom_diff.html" class="prev">
        VirtualDOM
      </a></span> <span class="next"><a href="/workspace/Frame/react/problem.html">
        é—®é¢˜éªŒè¯è§£æ
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><Comment></Comment></div></div>
    <script src="/assets/js/app.f10080ab.js" defer></script><script src="/assets/js/2.83a81645.js" defer></script><script src="/assets/js/45.1fa66b9e.js" defer></script>
  </body>
</html>
