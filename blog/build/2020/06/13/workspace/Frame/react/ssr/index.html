<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>React-SSR | hfzvictory</title><meta name="description" content="React-SSR [[toc]]  å…ˆé™„ä¸Šgithubåœ°å€https:&#x2F;&#x2F;github.com&#x2F;hzfvictory&#x2F;react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚ æ¬¢è¿å¤§å®¶ç‚¹star,æissueï¼Œä¸€èµ·è¿›æ­¥ï¼ğŸ˜„  å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“CSR: é¡µé¢æ¸²æŸ“æ˜¯JSè´Ÿè´£è¿›è¡Œçš„ æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›HTMLâ€“&gt;æµè§ˆå™¨å‘é€bundle.jsè¯·æ±‚â€“&gt;æœåŠ¡å™¨"><meta name="keywords" content="å’ŒæŒ¯å³°åšå®¢ï¼Œwebå‰ç«¯ï¼Œnodeå…¨æ ˆå·¥ç¨‹å¸ˆï¼Œhzfvictory"><meta name="author" content="hfzvictory,feng960106@163.com"><meta name="copyright" content="hfzvictory"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="React-SSR"><meta name="twitter:description" content="React-SSR [[toc]]  å…ˆé™„ä¸Šgithubåœ°å€https:&#x2F;&#x2F;github.com&#x2F;hzfvictory&#x2F;react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚ æ¬¢è¿å¤§å®¶ç‚¹star,æissueï¼Œä¸€èµ·è¿›æ­¥ï¼ğŸ˜„  å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“CSR: é¡µé¢æ¸²æŸ“æ˜¯JSè´Ÿè´£è¿›è¡Œçš„ æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›HTMLâ€“&gt;æµè§ˆå™¨å‘é€bundle.jsè¯·æ±‚â€“&gt;æœåŠ¡å™¨"><meta name="twitter:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><meta property="og:type" content="article"><meta property="og:title" content="React-SSR"><meta property="og:url" content="http://file.jing999.cn/2020/06/13/workspace/Frame/react/ssr/"><meta property="og:site_name" content="hfzvictory"><meta property="og:description" content="React-SSR [[toc]]  å…ˆé™„ä¸Šgithubåœ°å€https:&#x2F;&#x2F;github.com&#x2F;hzfvictory&#x2F;react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚ æ¬¢è¿å¤§å®¶ç‚¹star,æissueï¼Œä¸€èµ·è¿›æ­¥ï¼ğŸ˜„  å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“CSR: é¡µé¢æ¸²æŸ“æ˜¯JSè´Ÿè´£è¿›è¡Œçš„ æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›HTMLâ€“&gt;æµè§ˆå™¨å‘é€bundle.jsè¯·æ±‚â€“&gt;æœåŠ¡å™¨"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><meta property="article:published_time" content="2020-06-13T00:00:00.000Z"><meta property="article:modified_time" content="2020-09-17T04:53:07.369Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://file.jing999.cn/2020/06/13/workspace/Frame/react/ssr/"><link rel="prev" title="åŸºäºVueçš„ç»„ä»¶å±€éƒ¨åˆ·æ–°" href="http://file.jing999.cn/2020/06/15/workspace/Frame/vue/reload/"><link rel="next" title="å…¨å±€æŒ‚è½½ç»„ä»¶ä¹‹Vue.extend" href="http://file.jing999.cn/2020/06/13/workspace/Frame/vue/source-code/vue-extend/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  runtime: true,
  copyright: {"languages":{"author":"ä½œè€…: hfzvictory","link":"é“¾æ¥: ","source":"æ¥æº: hfzvictory","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: false,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://ae01.alicdn.com/kf/H9ae3136bf5e440239fa2c611632fbd09H.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">104</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">99</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/todos"><i class="fa-fw fa fa-battery-three-quarters"></i><span> Todos</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bicycle" aria-hidden="true"></i><span> å–œå¥½</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page" href="/movies"><i class="fa-fw fa fa-film"></i><span> ç”µå½±</span></a></li><li><a class="site-page" href="/photos"><i class="fa-fw fa fa-picture-o"></i><span> ç…§ç‰‡</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“"><span class="toc-number">1.</span> <span class="toc-text">å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRçš„å®ç°æœ¬è´¨"><span class="toc-number">2.</span> <span class="toc-text">SSRçš„å®ç°æœ¬è´¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ–¹æ¡ˆç­›é€‰"><span class="toc-number">3.</span> <span class="toc-text">æ–¹æ¡ˆç­›é€‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR"><span class="toc-number">4.</span> <span class="toc-text">Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¸ä½¿ç”¨koa-router"><span class="toc-number">4.1.</span> <span class="toc-text">ä¸ä½¿ç”¨koa-router</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä½¿ç”¨koa-router"><span class="toc-number">4.2.</span> <span class="toc-text">ä½¿ç”¨koa-router</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“"><span class="toc-number">5.</span> <span class="toc-text">å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Webpack-base"><span class="toc-number">5.1.</span> <span class="toc-text">Webpack base</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æœåŠ¡å™¨ç«¯-Webpack-é…ç½®"><span class="toc-number">5.2.</span> <span class="toc-text">æœåŠ¡å™¨ç«¯ Webpack é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åŒæ„"><span class="toc-number">6.</span> <span class="toc-text">åŒæ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS"><span class="toc-number">6.1.</span> <span class="toc-text">å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å®¢æˆ·ç«¯-Webpack-é…ç½®"><span class="toc-number">6.2.</span> <span class="toc-text">å®¢æˆ·ç«¯ Webpack é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘"><span class="toc-number">6.3.</span> <span class="toc-text">æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSSæ ·å¼é—®é¢˜å¤„ç†"><span class="toc-number">7.</span> <span class="toc-text">CSSæ ·å¼é—®é¢˜å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å–-Dvaçš„ä½¿ç”¨"><span class="toc-number">8.</span> <span class="toc-text">SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dvaçš„ä½¿ç”¨"><span class="toc-number">8.1.</span> <span class="toc-text">Dvaçš„ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ•°æ®è·å–"><span class="toc-number">8.2.</span> <span class="toc-text">æ•°æ®è·å–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ³¨æ°´å’Œè„±æ°´"><span class="toc-number">8.3.</span> <span class="toc-text">æ³¨æ°´å’Œè„±æ°´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#é…ç½®ä»£ç†"><span class="toc-number">8.4.</span> <span class="toc-text">é…ç½®ä»£ç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¼•å…¥react-helmet"><span class="toc-number">9.</span> <span class="toc-text">å¼•å…¥react-helmet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è¯·æ±‚tokenå¤„ç†"><span class="toc-number">10.</span> <span class="toc-text">è¯·æ±‚tokenå¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#404é¡µé¢"><span class="toc-number">11.</span> <span class="toc-text">404é¡µé¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®‰å…¨é—®é¢˜"><span class="toc-number">12.</span> <span class="toc-text">å®‰å…¨é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¼˜åŒ–"><span class="toc-number">13.</span> <span class="toc-text">ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é‡åˆ°çš„é—®é¢˜æ±‡æ€»"><span class="toc-number">14.</span> <span class="toc-text">é‡åˆ°çš„é—®é¢˜æ±‡æ€»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å‚è€ƒæ–‡æ¡£"><span class="toc-number">15.</span> <span class="toc-text">å‚è€ƒæ–‡æ¡£</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div class="post-bg" id="nav" style="background-image: url(https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">hfzvictory</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/todos"><i class="fa-fw fa fa-battery-three-quarters"></i><span> Todos</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bicycle" aria-hidden="true"></i><span> å–œå¥½</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page" href="/movies"><i class="fa-fw fa fa-film"></i><span> ç”µå½±</span></a></li><li><a class="site-page" href="/photos"><i class="fa-fw fa fa-picture-o"></i><span> ç…§ç‰‡</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">React-SSR</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="å‘è¡¨äº 2020-06-13 00:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> å‘è¡¨äº 2020-06-13</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="æ›´æ–°äº 2020-09-17 04:53:07"><i class="fa fa-history" aria-hidden="true"></i> æ›´æ–°äº 2020-09-17</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/FE%E6%A1%86%E6%9E%B6/">FEæ¡†æ¶</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/FE%E6%A1%86%E6%9E%B6/React/">React</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/FE%E6%A1%86%E6%9E%B6/React/React-SSR/">React-SSR</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>å­—æ•°æ€»è®¡:</span><span class="word-count">7.5k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>é˜…è¯»æ—¶é•¿: 29 åˆ†é’Ÿ</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p><strong class='old-blog'>React-SSR</strong></p>
<p>[[toc]]</p>
<hr>
<p>å…ˆé™„ä¸Šgithubåœ°å€<a href="https://github.com/hzfvictory/react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚" target="_blank" rel="noopener">https://github.com/hzfvictory/react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚</a></p>
<p>æ¬¢è¿å¤§å®¶ç‚¹star,æissueï¼Œä¸€èµ·è¿›æ­¥ï¼ğŸ˜„ </p>
<h3 id="å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“"><a href="#å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“" class="headerlink" title="å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“"></a>å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“</h3><p><strong>CSR:</strong></p>
<p>é¡µé¢æ¸²æŸ“æ˜¯JSè´Ÿè´£è¿›è¡Œçš„</p>
<p>æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›HTMLâ€“&gt;æµè§ˆå™¨å‘é€bundle.jsè¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›bundle.jsâ€“&gt;æµè§ˆå™¨æ‰§è¡Œbundle.jsä¸­çš„reactä»£ç å®Œæˆæ¸²æŸ“</p>
<p><strong>SSR:</strong></p>
<p>æœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›HTMLè®©æµè§ˆå™¨ç›´æ¥æ¸²æŸ“</p>
<p>æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿è¡ŒReactä»£ç ç”Ÿæˆé¡µé¢â€“&gt;æœåŠ¡å™¨è¿”å›é¡µé¢</p>
<p><strong>ä¼ ç»ŸCSRçš„å¼Šç«¯:</strong></p>
<ol>
<li><p>ç”±äºé¡µé¢æ˜¾ç¤ºè¿‡ç¨‹è¦è¿›è¡ŒJSæ–‡ä»¶æ‹‰å–å’ŒReactä»£ç æ‰§è¡Œï¼Œåœ¨è¿™ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­è‡³å°‘æ¶‰åŠåˆ°ä¸¤ä¸ª HTTPè¯·æ±‚å‘¨æœŸï¼ˆhtml+jsï¼‰ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€å®šçš„è€—æ—¶ï¼Œé¦–å±åŠ è½½æ—¶é—´ä¼šæ¯”è¾ƒæ…¢ã€‚</p>
</li>
<li><p>å¯¹äºSEO(Search Engine Optimazition,å³æœç´¢å¼•æ“ä¼˜åŒ–)ï¼Œå®Œå…¨æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæœç´¢å¼•æ“çˆ¬è™«åªè®¤è¯†htmlç»“æ„çš„å†…å®¹ï¼Œè€Œä¸èƒ½è¯†åˆ«JSä»£ç å†…å®¹ã€‚</p>
</li>
</ol>
<p><strong>SSRçš„å¼Šç«¯:</strong></p>
<p>ssrçš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›ä¼ ç»ŸCSRçš„å¼Šç«¯</p>
<p>åœ¨ React ä¸­ä½¿ç”¨ ssr æŠ€æœ¯ï¼Œæˆ‘ä»¬è®© React ä»£ç åœ¨æœåŠ¡å™¨ç«¯å…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œä½¿å¾—ç”¨æˆ·ä¸‹è½½çš„ HTML å·²ç»åŒ…å«äº†æ‰€æœ‰çš„é¡µé¢å±•ç¤ºå†…å®¹ï¼Œè¿™æ ·ï¼Œé¡µé¢å±•ç¤ºçš„è¿‡ç¨‹åªéœ€è¦ç»å†ä¸€ä¸ª HTTP è¯·æ±‚å‘¨æœŸï¼ŒTTFPï¼ˆTime To First Pageï¼‰ æ—¶é—´å¾—åˆ°ä¸€å€ä»¥ä¸Šçš„ç¼©å‡</p>
<p>ä½†æ˜¯ä½¿ç”¨ ssr è¿™ç§æŠ€æœ¯ï¼Œå°†ä½¿åŸæœ¬ç®€å•çš„ React é¡¹ç›®å˜å¾—éå¸¸å¤æ‚</p>
<ol>
<li><p>ç›¸å¯¹äºä»…ä»…éœ€è¦æä¾›é™æ€æ–‡ä»¶çš„æœåŠ¡å™¨ï¼Œssrä¸­ä½¿ç”¨çš„æ¸²æŸ“ç¨‹åºè‡ªç„¶ä¼šå ç”¨æ›´å¤šçš„CPUå’Œå†…å­˜èµ„æº</p>
</li>
<li><p>åœ¨æœåŠ¡å™¨ç”Ÿæˆçš„é¡µé¢æ‰€ä»¥ï¼Œä¸€äº›å¸¸ç”¨çš„æµè§ˆå™¨APIå¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚windowã€docmentå’Œalertç­‰ï¼Œå¦‚æœä½¿ç”¨çš„è¯éœ€è¦å¯¹è¿è¡Œçš„ç¯å¢ƒåŠ ä»¥åˆ¤æ–­</p>
</li>
<li><p>å¼€å‘è°ƒè¯•ä¼šæœ‰ä¸€äº›éº»çƒ¦ï¼Œå› ä¸ºæ¶‰åŠäº†æµè§ˆå™¨åŠæœåŠ¡å™¨ï¼Œå¯¹äºSPAçš„ä¸€äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ä¼šå˜å¾—å¤æ‚</p>
</li>
<li><p>å¯èƒ½ä¼šç”±äºæŸäº›å› ç´ å¯¼è‡´æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ç»“æœä¸æµè§ˆå™¨ç«¯çš„ç»“æœä¸ä¸€è‡´ï¼Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¼šé™ä½ï¼Œä»£ç é—®é¢˜çš„è¿½æº¯ä¹Ÿä¼šå˜å¾—å›°éš¾</p>
</li>
</ol>
<p>æ‰€ä»¥ï¼Œä½¿ç”¨ ssr åœ¨è§£å†³é—®é¢˜çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¸¦æ¥éå¸¸å¤šçš„å‰¯ä½œç”¨ï¼Œæœ‰çš„æ—¶å€™ï¼Œè¿™äº›å‰¯ä½œç”¨çš„ä¼¤å®³æ¯”èµ· ssr æŠ€æœ¯å¸¦æ¥çš„ä¼˜åŠ¿è¦å¤§çš„å¤šã€‚ä¸€èˆ¬å»ºè®®ssrï¼Œé™¤éä½ çš„é¡¹ç›®ç‰¹åˆ«ä¾èµ–æœç´¢å¼•æ“æµé‡ï¼Œæˆ–è€…å¯¹é¦–å±æ—¶é—´æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨ ssr,å¦‚æœåªå¯¹seoæœ‰è¦æ±‚å¯ä½¿ç”¨ <a href="https://github.com/prerender/prerender" target="_blank" rel="noopener">prerenderé¢„æ¸²æŸ“</a>ã€‚</p>
<h3 id="SSRçš„å®ç°æœ¬è´¨"><a href="#SSRçš„å®ç°æœ¬è´¨" class="headerlink" title="SSRçš„å®ç°æœ¬è´¨"></a>SSRçš„å®ç°æœ¬è´¨</h3><p>è¿™é‡Œä»‹ç»çš„æ˜¯ssrï¼Œæ˜¯åŸºäºReact çš„SPAé¡¹ç›®ï¼Œä¸æ˜¯åƒ thinkphpã€jspã€nodeJs+ejs è¿™ç§çº¯åç«¯ç›´å‡ºæ¸²æŸ“æ–¹å¼ï¼Œæ‰€ä»¥è¿™ç§å¤§å¤šæ•°åªæ˜¯é’ˆå¯¹é¦–å±çš„ssr,å› ä¸ºæµè§ˆå™¨çš„è·¯ç”±è·³è½¬æ–¹å¼æ˜¯ç”¨çš„H5çš„<code>history  API</code>çš„<code>window.history.pushState()</code> ï¼Œä½¿å¾—æˆ‘ä»¬å³å¯ä»¥ä¿®æ”¹ <code>url</code> ä¹Ÿå¯ä»¥ä¸åˆ·æ–°é¡µé¢ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šèµ°æœåŠ¡ç«¯çš„ã€å¯ä»¥é€šè¿‡é¢„åŠ è½½è·å–éœ€è¦çš„æ•°æ®ã€‘ã€‚</p>
<p><strong>ssr ä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºè™šæ‹Ÿ DOM çš„å­˜åœ¨</strong></p>
<p>ssr çš„å·¥ç¨‹ä¸­ï¼ŒReact ä»£ç ä¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å„æ‰§è¡Œä¸€æ¬¡,å› ä¸ºä»£ç åœ¨ Node ç¯å¢ƒä¸‹æ˜¯æ²¡æœ‰DOMè¿™ä¸ªæ¦‚å¿µçš„ï¼Œæ‰€ä»¥åœ¨React æ¡†æ¶ä¸­å¼•å…¥äº†ä¸€ä¸ªæ¦‚å¿µå«åšè™šæ‹Ÿ DOMï¼ŒReact åœ¨åšé¡µé¢æ“ä½œæ—¶ï¼Œå®é™…ä¸Šä¸æ˜¯ç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯æ“ä½œè™šæ‹Ÿ DOMï¼Œä¹Ÿå°±æ˜¯æ“ä½œæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œè¿™å°±ä½¿å¾— ssr æˆä¸ºäº†å¯èƒ½ã€‚åœ¨æœåŠ¡å™¨ï¼Œæˆ‘å¯ä»¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œåˆ¤æ–­ç¯å¢ƒæ˜¯æœåŠ¡å™¨ç¯å¢ƒï¼Œæˆ‘ä»¬æŠŠè™šæ‹Ÿ DOM æ˜ å°„æˆå­—ç¬¦ä¸²è¾“å‡ºï¼›åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œåˆ¤æ–­ç¯å¢ƒæ˜¯å®¢æˆ·ç«¯ç¯å¢ƒï¼Œæˆ‘å°±ç›´æ¥å°†è™šæ‹Ÿ DOM æ˜ å°„æˆçœŸå® DOMï¼Œå®Œæˆé¡µé¢æŒ‚è½½ã€‚</p>
<h3 id="æ–¹æ¡ˆç­›é€‰"><a href="#æ–¹æ¡ˆç­›é€‰" class="headerlink" title="æ–¹æ¡ˆç­›é€‰"></a>æ–¹æ¡ˆç­›é€‰</h3><ul>
<li><a href="[https://nextjs.frontendx.cn/docs/#%E5%AE%89%E8%A3%85](https://nextjs.frontendx.cn/docs/#å®‰è£…)">next.js</a>/<a href="https://www.nuxtjs.cn/guide/installation" target="_blank" rel="noopener">nuxt.js</a>      æˆæœ¬ä½,å®‰å¿ƒçš„å†™é¡µé¢å°±è¡Œäº†ï¼Œæ— éœ€è¿‡å¤šå…³å¿ƒæœåŠ¡ç«¯è·¯ç”±ï¼ˆå¤šé¡µé¢åº”ç”¨ï¼Œæ–°æ¡†æ¶ï¼‰</li>
<li><a href="https://github.com/hzfvictory/prerender" target="_blank" rel="noopener">prerender </a>å®ç°spaé¡¹ç›®çš„æœåŠ¡ç«¯é¢„æ¸²æŸ“</li>
<li>ä½¿ç”¨è°·æ­Œ <a href="https://github.com/hzfvictory/rendertron" target="_blank" rel="noopener">rendertron</a> å®ç°spaé¡¹ç›®çš„æœåŠ¡ç«¯æ¸²æŸ“ ã€æ®è¯´ä¼šè¢«åˆ¤ä½œå¼Šçš„ï¼Œé™æƒå¤„ç†ã€‘</li>
<li>ç§‰æ‰¿å­¦ä¹ çš„æ€åº¦äº†è§£ä¸‹åŸºæœ¬åŸç†ï¼Œé€‰æ‹©äº†è‡ªå·±å»æ­ï¼Œï¼ˆä¸­é—´æ–­äº†ä¸€æ®µæ—¶é—´ï¼Œç°åœ¨åˆé‡æ–°æ‹¾èµ·æ¥ï¼‰ï¼Œä¹‹å‰çœ‹åˆ°æœ‰äººç”¨ react + redux + Express æ­ssrçš„æ–‡ç« ï¼Œæ‰€ä»¥åŸºäºå¯¹dvaå’Œkoaçš„ç†Ÿæ‚‰å’Œç‰¹åˆ«å–œå¥½ï¼Œå°±ç›´æ¥é€‰æ‹©äº†dva-core + koa åšçŠ¶æ€ç®¡ç†æ­å»ºã€‚</li>
</ul>
<h3 id="Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR"><a href="#Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR" class="headerlink" title="Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR"></a>Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR</h3><h4 id="ä¸ä½¿ç”¨koa-router"><a href="#ä¸ä½¿ç”¨koa-router" class="headerlink" title="ä¸ä½¿ç”¨koa-router"></a>ä¸ä½¿ç”¨koa-router</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.path === <span class="string">'/'</span>) &#123;</span><br><span class="line">    ctx.body =</span><br><span class="line">      <span class="string">`</span></span><br><span class="line"><span class="string">     &lt;html&gt;</span></span><br><span class="line"><span class="string">       &lt;head&gt;</span></span><br><span class="line"><span class="string">         &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span><br><span class="line"><span class="string">       &lt;/head&gt;</span></span><br><span class="line"><span class="string">       &lt;body&gt;</span></span><br><span class="line"><span class="string">         &lt;h1&gt;hello&lt;/h1&gt;</span></span><br><span class="line"><span class="string">         &lt;h2&gt;world&lt;/h2&gt;</span></span><br><span class="line"><span class="string">       &lt;/body&gt;</span></span><br><span class="line"><span class="string">     &lt;/html&gt;</span></span><br><span class="line"><span class="string">     `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> server = app.listen(<span class="string">'9999'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;port&#125; = server.address();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨koa-router"><a href="#ä½¿ç”¨koa-router" class="headerlink" title="ä½¿ç”¨koa-router"></a>ä½¿ç”¨koa-router</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> route = <span class="built_in">require</span>(<span class="string">"koa-router"</span>)() <span class="comment">// è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">route.get(<span class="string">"/"</span>, (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body =</span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">   &lt;html&gt;</span></span><br><span class="line"><span class="string">       &lt;head&gt;</span></span><br><span class="line"><span class="string">         &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span><br><span class="line"><span class="string">       &lt;/head&gt;</span></span><br><span class="line"><span class="string">       &lt;body&gt;</span></span><br><span class="line"><span class="string">         &lt;h1&gt;hello&lt;/h1&gt;</span></span><br><span class="line"><span class="string">         &lt;h2&gt;world&lt;/h2&gt;</span></span><br><span class="line"><span class="string">       &lt;/body&gt;</span></span><br><span class="line"><span class="string">     &lt;/html&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(route.routes());</span><br><span class="line">app.use(route.allowedMethods()); <span class="comment">//è‡ªåŠ¨è®¾ç½®å“åº”å¤´ctx.statuså®Œå–„responseå“åº”å¤´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = app.listen(<span class="string">'9999'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;port&#125; = server.address();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<p>è¿™æ ·ä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯æ¸²æŸ“å°±æå®šäº†ï¼ŒæœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›HTMLè®©æµè§ˆå™¨ç›´æ¥æ¸²æŸ“ï¼Œè€Œä¸”ç½‘é¡µæºä»£ç ä¸­æ˜¯æœ‰è¿™äº›domä¿¡æ¯çš„å¯¹seoéå¸¸å‹å¥½ï¼Œæˆ‘ä»¬reactã€vueè¿™äº›éƒ½æ˜¯é€šè¿‡webpackå¼•å…¥äº†js,æ‰€æœ‰çš„åŠŸèƒ½é¡µé¢å±•ç¤ºç»Ÿç»Ÿç”±jså®Œæˆã€‚</p>
<h3 id="å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“"><a href="#å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“" class="headerlink" title="å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“"></a>å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“</h3><p>åˆ°è¿™ä¸€æ­¥å·²ç»ä¸èƒ½ç›´æ¥ç”¨nodeå¯åŠ¨æœåŠ¡äº†ï¼Œå› ä¸ºæ²¡æœ‰<code>babel</code>ï¼Œ  Reactä¸ä¼šè½¬åŒ–æˆ<code>createElement</code>çš„å½¢å¼ï¼Œè€Œä¸”ä½¿ç”¨nodeä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨importå¯¼å…¥æ–¹å¼ã€‚</p>
<p>éšä¾¿ç¼–å†™ä¸€ä¸ªReactçš„ç»„ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/pages/home</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;Homeç»„ä»¶&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æŠŠå½“å‰ç»„ä»¶ï¼Œä½¿ç”¨æœåŠ¡å‘˜æ¸²æŸ“å‡ºæ¥ï¼Œçœ‹ä¸‹é¢é…ç½®ï¼š</p>
<h4 id="Webpack-base"><a href="#Webpack-base" class="headerlink" title="Webpack base"></a>Webpack base</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.base.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.js|jsx$/</span>,</span><br><span class="line">      loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        presets: [<span class="string">'@babel/preset-react'</span>, [<span class="string">'@babel/preset-env'</span>, &#123;</span><br><span class="line">          targets: &#123;</span><br><span class="line">            browsers: [<span class="string">'last 2 versions'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="æœåŠ¡å™¨ç«¯-Webpack-é…ç½®"><a href="#æœåŠ¡å™¨ç«¯-Webpack-é…ç½®" class="headerlink" title="æœåŠ¡å™¨ç«¯ Webpack é…ç½®"></a>æœåŠ¡å™¨ç«¯ Webpack é…ç½®</h4><p>æœåŠ¡ç«¯è¿è¡Œçš„ä»£ç å¦‚æœéœ€è¦ä¾èµ– Node æ ¸å¿ƒæ¨¡å—æˆ–è€…ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œ<code>å°±ä¸å†éœ€è¦æŠŠå®¢æˆ·ç«¯çš„ä¸€äº›æ¨¡å—ä»£ç æ‰“åŒ…åˆ°æœ€ç»ˆä»£ç ä¸­äº†</code>ã€‚å› ä¸ºç¯å¢ƒå·²ç»å®‰è£…è¿™äº›ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±éœ€è¦æˆ‘ä»¬åœ¨ webpack ä¸­é…ç½®ï¼š<code>targetï¼šnode</code>ï¼Œå¹¶å€ŸåŠ© webpack-node-externals æ’ä»¶ï¼Œè§£å†³ç¬¬ä¸‰æ–¹ä¾èµ–æ‰“åŒ…çš„é—®é¢˜ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.server.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> nodeExternals = <span class="built_in">require</span>(<span class="string">'webpack-node-externals'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.base'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverConfig = &#123;</span><br><span class="line">  target: <span class="string">'node'</span>, <span class="comment">// ç¼–è¯‘å‡ºèƒ½è®©nodeè¯†åˆ«çš„ä»£ç   https://webpack.docschina.org/concepts/targets/</span></span><br><span class="line">  mode: <span class="string">'development'</span>, <span class="comment">// è¿™é‡Œçš„modeè¦ç‰¹åˆ«æ³¨æ„</span></span><br><span class="line">  entry: <span class="string">'./src/server/index.js'</span>, <span class="comment">// å¯¹åº”æœåŠ¡ç«¯çš„ä»£ç </span></span><br><span class="line">  <span class="comment">// https://webpack.docschina.org/configuration/externals/</span></span><br><span class="line">  externals: [nodeExternals()], <span class="comment">// ä¸ºäº†å¿½ç•¥node_modulesæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ¨¡å—</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../bundle'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = merge(config, serverConfig)</span><br></pre></td></tr></table></figure>



<p> <strong>target: â€˜nodeâ€™ å’Œ target: â€˜webâ€™ çš„å¤§è‡´åŒºåˆ«</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// target: 'node'</span></span><br><span class="line">exports.ids = [<span class="number">0</span>];</span><br><span class="line">exports.modules = &#123;&#125;;</span><br><span class="line"><span class="comment">// target: 'web' </span></span><br><span class="line">(<span class="built_in">window</span>[<span class="string">"webpackJsonp"</span>] = <span class="built_in">window</span>[<span class="string">"webpackJsonp"</span>] || []).push([[<span class="number">0</span>],&#123;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js</span></span><br><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">"koa-router"</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>; <span class="comment">// å¿…é¡»å¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">'react-dom/server'</span>; <span class="comment">// react-domæä¾›çš„æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"../src/pages/home"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> route = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> content = renderToString(<span class="xml"><span class="tag">&lt;<span class="name">Home</span>/&gt;</span></span>);</span><br><span class="line"></span><br><span class="line">route.get(<span class="string">"/"</span>, (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body =</span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">      &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span><br><span class="line"><span class="string">      &lt;/head&gt;</span></span><br><span class="line"><span class="string">      &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;div id="root"&gt;<span class="subst">$&#123;content&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(route.routes());</span><br><span class="line">app.use(route.allowedMethods());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = app.listen(<span class="string">'9999'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;port&#125; = server.address();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<p>ä»¥ä¸Šä½¿ç”¨äº†<strong>renderToString</strong>, æˆ‘ä»¬éƒ½çŸ¥é“react-domæä¾›äº†å››ç§æœåŠ¡ç«¯æ¸²æŸ“å‡½æ•°,å¦‚ä¸‹:</p>
<ol>
<li><strong>renderToString</strong>ï¼šå°† React Component è½¬åŒ–ä¸º HTML å­—ç¬¦ä¸²ï¼Œç”Ÿæˆçš„ HTML çš„ DOM ä¼šå¸¦æœ‰é¢å¤–å±æ€§ï¼šå„ä¸ª DOM ä¼šæœ‰data-react-idå±æ€§ï¼Œç¬¬ä¸€ä¸ª DOM ä¼šæœ‰data-reactrootå±æ€§ã€‚</li>
<li><strong>renderToStaticMarkup</strong>ï¼šå°† React Component è½¬åŒ–ä¸º HTML å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”Ÿæˆ HTML çš„ DOM ä¸ä¼šæœ‰é¢å¤–å±æ€§ï¼Œä»è€ŒèŠ‚çœ HTML å­—ç¬¦ä¸²çš„å¤§å°ã€‚</li>
<li><strong>renderToNodeStream:</strong> ä»¥æµçš„å½¢å¼è¾“å‡ºhtml, ä¸ç”¨åƒrenderToStringç”Ÿæˆæ•´ä¸ªhtmlæ‰å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç›¸å¯¹äºrenderToStringèƒ½æ›´å¿«çš„å“åº”å®¢æˆ·ç«¯ï¼Œæå‡é¡µé¢æ¸²æŸ“é€Ÿåº¦ã€‚</li>
<li><strong>renderToStaticNodeStream</strong>ï¼šå’Œ renderToNodeStreamä¸€æ ·ï¼Œä¹Ÿæ˜¯è¾“å‡ºæµï¼Œä½†æ˜¯htmlä¸­ä¸å¸¦data-reactrootç­‰å±æ€§ã€‚</li>
</ol>
<p><strong>å¯¹äºæœåŠ¡ç«¯æ¸²æŸ“è€Œè¨€</strong></p>
<ul>
<li><strong>renderToString</strong>æ–¹æ³•æ¸²æŸ“çš„èŠ‚ç‚¹ä¼šå¸¦æœ‰data-react-idå±æ€§, åœ¨å‰ç«¯ react åŠ è½½å®Œæˆå, å‰ç«¯ react ä¼šè®¤è¯†ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹, ä¸ä¼šé‡æ–°æ¸²æŸ“ DOM èŠ‚ç‚¹, å‰ç«¯ react ä¼šæ¥ç®¡é¡µé¢, æ‰§è¡Œ <code>componentDidMout</code> ç»‘å®šæµè§ˆå™¨äº‹ä»¶ç­‰ è¿™äº›åœ¨æœåŠ¡ç«¯æ²¡å®Œæˆä¹Ÿä¸å¯èƒ½æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li><strong>renderToStaticMarkup</strong> æ¸²æŸ“å‡ºçš„æ˜¯ä¸å¸¦<code>data-react-id</code>çš„çº¯ html åœ¨å‰ç«¯ react åŠ è½½å®Œæˆå, ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„é¡µé¢ä¼šæŠ¹æ‰ä¹‹å‰æœåŠ¡ç«¯çš„é‡æ–°æ¸²æŸ“(å¯èƒ½é¡µé¢ä¼šé—ªä¸€ä¸‹). æ¢å¥è¯è¯´ <strong>å‰ç«¯reactå°±æ ¹æœ¬å°±ä¸è®¤è¯†ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹</strong>, render æ–¹æ³•ä¼šä½¿ç”¨ innerHTML çš„æ–¹æ³•é‡å†™ #react-target é‡Œçš„å†…å®¹</li>
</ul>
<p>åœ¨packageæ·»åŠ å¯åŠ¨é…ç½®</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"npm-run-all --parallel dev:build:server dev:start"</span>,</span><br><span class="line">    <span class="string">"dev:build:server"</span>: <span class="string">"webpack --config config/webpack.server.js --watch"</span>,</span><br><span class="line">    <span class="string">"dev:start"</span>: <span class="string">"nodemon ./bundle/bundle.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>æ‰§è¡Œ  yarn dev ,æ‰“å¼€ <a href="">http://localhost:9999/ </a>é¡µé¢ç›´æ¥åœ¨æµè§ˆä¸Šæ˜¾ç¤ºï¼Œ åˆ°æ­¤ï¼Œå°±åˆæ­¥å®ç°äº†ä¸€ä¸ªReactç»„ä»¶æ˜¯æœåŠ¡ç«¯æ¸²æŸ“,åŠ å…¥ä½ åœ¨ç»„ä»¶Homeé‡Œé¢æ·»åŠ ä¸€äº›æ–¹æ³•æˆ–è€…è°ƒå–æ¥å£ï¼Œä½ ä¼šå‘ç°è¿™äº›éƒ½æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ¥ä¸‹æ¥è¿›ä¸€æ­¥å®Œå–„ã€‚</p>
<h3 id="åŒæ„"><a href="#åŒæ„" class="headerlink" title="åŒæ„"></a>åŒæ„</h3><p>è¦è§£å†³ä¸Šé¢ä¸Šé¢çš„é—®é¢˜ï¼Œå°±éœ€è¦åŒæ„äº†ï¼Œæ‰€è°“åŒæ„ï¼Œé€šä¿—çš„è®²ï¼Œå°±æ˜¯ä¸€å¥—Reactä»£ç åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€éï¼Œåˆ°æµè§ˆå™¨æ¸²æŸ“æ—¶åœ¨è¿è¡Œä¸€éï¼ŒæœåŠ¡ç«¯æ¸²æŸ“å®Œæˆé¡µé¢ç»“æ„ï¼Œæµè§ˆå™¨ç«¯æ¸²æŸ“å®Œæˆäº‹ä»¶ç»‘å®šæ¥å£è°ƒå–ï¼ˆé‡å¤åŠ è½½çš„jsæˆ–è€…csså®¢æˆ·ç«¯åè°ƒé˜¶æ®µæ—¶å€™ä¼šè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸€æ ·åˆ™ä¸æ¸²æŸ“äº†ï¼‰ã€‚</p>
<h4 id="å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS"><a href="#å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS" class="headerlink" title="å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS"></a>å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS</h4><p>æŠŠæ‰“åŒ…åçš„js,æ³¨å…¥åˆ°htmlä¸­ï¼Œè¿™æ ·åˆ°æµè§ˆå™¨å°±ä¼šå†æ¬¡è¯·æ±‚ï¼Œå°±å¯ä»¥å®Œæˆäº‹ä»¶ç»‘å®šç­‰è¡Œä¸ºæ“ä½œã€‚</p>
<p>æˆ‘ä»¬è¦ç”¨åˆ°react-domçš„<code>hydrate</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// client/index.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;BrowserRouter <span class="keyword">as</span> Router, Switch&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;renderRoutes&#125; <span class="keyword">from</span> <span class="string">'react-router-config'</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span>; <span class="comment">// è¿™é‡Œæ˜¯æˆ‘çš„ä¸€ä¸ªè·¯ç”±æ‹†åˆ†ï¼Œä½ ä»¬å¯ä»¥ä¸ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'../router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">        &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Router&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Loadable.preloadReady().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ReactDom.hydrate(</span><br><span class="line">    &lt;App/&gt;, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>hydrate() æè¿°çš„æ˜¯ ReactDOM å¤ç”¨ ReactDOMServer æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹æ—¶å°½å¯èƒ½ä¿ç•™ç»“æ„ï¼Œå¹¶è¡¥å……äº‹ä»¶ç»‘å®šç­‰ Client ç‰¹æœ‰å†…å®¹çš„è¿‡ç¨‹</p>
<p>è¯´ç™½äº†<code>render()</code> æ ‡ç­¾ä¸Šæ²¡æœ‰å”¯ä¸€çš„å±æ€§ï¼Œä½†æ˜¯è¦å°½å¯èƒ½å¤ç”¨ ssr çš„ HTML ç»“æ„,æ‰€ä»¥å°±å‡ºç°äº†<code>hydrate()</code>,ä½†æ˜¯ç›®å‰ä¸¤è€…éƒ½æ˜¯å¯ä»¥ç”¨çš„ï¼Œ17ç‰ˆæœ¬<code>render()</code>å°±ä¸åœ¨æ”¯æŒ<code>ssr</code></p>
<p><a href="https://www.zhihu.com/question/66068748" target="_blank" rel="noopener">çŸ¥ä¹å¯¹ ReactDom.hydrate çš„è§£é‡Š</a></p>
<p>ç„¶åé…ç½®å®¢æˆ·ç«¯çš„webpackå°†å…¶ç¼–è¯‘æ‰“åŒ…æˆjsï¼Œåœ¨æœåŠ¡ç«¯htmlé‡Œé¢å¼•å…¥ã€‚</p>
<h4 id="å®¢æˆ·ç«¯-Webpack-é…ç½®"><a href="#å®¢æˆ·ç«¯-Webpack-é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯ Webpack é…ç½®"></a>å®¢æˆ·ç«¯ Webpack é…ç½®</h4><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ‰“åŒ…åçš„è¾“å‡ºç›®å½•</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/outputPath </span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  OUTPUTCLIENT: <span class="string">'static'</span>,</span><br><span class="line">  OUTPUTSERVER: <span class="string">'bundle'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.client.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.base'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;OUTPUTCLIENT&#125; = <span class="built_in">require</span>(<span class="string">"./outputPath"</span>)</span><br><span class="line"><span class="keyword">const</span> outputPath = <span class="string">`../<span class="subst">$&#123;OUTPUTCLIENT&#125;</span>`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clientConfig = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  entry: path.resolve(__dirname, <span class="string">'../client/index.js'</span>),</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'index.[chunkhash:8].js'</span>, <span class="comment">// è¿™é‡Œæˆ‘ç”¨çš„hashï¼Œç›®çš„æ˜¯é˜²æ­¢ç¼“å­˜</span></span><br><span class="line">    path: path.resolve(__dirname, outputPath),</span><br><span class="line">    publicPath: <span class="string">'/'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css?$/</span>,</span><br><span class="line">        use: [<span class="string">'style-loader'</span>, &#123;<span class="comment">// è¿™é‡Œå»ºè®®ä½¿ç”¨style-loaderï¼Œå°‘é‡çš„cssç›´æ¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“äº†</span></span><br><span class="line">          loader: <span class="string">'css-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            modules: <span class="literal">true</span>, <span class="comment">// è¿™è¦è·ŸæœåŠ¡ç«¯ä¿æŒä¸€è‡´ï¼Œä¸ç„¶headé‡Œé¢æœ‰æ ·å¼ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰å¯¹åº”çš„class</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpeg|jpg|gif|svg)?$/</span>,</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          limit: <span class="number">8000</span>,</span><br><span class="line">          outputPath: outputPath, <span class="comment">// è¾“å…¥è·¯å¾„</span></span><br><span class="line">          publicPath: <span class="string">'/'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = merge(config, clientConfig)</span><br></pre></td></tr></table></figure>


<p>ç„¶ååœ¨ä¸Šé¢çš„<code>package.json</code>,é‡Œé¢æ·»åŠ <code>&quot;dev:build:client&quot;: &quot;webpack --config webpack.client.js --watch&quot;</code>ï¼Œå°±èƒ½å¯¹æµè§ˆå™¨ç”¨åˆ°çš„ä¸€äº›jså®Œæˆæ‰“åŒ…ã€‚</p>
<h4 id="æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘"><a href="#æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘" class="headerlink" title="æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘"></a>æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘</h4><p>æœåŠ¡å™¨ç«¯è·¯ç”±ä»£ç ç›¸å¯¹è¦å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦ä½ æŠŠ <code>location</code>ï¼ˆå½“å‰è¯·æ±‚è·¯å¾„ï¼‰ä¼ é€’ç»™ <code>StaticRouter</code> ç»„ä»¶ï¼Œè¿™æ · <code>StaticRouter</code> æ‰èƒ½æ ¹æ®è·¯å¾„åˆ†æå‡ºå½“å‰æ‰€éœ€è¦çš„ç»„ä»¶æ˜¯è°ã€‚ï¼ˆPSï¼š<code>StaticRouter</code> æ˜¯ <code>React-Router</code>é’ˆå¯¹æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸“é—¨æä¾›çš„ä¸€ä¸ªè·¯ç”±ç»„ä»¶ã€‚ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js</span></span><br><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">"koa-router"</span></span><br><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">'react-dom/server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;StaticRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span>;</span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'@/router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;renderRoutes, matchRoutes&#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;renderHTML&#125; <span class="keyword">from</span> <span class="string">"./tem"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> route = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line">route.get([<span class="string">"/:route?"</span>, /\/<span class="function">(<span class="params">[\w|\d]+</span>)\/.*/], (<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> content = renderToString(</span><br><span class="line">    <span class="comment">// é‡ç‚¹æ˜¯è¿™</span></span><br><span class="line">    &lt;StaticRouter location=&#123;ctx.path&#125;&gt;</span><br><span class="line">        &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">    &lt;<span class="regexp">/StaticRouter&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">  ctx.body = renderHTML(content, &#123;&#125;)</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ è¿™é‡Œè¦æ³¨æ„ä¸‹ä¸­é—´ä»¶çš„å…ˆåé¡ºåº</span></span><br><span class="line"><span class="regexp">app.use(require('koa-static')(process.cwd() + '/</span><span class="keyword">static</span><span class="string">'));</span></span><br><span class="line"><span class="string">app.use(route.routes());</span></span><br><span class="line"><span class="string">app.use(route.allowedMethods());</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Loadable.preloadAll().then(() =&gt; &#123;</span></span><br><span class="line"><span class="string">  const server = app.listen('</span><span class="number">9999</span><span class="string">', () =&gt; &#123;</span></span><br><span class="line"><span class="string">    const &#123;port&#125; = server.address();</span></span><br><span class="line"><span class="string">    console.log(`\x1B[33m\x1B[4mhttp://localhost:$&#123;port&#125;\x1B[0m`)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/tem.js</span></span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>);</span><br><span class="line"><span class="keyword">let</span> project = glob.sync(process.cwd() + <span class="string">'/static/index.*.js'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> path = project[<span class="number">0</span>].split(<span class="string">'/'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> renderHTML = <span class="function">(<span class="params">content, store</span>) =&gt;</span> <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">    &lt;html lang="zh"&gt;</span></span><br><span class="line"><span class="string">      &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;meta charset="utf-8"&gt;</span></span><br><span class="line"><span class="string">        &lt;meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" /&gt;</span></span><br><span class="line"><span class="string">        &lt;meta name="theme-color" content="#000000"&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span><br><span class="line"><span class="string">      &lt;/head&gt;</span></span><br><span class="line"><span class="string">      &lt;body&gt;</span></span><br><span class="line"><span class="string">      &lt;div id="root"&gt;<span class="subst">$&#123;content&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;script src=/<span class="subst">$&#123;path[path.length - <span class="number">1</span>]&#125;</span>&gt;&lt;/script&gt; // è¿™ä¸ª '/' ä¸€å®šè¦æ·»åŠ ï¼Œå‘äº†å¥½ä¹…</span></span><br><span class="line"><span class="string">      &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/html&gt;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>

<h3 id="CSSæ ·å¼é—®é¢˜å¤„ç†"><a href="#CSSæ ·å¼é—®é¢˜å¤„ç†" class="headerlink" title="CSSæ ·å¼é—®é¢˜å¤„ç†"></a>CSSæ ·å¼é—®é¢˜å¤„ç†</h3><p>æ­£å¸¸çš„æœåŠ¡ç«¯æ¸²æŸ“åªæ˜¯è¿”å›äº† HTML å­—ç¬¦ä¸²ï¼Œæ ·å¼éœ€è¦æµè§ˆå™¨åŠ è½½å®Œ CSS åæ‰ä¼šåŠ ä¸Šï¼Œè¿™ä¸ªæ ·å¼æ·»åŠ çš„è¿‡ç¨‹å°±<code>ä¼šé€ æˆé¡µé¢çš„é—ªåŠ¨</code>ï¼Œæ‰€ä»¥åœ¨æœåŠ¡ç«¯é‡Œé¢ç›´æ¥æ·»åŠ éœ€è¦å¼•ç”¨çš„CSSã€‚</p>
<p>æˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨ style-loader äº†ï¼Œå› ä¸ºè¿™ä¸ª webpack loader ä¼šåœ¨ç¼–è¯‘æ—¶å°†æ ·å¼æ¨¡å—è½½å…¥åˆ° HTML header ä¸­ã€‚ä½†æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“ç¯å¢ƒä¸‹ï¼Œæ²¡æœ‰ window å¯¹è±¡ï¼Œstyle-loader è¿›è€Œä¼šæŠ¥é”™ã€‚ä¸€èˆ¬æˆ‘ä»¬æ¢ç”¨ <code>isomorphic-style-loader</code> ,åŒæ—¶ <code>isomorphic-style-loader</code>ä¹Ÿä¼šè§£å†³é¡µé¢æ ·å¼é—ªåŠ¨çš„é—®é¢˜ï¼Œå®ƒçš„åŸç†ä¹Ÿä¸éš¾ç†è§£ï¼š<code>isomorphic-style-loader</code>åˆ©ç”¨ context APIï¼Œåœ¨æ¸²æŸ“é¡µé¢ç»„ä»¶æ—¶è·å–æ‰€æœ‰ React ç»„ä»¶çš„æ ·å¼ä¿¡æ¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯è¾“å‡º html å­—ç¬¦ä¸²çš„åŒæ—¶ï¼Œä¹Ÿå°†æ ·å¼æ’å…¥åˆ° html å­—ç¬¦ä¸²å½“ä¸­ï¼Œå°†ç»“æœä¸€åŒä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬å·²ç»å¼€å¯äº†cssmodulesï¼Œæ‰€ä»¥ç›´æ¥å¯¼å…¥åˆ°headé‡Œé¢æ˜¯ä¸ä¼šå­˜åœ¨æ ·å¼å†²çªçš„é—®é¢˜ã€‚<code>isomorphic-style-loader</code>å·²ç»ç»™æˆ‘ä»¬æä¾›äº†ä¸€äº›å¯¼å…¥css çš„ é«˜é˜¶å‡½æ•° <code>withsSyles</code></p>
<p>å’Œ hooks <code>useStyles</code>ï¼Œç”¨çš„æ—¶å€™æ¯”è¾ƒçœäº‹ã€‚</p>
<p><strong>çœ‹ä¸‹ä»£ç é…ç½®</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.client.js</span></span><br><span class="line">&#123;</span><br><span class="line">  test: [<span class="regexp">/\.css|less$/</span>],</span><br><span class="line">    use: [</span><br><span class="line">      <span class="string">'style-loader'</span>, <span class="comment">// ä¹Ÿå¯ä»¥è·ŸæœåŠ¡ç«¯çš„ä¸€æ ·ï¼Œå°±æ˜¯éº»çƒ¦ç‚¹ï¼Œæ¯æ¬¡ä½¿ç”¨css,éƒ½éœ€è¦é¢å¤–çš„æ‰‹ç»­</span></span><br><span class="line">      &#123;</span><br><span class="line">        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          modules: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'less-loader'</span>,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.server.js</span></span><br><span class="line">&#123;</span><br><span class="line">  test: [<span class="regexp">/\.css|less$/</span>],</span><br><span class="line">    use: [</span><br><span class="line">      <span class="string">'isomorphic-style-loader'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          modules: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'less-loader'</span>  <span class="comment">// å¿…é¡»é…ç½® ä¸ç„¶ä¼šå½“æˆcss,è§†è§‰å¯èƒ½çœ‹ä¸å‡ºæ¥ï¼Œå› ä¸ºå®¢æˆ·ç«¯é…ç½®äº†less</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>æœåŠ¡ç«¯é¦–é¡µ</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js </span></span><br><span class="line"><span class="comment">//  ...</span></span><br><span class="line"><span class="keyword">const</span> css = <span class="keyword">new</span> <span class="built_in">Set</span>() <span class="comment">// è¿™ä¸ªå¿…é¡»åœ¨è·¯ç”±å‡½æ•°é‡Œé¢ï¼Œåœ¨å¤–é¢çš„è¯ï¼Œå°±ä¼šç´¯åŠ å‡ºç°ä¹‹å‰çš„css</span></span><br><span class="line"><span class="keyword">const</span> insertCss = <span class="function">(<span class="params">...styles</span>) =&gt;</span> styles.forEach(<span class="function"><span class="params">style</span> =&gt;</span> css.add(style._getCss()));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> content = renderToString(</span><br><span class="line">  &lt;StaticRouter location=&#123;ctx.path&#125;&gt;</span><br><span class="line">        &lt;StyleContext.Provider value=&#123;&#123;insertCss&#125;&#125;&gt; </span><br><span class="line">           &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">      &lt;<span class="regexp">/StyleContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">   &lt;/</span>StaticRouter&gt;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">ctx.body = renderHTML(content, &#123;&#125;, css)</span><br><span class="line"><span class="comment">// ....</span></span><br></pre></td></tr></table></figure>


<p><strong>å®¢æˆ·ç«¯ä¹Ÿéœ€è¦é…ç½®</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// client/index.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;BrowserRouter <span class="keyword">as</span> Router&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;renderRoutes&#125; <span class="keyword">from</span> <span class="string">'react-router-config'</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span>;</span><br><span class="line"><span class="keyword">import</span> StyleContext <span class="keyword">from</span> <span class="string">'isomorphic-style-loader/StyleContext'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'../router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> insertCss = <span class="function">(<span class="params">...styles</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> removeCss = styles.map(<span class="function"><span class="params">style</span> =&gt;</span> style._insertCss &amp;&amp; style._insertCss());</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> removeCss.forEach(<span class="function"><span class="params">dispose</span> =&gt;</span> dispose &amp;&amp; dispose())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">        &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">    &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Loadable.preloadReady().then(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  ReactDom.hydrate(</span></span><br><span class="line"><span class="regexp">    &lt;StyleContext.Provider value=&#123;&#123;insertCss&#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;App/</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/StyleContext.Provider&gt;, document.getElementById('root'));</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure>


<p>è¿™æ ·æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨<code>isomorphic-style-loader</code>çš„ä¸€äº›API, <strong>æœ‰äº›<code>ä¸é‡è¦</code>çš„é¡µé¢ï¼Œæˆ–è€…ä¸é‡è¦çš„csså¯ä»¥ç›´æ¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</strong>,å°±ä¸éœ€è¦å¼•å…¥é«˜é˜¶å‡½æ•°æˆ–è€…useStylesã€‚</p>
<p>åœ¨é¡µé¢å†…å…·ä½“ä½¿ç”¨</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°å¼ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> useStyles <span class="keyword">from</span> <span class="string">'isomorphic-style-loader/useStyles'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">"./index.css"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  useStyles(styles)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç±»ç»„ä»¶ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> withStyles <span class="keyword">from</span> <span class="string">'isomorphic-style-loader/withStyles'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">"./index.css"</span></span><br><span class="line">@withStyles(styles) <span class="comment">// éœ€è¦åœ¨baseé‡Œé¢é¢å¤–é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">"./index.css"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨useStyles éƒ¨åˆ†ä½¿ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1 className=&#123;styles[<span class="string">'title-center'</span>]&#125;&gt;message&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h1 className=&#123;'title-center'&#125;&gt;message&lt;/</span>h1&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>


<p>ç„¶åæ‰“å¼€ç½‘é¡µçš„æºä»£ç å°±å¯ä»¥çœ‹è§headé‡Œé¢å·²ç»æœ‰æˆ‘ä»¬éœ€è¦çš„cssäº†ã€‚</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://user-gold-cdn.xitu.io/2020/7/23/1737b44ea25a4b63?w=1251&h=881&f=png&s=177846" alt="image-20200702185101916"></p>
<h3 id="SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å–-Dvaçš„ä½¿ç”¨"><a href="#SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å–-Dvaçš„ä½¿ç”¨" class="headerlink" title="SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨"></a>SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨</h3><h4 id="Dvaçš„ä½¿ç”¨"><a href="#Dvaçš„ä½¿ç”¨" class="headerlink" title="Dvaçš„ä½¿ç”¨"></a>Dvaçš„ä½¿ç”¨</h4><p>ä¹‹å‰é¡¹ç›®ä¸€ç›´ç”¨çš„dvaï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨çš„dva-coreä»£æ›¿çš„reduxï¼Œä¸ä¼šé…ç½®çš„è‡ªè¡ŒæŸ¥ä¸‹æ–‡æ¡£ã€‚</p>
<p>åˆ›å»º <code>Store</code>ï¼šè¿™ä¸€éƒ¨åˆ†æœ‰å‘ï¼Œè¦æ³¨æ„é¿å…ï¼Œå¤§å®¶çŸ¥é“ï¼Œåœ¨å®¢æˆ·ç«¯æ¸²æŸ“ä¸­ï¼Œç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ°¸è¿œåªå­˜åœ¨ä¸€ä¸ª <code>Store</code>ï¼Œæ‰€ä»¥ä»£ç ä¸Šä½ å¯ä»¥è¿™ä¹ˆå†™</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dvaApp = createApp(&#123;</span><br><span class="line">  initialState: &#123;&#125;,</span><br><span class="line">  models: models,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> store = dvaApp.getStore();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>ç„¶è€Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿™ä¹ˆå†™å°±æœ‰é—®é¢˜äº†ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯çš„ <code>Store</code> æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½è¦ç”¨çš„ï¼Œå¦‚æœåƒä¸Šé¢è¿™æ ·æ„å»º <code>Store</code>ï¼Œ<code>Store</code> å˜æˆäº†ä¸€ä¸ªå•ä¾‹ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº« <code>Store</code>ï¼Œæ˜¾ç„¶å°±æœ‰é—®é¢˜äº†ã€‚æ‰€ä»¥åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸­ï¼Œ<code>Store</code> çš„åˆ›å»ºåº”è¯¥iåƒä¸‹é¢è¿™æ ·ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ¯ä¸ªç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä¸ºæ¯ä¸ªç”¨æˆ·æä¾›ä¸€ä¸ªç‹¬ç«‹çš„ <code>Store</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dvaApp = createApp(&#123;</span><br><span class="line">  initialState: &#123;&#125;,</span><br><span class="line">  models: models,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStore =  <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> dvaApp.getStore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åˆ«æ…Œï¼Œä½ å¦‚æœè¿™æ ·çš„åšçš„è¯ï¼Œreduxçš„æ•°æ®è¿˜æ˜¯æ‰€æœ‰å®¢æˆ·åŒæ­¥å…¬ç”¨ï¼Œå› ä¸ºä½ çš„modelæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯é™æ€å¯¼å…¥ï¼Œè¿™ä¸ªæ—¶å€™ä½ åº”è¯¥æŠŠmodelå†™æˆå‡½æ•°çš„å½¢å¼ï¼Œè¿™æ ·åå°æ¯æ¬¡éƒ½èƒ½è·å–åˆ°æœ€æ–°çš„æ•°æ®</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> menuTree = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    namespace: <span class="string">'menuTree'</span>,</span><br><span class="line">    state: &#123;</span><br><span class="line">      routes: []</span><br><span class="line">    &#125;,</span><br><span class="line">    effects: &#123;</span><br><span class="line">      * reset(payload, &#123;call, put, select, update&#125;) &#123;</span><br><span class="line">         <span class="comment">// .........</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    reducers: &#123;</span><br><span class="line">      save(state, &#123;payload&#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;...state, ...payload&#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> menuTree</span><br></pre></td></tr></table></figure>

<p>æ¢æˆå‡½æ•°çš„å¯¼å‡ºå½¢å¼å°±OKäº†ï¼Œç„¶ååœ¨createAppçš„æ–¹æ³•ï¼ŒåŸæœ‰çš„<code>models.forEach(model =&gt; app.model(model);</code>è½¬æ¢æˆ <code>models.forEach(model =&gt; app.model(model()));</code> å°±OKäº†ã€‚</p>
<h4 id="æ•°æ®è·å–"><a href="#æ•°æ®è·å–" class="headerlink" title="æ•°æ®è·å–"></a>æ•°æ®è·å–</h4><p>æ•°æ®è·å–çš„è§£å†³æ–¹æ¡ˆæ˜¯é…ç½®è·¯ç”± route-router-configï¼Œç»“åˆ <code>matchRoutes</code>ï¼Œæ‰¾åˆ°é¡µé¢ä¸Šç›¸å…³ç»„ä»¶æ‰€éœ€çš„è¯·æ±‚æ¥å£çš„æ–¹æ³•å¹¶æ‰§è¡Œè¯·æ±‚ï¼Œè¿™å°±è¦æ±‚å¼€å‘è€…é€šè¿‡è·¯ç”±é…ç½®ä¿¡æ¯ï¼Œæ˜¾å¼åœ°å‘ŠçŸ¥æœåŠ¡ç«¯è¯·æ±‚å†…å®¹ã€‚</p>
<p><strong>å®¢æˆ·ç«¯è·¯ç”±æ”¹é€ </strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router/index.js</span></span><br><span class="line">&#123;</span><br><span class="line">  path: <span class="string">'/login'</span>,</span><br><span class="line">  exact: <span class="literal">true</span>,</span><br><span class="line">  component: Login,</span><br><span class="line">  loadData: Login.loadData, <span class="comment">// è¿™é‡Œå°±æ˜¯è¯·æ±‚æ•°æ®çš„æ–¹æ³•</span></span><br><span class="line">  title: <span class="string">'ç™»å½•é¡µ'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Index.loadData = <span class="keyword">async</span> (store) =&gt; &#123;</span><br><span class="line">  store.dispatch(&#123;</span><br><span class="line">    type: <span class="string">"menuTree/reset"</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'æˆ‘è¯•è¯•è¿™ä¸ªåˆ°åº•åŠ è½½ä¸'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index</span><br></pre></td></tr></table></figure>


<p><strong>æœåŠ¡ç«¯ä»£ç </strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–è¯·æ±‚çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> promises = [];</span><br><span class="line"></span><br><span class="line">matchedRoutes.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (item.route.loadData) &#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œç”¨äº†.then æ‰€ä»¥ç»„ä»¶é‡Œé¢å¿…é¡»ä½¿ç”¨asyncæˆ–è€…promise</span></span><br><span class="line">      item.route.loadData(store).then(resolve).catch(reject)</span><br><span class="line">    &#125;)</span><br><span class="line">    promises.push(promise);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜ï¼Œä½ çš„æ–¹æ³•å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¼šå‡ºç° ctx.body æ²¡æœ‰æ‰§è¡Œçš„é—®é¢˜ï¼Œæ‰€ä»¥è¦æŠŠè¿™ä¸ªä¸­é—´ä»¶è®¾ç½®ä¸ºå¼‚æ­¥çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºäº†ç¡®ä¿ç»„ä»¶çš„loadDataçš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line"><span class="keyword">await</span> <span class="built_in">Promise</span>.all(promises).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> css = <span class="keyword">new</span> <span class="built_in">Set</span>(); <span class="comment">// é˜²æ­¢é’©å­å‡½æ•°æ‰§è¡Œä¸¤æ¬¡</span></span><br><span class="line">  <span class="keyword">const</span> insertCss = <span class="function">(<span class="params">...styles</span>) =&gt;</span> styles.forEach(<span class="function"><span class="params">style</span> =&gt;</span> css.add(style._getCss()));</span><br><span class="line">  <span class="keyword">const</span> helmet = Helmet.renderStatic();</span><br><span class="line">  <span class="keyword">const</span> content = renderToString(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;StaticRouter location=&#123;ctx.path&#125;&gt;</span><br><span class="line">          &lt;StyleContext.Provider value=&#123;&#123;insertCss&#125;&#125;&gt;</span><br><span class="line">            &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">          &lt;<span class="regexp">/StyleContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>StaticRouter&gt;</span><br><span class="line">      &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">     )</span></span><br><span class="line"><span class="regexp">     ctx.body = renderHTML(content, store, css, helmet)</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure>


<h4 id="æ³¨æ°´å’Œè„±æ°´"><a href="#æ³¨æ°´å’Œè„±æ°´" class="headerlink" title="æ³¨æ°´å’Œè„±æ°´"></a>æ³¨æ°´å’Œè„±æ°´</h4><p><strong>æ¶‰åŠåˆ°æ•°æ®çš„é¢„è·å–ï¼Œä¹Ÿæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„çœŸæ­£æ„ä¹‰ã€‚</strong></p>
<p>ä¸Šé¢çš„ä»£ç æ­£å¸¸è¿è¡Œæ˜¯æ²¡é—®é¢˜äº†ï¼Œä½†æ˜¯å‘ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„storeï¼Œå­˜åœ¨ä¸åŒæ­¥çš„é—®é¢˜ã€‚</p>
<p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å½“æœåŠ¡ç«¯æ‹¿åˆ°storeå¹¶è·å–æ•°æ®åï¼Œå®¢æˆ·ç«¯çš„jsä»£ç åˆæ‰§è¡Œä¸€éï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç æ‰§è¡Œçš„æ—¶å€™åˆåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„storeï¼Œä¸¤ä¸ªstoreçš„æ•°æ®ä¸èƒ½åŒæ­¥ã€‚</p>
<p>æ‰€ä»¥ åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ï¼Œé¦–å…ˆæœåŠ¡ç«¯è¯·æ±‚æ¥å£æ‹¿åˆ°æ•°æ®ï¼Œå¹¶å¤„ç†å‡†å¤‡å¥½æ•°æ®çŠ¶æ€ï¼ˆå¦‚æœä½¿ç”¨ Reduxï¼Œå°±æ˜¯è¿›è¡Œ store çš„æ›´æ–°ï¼‰ï¼Œä¸ºäº†å‡å°‘å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™ä½è¿™ä¸ªçŠ¶æ€ã€‚ä¸€èˆ¬åšæ³•æ˜¯åœ¨æœåŠ¡å™¨ç«¯è¿”å› HTML å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå°†æ•°æ® JSON.stringify ä¸€å¹¶è¿”å›ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå«åšæ³¨æ°´ï¼›åœ¨å®¢æˆ·ç«¯ï¼Œå°±ä¸å†éœ€è¦è¿›è¡Œæ•°æ®çš„è¯·æ±‚äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœåŠ¡ç«¯ä¸‹å‘ä¸‹æ¥çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«è„±æ°´ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="built_in">window</span>.context = &#123;</span><br><span class="line">   <span class="comment">// è¿™é‡Œæ˜¯æ³¨æ°´</span></span><br><span class="line">   state: $&#123;serialize(store.getState())&#125;  <span class="comment">// serialize æ˜¯ä¸ºäº†é˜²æ­¢xssçš„æ”»å‡»</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;create&#125; <span class="keyword">from</span> <span class="string">'dva-core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createApp</span>(<span class="params">opt</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// .....</span></span><br><span class="line">  <span class="keyword">return</span> app;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœåŠ¡ç«¯çš„redux</span></span><br><span class="line"><span class="keyword">const</span> dvaApp = createApp(&#123;</span><br><span class="line">  initialState: &#123;&#125;,</span><br><span class="line">  models: models,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> dvaApp.getStore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯çš„redux</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getClientStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// éœ€è¦å…ˆæ‹¿åˆ°æœåŠ¡ç«¯çš„æ•°æ®, è„±æ°´</span></span><br><span class="line">  <span class="keyword">const</span> initialState = <span class="built_in">window</span>.context ? <span class="built_in">window</span>.context.state : &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> dvaClientApp = createApp(&#123;</span><br><span class="line">    initialState,</span><br><span class="line">    models: models,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dvaClientApp.getStore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="é…ç½®ä»£ç†"><a href="#é…ç½®ä»£ç†" class="headerlink" title="é…ç½®ä»£ç†"></a>é…ç½®ä»£ç†</h4><p>æœåŠ¡ç«¯æ˜¯æ²¡æœ‰åŸŸçš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨å®¢æˆ·ç«¯è°ƒå–æ¥å£è¿˜å­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œæ‰€ä»¥è¿˜éœ€è¦é…ç½®ä¸‹ä»£ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> httpProxy <span class="keyword">from</span> <span class="string">'http-proxy-middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> k2c <span class="keyword">from</span> <span class="string">"koa2-connect"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬å‘ä»£ç†</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.url.startsWith(<span class="string">'/api'</span>)) &#123; <span class="comment">//åŒ¹é…æœ‰apiå­—æ®µçš„è¯·æ±‚url</span></span><br><span class="line">    ctx.respond = <span class="literal">false</span> <span class="comment">// ç»•è¿‡koaå†…ç½®å¯¹è±¡response ï¼Œå†™å…¥åŸå§‹reså¯¹è±¡ï¼Œè€Œä¸æ˜¯koaå¤„ç†è¿‡çš„response</span></span><br><span class="line">    <span class="keyword">await</span> k2c(httpProxy(&#123;</span><br><span class="line">        target: <span class="string">'https://api.xxxxx.xxx'</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        secure: <span class="literal">false</span>,</span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          <span class="string">'^/api'</span>: <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ))(ctx, next);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<p>è¿˜å¯ä»¥å®‰è£…koaçš„ä»£ç†æ¨¡å— <code>koa2-proxy-middleware</code>,ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">'koa2-proxy-middleware'</span>);</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  targets: &#123;</span><br><span class="line">    <span class="string">'/user'</span>: &#123;</span><br><span class="line">      <span class="comment">// this is option of http-proxy-middleware</span></span><br><span class="line">      target: <span class="string">'http://localhost:3001'</span>, <span class="comment">// target host</span></span><br><span class="line">      changeOrigin: <span class="literal">true</span>, <span class="comment">// needed for virtual hosted sites</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'/user/:id'</span>: &#123;</span><br><span class="line">      target: <span class="string">'http://localhost:3001'</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'/api/*'</span>: &#123;</span><br><span class="line">      target: <span class="string">'http://localhost:3001'</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123;</span><br><span class="line">        <span class="string">'/passager/xx'</span>: <span class="string">'/mPassenger/ee'</span>, <span class="comment">// rewrite path</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">app.use(proxy(options));</span><br></pre></td></tr></table></figure>

<p>æºç ä¹Ÿæ²¡å‡ è¡Œï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹  <a href="https://github.com/sunyongjian/koa2-proxy-middleware/blob/master/lib/index.js" target="_blank" rel="noopener">koa2-proxy-middleware</a></p>
<h3 id="å¼•å…¥react-helmet"><a href="#å¼•å…¥react-helmet" class="headerlink" title="å¼•å…¥react-helmet"></a>å¼•å…¥react-helmet</h3><p>åšæ›´å®Œæ•´çš„SEO</p>
<p>App ç»„ä»¶åµŒå…¥åˆ° <code>document.getElementById(&#39;root&#39;)</code> èŠ‚ç‚¹å½“ä¸­ï¼Œä¸€èˆ¬æ˜¯ä¸åŒ…å« head æ ‡ç­¾çš„ï¼Œä½†æ˜¯å•é¡µåº”ç”¨åœ¨åˆ‡æ¢è·¯ç”±æ—¶ï¼Œå¯èƒ½ä¹Ÿä¼šéœ€è¦åŠ¨æ€ä¿®æ”¹ head æ ‡ç­¾ä¿¡æ¯ï¼Œæ¯”å¦‚ title å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šåœ¨å•é¡µé¢åº”ç”¨åˆ‡æ¢é¡µé¢ï¼Œä¸ä¼šç»è¿‡æœåŠ¡ç«¯æ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦æ›´æ”¹ document çš„ title å†…å®¹ã€‚</p>
<p>å¦‚æœç›´æ¥æ”¹å®¢æˆ·ç«¯çš„title,ç›´æ¥å°±å¯ä»¥ä½¿ç”¨<code>document.title</code>,ä½†æ˜¯æˆ‘ä»¬ç°åœ¨è¦æŠŠSEOåšå¥½ï¼Œç„¶åæˆ‘ä»¬è¦æ›´æ”¹æœåŠ¡ç«¯headé‡Œé¢çš„meta titleç­‰å†…å®¹,è¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°  <a href="https://github.com/nfl/react-helmet" target="_blank" rel="noopener">react-helmet</a>ã€‚</p>
<p>å…·ä½“ä»£ç éå¸¸ç®€å•</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯å®ç°æ–¹å¼</span></span><br><span class="line"><span class="keyword">import</span> React, &#123;Component, Fragment&#125; <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> &#123;Helmet&#125; <span class="keyword">from</span> <span class="string">"react-helmet"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Fragment&gt;</span><br><span class="line">        &lt;Helmet&gt;</span><br><span class="line">          &lt;title&gt;è¿™æ˜¯loginé¡µ&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">          &lt;meta name="description" content="è¿™é‡Œæ˜¯ç¦¾å£å’Œreact-ssrçš„è°ƒç ”"/</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/Helmet&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Fragment&gt;</span><br><span class="line">     )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯å®ç°</span></span><br><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">"koa-router"</span></span><br><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">'react-dom/server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;StaticRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Helmet&#125; <span class="keyword">from</span> <span class="string">'react-helmet'</span>; <span class="comment">// è¿™é‡Œå¼•å…¥</span></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> route = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line">route.get([<span class="string">"/:route?"</span>, /\/<span class="function">(<span class="params">[\w|\d]+</span>)\/.*/], (<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">  <span class="keyword">const</span> helmet = Helmet.renderStatic(); <span class="comment">// è¿™é‡Œè·å–ä¸‹å½“å‰çš„headä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> content = renderToString(</span><br><span class="line">    &lt;StaticRouter location=&#123;ctx.path&#125;&gt;</span><br><span class="line">      &lt;StyleContext.Provider value=&#123;&#123;insertCss&#125;&#125;&gt;</span><br><span class="line">        &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">      &lt;<span class="regexp">/StyleContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>StaticRouter&gt;</span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  ctx.body = <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">      &lt;html lang="zh-Hans-CN"&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">          &lt;meta charset="utf-8"&gt;</span></span><br><span class="line"><span class="string">          <span class="subst">$&#123;helmet.title.toString()&#125;</span></span></span><br><span class="line"><span class="string">          <span class="subst">$&#123;helmet.meta.toString()&#125;</span></span></span><br><span class="line"><span class="string">          &lt;link rel="shortcut icon" href="/favicon.ico"&gt;</span></span><br><span class="line"><span class="string">          &lt;style&gt;<span class="subst">$&#123;[...css].join(<span class="string">''</span>)&#125;</span>&lt;/style&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">          &lt;div id="root"&gt;<span class="subst">$&#123;content&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">          &lt;script src=/index.js&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ...  ...</span></span><br></pre></td></tr></table></figure>


<h3 id="è¯·æ±‚tokenå¤„ç†"><a href="#è¯·æ±‚tokenå¤„ç†" class="headerlink" title="è¯·æ±‚tokenå¤„ç†"></a>è¯·æ±‚tokenå¤„ç†</h3><p>å®¢æˆ·ç«¯ç™»å½•çš„æ—¶å€™ï¼ŒæŠŠç™»å½•çš„tokenï¼Œæ”¾åˆ°æµè§ˆå™¨çš„cookieä¸­å¹¶ä¸”å­˜åˆ°reduxä¸€ä»½ï¼Œcookieåœ¨æœåŠ¡ç«¯å¯ä»¥é€šè¿‡è¯·æ±‚çš„é¡µé¢ç›´æ¥è·å–åˆ°ï¼›æ‰€ä»¥å½“ç”¨æˆ·åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡é¡µé¢è¯·æ±‚è·å–åˆ°token,ç„¶åå‘reduxé‡Œé¢å­˜æ”¾ä¸€ä»½ï¼Œè¿™æ ·å®¢æˆ·ç«¯æƒ³è¦è·å–tokenå°±å¯ä»¥ç›´æ¥åœ¨reduxé‡Œé¢æ‹¿äº†ï¼ŒloadDateå‡½æ•°å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ è¿›è·å–ã€‚</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hab97bac5556440f787abf0ecde0a0f349.jpg" alt=""></p>
<h3 id="404é¡µé¢"><a href="#404é¡µé¢" class="headerlink" title="404é¡µé¢"></a>404é¡µé¢</h3><p>ç”¨<code>react-router-config</code>çš„<code>matchRoutes</code>æ–¹æ³•ï¼Œå½“æ•è·ä¸ºç©ºæ•°ç»„çš„æ—¶å€™ï¼Œè¯´æ˜æ²¡æœ‰å½“å‰è·¯ç”±ï¼Œè·³è½¬åˆ°404 é¡µé¢ï¼Œè¿™é‡Œé¢æœ‰ä¸€ä¸ªæ³¨æ„çš„ç‚¹æ˜¯ï¼Œå¦‚è¯´æœ‰äºŒçº§æˆ–äºŒçº§ä»¥ä¸Šçš„è·¯ç”±ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½æ•è·ç¬¬ä¸€ä¸ªè·¯ç”±çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¦åˆ¤æ–­å½“å‰è·å–åˆ°çš„æ˜¯ä¸æ˜¯ä¸€çº§è·¯ç”±ï¼Œè€Œä¸”å½“å‰æ•°æ®è¿˜ä¸èƒ½ä¸ºç©ºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js  </span></span><br><span class="line"><span class="comment">// åˆ¤æ–­404</span></span><br><span class="line"><span class="keyword">let</span> hasRoute = matchedRoutes.length === <span class="number">1</span> &amp;&amp; !!matchedRoutes[<span class="number">0</span>].route.routes</span><br><span class="line"><span class="keyword">if</span> (hasRoute || !matchedRoutes.length) &#123;</span><br><span class="line">  ctx.response.redirect(<span class="string">'/404'</span>);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ·»åŠ  â€˜/â€™ é‡å®šå‘æ˜¯ä¸€æ ·çš„å¥—è·¯</span></span><br></pre></td></tr></table></figure>


<h3 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h3><p>å®‰å…¨é—®é¢˜éå¸¸å…³é”®ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå¼€å‘è€…è¦æ ¼å¤–å°å¿ƒã€‚è¿™é‡Œæå‡ºä¸€ä¸ªç‚¹ï¼šæˆ‘ä»¬å‰é¢æåˆ°äº†æ³¨æ°´å’Œè„±æ°´è¿‡ç¨‹ï¼Œå…¶ä¸­çš„ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">window</span>.context = &#123;</span><br><span class="line">    initialState: $&#123;<span class="built_in">JSON</span>.stringify(store.getState())&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>éå¸¸å®¹æ˜“é­å— XSS æ”»å‡»ï¼ŒJSON.stringify å¯èƒ½ä¼šé€ æˆ script æ³¨å…¥,ä½¿ç”¨ serialize-javascript åº“è¿›è¡Œå¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯åŒæ„åº”ç”¨ä¸­æœ€å®¹æ˜“è¢«å¿½è§†çš„ç»†èŠ‚ã€‚</p>
<p><strong>å¦ä¸€ä¸ªè§„é¿è¿™ç§ XSS é£é™©çš„åšæ³•æ˜¯</strong>ï¼šå°†æ•°æ®ä¼ é€’ä¸ªé¡µé¢ä¸­ä¸€ä¸ªéšè—çš„ textarea çš„ value ä¸­ï¼Œtextarea çš„ value è‡ªç„¶å°±ä¸æ€• XSS é£é™©äº†ã€‚</p>
<h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><ol>
<li>å®¢æˆ·ç«¯jsæ‹†åŒ…ï¼Œå‹ç¼©ä»£ç </li>
<li>å®¢æˆ·ç«¯æ‰“åŒ…çš„jså¸¦æœ‰hashåç¼€</li>
<li>ä½¿ç”¨copy-webpack-pluginï¼Œç›´æ¥æŠŠéœ€è¦çš„æ–‡ä»¶ï¼Œæ‰“åŒ…åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ã€‚</li>
<li>ä¸­é—´ä»¶è½¬å‘ä»£ç† è·¨åŸŸç­‰</li>
<li>é™æ€èµ„æºä½¿ç”¨cdn</li>
<li>æœåŠ¡ç«¯ä½¿ç”¨ç¼“å­˜</li>
<li>å¯¹æœåŠ¡ç«¯å‹åŠ›è¿‡å¤§çš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°å®¢æˆ·ç«¯æ¸²æŸ“</li>
<li>nodeJs/ReactJsçš„ç‰ˆæœ¬å‡çº§</li>
</ol>
<h3 id="é‡åˆ°çš„é—®é¢˜æ±‡æ€»"><a href="#é‡åˆ°çš„é—®é¢˜æ±‡æ€»" class="headerlink" title="é‡åˆ°çš„é—®é¢˜æ±‡æ€»"></a>é‡åˆ°çš„é—®é¢˜æ±‡æ€»</h3><ol>
<li><p>äºŒçº§èœå•çš„æ—¶å€™è·å–åˆ°é™æ€èµ„æºçš„è·¯å¾„ï¼Œå¸¦ç€ç¬¬ä¸€çº§èœå•çš„è·¯å¾„</p>
</li>
<li><p>æœåŠ¡ç«¯å¯¼å…¥css çš„æ—¶å€™ï¼Œcssæ˜¯æœ‰åšhash å¤„ç†ä¸èƒ½æ­£ç¡®çš„åŠ è½½css (cssmodules)</p>
</li>
<li><p>æœåŠ¡ç«¯å¯¼å…¥cssæ—¶å‘ç”Ÿåœ¨componentWillMountå‘¨æœŸå‡½æ•°ï¼Œä¸èƒ½åœ¨componentDidMount,æ­¤æ—¶å·²ç»åˆ°å®¢æˆ·ç«¯äº†ã€‚</p>
</li>
<li><p>koaçš„è·¯ç”±ä¸åƒexpressé‚£æ ·ä¸èƒ½ç›´æ¥ä½¿ç”¨ ***** ï¼Œ ï¼ˆå¯èƒ½å¯ä»¥ï¼Œåœ¨æˆ‘è¿™æŠ¥é”™ï¼‰</p>
</li>
<li><p>ä¸­é—´ä»¶çš„é¡ºåºã€å’Œå¼‚æ­¥æ—¶ ctx.body=â€™â€™ çš„é—®é¢˜ï¼ˆå¦‚æœæœ‰å¼‚æ­¥æ“ä½œä¸­é—´ä»¶å°±å¿…é¡»å†™æˆ async å‡½æ•°ï¼‰</p>
</li>
<li><p>react-helmet ä½¿ç”¨æ—¶ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰æ˜¾ç¤ºè®¾ç½®çš„titleç­‰ä¿¡æ¯  ï¼ˆåœ¨æœ€å¤–å±‚å¯¼å…¥ï¼‰</p>
</li>
<li><p>æ³¨æ°´çš„æ—¶å€™ï¼Œæ³¨æ„reduxå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒºåˆ«å’Œè”ç³»</p>
</li>
<li><p>æ³¨æ°´å¼‚æ­¥åŠ è½½çš„é—®é¢˜  promise.all()</p>
</li>
<li><p>å®¢æˆ·ç«¯è·¯ç”±ä½¿ç”¨çš„history,è·³è½¬ä¸è®¿é—®koaçš„è·¯ç”±</p>
</li>
<li><p>ssr éƒ¨ç½²ä»£ç ä½“ç§¯ç‰¹åˆ«å¤§ ,æ·»åŠ å¹¶å‘ï¼Œå…¬å…±å•ç‹¬æ‹†å‡ºã€ä½¿ç”¨cdn</p>
</li>
<li><p>pm2ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œ</p>
</li>
<li><p>å¼€å¯cssModulesåæŠŠantdçš„æ ·å¼ä¹Ÿç¼–è¯‘äº†</p>
</li>
<li><p>æ·»åŠ ä¸€ä¸ªå¸¸é‡æ•°ç»„ï¼Œç”¨æ¥è¡¨ç¤ºé‚£äº›å¿…é¡»ç”¨æ¥æœåŠ¡ç«¯æ¸²æŸ“(æé«˜åŠ è½½é€Ÿåº¦)ï¼Œä¸èƒ½å¤ªå¤šï¼Œå½±å“æ€§èƒ½ã€è®°å¾—å»é‡ã€‘</p>
</li>
<li><p>ä»åˆ«çš„é¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œä¸ºä»€ä¹ˆæ‰“å¼€ç½‘é¡µæºä»£ç æœ‰æ¸²æŸ“å¥½çš„html,ä¸åº”è¯¥åªæœ‰é¦–å±æ¸²æŸ“å—ï¼Ÿã€æ‰“å¼€æ§åˆ¶å°ç›¸å½“äºé‡æ–°æ¸²æŸ“äº†ã€‘</p>
</li>
<li><p><a href="https://github.com/hzfvictory/react-ssr/blob/master/src/pages/home/model.js#L27" target="_blank" rel="noopener">æœåŠ¡ç«¯è·å–äº†æ•°æ®ï¼Œå®¢æˆ·ç«¯æ€ä¹ˆåˆ¤æ–­å·²ç»è·å–äº†ï¼Œä¸å†è°ƒå–æ¥å£</a></p>
</li>
<li><p>æœåŠ¡ç«¯æœ‰äº†csså®¢æˆ·ç«¯è¿˜éœ€è¦å—ï¼Ÿ</p>
<p><strong>ç­”æ¡ˆæ˜¯éœ€è¦çš„ã€‚</strong></p>
<p>æœåŠ¡ç«¯çš„csså…¶å®å°±æ˜¯å®¢æˆ·ç«¯ç»™çš„ï¼SSRçš„æ¸²æŸ“åªæ˜¯é’ˆå¯¹é¡µé¢çš„é¦–å±ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ· ç¬¬ä¸€æ¬¡æ‰“å¼€çš„é¡µé¢ï¼Œå½“ä»é¦–å±è·³è½¬åˆ°åˆ«çš„é¡µé¢çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¿˜æ˜¯éœ€è¦å®¢æˆ·ç«¯æ¥æ¸²æŸ“çš„ï¼Œheadçš„cssä¹Ÿæ˜¯é€šè¿‡jsçš„é«˜é˜¶å‡½æ•°ï¼Œä¼ è¿›å»çš„ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯æ²¡æœ‰äº†cssï¼ŒæœåŠ¡ç«¯ä¸€å®šæ˜¯æ²¡æœ‰cssçš„ã€‚åœ¨reactçš„é¡¹ç›®ä¸­æ˜¯æ²¡æœ‰çœŸæ­£çš„cssçš„ï¼Œæ‰€è°“çš„cssä¹Ÿæ˜¯é€šè¿‡jsæ¥å®ç°åŠ¨æ€å¼•å…¥ï¼Œæ‰€ä»¥cssä¹Ÿæ˜¯js,åŒ…æ‹¬å›¾ç‰‡ã€‚</p>
</li>
<li><p>ssræ€ä¹ˆè¿›è¡Œå‚æ•°çš„ä¼ è¾“å’Œè·å–</p>
<ul>
<li><strong>ç›´æ¥ä½¿ç”¨é—®å·ä¼ å‚</strong></li>
</ul>
<p>å®¢æˆ·ç«¯pathï¼š /a/b?id=1008611<br>ç„¶åé€šè¿‡æ­£åˆ™æˆ–è€…ä½¿ç”¨qsè·å–åˆ°idçš„å€¼</p>
<ul>
<li><strong>åœ°å€æ ä¼ å‚</strong></li>
</ul>
<p><strong>æ–¹æ³•ä¸€</strong></p>
<p>æƒ³è¦ä¼ å‚å®¢æˆ·ç«¯è·¯ç”±åœ¨åå°è®¾ç½®ä¸‹ï¼Œä½¿å®ƒèƒ½ç›´æ¥è·å–åˆ°params<br>ä¾‹å¦‚ï¼šroute.get(â€˜detail/id:?â€™()=&gt;{}))<br>æœ€å¥½æ˜¯æŠŠå®¢æˆ·ç«¯æ‰€æœ‰è¦ä¼ å‚urléƒ½æ·»åŠ ä¸€æ ·çš„å‰ç¼€<br>é¡µé¢A menu/homeDetail/1212<br>é¡µé¢B menu/aboutDetail/3434</p>
<p>route.get(â€˜menu/:pageInfo?/:id?â€™()=&gt;{}))</p>
<p> <strong>æ–¹æ³•äºŒ</strong><br> ä¹Ÿæ˜¯æˆ‘å†ç”¨çš„æ–¹æ³•ï¼Œè·å–åˆ°å½“å‰çš„è·¯ç”±pathå’Œè¯·æ±‚çš„url,é€šè¿‡æ­£åˆ™è·å–åˆ°å½“å‰çš„idä¹Ÿå¯ä»¥ç›´æ¥ç”¨<code>path-to-regexp</code></p>
</li>
</ol>
<blockquote>
<p>ä¸Šé¢çš„é—®é¢˜ï¼Œå‡å·²è§£å†³ï¼Œå¯èƒ½æ–‡ç« ä»‹ç»çš„ä¸å…·ä½“ï¼Œå…·ä½“ä»¥æºç ä¸ºå‡†ã€‚</p>
</blockquote>
<p><code>å–œæ¬¢çš„markğŸ‘</code> </p>
<h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="http://blog.poetries.top/2018/11/18/react-ssr/?utm_source=tuicool&utm_medium=referral" target="_blank" rel="noopener">ä»é›¶åˆ°ä¸€æ­å»ºReact SSRå·¥ç¨‹æ¶æ„</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/66672794" target="_blank" rel="noopener">çŸ¥ä¹ rendertron</a></p>
<p><a href="https://github.com/hzfvictory/react-ssr" target="_blank" rel="noopener">æœ¬æ–‡çš„githubåœ°å€</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:feng960106@163.com">hfzvictory</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://file.jing999.cn/2020/06/13/workspace/Frame/react/ssr/">http://file.jing999.cn/2020/06/13/workspace/Frame/react/ssr/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://file.jing999.cn" target="_blank">hfzvictory</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> æ‰“èµ<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.png" alt="å¾®ä¿¡"/><div class="post-qr-code__desc">å¾®ä¿¡</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.png" alt="æ”¯ä»˜å®"/><div class="post-qr-code__desc">æ”¯ä»˜å®</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/06/15/workspace/Frame/vue/reload/"><img class="prev_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">åŸºäºVueçš„ç»„ä»¶å±€éƒ¨åˆ·æ–°</div></div></a></div><div class="next-post pull_right"><a href="/2020/06/13/workspace/Frame/vue/source-code/vue-extend/"><img class="next_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å…¨å±€æŒ‚è½½ç»„ä»¶ä¹‹Vue.extend</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> è¯„è®º</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: '37fl65GwM0Ub4TbovXtyyFl7-gzGzoHsz',
  appKey: 'ASnnLHANk3heLWLCBK6zbfiw',
  notify: false,
  verify: false,
  placeholder: 'è¾“å…¥è¯„è®º...',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '20',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: true,
  requiredFields: requiredFields
});</script></div></article></main></div><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By hfzvictory</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>äº¬ICPå¤‡18059340å·-1</span></a></div></div></footer><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="é˜…è¯»æ¨¡å¼"></i><i class="fa fa-plus" id="font_plus" title="æ”¾å¤§å­—ä½“"></i><i class="fa fa-minus" id="font_minus" title="ç¼©å°å­—ä½“"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="ç®€ç¹è½¬æ¢" target="_self">ç¹</a><i class="darkmode fa fa-moon-o" id="darkmode" title="å¤œé—´æ¨¡å¼"></i></div><div id="rightside-config-show"><div id="rightside_config" title="è®¾ç½®"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="ç›®å½•" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="å›åˆ°é¡¶éƒ¨" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>ç”±</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>æä¾›æ”¯æŒ</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.5" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/search/local-search.js"></script></body></html>