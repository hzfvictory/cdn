<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Element-UI ï¼ŒTableç»„ä»¶å®ç°æ‹–æ‹½æ•ˆæœ</title>
      <link href="/2020/08/20/workspace/Frame/vue/sortable/"/>
      <url>/2020/08/20/workspace/Frame/vue/sortable/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Element-UI ï¼ŒTableç»„ä»¶å®ç°æ‹–æ‹½æ•ˆæœ</strong></p><p>æœ€è¿‘ä¸šåŠ¡éœ€æ±‚è¦æ·»åŠ tableçš„æ‹–æ‹½ï¼Œä½†æ˜¯elementå¹¶æ²¡æœ‰tableçš„æ‹–æ‹½åŠŸèƒ½ï¼Œåªèƒ½è‡ªå·±æ·»åŠ äº†ã€‚</p><p>æ‰¾äº†ä¸¤ä¸ªç»„ä»·åº“<code>sortablejs</code>å’Œ<code>vuedraggable</code>,åè€…æ˜¯åŸºäºå‰è€…å®ç°çš„æ›´åŠ ç¬¦åˆvueæ ‡å‡†çš„åº“ï¼Œä¾èµ–äºå‰è€…ï¼Œä½†æ˜¯é¡¹ç›®ä¸­ç”¨çš„elementçš„table, <code>vuedraggable</code>åœ¨è¿™ä¸ªåŸºç¡€ä¸Šå°±ä¸èƒ½ä½¿ç”¨ï¼Œçœ‹<a href="https://github.com/SortableJS/Vue.Draggable/blob/master/example/components/table-example.vue" target="_blank" rel="noopener">å®˜æ–¹çš„ç¤ºä¾‹</a> , æ‰€ä»¥åªèƒ½ä½¿ç”¨<code>sortablejs</code>äº†ï¼Œæˆ‘ç›´æ¥å®‰è£…äº†<code>vuedraggable</code>ï¼Œå®ƒä¾èµ–<code>sortablejs</code>å¯ä»¥ç›´æ¥ä½¿ç”¨é‡Œé¢çš„ç‰¹æ€§ï¼Œä¸‡ä¸€åæœŸå†æœ‰å…¶ä»–æ‹–æ‹½çš„åŠŸèƒ½ï¼Œè¿™ä¸ªåº“ä¸Šæ‰‹è¿˜æ¯”è¾ƒæ–¹ä¾¿ã€‚</p><h3 id="Sortableä½¿ç”¨ç¤ºä¾‹"><a href="#Sortableä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="Sortableä½¿ç”¨ç¤ºä¾‹"></a>Sortableä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-card v-loading=<span class="string">"fullscreenLoading"</span>&gt;</span><br><span class="line">        &lt;el-table</span><br><span class="line">                :data=<span class="string">"tableOptions.data"</span></span><br><span class="line">                border</span><br><span class="line">                size=<span class="string">"small"</span></span><br><span class="line">                row-key=<span class="string">'roleId'</span></span><br><span class="line">                ref=<span class="string">"table"</span></span><br><span class="line">                @cell-mouse-enter.once=<span class="string">'rowDrop'</span></span><br><span class="line">        &gt;</span><br><span class="line">            &lt;el-table-column</span><br><span class="line">                    prop=<span class="string">"sort"</span></span><br><span class="line">                    label=<span class="string">"æ‹–æ‹½åŒºåŸŸ"</span></span><br><span class="line">            &gt;</span><br><span class="line">                &lt;template slot-scope=<span class="string">"scope"</span>&gt;</span><br><span class="line">                    &lt;el-button type=<span class="string">"text"</span> size=<span class="string">"small"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"handle"</span>&gt;æŒ‰ä½æ‹–æ‹½&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>template&gt;</span><br><span class="line">            &lt;<span class="regexp">/el-table-column&gt;</span></span><br><span class="line"><span class="regexp">            &lt;el-table-column</span></span><br><span class="line"><span class="regexp">                    v-for="item of column"</span></span><br><span class="line"><span class="regexp">                    :key="item.prop"</span></span><br><span class="line"><span class="regexp">                    :prop="item.prop"</span></span><br><span class="line"><span class="regexp">                    :label="item.label"</span></span><br><span class="line"><span class="regexp">                    :width="item.width"</span></span><br><span class="line"><span class="regexp">                    :fixed="item.fixed"</span></span><br><span class="line"><span class="regexp">            /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/el-table&gt;</span></span><br><span class="line"><span class="regexp">        &lt;el-pagination</span></span><br><span class="line"><span class="regexp">                background</span></span><br><span class="line"><span class="regexp">                :hide-on-single-page="paginationOptions.showPage"</span></span><br><span class="line"><span class="regexp">                :layout="paginationOptions.layout"</span></span><br><span class="line"><span class="regexp">                :page-sizes="paginationOptions.pageSizes"</span></span><br><span class="line"><span class="regexp">                :total="paginationOptions.total"</span></span><br><span class="line"><span class="regexp">                :page-size="paginationOptions.pageSize"</span></span><br><span class="line"><span class="regexp">                :current-page="paginationOptions.currentPage"</span></span><br><span class="line"><span class="regexp">                @size-change="handleSizeChange"</span></span><br><span class="line"><span class="regexp">                @current-change="handleCurrentChange"</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/el-card&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">import</span> Sortable <span class="keyword">from</span> <span class="string">'sortablejs'</span>;</span><br><span class="line">  <span class="keyword">import</span> table <span class="keyword">from</span> <span class="string">"@/mixins/table"</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'TableDraggable'</span>,</span><br><span class="line">    mixins: [table],</span><br><span class="line">    props: &#123;&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        column: [</span><br><span class="line">          &#123;</span><br><span class="line">            prop: <span class="string">"roleId"</span>,</span><br><span class="line">            label: <span class="string">"åºå·"</span>,</span><br><span class="line">            width: <span class="number">100</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            prop: <span class="string">'roleName'</span>,</span><br><span class="line">            label: <span class="string">"è§’è‰²åç§°"</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            prop: <span class="string">"createTime"</span>,</span><br><span class="line">            label: <span class="string">"åˆ›å»ºæ—¶é—´"</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            prop: <span class="string">"roleId"</span>,</span><br><span class="line">            label: <span class="string">"åºå·"</span>,</span><br><span class="line">            width: <span class="number">100</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            prop: <span class="string">'edit'</span>,</span><br><span class="line">            label: <span class="string">"ç¼–è¾‘"</span>,</span><br><span class="line">            width: <span class="number">180</span>,</span><br><span class="line">            fixed: <span class="string">'right'</span></span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        fullscreenLoading: <span class="literal">true</span>,</span><br><span class="line">        paginationOptions: &#123;</span><br><span class="line">          pageSizes: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">      <span class="string">'tableOptions.data'</span>: &#123;</span><br><span class="line">        deep: <span class="literal">true</span>,</span><br><span class="line">        handler: <span class="function"><span class="keyword">function</span> (<span class="params">newData</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// console.log(newData);  // å¯ä»¥å‘ç°æ¯æ¬¡æ‹–æ‹½åæ•°æ®å‘ç”Ÿäº†æ”¹å˜</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="comment">//è¡Œæ‹–æ‹½</span></span><br><span class="line">      rowDrop() &#123;</span><br><span class="line">        <span class="keyword">const</span> tbody = <span class="keyword">this</span>.$refs.table.$el.querySelector(<span class="string">'.el-table__body-wrapper tbody'</span>);</span><br><span class="line">        <span class="keyword">const</span> _this = <span class="keyword">this</span>;</span><br><span class="line">        Sortable.create(tbody, &#123;</span><br><span class="line">          handle: <span class="string">'.handle'</span>,</span><br><span class="line">          animation: <span class="number">150</span>,</span><br><span class="line">          onChoose() &#123;</span><br><span class="line">            <span class="comment">//é€‰æ‹©å…ƒç´ </span></span><br><span class="line">            _this.column[_this.column.length - <span class="number">1</span>].fixed = <span class="literal">false</span></span><br><span class="line">          &#125;,</span><br><span class="line">          onUnchoose: <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// å–æ¶ˆé€‰æ‹©å…ƒç´ </span></span><br><span class="line">            _this.column[_this.column.length - <span class="number">1</span>].fixed = <span class="string">'right'</span></span><br><span class="line"></span><br><span class="line">          &#125;,</span><br><span class="line">          onEnd(&#123;newIndex, oldIndex&#125;) &#123;</span><br><span class="line">            <span class="comment">// æ‹–æ‹½å®Œæˆ</span></span><br><span class="line">            <span class="keyword">const</span> currRow = _this.tableOptions.data.splice(oldIndex, <span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">            _this.tableOptions.data.splice(newIndex, <span class="number">0</span>, currRow)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;style type="text/</span>scss<span class="string">" lang="</span>scss<span class="string">" scoped&gt;</span></span><br><span class="line"><span class="string">    .handle &#123;</span></span><br><span class="line"><span class="string">        cursor: move</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ::v-deep .hover-row &gt; td &#123;</span></span><br><span class="line"><span class="string">        background-color: #fff !important;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ::v-deep .sortable-chosen &gt; td &#123;</span></span><br><span class="line"><span class="string">        // æ‹–åŠ¨çš„æ ·å¼</span></span><br><span class="line"><span class="string">        background-color: #eff2f6 !important;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ::v-deep .el-table--enable-row-hover .el-table__body tr:hover &gt; td &#123;</span></span><br><span class="line"><span class="string">        // ä¿®å¤æ‹–æ‹½çš„æ—¶å€™hoverçš„ä¸æ¶ˆå¤±çš„é—®é¢˜</span></span><br><span class="line"><span class="string">        background-color: #fff;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¸Šé¢çš„ä»£ç æœ‰ä¸€äº›æ³¨æ„çš„åœ°æ–¹æˆ‘ä¸€ä¸€åˆ—ä¸¾ä¸‹æ¥</strong></p><ol><li>element tableåŠ¡å¿…æŒ‡å®š<code>row-key</code>ï¼Œrow-keyå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸ç„¶ä¼šå‡ºç°æ’åºä¸å¯¹çš„æƒ…å†µã€‚</li><li>æˆ‘åœ¨tableé‡Œé¢ä½¿ç”¨äº†<strong>fixed</strong>ï¼Œæœ€åä¸€åˆ—æ˜¯å›ºå®šåœ¨å³ä¾§ï¼Œç”¨è¿‡elementçš„çŸ¥é“è¿™æ˜¯ä¸¤ä¸ªtableçš„æ‹¼æ¥æˆçš„ï¼Œæ‰€ä»¥æ‹–æ‹½æ˜¯æ²¡æœ‰ååº”çš„<ol><li>ä»¥å› ä¸ºä¸Šé¢æˆ‘ä»¬æœ‰æŒ‡å®šrow-keyï¼Œæ‰€ä»¥æ‹–æ‹½åä¸ä¼šå‡ºç°é”™ä½çš„æƒ…å†µï¼Œä½†æ˜¯åœ¨æ‹–æ‹½çš„æ—¶å€™ï¼Œæ˜¯æœ‰å¾ˆæ˜æ˜¾çš„é”™ä½å‡ºç°ã€‚</li><li>æˆ‘è§£å†³çš„æ€è·¯æ˜¯åœ¨æ‹–æ‹½çš„æ—¶å€™å…ˆæŠŠè¿™ä¸ªå›ºå®šå–æ¶ˆ<code>onChoose</code>,ç„¶åæ‹–æ‹½å®Œæˆååœ¨æŠŠå›ºå®šåŠ ä¸Š<code>onUnchoose</code>,å…·ä½“çœ‹ä¸¤ä¸ªæ–¹æ³•çš„ä»£ç </li></ol></li><li>æ ·å¼tableä¼šæœ‰é¼ æ ‡æ»‘è¿‡çš„æ•ˆæœï¼Œä½†æ˜¯ä½¿ç”¨æ‹–æ‹½åï¼Œé¼ æ ‡æ»‘è¿‡åçš„æ•ˆæœä¸æ¶ˆå¤±ï¼Œç”šè‡³ä¼šå‡ºç°å¾ˆå¤šä¸ªé¼ æ ‡æ»‘è¿‡çš„æ•ˆæœï¼Œè§£å†³çš„æ–¹å¼æ¯”è¾ƒç²—æš´ï¼Œæˆ‘æ˜¯æŠŠæ‰€æœ‰çš„æ»‘è¿‡çš„æ•ˆæœå…¨éƒ¨å–æ¶ˆäº†ï¼Œè°æœ‰æ›´å¥½çš„æ–¹æ¡ˆæ¬¢è¿è¯„è®ºåŒºç•™è¨€ã€‚<ol><li>ä¸ä½¿ç”¨<code>fixed</code>,å¯ä»¥é˜²æ­¢2ã€3é—®é¢˜</li></ol></li><li><code>mounted</code>ç”Ÿå‘½å‘¨æœŸè°ƒå–çš„<code>rowDrop</code>æ–¹æ³•ï¼Œä¼šå‡ºç°çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœåœ¨<code>created</code>è°ƒå–çš„æ¥å£é‡å¤§åœ¨<code>mounted</code>å‘¨æœŸå¯èƒ½ä¸èƒ½æ›´å¥½çš„æ¸²æŸ“å®Œæˆï¼Œæ­¤æ—¶å°†è·å–ä¸åˆ°<code>tbody</code>,æ‰€ä»¥è¿™é‡Œæˆ‘çš„è§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨,tableç»„ä»¶è‡ªå¸¦çš„<code>@cell-mouse-enter.once=&#39;rowDrop&#39;</code>ï¼Œhoveræ»‘è¿‡çš„æ—¶å€™å®Œæˆåˆå§‹åŒ–ï¼ŒåŠ ä¸Šonceæ˜¯ä»–åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ–è€…æ›´ç²—æš´çš„åŠæ³•ç›´æ¥ä½¿ç”¨å®šæ—¶å™¨ã€‚</li></ol><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://sortablejs.github.io/Vue.Draggable/#/table-example" target="_blank" rel="noopener">draggable</a></p><p><a href="https://github.com/SortableJS/Sortable" target="_blank" rel="noopener">sortable</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueé¢„æ¸²æŸ“</title>
      <link href="/2020/08/10/workspace/Frame/vue/prerender/"/>
      <url>/2020/08/10/workspace/Frame/vue/prerender/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Vueé¢„æ¸²æŸ“</strong></p><p>ä¹‹å‰ä¸€æ®µæ—¶é—´è°ƒç ”äº†Reactçš„<a href="https://juejin.im/post/6854573205349367815" target="_blank" rel="noopener">SSR</a>,ä»Šå¤©æœ‰æ—¶é—´ç ”ç©¶ä¸‹Vueçš„é¢„æ¸²æŸ“ã€‚è€å¥—è·¯è¿˜æ˜¯å…ˆè¯´è¯´é¢„æ¸²æŸ“æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œè·ŸSSRæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ  Letâ€™s look down  ğŸ‘“â¬</p><p>å¦‚æœä½ è°ƒç ”æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR) åªæ˜¯ç”¨æ¥æ”¹å–„å°‘æ•°è¥é”€é¡µé¢ï¼ˆä¾‹å¦‚ <code>/</code>, <code>/about</code>, <code>/contact</code> ç­‰ï¼‰çš„ SEOï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦<strong>é¢„æ¸²æŸ“</strong>ã€‚æ— éœ€ä½¿ç”¨ web æœåŠ¡å™¨å®æ—¶åŠ¨æ€ç¼–è¯‘ HTMLï¼Œè€Œæ˜¯ä½¿ç”¨é¢„æ¸²æŸ“æ–¹å¼ï¼Œåœ¨æ„å»ºæ—¶ (build time) ç®€å•åœ°ç”Ÿæˆé’ˆå¯¹ç‰¹å®šè·¯ç”±çš„é™æ€ HTML æ–‡ä»¶ã€‚ä¼˜ç‚¹æ˜¯è®¾ç½®é¢„æ¸²æŸ“æ›´ç®€å•ï¼Œå¹¶å¯ä»¥å°†ä½ çš„å‰ç«¯ä½œä¸ºä¸€ä¸ªå®Œå…¨é™æ€çš„ç«™ç‚¹ã€‚</p><p>é¢„æ¸²æŸ“æ˜¯ä¸ºäº†é¡µé¢æœ‰æ›´å¥½çš„åŠ è½½é€Ÿåº¦ï¼Œè€Œä¸”å¯ä»¥æ”¹å–„å°‘æ•°é¡µé¢çš„SEOï¼Œä¸ºä»€ä¹ˆæ˜¯å°‘æ•°çš„ï¼Œå› ä¸ºå¤§é‡çš„è·¯ç”±ä¼šä½¿é¢„æ¸²æŸ“å˜å¾—éå¸¸ç¼“æ…¢ï¼ˆæ„å»ºæ—¶ï¼‰ã€‚é¢„æ¸²æŸ“åŸºæœ¬åŸç†æ˜¯ - å¯åŠ¨æ— å¤´æµè§ˆå™¨ï¼ŒåŠ è½½åº”ç”¨ç¨‹åºçš„è·¯ç”±å¹¶å°†ç»“æœä¿å­˜åˆ°é™æ€HTMLæ–‡ä»¶ä¸­ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥å°†å…¶ä¸ä»¥å‰ä½¿ç”¨çš„ä»»ä½•é™æ€æ–‡ä»¶æœåŠ¡è§£å†³æ–¹æ¡ˆä¸€èµ·ä½¿ç”¨ï¼Œç”¨æœ€å°‘çš„ä»£ç åšåˆ°ä½ æƒ³è¦çš„æ•ˆæœå‡ ä¹æ²¡æœ‰ä»»ä½•çš„ä¾µå…¥æ€§ã€‚</p><p>çœ‹ä¸‹ä»–ä»¬çš„åŒºåˆ«ï¼š</p><table><thead><tr><th align="left"><a href="https://juejin.im/post/6854573205349367815" target="_blank" rel="noopener">SSR</a></th><th align="left"><a href="https://www.npmjs.com/package/prerender-spa-plugin" target="_blank" rel="noopener">é¢„æ¸²æŸ“</a></th></tr></thead><tbody><tr><td align="left">è¿è¡Œæ—¶</td><td align="left">æ„å»ºæ—¶</td></tr><tr><td align="left">ä»£ç ä¾µå…¥æ€§å¤§ï¼Œå¼€å‘è°ƒè¯•ä»£ä»·é«˜ï¼ŒæŠ¥é”™ä¸æ˜æ˜¾ï¼ˆé’©å­ï¼‰</td><td align="left">å‡ ä¹æ²¡æœ‰ä¾µå…¥æ€§</td></tr><tr><td align="left">SEOæ›´å½»åº•</td><td align="left">æœ‰å±€é™æ€§ï¼ˆåŠ¨æ€URLçš„å¼‚æ­¥è¯·æ±‚ï¼‰</td></tr><tr><td align="left">é¦–å±åŠ è½½æ›´å¿«</td><td align="left">é¦–å±åŠ è½½å¿«</td></tr><tr><td align="left">éœ€è¦Nodeç¯å¢ƒï¼Œè€—è´¹CPUå†…å­˜</td><td align="left">ä¸éœ€è¦Nodeç¯å¢ƒ</td></tr><tr><td align="left">éš¾åº¦è¾ƒå¤§ï¼ˆæœ‰ç°æˆçš„æ¡†æ¶ï¼‰</td><td align="left">éš¾åº¦å°</td></tr><tr><td align="left">åŠ¨æ€å†…å®¹ç›´å‡º HTMl</td><td align="left">ç›´å‡ºæœ‰é™ï¼Œå®¢æˆ·ç«¯ä¼šå†æ¬¡åŠ è½½ï¼ˆè·³å±ï¼‰</td></tr></tbody></table><p><strong>ä¸Šå¹²è´§</strong></p><p>é¢„æ¸²æŸ“æ ¸å¿ƒæ’ä»¶ï¼š<strong>prerender-spa-plugin</strong> ä¸ºäº†æ›´å¥½çš„SEOä¸€èˆ¬ä¼šåŠ¨æ€éœ€æ”¹metaçš„å†…å®¹ <strong>vue-meta-info</strong></p><p>å®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add prerender-spa-plugin vue-meta-info -D</span><br></pre></td></tr></table></figure><p>prerender-spa-plugin æ˜¯åŸºäºpuppeteerçš„ï¼Œä¸‹è½½å‡ºé”™å¤šè¯•å‡ æ¬¡ï¼Œç™¾åº¦å¾ˆå¤šæ–‡ç« å¯è§£å†³</p><p><strong>vue.config.jsä¸­è¿›è¡Œé…ç½®</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> PrerenderSPAPlugin = <span class="built_in">require</span>(<span class="string">'prerender-spa-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> Renderer = PrerenderSPAPlugin.PuppeteerRenderer</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">       <span class="keyword">new</span> PrerenderSPAPlugin(&#123;</span><br><span class="line">          <span class="comment">// ç”Ÿæˆæ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™ä¸ªç›®å½•åªèƒ½æœ‰ä¸€çº§ã€‚è‹¥ç›®å½•å±‚æ¬¡å¤§äºä¸€çº§ï¼Œåœ¨ç”Ÿæˆçš„æ—¶å€™ä¸ä¼šæœ‰ä»»ä½•é”™è¯¯æç¤ºï¼Œåœ¨é¢„æ¸²æŸ“çš„æ—¶å€™åªä¼šå¡ç€ä¸åŠ¨</span></span><br><span class="line">          staticDir: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">          <span class="comment">// å¯é€‰-æ¸²æŸ“çš„åº”ç”¨ç¨‹åºåº”è¾“å‡ºåˆ°çš„è·¯å¾„ã€‚</span></span><br><span class="line">          <span class="comment">// (é»˜è®¤ä¸ºstaticDirã€‚ï¼‰</span></span><br><span class="line">          outputDir: path.joinï¼ˆ__dirname ï¼Œ<span class="string">'/dist/prerendered'</span>ï¼‰ï¼Œ </span><br><span class="line">          <span class="comment">// å¯¹åº”è‡ªå·±çš„è·¯ç”±æ–‡ä»¶</span></span><br><span class="line">          routes: [ <span class="string">'/'</span>, <span class="string">'/home'</span>,<span class="string">'/list'</span>],</span><br><span class="line">          <span class="comment">// è‹¥æ²¡æœ‰è¿™æ®µåˆ™ä¸ä¼šè¿›è¡Œé¢„ç¼–è¯‘</span></span><br><span class="line">          renderer: <span class="keyword">new</span> Renderer(&#123;</span><br><span class="line">            inject: &#123;</span><br><span class="line">              foo: <span class="string">'bar'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// headless: false,</span></span><br><span class="line">            <span class="comment">// åœ¨ main.js ä¸­ document.dispatchEvent(new Event('render-event'))ï¼Œä¸¤è€…çš„äº‹ä»¶åç§°è¦å¯¹åº”ä¸Šã€‚</span></span><br><span class="line">            renderAfterDocumentEvent: <span class="string">'render-event'</span>,</span><br><span class="line">            <span class="comment">// å¯é€‰-ç­‰å¾…æ¸²æŸ“ï¼Œç›´åˆ°ç»è¿‡ä¸€å®šçš„æ—¶é—´ã€‚</span></span><br><span class="line">            <span class="comment">// ä¸æ¨è</span></span><br><span class="line">            renderAfterTime: <span class="number">5000</span>,</span><br><span class="line">            <span class="comment">// å¯é€‰-é»˜è®¤ä¸º0ï¼Œæ— é™åˆ¶ã€‚</span></span><br><span class="line">            <span class="comment">// è·¯ç”±æ˜¯å¼‚æ­¥å‘ˆç°çš„ã€‚</span></span><br><span class="line">            <span class="comment">// ä½¿ç”¨å®ƒæ¥é™åˆ¶å¹¶è¡Œæ¸²æŸ“çš„è·¯ç”±æ•°é‡</span></span><br><span class="line">            maxConcurrentRoutes: <span class="number">4</span> ï¼Œ </span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>main.jsä¸­è¿›è¡Œé…ç½®</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> MetaInfo <span class="keyword">from</span> <span class="string">'vue-meta-info'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue.use(MetaInfo)</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render:<span class="function"><span class="params">h</span>=&gt;</span>h(App),</span><br><span class="line">  mounted()&#123;</span><br><span class="line">     <span class="built_in">document</span>.dispatchEvent(<span class="keyword">new</span> Event(<span class="string">'render-event'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><p><code>æ³¨ï¼šé¢„æ¸²æŸ“æ–¹å¼ä¸‹çš„routeéœ€é‡‡ç”¨historyæ¨¡å¼ï¼Œå¦åˆ™æ¯ä¸ªæ‰“åŒ…ç”Ÿæˆçš„index.htmlçš„æ–‡ä»¶å†…å®¹ä¼šä¸€æ ·</code></p><p><strong>ç»„ä»¶å†…é™æ€ä½¿ç”¨metaInfo</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">...</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  metaInfo: &#123;</span><br><span class="line">    title: &#39;My Example App&#39;, &#x2F;&#x2F; å¯ä»¥æ˜¯å¼‚æ­¥çš„</span><br><span class="line">    meta: [&#123;                 </span><br><span class="line">      name: &#39;keyWords&#39;,</span><br><span class="line">      content: &#39;é¢„æ¸²æŸ“&#39;</span><br><span class="line">    &#125;]</span><br><span class="line">    link: [&#123;                </span><br><span class="line">      rel: &#39;asstes&#39;,</span><br><span class="line">      href: &#39;file.jing999.cn&#39;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vueä¹‹JSXå°è£…æœç´¢å¤´éƒ¨</title>
      <link href="/2020/07/17/workspace/Frame/vue/with-search/"/>
      <url>/2020/07/17/workspace/Frame/vue/with-search/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>vueä¹‹JSXå°è£…æœç´¢å¤´éƒ¨</strong></p><p>[[toc]]</p><h3 id="ç»„ä»¶å°è£…æºç "><a href="#ç»„ä»¶å°è£…æºç " class="headerlink" title="ç»„ä»¶å°è£…æºç "></a>ç»„ä»¶å°è£…æºç </h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;searchProps&#125; = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      searchData: searchProps.search || &#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    searchProps: &#123;</span><br><span class="line">      type: <span class="built_in">Object</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    typeInput(item) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;el-form-item prop=&#123;item.key&#125;&gt;</span><br><span class="line">          &#123;item.label !== <span class="literal">false</span> &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prepend small"</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            clearable=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">            style=&#123;&#123;<span class="attr">width</span>: <span class="string">'160px'</span>, ...item.styles&#125;&#125;</span><br><span class="line">            v-model=&#123;<span class="keyword">this</span>.searchData[item.key]&#125;</span><br><span class="line">            placeholder=&#123;<span class="string">`è¯·è¾“å…¥<span class="subst">$&#123;item.name&#125;</span>`</span>&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/el-form-item&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    typeSelect(item) &#123;</span></span><br><span class="line"><span class="regexp">      return (</span></span><br><span class="line"><span class="regexp">        &lt;el-form-item prop=&#123;item.key&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &#123;item.label !== false &amp;&amp; &lt;div class="prepend small"&gt;&#123;item.name&#125;&lt;/</span>div&gt;&#125;</span><br><span class="line">          &lt;zy-select v-model=&#123;<span class="keyword">this</span>.searchData[item.key]&#125; type=&#123;item.enumType&#125; data=&#123;item.enums&#125;</span><br><span class="line">                     style=&#123;&#123;...item.styles&#125;&#125;</span><br><span class="line">                     placeholder=<span class="string">"å…¨éƒ¨"</span>/&gt;</span><br><span class="line">        &lt;<span class="regexp">/el-form-item&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    typeDatePicker(item) &#123;</span></span><br><span class="line"><span class="regexp">      return (</span></span><br><span class="line"><span class="regexp">        &lt;el-form-item prop=&#123;item.key&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &#123;item.label !== false &amp;&amp; &lt;div class="prepend small"&gt;&#123;item.name&#125;&lt;/</span>div&gt;&#125;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            style=&#123;&#123;<span class="attr">width</span>: <span class="string">'220px'</span>, ...item.styles&#125;&#125;</span><br><span class="line">            v-model=&#123;<span class="keyword">this</span>.searchData[item.key]&#125;</span><br><span class="line">            type=<span class="string">"daterange"</span></span><br><span class="line">            range-separator=<span class="string">"è‡³"</span></span><br><span class="line">            start-placeholder=<span class="string">"å¼€å§‹æ—¥æœŸ"</span></span><br><span class="line">            end-placeholder=<span class="string">"ç»“æŸæ—¥æœŸ"</span></span><br><span class="line">            value-format=<span class="string">"yyyy-MM-dd"</span></span><br><span class="line">            picker-options=&#123;&#123;...this.picker_options, ...item.pickerOptions&#125;&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/el-form-item&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    handleDom(item) &#123;</span></span><br><span class="line"><span class="regexp">      return &#123;</span></span><br><span class="line"><span class="regexp">        select: this.typeSelect(item),</span></span><br><span class="line"><span class="regexp">        datePicker: this.typeDatePicker(item),</span></span><br><span class="line"><span class="regexp">        default: this.typeInput(item),</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    typeSearchBtn() &#123;</span></span><br><span class="line"><span class="regexp">      const &#123;searchProps: &#123;onReset, onSearch&#125;&#125; = this;</span></span><br><span class="line"><span class="regexp">      const searchDom = &lt;el-button type="primary" icon="el-icon-search" onClick=&#123;this.handleSearch&#125;&gt;æŸ¥è¯¢&lt;/</span>el-button&gt;</span><br><span class="line">      <span class="keyword">const</span> resetDom = <span class="xml"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">icon</span>=<span class="string">"el-icon-refresh"</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleReset&#125;</span>&gt;</span>é‡ç½®<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &#123;onSearch &amp;&amp; searchDom&#125;</span><br><span class="line">          &#123;onReset &amp;&amp; resetDom&#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    handleSearch() &#123;</span></span><br><span class="line"><span class="regexp">      const &#123;searchProps: &#123;onSearch&#125;&#125; = this;</span></span><br><span class="line"><span class="regexp">      onSearch &amp;&amp; onSearch(this.searchData)</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ this.$emit('search', this.searchData)  /</span><span class="regexp">/ å¯ä»¥è‡ªå®šä¹‰çˆ¶çº§çš„äº‹ä»¶ï¼Œè¿™é‡Œæ²¡ç”¨</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    handleReset() &#123;</span></span><br><span class="line"><span class="regexp">      const &#123;searchProps: &#123;onReset&#125;&#125; = this;</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ console.log(this.$refs['formData'].resetFields());</span></span><br><span class="line"><span class="regexp">      this.searchData = &#123;&#125;</span></span><br><span class="line"><span class="regexp">      onReset &amp;&amp; onReset()</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ handlerSearchData(newVal) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/   this.searchProps.formData = newVal</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  computed: &#123;</span></span><br><span class="line"><span class="regexp">    handlerSearchData() &#123;</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ è¿™é‡Œå¯ä»¥ç›´æ¥æ“ä½œçˆ¶çº§çš„æ•°æ®ï¼Œå‰ææ˜¯åˆ«æ·±å…‹éš†</span></span><br><span class="line"><span class="regexp">      this.searchProps.formData = this.searchData</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ watch: &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   /</span><span class="regexp">/ è·Ÿä¸Šé¢çš„computedæ•ˆæœä¸€æ ·</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   searchData: &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/     /</span><span class="regexp">/ é¡µé¢èƒ½å®æ—¶è·å–åˆ°æ•°æ®</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/     handler: 'handlerSearchData',</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/     deep: true,</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/     immediate: true</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   &#125;,</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ &#125;,</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123;searchProps: &#123;fields, formData&#125;&#125; = this;</span></span><br><span class="line"><span class="regexp">    formData &amp;&amp; this.handlerSearchData</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;div class="searchBox"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;el-form</span></span><br><span class="line"><span class="regexp">          props=&#123;&#123;model: this.searchData&#125;&#125;</span></span><br><span class="line"><span class="regexp">          label-width="85px"</span></span><br><span class="line"><span class="regexp">          ref="formData"</span></span><br><span class="line"><span class="regexp">          inline</span></span><br><span class="line"><span class="regexp">          class="demo-form-inline"</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &#123;/</span>*formè¡¨å•*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">          &#123;</span></span><br><span class="line"><span class="regexp">            fields.map((item) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">              return (</span></span><br><span class="line"><span class="regexp">                this.handleDom(item)[item.type || 'default']</span></span><br><span class="line"><span class="regexp">              )</span></span><br><span class="line"><span class="regexp">            &#125;)</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">          &#123;/</span>* æ“ä½œæŒ‰é’® *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">          &lt;div class="searchBtn" style="float: right"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;this.typeSearchBtn()&#125;</span></span><br><span class="line"><span class="regexp">            &#123;/</span>*é¢å¤–çš„æ“ä½œæŒ‰é’®*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">            &#123;this.$slots.default&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/el-form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="WithSearchæ–‡æ¡£"><a href="#WithSearchæ–‡æ¡£" class="headerlink" title="WithSearchæ–‡æ¡£"></a>WithSearchæ–‡æ¡£</h3><table><thead><tr><th align="left">å‚æ•°å</th><th align="left">ä½œç”¨</th><th align="left">ç±»å‹</th><th align="left">é»˜è®¤å€¼</th></tr></thead><tbody><tr><td align="left">search</td><td align="left">æœç´¢åˆå§‹å€¼</td><td align="left">object</td><td align="left">{}</td></tr><tr><td align="left">fields</td><td align="left">å¿…å¡«ï¼Œæœç´¢è¡¨å•é¡¹</td><td align="left">array</td><td align="left">[]</td></tr><tr><td align="left">onSearch</td><td align="left">æŸ¥è¯¢æ“ä½œ,åªæœ‰è®¾ç½®äº†æ­¤é¡¹ï¼ŒæŸ¥è¯¢æŒ‰é’®æ‰ä¼šæ˜¾ç¤º</td><td align="left">fun</td><td align="left">æ— </td></tr><tr><td align="left">onReset</td><td align="left">æŸ¥è¯¢é‡ç½®æ“ä½œ, åªæœ‰è®¾ç½®äº†æ­¤é¡¹ï¼Œé‡ç½®æŒ‰é’®æ‰ä¼šæ˜¾ç¤º</td><td align="left">fun</td><td align="left">æ— </td></tr><tr><td align="left">formData</td><td align="left">è·å–formè¡¨å•çš„å€¼ï¼Œåªæœ‰è®¾ç½®äº†æ­¤é¡¹ï¼Œæ‰èƒ½è·å–æœ€æ–°å€¼ï¼Œé»˜è®¤ä¸è·å–</td><td align="left">object</td><td align="left">æ— </td></tr></tbody></table><p><strong>fields</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> searchFields = [</span><br><span class="line">  &#123;</span><br><span class="line">    key: <span class="string">'name'</span>,</span><br><span class="line">    name: <span class="string">'åº”ç”¨åç§°/ID'</span>,</span><br><span class="line">    label: <span class="literal">false</span>, <span class="comment">// éšè—label</span></span><br><span class="line">    styles: &#123;<span class="attr">width</span>: <span class="string">'100px'</span>&#125; <span class="comment">// å®½åº¦</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    key: <span class="string">'mediaId'</span>, <span class="comment">// æ•°æ®æäº¤çš„å­—æ®µ</span></span><br><span class="line">    name: <span class="string">'åº”ç”¨åˆ†ç±»'</span>, <span class="comment">// labelçš„åå­—</span></span><br><span class="line">    type: <span class="string">'select'</span>, <span class="comment">// formçš„ç±»å‹  é»˜è®¤æ˜¯ input</span></span><br><span class="line">    enums: [&#123;<span class="attr">label</span>: <span class="string">'æ˜¯'</span>, <span class="attr">value</span>: <span class="number">1</span>&#125;, &#123;<span class="attr">label</span>: <span class="string">'å¦'</span>, <span class="attr">value</span>: <span class="number">0</span>&#125;],  <span class="comment">// é€‰æ¡†çš„æ•°æ®</span></span><br><span class="line">    enumType: &#123;<span class="attr">id</span>: <span class="string">'value'</span>, <span class="attr">name</span>: <span class="string">'label'</span>&#125; <span class="comment">// é€‰æ¡†çš„æ•°æ®æ ¼å¼åŒ–</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    key: <span class="string">'system'</span>,</span><br><span class="line">    name: <span class="string">'ç³»ç»Ÿ'</span>,</span><br><span class="line">    type: <span class="string">'datePicker'</span>,</span><br><span class="line">    pickerOptions: &#123; <span class="comment">// pickerçš„ä¸€äº›å‚æ•°</span></span><br><span class="line">      disabledDate(time) &#123;</span><br><span class="line">        <span class="keyword">return</span> time.getTime() &lt;= <span class="built_in">Date</span>.now();</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶ä½¿ç”¨"><a href="#ç»„ä»¶ä½¿ç”¨" class="headerlink" title="ç»„ä»¶ä½¿ç”¨"></a>ç»„ä»¶ä½¿ç”¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;with-search :searchProps&#x3D;&quot;searchProps&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">   data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        searchProps: &#123;</span><br><span class="line">          search: &#123;name: 112&#125;,</span><br><span class="line">          fields: searchFields,</span><br><span class="line">          onSearch: this.handleSearch,</span><br><span class="line">          onReset: this.handleReset,</span><br><span class="line">          formData: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h3><p><code>ä»…ä»…æ˜¯æä¾›ä¸€ä¸ªæ€è·¯ï¼Œæœ‰å¾…å®Œå–„  æœ‰å¾…å®Œå–„  ...</code></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> ç»„ä»¶å°è£… </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºVueçš„ç»„ä»¶å±€éƒ¨åˆ·æ–°</title>
      <link href="/2020/06/15/workspace/Frame/vue/reload/"/>
      <url>/2020/06/15/workspace/Frame/vue/reload/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>åŸºäºVueçš„ç»„ä»¶å±€éƒ¨åˆ·æ–°</strong></p><p>ä¹‹å‰åškeepaliveï¼Œç»„ä»¶destroyé”€æ¯åï¼Œå°±ä¸ä¼šç¼“å­˜è¯¥é¡µé¢äº†ï¼Œè§£å†³çš„åŠæ³•å°±æ˜¯åˆ·æ–°å½“å‰çš„é¡µé¢ï¼Œä¸€ç§æ˜¯åŸå§‹çš„åˆ·æ–°æ–¹å¼ï¼Œä¸€ç§å°±æ˜¯åŸºäºæ¡†æ¶æœ¬èº«çš„å±€éƒ¨åˆ·æ–°ï¼Œä»Šå¤©å®Œå–„ä¸‹åŸºäºvueçš„å±€éƒ¨åˆ·æ–°ã€‚</p><p>æˆ‘ä¸Šæ¬¡çœäº‹åœ¨åškeepaliveçš„æ—¶å€™ï¼Œç›´æ¥åœ¨é¡µé¢å†…éƒ¨åšçš„å±€éƒ¨åˆ·æ–°ï¼Œå…·ä½“çœ‹<a href="https://juejin.im/post/6844904178926485511#heading-7" target="_blank" rel="noopener">è¿™å¤§æ¦‚æ˜¯æœ€å…¨ä¹çš„keep-aliveè¸©å‘æŒ‡å—</a> ,å®ç°çš„æ€è·¯å°±æ˜¯é‡ç½®æ‰€æœ‰çš„data,ç„¶ååœ¨é…åˆv-if,å°±èƒ½åšåˆ°å±€éƒ¨çš„åˆ·æ–°ï¼Œç„¶åå¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªmixinsä»£ç ä¹Ÿæ˜¯å¾ˆç®€æ´çš„ï¼Œä½†æ˜¯è¿˜æ˜¯è¦æ¯æ¬¡éƒ½å¼•å…¥mixins,ç°åœ¨ç”¨å¦ä¸€ç§æ–¹å¼é‡æ–°ä¼˜åŒ–ï¼ŒåŸç†è·Ÿä¸Šé¢çš„é‚£ä¸ªæ–¹æ³•ç±»ä¼¼ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ : åœ¨ app.vue ä¸­å®šä¹‰å…¨å±€æ–¹æ³•:å¦‚ä¸‹</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &lt;router-view v-<span class="keyword">if</span>=<span class="string">"isRouterAlive"</span>/&gt;    <span class="comment">//é€šè¿‡v-ifæ¥æ§åˆ¶å®¹å™¨çš„å‡ºç°ä¸æ¶ˆå¤±</span></span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'App'</span>,</span><br><span class="line">  provide()&#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡provideä¼ é€’ç»™å­ä»£ï¼Œè°éœ€è¦è°è·å–ä¸‹å°±OKäº†</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      reload:<span class="keyword">this</span>.reload</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      isRouterAlive: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">   reload () &#123;</span><br><span class="line">     <span class="keyword">this</span>.isRouterAlive = <span class="literal">false</span></span><br><span class="line">     <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> (<span class="keyword">this</span>.isRouterAlive = <span class="literal">true</span>))</span><br><span class="line">   &#125;   </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å®šä¹‰äº†å…¨å±€çš„æ–¹æ³• reload( ); åŸç†å°±æ˜¯é€šè¿‡æ§åˆ¶ç»„ä»¶å®¹å™¨çš„å‡ºç°ä¸æ¶ˆå¤±, è¾¾åˆ°é‡æ–°æ¸²æŸ“çš„æ•ˆæœ , ä»è€Œå®ç°æˆ‘ä»¬çš„ç›®çš„;</p><p><strong>ç¬¬äºŒæ­¥:åœ¨å…¨å±€ä¸­å®šä¹‰äº†åˆ·æ–°çš„æ–¹æ³•, æ¥ä¸‹æ¥å°±æ˜¯è¦å¼•å…¥åˆ°éœ€è¦åˆ·æ–°çš„ç»„ä»¶ä¸­:</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  inject:[<span class="string">"reload"</span>],</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="keyword">this</span>.reload();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ <strong>inject æ–¹æ³•</strong>å¼•å…¥åˆ°éœ€è¦çš„ç»„ä»¶ä¸­, ç›´æ¥<strong>this.reload()</strong> è°ƒç”¨è¿™ä¸ªæ–¹æ³•å³å¯.</p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>React-SSR</title>
      <link href="/2020/06/13/workspace/Frame/react/ssr/"/>
      <url>/2020/06/13/workspace/Frame/react/ssr/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>React-SSR</strong></p><p>[[toc]]</p><hr><p>å…ˆé™„ä¸Šgithubåœ°å€<a href="https://github.com/hzfvictory/react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚" target="_blank" rel="noopener">https://github.com/hzfvictory/react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚</a></p><p>æ¬¢è¿å¤§å®¶ç‚¹star,æissueï¼Œä¸€èµ·è¿›æ­¥ï¼ğŸ˜„ </p><h3 id="å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“"><a href="#å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“" class="headerlink" title="å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“"></a>å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“</h3><p><strong>CSR:</strong></p><p>é¡µé¢æ¸²æŸ“æ˜¯JSè´Ÿè´£è¿›è¡Œçš„</p><p>æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›HTMLâ€“&gt;æµè§ˆå™¨å‘é€bundle.jsè¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›bundle.jsâ€“&gt;æµè§ˆå™¨æ‰§è¡Œbundle.jsä¸­çš„reactä»£ç å®Œæˆæ¸²æŸ“</p><p><strong>SSR:</strong></p><p>æœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›HTMLè®©æµè§ˆå™¨ç›´æ¥æ¸²æŸ“</p><p>æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿è¡ŒReactä»£ç ç”Ÿæˆé¡µé¢â€“&gt;æœåŠ¡å™¨è¿”å›é¡µé¢</p><p><strong>ä¼ ç»ŸCSRçš„å¼Šç«¯:</strong></p><ol><li><p>ç”±äºé¡µé¢æ˜¾ç¤ºè¿‡ç¨‹è¦è¿›è¡ŒJSæ–‡ä»¶æ‹‰å–å’ŒReactä»£ç æ‰§è¡Œï¼Œåœ¨è¿™ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­è‡³å°‘æ¶‰åŠåˆ°ä¸¤ä¸ª HTTPè¯·æ±‚å‘¨æœŸï¼ˆhtml+jsï¼‰ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€å®šçš„è€—æ—¶ï¼Œé¦–å±åŠ è½½æ—¶é—´ä¼šæ¯”è¾ƒæ…¢ã€‚</p></li><li><p>å¯¹äºSEO(Search Engine Optimazition,å³æœç´¢å¼•æ“ä¼˜åŒ–)ï¼Œå®Œå…¨æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæœç´¢å¼•æ“çˆ¬è™«åªè®¤è¯†htmlç»“æ„çš„å†…å®¹ï¼Œè€Œä¸èƒ½è¯†åˆ«JSä»£ç å†…å®¹ã€‚</p></li></ol><p><strong>SSRçš„å¼Šç«¯:</strong></p><p>ssrçš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›ä¼ ç»ŸCSRçš„å¼Šç«¯</p><p>åœ¨ React ä¸­ä½¿ç”¨ ssr æŠ€æœ¯ï¼Œæˆ‘ä»¬è®© React ä»£ç åœ¨æœåŠ¡å™¨ç«¯å…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œä½¿å¾—ç”¨æˆ·ä¸‹è½½çš„ HTML å·²ç»åŒ…å«äº†æ‰€æœ‰çš„é¡µé¢å±•ç¤ºå†…å®¹ï¼Œè¿™æ ·ï¼Œé¡µé¢å±•ç¤ºçš„è¿‡ç¨‹åªéœ€è¦ç»å†ä¸€ä¸ª HTTP è¯·æ±‚å‘¨æœŸï¼ŒTTFPï¼ˆTime To First Pageï¼‰ æ—¶é—´å¾—åˆ°ä¸€å€ä»¥ä¸Šçš„ç¼©å‡</p><p>ä½†æ˜¯ä½¿ç”¨ ssr è¿™ç§æŠ€æœ¯ï¼Œå°†ä½¿åŸæœ¬ç®€å•çš„ React é¡¹ç›®å˜å¾—éå¸¸å¤æ‚</p><ol><li><p>ç›¸å¯¹äºä»…ä»…éœ€è¦æä¾›é™æ€æ–‡ä»¶çš„æœåŠ¡å™¨ï¼Œssrä¸­ä½¿ç”¨çš„æ¸²æŸ“ç¨‹åºè‡ªç„¶ä¼šå ç”¨æ›´å¤šçš„CPUå’Œå†…å­˜èµ„æº</p></li><li><p>åœ¨æœåŠ¡å™¨ç”Ÿæˆçš„é¡µé¢æ‰€ä»¥ï¼Œä¸€äº›å¸¸ç”¨çš„æµè§ˆå™¨APIå¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚windowã€docmentå’Œalertç­‰ï¼Œå¦‚æœä½¿ç”¨çš„è¯éœ€è¦å¯¹è¿è¡Œçš„ç¯å¢ƒåŠ ä»¥åˆ¤æ–­</p></li><li><p>å¼€å‘è°ƒè¯•ä¼šæœ‰ä¸€äº›éº»çƒ¦ï¼Œå› ä¸ºæ¶‰åŠäº†æµè§ˆå™¨åŠæœåŠ¡å™¨ï¼Œå¯¹äºSPAçš„ä¸€äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ä¼šå˜å¾—å¤æ‚</p></li><li><p>å¯èƒ½ä¼šç”±äºæŸäº›å› ç´ å¯¼è‡´æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ç»“æœä¸æµè§ˆå™¨ç«¯çš„ç»“æœä¸ä¸€è‡´ï¼Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¼šé™ä½ï¼Œä»£ç é—®é¢˜çš„è¿½æº¯ä¹Ÿä¼šå˜å¾—å›°éš¾</p></li></ol><p>æ‰€ä»¥ï¼Œä½¿ç”¨ ssr åœ¨è§£å†³é—®é¢˜çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¸¦æ¥éå¸¸å¤šçš„å‰¯ä½œç”¨ï¼Œæœ‰çš„æ—¶å€™ï¼Œè¿™äº›å‰¯ä½œç”¨çš„ä¼¤å®³æ¯”èµ· ssr æŠ€æœ¯å¸¦æ¥çš„ä¼˜åŠ¿è¦å¤§çš„å¤šã€‚ä¸€èˆ¬å»ºè®®ssrï¼Œé™¤éä½ çš„é¡¹ç›®ç‰¹åˆ«ä¾èµ–æœç´¢å¼•æ“æµé‡ï¼Œæˆ–è€…å¯¹é¦–å±æ—¶é—´æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨ ssr,å¦‚æœåªå¯¹seoæœ‰è¦æ±‚å¯ä½¿ç”¨ <a href="https://github.com/prerender/prerender" target="_blank" rel="noopener">prerenderé¢„æ¸²æŸ“</a>ã€‚</p><h3 id="SSRçš„å®ç°æœ¬è´¨"><a href="#SSRçš„å®ç°æœ¬è´¨" class="headerlink" title="SSRçš„å®ç°æœ¬è´¨"></a>SSRçš„å®ç°æœ¬è´¨</h3><p>è¿™é‡Œä»‹ç»çš„æ˜¯ssrï¼Œæ˜¯åŸºäºReact çš„SPAé¡¹ç›®ï¼Œä¸æ˜¯åƒ thinkphpã€jspã€nodeJs+ejs è¿™ç§çº¯åç«¯ç›´å‡ºæ¸²æŸ“æ–¹å¼ï¼Œæ‰€ä»¥è¿™ç§å¤§å¤šæ•°åªæ˜¯é’ˆå¯¹é¦–å±çš„ssr,å› ä¸ºæµè§ˆå™¨çš„è·¯ç”±è·³è½¬æ–¹å¼æ˜¯ç”¨çš„H5çš„<code>history  API</code>çš„<code>window.history.pushState()</code> ï¼Œä½¿å¾—æˆ‘ä»¬å³å¯ä»¥ä¿®æ”¹ <code>url</code> ä¹Ÿå¯ä»¥ä¸åˆ·æ–°é¡µé¢ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šèµ°æœåŠ¡ç«¯çš„ã€å¯ä»¥é€šè¿‡é¢„åŠ è½½è·å–éœ€è¦çš„æ•°æ®ã€‘ã€‚</p><p><strong>ssr ä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºè™šæ‹Ÿ DOM çš„å­˜åœ¨</strong></p><p>ssr çš„å·¥ç¨‹ä¸­ï¼ŒReact ä»£ç ä¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å„æ‰§è¡Œä¸€æ¬¡,å› ä¸ºä»£ç åœ¨ Node ç¯å¢ƒä¸‹æ˜¯æ²¡æœ‰DOMè¿™ä¸ªæ¦‚å¿µçš„ï¼Œæ‰€ä»¥åœ¨React æ¡†æ¶ä¸­å¼•å…¥äº†ä¸€ä¸ªæ¦‚å¿µå«åšè™šæ‹Ÿ DOMï¼ŒReact åœ¨åšé¡µé¢æ“ä½œæ—¶ï¼Œå®é™…ä¸Šä¸æ˜¯ç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯æ“ä½œè™šæ‹Ÿ DOMï¼Œä¹Ÿå°±æ˜¯æ“ä½œæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œè¿™å°±ä½¿å¾— ssr æˆä¸ºäº†å¯èƒ½ã€‚åœ¨æœåŠ¡å™¨ï¼Œæˆ‘å¯ä»¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œåˆ¤æ–­ç¯å¢ƒæ˜¯æœåŠ¡å™¨ç¯å¢ƒï¼Œæˆ‘ä»¬æŠŠè™šæ‹Ÿ DOM æ˜ å°„æˆå­—ç¬¦ä¸²è¾“å‡ºï¼›åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œåˆ¤æ–­ç¯å¢ƒæ˜¯å®¢æˆ·ç«¯ç¯å¢ƒï¼Œæˆ‘å°±ç›´æ¥å°†è™šæ‹Ÿ DOM æ˜ å°„æˆçœŸå® DOMï¼Œå®Œæˆé¡µé¢æŒ‚è½½ã€‚</p><h3 id="æ–¹æ¡ˆç­›é€‰"><a href="#æ–¹æ¡ˆç­›é€‰" class="headerlink" title="æ–¹æ¡ˆç­›é€‰"></a>æ–¹æ¡ˆç­›é€‰</h3><ul><li><a href="[https://nextjs.frontendx.cn/docs/#%E5%AE%89%E8%A3%85](https://nextjs.frontendx.cn/docs/#å®‰è£…)">next.js</a>/<a href="https://www.nuxtjs.cn/guide/installation" target="_blank" rel="noopener">nuxt.js</a>      æˆæœ¬ä½,å®‰å¿ƒçš„å†™é¡µé¢å°±è¡Œäº†ï¼Œæ— éœ€è¿‡å¤šå…³å¿ƒæœåŠ¡ç«¯è·¯ç”±ï¼ˆå¤šé¡µé¢åº”ç”¨ï¼Œæ–°æ¡†æ¶ï¼‰</li><li><a href="https://github.com/hzfvictory/prerender" target="_blank" rel="noopener">prerender </a>å®ç°spaé¡¹ç›®çš„æœåŠ¡ç«¯é¢„æ¸²æŸ“</li><li>ä½¿ç”¨è°·æ­Œ <a href="https://github.com/hzfvictory/rendertron" target="_blank" rel="noopener">rendertron</a> å®ç°spaé¡¹ç›®çš„æœåŠ¡ç«¯æ¸²æŸ“ ã€æ®è¯´ä¼šè¢«åˆ¤ä½œå¼Šçš„ï¼Œé™æƒå¤„ç†ã€‘</li><li>ç§‰æ‰¿å­¦ä¹ çš„æ€åº¦äº†è§£ä¸‹åŸºæœ¬åŸç†ï¼Œé€‰æ‹©äº†è‡ªå·±å»æ­ï¼Œï¼ˆä¸­é—´æ–­äº†ä¸€æ®µæ—¶é—´ï¼Œç°åœ¨åˆé‡æ–°æ‹¾èµ·æ¥ï¼‰ï¼Œä¹‹å‰çœ‹åˆ°æœ‰äººç”¨ react + redux + Express æ­ssrçš„æ–‡ç« ï¼Œæ‰€ä»¥åŸºäºå¯¹dvaå’Œkoaçš„ç†Ÿæ‚‰å’Œç‰¹åˆ«å–œå¥½ï¼Œå°±ç›´æ¥é€‰æ‹©äº†dva-core + koa åšçŠ¶æ€ç®¡ç†æ­å»ºã€‚</li></ul><h3 id="Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR"><a href="#Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR" class="headerlink" title="Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR"></a>Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR</h3><h4 id="ä¸ä½¿ç”¨koa-router"><a href="#ä¸ä½¿ç”¨koa-router" class="headerlink" title="ä¸ä½¿ç”¨koa-router"></a>ä¸ä½¿ç”¨koa-router</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.path === <span class="string">'/'</span>) &#123;</span><br><span class="line">    ctx.body =</span><br><span class="line">      <span class="string">`</span></span><br><span class="line"><span class="string">     &lt;html&gt;</span></span><br><span class="line"><span class="string">       &lt;head&gt;</span></span><br><span class="line"><span class="string">         &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span><br><span class="line"><span class="string">       &lt;/head&gt;</span></span><br><span class="line"><span class="string">       &lt;body&gt;</span></span><br><span class="line"><span class="string">         &lt;h1&gt;hello&lt;/h1&gt;</span></span><br><span class="line"><span class="string">         &lt;h2&gt;world&lt;/h2&gt;</span></span><br><span class="line"><span class="string">       &lt;/body&gt;</span></span><br><span class="line"><span class="string">     &lt;/html&gt;</span></span><br><span class="line"><span class="string">     `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> server = app.listen(<span class="string">'9999'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;port&#125; = server.address();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨koa-router"><a href="#ä½¿ç”¨koa-router" class="headerlink" title="ä½¿ç”¨koa-router"></a>ä½¿ç”¨koa-router</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> route = <span class="built_in">require</span>(<span class="string">"koa-router"</span>)() <span class="comment">// è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">route.get(<span class="string">"/"</span>, (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body =</span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">   &lt;html&gt;</span></span><br><span class="line"><span class="string">       &lt;head&gt;</span></span><br><span class="line"><span class="string">         &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span><br><span class="line"><span class="string">       &lt;/head&gt;</span></span><br><span class="line"><span class="string">       &lt;body&gt;</span></span><br><span class="line"><span class="string">         &lt;h1&gt;hello&lt;/h1&gt;</span></span><br><span class="line"><span class="string">         &lt;h2&gt;world&lt;/h2&gt;</span></span><br><span class="line"><span class="string">       &lt;/body&gt;</span></span><br><span class="line"><span class="string">     &lt;/html&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(route.routes());</span><br><span class="line">app.use(route.allowedMethods()); <span class="comment">//è‡ªåŠ¨è®¾ç½®å“åº”å¤´ctx.statuså®Œå–„responseå“åº”å¤´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = app.listen(<span class="string">'9999'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;port&#125; = server.address();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯æ¸²æŸ“å°±æå®šäº†ï¼ŒæœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›HTMLè®©æµè§ˆå™¨ç›´æ¥æ¸²æŸ“ï¼Œè€Œä¸”ç½‘é¡µæºä»£ç ä¸­æ˜¯æœ‰è¿™äº›domä¿¡æ¯çš„å¯¹seoéå¸¸å‹å¥½ï¼Œæˆ‘ä»¬reactã€vueè¿™äº›éƒ½æ˜¯é€šè¿‡webpackå¼•å…¥äº†js,æ‰€æœ‰çš„åŠŸèƒ½é¡µé¢å±•ç¤ºç»Ÿç»Ÿç”±jså®Œæˆã€‚</p><h3 id="å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“"><a href="#å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“" class="headerlink" title="å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“"></a>å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“</h3><p>åˆ°è¿™ä¸€æ­¥å·²ç»ä¸èƒ½ç›´æ¥ç”¨nodeå¯åŠ¨æœåŠ¡äº†ï¼Œå› ä¸ºæ²¡æœ‰<code>babel</code>ï¼Œ  Reactä¸ä¼šè½¬åŒ–æˆ<code>createElement</code>çš„å½¢å¼ï¼Œè€Œä¸”ä½¿ç”¨nodeä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨importå¯¼å…¥æ–¹å¼ã€‚</p><p>éšä¾¿ç¼–å†™ä¸€ä¸ªReactçš„ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/pages/home</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;Homeç»„ä»¶&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æŠŠå½“å‰ç»„ä»¶ï¼Œä½¿ç”¨æœåŠ¡å‘˜æ¸²æŸ“å‡ºæ¥ï¼Œçœ‹ä¸‹é¢é…ç½®ï¼š</p><h4 id="Webpack-base"><a href="#Webpack-base" class="headerlink" title="Webpack base"></a>Webpack base</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.base.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.js|jsx$/</span>,</span><br><span class="line">      loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        presets: [<span class="string">'@babel/preset-react'</span>, [<span class="string">'@babel/preset-env'</span>, &#123;</span><br><span class="line">          targets: &#123;</span><br><span class="line">            browsers: [<span class="string">'last 2 versions'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœåŠ¡å™¨ç«¯-Webpack-é…ç½®"><a href="#æœåŠ¡å™¨ç«¯-Webpack-é…ç½®" class="headerlink" title="æœåŠ¡å™¨ç«¯ Webpack é…ç½®"></a>æœåŠ¡å™¨ç«¯ Webpack é…ç½®</h4><p>æœåŠ¡ç«¯è¿è¡Œçš„ä»£ç å¦‚æœéœ€è¦ä¾èµ– Node æ ¸å¿ƒæ¨¡å—æˆ–è€…ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œ<code>å°±ä¸å†éœ€è¦æŠŠå®¢æˆ·ç«¯çš„ä¸€äº›æ¨¡å—ä»£ç æ‰“åŒ…åˆ°æœ€ç»ˆä»£ç ä¸­äº†</code>ã€‚å› ä¸ºç¯å¢ƒå·²ç»å®‰è£…è¿™äº›ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±éœ€è¦æˆ‘ä»¬åœ¨ webpack ä¸­é…ç½®ï¼š<code>targetï¼šnode</code>ï¼Œå¹¶å€ŸåŠ© webpack-node-externals æ’ä»¶ï¼Œè§£å†³ç¬¬ä¸‰æ–¹ä¾èµ–æ‰“åŒ…çš„é—®é¢˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.server.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> nodeExternals = <span class="built_in">require</span>(<span class="string">'webpack-node-externals'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.base'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverConfig = &#123;</span><br><span class="line">  target: <span class="string">'node'</span>, <span class="comment">// ç¼–è¯‘å‡ºèƒ½è®©nodeè¯†åˆ«çš„ä»£ç   https://webpack.docschina.org/concepts/targets/</span></span><br><span class="line">  mode: <span class="string">'development'</span>, <span class="comment">// è¿™é‡Œçš„modeè¦ç‰¹åˆ«æ³¨æ„</span></span><br><span class="line">  entry: <span class="string">'./src/server/index.js'</span>, <span class="comment">// å¯¹åº”æœåŠ¡ç«¯çš„ä»£ç </span></span><br><span class="line">  <span class="comment">// https://webpack.docschina.org/configuration/externals/</span></span><br><span class="line">  externals: [nodeExternals()], <span class="comment">// ä¸ºäº†å¿½ç•¥node_modulesæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ¨¡å—</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../bundle'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = merge(config, serverConfig)</span><br></pre></td></tr></table></figure><p> <strong>target: â€˜nodeâ€™ å’Œ target: â€˜webâ€™ çš„å¤§è‡´åŒºåˆ«</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// target: 'node'</span></span><br><span class="line">exports.ids = [<span class="number">0</span>];</span><br><span class="line">exports.modules = &#123;&#125;;</span><br><span class="line"><span class="comment">// target: 'web' </span></span><br><span class="line">(<span class="built_in">window</span>[<span class="string">"webpackJsonp"</span>] = <span class="built_in">window</span>[<span class="string">"webpackJsonp"</span>] || []).push([[<span class="number">0</span>],&#123;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js</span></span><br><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">"koa-router"</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>; <span class="comment">// å¿…é¡»å¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">'react-dom/server'</span>; <span class="comment">// react-domæä¾›çš„æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"../src/pages/home"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> route = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> content = renderToString(<span class="xml"><span class="tag">&lt;<span class="name">Home</span>/&gt;</span></span>);</span><br><span class="line"></span><br><span class="line">route.get(<span class="string">"/"</span>, (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body =</span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">      &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span><br><span class="line"><span class="string">      &lt;/head&gt;</span></span><br><span class="line"><span class="string">      &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;div id="root"&gt;<span class="subst">$&#123;content&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(route.routes());</span><br><span class="line">app.use(route.allowedMethods());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = app.listen(<span class="string">'9999'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;port&#125; = server.address();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä½¿ç”¨äº†<strong>renderToString</strong>, æˆ‘ä»¬éƒ½çŸ¥é“react-domæä¾›äº†å››ç§æœåŠ¡ç«¯æ¸²æŸ“å‡½æ•°,å¦‚ä¸‹:</p><ol><li><strong>renderToString</strong>ï¼šå°† React Component è½¬åŒ–ä¸º HTML å­—ç¬¦ä¸²ï¼Œç”Ÿæˆçš„ HTML çš„ DOM ä¼šå¸¦æœ‰é¢å¤–å±æ€§ï¼šå„ä¸ª DOM ä¼šæœ‰data-react-idå±æ€§ï¼Œç¬¬ä¸€ä¸ª DOM ä¼šæœ‰data-reactrootå±æ€§ã€‚</li><li><strong>renderToStaticMarkup</strong>ï¼šå°† React Component è½¬åŒ–ä¸º HTML å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”Ÿæˆ HTML çš„ DOM ä¸ä¼šæœ‰é¢å¤–å±æ€§ï¼Œä»è€ŒèŠ‚çœ HTML å­—ç¬¦ä¸²çš„å¤§å°ã€‚</li><li><strong>renderToNodeStream:</strong> ä»¥æµçš„å½¢å¼è¾“å‡ºhtml, ä¸ç”¨åƒrenderToStringç”Ÿæˆæ•´ä¸ªhtmlæ‰å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç›¸å¯¹äºrenderToStringèƒ½æ›´å¿«çš„å“åº”å®¢æˆ·ç«¯ï¼Œæå‡é¡µé¢æ¸²æŸ“é€Ÿåº¦ã€‚</li><li><strong>renderToStaticNodeStream</strong>ï¼šå’Œ renderToNodeStreamä¸€æ ·ï¼Œä¹Ÿæ˜¯è¾“å‡ºæµï¼Œä½†æ˜¯htmlä¸­ä¸å¸¦data-reactrootç­‰å±æ€§ã€‚</li></ol><p><strong>å¯¹äºæœåŠ¡ç«¯æ¸²æŸ“è€Œè¨€</strong></p><ul><li><strong>renderToString</strong>æ–¹æ³•æ¸²æŸ“çš„èŠ‚ç‚¹ä¼šå¸¦æœ‰data-react-idå±æ€§, åœ¨å‰ç«¯ react åŠ è½½å®Œæˆå, å‰ç«¯ react ä¼šè®¤è¯†ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹, ä¸ä¼šé‡æ–°æ¸²æŸ“ DOM èŠ‚ç‚¹, å‰ç«¯ react ä¼šæ¥ç®¡é¡µé¢, æ‰§è¡Œ <code>componentDidMout</code> ç»‘å®šæµè§ˆå™¨äº‹ä»¶ç­‰ è¿™äº›åœ¨æœåŠ¡ç«¯æ²¡å®Œæˆä¹Ÿä¸å¯èƒ½æ‰§è¡Œä»»åŠ¡ã€‚</li><li><strong>renderToStaticMarkup</strong> æ¸²æŸ“å‡ºçš„æ˜¯ä¸å¸¦<code>data-react-id</code>çš„çº¯ html åœ¨å‰ç«¯ react åŠ è½½å®Œæˆå, ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„é¡µé¢ä¼šæŠ¹æ‰ä¹‹å‰æœåŠ¡ç«¯çš„é‡æ–°æ¸²æŸ“(å¯èƒ½é¡µé¢ä¼šé—ªä¸€ä¸‹). æ¢å¥è¯è¯´ <strong>å‰ç«¯reactå°±æ ¹æœ¬å°±ä¸è®¤è¯†ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹</strong>, render æ–¹æ³•ä¼šä½¿ç”¨ innerHTML çš„æ–¹æ³•é‡å†™ #react-target é‡Œçš„å†…å®¹</li></ul><p>åœ¨packageæ·»åŠ å¯åŠ¨é…ç½®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"npm-run-all --parallel dev:build:server dev:start"</span>,</span><br><span class="line">    <span class="string">"dev:build:server"</span>: <span class="string">"webpack --config config/webpack.server.js --watch"</span>,</span><br><span class="line">    <span class="string">"dev:start"</span>: <span class="string">"nodemon ./bundle/bundle.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ  yarn dev ,æ‰“å¼€ <a href="">http://localhost:9999/ </a>é¡µé¢ç›´æ¥åœ¨æµè§ˆä¸Šæ˜¾ç¤ºï¼Œ åˆ°æ­¤ï¼Œå°±åˆæ­¥å®ç°äº†ä¸€ä¸ªReactç»„ä»¶æ˜¯æœåŠ¡ç«¯æ¸²æŸ“,åŠ å…¥ä½ åœ¨ç»„ä»¶Homeé‡Œé¢æ·»åŠ ä¸€äº›æ–¹æ³•æˆ–è€…è°ƒå–æ¥å£ï¼Œä½ ä¼šå‘ç°è¿™äº›éƒ½æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ¥ä¸‹æ¥è¿›ä¸€æ­¥å®Œå–„ã€‚</p><h3 id="åŒæ„"><a href="#åŒæ„" class="headerlink" title="åŒæ„"></a>åŒæ„</h3><p>è¦è§£å†³ä¸Šé¢ä¸Šé¢çš„é—®é¢˜ï¼Œå°±éœ€è¦åŒæ„äº†ï¼Œæ‰€è°“åŒæ„ï¼Œé€šä¿—çš„è®²ï¼Œå°±æ˜¯ä¸€å¥—Reactä»£ç åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€éï¼Œåˆ°æµè§ˆå™¨æ¸²æŸ“æ—¶åœ¨è¿è¡Œä¸€éï¼ŒæœåŠ¡ç«¯æ¸²æŸ“å®Œæˆé¡µé¢ç»“æ„ï¼Œæµè§ˆå™¨ç«¯æ¸²æŸ“å®Œæˆäº‹ä»¶ç»‘å®šæ¥å£è°ƒå–ï¼ˆé‡å¤åŠ è½½çš„jsæˆ–è€…csså®¢æˆ·ç«¯åè°ƒé˜¶æ®µæ—¶å€™ä¼šè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸€æ ·åˆ™ä¸æ¸²æŸ“äº†ï¼‰ã€‚</p><h4 id="å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS"><a href="#å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS" class="headerlink" title="å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS"></a>å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS</h4><p>æŠŠæ‰“åŒ…åçš„js,æ³¨å…¥åˆ°htmlä¸­ï¼Œè¿™æ ·åˆ°æµè§ˆå™¨å°±ä¼šå†æ¬¡è¯·æ±‚ï¼Œå°±å¯ä»¥å®Œæˆäº‹ä»¶ç»‘å®šç­‰è¡Œä¸ºæ“ä½œã€‚</p><p>æˆ‘ä»¬è¦ç”¨åˆ°react-domçš„<code>hydrate</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// client/index.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;BrowserRouter <span class="keyword">as</span> Router, Switch&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;renderRoutes&#125; <span class="keyword">from</span> <span class="string">'react-router-config'</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span>; <span class="comment">// è¿™é‡Œæ˜¯æˆ‘çš„ä¸€ä¸ªè·¯ç”±æ‹†åˆ†ï¼Œä½ ä»¬å¯ä»¥ä¸ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'../router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">        &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Router&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Loadable.preloadReady().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ReactDom.hydrate(</span><br><span class="line">    &lt;App/&gt;, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>hydrate() æè¿°çš„æ˜¯ ReactDOM å¤ç”¨ ReactDOMServer æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹æ—¶å°½å¯èƒ½ä¿ç•™ç»“æ„ï¼Œå¹¶è¡¥å……äº‹ä»¶ç»‘å®šç­‰ Client ç‰¹æœ‰å†…å®¹çš„è¿‡ç¨‹</p><p>è¯´ç™½äº†<code>render()</code> æ ‡ç­¾ä¸Šæ²¡æœ‰å”¯ä¸€çš„å±æ€§ï¼Œä½†æ˜¯è¦å°½å¯èƒ½å¤ç”¨ ssr çš„ HTML ç»“æ„,æ‰€ä»¥å°±å‡ºç°äº†<code>hydrate()</code>,ä½†æ˜¯ç›®å‰ä¸¤è€…éƒ½æ˜¯å¯ä»¥ç”¨çš„ï¼Œ17ç‰ˆæœ¬<code>render()</code>å°±ä¸åœ¨æ”¯æŒ<code>ssr</code></p><p><a href="https://www.zhihu.com/question/66068748" target="_blank" rel="noopener">çŸ¥ä¹å¯¹ ReactDom.hydrate çš„è§£é‡Š</a></p><p>ç„¶åé…ç½®å®¢æˆ·ç«¯çš„webpackå°†å…¶ç¼–è¯‘æ‰“åŒ…æˆjsï¼Œåœ¨æœåŠ¡ç«¯htmlé‡Œé¢å¼•å…¥ã€‚</p><h4 id="å®¢æˆ·ç«¯-Webpack-é…ç½®"><a href="#å®¢æˆ·ç«¯-Webpack-é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯ Webpack é…ç½®"></a>å®¢æˆ·ç«¯ Webpack é…ç½®</h4><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ‰“åŒ…åçš„è¾“å‡ºç›®å½•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/outputPath </span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  OUTPUTCLIENT: <span class="string">'static'</span>,</span><br><span class="line">  OUTPUTSERVER: <span class="string">'bundle'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.client.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.base'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;OUTPUTCLIENT&#125; = <span class="built_in">require</span>(<span class="string">"./outputPath"</span>)</span><br><span class="line"><span class="keyword">const</span> outputPath = <span class="string">`../<span class="subst">$&#123;OUTPUTCLIENT&#125;</span>`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clientConfig = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  entry: path.resolve(__dirname, <span class="string">'../client/index.js'</span>),</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'index.[chunkhash:8].js'</span>, <span class="comment">// è¿™é‡Œæˆ‘ç”¨çš„hashï¼Œç›®çš„æ˜¯é˜²æ­¢ç¼“å­˜</span></span><br><span class="line">    path: path.resolve(__dirname, outputPath),</span><br><span class="line">    publicPath: <span class="string">'/'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css?$/</span>,</span><br><span class="line">        use: [<span class="string">'style-loader'</span>, &#123;<span class="comment">// è¿™é‡Œå»ºè®®ä½¿ç”¨style-loaderï¼Œå°‘é‡çš„cssç›´æ¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“äº†</span></span><br><span class="line">          loader: <span class="string">'css-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            modules: <span class="literal">true</span>, <span class="comment">// è¿™è¦è·ŸæœåŠ¡ç«¯ä¿æŒä¸€è‡´ï¼Œä¸ç„¶headé‡Œé¢æœ‰æ ·å¼ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰å¯¹åº”çš„class</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpeg|jpg|gif|svg)?$/</span>,</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          limit: <span class="number">8000</span>,</span><br><span class="line">          outputPath: outputPath, <span class="comment">// è¾“å…¥è·¯å¾„</span></span><br><span class="line">          publicPath: <span class="string">'/'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = merge(config, clientConfig)</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ä¸Šé¢çš„<code>package.json</code>,é‡Œé¢æ·»åŠ <code>&quot;dev:build:client&quot;: &quot;webpack --config webpack.client.js --watch&quot;</code>ï¼Œå°±èƒ½å¯¹æµè§ˆå™¨ç”¨åˆ°çš„ä¸€äº›jså®Œæˆæ‰“åŒ…ã€‚</p><h4 id="æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘"><a href="#æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘" class="headerlink" title="æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘"></a>æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘</h4><p>æœåŠ¡å™¨ç«¯è·¯ç”±ä»£ç ç›¸å¯¹è¦å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦ä½ æŠŠ <code>location</code>ï¼ˆå½“å‰è¯·æ±‚è·¯å¾„ï¼‰ä¼ é€’ç»™ <code>StaticRouter</code> ç»„ä»¶ï¼Œè¿™æ · <code>StaticRouter</code> æ‰èƒ½æ ¹æ®è·¯å¾„åˆ†æå‡ºå½“å‰æ‰€éœ€è¦çš„ç»„ä»¶æ˜¯è°ã€‚ï¼ˆPSï¼š<code>StaticRouter</code> æ˜¯ <code>React-Router</code>é’ˆå¯¹æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸“é—¨æä¾›çš„ä¸€ä¸ªè·¯ç”±ç»„ä»¶ã€‚ï¼‰</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js</span></span><br><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">"koa-router"</span></span><br><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">'react-dom/server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;StaticRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span>;</span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'@/router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;renderRoutes, matchRoutes&#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;renderHTML&#125; <span class="keyword">from</span> <span class="string">"./tem"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> route = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line">route.get([<span class="string">"/:route?"</span>, /\/<span class="function">(<span class="params">[\w|\d]+</span>)\/.*/], (<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> content = renderToString(</span><br><span class="line">    <span class="comment">// é‡ç‚¹æ˜¯è¿™</span></span><br><span class="line">    &lt;StaticRouter location=&#123;ctx.path&#125;&gt;</span><br><span class="line">        &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">    &lt;<span class="regexp">/StaticRouter&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">  ctx.body = renderHTML(content, &#123;&#125;)</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ è¿™é‡Œè¦æ³¨æ„ä¸‹ä¸­é—´ä»¶çš„å…ˆåé¡ºåº</span></span><br><span class="line"><span class="regexp">app.use(require('koa-static')(process.cwd() + '/</span><span class="keyword">static</span><span class="string">'));</span></span><br><span class="line"><span class="string">app.use(route.routes());</span></span><br><span class="line"><span class="string">app.use(route.allowedMethods());</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Loadable.preloadAll().then(() =&gt; &#123;</span></span><br><span class="line"><span class="string">  const server = app.listen('</span><span class="number">9999</span><span class="string">', () =&gt; &#123;</span></span><br><span class="line"><span class="string">    const &#123;port&#125; = server.address();</span></span><br><span class="line"><span class="string">    console.log(`\x1B[33m\x1B[4mhttp://localhost:$&#123;port&#125;\x1B[0m`)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/tem.js</span></span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>);</span><br><span class="line"><span class="keyword">let</span> project = glob.sync(process.cwd() + <span class="string">'/static/index.*.js'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> path = project[<span class="number">0</span>].split(<span class="string">'/'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> renderHTML = <span class="function">(<span class="params">content, store</span>) =&gt;</span> <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">    &lt;html lang="zh"&gt;</span></span><br><span class="line"><span class="string">      &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;meta charset="utf-8"&gt;</span></span><br><span class="line"><span class="string">        &lt;meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" /&gt;</span></span><br><span class="line"><span class="string">        &lt;meta name="theme-color" content="#000000"&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span><br><span class="line"><span class="string">      &lt;/head&gt;</span></span><br><span class="line"><span class="string">      &lt;body&gt;</span></span><br><span class="line"><span class="string">      &lt;div id="root"&gt;<span class="subst">$&#123;content&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;script src=/<span class="subst">$&#123;path[path.length - <span class="number">1</span>]&#125;</span>&gt;&lt;/script&gt; // è¿™ä¸ª '/' ä¸€å®šè¦æ·»åŠ ï¼Œå‘äº†å¥½ä¹…</span></span><br><span class="line"><span class="string">      &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/html&gt;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><h3 id="CSSæ ·å¼é—®é¢˜å¤„ç†"><a href="#CSSæ ·å¼é—®é¢˜å¤„ç†" class="headerlink" title="CSSæ ·å¼é—®é¢˜å¤„ç†"></a>CSSæ ·å¼é—®é¢˜å¤„ç†</h3><p>æ­£å¸¸çš„æœåŠ¡ç«¯æ¸²æŸ“åªæ˜¯è¿”å›äº† HTML å­—ç¬¦ä¸²ï¼Œæ ·å¼éœ€è¦æµè§ˆå™¨åŠ è½½å®Œ CSS åæ‰ä¼šåŠ ä¸Šï¼Œè¿™ä¸ªæ ·å¼æ·»åŠ çš„è¿‡ç¨‹å°±<code>ä¼šé€ æˆé¡µé¢çš„é—ªåŠ¨</code>ï¼Œæ‰€ä»¥åœ¨æœåŠ¡ç«¯é‡Œé¢ç›´æ¥æ·»åŠ éœ€è¦å¼•ç”¨çš„CSSã€‚</p><p>æˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨ style-loader äº†ï¼Œå› ä¸ºè¿™ä¸ª webpack loader ä¼šåœ¨ç¼–è¯‘æ—¶å°†æ ·å¼æ¨¡å—è½½å…¥åˆ° HTML header ä¸­ã€‚ä½†æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“ç¯å¢ƒä¸‹ï¼Œæ²¡æœ‰ window å¯¹è±¡ï¼Œstyle-loader è¿›è€Œä¼šæŠ¥é”™ã€‚ä¸€èˆ¬æˆ‘ä»¬æ¢ç”¨ <code>isomorphic-style-loader</code> ,åŒæ—¶ <code>isomorphic-style-loader</code>ä¹Ÿä¼šè§£å†³é¡µé¢æ ·å¼é—ªåŠ¨çš„é—®é¢˜ï¼Œå®ƒçš„åŸç†ä¹Ÿä¸éš¾ç†è§£ï¼š<code>isomorphic-style-loader</code>åˆ©ç”¨ context APIï¼Œåœ¨æ¸²æŸ“é¡µé¢ç»„ä»¶æ—¶è·å–æ‰€æœ‰ React ç»„ä»¶çš„æ ·å¼ä¿¡æ¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯è¾“å‡º html å­—ç¬¦ä¸²çš„åŒæ—¶ï¼Œä¹Ÿå°†æ ·å¼æ’å…¥åˆ° html å­—ç¬¦ä¸²å½“ä¸­ï¼Œå°†ç»“æœä¸€åŒä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚</p><p>å› ä¸ºæˆ‘ä»¬å·²ç»å¼€å¯äº†cssmodulesï¼Œæ‰€ä»¥ç›´æ¥å¯¼å…¥åˆ°headé‡Œé¢æ˜¯ä¸ä¼šå­˜åœ¨æ ·å¼å†²çªçš„é—®é¢˜ã€‚<code>isomorphic-style-loader</code>å·²ç»ç»™æˆ‘ä»¬æä¾›äº†ä¸€äº›å¯¼å…¥css çš„ é«˜é˜¶å‡½æ•° <code>withsSyles</code></p><p>å’Œ hooks <code>useStyles</code>ï¼Œç”¨çš„æ—¶å€™æ¯”è¾ƒçœäº‹ã€‚</p><p><strong>çœ‹ä¸‹ä»£ç é…ç½®</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.client.js</span></span><br><span class="line">&#123;</span><br><span class="line">  test: [<span class="regexp">/\.css|less$/</span>],</span><br><span class="line">    use: [</span><br><span class="line">      <span class="string">'style-loader'</span>, <span class="comment">// ä¹Ÿå¯ä»¥è·ŸæœåŠ¡ç«¯çš„ä¸€æ ·ï¼Œå°±æ˜¯éº»çƒ¦ç‚¹ï¼Œæ¯æ¬¡ä½¿ç”¨css,éƒ½éœ€è¦é¢å¤–çš„æ‰‹ç»­</span></span><br><span class="line">      &#123;</span><br><span class="line">        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          modules: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'less-loader'</span>,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/webpack.server.js</span></span><br><span class="line">&#123;</span><br><span class="line">  test: [<span class="regexp">/\.css|less$/</span>],</span><br><span class="line">    use: [</span><br><span class="line">      <span class="string">'isomorphic-style-loader'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          modules: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'less-loader'</span>  <span class="comment">// å¿…é¡»é…ç½® ä¸ç„¶ä¼šå½“æˆcss,è§†è§‰å¯èƒ½çœ‹ä¸å‡ºæ¥ï¼Œå› ä¸ºå®¢æˆ·ç«¯é…ç½®äº†less</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœåŠ¡ç«¯é¦–é¡µ</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js </span></span><br><span class="line"><span class="comment">//  ...</span></span><br><span class="line"><span class="keyword">const</span> css = <span class="keyword">new</span> <span class="built_in">Set</span>() <span class="comment">// è¿™ä¸ªå¿…é¡»åœ¨è·¯ç”±å‡½æ•°é‡Œé¢ï¼Œåœ¨å¤–é¢çš„è¯ï¼Œå°±ä¼šç´¯åŠ å‡ºç°ä¹‹å‰çš„css</span></span><br><span class="line"><span class="keyword">const</span> insertCss = <span class="function">(<span class="params">...styles</span>) =&gt;</span> styles.forEach(<span class="function"><span class="params">style</span> =&gt;</span> css.add(style._getCss()));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> content = renderToString(</span><br><span class="line">  &lt;StaticRouter location=&#123;ctx.path&#125;&gt;</span><br><span class="line">        &lt;StyleContext.Provider value=&#123;&#123;insertCss&#125;&#125;&gt; </span><br><span class="line">           &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">      &lt;<span class="regexp">/StyleContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">   &lt;/</span>StaticRouter&gt;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">ctx.body = renderHTML(content, &#123;&#125;, css)</span><br><span class="line"><span class="comment">// ....</span></span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯ä¹Ÿéœ€è¦é…ç½®</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// client/index.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;BrowserRouter <span class="keyword">as</span> Router&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;renderRoutes&#125; <span class="keyword">from</span> <span class="string">'react-router-config'</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span>;</span><br><span class="line"><span class="keyword">import</span> StyleContext <span class="keyword">from</span> <span class="string">'isomorphic-style-loader/StyleContext'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'../router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> insertCss = <span class="function">(<span class="params">...styles</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> removeCss = styles.map(<span class="function"><span class="params">style</span> =&gt;</span> style._insertCss &amp;&amp; style._insertCss());</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> removeCss.forEach(<span class="function"><span class="params">dispose</span> =&gt;</span> dispose &amp;&amp; dispose())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">        &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">    &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Loadable.preloadReady().then(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  ReactDom.hydrate(</span></span><br><span class="line"><span class="regexp">    &lt;StyleContext.Provider value=&#123;&#123;insertCss&#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;App/</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/StyleContext.Provider&gt;, document.getElementById('root'));</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨<code>isomorphic-style-loader</code>çš„ä¸€äº›API, <strong>æœ‰äº›<code>ä¸é‡è¦</code>çš„é¡µé¢ï¼Œæˆ–è€…ä¸é‡è¦çš„csså¯ä»¥ç›´æ¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</strong>,å°±ä¸éœ€è¦å¼•å…¥é«˜é˜¶å‡½æ•°æˆ–è€…useStylesã€‚</p><p>åœ¨é¡µé¢å†…å…·ä½“ä½¿ç”¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°å¼ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> useStyles <span class="keyword">from</span> <span class="string">'isomorphic-style-loader/useStyles'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">"./index.css"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  useStyles(styles)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç±»ç»„ä»¶ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> withStyles <span class="keyword">from</span> <span class="string">'isomorphic-style-loader/withStyles'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">"./index.css"</span></span><br><span class="line">@withStyles(styles) <span class="comment">// éœ€è¦åœ¨baseé‡Œé¢é¢å¤–é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">"./index.css"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨useStyles éƒ¨åˆ†ä½¿ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1 className=&#123;styles[<span class="string">'title-center'</span>]&#125;&gt;message&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h1 className=&#123;'title-center'&#125;&gt;message&lt;/</span>h1&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å¼€ç½‘é¡µçš„æºä»£ç å°±å¯ä»¥çœ‹è§headé‡Œé¢å·²ç»æœ‰æˆ‘ä»¬éœ€è¦çš„cssäº†ã€‚</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://user-gold-cdn.xitu.io/2020/7/23/1737b44ea25a4b63?w=1251&h=881&f=png&s=177846" alt="image-20200702185101916"></p><h3 id="SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å–-Dvaçš„ä½¿ç”¨"><a href="#SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å–-Dvaçš„ä½¿ç”¨" class="headerlink" title="SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨"></a>SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨</h3><h4 id="Dvaçš„ä½¿ç”¨"><a href="#Dvaçš„ä½¿ç”¨" class="headerlink" title="Dvaçš„ä½¿ç”¨"></a>Dvaçš„ä½¿ç”¨</h4><p>ä¹‹å‰é¡¹ç›®ä¸€ç›´ç”¨çš„dvaï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨çš„dva-coreä»£æ›¿çš„reduxï¼Œä¸ä¼šé…ç½®çš„è‡ªè¡ŒæŸ¥ä¸‹æ–‡æ¡£ã€‚</p><p>åˆ›å»º <code>Store</code>ï¼šè¿™ä¸€éƒ¨åˆ†æœ‰å‘ï¼Œè¦æ³¨æ„é¿å…ï¼Œå¤§å®¶çŸ¥é“ï¼Œåœ¨å®¢æˆ·ç«¯æ¸²æŸ“ä¸­ï¼Œç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ°¸è¿œåªå­˜åœ¨ä¸€ä¸ª <code>Store</code>ï¼Œæ‰€ä»¥ä»£ç ä¸Šä½ å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dvaApp = createApp(&#123;</span><br><span class="line">  initialState: &#123;&#125;,</span><br><span class="line">  models: models,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> store = dvaApp.getStore();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿™ä¹ˆå†™å°±æœ‰é—®é¢˜äº†ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯çš„ <code>Store</code> æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½è¦ç”¨çš„ï¼Œå¦‚æœåƒä¸Šé¢è¿™æ ·æ„å»º <code>Store</code>ï¼Œ<code>Store</code> å˜æˆäº†ä¸€ä¸ªå•ä¾‹ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº« <code>Store</code>ï¼Œæ˜¾ç„¶å°±æœ‰é—®é¢˜äº†ã€‚æ‰€ä»¥åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸­ï¼Œ<code>Store</code> çš„åˆ›å»ºåº”è¯¥iåƒä¸‹é¢è¿™æ ·ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ¯ä¸ªç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä¸ºæ¯ä¸ªç”¨æˆ·æä¾›ä¸€ä¸ªç‹¬ç«‹çš„ <code>Store</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dvaApp = createApp(&#123;</span><br><span class="line">  initialState: &#123;&#125;,</span><br><span class="line">  models: models,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStore =  <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> dvaApp.getStore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ«æ…Œï¼Œä½ å¦‚æœè¿™æ ·çš„åšçš„è¯ï¼Œreduxçš„æ•°æ®è¿˜æ˜¯æ‰€æœ‰å®¢æˆ·åŒæ­¥å…¬ç”¨ï¼Œå› ä¸ºä½ çš„modelæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯é™æ€å¯¼å…¥ï¼Œè¿™ä¸ªæ—¶å€™ä½ åº”è¯¥æŠŠmodelå†™æˆå‡½æ•°çš„å½¢å¼ï¼Œè¿™æ ·åå°æ¯æ¬¡éƒ½èƒ½è·å–åˆ°æœ€æ–°çš„æ•°æ®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> menuTree = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    namespace: <span class="string">'menuTree'</span>,</span><br><span class="line">    state: &#123;</span><br><span class="line">      routes: []</span><br><span class="line">    &#125;,</span><br><span class="line">    effects: &#123;</span><br><span class="line">      * reset(payload, &#123;call, put, select, update&#125;) &#123;</span><br><span class="line">         <span class="comment">// .........</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    reducers: &#123;</span><br><span class="line">      save(state, &#123;payload&#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;...state, ...payload&#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> menuTree</span><br></pre></td></tr></table></figure><p>æ¢æˆå‡½æ•°çš„å¯¼å‡ºå½¢å¼å°±OKäº†ï¼Œç„¶ååœ¨createAppçš„æ–¹æ³•ï¼ŒåŸæœ‰çš„<code>models.forEach(model =&gt; app.model(model);</code>è½¬æ¢æˆ <code>models.forEach(model =&gt; app.model(model()));</code> å°±OKäº†ã€‚</p><h4 id="æ•°æ®è·å–"><a href="#æ•°æ®è·å–" class="headerlink" title="æ•°æ®è·å–"></a>æ•°æ®è·å–</h4><p>æ•°æ®è·å–çš„è§£å†³æ–¹æ¡ˆæ˜¯é…ç½®è·¯ç”± route-router-configï¼Œç»“åˆ <code>matchRoutes</code>ï¼Œæ‰¾åˆ°é¡µé¢ä¸Šç›¸å…³ç»„ä»¶æ‰€éœ€çš„è¯·æ±‚æ¥å£çš„æ–¹æ³•å¹¶æ‰§è¡Œè¯·æ±‚ï¼Œè¿™å°±è¦æ±‚å¼€å‘è€…é€šè¿‡è·¯ç”±é…ç½®ä¿¡æ¯ï¼Œæ˜¾å¼åœ°å‘ŠçŸ¥æœåŠ¡ç«¯è¯·æ±‚å†…å®¹ã€‚</p><p><strong>å®¢æˆ·ç«¯è·¯ç”±æ”¹é€ </strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router/index.js</span></span><br><span class="line">&#123;</span><br><span class="line">  path: <span class="string">'/login'</span>,</span><br><span class="line">  exact: <span class="literal">true</span>,</span><br><span class="line">  component: Login,</span><br><span class="line">  loadData: Login.loadData, <span class="comment">// è¿™é‡Œå°±æ˜¯è¯·æ±‚æ•°æ®çš„æ–¹æ³•</span></span><br><span class="line">  title: <span class="string">'ç™»å½•é¡µ'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Index.loadData = <span class="keyword">async</span> (store) =&gt; &#123;</span><br><span class="line">  store.dispatch(&#123;</span><br><span class="line">    type: <span class="string">"menuTree/reset"</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'æˆ‘è¯•è¯•è¿™ä¸ªåˆ°åº•åŠ è½½ä¸'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index</span><br></pre></td></tr></table></figure><p><strong>æœåŠ¡ç«¯ä»£ç </strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–è¯·æ±‚çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> promises = [];</span><br><span class="line"></span><br><span class="line">matchedRoutes.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (item.route.loadData) &#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œç”¨äº†.then æ‰€ä»¥ç»„ä»¶é‡Œé¢å¿…é¡»ä½¿ç”¨asyncæˆ–è€…promise</span></span><br><span class="line">      item.route.loadData(store).then(resolve).catch(reject)</span><br><span class="line">    &#125;)</span><br><span class="line">    promises.push(promise);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜ï¼Œä½ å®¢æˆ·ç«¯çš„æ–¹æ³•å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¼šå‡ºç° ctx.body æ²¡æœ‰æ‰§è¡Œçš„é—®é¢˜ï¼Œæ‰€ä»¥è¦æŠŠè¿™ä¸ªä¸­é—´ä»¶è®¾ç½®ä¸ºå¼‚æ­¥çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºäº†ç¡®ä¿ç»„ä»¶çš„loadDataçš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line"><span class="keyword">await</span> <span class="built_in">Promise</span>.all(promises).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> css = <span class="keyword">new</span> <span class="built_in">Set</span>(); <span class="comment">// é˜²æ­¢é’©å­å‡½æ•°æ‰§è¡Œä¸¤æ¬¡</span></span><br><span class="line">  <span class="keyword">const</span> insertCss = <span class="function">(<span class="params">...styles</span>) =&gt;</span> styles.forEach(<span class="function"><span class="params">style</span> =&gt;</span> css.add(style._getCss()));</span><br><span class="line">  <span class="keyword">const</span> helmet = Helmet.renderStatic();</span><br><span class="line">  <span class="keyword">const</span> content = renderToString(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;StaticRouter location=&#123;ctx.path&#125;&gt;</span><br><span class="line">          &lt;StyleContext.Provider value=&#123;&#123;insertCss&#125;&#125;&gt;</span><br><span class="line">            &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">          &lt;<span class="regexp">/StyleContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>StaticRouter&gt;</span><br><span class="line">      &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">     )</span></span><br><span class="line"><span class="regexp">     ctx.body = renderHTML(content, store, css, helmet)</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure><h4 id="æ³¨æ°´å’Œè„±æ°´"><a href="#æ³¨æ°´å’Œè„±æ°´" class="headerlink" title="æ³¨æ°´å’Œè„±æ°´"></a>æ³¨æ°´å’Œè„±æ°´</h4><p><strong>æ¶‰åŠåˆ°æ•°æ®çš„é¢„è·å–ï¼Œä¹Ÿæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„çœŸæ­£æ„ä¹‰ã€‚</strong></p><p>ä¸Šé¢çš„ä»£ç æ­£å¸¸è¿è¡Œæ˜¯æ²¡é—®é¢˜äº†ï¼Œä½†æ˜¯å‘ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„storeï¼Œå­˜åœ¨ä¸åŒæ­¥çš„é—®é¢˜ã€‚</p><p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å½“æœåŠ¡ç«¯æ‹¿åˆ°storeå¹¶è·å–æ•°æ®åï¼Œå®¢æˆ·ç«¯çš„jsä»£ç åˆæ‰§è¡Œä¸€éï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç æ‰§è¡Œçš„æ—¶å€™åˆåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„storeï¼Œä¸¤ä¸ªstoreçš„æ•°æ®ä¸èƒ½åŒæ­¥ã€‚</p><p>æ‰€ä»¥ åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ï¼Œé¦–å…ˆæœåŠ¡ç«¯è¯·æ±‚æ¥å£æ‹¿åˆ°æ•°æ®ï¼Œå¹¶å¤„ç†å‡†å¤‡å¥½æ•°æ®çŠ¶æ€ï¼ˆå¦‚æœä½¿ç”¨ Reduxï¼Œå°±æ˜¯è¿›è¡Œ store çš„æ›´æ–°ï¼‰ï¼Œä¸ºäº†å‡å°‘å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™ä½è¿™ä¸ªçŠ¶æ€ã€‚ä¸€èˆ¬åšæ³•æ˜¯åœ¨æœåŠ¡å™¨ç«¯è¿”å› HTML å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå°†æ•°æ® JSON.stringify ä¸€å¹¶è¿”å›ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå«åšæ³¨æ°´ï¼›åœ¨å®¢æˆ·ç«¯ï¼Œå°±ä¸å†éœ€è¦è¿›è¡Œæ•°æ®çš„è¯·æ±‚äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœåŠ¡ç«¯ä¸‹å‘ä¸‹æ¥çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«è„±æ°´ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="built_in">window</span>.context = &#123;</span><br><span class="line">   <span class="comment">// è¿™é‡Œæ˜¯æ³¨æ°´</span></span><br><span class="line">   state: $&#123;serialize(store.getState())&#125;  <span class="comment">// serialize æ˜¯ä¸ºäº†é˜²æ­¢xssçš„æ”»å‡»</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;create&#125; <span class="keyword">from</span> <span class="string">'dva-core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createApp</span>(<span class="params">opt</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// .....</span></span><br><span class="line">  <span class="keyword">return</span> app;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœåŠ¡ç«¯çš„redux</span></span><br><span class="line"><span class="keyword">const</span> dvaApp = createApp(&#123;</span><br><span class="line">  initialState: &#123;&#125;,</span><br><span class="line">  models: models,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> dvaApp.getStore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯çš„redux</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getClientStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// éœ€è¦å…ˆæ‹¿åˆ°æœåŠ¡ç«¯çš„æ•°æ®, è„±æ°´</span></span><br><span class="line">  <span class="keyword">const</span> initialState = <span class="built_in">window</span>.context ? <span class="built_in">window</span>.context.state : &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> dvaClientApp = createApp(&#123;</span><br><span class="line">    initialState,</span><br><span class="line">    models: models,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dvaClientApp.getStore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®ä»£ç†"><a href="#é…ç½®ä»£ç†" class="headerlink" title="é…ç½®ä»£ç†"></a>é…ç½®ä»£ç†</h4><p>æœåŠ¡ç«¯æ˜¯æ²¡æœ‰åŸŸçš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨å®¢æˆ·ç«¯è°ƒå–æ¥å£è¿˜å­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œæ‰€ä»¥è¿˜éœ€è¦é…ç½®ä¸‹ä»£ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> httpProxy <span class="keyword">from</span> <span class="string">'http-proxy-middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> k2c <span class="keyword">from</span> <span class="string">"koa2-connect"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬å‘ä»£ç†</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.url.startsWith(<span class="string">'/api'</span>)) &#123; <span class="comment">//åŒ¹é…æœ‰apiå­—æ®µçš„è¯·æ±‚url</span></span><br><span class="line">    ctx.respond = <span class="literal">false</span> <span class="comment">// ç»•è¿‡koaå†…ç½®å¯¹è±¡response ï¼Œå†™å…¥åŸå§‹reså¯¹è±¡ï¼Œè€Œä¸æ˜¯koaå¤„ç†è¿‡çš„response</span></span><br><span class="line">    <span class="keyword">await</span> k2c(httpProxy(&#123;</span><br><span class="line">        target: <span class="string">'https://api.xxxxx.xxx'</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        secure: <span class="literal">false</span>,</span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          <span class="string">'^/api'</span>: <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ))(ctx, next);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥å®‰è£…koaçš„ä»£ç†æ¨¡å— <code>koa2-proxy-middleware</code>,ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">'koa2-proxy-middleware'</span>);</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  targets: &#123;</span><br><span class="line">    <span class="string">'/user'</span>: &#123;</span><br><span class="line">      <span class="comment">// this is option of http-proxy-middleware</span></span><br><span class="line">      target: <span class="string">'http://localhost:3001'</span>, <span class="comment">// target host</span></span><br><span class="line">      changeOrigin: <span class="literal">true</span>, <span class="comment">// needed for virtual hosted sites</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'/user/:id'</span>: &#123;</span><br><span class="line">      target: <span class="string">'http://localhost:3001'</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'/api/*'</span>: &#123;</span><br><span class="line">      target: <span class="string">'http://localhost:3001'</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123;</span><br><span class="line">        <span class="string">'/passager/xx'</span>: <span class="string">'/mPassenger/ee'</span>, <span class="comment">// rewrite path</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">app.use(proxy(options));</span><br></pre></td></tr></table></figure><p>æºç ä¹Ÿæ²¡å‡ è¡Œï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹  <a href="https://github.com/sunyongjian/koa2-proxy-middleware/blob/master/lib/index.js" target="_blank" rel="noopener">koa2-proxy-middleware</a></p><h3 id="å¼•å…¥react-helmet"><a href="#å¼•å…¥react-helmet" class="headerlink" title="å¼•å…¥react-helmet"></a>å¼•å…¥react-helmet</h3><p>åšæ›´å®Œæ•´çš„SEO</p><p>App ç»„ä»¶åµŒå…¥åˆ° <code>document.getElementById(&#39;root&#39;)</code> èŠ‚ç‚¹å½“ä¸­ï¼Œä¸€èˆ¬æ˜¯ä¸åŒ…å« head æ ‡ç­¾çš„ï¼Œä½†æ˜¯å•é¡µåº”ç”¨åœ¨åˆ‡æ¢è·¯ç”±æ—¶ï¼Œå¯èƒ½ä¹Ÿä¼šéœ€è¦åŠ¨æ€ä¿®æ”¹ head æ ‡ç­¾ä¿¡æ¯ï¼Œæ¯”å¦‚ title å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šåœ¨å•é¡µé¢åº”ç”¨åˆ‡æ¢é¡µé¢ï¼Œä¸ä¼šç»è¿‡æœåŠ¡ç«¯æ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦æ›´æ”¹ document çš„ title å†…å®¹ã€‚</p><p>å¦‚æœç›´æ¥æ”¹å®¢æˆ·ç«¯çš„title,ç›´æ¥å°±å¯ä»¥ä½¿ç”¨<code>document.title</code>,ä½†æ˜¯æˆ‘ä»¬ç°åœ¨è¦æŠŠSEOåšå¥½ï¼Œç„¶åæˆ‘ä»¬è¦æ›´æ”¹æœåŠ¡ç«¯headé‡Œé¢çš„meta titleç­‰å†…å®¹,è¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°  <a href="https://github.com/nfl/react-helmet" target="_blank" rel="noopener">react-helmet</a>ã€‚</p><p>å…·ä½“ä»£ç éå¸¸ç®€å•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯å®ç°æ–¹å¼</span></span><br><span class="line"><span class="keyword">import</span> React, &#123;Component, Fragment&#125; <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> &#123;Helmet&#125; <span class="keyword">from</span> <span class="string">"react-helmet"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Fragment&gt;</span><br><span class="line">        &lt;Helmet&gt;</span><br><span class="line">          &lt;title&gt;è¿™æ˜¯loginé¡µ&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">          &lt;meta name="description" content="è¿™é‡Œæ˜¯ç¦¾å£å’Œreact-ssrçš„è°ƒç ”"/</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/Helmet&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Fragment&gt;</span><br><span class="line">     )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯å®ç°</span></span><br><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">"koa-router"</span></span><br><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">'react-dom/server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;StaticRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Helmet&#125; <span class="keyword">from</span> <span class="string">'react-helmet'</span>; <span class="comment">// è¿™é‡Œå¼•å…¥</span></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> route = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line">route.get([<span class="string">"/:route?"</span>, /\/<span class="function">(<span class="params">[\w|\d]+</span>)\/.*/], (<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">  <span class="keyword">const</span> helmet = Helmet.renderStatic(); <span class="comment">// è¿™é‡Œè·å–ä¸‹å½“å‰çš„headä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> content = renderToString(</span><br><span class="line">    &lt;StaticRouter location=&#123;ctx.path&#125;&gt;</span><br><span class="line">      &lt;StyleContext.Provider value=&#123;&#123;insertCss&#125;&#125;&gt;</span><br><span class="line">        &#123;renderRoutes(routes.routes)&#125;</span><br><span class="line">      &lt;<span class="regexp">/StyleContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>StaticRouter&gt;</span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  ctx.body = <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">      &lt;html lang="zh-Hans-CN"&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">          &lt;meta charset="utf-8"&gt;</span></span><br><span class="line"><span class="string">          <span class="subst">$&#123;helmet.title.toString()&#125;</span></span></span><br><span class="line"><span class="string">          <span class="subst">$&#123;helmet.meta.toString()&#125;</span></span></span><br><span class="line"><span class="string">          &lt;link rel="shortcut icon" href="/favicon.ico"&gt;</span></span><br><span class="line"><span class="string">          &lt;style&gt;<span class="subst">$&#123;[...css].join(<span class="string">''</span>)&#125;</span>&lt;/style&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">          &lt;div id="root"&gt;<span class="subst">$&#123;content&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">          &lt;script src=/index.js&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ...  ...</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚tokenå¤„ç†"><a href="#è¯·æ±‚tokenå¤„ç†" class="headerlink" title="è¯·æ±‚tokenå¤„ç†"></a>è¯·æ±‚tokenå¤„ç†</h3><p>å®¢æˆ·ç«¯ç™»å½•çš„æ—¶å€™ï¼ŒæŠŠç™»å½•çš„tokenï¼Œæ”¾åˆ°æµè§ˆå™¨çš„cookieä¸­å¹¶ä¸”å­˜åˆ°reduxä¸€ä»½ï¼Œcookieåœ¨æœåŠ¡ç«¯å¯ä»¥é€šè¿‡è¯·æ±‚çš„é¡µé¢ç›´æ¥è·å–åˆ°ï¼›æ‰€ä»¥å½“ç”¨æˆ·åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡é¡µé¢è¯·æ±‚è·å–åˆ°token,ç„¶åå‘reduxé‡Œé¢å­˜æ”¾ä¸€ä»½ï¼Œè¿™æ ·å®¢æˆ·ç«¯æƒ³è¦è·å–tokenå°±å¯ä»¥ç›´æ¥åœ¨reduxé‡Œé¢æ‹¿äº†ï¼ŒloadDateå‡½æ•°å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ è¿›è·å–ã€‚</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hab97bac5556440f787abf0ecde0a0f349.jpg" alt=""></p><h3 id="404é¡µé¢"><a href="#404é¡µé¢" class="headerlink" title="404é¡µé¢"></a>404é¡µé¢</h3><p>ç”¨<code>react-router-config</code>çš„<code>matchRoutes</code>æ–¹æ³•ï¼Œå½“æ•è·ä¸ºç©ºæ•°ç»„çš„æ—¶å€™ï¼Œè¯´æ˜æ²¡æœ‰å½“å‰è·¯ç”±ï¼Œè·³è½¬åˆ°404 é¡µé¢ï¼Œè¿™é‡Œé¢æœ‰ä¸€ä¸ªæ³¨æ„çš„ç‚¹æ˜¯ï¼Œå¦‚è¯´æœ‰äºŒçº§æˆ–äºŒçº§ä»¥ä¸Šçš„è·¯ç”±ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½æ•è·ç¬¬ä¸€ä¸ªè·¯ç”±çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¦åˆ¤æ–­å½“å‰è·å–åˆ°çš„æ˜¯ä¸æ˜¯ä¸€çº§è·¯ç”±ï¼Œè€Œä¸”å½“å‰æ•°æ®è¿˜ä¸èƒ½ä¸ºç©ºã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server/index.js  </span></span><br><span class="line"><span class="comment">// åˆ¤æ–­404</span></span><br><span class="line"><span class="keyword">let</span> hasRoute = matchedRoutes.length === <span class="number">1</span> &amp;&amp; !!matchedRoutes[<span class="number">0</span>].route.routes</span><br><span class="line"><span class="keyword">if</span> (hasRoute || !matchedRoutes.length) &#123;</span><br><span class="line">  ctx.response.redirect(<span class="string">'/404'</span>);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ·»åŠ  â€˜/â€™ é‡å®šå‘æ˜¯ä¸€æ ·çš„å¥—è·¯</span></span><br></pre></td></tr></table></figure><h3 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h3><p>å®‰å…¨é—®é¢˜éå¸¸å…³é”®ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå¼€å‘è€…è¦æ ¼å¤–å°å¿ƒã€‚è¿™é‡Œæå‡ºä¸€ä¸ªç‚¹ï¼šæˆ‘ä»¬å‰é¢æåˆ°äº†æ³¨æ°´å’Œè„±æ°´è¿‡ç¨‹ï¼Œå…¶ä¸­çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">window</span>.context = &#123;</span><br><span class="line">    initialState: $&#123;<span class="built_in">JSON</span>.stringify(store.getState())&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>éå¸¸å®¹æ˜“é­å— XSS æ”»å‡»ï¼ŒJSON.stringify å¯èƒ½ä¼šé€ æˆ script æ³¨å…¥,ä½¿ç”¨ serialize-javascript åº“è¿›è¡Œå¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯åŒæ„åº”ç”¨ä¸­æœ€å®¹æ˜“è¢«å¿½è§†çš„ç»†èŠ‚ã€‚</p><p><strong>å¦ä¸€ä¸ªè§„é¿è¿™ç§ XSS é£é™©çš„åšæ³•æ˜¯</strong>ï¼šå°†æ•°æ®ä¼ é€’ä¸ªé¡µé¢ä¸­ä¸€ä¸ªéšè—çš„ textarea çš„ value ä¸­ï¼Œtextarea çš„ value è‡ªç„¶å°±ä¸æ€• XSS é£é™©äº†ã€‚</p><h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><ol><li>å®¢æˆ·ç«¯jsæ‹†åŒ…ï¼Œå‹ç¼©ä»£ç </li><li>å®¢æˆ·ç«¯æ‰“åŒ…çš„jså¸¦æœ‰hashåç¼€</li><li>ä½¿ç”¨copy-webpack-pluginï¼Œç›´æ¥æŠŠéœ€è¦çš„æ–‡ä»¶ï¼Œæ‰“åŒ…åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ã€‚</li><li>ä¸­é—´ä»¶è½¬å‘ä»£ç† è·¨åŸŸç­‰</li><li>é™æ€èµ„æºä½¿ç”¨cdn</li><li>æœåŠ¡ç«¯ä½¿ç”¨ç¼“å­˜</li><li>å¯¹æœåŠ¡ç«¯å‹åŠ›è¿‡å¤§çš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°å®¢æˆ·ç«¯æ¸²æŸ“</li><li>nodeJs/ReactJsçš„ç‰ˆæœ¬å‡çº§</li></ol><h3 id="é‡åˆ°çš„é—®é¢˜æ±‡æ€»"><a href="#é‡åˆ°çš„é—®é¢˜æ±‡æ€»" class="headerlink" title="é‡åˆ°çš„é—®é¢˜æ±‡æ€»"></a>é‡åˆ°çš„é—®é¢˜æ±‡æ€»</h3><ol><li><p>äºŒçº§èœå•çš„æ—¶å€™è·å–åˆ°é™æ€èµ„æºçš„è·¯å¾„ï¼Œå¸¦ç€ç¬¬ä¸€çº§èœå•çš„è·¯å¾„</p></li><li><p>æœåŠ¡ç«¯å¯¼å…¥css çš„æ—¶å€™ï¼Œcssæ˜¯æœ‰åšhash å¤„ç†ä¸èƒ½æ­£ç¡®çš„åŠ è½½css (cssmodules)</p></li><li><p>æœåŠ¡ç«¯å¯¼å…¥cssæ—¶å‘ç”Ÿåœ¨componentWillMountå‘¨æœŸå‡½æ•°ï¼Œä¸èƒ½åœ¨componentDidMount,æ­¤æ—¶å·²ç»åˆ°å®¢æˆ·ç«¯äº†ã€‚</p></li><li><p>koaçš„è·¯ç”±ä¸åƒexpressé‚£æ ·ä¸èƒ½ç›´æ¥ä½¿ç”¨ ***** ï¼Œ ï¼ˆå¯èƒ½å¯ä»¥ï¼Œåœ¨æˆ‘è¿™æŠ¥é”™ï¼‰</p></li><li><p>ä¸­é—´ä»¶çš„é¡ºåºã€å’Œå¼‚æ­¥é—® ctx.body=â€™â€™   çš„é—®é¢˜</p></li><li><p>react-helmet ä½¿ç”¨æ—¶ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰æ˜¾ç¤ºè®¾ç½®çš„titleç­‰ä¿¡æ¯  ï¼ˆåœ¨æœ€å¤–å±‚å¯¼å…¥ï¼‰</p></li><li><p>æ³¨æ°´çš„æ—¶å€™ï¼Œæ³¨æ„reduxå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒºåˆ«å’Œè”ç³»</p></li><li><p>æ³¨æ°´å¼‚æ­¥åŠ è½½çš„é—®é¢˜  promise.all()</p></li><li><p>å®¢æˆ·ç«¯è·¯ç”±ä½¿ç”¨çš„history,è·³è½¬ä¸è®¿é—®koaçš„è·¯ç”±</p></li><li><p>ssr éƒ¨ç½²ä»£ç ä½“ç§¯ç‰¹åˆ«å¤§ ,æ·»åŠ å¹¶å‘ï¼Œå…¬å…±å•ç‹¬æ‹†å‡ºã€ä½¿ç”¨cdn</p></li><li><p>pm2ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œ</p></li><li><p>å¼€å¯cssModulesåæŠŠantdçš„æ ·å¼ä¹Ÿç¼–è¯‘äº†</p></li><li><p>æ·»åŠ ä¸€ä¸ªå¸¸é‡æ•°ç»„ï¼Œç”¨æ¥è¡¨ç¤ºé‚£äº›å¿…é¡»ç”¨æ¥æœåŠ¡ç«¯æ¸²æŸ“(æé«˜åŠ è½½é€Ÿåº¦)ï¼Œä¸èƒ½å¤ªå¤šï¼Œå½±å“æ€§èƒ½ã€è®°å¾—å»é‡ã€‘</p></li><li><p>ä»åˆ«çš„é¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œä¸ºä»€ä¹ˆæ‰“å¼€ç½‘é¡µæºä»£ç æœ‰æ¸²æŸ“å¥½çš„html,ä¸åº”è¯¥åªæœ‰é¦–å±æ¸²æŸ“å—ï¼Ÿã€æ‰“å¼€æ§åˆ¶å°ç›¸å½“äºé‡æ–°æ¸²æŸ“äº†ã€‘</p></li><li><p>æœåŠ¡ç«¯è·å–äº†æ•°æ®ï¼Œå®¢æˆ·ç«¯æ€ä¹ˆåˆ¤æ–­å·²ç»è·å–äº†ï¼Œä¸å†è°ƒå–æ¥å£</p></li><li><p>æœåŠ¡ç«¯æœ‰äº†csså®¢æˆ·ç«¯è¿˜éœ€è¦å—ï¼Ÿ</p><p><strong>ç­”æ¡ˆæ˜¯éœ€è¦çš„ã€‚</strong></p><p>æœåŠ¡ç«¯çš„csså…¶å®å°±æ˜¯å®¢æˆ·ç«¯ç»™çš„ï¼SSRçš„æ¸²æŸ“åªæ˜¯é’ˆå¯¹é¡µé¢çš„é¦–å±ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ· ç¬¬ä¸€æ¬¡æ‰“å¼€çš„é¡µé¢ï¼Œå½“ä»é¦–å±è·³è½¬åˆ°åˆ«çš„é¡µé¢çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¿˜æ˜¯éœ€è¦å®¢æˆ·ç«¯æ¥æ¸²æŸ“çš„ï¼Œheadçš„cssä¹Ÿæ˜¯é€šè¿‡jsçš„é«˜é˜¶å‡½æ•°ï¼Œä¼ è¿›å»çš„ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯æ²¡æœ‰äº†cssï¼ŒæœåŠ¡ç«¯ä¸€å®šæ˜¯æ²¡æœ‰cssçš„ã€‚åœ¨reactçš„é¡¹ç›®ä¸­æ˜¯æ²¡æœ‰çœŸæ­£çš„cssçš„ï¼Œæ‰€è°“çš„cssä¹Ÿæ˜¯é€šè¿‡jsæ¥å®ç°åŠ¨æ€å¼•å…¥ï¼Œæ‰€ä»¥cssä¹Ÿæ˜¯js,åŒ…æ‹¬å›¾ç‰‡ã€‚</p></li><li><p>ssræ€ä¹ˆè¿›è¡Œå‚æ•°çš„ä¼ è¾“å’Œè·å–</p><ul><li><strong>ç›´æ¥ä½¿ç”¨é—®å·ä¼ å‚</strong></li></ul><p>å®¢æˆ·ç«¯pathï¼š /a/b?id=1008611<br>ç„¶åé€šè¿‡æ­£åˆ™æˆ–è€…ä½¿ç”¨qsè·å–åˆ°idçš„å€¼</p><ul><li><strong>åœ°å€æ ä¼ å‚</strong></li></ul><p><strong>æ–¹æ³•ä¸€</strong></p><p>æƒ³è¦ä¼ å‚å®¢æˆ·ç«¯è·¯ç”±åœ¨åå°è®¾ç½®ä¸‹ï¼Œä½¿å®ƒèƒ½ç›´æ¥è·å–åˆ°params<br>ä¾‹å¦‚ï¼šroute.get(â€˜detail/id:?â€™()=&gt;{}))<br>æœ€å¥½æ˜¯æŠŠå®¢æˆ·ç«¯æ‰€æœ‰è¦ä¼ å‚urléƒ½æ·»åŠ ä¸€æ ·çš„å‰ç¼€<br>é¡µé¢A menu/homeDetail/1212<br>é¡µé¢B menu/aboutDetail/3434</p><p>route.get(â€˜menu/:pageInfo?/:id?â€™()=&gt;{}))</p><p> <strong>æ–¹æ³•äºŒ</strong><br> ä¹Ÿæ˜¯æˆ‘å†ç”¨çš„æ–¹æ³•ï¼Œè·å–åˆ°å½“å‰çš„è·¯ç”±pathå’Œè¯·æ±‚çš„url,é€šè¿‡æ­£åˆ™è·å–åˆ°å½“å‰çš„idä¹Ÿå¯ä»¥ç›´æ¥ç”¨<code>path-to-regexp</code></p></li></ol><blockquote><p>ä¸Šé¢çš„é—®é¢˜ï¼Œå‡å·²è§£å†³ï¼Œå¯èƒ½æ–‡ç« ä»‹ç»çš„ä¸å…·ä½“ï¼Œå…·ä½“ä»¥æºç ä¸ºå‡†ã€‚</p></blockquote><p><code>å–œæ¬¢çš„markğŸ‘</code> </p><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="http://blog.poetries.top/2018/11/18/react-ssr/?utm_source=tuicool&utm_medium=referral" target="_blank" rel="noopener">ä»é›¶åˆ°ä¸€æ­å»ºReact SSRå·¥ç¨‹æ¶æ„</a></p><p><a href="https://zhuanlan.zhihu.com/p/66672794" target="_blank" rel="noopener">çŸ¥ä¹ rendertron</a></p><p><a href="https://github.com/hzfvictory/react-ssr" target="_blank" rel="noopener">æœ¬æ–‡çš„githubåœ°å€</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å…¨å±€æŒ‚è½½ç»„ä»¶ä¹‹Vue.extend</title>
      <link href="/2020/06/13/workspace/Frame/vue/source-code/vue-extend/"/>
      <url>/2020/06/13/workspace/Frame/vue/source-code/vue-extend/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>å…¨å±€æŒ‚è½½ç»„ä»¶ä¹‹Vue.extend</strong></p><p>[[toc]]</p><p><code>Vue.extend</code> å±äºVueçš„å…¨å±€ apiï¼Œåœ¨å®é™…ä¸šåŠ¡å¼€å‘ä¸­æˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºç›¸æ¯”å¸¸ç”¨çš„ <code>Vue.component</code> å†™æ³•ä½¿ç”¨ <code>extend</code> æ­¥éª¤è¦æ›´åŠ ç¹çä¸€äº›ã€‚ä½†æ˜¯åœ¨ä¸€äº›ç‹¬ç«‹ç»„ä»¶å¼€å‘åœºæ™¯ä¸­ï¼ˆä¾‹å¦‚ï¼šElementUIåº“ï¼‰ï¼Œæ‰€ä»¥<code>Vue.extend</code> + <code>$mount</code> è¿™å¯¹ç»„åˆéå¸¸æœ‰å¿…è¦éœ€è¦æˆ‘ä»¬äº†è§£ä¸‹ã€‚</p><h3 id="Vue-component"><a href="#Vue-component" class="headerlink" title="Vue.component"></a>Vue.component</h3><p><a href="https://cn.vuejs.org/v2/api/index.html#Vue-componen" target="_blank" rel="noopener">æ–‡æ¡£</a></p><p><strong>å®˜ç½‘ç”¨æ³•</strong>ï¼š</p><p>æ³¨å†Œæˆ–è·å–å…¨å±€ç»„ä»¶ã€‚æ³¨å†Œè¿˜ä¼šè‡ªåŠ¨ä½¿ç”¨ç»™å®šçš„ <code>id</code> è®¾ç½®ç»„ä»¶çš„åç§°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œç»„ä»¶ï¼Œä¼ å…¥ä¸€ä¸ªæ‰©å±•è¿‡çš„æ„é€ å™¨</span></span><br><span class="line">Vue.component(<span class="string">'my-component'</span>, Vue.extend(&#123; <span class="comment">/* ... */</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œç»„ä»¶ï¼Œä¼ å…¥ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ (è‡ªåŠ¨è°ƒç”¨ Vue.extend)</span></span><br><span class="line">Vue.component(<span class="string">'my-component'</span>, &#123; <span class="comment">/* ... */</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ³¨å†Œçš„ç»„ä»¶ (å§‹ç»ˆè¿”å›æ„é€ å™¨)</span></span><br><span class="line"><span class="keyword">var</span> MyComponent = Vue.component(<span class="string">'my-component'</span>)</span><br><span class="line"><span class="keyword">let</span> ElInput = Vue.component(<span class="string">'ElInput'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> ElInput);  <span class="comment">// å°±æ˜¯Inoutçš„å®ä¾‹</span></span><br></pre></td></tr></table></figure><p>ç”¨æ³•ä¹Ÿç‰¹åˆ«çš„ç®€å•ï¼Œä½ å†™å¥½çš„ç»„ä»¶ï¼Œç›´æ¥åœ¨main.jsé‡Œé¢å¯¼å…¥ç„¶åä½¿ç”¨<code>Vue.component(&#39;xx-xxx&#39;,xxx)</code>å°±å¯ä»¥å…¨å±€é€šç”¨äº†ã€‚</p><ul><li><strong>å¥½å¤„</strong><ul><li>è¿™æ ·çš„<code>å¥½å¤„</code>å°±æ˜¯æ‰€æœ‰é¡µé¢åŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡ router æ¥ç®¡ç†å¯ä»¥ç›´æ¥æ³¨å†Œï¼Œç»„ä»¶çš„åˆ›å»ºæˆ‘ä»¬ä¸éœ€è¦å»å…³æ³¨ï¼Œç›¸æ¯” <code>extend</code> è¦æ›´çœå¿ƒä¸€ç‚¹</li></ul></li><li><strong>ç¼ºç‚¹</strong><ul><li>ç»„ä»¶çš„åç§°éƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œå¦‚æœæˆ‘è¦ä»æ¥å£åŠ¨æ€æ¸²æŸ“æ€ä¹ˆåŠã€‚ã€extendä¸ç”¨å¿…é¡»åœ¨åˆå§‹åŒ–çš„æ—¶å€™å®Œæˆï¼Œä¸‹é¢æœ‰å®ä¾‹ã€‘</li><li>æœ‰å†…å®¹éƒ½æ˜¯åœ¨ <code>#app</code> ä¸‹æ¸²æŸ“ï¼Œæ³¨å†Œç»„ä»¶éƒ½æ˜¯åœ¨å½“å‰ä½ç½®æ¸²æŸ“ã€‚å¦‚æœæˆ‘è¦å®ç°ä¸€ä¸ªæ¨¡æ€æ¡†çš„æç¤ºç»„ä»¶ï¼Œå°±æ¯”è¾ƒé¸¡è‚‹äº†ã€‚</li></ul></li></ul><p>è¿™æ—¶å€™ï¼Œ<code>Vue.extend + vm.$mount</code> ç»„åˆå°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><h3 id="Vue-extend"><a href="#Vue-extend" class="headerlink" title="Vue.extend"></a>Vue.extend</h3><p><a href="https://cn.vuejs.org/v2/api/index.html#Vue-extend" target="_blank" rel="noopener">æ–‡æ¡£</a></p><p><strong>å®˜ç½‘ç”¨æ³•:</strong></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"mount-point"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ„é€ å™¨</span></span><br><span class="line"><span class="keyword">var</span> Profile = Vue.extend(&#123;</span><br><span class="line">  template: <span class="string">'&lt;p&gt;&#123;&#123;firstName&#125;&#125; &#123;&#123;lastName&#125;&#125; aka &#123;&#123;alias&#125;&#125;&lt;/p&gt;'</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      firstName: <span class="string">'Walter'</span>,</span><br><span class="line">      lastName: <span class="string">'White'</span>,</span><br><span class="line">      alias: <span class="string">'Heisenberg'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// åˆ›å»º Profile å®ä¾‹ï¼Œå¹¶æŒ‚è½½åˆ°ä¸€ä¸ªå…ƒç´ ä¸Šã€‚</span></span><br><span class="line"><span class="keyword">new</span> Profile().$mount(<span class="string">'#mount-point'</span>)</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Walter White aka Heisenberg<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°<code>Id</code>ä¸º<code>mount-point</code>çš„div ,æ˜¯ç›´æ¥è¢«æ›¿ä»£äº†ï¼Œæ²¡æœ‰åœ¨å†…éƒ¨å¡«å……ï¼Œåœ¨æˆ‘ä»¬ <code>main.js</code> åˆå§‹åŒ–çš„æ—¶å€™ç”¨å‘å…¶å®ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>);  <span class="comment">// æ­¤å¤„éƒ½æ˜¯æ›¿æ¢ï¼Œä¸æ˜¯å¡«å……</span></span><br></pre></td></tr></table></figure><p><strong>ä¸‹é¢ç®€å•çš„åˆ†æä¸‹<code>$mount</code>çš„æºç </strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/platforms/web/entry-runtime-with-compiler.js</span></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'core/config'</span></span><br><span class="line"><span class="keyword">import</span> &#123;warn, cached&#125; <span class="keyword">from</span> <span class="string">'core/util/index'</span></span><br><span class="line"><span class="keyword">import</span> &#123;mark, measure&#125; <span class="keyword">from</span> <span class="string">'core/util/perf'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'./runtime/index'</span></span><br><span class="line"><span class="keyword">import</span> &#123;query&#125; <span class="keyword">from</span> <span class="string">'./util/index'</span></span><br><span class="line"><span class="keyword">import</span> &#123;compileToFunctions&#125; <span class="keyword">from</span> <span class="string">'./compiler/index'</span></span><br><span class="line"><span class="keyword">import</span> &#123;shouldDecodeNewlines, shouldDecodeNewlinesForHref&#125; <span class="keyword">from</span> <span class="string">'./util/compat'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> idToTemplate = cached(<span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> el = query(id)</span><br><span class="line">  <span class="keyword">return</span> el &amp;&amp; el.innerHTML</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mount = Vue.prototype.$mount;  <span class="comment">// ç¼“å­˜äº†åŸå‹ä¸Šçš„ $mount æ–¹æ³•</span></span><br><span class="line">Vue.prototype.$mount = <span class="function"><span class="keyword">function</span> (<span class="params">el, hydrating</span>) </span>&#123;</span><br><span class="line">  el = el &amp;&amp; query(el)  <span class="comment">// é€šè¿‡ queryå‡½æ•° å°±æ˜¯è·å–çœŸå®çš„DOMå…ƒç´ </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­è·å–çš„çœŸå® domå…ƒç´ æ˜¯å¦ä¸º body æˆ– documentElement æŠ¥è­¦å‘Š</span></span><br><span class="line">  <span class="keyword">if</span> (el === <span class="built_in">document</span>.body || el === <span class="built_in">document</span>.documentElement) &#123;</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">      <span class="string">`Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead.`</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> options = <span class="keyword">this</span>.$options</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æœ‰ä¹ˆæœ‰render , å’±ä»¬ä¸€èˆ¬éƒ½æ˜¯ç”¨ template å†™çš„vueï¼Œéœ€è¦ç¼–è¯‘</span></span><br><span class="line">  <span class="keyword">if</span> (!options.render) &#123;</span><br><span class="line">    <span class="keyword">let</span> template = options.template</span><br><span class="line">    <span class="keyword">if</span> (template) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> template === <span class="string">'string'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (template.charAt(<span class="number">0</span>) === <span class="string">'#'</span>) &#123;</span><br><span class="line">          template = idToTemplate(template)</span><br><span class="line">          <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">          <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !template) &#123;</span><br><span class="line">            warn(</span><br><span class="line">              <span class="string">`Template element not found or is empty: <span class="subst">$&#123;options.template&#125;</span>`</span>,</span><br><span class="line">              <span class="keyword">this</span></span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (template.nodeType) &#123;</span><br><span class="line">        template = template.innerHTML</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">          warn(<span class="string">'invalid template option:'</span> + template, <span class="keyword">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el) &#123;</span><br><span class="line">      template = getOuterHTML(el)  <span class="comment">// å³è·å– el çš„ outerHTML</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (template) &#123;</span><br><span class="line">      <span class="comment">// ç„¶åé€šè¿‡compileToFunctionså°† template è½¬åŒ–ä¸º render å‡½æ•°ï¼Œoptions.render = render</span></span><br><span class="line">      <span class="comment">// æ‰€æœ‰ Vue çš„ç»„ä»¶çš„æ¸²æŸ“æœ€ç»ˆéƒ½éœ€è¦ render æ–¹æ³•ï¼Œæ— è®ºæ˜¯ç”¨å•é¡µé¢ .vue æ–¹å¼å¼€å‘ï¼Œè¿˜æ˜¯å†™äº† el æˆ–è€… template å±æ€§ï¼Œ</span></span><br><span class="line">      <span class="comment">// æœ€ç»ˆéƒ½è¦è¢«è½¬æˆ render æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹æ˜¯ Vue çš„ä¸€ä¸ª â€œåœ¨çº¿ç¼–è¯‘â€ çš„è¿‡ç¨‹ï¼Œ å®ƒæ˜¯è°ƒç”¨ compileToFunctions æ–¹æ³•å®ç°çš„ï¼Œæœ€åè°ƒç”¨åŸå‹ä¸Šçš„ $mount æ–¹æ³•æŒ‚è½½ã€‚</span></span><br><span class="line">      <span class="keyword">const</span> &#123;render, staticRenderFns&#125; = compileToFunctions(template, &#123;</span><br><span class="line">        outputSourceRange: process.env.NODE_ENV !== <span class="string">'production'</span>,</span><br><span class="line">        shouldDecodeNewlines,</span><br><span class="line">        shouldDecodeNewlinesForHref,</span><br><span class="line">        delimiters: options.delimiters,</span><br><span class="line">        comments: options.comments</span><br><span class="line">      &#125;, <span class="keyword">this</span>)</span><br><span class="line">      options.render = render</span><br><span class="line">      options.staticRenderFns = staticRenderFns</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰ä¼ elçš„è¯ï¼Œä¼šç›´æ¥æ‰§è¡Œè¿™æ­¥ï¼Œä¼šæŠŠç»„ä»¶åœ¨å†…å­˜ä¸­æ¸²æŸ“å®Œæ¯•</span></span><br><span class="line">  <span class="keyword">return</span> mount.call(<span class="keyword">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŠæ—¶è·å–HTML å…¼å®¹IE</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getOuterHTML</span>(<span class="params">el</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (el.outerHTML) &#123;</span><br><span class="line">    <span class="keyword">return</span> el.outerHTML</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> container = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">    container.appendChild(el.cloneNode(<span class="literal">true</span>))</span><br><span class="line">    <span class="keyword">return</span> container.innerHTML</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Vue.compile = compileToFunctions</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Vue</span><br></pre></td></tr></table></figure><ul><li><p><code>$mount</code>æ–¹æ³•æ”¯æŒä¼ å…¥ 2 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ elï¼Œå®ƒè¡¨ç¤ºæŒ‚è½½çš„å…ƒç´ ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ DOM å¯¹è±¡ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ä¼šè°ƒç”¨ query æ–¹æ³•è½¬æ¢æˆ DOM å¯¹è±¡çš„ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å’ŒæœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ä¸éœ€è¦ä¼ ç¬¬äºŒä¸ªå‚æ•°ã€‚</p></li><li><p><code>$mount</code>æ–¹æ³•å®é™…ä¸Šä¼šè°ƒç”¨<code>mountComponent</code> æ–¹æ³•ï¼Œæ–¹æ³•å®šä¹‰åœ¨ <code>src/core/instance/lifecycle.js</code>ä¸­</p></li></ul><h3 id="å®ç°ä¸€ä¸ªå¼¹æ¡†ç»„ä»¶"><a href="#å®ç°ä¸€ä¸ªå¼¹æ¡†ç»„ä»¶" class="headerlink" title="å®ç°ä¸€ä¸ªå¼¹æ¡†ç»„ä»¶"></a>å®ç°ä¸€ä¸ªå¼¹æ¡†ç»„ä»¶</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// message/src/index.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"wrap"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"message"</span> :<span class="class"><span class="keyword">class</span></span>=<span class="string">"item.type"</span> v-<span class="keyword">for</span>=<span class="string">"item in notices"</span> :key=<span class="string">"item._name"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"content"</span>&gt;&#123;&#123;item.content&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// é»˜è®¤é€‰é¡¹</span></span><br><span class="line">  <span class="keyword">const</span> defaultOptions = &#123;</span><br><span class="line">    duration: <span class="number">1500</span>,</span><br><span class="line">    type: <span class="string">'info'</span>,</span><br><span class="line">    content: <span class="string">'è¿™æ˜¯ä¸€æ¡æç¤ºä¿¡æ¯ï¼'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> mid = <span class="number">0</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name:<span class="string">'MyMessage'</span>, <span class="comment">// å»ºè®®æ·»åŠ æ–¹ä¾¿å¤–é¢ç›´æ¥å–å€¼</span></span><br><span class="line">    data() &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        notices: []</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      addMessage(notice = &#123;&#125;) &#123;</span><br><span class="line">        <span class="comment">// nameæ ‡è¯† ç”¨äºç§»é™¤å¼¹çª—</span></span><br><span class="line">        <span class="keyword">let</span> _name = <span class="keyword">this</span>.getName()</span><br><span class="line">        <span class="comment">// åˆå¹¶é€‰é¡¹</span></span><br><span class="line">        notice = <span class="built_in">Object</span>.assign(&#123;</span><br><span class="line">          _name</span><br><span class="line">        &#125;, defaultOptions, notice)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.notices.push(notice)</span><br><span class="line"></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.removeNotice(_name)</span><br><span class="line">        &#125;, notice.duration) </span><br><span class="line">      &#125;,</span><br><span class="line">      getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'msg_'</span> + (mid++)  <span class="comment">//åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å€¼ </span></span><br><span class="line">      &#125;,</span><br><span class="line">      removeNotice(_name) &#123;</span><br><span class="line">        <span class="keyword">let</span> index = <span class="keyword">this</span>.notices.findIndex(<span class="function"><span class="params">item</span> =&gt;</span> item._name === _name)</span><br><span class="line">        <span class="keyword">this</span>.notices.splice(index, <span class="number">1</span>)  <span class="comment">// åˆ é™¤å½“å‰è¶…æ—¶çš„dom</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;style scoped&gt;</span></span><br><span class="line"><span class="regexp">    .wrap &#123;</span></span><br><span class="line"><span class="regexp">        position: fixed;</span></span><br><span class="line"><span class="regexp">        top: 50px;</span></span><br><span class="line"><span class="regexp">        left: 50%;</span></span><br><span class="line"><span class="regexp">        display: flex;</span></span><br><span class="line"><span class="regexp">        flex-direction: column;</span></span><br><span class="line"><span class="regexp">        align-items: center;</span></span><br><span class="line"><span class="regexp">        transform: translateX(-50%);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    .message &#123;</span></span><br><span class="line"><span class="regexp">        --borderWidth: 3px;</span></span><br><span class="line"><span class="regexp">        min-width: 240px;</span></span><br><span class="line"><span class="regexp">        max-width: 500px;</span></span><br><span class="line"><span class="regexp">        margin-bottom: 10px;</span></span><br><span class="line"><span class="regexp">        border-radius: 3px;</span></span><br><span class="line"><span class="regexp">        box-shadow: 0 0 8px #ddd;</span></span><br><span class="line"><span class="regexp">        overflow: hidden;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    .content &#123;</span></span><br><span class="line"><span class="regexp">        padding: 8px;</span></span><br><span class="line"><span class="regexp">        line-height: 1.3;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ å¯¹åº”çš„é›†ä¸­çŠ¶æ€ </span></span><br><span class="line"><span class="regexp">    .message.info &#123;</span></span><br><span class="line"><span class="regexp">        border-left: var(--borderWidth) solid #909399;</span></span><br><span class="line"><span class="regexp">        background: #F4F4F5;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    .message.success &#123;</span></span><br><span class="line"><span class="regexp">        border-left: var(--borderWidth) solid #67C23A;</span></span><br><span class="line"><span class="regexp">        background: #F0F9EB;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    .message.error &#123;</span></span><br><span class="line"><span class="regexp">        border-left: var(--borderWidth) solid #F56C6C;</span></span><br><span class="line"><span class="regexp">        background: #FEF0F0;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    .message.warning &#123;</span></span><br><span class="line"><span class="regexp">        border-left: var(--borderWidth) solid #E6A23C;</span></span><br><span class="line"><span class="regexp">        background: #FDF6EC;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// message/index.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">'./src/index.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> messageInstance = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> TempMessage = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  TempMessage = Message</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> init = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> MessageConstructor = TempMessage &amp;&amp; Vue.extend(TempMessage)</span><br><span class="line"></span><br><span class="line">  messageInstance = <span class="keyword">new</span> MessageConstructor(&#123;&#125;)<span class="comment">// æ„é€ å‡½æ•°å¯ä»¥æ¥ä¼ å€¼ï¼Œdataã€methods.....</span></span><br><span class="line">  <span class="comment">// console.log(messageInstance);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// $mount()ä¸å¸¦å‚æ•°ï¼Œä¼šæŠŠç»„ä»¶åœ¨å†…å­˜ä¸­æ¸²æŸ“å®Œæ¯•</span></span><br><span class="line">  messageInstance.$mount()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// messageInstance.$el æ‹¿åˆ°çš„å°±æ˜¯ç»„ä»¶å¯¹åº”çš„domå…ƒç´ ,å¯ä»¥ç›´æ¥æ“ä½œdom</span></span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(messageInstance.$el)</span><br><span class="line">  messageInstance.$el.style.zIndex = <span class="number">9999</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> caller = <span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!messageInstance) &#123;</span><br><span class="line">    <span class="comment">// è¿›é¡µé¢åˆå§‹åŒ–</span></span><br><span class="line">    init(options)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// addMessage æ˜¯ç»„ä»¶å†…éƒ¨å£°æ˜çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ å¯¹åº”çš„æ–¹æ³•</span></span><br><span class="line">  messageInstance.addMessage(options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install(vue) &#123;</span><br><span class="line">    vue.prototype.$mymessage = caller</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">'@/components/Message/index.js'</span></span><br><span class="line">Vue.use(Message)</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.$mymessage(&#123;</span><br><span class="line">  type: <span class="string">'warning'</span>,</span><br><span class="line">  content: <span class="string">'ä½ å¥½åå•Šï¼Œæˆ‘å¥½å–œæ¬¢'</span>,</span><br><span class="line">  duration: <span class="number">6000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="https://blog.csdn.net/weixin_44867717/article/details/104954173" target="_blank" rel="noopener">JavaScript æ–¹å¼è°ƒç”¨çš„ç»„ä»¶</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> æºç åˆ†æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>keep-aliveæºç åˆ†æ</title>
      <link href="/2020/06/02/workspace/Frame/vue/source-code/keep-alive/"/>
      <url>/2020/06/02/workspace/Frame/vue/source-code/keep-alive/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>keep-aliveæºç åˆ†æ</strong></p><p>[[toc]]</p><h3 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h3><p>æƒ³çœ‹å…·ä½“ç”¨æ³•çœ‹æˆ‘ä¸Šä¸€ç¯‡æ–‡ç«  <a href="/2020/05/25/workspace/Frame/vue/keep-alive/">è¿™å¤§æ¦‚æ˜¯æœ€å…¨ä¹çš„keep-aliveçš„è¸©å‘æŒ‡å—</a></p><h3 id="æºç å‰–æ"><a href="#æºç å‰–æ" class="headerlink" title="æºç å‰–æ"></a>æºç å‰–æ</h3><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/components/keep-alive.js#L53" target="_blank" rel="noopener">æºç åœ°å€</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// /src/core/components/keep-alive.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;isRegExp, remove&#125; <span class="keyword">from</span> <span class="string">'shared/util'</span></span><br><span class="line"><span class="keyword">import</span> &#123;getFirstComponentChild&#125; <span class="keyword">from</span> <span class="string">'core/vdom/helpers/index'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ç»„ä»¶çš„nameå€¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComponentName</span>(<span class="params">opts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> opts &amp;&amp; (opts.Ctor.options.name || opts.tag)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯¹åº”ç€includesé‚£ä¸‰ç§æ ¼å¼ï¼ˆæ•°ç»„ã€æ­£åˆ™ã€å’Œå­—ç¬¦ä¸²ï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å½“å‰çš„name</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">matches</span>(<span class="params">pattern, name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(pattern)) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.indexOf(name) &gt; <span class="number">-1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> pattern === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.split(<span class="string">','</span>).indexOf(name) &gt; <span class="number">-1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isRegExp(pattern)) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.test(name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¼ è¿›æ¥å½“å‰çš„thiså’Œä¸€ä¸ªåˆ¤æ–­æ˜¯å¦æœ‰å½“å‰nameçš„å‡½æ•°</span></span><br><span class="line"><span class="comment">// pruneCacheå‡½æ•°çš„æ ¸å¿ƒæ˜¯è°ƒç”¨pruneCacheEntry</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pruneCache</span>(<span class="params">keepAliveInstance, filter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;cache, keys, _vnode&#125; = keepAliveInstance</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> cache) &#123;</span><br><span class="line">    <span class="keyword">const</span> cachedNode = cache[key]</span><br><span class="line">    <span class="keyword">if</span> (cachedNode) &#123;</span><br><span class="line">      <span class="keyword">const</span> name = getComponentName(cachedNode.componentOptions)</span><br><span class="line">      <span class="keyword">if</span> (name &amp;&amp; !filter(name)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰ç»„ä»¶æ²¡æœ‰ç¼“å­˜ï¼Œç›´æ¥åˆ é™¤</span></span><br><span class="line">        pruneCacheEntry(cache, key, keys, _vnode)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pruneCacheEntry</span>(<span class="params">cache, key, keys, current</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> cached = cache[key]</span><br><span class="line">  <span class="keyword">if</span> (cached &amp;&amp; (!current || cached.tag !== current.tag)) &#123;</span><br><span class="line">    cached.componentInstance.$destroy() <span class="comment">// é”€æ¯å½“å‰ç»„ä»¶</span></span><br><span class="line">  &#125;</span><br><span class="line">  cache[key] = <span class="literal">null</span></span><br><span class="line">  remove(keys, key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> patternTypes = [<span class="built_in">String</span>, <span class="built_in">RegExp</span>, <span class="built_in">Array</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'keep-alive'</span>,</span><br><span class="line">  <span class="comment">// æŠ½è±¡ç»„ä»¶æ²¡æœ‰çœŸå®çš„èŠ‚ç‚¹ï¼Œåœ¨ç»„ä»¶æ¸²æŸ“çš„æ—¶å€™ä¸ä¼šè§£ææ¸²æŸ“æˆçœŸå®çš„domèŠ‚ç‚¹ï¼Œè€Œåªæ˜¯ä½œä¸ºä¸­é—´çš„æ•°æ®è¿‡åº¦å±‚å¤„ç†ï¼Œåœ¨keep-aliveä¸­æ˜¯å¯¹ç»„ä»¶ç¼“å­˜åšå¤„ç†</span></span><br><span class="line">  abstract: <span class="literal">true</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    include: patternTypes, <span class="comment">// è¦ç¼“å­˜çš„ç»„ä»¶</span></span><br><span class="line">    exclude: patternTypes, <span class="comment">// ä¸ç¼“å­˜çš„ç»„ä»¶</span></span><br><span class="line">    max: [<span class="built_in">String</span>, <span class="built_in">Number</span>] <span class="comment">// ç¼“å­˜çš„ä¸ªæ•°</span></span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    <span class="keyword">this</span>.cache = <span class="built_in">Object</span>.create(<span class="literal">null</span>)  <span class="comment">// ç¼“å­˜è™šæ‹Ÿdom &#123;key:vnode&#125;</span></span><br><span class="line">    <span class="keyword">this</span>.keys = [] <span class="comment">// ç¼“å­˜çš„è™šæ‹Ÿdomçš„é”®é›†åˆ</span></span><br><span class="line">  &#125;,</span><br><span class="line">  destroyed() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="keyword">this</span>.cache) &#123;</span><br><span class="line">      <span class="comment">// åˆ é™¤æ‰€æœ‰çš„ç¼“å­˜ï¼Œæ‰€ä»¥ &lt;keep-alive&gt; å¤–é¢ç›’å­å°½å¯èƒ½çš„ä¸è¦å»ä½¿ç”¨v-if </span></span><br><span class="line">      pruneCacheEntry(<span class="keyword">this</span>.cache, key, <span class="keyword">this</span>.keys)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">     <span class="comment">/*</span></span><br><span class="line"><span class="comment">      this.$watch('a', val =&gt; &#123;</span></span><br><span class="line"><span class="comment">          console.log(val, 'balabala');</span></span><br><span class="line"><span class="comment">      &#125;)</span></span><br><span class="line"><span class="comment">      watch:&#123;</span></span><br><span class="line"><span class="comment">          aï¼šï¼ˆnewVal,oldVal)=&gt;&#123;</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment">      éƒ½æ˜¯ç›‘å¬å€¼çš„å˜åŒ–çš„,æ–¹å¼ä¸€æ˜¯ç›‘å¬ä¸åˆ°å¯¹è±¡çš„å˜åŒ–ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ ¼å¼çš„</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// ç›‘æ§ç¼“å­˜çš„å˜åŒ–</span></span><br><span class="line">    <span class="keyword">this</span>.$watch(<span class="string">'include'</span>, val =&gt; &#123;</span><br><span class="line">      pruneCache(<span class="keyword">this</span>, name =&gt; matches(val, name))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.$watch(<span class="string">'exclude'</span>, val =&gt; &#123;</span><br><span class="line">      pruneCache(<span class="keyword">this</span>, name =&gt; !matches(val, name))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// è·å–ç¬¬ä¸€ä¸ªå­**ç»„ä»¶**</span></span><br><span class="line">    <span class="keyword">const</span> slot = <span class="keyword">this</span>.$slots.default</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªå­ç»„ä»¶å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> vnode = getFirstComponentChild(slot)</span><br><span class="line">    <span class="keyword">const</span> componentOptions = vnode &amp;&amp; vnode.componentOptions</span><br><span class="line">    <span class="comment">// æ˜¯å¦å­˜åœ¨ç»„ä»¶å‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (componentOptions) &#123;</span><br><span class="line">      <span class="keyword">const</span> name = getComponentName(componentOptions)<span class="comment">// è·å–ç»„ä»¶åå­—</span></span><br><span class="line">      <span class="keyword">const</span> &#123;include, exclude&#125; = <span class="keyword">this</span></span><br><span class="line">      <span class="comment">// åˆ¤æ–­å¦‚æœincludeæ²¡æœ‰å½“å‰çš„nameæˆ–è€…excludeæœ‰ä¸éœ€è¦ç¼“å­˜çš„name  å°±è¿”å›vnode</span></span><br><span class="line">      <span class="keyword">if</span> ((include &amp;&amp; (!name || !matches(include, name))) || (exclude &amp;&amp; name &amp;&amp; matches(exclude, name))) &#123;</span><br><span class="line">        <span class="keyword">return</span> vnode</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123;cache, keys&#125; = <span class="keyword">this</span></span><br><span class="line">      <span class="comment">// æ ¹æ®ç»„ä»¶IDå’Œtagç”Ÿæˆç¼“å­˜Keyï¼Œä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å¼€å‘çš„æ—¶å€™ï¼Œçƒ­åŠ è½½åå¯èƒ½æ˜¯ç©ºé¡µé¢ã€‚</span></span><br><span class="line">      <span class="keyword">const</span> key = vnode.key == <span class="literal">null</span> ?</span><br><span class="line">        componentOptions.Ctor.cid + (componentOptions.tag ? <span class="string">`::<span class="subst">$&#123;componentOptions.tag&#125;</span>`</span> : <span class="string">''</span>) :</span><br><span class="line">        vnode.key</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (cache[key]) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰ç¼“å­˜çš„è¯ï¼Œç›´æ¥èµ‹å€¼ç»™vnode</span></span><br><span class="line">        vnode.componentInstance = cache[key].componentInstance</span><br><span class="line">        remove(keys, key)  <span class="comment">// åˆ é™¤å½“å‰çš„é”®</span></span><br><span class="line">        keys.push(key)  <span class="comment">// ç„¶åæŠŠè¿™ä¸ªé”®è¿½åŠ åˆ°æœ€åä¸€ä½ï¼Œç›®çš„å°±æ˜¯æ’åºï¼Œé˜²æ­¢åé¢maxçš„å¹²æ‰°</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰ç¼“å­˜çš„è¯ï¼Œç›´æ¥éƒ½å­˜å‚¨èµ·æ¥</span></span><br><span class="line">        cache[key] = vnode</span><br><span class="line">        keys.push(key)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.max &amp;&amp; keys.length &gt; <span class="built_in">parseInt</span>(<span class="keyword">this</span>.max)) &#123;</span><br><span class="line">          <span class="comment">// è¶…è¿‡ç¼“å­˜æ•°é™åˆ¶ï¼Œå°†ç¬¬ä¸€ä¸ªåˆ é™¤</span></span><br><span class="line">          <span class="comment">// ä»è¿™ä¸ªçœ‹å‡ºåŠ¨æ€æ”¹å˜maxçš„æ•°å€¼ï¼Œå¹¶ä¸èƒ½æ§åˆ¶ç¼“å­˜çš„ä¸ªæ•°ï¼Œå› ä¸ºä¸Šé¢å¹¶æ²¡æœ‰watchç›‘æ§maxçš„æ”¹å˜ã€‚</span></span><br><span class="line">          pruneCacheEntry(cache, keys[<span class="number">0</span>], keys, <span class="keyword">this</span>._vnode)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      vnode.data.keepAlive = <span class="literal">true</span>  <span class="comment">// è¿™ä¸ªå†³å®šå¤–é¢ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ‰§è¡Œï¼Œå¾ˆé‡è¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vnode || (slot &amp;&amp; slot[<span class="number">0</span>])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å¤§è‡´å¯ä»¥åˆ†ä¸ºè¿™å‡ æ­¥ï¼š</p><ol><li>åœ¨è¦ç¼“å­˜çš„ç»„ä»¶ä¸Šä½¿ç”¨keep-aliveæ ‡ç­¾</li><li>æ ¹æ®ä¼ é€’çš„å‚æ•°ï¼Œçœ‹æ˜¯å¦è¦æ·»åŠ ç¼“å­˜å’Œé™åˆ¶çš„ä¸ªæ•°ï¼Œä¸ç¼“å­˜ç›´æ¥è¿”å›ä½ å½“å‰çš„vnodeï¼Œè‹¥éœ€è¦ç¼“å­˜å°±æ ¹æ®ç”Ÿæˆçš„keyè¿›è¡Œå¯¹è±¡å­˜å‚¨</li><li>å­˜å‚¨çš„è¿‡ç¨‹è¦æ³¨æ„ max å’Œå­˜å‚¨çš„ä½ç½®ï¼Œå¦‚æœå¤§äºmaxå°±è¦æŠŠç´¢å¼•æ˜¯1çš„keyåˆ é™¤ï¼Œ å®ç°ç½®æ¢ä½ç½®ã€‚</li><li>å°†è¯¥ç»„ä»¶å®ä¾‹çš„keepAliveå±æ€§å€¼è®¾ç½®ä¸ºtrue(this.$vnode.data.keepAlive å¯ä»¥è·å–åˆ°ï¼Œå¤šçš„ä¸¤ä¸ªå£°æ˜å‘¨æœŸéƒ½æ˜¯é€šè¿‡è¿™ä¸ªåˆ¤æ–­) </li></ol><h3 id="é’©å­å‡½æ•°"><a href="#é’©å­å‡½æ•°" class="headerlink" title="é’©å­å‡½æ•°"></a>é’©å­å‡½æ•°</h3><h4 id="åªæ‰§è¡Œä¸€æ¬¡çš„é’©å­"><a href="#åªæ‰§è¡Œä¸€æ¬¡çš„é’©å­" class="headerlink" title="åªæ‰§è¡Œä¸€æ¬¡çš„é’©å­"></a>åªæ‰§è¡Œä¸€æ¬¡çš„é’©å­</h4><p><code>keep-alive</code>æ˜¯ä½¿ç”¨ä½ ä¹‹å‰å­˜å‚¨çš„vnodeï¼Œç„¶åç›´æ¥è½¬æ¢æˆçœŸå®domï¼Œæ˜¯å‘ç”Ÿåœ¨diffä¹‹å patché˜¶æ®µ,æ‰€ä»¥ç¼“å­˜çš„ç»„ä»¶æ˜¯æ²¡æœ‰ <code>created,mounted</code> è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå…·ä½“çœ‹ä¸‹é¢çš„ä»£ç åˆ†æã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/core/vdom/create-component.js</span></span><br><span class="line"><span class="keyword">const</span> componentVNodeHooks = &#123;</span><br><span class="line">  init (vnode: VNodeWithData, <span class="attr">hydrating</span>: boolean): ?boolean &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      vnode.componentInstance &amp;&amp;</span><br><span class="line">      !vnode.componentInstance._isDestroyed &amp;&amp;</span><br><span class="line">      vnode.data.keepAlive  <span class="comment">// è¿™é‡Œæ˜¯åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº† keepAlive</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">const</span> mountedNode: any = vnode</span><br><span class="line">      componentVNodeHooks.prepatch(mountedNode, mountedNode) <span class="comment">// ç›´æ¥åˆ°äº†patché˜¶æ®µ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> child = vnode.componentInstance = createComponentInstanceForVnode(</span><br><span class="line">        vnode,</span><br><span class="line">        activeInstance</span><br><span class="line">      )</span><br><span class="line">      child.$mount(hydrating ? vnode.elm : <span class="literal">undefined</span>, hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  prepatch (oldVnode: MountedComponentVNode, <span class="attr">vnode</span>: MountedComponentVNode) &#123;</span><br><span class="line">    <span class="keyword">const</span> options = vnode.componentOptions</span><br><span class="line">    <span class="keyword">const</span> child = vnode.componentInstance = oldVnode.componentInstance</span><br><span class="line">    updateChildComponent(</span><br><span class="line">      child, <span class="comment">// child.$scopedSlots</span></span><br><span class="line">      options.propsData, <span class="comment">// updated props</span></span><br><span class="line">      options.listeners, <span class="comment">// updated listeners</span></span><br><span class="line">      vnode, <span class="comment">// vnode.data.scopedSlots </span></span><br><span class="line">      options.children <span class="comment">// new children</span></span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">  insert (vnode) &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; context, componentInstance &#125; = vnode</span><br><span class="line">   <span class="keyword">if</span> (!componentInstance._isMounted) &#123;</span><br><span class="line">     componentInstance._isMounted = <span class="literal">true</span></span><br><span class="line">     callHook(componentInstance, <span class="string">'mounted'</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (vnode.data.keepAlive) &#123;</span><br><span class="line">     <span class="keyword">if</span> (context._isMounted) &#123;</span><br><span class="line">       queueActivatedComponent(componentInstance)</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       activateChildComponent(componentInstance, <span class="literal">true</span>) <span class="comment">// è¿™ä¸ªå°±æ˜¯æ–°å¢çš„é‚£ä¸ªactivateç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line">destroy (vnode) &#123;</span><br><span class="line"> <span class="keyword">const</span> &#123; componentInstance &#125; = vnode</span><br><span class="line"> <span class="keyword">if</span> (!componentInstance._isDestroyed) &#123;</span><br><span class="line">   <span class="keyword">if</span> (!vnode.data.keepAlive) &#123;</span><br><span class="line">     componentInstance.$destroy()</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     deactivateChildComponent(componentInstance, <span class="literal">true</span>) <span class="comment">// æ–°å¢çš„deactivateç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œå½“vnode.componentInstance(ç¬¬ä¸€æ¬¡è¿›æ¥æ˜¯ç©ºçš„)å’ŒkeepAliveåŒæ—¶ä¸ºtrueæ—¶ï¼Œä¸å†è¿›å…¥$mountè¿‡ç¨‹ï¼Œé‚£mountedä¹‹å‰çš„æ‰€æœ‰é’©å­å‡½æ•°ï¼ˆbeforeCreateã€createdã€mountedï¼‰éƒ½ä¸å†æ‰§è¡Œã€‚</p><h4 id="è°ƒç”¨activated"><a href="#è°ƒç”¨activated" class="headerlink" title="è°ƒç”¨activated"></a>è°ƒç”¨activated</h4><p>åœ¨patchçš„é˜¶æ®µï¼Œæœ€åä¼šæ‰§è¡ŒinvokeInsertHookå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å»è°ƒç”¨ç»„ä»¶å®ä¾‹ï¼ˆVNodeï¼‰è‡ªèº«çš„<code>insert</code>é’©å­ï¼Œå°±æ˜¯ä¸Šé¢çš„é‚£æ®µä»£ç ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/core/vdom/patch.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invokeInsertHook</span> (<span class="params">vnode, queue, initial</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// delay insert hooks for component root nodes, invoke them after the</span></span><br><span class="line">  <span class="comment">// element is really inserted</span></span><br><span class="line">  <span class="keyword">if</span> (isTrue(initial) &amp;&amp; isDef(vnode.parent)) &#123;</span><br><span class="line">    vnode.parent.data.pendingInsert = queue</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; queue.length; ++i) &#123;</span><br><span class="line">      queue[i].data.hook.insert(queue[i]) <span class="comment">// è°ƒå–insertæ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°±æ˜¯ä¸Šé¢componentVNodeHooksçš„insertçš„æ–¹æ³•</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> insert (vnode) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; context, componentInstance &#125; = vnode</span><br><span class="line">  <span class="keyword">if</span> (!componentInstance._isMounted) &#123;</span><br><span class="line">    componentInstance._isMounted = <span class="literal">true</span></span><br><span class="line">    callHook(componentInstance, <span class="string">'mounted'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vnode.data.keepAlive) &#123;</span><br><span class="line">    <span class="keyword">if</span> (context._isMounted) &#123;</span><br><span class="line">      queueActivatedComponent(componentInstance)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      activateChildComponent(componentInstance, <span class="literal">true</span>) <span class="comment">// è¿™ä¸ªå°±æ˜¯æ–°å¢çš„é‚£ä¸ªactivateç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>çœ‹ä¸‹activateChildComponentå‡½æ•°</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/lifecycle.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deactivateChildComponent</span> (<span class="params">vm, direct</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!vm._inactive) &#123;</span><br><span class="line">    vm._inactive = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; vm.$children.length; i++) &#123;</span><br><span class="line">      deactivateChildComponent(vm.$children[i])</span><br><span class="line">    &#125;</span><br><span class="line">    callHook(vm, <span class="string">'deactivated'</span>) <span class="comment">//æ·»åŠ é’©å­æ–¹æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>deactivated</code>é’©å­å‡½æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„åŸç†ï¼Œåœ¨ç»„ä»¶å®ä¾‹ï¼ˆVNodeï¼‰çš„destroyé’©å­å‡½æ•°ä¸­è°ƒç”¨<code>deactivateChildComponent</code>å‡½æ•°ã€‚</p><h3 id="æ¸²æŸ“"><a href="#æ¸²æŸ“" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h3><p><strong>keep-aliveç»„ä»¶çš„æ¸²æŸ“</strong></p><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/instance/lifecycle.js#L32-L42" target="_blank" rel="noopener">/src/core/instance/lifecycle.js</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// /src/core/instance/lifecycle.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initLifecycle</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> options = vm.$options</span><br><span class="line">   <span class="comment">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªéabstractçˆ¶ç»„ä»¶å®ä¾‹</span></span><br><span class="line">  <span class="keyword">let</span> parent = options.parent</span><br><span class="line">  <span class="keyword">if</span> (parent &amp;&amp; !options.abstract) &#123;</span><br><span class="line">    <span class="keyword">while</span> (parent.$options.abstract &amp;&amp; parent.$parent) &#123;</span><br><span class="line">      parent = parent.$parent</span><br><span class="line">    &#125;</span><br><span class="line">    parent.$children.push(vm)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"><span class="comment">// å®ä¾‹ä¸Šçš„ä¸€äº›å‚æ•°èµ‹å€¼</span></span><br></pre></td></tr></table></figure><p><strong>keep-aliveåŒ…è£¹çš„ç»„ä»¶æ˜¯å¦‚ä½•ä½¿ç”¨ç¼“å­˜çš„ï¼Ÿ</strong></p><p>åœ¨patché˜¶æ®µï¼Œä¼šæ‰§è¡ŒcreateComponentå‡½æ•°ï¼š</p><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/vdom/patch.js#L210-L230" target="_blank" rel="noopener">/src/core/vdom/patch.js</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// /src/core/vdom/patch.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createComponent</span> (<span class="params">vnode, insertedVnodeQueue, parentElm, refElm</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = vnode.data</span><br><span class="line">  <span class="keyword">if</span> (isDef(i)) &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡è¿›æ¥æ˜¯æ²¡æœ‰è¿™ä¸ªçš„ ï¼ˆvnode.componentInstanceï¼‰ï¼Œæ˜¯åœ¨keep-aliveé‡Œé¢èµ‹å€¼çš„</span></span><br><span class="line">    <span class="keyword">const</span> isReactivated = isDef(vnode.componentInstance) &amp;&amp; i.keepAlive</span><br><span class="line">    <span class="keyword">if</span> (isDef(i = i.hook) &amp;&amp; isDef(i = i.init)) &#123;</span><br><span class="line">      i(vnode, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isDef(vnode.componentInstance)) &#123;</span><br><span class="line">      initComponent(vnode, insertedVnodeQueue)</span><br><span class="line">      insert(parentElm, vnode.elm, refElm) <span class="comment">// ç›´æ¥å¡ç»™çˆ¶çº§</span></span><br><span class="line">      <span class="keyword">if</span> (isTrue(isReactivated)) &#123; <span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯ç©ºçš„</span></span><br><span class="line">        reactivateComponent(vnode, insertedVnodeQueue, parentElm, refElm) <span class="comment">// ç„¶ååœ¨è¿›è¡Œå“åº”å¼</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> æºç åˆ†æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨keepAliveé‡åˆ°çš„å‘</title>
      <link href="/2020/05/25/workspace/Frame/vue/keep-alive/"/>
      <url>/2020/05/25/workspace/Frame/vue/keep-alive/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ä½¿ç”¨keepAliveé‡åˆ°çš„å‘</strong></p><p>[[toc]]</p><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><code>keep-alive</code>æ˜¯<code>vue</code>çš„ä¸€ä¸ªå†…ç½®ç»„ä»¶ã€‚å®ƒä¼šç¼“å­˜ä¸æ´»åŠ¨çš„<strong>ç»„ä»¶å®ä¾‹</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥å°†å…¶é”€æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼Œä¸ä¼šè¢«æ¸²æŸ“åˆ°çœŸå®DOMä¸­ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨çˆ¶ç»„ä»¶é“¾ä¸­ã€‚å®ƒæä¾›äº†<code>include</code>ä¸<code>exclude</code>å±æ€§ï¼Œå…è®¸ç»„ä»¶æœ‰æ¡ä»¶åœ°è¿›è¡Œç¼“å­˜ï¼Œå…¶ä¸­excludeçš„ä¼˜å…ˆçº§æ¯”includeé«˜ï¼Œmaxæœ€å¤šå¯ä»¥ç¼“å­˜å¤šå°‘ç»„ä»¶å®ä¾‹ã€‚</p><p><a href="https://cn.vuejs.org/v2/api/#keep-alive" target="_blank" rel="noopener">keep-aliveè¯¦è§£æ–‡æ¡£</a></p><p>ä½¿ç”¨ <code>keep-alive</code>çš„è¯ä¼šå¢åŠ ä¸¤ä¸ªé’©å­å‡½æ•°ï¼Œ <code>activated</code> å’Œ <code>deactivated</code></p><p>ä¸‹é¢çš„æ–‡ç« æˆ‘æ˜¯<code>keep-alive</code>é…åˆ<code>vue-router</code>ä¸€å—ä½¿ç”¨çš„ï¼Œå½“å‰<code>keep-alive</code>ä¹Ÿå¯ä»¥ç¼“å­˜å•ä¸ªç»„ä»¶ï¼Œåœ¨è¿™é‡Œå°±ä¸å¤šèµ˜è¿°ã€‚</p><h2 id="includeå’Œexclude"><a href="#includeå’Œexclude" class="headerlink" title="includeå’Œexclude"></a>includeå’Œexclude</h2><p><code>include</code> å’Œ <code>exclude</code> prop å…è®¸ç»„ä»¶æœ‰æ¡ä»¶åœ°ç¼“å­˜ã€‚äºŒè€…éƒ½å¯ä»¥ç”¨<code>é€—å·åˆ†éš”å­—ç¬¦ä¸²</code>ã€<code>æ­£åˆ™è¡¨è¾¾å¼</code>æˆ–ä¸€ä¸ª<code>æ•°ç»„</code>æ¥è¡¨ç¤ºè¯¦ç»†å¥æ–‡æ¡£</p><p>æˆ‘è¿™é‡Œä½¿ç”¨çš„<code>vuex</code>é…åˆæ•°ç»„åŠ¨æ€æ§åˆ¶</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;keep-alive :include=<span class="string">"includes"</span> exclude=<span class="string">""</span> :max=<span class="string">"10"</span> &gt;</span><br><span class="line">   &lt;router-view/&gt;</span><br><span class="line">&lt;<span class="regexp">/keep-alive&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp"> export default &#123;</span></span><br><span class="line"><span class="regexp">computed: &#123;</span></span><br><span class="line"><span class="regexp">  includes() &#123;</span></span><br><span class="line"><span class="regexp">     return state =&gt; state.router.includes</span></span><br><span class="line"><span class="regexp">   &#125;</span></span><br><span class="line"><span class="regexp">&#125;,</span></span><br><span class="line"><span class="regexp">methods: &#123;</span></span><br><span class="line"><span class="regexp">     changeStoreIncludes() &#123;</span></span><br><span class="line"><span class="regexp">       this.$store.commit('changeIncludes', 'tableLists');</span></span><br><span class="line"><span class="regexp">     &#125;</span></span><br><span class="line"><span class="regexp">   &#125;  </span></span><br><span class="line"><span class="regexp"> &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// vuex</span></span><br><span class="line">mutations: &#123;</span><br><span class="line">changeIncludes(state, payload) &#123;</span><br><span class="line">  state.includes = payload</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="includeå’Œexcludeæ— æ•ˆé—®é¢˜"><a href="#includeå’Œexcludeæ— æ•ˆé—®é¢˜" class="headerlink" title="includeå’Œexcludeæ— æ•ˆé—®é¢˜"></a>includeå’Œexcludeæ— æ•ˆé—®é¢˜</h3><p>ä½¿ç”¨<code>include/exclude</code> å±æ€§éœ€è¦ç»™æ‰€æœ‰<code>vueç±»çš„name</code>èµ‹å€¼ï¼ˆæ³¨æ„ä¸æ˜¯ç»™routeçš„nameèµ‹å€¼ï¼‰ï¼Œå¦åˆ™ <code>include/exclude</code>ä¸ç”Ÿæ•ˆ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> name:<span class="string">'TableList'</span>, <span class="comment">// include æˆ– excludeæ‰€ä½¿ç”¨çš„name</span></span><br><span class="line"> data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›´æ¥ä½¿ç”¨v-ifåšåŒºåˆ†"><a href="#ç›´æ¥ä½¿ç”¨v-ifåšåŒºåˆ†" class="headerlink" title="ç›´æ¥ä½¿ç”¨v-ifåšåŒºåˆ†"></a>ç›´æ¥ä½¿ç”¨v-ifåšåŒºåˆ†</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">enter-active-class</span>=<span class="string">"animated zoomInLeft"</span> <span class="attr">leave-active-class</span>=<span class="string">"animated zoomOutRight"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-if</span>=<span class="string">"$route.meta.keepAlive"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">enter-active-class</span>=<span class="string">"animated zoomInLeft"</span> <span class="attr">leave-active-class</span>=<span class="string">"animated zoomOutRight"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-if</span>=<span class="string">"!$route.meta.keepAlive"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·åšçš„è¯æ›´åŠ ç®€å•æ˜äº†ï¼Œè€Œä¸”é…åˆåŠ¨ç”»æ›´æ­ï¼Œä¸ç”¨å†<code>vue</code>ç»„ä»¶é‡Œé¢å£°æ˜<code>name</code>ï¼Œä½†æ˜¯è¦åœ¨<code>route</code>çš„<code>meta</code>é‡Œé¢æ·»åŠ  <code>{keepAlive:true}</code>å­—æ®µï¼Œå¦‚æœè·¯ç”±æ˜¯åå°æ§åˆ¶çš„è¯ï¼Œå‰ç«¯è°ƒè¯•å°±æ¯”è¾ƒé¸¡è‚‹ã€‚</p><p><strong>æš´éœ²çš„é—®é¢˜</strong></p><p><strong>é—®é¢˜1ï¼š</strong></p><p>ä½ç½®å…¬ç”¨çš„é—®é¢˜ï¼Œå½“å‰åˆ—è¡¨é¡µè·³è½¬åˆ°è¯¦æƒ…é¡µé¢çš„æ—¶å€™ï¼Œä½¿ç”¨è·¯ç”±å›åˆ°åˆ—è¡¨ä¹Ÿæ—¶å€™ï¼Œä¼šå‡ºç°ä½ç½®å…¬ç”¨çš„æƒ…å†µã€‚ï¼ˆå¦‚æœä½¿ç”¨æµè§ˆå™¨çš„å›é€€æ–¹å¼ï¼Œä¸ä¼šå‡ºç°ä½ç½®å…¬ç”¨çš„æƒ…å†µã€‚ï¼‰</p><blockquote><p><strong>å¯¹äºè¿™ä¸ªä½ç½®å…¬ç”¨çš„æƒ…å†µï¼Œæˆ‘æ˜¯ä¸€å¤´é›¾æ°´ï¼ŒæœŸå¾…å¤§ä½¬è§£ç­”</strong> ğŸ¤ï¼Œæœ‰å‡ ç‚¹è¦è¯´çš„ä¸çŸ¥å¯¹é”™ï¼Œå¾…æ±‚è¯ã€‚</p><ul><li><strong>å¤šé¡µé¢</strong></li></ul><ol><li>å¦‚æœæœ‰æ•°æ®è¯·æ±‚çš„è¯ï¼Œæµè§ˆå™¨å°†ä¼šæŠŠé¡µé¢ç½®é¡¶ï¼Ÿ</li><li>å¦‚æœæ˜¯é™æ€é¡µé¢çš„è¯ï¼Œæµè§ˆå™¨ä¼šæ»šåˆ°ä½ ä¹‹å‰æ»šåŠ¨çš„åœ°æ–¹ï¼Ÿ</li><li>ä¸Šé¢ä»…ä»…æ˜¯ä½¿ç”¨çš„æµè§ˆå™¨çš„è·³è½¬è¡Œä¸ºï¼Œå¦‚æœä½¿ç”¨hrefæˆ–è€…è·¯ç”±å°è£…ä¸€äº›æ–¹æ³•ï¼Œåˆ™éƒ½ä¼šç½®é¡¶ï¼Ÿ</li></ol><ul><li><strong>æ±‚è¯ä¸Šé¢ ğŸ¤</strong></li></ul><ol start="4"><li>åŸºäºSPAæ¨¡å¼å¼€å‘ï¼Œæ‰€ä»¥é¡µé¢ä»…æœ‰ä¸€ä¸ªï¼Œå®ç°é¡µé¢åˆ‡æ¢æ˜¯åˆ©ç”¨å“ˆå¸Œä¸ç»„ä»¶çš„æ˜ å°„å…³ç³»ï¼Œvue-routeræ˜¯é€šè¿‡å“ˆå¸Œæ¥æ¨¡æ‹Ÿå®Œæ•´çš„urlï¼Œä½†æ˜¯å¯¹äºé¡µé¢æ¥è¯´ä»æ˜¯ä¸€ä¸ªurlï¼Œæ‰€ä»¥åœ¨ä»»ä½•ä¸€ä¸ªç»„ä»¶æ»šåŠ¨é¡µé¢ï¼Œåˆ‡æ¢åˆ°å…¶ä»–ç»„ä»¶çš„æ—¶å€™ï¼Œé¡µé¢ä»ä¿æŒæ»šåŠ¨ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯å‡ºç°ä½ç½®å…¬ç”¨çš„æƒ…å†µ.</li></ol></blockquote><p><strong>é—®é¢˜2ï¼š</strong></p><p>åŠ å…¥æœ‰<code>A B C</code>ä¸‰ä¸ªé¡µé¢ï¼Œæˆ‘ç°åœ¨åªæƒ³è¦<code>A-&gt;B</code>æ—¶<code>A</code>ç¼“å­˜ï¼Œç„¶å<code>B-&gt;A</code>æ—¶ï¼Œå±•ç¤ºç¼“å­˜çš„é¡µé¢ï¼Œ<code>C-&gt;A</code>ã€<code>A-&gt;B-&gt;C-&gt;A</code>ç­‰éƒ½ä¸è¦ç¼“å­˜ã€‚</p><h2 id="scrollBehavior"><a href="#scrollBehavior" class="headerlink" title="scrollBehavior"></a>scrollBehavior</h2><p>å¯¹äº <strong><code>é—®é¢˜1</code></strong> æˆ‘çš„æƒ³æ³•æ˜¯ï¼Œè·³è½¬å‰ç›´æ¥æŠŠæ»šåŠ¨é«˜åº¦ç¼“å­˜èµ·æ¥ï¼Œç„¶åæ¯æ¬¡å†å›æ¥çš„æ—¶å€™ï¼Œåœ¨æŠŠé«˜åº¦åœ¨é‡æ–°èµ‹å€¼ç»™å®ƒï¼Œä½†æ˜¯å¦‚æœæˆ‘é¡µé¢ç‰¹åˆ«å¤šéƒ½éœ€è¦ä½¿ç”¨ç¼“å­˜çš„æ—¶å€™ï¼Œå°±æœ‰äº›éº»çƒ¦ï¼Œç„¶åæˆ‘å‘ç°è·¯ç”±æä¾›çš„ä¸€ä¸ªè¿™æ ·çš„æ–¹æ³•ã€‚</p><p><a href="https://router.vuejs.org/zh/guide/advanced/scroll-behavior.html" target="_blank" rel="noopener">scrollBehavioræ–‡æ¡£è¯¦è§£</a></p><p><strong>scrollBehavior</strong> æ–¹æ³•æ¥æ”¶ to å’Œ from è·¯ç”±å¯¹è±¡ã€‚<strong>ç¬¬ä¸‰ä¸ªå‚æ•° <code>savedPosition</code></strong> å½“ä¸”ä»…å½“ popstate å¯¼èˆª (<code>é€šè¿‡æµè§ˆå™¨çš„ å‰è¿›/åé€€ æŒ‰é’®è§¦å‘</code>) æ—¶æ‰å¯ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">'hash'</span>,</span><br><span class="line">  routes,</span><br><span class="line">  scrollBehavior(to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">    <span class="comment">// æ­¤æ–¹æ³•é»˜è®¤æ˜¯æ£€æµ‹ document.body çš„ï¼Œå¦‚æœä½ æ˜¯è‡ªå®šä¹‰çš„æ»šåŠ¨ç›’å­ æ˜¯æ²¡åŠæ³•æ§åˆ¶ä½ çš„æ»šåŠ¨é«˜åº¦ï¼Œéƒ½æ˜¯ 0</span></span><br><span class="line">    <span class="built_in">console</span>.log(savedPosition);</span><br><span class="line">    <span class="comment">// å¦‚æœè¿”å›ä¸€ä¸ª falsy(ä¸æ˜¯false) ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œé‚£ä¹ˆä¸ä¼šå‘ç”Ÿæ»šåŠ¨,è¯´ç™½äº†å°±æ˜¯è¿™ä¸ªæ–¹æ³•æ²¡ç”¨ï¼Œå¹¶ä¸ä¼šåœ¨é¡µé¢é¡¶éƒ¨</span></span><br><span class="line">    <span class="comment">// falsyæ–‡æ¡£ https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy</span></span><br><span class="line">    <span class="keyword">if</span> (savedPosition) &#123;</span><br><span class="line">      <span class="keyword">return</span> savedPosition</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">from</span>.meta.keepAlive) &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¹¶ä¸å‡†ç¡®ï¼Œå¯èƒ½æˆ‘é¡µé¢æ»šåŠ¨çš„ç›’å­ä¸æ˜¯body,vueåº”è¯¥æœ‰è®¾ç½®çš„åœ°æ–¹</span></span><br><span class="line">        <span class="keyword">from</span>.meta.scrollTop = <span class="built_in">document</span>.documentElement.scrollTop;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: to.meta.scrollTop || <span class="number">0</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°ç‰ˆæœ¬æ”¯æŒå¼‚æ­¥æ»šåŠ¨ï¼Œè¿”å›ä¸€ä¸ªPromiseï¼Œè¿™ä¸ªç‰¹åˆ«æœ‰ç”¨ï¼Œä¹‹å‰çš„æ–¹å¼å¦‚æœé¡µé¢é‡Œæœ‰å¼‚æ­¥è¯·æ±‚çš„è¯ï¼Œæ˜¯ä¸èƒ½å¤Ÿç½®é¡¶çš„</span></span><br><span class="line">scrollBehavior(to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">  <span class="keyword">if</span> (savedPosition) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        resolve(savedPosition)</span><br><span class="line">      &#125;, <span class="number">20</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">from</span>.meta.keepAlive) &#123;</span><br><span class="line">      <span class="keyword">from</span>.meta.scrollTop = <span class="built_in">document</span>.documentElement.scrollTop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: to.meta.scrollTop || <span class="number">0</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ç°è¿”å›ä¸åˆ·æ–°ã€å…¶ä»–èœå•è¿›å…¥åˆ·æ–°"><a href="#å®ç°è¿”å›ä¸åˆ·æ–°ã€å…¶ä»–èœå•è¿›å…¥åˆ·æ–°" class="headerlink" title="å®ç°è¿”å›ä¸åˆ·æ–°ã€å…¶ä»–èœå•è¿›å…¥åˆ·æ–°"></a>å®ç°è¿”å›ä¸åˆ·æ–°ã€å…¶ä»–èœå•è¿›å…¥åˆ·æ–°</h2><h3 id="å®ç°æ–¹å¼ä¸€"><a href="#å®ç°æ–¹å¼ä¸€" class="headerlink" title="å®ç°æ–¹å¼ä¸€"></a>å®ç°æ–¹å¼ä¸€</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.vue</span></span><br><span class="line">&lt;keep-alive&gt;</span><br><span class="line">   &lt;router-view v-<span class="keyword">if</span>=<span class="string">"$route.meta.keepAlive"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/keep-alive&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;router-view v-if="!$route.meta.keepAlive" /</span>&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router.js</span></span><br><span class="line">&#123;</span><br><span class="line">   path: <span class="string">'/table-list'</span>,</span><br><span class="line">   name: <span class="string">'table-list'</span>,</span><br><span class="line">   component: TableList,</span><br><span class="line">   meta: &#123;<span class="attr">keepAlive</span>: <span class="literal">true</span>&#125; <span class="comment">// æ·»åŠ è¿™ä¸ª</span></span><br><span class="line"> &#125;,</span><br><span class="line"> &#123;</span><br><span class="line">   path: <span class="string">'/table-detail'</span>,</span><br><span class="line">   name: <span class="string">'table-detail'</span>,</span><br><span class="line">   component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../views/table-detail.vue'</span>),</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æ–¹å¼ä¸€å’Œæ–¹å¼äºŒéƒ½æ˜¯åŸºäºä¸Šé¢è¿™ä¸¤ä¸ªä»£ç æ®µã€‚</p><p>åœ¨è¦ç¼“å­˜çš„åˆ—è¡¨é¡µæ·»åŠ ä¸‹é¢çš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">activated() &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿›æ¥çš„æ—¶å€™ï¼Œå°±ä¸ç”¨æ‰§è¡Œä¸‹é¢çš„å‡½æ•°ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.hasFirst) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">this</span>.queryList()</span><br><span class="line">&#125;,</span><br><span class="line">beforeRouteLeave(to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.name === <span class="string">'table-detail'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">from</span>.meta.keepAlive) &#123;</span><br><span class="line">      <span class="keyword">from</span>.meta.keepAlive = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">from</span>.meta.keepAlive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.$destroy(); <span class="comment">//é”€æ¯ç±»é¡µè¡¨é¡µçš„å®ä¾‹ï¼Œæœ‰å‘</span></span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæˆä¸Šé¢çš„ä»£ç åï¼Œ<code>A-&gt;B-&gt;A</code>æ­£å¸¸ï¼Œç„¶åå½“<code>A-&gt;C-&gt;A-&gt;B-&gt;A</code>å‘ç°åˆ—è¡¨é¡µAä¸ä¼šå†ç¼“å­˜äº†ï¼Œæ¯æ¬¡éƒ½æ˜¯æ–°çš„é¡µé¢ã€‚è°·æ­Œåçš„æ–¹æ³•æ˜¯è‹¥ä¸æ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥å°±å¼ºåˆ¶åˆ·æ–°ä¸€æ¬¡ç¼“å­˜é¡µé¢ã€‚<br><strong><code>this.$destroy()</code></strong>  è°ƒç”¨<code>distory</code>ä¹‹åä¸èƒ½å†ç¼“å­˜è¯¥ç»„ä»¶ è€Œä¸”ä¼šä¸æ–­è¿›å…¥è¿™ä¸ªé¡µé¢åé‡å¤ç”Ÿæˆå¤šä¸ªè™šæ‹Ÿdom.</p><p>ç»§ç»­å®Œå–„ï¼Œåœ¨<code>main.js</code>ä¸­ä½¿ç”¨router.afterEach((to,from)=&gt;{})</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸç†æ˜¯å¦‚æœä¸æ˜¯ä»è¯¦æƒ…é¡µè¿›æ¥çš„é¡µé¢ï¼Œéƒ½éœ€è¦åˆ·æ–°ï¼Œå¦åˆ™ä¸èƒ½ç¼“å­˜</span></span><br><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå½“å‰é¡µé¢åˆ·æ–°æˆ–è€…ä»è¯¦æƒ…ä¹Ÿè¿›æ¥ï¼Œå°±è¦æ‰§è¡Œä¸‹é¢ä»£ç ï¼Œé˜²æ­¢æ‰§è¡Œé”€æ¯æ–¹æ³•å¯¼è‡´ä¸èƒ½ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">from</span>.name &amp;&amp; <span class="keyword">from</span>.name !== <span class="string">'table-detail'</span> &amp;&amp; to.name === <span class="string">'table-list'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> isRefresh = sessionStorage.getItem(<span class="string">'isRefresh'</span>)</span><br><span class="line">    <span class="keyword">if</span> (isRefresh === <span class="string">'0'</span>) &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="comment">// è¿™é‡Œå¿…é¡»æ˜¯å¼‚æ­¥çš„ï¼Œä¸ç„¶ä¸èƒ½è·³è½¬</span></span><br><span class="line">        <span class="built_in">window</span>.location.reload()</span><br><span class="line">      &#125;)</span><br><span class="line">      sessionStorage.setItem(<span class="string">'isRefresh'</span>, <span class="literal">null</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      sessionStorage.setItem(<span class="string">'isRefresh'</span>, <span class="string">'0'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">from</span>.name === <span class="string">'table-list'</span> &amp;&amp; to.name === <span class="string">'table-detail'</span>) &#123;</span><br><span class="line">    sessionStorage.setItem(<span class="string">'isRefresh'</span>, <span class="literal">null</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    sessionStorage.setItem(<span class="string">'isRefresh'</span>, <span class="string">'0'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸çŸ¥é“è°·æ­Œå‡ºæ¥çš„è§£å†³æ–¹æ¡ˆä¸ºä»€ä¹ˆéƒ½åœ¨è¯¦æƒ…é¡µåˆ·æ–°ï¼Œè¿™æ ·çš„é—®é¢˜å°±æ˜¯ç”¨æˆ·ç¬¬ä¸€æ¬¡è·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œå†å›åˆ°åˆ—è¡¨é¡µæ˜¯æ²¡æœ‰ç¼“å­˜çš„åŠŸèƒ½ï¼Œç¬¬äºŒæ¬¡å°±ä¼šæ­£å¸¸ï¼Œä½†æ˜¯å®¢æˆ·å¾ˆå¯èƒ½å°±ä¼šæ‰§è¡Œè¿™ä¸€æ¬¡æ“ä½œï¼›</p><p>è¿™ç§è§£å†³æ–¹å¼å¤ªè¿‡åŸå§‹ï¼Œç”¨æˆ·ä½“éªŒå¤ªå·®ï¼Œè€Œä¸”éœ€è¦ç¼“å­˜å¤šä¸ªé¡µé¢å°±ä¸å¤ªå¥½æ§åˆ¶ï¼Œä¸å»ºè®®ç”¨è¿™ä¸ªæ–¹æ³•</p><h3 id="å®ç°æ–¹å¼äºŒ"><a href="#å®ç°æ–¹å¼äºŒ" class="headerlink" title="å®ç°æ–¹å¼äºŒ"></a>å®ç°æ–¹å¼äºŒ</h3><p>çµæ„Ÿæ¥è‡ª<code>æ–¹å¼ä¸€</code>ï¼Œæˆ‘å¯ä»¥å…¶ä»–æ–¹å¼æ¨¡æ‹Ÿé¡µé¢åˆ·æ–°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;!--è¿™é‡Œä¸€å®šè¦ä½¿ç”¨v-<span class="keyword">if</span>ï¼Œå¥½å¤„æ˜¯ä½ å¯ä»¥ä½¿ç”¨$nextTickä½“éªŒæ›´å¥½ï¼Œå¦ä¸€æ–¹é¢æ˜¯åœ¨ä½¿ç”¨v-showä¹‹åï¼Œä»–å°±ç›¸å½“äºéšè—äº†è¯¥é¡µé¢ï¼Œä½†æ˜¯å¦‚æœé‡Œé¢æœ‰ä¸€äº›ä¸ä¼šdiffçš„dom,å°±ä¼šå±•ç¤ºå‡ºæ¥ï¼Œæ¨¡æ‹Ÿåˆ·æ–°çš„ä½“éªŒå°±ä¸å¤ªå¥½ã€‚ä¾‹å¦‚ä½¿ç”¨ input-&gt;</span><br><span class="line">    &lt;div v-<span class="keyword">if</span>=<span class="string">"isRouterAlive"</span>&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123;ddd&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input v-model="ddd" type="text" /</span>&gt;</span><br><span class="line">        &lt;table-list ref=<span class="string">"table"</span> :multiple=<span class="string">"true"</span> :otherTableParams=<span class="string">"otherTableParams"</span> :tableColumn=<span class="string">"column"</span>/&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–ä»£ç  ........</span></span><br><span class="line">    activated() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$route.meta.isRefresh) &#123; <span class="comment">// å¦‚æœä¸æ˜¯è·³è½¬åˆ°è¯¦æƒ…é¡µ</span></span><br><span class="line">        <span class="keyword">const</span> resetData = <span class="keyword">this</span>.$options.data() <span class="comment">// è·å–åŸæ¥dataçš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">delete</span> resetData.column  <span class="comment">// æˆ‘åœ¨è¿™é‡Œæ“ä½œçš„åŸå› æ˜¯å› ä¸ºï¼Œæˆ‘é€šè¿‡ä¸Šé¢è·å–çš„æ•°æ®é‡Œé¢ï¼Œç”¨åˆ°å‡½æ•°è¿”å›çš„å½¢å¼ï¼Œå±•ç¤ºä¸ºundefined  &#123;cb: this.jumpEdit&#125; å±•ç¤ºä¸º &#123;cb: this.undefined&#125;,å…·ä½“åŸå› æœªçŸ¥</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">Object</span>.assign(<span class="keyword">this</span>.$data, resetData) <span class="comment">// é‡ç½®data</span></span><br><span class="line">        <span class="keyword">this</span>.isRouterAlive = <span class="literal">false</span> <span class="comment">// é€šè¿‡v-ifä¸å±•ç¤ºå½“å‰é¡µé¢ </span></span><br><span class="line">        <span class="keyword">this</span>.$nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">          <span class="built_in">window</span>.scroll(<span class="number">0</span>, <span class="number">0</span>) <span class="comment">// é¡µé¢ç½®é¡¶ï¼Œä¸è¦å†ä¸‹é¢çš„å®šæ—¶å™¨é‡Œé¢ä½¿ç”¨ï¼Œæœ‰é¡¿æŒ«æ„Ÿ</span></span><br><span class="line">          <span class="keyword">this</span>.isRouterAlive = <span class="literal">true</span> <span class="comment">// é€šè¿‡v-ifå±•ç¤ºå½“å‰é¡µé¢ </span></span><br><span class="line">        &#125;)</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.queryList() <span class="comment">// å¼‚æ­¥è·å–æ•°æ®ï¼Œè·Ÿæˆ‘çš„é¡¹ç›®ç»„ä»¶æœ‰å…³ï¼Œä½ ä»¬å¯ä»¥ç›´æ¥åœ¨ä¸Šé¢è·å–å°±OK</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeRouteLeave(to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­å¦‚æœä¸æ˜¯è¿›è¯¦æƒ…é¡µï¼Œå±•ç¤ºä¸ºtrue æ˜¯é¡µé¢é‡æ–°åŠ è½½çš„æ„æ€</span></span><br><span class="line">      <span class="keyword">from</span>.meta.isRefresh = to.name !== <span class="string">'table-detail'</span>;</span><br><span class="line">      next() <span class="comment">// ä¸æ·»åŠ è·¯ç”±ä¸ä¼šè·³è½¬</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–</strong><br>ç°åœ¨çš„ä»£ç æœ‰ä¸¤ä¸ªé—®é¢˜<br><code>ä¸€</code>æ˜¯ä»è¯¦æƒ…é¡µåˆ°åˆ—è¡¨é¡µï¼Œæ•°æ®ä¸ä¼šæ›´æ–°ï¼Œå¦‚æœæˆ‘åœ¨è¯¦æƒ…é¡µä¿®æ”¹äº†æŸä¸ªæ•°æ®ï¼Œç„¶åå†åˆ°åˆ—è¡¨é¡µå°±ä¼šæ»å;<br><code>äºŒ</code>æ˜¯ä»è¯¦æƒ…é¡µè·³è½¬åˆ°åˆ«çš„åˆ—è¡¨é¡µç„¶ååœ¨è·³è½¬åˆ°ç¼“å­˜çš„åˆ—è¡¨é¡µï¼Œç„¶åä»–è¿˜æ˜¯ä¼šç¼“å­˜ä¹‹å‰çš„æ•°æ®ï¼Œä¸ä¼šæ›´æ–°å½“å‰é¡µé¢;</p><p>ä¼˜åŒ–å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">activated() &#123;</span><br><span class="line"> <span class="comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿›æ¥ä¸æ‰§è¡Œä¸‹é¢çš„æ–¹æ³•ï¼Œå¦åˆ™ä¼šè¯·æ±‚ä¸¤æ¬¡æ•°æ®</span></span><br><span class="line"> <span class="comment">// this.hasFirst ä¸ç”¨ç”Ÿæˆå“åº”å¼çš„ï¼Œç›´æ¥ä¸€ä¸ªå˜é‡å°±å¥½</span></span><br><span class="line"> <span class="keyword">if</span> (<span class="keyword">this</span>.hasFirst) <span class="keyword">return</span></span><br><span class="line"> <span class="keyword">if</span> (<span class="keyword">this</span>.$route.meta.isRefresh) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">this</span>.$options.data()</span><br><span class="line">    <span class="keyword">delete</span> data.column</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.assign(<span class="keyword">this</span>.$data, data)</span><br><span class="line">    <span class="keyword">this</span>.isRouterAlive = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.$nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">window</span>.scroll(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">this</span>.isRouterAlive = <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.queryList()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.$route.meta.isRefresh === <span class="literal">false</span>) &#123; </span><br><span class="line">    <span class="comment">// this.$route.meta.isRefreshåœ¨è·¯ç”±é‡Œé¢æˆ‘å¹¶æ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤æ˜¯undefinedï¼Œå½“ä»–ä¸ºfalseçš„æ—¶å€™ï¼Œè¯´æ˜ä»–ä»åˆ«çš„é¡µé¢è¿›æ¥äº†ï¼Œè¿™ä¸ªæ—¶å€™è®©ä»–è¯·æ±‚ä¸‹æ•°æ®</span></span><br><span class="line">    <span class="keyword">this</span>.queryList()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">beforeRouteEnter(to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line"> <span class="comment">// è¿™ä¸ªè·¯ç”±å®ˆå«å‡½æ•°å¼æœ€å…ˆæ‰§è¡Œçš„</span></span><br><span class="line"> to.meta.isRefresh = <span class="keyword">from</span>.name &amp;&amp; <span class="keyword">from</span>.name !== <span class="string">'table-detail'</span>;</span><br><span class="line">  next()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// ä¸‹é¢ä»£ç æ³¨é‡Šå³å¯</span></span><br><span class="line"><span class="comment">// beforeRouteLeave(to, from, next) &#123;</span></span><br><span class="line"><span class="comment">//   from.meta.isRefresh = to.name !== 'table-detail';</span></span><br><span class="line"><span class="comment">//   next()</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><p>æœ€åå¯ä»¥æŠŠè¿™äº›ä»£ç æŠ½ç¦»æˆä¸€ä¸ª<code>mixins</code>,ç„¶åç¼–å†™ä¸€ä¸ªåˆ·æ–°çš„ç»„ä»¶ï¼Œå“ªé‡Œç”¨åœ¨å“ªé‡Œè°ƒå–ä¸‹,<a href="/2020/06/15/workspace/Frame/vue/reload/">ä¹Ÿå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« </a>ã€‚</p><h3 id="å®ç°æ–¹å¼ä¸‰"><a href="#å®ç°æ–¹å¼ä¸‰" class="headerlink" title="å®ç°æ–¹å¼ä¸‰"></a>å®ç°æ–¹å¼ä¸‰</h3><p>è¿™ç§ç”¨ <code>keep-alive</code> æä¾›çš„ <code>include</code> å’Œ <code>exclude</code>,ç„¶åé…åˆvuexå®ç°åŠ¨æ€æ§åˆ¶ã€‚</p><p><strong>è·¯ç”±å…¥å£é¡µé¢</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.vue</span></span><br><span class="line">&lt;keep-alive :include=<span class="string">'includes'</span> :exclude=<span class="string">''</span>:max=<span class="string">"3"</span>&gt;</span><br><span class="line">  &lt;router-view&gt;&lt;<span class="regexp">/router-view&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>keep-alive&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>include</code>ä»£è¡¨ç€è¦ç¼“å­˜çš„ï¼Œ<code>exclude</code>ä»£è¡¨ç€éç¼“å­˜çš„,<code>max</code>ä»£è¡¨æœ€å¤šç¼“å­˜çš„ä¸ªæ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–vuexçš„æ•°æ®</span></span><br><span class="line"><span class="keyword">import</span> &#123;mapGetters&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  computed: &#123;<span class="comment">// åœ¨computedä¸­åŠ¨æ€ç›‘æ§</span></span><br><span class="line">     ...mapGetters([<span class="string">'includes'</span>]),</span><br><span class="line">   &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">     changeStore() &#123;</span><br><span class="line">       <span class="comment">// æ”¹å˜vueçš„æ•°æ®ï¼Œåœ¨è¿™ç”¨ä¸åˆ°</span></span><br><span class="line">       <span class="keyword">this</span>.$store.commit(<span class="string">'change'</span>, <span class="string">'tableLists'</span>)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Vuex</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> keepalive = &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    includes: [<span class="string">'tableLists'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    change(state, payload) &#123;</span><br><span class="line">      state.includes = payload</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    includes(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.includes</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> keepalive</span><br></pre></td></tr></table></figure><p><strong>åˆ—è¡¨é¡µçš„éƒ¨åˆ†ä»£ç </strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">activated() &#123;</span><br><span class="line">  <span class="comment">// åŒä¸Šï¼Œå¦‚æœç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œä¸æ‰§è¡Œä¸‹é¢çš„æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.hasFirst) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">this</span>.queryList()</span><br><span class="line">&#125;,</span><br><span class="line">beforeRouteEnter(to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  <span class="comment">// è¿™ä¸ªæ—¶å€™è¿˜æœ‰æ²¡this,æ‰€ä»¥è¿™é‡Œç”¨thisçš„è¯æ˜¯ä¸èƒ½æ“ä½œvuex,æˆ‘æ˜¯åœ¨main.jsé‡Œé¢èµ‹å€¼ç»™äº†window</span></span><br><span class="line">  <span class="built_in">window</span>._store.commit(<span class="string">'change'</span>, [<span class="string">'tableLists'</span>]);</span><br><span class="line">  next()</span><br><span class="line">  <span class="comment">// ä¹Ÿå¯ä»¥è¿™ä¹ˆç”¨</span></span><br><span class="line">  <span class="comment">// next((el) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//  el.$store.commit('change', ['tableLists']);</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">&#125;,</span><br><span class="line">beforeRouteLeave(to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  <span class="keyword">from</span>.meta.scrollTop = <span class="built_in">document</span>.documentElement.scrollTop; <span class="comment">// ä¸Šé¢scrollBehaviorå°±ä¸ç”¨æ·»åŠ keepAliveçš„åˆ¤æ–­äº†</span></span><br><span class="line">  <span class="keyword">if</span> (to.name !== <span class="string">'table-detail'</span>) &#123;<span class="comment">// å¦‚æœä¸æ˜¯è·³è½¬åˆ°è¯¦æƒ…é¡µé¢ï¼Œå°±ç©¿ä¸ªç©ºæ•°ç»„ï¼Œè¿™é‡Œä¸èƒ½ç”¨ '' é»˜è®¤æ˜¯æ‰€æœ‰çš„éƒ½ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">this</span>.$store.commit(<span class="string">'change'</span>, []);</span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯¦æƒ…é¡µçš„éƒ¨åˆ†ä»£ç </strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">beforeRouteLeave(to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.name !== <span class="string">'table-list'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.$store.commit(<span class="string">'change'</span>, []);</span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·¯ç”±é¡µé¢</strong></p><p>å› ä¸ºincludesæ²¡æœ‰åœ¨è·¯ç”±é‡Œé¢å®šä¹‰ keepalive,æ‰€ä»¥ä¸Šé¢çš„<code>scrollBehavior</code>è¿™ä¸ªæ–¹æ³•å½“ä½¿ç”¨åˆæˆäº‹ä»¶è·³è½¬çš„æ—¶å€™ï¼Œéœ€è¦åšé¢å¤–çš„å¤„ç†</p><p>```javascript<br>scrollBehavior(to, from, savedPosition) {<br>  if (savedPosition) {<br>    return new Promise((resolve) =&gt; {<br>      setTimeout(() =&gt; {<br>        resolve(savedPosition)<br>      }, 20)<br>    })<br>  } else {<br>    const ary = [â€˜Investâ€™, â€˜Storeâ€™];  // è¿™é‡Œ  éœ€è¦ç¼“å­˜çš„é¡µé¢</p><pre><code>if (ary.includes(from.name)) {  from.meta.scrollTop = document.documentElement.scrollTop;}return {x: 0, y: to.meta.scrollTop || 0}</code></pre><p>  }<br>}<br>Â·Â·Â·</p><p>ä¸Šé¢çš„ä»£ç æ¯”è¾ƒçç¢ï¼Œéœ€è¦æ·»åŠ åˆ°æ¯ä¸€ä¸ªé¡µé¢ï¼Œæ‰€ä»¥åœ¨å®é™…é¡¹ç›®ä¸­å¤§å®¶å¯æ·»åŠ ä¸€ä¸ªkeepaliveçš„mixins,æ–¹ä¾¿å¤§å®¶ç®¡ç†ã€‚</p><p><strong>ä½¿ç”¨includeå’Œexcludeçš„æ³¨æ„ç‚¹ï¼š</strong></p><ol><li>æ¯ä¸ªç»„ä»¶å†…éƒ¨æ·»åŠ  {name:xx}</li><li>è‹¥å°†includeè®¾ç½®ç©º â€˜ â€˜ æ¯ä¸ªé¡µé¢éƒ½å°†ä¼šç¼“å­˜</li><li>excludeçš„ä¼˜å…ˆçº§é«˜äºinclude ä½¿ç”¨excludeå</li></ol><hr><blockquote><p>äººç”Ÿä¸­ç¬¬ä¸€æ¬¡å‘å¸ƒæ–‡ç« ï¼Œå¸Œæœ›å¤§ä½¬ä»¬å¤šå¤šæŒ‡æ•™ï¼Œ</p></blockquote><hr><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/components/keep-alive.js" target="_blank" rel="noopener">keep-alive</a></p><p><a href="https://github.com/vuejs/vue-router/issues/811" target="_blank" rel="noopener">vueRouterIssues</a></p><p><a href="https://github.com/vuejs/vue-router/blob/dev/src/util/scroll.js#L10:1" target="_blank" rel="noopener">scrollBehavior</a></p><p><a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB" target="_blank" rel="noopener">å¯¼èˆªå®ˆå«</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> é¡¹ç›®è¸©å‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vue3.oæºç åˆ†æ</title>
      <link href="/2020/03/17/workspace/Frame/vue/next/reactivity/"/>
      <url>/2020/03/17/workspace/Frame/vue/next/reactivity/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>vue3.oæºç åˆ†æ</strong></p><p>[[toc]]</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è°ƒç ”çš„é¢„è§ˆç‰ˆæœ¬ï¼Œå¾ˆå¤šapiè¿˜æ²¡å®Œå–„ï¼Œä½†å¤§è‡´æ¶æ„å·²ç»æˆå½¢, æš‚æ—¶è¿˜ä¸èƒ½ç”¨äºç”Ÿäº§ã€‚</p><p><strong>ä¼˜åŠ¿</strong></p><ul><li>å‡½æ•°å¼ç¼–ç¨‹ï¼Œå‡½æ•°å¯¹tså…¼å®¹æ€§å¥½ã€react-hooksã€‘</li><li>static tree hoisting åŠŸèƒ½ ï¼ˆæ£€æµ‹é™æ€è¯­æ³•ï¼Œè¿›è¡Œæå‡ï¼‰  ã€diffã€‘</li><li>åŸºäº Proxy å®ç°çš„æ•°æ®å˜æ›´æ£€æµ‹  ã€ä¸éœ€è¦é€’å½’äº†ï¼ŒèŠ‚çœå†…å­˜ã€‘</li><li>æ”¯æŒ Fragments  ã€ react ç©ºæ ‡ç­¾ï¼Œå½“æ ¹å…ƒç´ ç”¨ã€‘</li><li>æ”¯æŒ Portals  ã€react å…è®¸åœ¨DOMçš„å…¶å®ƒä½ç½®è¿›è¡Œæ¸²æŸ“ã€‘</li><li>åŒæ—¶æ”¯æŒ Composition API å’Œ Options API  ã€å•æ–‡ä»¶å…¼å®¹vue2.oã€‘</li><li>Custom Renderer API  ã€è‡ªå®šä¹‰æ¸²æŸ“å™¨APIã€‘</li></ul><h2 id="æºç ç›®å½•"><a href="#æºç ç›®å½•" class="headerlink" title="æºç ç›®å½•"></a>æºç ç›®å½•</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â”œâ”€â”€ packages</span><br><span class="line">â”‚   â”œâ”€â”€ compiler-core # æ‰€æœ‰å¹³å°çš„ç¼–è¯‘å™¨(weexä¹Ÿæ˜¯åŸºäºè¿™ä¸ª)</span><br><span class="line">â”‚   â”œâ”€â”€ compiler-dom # é’ˆå¯¹æµè§ˆå™¨çš„ç¼–è¯‘å™¨</span><br><span class="line">â”‚   â”œâ”€â”€ compiler-ssr # ssr</span><br><span class="line">â”‚   â”œâ”€â”€ compiler-sfc # é’ˆå¯¹å•æ–‡ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ reactivity # æ•°æ®å“åº”å¼ç³»ç»Ÿ</span><br><span class="line">â”‚   â”œâ”€â”€ runtime-core # æ¸²æŸ“å™¨ï¼Œä¸€äº›æ ¸å¿ƒçš„api</span><br><span class="line">â”‚   â”œâ”€â”€ runtime-dom # é’ˆå¯¹æµè§ˆå™¨çš„runtime,åŒ…æ‹¬å¤„ç†åŸç”ŸDOM </span><br><span class="line">â”‚   â”œâ”€â”€ runtime-test # ä¸“é—¨ä¸ºæµ‹è¯•å†™çš„runtime</span><br><span class="line">â”‚   â”œâ”€â”€ server-renderer # ç”¨äºSSR</span><br><span class="line">â”‚   â”œâ”€â”€ shared # å¸®åŠ©æ–¹æ³•</span><br><span class="line">â”‚   â”œâ”€â”€ template-explorer</span><br><span class="line">â”‚   â””â”€â”€ vue # æ„å»ºvue</span><br></pre></td></tr></table></figure><h2 id="composition-api"><a href="#composition-api" class="headerlink" title="composition-api"></a>composition-api</h2><p>Composition APIçº¯ç²¹æ˜¯æ·»åŠ çš„ï¼Œä¸ä¼šå½±å“/å¼ƒç”¨ä»»ä½•ç°æœ‰çš„2.x APIï¼Œå®ƒæ˜¯å¯ä»¥å•ç‹¬å¯¼å…¥åˆ°é¡¹ç›®ä¸­çš„</p><p><strong>åŠ¨æœº</strong></p><ul><li>Vue 3 ä½¿ç”¨tså®ç°äº†ç±»å‹æ¨æ–­ï¼Œæ–°ç‰ˆapiå…¨éƒ¨é‡‡ç”¨æ™®é€šå‡½æ•°ï¼Œåœ¨ç¼–å†™ä»£ç æ—¶å¯ä»¥äº«å—å®Œæ•´çš„ç±»å‹æ¨æ–­ï¼ˆé¿å…ä½¿ç”¨è£…é¥°å™¨ï¼‰</li><li>è§£å†³äº†å¤šç»„ä»¶é—´<strong>é€»è¾‘é‡ç”¨</strong>é—®é¢˜ ï¼ˆè§£å†³ï¼šé«˜é˜¶ç»„ä»¶ã€mixinã€ä½œç”¨åŸŸæ’æ§½ï¼‰<ul><li>å¦‚æœé¡¹ç›®è¿‡äºå¤æ‚çš„æ—¶å€™ï¼Œmixinä¸­çš„ä»£ç å’Œå¤–éƒ¨ç»„ä»¶çš„ä»£ç å­˜åœ¨å‘½åå†²çªçš„æ—¶å€™ä¼šè¢«è¦†ç›–ï¼Œè€Œä¸”å¦‚æœæœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¹Ÿä¼šè¢«è¦†ç›–ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œå®¹æ˜“å‡ºç°bug</li><li>ä»£ç åˆ†æ•£</li></ul></li></ul><blockquote><p>// å®‰è£…<br/><br>yarn add @vue/composition-api<br/><br>// ä½¿ç”¨<br/><br>import Vue from â€˜vueâ€™;<br/><br>import VueCompositionApi from â€˜@vue/composition-apiâ€™;<br/><br>Vue.use(VueCompositionApi);<br/></p></blockquote><h3 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h3><h4 id="Object-defineProperty"><a href="#Object-defineProperty" class="headerlink" title="Object.defineProperty()"></a>Object.defineProperty()</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> oldProtoMehtods = <span class="built_in">Array</span>.prototype;</span><br><span class="line"><span class="keyword">let</span> proto = <span class="built_in">Object</span>.create(oldProtoMehtods);</span><br><span class="line"><span class="comment">// é’ˆå¯¹æ•°ç»„</span></span><br><span class="line">[<span class="string">'push'</span>, <span class="string">'pop'</span>, <span class="string">'shift'</span>, <span class="string">'unshift'</span>, <span class="string">'sort'</span>, <span class="string">'reverse'</span>, <span class="string">'splice'</span>].forEach(<span class="function"><span class="params">method</span> =&gt;</span> &#123;</span><br><span class="line">    proto[method] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// å‡½æ•°åŠ«æŒï¼ŒæŠŠå†…éƒ¨çš„å‡½æ•°é‡å†™ï¼Œæ•°ç»„æ–¹æ³•è¿˜æ˜¯ç»§ç»­è°ƒç”¨è€çš„æ–¹æ³•</span></span><br><span class="line">        updateView();</span><br><span class="line">        observer(...arguments);</span><br><span class="line">        oldProtoMehtods[method].call(<span class="keyword">this</span>, ...arguments)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observer</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isObject(target)) <span class="keyword">return</span> target;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(target)) &#123;</span><br><span class="line">        target.__proto__ = proto;  <span class="comment">// åŒä¸Š</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»™æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹è¿›è¡Œobserver</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; target.length; i++) &#123;</span><br><span class="line">            observer(target[i])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> target) &#123;</span><br><span class="line">        defineReactive(target, key, target[key])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span>(<span class="params">target, key, value</span>) </span>&#123;</span><br><span class="line">    observer(value); <span class="comment">// æœ‰å¯èƒ½å¯¹è±¡ç±»å‹æ˜¯å¤šå±‚ï¼Œé€’å½’åŠ«æŒ</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(target, key, &#123;</span><br><span class="line">        <span class="keyword">get</span>() &#123;</span><br><span class="line">            <span class="comment">// åœ¨get æ–¹æ³•ä¸­æ”¶é›†ä¾èµ–</span></span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span>(newVal) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'setæ–¹æ³•'</span>, newVal);</span><br><span class="line">            <span class="keyword">if</span> (newVal !== value) &#123;</span><br><span class="line">                updateView(); <span class="comment">// åœ¨setæ–¹æ³•ä¸­è§¦å‘æ›´æ–°</span></span><br><span class="line">                observer(newVal); <span class="comment">// é˜²æ­¢ä¼ è¿›æ¥æ˜¯ä¸€ä¸ªäºŒçº§å¯¹è±¡ï¼Œä¸èƒ½å¯¹ä»¥åçš„æ•°æ®ç›‘æµ‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = &#123;<span class="attr">ary</span>: [<span class="number">1</span>, <span class="number">2</span>, &#123;<span class="attr">age</span>: <span class="number">22</span>&#125;]&#125;;</span><br><span class="line"><span class="keyword">let</span> result = observer(data);</span><br><span class="line"></span><br><span class="line">data.ary.push(&#123;<span class="attr">age</span>: <span class="number">33</span>&#125;);</span><br><span class="line">data.ary.push([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">data.ary[<span class="number">4</span>].push(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">data.ary[<span class="number">4</span>].splice(<span class="number">1</span>, <span class="number">1</span>, <span class="number">22222</span>);</span><br><span class="line"><span class="comment">// data.ary[4][1] = 2222;  ä¸ä¼šè§¦å‘æ›´æ–°ï¼Œå€¼ä¼šæ”¹å˜</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(data.ary);</span><br></pre></td></tr></table></figure><p><strong>ç¼ºç‚¹</strong></p><ul><li>æ— æ³•ç›‘å¬æ•°ç»„çš„å˜åŒ–</li><li>éœ€è¦é€’å½’æ·±åº¦éå†ï¼Œæµªè´¹å†…å­˜</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ— æ³•å“åº”å¼</span></span><br><span class="line">vm.items[indexOfItem] = newValue</span><br><span class="line">vm.items.length = newLength</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³åŠæ³•</span></span><br><span class="line">vm.$<span class="keyword">set</span>(vm.items, indexOfItem, newValue)</span><br><span class="line">vm.items.splice(indexOfItem, 1, newValue)</span><br><span class="line"></span><br><span class="line">vm.items.splice(newLength)</span><br></pre></td></tr></table></figure><h4 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h3><h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p>ä¸‹é¢æ˜¯è‡ªå·±æç‚¼çš„çš„æ ¸å¿ƒä»£ç ï¼Œ<a href="/workspace/Frame/vue/next/ref">æºç åˆ†æçœ‹è¿™</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ref</span></span><br><span class="line"><span class="keyword">const</span> convert = <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> isObject(val) ? reactive(val) : val</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ref</span>(<span class="params">rawValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> value = convert(rawValue);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = &#123;</span><br><span class="line">    __v_isRef: <span class="literal">true</span>,</span><br><span class="line">    <span class="keyword">get</span> value() &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span> value(newVal) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'è§†å›¾æ›´æ–°'</span>);</span><br><span class="line">      value = convert(newVal);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------</span></span><br><span class="line"><span class="comment">// toRefs</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toRefs</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ret = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> object) &#123;</span><br><span class="line">    ret[key] = toRef(object, key)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toRef</span>(<span class="params">object, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    __v_isRef: <span class="literal">true</span>,</span><br><span class="line">    <span class="keyword">get</span> value() &#123;</span><br><span class="line">      <span class="keyword">return</span> object[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span> value(newVal) &#123;</span><br><span class="line">      object[key] = newVal</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h3><h2 id="Betaå‡çº§ä½¿ç”¨"><a href="#Betaå‡çº§ä½¿ç”¨" class="headerlink" title="Betaå‡çº§ä½¿ç”¨"></a>Betaå‡çº§ä½¿ç”¨</h2><p><code>å†™demoå¯ä»¥ï¼Œå…¬å¸æ­£å¼é¡¹ç›®ä¸å»ºè®®ï¼ŒåæœŸå°‘ä¸äº†å°æ”¹åŠ¨</code></p><h2 id="å®‰è£…3-oæ–°ç‰ˆæœ¬"><a href="#å®‰è£…3-oæ–°ç‰ˆæœ¬" class="headerlink" title="å®‰è£…3.oæ–°ç‰ˆæœ¬"></a>å®‰è£…3.oæ–°ç‰ˆæœ¬</h2><blockquote><p>yarn add vue@next  vue-router@next vuex@next<br>yarn add @vue/compiler-sfc@next eslint-plugin-vue@next vue-cli-plugin-vue-next -D</p></blockquote><h2 id="é€»è¾‘å¤ç”¨"><a href="#é€»è¾‘å¤ç”¨" class="headerlink" title="é€»è¾‘å¤ç”¨"></a>é€»è¾‘å¤ç”¨</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useMousePosition</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> x = ref(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> y = ref(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    x.value = e.pageX</span><br><span class="line">    y.value = e.pageY</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onMounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'mousemove'</span>, update)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  onUnmounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.removeEventListener(<span class="string">'mousemove'</span>, update)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; x, y &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="keyword">import</span> &#123; useMousePosition &#125; <span class="keyword">from</span> <span class="string">'./mouse'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; ...useMousePosition() &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a href="https://github.com/vuejs/vue-next" target="_blank" rel="noopener">vue-next</a><br><a href="https://github.com/vuejs/vue-cli-plugin-vue-next" target="_blank" rel="noopener">vue-cli-plugin-vue-nex</a><br><a href="https://vue-composition-api-rfc.netlify.app/#summary" target="_blank" rel="noopener">vue-composition-apiæ–‡æ¡£</a><br><a href="https://vue-next-template-explorer.netlify.app/" target="_blank" rel="noopener">vue3çš„ç¼–è¯‘å·¥å…·</a><br><a href="https://juejin.im/post/5e9f6b3251882573a855cd52" target="_blank" rel="noopener">å°¤é›¨æºªåœ¨Vue3.0Betaç›´æ’­é‡ŒèŠåˆ°äº†è¿™äº›</a><br><a href="https://juejin.im/post/5eaead656fb9a0438d4060be" target="_blank" rel="noopener">juejin</a><br><a href="https://segmentfault.com/a/1190000020709962?utm_source=tag-newest" target="_blank" rel="noopener">segmentfault</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> æºç åˆ†æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¡¹ç›®ä½¿ç”¨æ€»ç»“</title>
      <link href="/2020/03/11/workspace/Frame/vue/use-project/"/>
      <url>/2020/03/11/workspace/Frame/vue/use-project/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vueåŸºæœ¬ç”¨æ³•</title>
      <link href="/2020/03/11/workspace/Frame/vue/vue/"/>
      <url>/2020/03/11/workspace/Frame/vue/vue/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>vueåŸºæœ¬ç”¨æ³•</strong></p><p>[[toc]]</p><h3 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h3><table><thead><tr><th align="left"><span style='display: block;text-align: left;'> å¸¸ç”¨æŒ‡ä»¤    </span></th><th align="left"><span style='display: block;text-align: left;'> æè¿°</span></th></tr></thead><tbody><tr><td align="left"><strong>v-model</strong></td><td align="left">åŒå‘æ•°æ®ç»‘å®š æŠŠè¡¨å•å…ƒç´ çš„valueå’Œdataä¸­çš„å±æ€§ç»‘å®šåˆ°ä¸€èµ·ï¼Œè¡¨å•çš„valueå‘ç”Ÿå˜åŒ–ï¼Œdataçš„å±æ€§ä¹Ÿä¼šè·Ÿç€å˜åŒ–</td></tr><tr><td align="left"><strong>v-text</strong></td><td align="left">æŠŠdataï¼ˆä¸åªæ˜¯dataï¼‰ä¸­çš„å±æ€§å€¼ç»‘å®šåˆ°DOMå…ƒç´ ä¸­ï¼Œä¼šè¦†ç›–å…ƒç´ ä¸­åŸæœ‰çš„å†…å®¹ï¼›å¹¶ä¸”ä¸èƒ½è¯†åˆ«å­—ç¬¦ä¸²ä¸­çš„htmlæ ‡ç­¾</td></tr><tr><td align="left"><strong>v-html</strong></td><td align="left">æŠŠdataï¼ˆä¸åªæ˜¯dataï¼‰ä¸­çš„å±æ€§å€¼ç»‘å®šåˆ°DOMå…ƒç´ ä¸­ï¼›å¹¶ä¸”å¯ä»¥è¯†åˆ«å­—ç¬¦ä¸²ä¸­çš„htmlæ ‡ç­¾</td></tr><tr><td align="left"><strong>v-if / v-else</strong></td><td align="left">å¦‚æœv-ifç»‘å®šçš„å€¼ä¸ºtrueï¼Œå°±æ˜¾ç¤ºå¯¹åº”çš„å…ƒç´ ï¼›å¦‚æœä¸ºfalseï¼Œæ˜¾ç¤ºv-elseå¯¹åº”çš„å…ƒç´ ï¼›æ³¨æ„ï¼šv-elseä¸æ˜¯å¿…é€‰é¡¹ï¼Œä½†å¿…é¡»ç»“åˆv-ifä½¿ç”¨ï¼Œè€Œv-ifå¯ä»¥å•ç‹¬ä½¿ç”¨</td></tr><tr><td align="left"><strong>v-show</strong></td><td align="left">å¦‚æœå€¼ä¸ºtrueï¼Œå¯¹åº”çš„å…ƒç´ å°±ä¼šå±•ç¤ºï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™éšè—ï¼›</td></tr><tr><td align="left"><strong>v-bind</strong></td><td align="left">ç»‘å®šåŠ¨æ€å±æ€§ï¼ŒåŠ¨æ€ç»‘å®šåå°±å¯ä»¥ä½¿ç”¨dataä¸­çš„è¯¥å±æ€§çš„å€¼ï¼›v-bindå¯ä»¥ç®€å†™ä¸º <strong>:</strong></td></tr><tr><td align="left"><strong>v-for</strong></td><td align="left">åˆ—è¡¨æ¸²æŸ“</td></tr><tr><td align="left"><strong>v-on</strong></td><td align="left">äº‹ä»¶ç»‘å®šï¼Œå¯ç®€å†™ä¸º@</td></tr><tr><td align="left"><strong>is</strong></td><td align="left">é…åˆ<code>&lt;component&gt;</code>å¯åŠ¨æ€æ§åˆ¶å±•ç¤ºé‚£ä¸ªç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ‘†è„±htmlæ¨¡æ¿çš„é™åˆ¶</td></tr></tbody></table><p><strong><code>v-for()</code></strong></p><p>ä¸reactçš„ä¸åŒçš„æ˜¯ï¼Œreactçš„map()åªèƒ½å¾ªç¯å¯¹è±¡ï¼Œvueçš„v-forå°±å‰å®³äº†å¯ä»¥éå†æ•°ç»„ã€å¯¹è±¡ã€æ•°ç»„ã€å­—ç¬¦ä¸²</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;li v-<span class="keyword">for</span>=<span class="string">"(item, key) of items"</span> :key=<span class="string">"key"</span>&gt;</span><br><span class="line">&lt;li v-<span class="keyword">for</span>=<span class="string">"(item, key) in items"</span> :key=<span class="string">"key"</span>&gt;</span><br><span class="line">&lt;li v-<span class="keyword">for</span>=<span class="string">"count in 10"</span> :key=<span class="string">"count"</span>&gt;&#123;&#123;count&#125;&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ å¯ä½¿ç”¨in å’Œ of ä½œä¸ºåˆ†éš”ç¬¦,ä¸reactçš„mapä¸åŒçš„æ˜¯ï¼ŒVueçš„v-foréƒ½å¯ä»¥ç”¨ä½œå¯¹è±¡,æ•°ç»„ï¼Œæ•°å­—ï¼Œ</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ å­—ç¬¦ä¸²ç­‰ç­‰çš„éå†ï¼Œé»˜è®¤å†jsä¸­ï¼Œå¯¹è±¡ä¸èƒ½ç”¨for of éå†ï¼Œä½†æ˜¯vueçš„åˆæˆæ–¹æ³•ä¸­æ˜¯å…è®¸çš„ã€Object.keys()ã€‘ã€‚</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="left"><span style='display: block;text-align: left;'> äº‹ä»¶ä¿®é¥°ç¬¦    </span></th><th align="left"><span style='display: block;text-align: left;'> æè¿°</span></th></tr></thead><tbody><tr><td align="left"><strong>.prevent</strong></td><td align="left">é˜»æ­¢å…ƒç´ çš„é»˜è®¤è¡Œä¸º</td></tr><tr><td align="left"><strong>.stop</strong></td><td align="left">é˜»æ­¢äº‹ä»¶å†’æ³¡</td></tr><tr><td align="left"><strong>.capture</strong></td><td align="left">äº‹ä»¶åœ¨æ•è·é˜¶æ®µè§¦å‘</td></tr><tr><td align="left"><strong>.once</strong></td><td align="left">äº‹ä»¶åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œå®Œåä¼šè¢«ç§»é™¤</td></tr><tr><td align="left"><strong>.self</strong></td><td align="left">è‡ªèº«çš„äº‹ä»¶è§¦å‘æ—¶æ‰æ‰§è¡Œäº‹ä»¶å‡½æ•°</td></tr><tr><td align="left"><strong>.passive</strong></td><td align="left">äº‹ä»¶å®Œæˆæ‰ä¼šè§¦å‘  ä¾‹å¦‚ï¼š@scroll.passive=â€onScrollâ€</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- ä¿®é¥°ç¬¦å¯ä»¥ä¸²è” --&gt;</span><br><span class="line">&lt;a v-on:click.stop.prevent=<span class="string">"doThat"</span>&gt;&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ä½¿ç”¨ä¿®é¥°ç¬¦æ—¶ï¼Œé¡ºåºå¾ˆé‡è¦ï¼›ç›¸åº”çš„ä»£ç ä¼šä»¥åŒæ ·çš„é¡ºåºäº§ç”Ÿã€‚</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ å› æ­¤ï¼Œç”¨ v-on:click.prevent.self ä¼šé˜»æ­¢æ‰€æœ‰çš„ç‚¹å‡»ï¼Œè€Œ v-on:click.self.prevent åªä¼šé˜»æ­¢å¯¹å…ƒç´ è‡ªèº«çš„ç‚¹å‡»ã€‚</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="left"><span style='display: block;text-align: left;'> é”®ç›˜äº‹ä»¶    </span></th><th align="left"><span style='display: block;text-align: left;'> æè¿°</span></th></tr></thead><tbody><tr><td align="left">@keydown/@keyup</td><td align="left">ä¿®é¥°ç¬¦ï¼šæŒ‡å®šæŒ‰ä¸‹å“ªä¸ªæŒ‰é”®æ—¶/æ¾å¼€æ—¶æ‰è§¦å‘äº‹ä»¶å‡½æ•°</td></tr><tr><td align="left"><strong>.enter</strong></td><td align="left">å›è½¦</td></tr><tr><td align="left"><strong>.esc</strong></td><td align="left">escé”®</td></tr><tr><td align="left"><strong>.delete</strong></td><td align="left">åˆ é™¤/é€€æ ¼</td></tr><tr><td align="left"><strong>.space</strong></td><td align="left">ç©ºæ ¼</td></tr><tr><td align="left"><strong>.tab</strong></td><td align="left">tabé”®</td></tr><tr><td align="left"><strong>.up</strong></td><td align="left">ä¸Š</td></tr><tr><td align="left"><strong>.right</strong></td><td align="left">å³</td></tr><tr><td align="left"><strong>.down</strong></td><td align="left">ä¸‹</td></tr><tr><td align="left"><strong>.left</strong></td><td align="left">å·¦</td></tr></tbody></table><h3 id="classä¸styleå¦‚ä½•åŠ¨æ€ç»‘å®š"><a href="#classä¸styleå¦‚ä½•åŠ¨æ€ç»‘å®š" class="headerlink" title="classä¸styleå¦‚ä½•åŠ¨æ€ç»‘å®š"></a>classä¸styleå¦‚ä½•åŠ¨æ€ç»‘å®š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;box&quot;&gt;</span><br><span class="line">    &lt;p :class&#x3D;&quot;&#123; active: isActive, &#39;text-danger&#39;: hasError &#125;&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;p v-bind:class&#x3D;&quot;[isActive ? activeClass : &#39;&#39;, errorClass]&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;!--ç›´æ¥æ·»åŠ æ ·å¼--&gt;</span><br><span class="line">    &lt;p style&#x3D;&quot;background-color: blue;&quot;&gt;sssss&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;!--ç»‘å®šæ ·å¼--&gt;</span><br><span class="line">    &lt;p v-bind:style&#x3D;&quot;&#39;background-color: red;&#39;&quot;&gt;sssss&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;!--å°†vueä¸­çš„å±æ€§ä½œä¸ºæ ·å¼è®¾ç½®--&gt;</span><br><span class="line">    &lt;p :style&#x3D;&quot;obj&quot;&gt;sssss&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;!--å°†å¤šä¸ªå±æ€§ä½œä¸ºæ ·å¼è®¾ç½®--&gt;</span><br><span class="line">    &lt;p :style&#x3D;&quot;[obj,obj1]&quot;&gt;sssss&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;!--style ç»‘å®šä¸­çš„å±æ€§æä¾›ä¸€ä¸ªåŒ…å«å¤šä¸ªå€¼çš„æ•°ç»„ï¼Œå¸¸ç”¨äºæä¾›å¤šä¸ªå¸¦å‰ç¼€çš„å€¼ --&gt;</span><br><span class="line">    &lt;div :style&#x3D;&quot;&#123; display: [&#39;-webkit-box&#39;, &#39;-ms-flexbox&#39;, &#39;flex&#39;] &#125;&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    var vm&#x3D;new Vue(&#123;</span><br><span class="line">        el:&quot;#box&quot;,</span><br><span class="line">        data:&#123;</span><br><span class="line">            isActive: true,</span><br><span class="line">            hasError: false,</span><br><span class="line">            errorClass: &#39;text-danger&#39;,</span><br><span class="line">            obj:&#123;</span><br><span class="line">                backgroundColor:&quot;gold&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            obj1:&#123;</span><br><span class="line">                fontSize: &quot;30px&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h3 id="vueä¸­ä¸€äº›å°æŠ€å·§"><a href="#vueä¸­ä¸€äº›å°æŠ€å·§" class="headerlink" title="vueä¸­ä¸€äº›å°æŠ€å·§"></a>vueä¸­ä¸€äº›å°æŠ€å·§</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¿é—®çˆ¶çº§ç»„ä»¶å®ä¾‹,å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œè®¿é—®åˆ°çˆ¶ç»„ä»¶å®šä¹‰çš„å±æ€§ï¼Œä¹Ÿå¯ç›´æ¥ä¿®æ”¹ï¼Œï¼ˆä¸å»ºè®®ä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="keyword">this</span>.$parent</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æ¥è·å–å®šä¹‰åœ¨dataå¤–çš„æ•°æ®å’Œæ–¹æ³•çš„ã€‚</span></span><br><span class="line"><span class="keyword">this</span>.$options</span><br></pre></td></tr></table></figure><h3 id="propsç±»å‹"><a href="#propsç±»å‹" class="headerlink" title="propsç±»å‹"></a>propsç±»å‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> props: &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">        type: [String, Number],</span><br><span class="line">        default: &#39;æ ‡é¢˜&#39;,</span><br><span class="line">        required: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; è‡ªå®šä¹‰éªŒè¯å‡½æ•°</span><br><span class="line">    propF: &#123;</span><br><span class="line">      validator: function (value) &#123;</span><br><span class="line">        return [&#39;success&#39;, &#39;warning&#39;, &#39;danger&#39;].indexOf(value) !&#x3D;&#x3D; -1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">props: &#123;</span><br><span class="line">  title: String,</span><br><span class="line">  likes: Number,</span><br><span class="line">  isPublished: Boolean,</span><br><span class="line">  commentIds: Array,</span><br><span class="line">  author: Object,</span><br><span class="line">  callback: Function,</span><br><span class="line">  contactsPromise: Promise,</span><br><span class="line">  time:Date</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶components"><a href="#ç»„ä»¶components" class="headerlink" title="ç»„ä»¶components"></a>ç»„ä»¶components</h3><h4 id="å±€éƒ¨ç»„ä»¶"><a href="#å±€éƒ¨ç»„ä»¶" class="headerlink" title="å±€éƒ¨ç»„ä»¶"></a>å±€éƒ¨ç»„ä»¶</h4><p>åœ¨ç›´æ¥importå¯¼å…¥åœ¨componentsé‡Œé¢æ³¨å†Œä¸‹å°±èƒ½ç”¨äº†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">import</span> compB <span class="keyword">from</span> <span class="string">'./components/CompB'</span></span><br><span class="line">    <span class="keyword">import</span> compA <span class="keyword">from</span> <span class="string">'./components/CompA'</span></span><br><span class="line">    <span class="keyword">import</span> CompC <span class="keyword">from</span> <span class="string">'./components/CompC'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        components: &#123;</span><br><span class="line">            compA,</span><br><span class="line">            compB,</span><br><span class="line">            CompC,</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="å…¨å±€ç»„ä»¶"><a href="#å…¨å±€ç»„ä»¶" class="headerlink" title="å…¨å±€ç»„ä»¶"></a>å…¨å±€ç»„ä»¶</h4><p>åœ¨main.jsé‡Œé¢æ³¨å†Œä¸‹ï¼Œå°±å¯ä»¥å…¨å±€ç›´æ¥ç”¨äº†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> CompA <span class="keyword">from</span> <span class="string">"./components/CompA"</span></span><br><span class="line">Vue.component(<span class="string">"com-a"</span>, CompA);</span><br></pre></td></tr></table></figure><h3 id="è¿‡æ»¤å™¨filter"><a href="#è¿‡æ»¤å™¨filter" class="headerlink" title="è¿‡æ»¤å™¨filter"></a>è¿‡æ»¤å™¨filter</h3><h4 id="å±€éƒ¨è¿‡æ»¤å™¨"><a href="#å±€éƒ¨è¿‡æ»¤å™¨" class="headerlink" title="å±€éƒ¨è¿‡æ»¤å™¨"></a>å±€éƒ¨è¿‡æ»¤å™¨</h4><p>å†™åœ¨Vueå®ä¾‹ä¸­çš„<code>filters</code>å†…çš„è¿‡æ»¤å™¨æ˜¯å±€éƒ¨è¿‡æ»¤å™¨ï¼›åªèƒ½åœ¨å½“å‰ç»„ä»¶å¯ä»¥ä½¿ç”¨</p><ul><li>è¿‡æ»¤å™¨å¯ä»¥è¿ç»­ä½¿ç”¨ï¼Œåé¢çš„è¿‡æ»¤å™¨çš„å‚æ•°ï¼Œæ˜¯ä¸Šä¸€ä¸ªè¿‡æ»¤å™¨çš„å¤„ç†ç»“æœï¼Œæ•°æ®ä¼šå±•ç¤ºæˆæœ€åä¸€ä¸ªè¿‡æ»¤å™¨çš„ç»“æœ</li><li>è¿‡æ»¤å™¨å¯ä»¥ä¼ å‚ï¼Œå‚æ•°æ˜¯ä¼ ç»™ç¬¬äºŒä¸ªå½¢å‚çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç®¡é“ç¬¦å‰é¢çš„å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;&#123;item.price | toRMB | toFixed(<span class="number">3</span>)&#125;&#125;</span><br><span class="line"></span><br><span class="line">data: &#123;</span><br><span class="line">    products: [</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'MAC'</span>,</span><br><span class="line">            price: <span class="number">2000</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name: <span class="string">'iphoneX'</span>,</span><br><span class="line">            price: <span class="number">1000</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br><span class="line">filters: &#123; <span class="comment">// å†™åœ¨filtersé‡Œé¢çš„è¿‡æ»¤å™¨æ˜¯å±€éƒ¨è¿‡æ»¤å™¨</span></span><br><span class="line">    toRMB (val) &#123;</span><br><span class="line">        <span class="keyword">return</span> val * <span class="number">6.832423</span></span><br><span class="line">    &#125;,</span><br><span class="line">    toFixed (val, num = <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Â¥'</span> + val.toFixed(num)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…¨å±€è¿‡æ»¤å™¨"><a href="#å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="å…¨å±€è¿‡æ»¤å™¨"></a>å…¨å±€è¿‡æ»¤å™¨</h4><p><code>Vue.filter(è¿‡æ»¤å™¨å, callback)</code> è¿™ç§è¿‡æ»¤å™¨åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½ä½¿ç”¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line">Vue.filter(<span class="string">'toRMB'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">return</span> val * <span class="number">6.832423</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç»„ä»¶å†…éƒ¨ä½¿ç”¨</span></span><br><span class="line">&#123;&#123;item.price | toRMB&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰å…¨å±€æ–¹æ³•"><a href="#è‡ªå®šä¹‰å…¨å±€æ–¹æ³•" class="headerlink" title="è‡ªå®šä¹‰å…¨å±€æ–¹æ³•"></a>è‡ªå®šä¹‰å…¨å±€æ–¹æ³•</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mian.js</span></span><br><span class="line"><span class="comment">//  å…¨å±€çš„æ–¹æ³•</span></span><br><span class="line">Vue.prototype.$fetch = <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fetch(url).then(<span class="function"><span class="params">e</span> =&gt;</span> e.json()).then(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> directives = &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªåŠ¨ä¸‹æ»‘åˆ°åº•éƒ¨æŒ‡ä»¤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    autoscroll: &#123;</span><br><span class="line">        <span class="comment">// componentUpdated:VNode åŠå…¶å­ VNode å…¨éƒ¨æ›´æ–°åè°ƒç”¨</span></span><br><span class="line">        componentUpdated: <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> scrollHeight = el.scrollHeight</span><br><span class="line">            <span class="keyword">let</span> clientHeight = el.clientHeight</span><br><span class="line"></span><br><span class="line">            scrollHeight &gt; clientHeight &amp;&amp; (el.scrollTop = scrollHeight)</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">    focus: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        el.focus()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(directives).map(<span class="function"><span class="params">t</span> =&gt;</span> &#123;</span><br><span class="line">    Vue.directive(t, directives[t])</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å±€éƒ¨è‡ªå®šä¹‰çš„æŒ‡ä»¤</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;input ref=<span class="string">"input"</span> v-focus v-model=<span class="string">"val"</span> type=<span class="string">"text"</span>&gt;</span><br><span class="line">    &lt;strong v-demo=<span class="string">"&#123; color: 'red' &#125;"</span>&gt;<span class="number">111</span>é»˜è®¤çš„slot&lt;<span class="regexp">/strong&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">        directives: &#123;</span><br><span class="line">            <span class="comment">// å±€éƒ¨è‡ªå®šä¹‰æŒ‡ä»¤</span></span><br><span class="line">            focus: &#123;</span><br><span class="line">                inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">                    el.focus()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            demo: &#123;</span><br><span class="line">                inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">                  <span class="comment">// elå½“å‰çš„dom</span></span><br><span class="line">                  <span class="comment">//  binding æŒ‡ä»¤çš„ä¸€äº›ä¿¡æ¯ name: "demo"</span></span><br><span class="line">                  <span class="comment">//                       rawName: "v-demo"</span></span><br><span class="line">                  <span class="comment">//                       value: &#123;color: "red"&#125;</span></span><br><span class="line">                    <span class="built_in">console</span>.log(el.style.color = binding.value.color)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ å…¨å±€ç»„ä»¶</span></span><br><span class="line"><span class="regexp">Vue.component("counter", About);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ å…¨å±€mixin</span></span><br><span class="line"><span class="regexp">Vue.mixin(mixin);</span></span><br></pre></td></tr></table></figure><h4 id="VUEè‡ªå®šä¹‰æŒ‡ä»¤"><a href="#VUEè‡ªå®šä¹‰æŒ‡ä»¤" class="headerlink" title="VUEè‡ªå®šä¹‰æŒ‡ä»¤"></a>VUEè‡ªå®šä¹‰æŒ‡ä»¤</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Vue.directive(<span class="string">'focus'</span>,&#123;</span><br><span class="line">    bind() &#123;</span><br><span class="line">      <span class="comment">// å½“æŒ‡ä»¤ç»‘å®šåˆ° HTML å…ƒç´ ä¸Šæ—¶è§¦å‘.**åªè°ƒç”¨ä¸€æ¬¡**</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'bind triggerd'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    inserted() &#123;</span><br><span class="line">      <span class="comment">// å½“ç»‘å®šäº†æŒ‡ä»¤çš„è¿™ä¸ªHTMLå…ƒç´ æ’å…¥åˆ°çˆ¶å…ƒç´ ä¸Šæ—¶è§¦å‘(åœ¨è¿™é‡Œçˆ¶å…ƒç´ æ˜¯ `div#app`)**.ä½†ä¸ä¿è¯,çˆ¶å…ƒç´ å·²ç»æ’å…¥äº† DOM æ–‡æ¡£.**</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'inserted triggerd'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    updated() &#123;</span><br><span class="line">      <span class="comment">// æ‰€åœ¨ç»„ä»¶çš„`VNode`æ›´æ–°æ—¶è°ƒç”¨.</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'updated triggerd'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    componentUpdated() &#123;</span><br><span class="line">      <span class="comment">// æŒ‡ä»¤æ‰€åœ¨ç»„ä»¶çš„ VNode åŠå…¶å­ VNode å…¨éƒ¨æ›´æ–°åè°ƒç”¨ã€‚</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'componentUpdated triggerd'</span>)</span><br><span class="line">      </span><br><span class="line">    &#125;,</span><br><span class="line">    unbind() &#123;</span><br><span class="line">      <span class="comment">// åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨.</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'unbind triggerd'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>é’©å­å‡½æ•°å‚æ•°</strong></p><p>æŒ‡ä»¤é’©å­å‡½æ•°ä¼šè¢«ä¼ å…¥ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><p><code>el</code>ï¼šæŒ‡ä»¤æ‰€ç»‘å®šçš„å…ƒç´ ï¼Œå¯ä»¥ç”¨æ¥ç›´æ¥æ“ä½œ DOM ã€‚</p></li><li><p><code>binding</code> ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><code>name</code>ï¼šæŒ‡ä»¤åï¼Œä¸åŒ…æ‹¬ <code>v-</code> å‰ç¼€ã€‚</li><li><code>value</code>ï¼šæŒ‡ä»¤çš„ç»‘å®šå€¼ï¼Œä¾‹å¦‚ï¼š<code>v-my-directive=&quot;1 + 1&quot;</code> ä¸­ï¼Œç»‘å®šå€¼ä¸º <code>2</code>ã€‚</li><li><code>oldValue</code>ï¼šæŒ‡ä»¤ç»‘å®šçš„å‰ä¸€ä¸ªå€¼ï¼Œä»…åœ¨ <code>update</code> å’Œ <code>componentUpdated</code> é’©å­ä¸­å¯ç”¨ã€‚æ— è®ºå€¼æ˜¯å¦æ”¹å˜éƒ½å¯ç”¨ã€‚</li><li><code>expression</code>ï¼šå­—ç¬¦ä¸²å½¢å¼çš„æŒ‡ä»¤è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ <code>v-my-directive=&quot;1 + 1&quot;</code> ä¸­ï¼Œè¡¨è¾¾å¼ä¸º <code>&quot;1 + 1&quot;</code>ã€‚</li><li><code>arg</code>ï¼šä¼ ç»™æŒ‡ä»¤çš„å‚æ•°ï¼Œå¯é€‰ã€‚ä¾‹å¦‚ <code>v-my-directive:foo</code> ä¸­ï¼Œå‚æ•°ä¸º <code>&quot;foo&quot;</code>ã€‚</li><li><code>modifiers</code>ï¼šä¸€ä¸ªåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š<code>v-my-directive.foo.bar</code> ä¸­ï¼Œä¿®é¥°ç¬¦å¯¹è±¡ä¸º <code>{ foo: true, bar: true }</code>ã€‚</li></ul></li><li><p><code>vnode</code>ï¼šVue ç¼–è¯‘ç”Ÿæˆçš„è™šæ‹ŸèŠ‚ç‚¹ã€‚ç§»æ­¥ VNode API æ¥äº†è§£æ›´å¤šè¯¦æƒ…ã€‚</p></li><li><p><code>oldVnode</code>ï¼šä¸Šä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»…åœ¨ <code>update</code> å’Œ <code>componentUpdated</code> é’©å­ä¸­å¯ç”¨ã€‚</p></li></ul><h3 id="mixins"><a href="#mixins" class="headerlink" title="mixins"></a>mixins</h3><p>åœ¨å¼€å‘ä¸­æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œå½“ä½ æœ‰ä¸¤ä¸ªéå¸¸ç›¸ä¼¼çš„ç»„ä»¶ï¼Œå®ƒä»¬çš„åŠŸèƒ½æå…¶ç›¸ä¼¼ï¼Œä½†å®ƒä»¬å±€éƒ¨ç¨æœ‰ä¸åŒï¼Œç°åœ¨ä½ çš„åšæ³•æ˜¯å°†å®ƒä»¬åˆ†æˆä¸¤ä¸ªä¸åŒçš„ç»„ä»¶ï¼Ÿè¿˜æ˜¯åªä¿ç•™ä¸€ä¸ªç»„ä»¶ï¼Œå±€éƒ¨å·®å¼‚çš„éƒ¨åˆ†é‡‡ç”¨<code>props</code>æ§åˆ¶å‘¢ï¼Ÿ</p><p>å¦‚æœå°†å®ƒä»¬æ‹†åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„ç»„ä»¶ï¼Œè¿™æ—¶åŠŸèƒ½å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨ä¸¤ä¸ªåœ°æ–¹ä¿®æ”¹å®ƒä»¬ï¼Œå¦‚æœç”¨propsæ¥åŒºåˆ†å®ƒä»¬ï¼Œé‚£ä¹ˆåæœŸç»´æŠ¤èµ·æ¥å°†ä¼šå¾ˆå¤æ‚ï¼Œå¯èƒ½å‡æ…¢ä½ å¼€å‘çš„é€Ÿåº¦</p><p><code>Vue</code>ä¸­çš„<code>Mixins</code>åŸºæœ¬ä¸Šæ˜¯ä¸€å—å®šä¹‰çš„é€»è¾‘ï¼Œç”±Vueä»¥ç‰¹å®šçš„è§„å®šæ–¹å¼å­˜å‚¨ï¼Œå¯ä»¥åå¤ä½¿ç”¨ï¼Œä¸º<code>Vue</code>å®ä¾‹å’Œç»„ä»¶æ·»åŠ åŠŸèƒ½ã€‚å› æ­¤ï¼Œ<code>Vue mixins</code>å¯ä»¥åœ¨å¤šä¸ªVueç»„ä»¶ä¹‹é—´å…±äº«ï¼Œè€Œæ— éœ€é‡å¤ä»£ç å—ã€‚ä½¿ç”¨è¿‡SASSçš„CSSé¢„å¤„ç†å™¨çš„äººå¯¹mixinåº”è¯¥æœ‰å¾ˆå¥½çš„äº†è§£ã€‚</p><p>ç»„ä»¶å†…éƒ¨æœ‰è·Ÿmixinsé‡Œé¢ä¸€æ ·çš„æ–¹æ³•æ—¶ï¼Œç»„ä»¶å†…éƒ¨çš„ä¼˜å…ˆçº§é«˜ä¸mixins</p><h4 id="å±€éƒ¨mixins"><a href="#å±€éƒ¨mixins" class="headerlink" title="å±€éƒ¨mixins"></a>å±€éƒ¨mixins</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//assets/mixins/mixin.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> toggle = &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">"show"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    changeState() &#123;</span><br><span class="line">      <span class="keyword">this</span>.show = !<span class="keyword">this</span>.show;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">      <span class="comment">// é»˜è®¤æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œ</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'created'</span>, <span class="string">'mixins'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'mounted'</span>, <span class="string">'mixins'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">     &lt;h1 @click=<span class="string">"changeState"</span>&gt;mixins&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">     &lt;h2 v-if="show"&gt;toast&lt;/</span>h2&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123;toggle&#125; <span class="keyword">from</span> <span class="string">'./mixins/toggle'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  mixins: [toggle]</span><br><span class="line">  <span class="comment">// ... </span></span><br><span class="line">  <span class="comment">//è¿™é‡Œé¢å¯ä»¥æ­£å¸¸å†™ï¼Œä¼˜å…ˆçº§é«˜äºmixinçš„æ–¹æ³•ã€‚</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å…¨å±€mixins"><a href="#å…¨å±€mixins" class="headerlink" title="å…¨å±€mixins"></a>å…¨å±€mixins</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> mixin = &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        formatDate(dateTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> dateTime</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Vue.mixin(mixin);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»„ä»¶é‡Œé¢ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.formatDate(<span class="keyword">new</span> <span class="built_in">Date</span>()),<span class="string">'mixins'</span>);</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¯·è°¨æ…ä½¿ç”¨å…¨å±€æ··å…¥ï¼Œå› ä¸ºå®ƒä¼šå½±å“æ¯ä¸ªå•ç‹¬åˆ›å»ºçš„ Vue å®ä¾‹ (åŒ…æ‹¬ç¬¬ä¸‰æ–¹ç»„ä»¶)ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªåº”å½“åº”ç”¨äºè‡ªå®šä¹‰é€‰é¡¹</p><h3 id="vue-ç»„ä»¶é—´é€šä¿¡æœ‰å“ªå‡ ç§æ–¹å¼"><a href="#vue-ç»„ä»¶é—´é€šä¿¡æœ‰å“ªå‡ ç§æ–¹å¼" class="headerlink" title="vue ç»„ä»¶é—´é€šä¿¡æœ‰å“ªå‡ ç§æ–¹å¼"></a>vue ç»„ä»¶é—´é€šä¿¡æœ‰å“ªå‡ ç§æ–¹å¼</h3><h4 id="props-emit"><a href="#props-emit" class="headerlink" title="props/$emit"></a>props/$emit</h4><p>é€‚ç”¨ çˆ¶å­ç»„ä»¶é€šä¿¡</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; çˆ¶ç»„ä»¶</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">        &lt;div @click&#x3D;&quot;onMore(&#39;å€¼&#39;)&quot;&gt;</span><br><span class="line">            çˆ¶ç»„ä»¶</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;compB</span><br><span class="line">                :title.sync&#x3D;&quot;value&quot;</span><br><span class="line">                @more&#x3D;&quot;onMore&quot;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import compB from &#39;.&#x2F;components&#x2F;CompB&#39;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#39;App&#39;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            compB</span><br><span class="line">        &#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                value: &#39;&#39;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            onMore(val) &#123;</span><br><span class="line">                console.log(val);</span><br><span class="line">                &#x2F;&#x2F; this.value &#x3D; val</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å­ç»„ä»¶</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;title&quot;&gt;&#123;&#123;title&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div @click&#x3D;&quot;handleMore&quot;&gt;å­ç»„ä»¶ä¿®æ”¹çˆ¶ç»„ä»¶çš„å€¼&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;!--&lt;div @click&#x3D;&quot;$emit(&#39;update:title&#39;, &#39;false&#39;)&quot;&gt;å­ç»„ä»¶ä¿®æ”¹çˆ¶ç»„ä»¶çš„å€¼&lt;&#x2F;div&gt;--&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#39;Comb&#39;,</span><br><span class="line">        components: &#123;&#125;,</span><br><span class="line">        props: &#123;</span><br><span class="line">            title: &#123;</span><br><span class="line">                type: [String, Number],</span><br><span class="line">                default: &#39;æ ‡é¢˜&#39;</span><br><span class="line">            &#125;,</span><br><span class="line">            moreBtn: &#123;</span><br><span class="line">                type: Boolean,</span><br><span class="line">                default: false</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            handleMore() &#123;</span><br><span class="line">                this.$emit(&#39;update:title&#39;, &#39;syncæ–¹å¼ä¿®æ”¹&#39;);</span><br><span class="line">                this.$emit(&#39;more&#39;, 111);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h4 id="emit-on"><a href="#emit-on" class="headerlink" title="$emit/$on"></a>$emit/$on</h4><p>é€‚ç”¨äº çˆ¶å­ã€éš”ä»£ã€å…„å¼Ÿç»„ä»¶é€šä¿¡</p><h3 id="defineProperty-çš„ä¸è¶³"><a href="#defineProperty-çš„ä¸è¶³" class="headerlink" title="defineProperty çš„ä¸è¶³"></a>defineProperty çš„ä¸è¶³</h3><ul><li>å½“ä½ åˆ©ç”¨ç´¢å¼•ç›´æ¥è®¾ç½®ä¸€ä¸ªæ•°ç»„é¡¹æ—¶ï¼Œä¾‹å¦‚ï¼š<code>vm.items[indexOfItem] = newValue</code></li><li>å½“ä½ ä¿®æ”¹æ•°ç»„çš„é•¿åº¦æ—¶ï¼Œä¾‹å¦‚ï¼š<code>vm.items.length = newLength</code></li></ul><h4 id="è§£å†³çš„åŠæ³•"><a href="#è§£å†³çš„åŠæ³•" class="headerlink" title="è§£å†³çš„åŠæ³•"></a>è§£å†³çš„åŠæ³•</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue.set</span></span><br><span class="line">Vue.set(vm.items, indexOfItem, newValue)</span><br><span class="line"><span class="comment">// vm.$setï¼ŒVue.setçš„ä¸€ä¸ªåˆ«å,å½“å‰ç»„ä»¶çš„å®ä¾‹</span></span><br><span class="line">vm.$<span class="keyword">set</span>(vm.items, indexOfItem, newValue)</span><br><span class="line">// Array.prototype.splice</span><br><span class="line">vm.items.splice(indexOfItem, 1, newValue)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">vm.items.splice(newLength)</span><br></pre></td></tr></table></figure><h3 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick()"></a>nextTick()</h3><p>Vue çš„ç‰¹ç‚¹ä¹‹ä¸€å°±æ˜¯å“åº”å¼ï¼Œä½†æ•°æ®æ›´æ–°æ—¶ï¼ŒDOM å¹¶ä¸ä¼šç«‹å³æ›´æ–°ã€‚å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œéœ€è¦åœ¨ DOM æ›´æ–°ä¹‹åå†æ‰§è¡Œä¸€æ®µä»£ç æ—¶ï¼Œå¯ä»¥å€ŸåŠ©nextTickå®ç°ã€‚</p><p>Vueçš„DOMæ›´æ–°ä¸æ˜¯åŒæ­¥çš„ï¼Œè€Œæ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›è·å–æ›´æ–°æ•°æ®åæ¸²æŸ“å‡ºæ¥çš„DOMï¼Œ<br>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <strong>$nextTickï¼›this.$nextTick(callback),</strong> callbackä¼šåœ¨DOMæ›´æ–°ä»¥åæ‰§è¡Œï¼ˆå¦‚æœæƒ³è¦åœ¨DOMæ›´æ–°åæ“ä½œDOMï¼Œæˆ–è€…åœ¨DOMæ›´æ–°åæœ‰å…¶ä»–çš„äº‹æƒ…ï¼Œè¦ç”¨$nextTickï¼‰</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;li v-for&#x3D;&quot;(item, index) in ary&quot;</span><br><span class="line">    :key&#x3D;&quot;item.id&quot;</span><br><span class="line">    ref&#x3D;&quot;listItem&quot;&gt;&#123;&#123;item&#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#39;#app&#39;,</span><br><span class="line">    data: &#123;</span><br><span class="line">        ary: [1, 3, 5]</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">        console.log(this.$refs.listItem.length)</span><br><span class="line">        this.ary.push(7, 9)</span><br><span class="line">        &#x2F;&#x2F; console.log(this.$refs.listItem.length) &#x2F;&#x2F; ä¸ºä»€ä¹ˆè¿˜æ˜¯3ï¼Œè€Œä¸æ˜¯5å‘¢ï¼Ÿ</span><br><span class="line">        &#x2F;&#x2F; å› ä¸ºVueæ›´æ–°DOMçš„æœºåˆ¶æ˜¯å¼‚æ­¥çš„ï¼›push 7ï¼Œ9åå¹¶æ²¡æœ‰ç›´æ¥å°±å»æ›´æ–°DOMï¼Œè€Œæ˜¯å…ˆç­‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œï¼Œæ‰å»æ‰§è¡Œå¼‚æ­¥çš„æ›´æ–°DOM</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; å¦‚æœä¸€å®šè¦è·å–æ›´æ–°æ•°æ®ä»¥åçš„DOMï¼Œè¦ç”¨$nextTick</span><br><span class="line">        this.$nextTick(() &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F; $nextTick ä¼šæŠŠå›è°ƒå‡½æ•°æ”¾åˆ°DOMæ›´æ–°ä»¥åæ‰§è¡Œ</span><br><span class="line">            console.log(this.$refs.listItem.length)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="computed-amp-watch"><a href="#computed-amp-watch" class="headerlink" title="computed &amp; watch **"></a>computed &amp; watch **</h3><p><strong>computed è®¡ç®—å±æ€§</strong></p><ol><li>é¡µé¢åŠ è½½æ—¶å°±æ±‚å€¼ï¼›æ”¯æŒç¼“å­˜ï¼Œå¦‚æœä¾èµ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—</li><li>ä¸æ”¯æŒå¼‚æ­¥</li><li>å¦‚æœä¸€ä¸ªå±æ€§æ˜¯ç”±å…¶ä»–å±æ€§è®¡ç®—è€Œæ¥ï¼Œè¿™ä¸ªå±æ€§ä¾èµ–å…¶ä»–å±æ€§ï¼Œä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨æ±‚å–æœ€æ–°çš„è®¡ç®—ç»“æœ</li></ol><p><strong>watch è§‚å¯Ÿå±æ€§</strong></p><ol><li>é¡µé¢åŠ è½½æ—¶ä¸æ±‚å€¼ï¼Œä¾èµ–å€¼å‘ç”Ÿæ”¹å˜æ—¶æ‰æ±‚å€¼</li><li>watch æ”¯æŒå¼‚æ­¥</li><li>watchåªèƒ½ç›‘å¬ä¸€ä¸ªå±æ€§çš„å˜åŒ–ï¼Œå¦‚æœæœ‰å±æ€§ä¾èµ–è¿™ä¸ªç»“æœï¼Œé‚£ä¹ˆéœ€è¦æ‰‹åŠ¨å»é‡æ–°è®¡ç®—è¿™ä¸ªç»“æœï¼›</li></ol><blockquote><p><strong><code>æ —å­</code></strong></p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;firstName&quot; &#x2F;&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;lastName&quot; &#x2F;&gt;</span><br><span class="line">  &#123;&#123;fullName&#125;&#125;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#39;#app&#39;,</span><br><span class="line">    data: &#123;</span><br><span class="line">      firstName: &#39;&#39;,</span><br><span class="line">      lastName: &#39;&#39;,</span><br><span class="line">      fullName: &#39;&#39;,</span><br><span class="line">      obj:&#123; &#x2F;&#x2F;... &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      fullName () &#123;</span><br><span class="line">        return this.lastName + this.firstName;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">      firstName(newVal, oldVal) &#123;</span><br><span class="line">        this.fullName &#x3D; this.lastName + newVal;</span><br><span class="line">      &#125;,</span><br><span class="line">      lastName(nawVal, oldVal) &#123;</span><br><span class="line">        this.fullName &#x3D; newVal + this.firstName;</span><br><span class="line">      &#125;,</span><br><span class="line">      obj: &#123;</span><br><span class="line">        handler: &#39;sayName&#39; , &#x2F;&#x2F; è¿™é‡Œæ˜¯å­—ç¬¦ä¸²</span><br><span class="line">        immediate: true, &#x2F;&#x2F; ç«‹å³æ‰§è¡Œ</span><br><span class="line">        &#x2F;&#x2F; deep: true   &#x2F;&#x2F; æ·±åº¦ç›‘æ§</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">       sayName() &#123;</span><br><span class="line">           console.log(this.name)</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  fullName: &#123;</span><br><span class="line">    <span class="comment">// getter  é»˜è®¤åªæœ‰getteræ–¹æ³•</span></span><br><span class="line">    <span class="keyword">get</span>: function () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">' '</span> + <span class="keyword">this</span>.lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// setter  æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ·»åŠ setteræ–¹æ³•ï¼Œåšä¸€äº›ä¸­é—´å¤„ç†</span></span><br><span class="line">    <span class="keyword">set</span>: function (newValue) &#123;</span><br><span class="line">      <span class="keyword">var</span> names = newValue.split(<span class="string">' '</span>)</span><br><span class="line">      <span class="keyword">this</span>.firstName = names[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">this</span>.lastName = names[names.length - <span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ref"><a href="#ä½¿ç”¨ref" class="headerlink" title="ä½¿ç”¨ref"></a>ä½¿ç”¨ref</h3><ul><li>é¦–å…ˆåœ¨è¦è·å–çš„å…ƒç´ æ·»åŠ ref=â€æ ‡è¯†ç¬¦â€çš„è¡Œå†…å±æ€§</li><li>è·å–çš„æ—¶å€™this.$refs.æ ‡è¯†ç¬¦è·å–å…ƒç´ </li><li>å¦‚æœç›¸åŒçš„ä¸€ä¸ªrefæœ‰ä¸€ä¸ªï¼Œè·å–åˆ°çš„å°±æ˜¯å¸¦è¿™ä¸ªrefçš„åŸç”Ÿå…ƒç´ å¯¹è±¡</li><li>å¦‚æœç›¸åŒrefçš„æœ‰å¤šä¸ªï¼Œè·å–åˆ°çš„æ˜¯æ‰€æœ‰å¸¦æœ‰è¿™ä¸ªrefçš„å…ƒç´ ç»„æˆçš„æ•°ç»„</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;p ref&#x3D;&quot;box&quot;&gt;&#123;&#123;msg&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">this.$refs.box.style.color &#x3D; &#39;red&#39;</span><br></pre></td></tr></table></figure><h3 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide/inject"></a>provide/inject</h3><p>provide å’Œ inject ä¸»è¦ä¸ºé«˜é˜¶æ’ä»¶/ç»„ä»¶åº“æä¾›ç”¨ä¾‹ã€‚ä¸ React çš„ä¸Šä¸‹æ–‡ç‰¹æ€§å¾ˆç›¸ä¼¼ã€‚</p><p>inject/provide æœ¬è´¨è¿˜æ˜¯é€šè¿‡$parentå‘ä¸ŠæŸ¥æ‰¾ç¥–å…ˆèŠ‚ç‚¹æ•°æ®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'u-form'</span>,</span><br><span class="line">    props: &#123;</span><br><span class="line">        title: <span class="built_in">String</span>,</span><br><span class="line">        labelWidth: <span class="built_in">String</span>,</span><br><span class="line">        contentWidth: <span class="built_in">String</span>,</span><br><span class="line">        okButton: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">default</span>: <span class="string">'ç¡®å®š'</span> &#125;,</span><br><span class="line">        cancelButton: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">default</span>: <span class="string">'å–æ¶ˆ'</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    provide() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            uForm: <span class="keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'u-form-item'</span>,</span><br><span class="line">    props: &#123;</span><br><span class="line">        label: <span class="built_in">String</span>,</span><br><span class="line">        error: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="built_in">Boolean</span>,</span><br><span class="line">        tip: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            leftSty: &#123;&#125;,</span><br><span class="line">            rightSty: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    inject: [<span class="string">'uForm'</span>],</span><br><span class="line">    created() &#123;</span><br><span class="line">        <span class="keyword">this</span>.uForm.labelWidth &amp;&amp; (<span class="keyword">this</span>.leftSty.width = <span class="keyword">this</span>.uForm.labelWidth)</span><br><span class="line">        <span class="keyword">this</span>.uForm.contentWidth &amp;&amp; (<span class="keyword">this</span>.rightSty.width = <span class="keyword">this</span>.uForm.contentWidth)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="this-once-amp-amp-é’©å­äº‹ä»¶hookEvent"><a href="#this-once-amp-amp-é’©å­äº‹ä»¶hookEvent" class="headerlink" title="this.$once() &amp;&amp; é’©å­äº‹ä»¶hookEvent"></a>this.$once() &amp;&amp; é’©å­äº‹ä»¶hookEvent</h3><p>this.$once(â€˜hook:beforeDestroyâ€™,callback)</p><p><strong>åªé’ˆå¯¹é’©å­å‡½æ•°</strong></p><p>æ¸…é™¤å®šæ—¶å™¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥ç”¨è¿™ä¸ªæ–¹å¼ç¦»å¼€é¡µé¢ä¹‹å‰å¯ä»¥æ¸…é™¤å®šæ—¶å™¨</span></span><br><span class="line">mounted() &#123;</span><br><span class="line">   <span class="comment">// console.log(this.$options.data())</span></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">   <span class="keyword">this</span>.timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="built_in">Date</span>.now())</span><br><span class="line">   &#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">this</span>.$once(<span class="string">'hook:beforeDestroy'</span>, () =&gt; &#123;</span><br><span class="line">     clearInterval(<span class="keyword">this</span>.timer);</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><p>ç›‘æ§å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥ä¾¦æŸ¥ç»„ä»¶çš„é’©å­å‡½æ•°</span></span><br><span class="line">&lt;List @hook:mounted=<span class="string">"listenMounted"</span> /&gt;</span><br></pre></td></tr></table></figure><h3 id="vueæ ·å¼ç©¿é€"><a href="#vueæ ·å¼ç©¿é€" class="headerlink" title="vueæ ·å¼ç©¿é€"></a>vueæ ·å¼ç©¿é€</h3><p>åœ¨å¼€å‘ä¸­ä¿®æ”¹ç¬¬ä¸‰æ–¹ç»„ä»¶æ ·å¼æ˜¯å¾ˆå¸¸è§ï¼Œä½†ç”±äº scoped å±æ€§çš„æ ·å¼éš”ç¦»ï¼Œå¯èƒ½éœ€è¦å»é™¤ scoped æˆ–æ˜¯å¦èµ·ä¸€ä¸ª style ã€‚è¿™äº›åšæ³•éƒ½ä¼šå¸¦æ¥å‰¯ä½œç”¨ï¼ˆç»„ä»¶æ ·å¼æ±¡æŸ“ã€ä¸å¤Ÿä¼˜é›…ï¼‰ï¼Œæ ·å¼ç©¿é€åœ¨cssé¢„å¤„ç†å™¨ä¸­ä½¿ç”¨æ‰ç”Ÿæ•ˆã€‚</p><p>æ·±åº¦ä½œç”¨é€‰æ‹©å™¨æœ‰<code>&gt;&gt;&gt;</code>å’Œåˆ«å<code>/deep/</code></p><p><code>&gt;&gt;&gt;</code>åŸºæœ¬åœ¨çº¯cssä¸­ä½¿ç”¨ï¼Œç±»ä¼¼Sassï¼Œlessçš„Cssé¢„ç¼–è¯‘å™¨ä¸€èˆ¬éƒ½ç”¨<code>/deep/</code>ï¼Œä½†æ˜¯eslint å¯èƒ½ä¸è¢«é€šè¿‡ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>::v-deep</code>ä»£æ›¿</p><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">::v-deep .el-table thead tr,::v-deep .el-table thead tr th &#123;</span><br><span class="line">  background: rgba(<span class="number">235</span>, <span class="number">238</span>, <span class="number">245</span>, <span class="number">0.27</span>) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å¼ç»„ä»¶"><a href="#å‡½æ•°å¼ç»„ä»¶" class="headerlink" title="å‡½æ•°å¼ç»„ä»¶"></a>å‡½æ•°å¼ç»„ä»¶</h3><p>å‡½æ•°å¼ç»„ä»¶æ˜¯æ— çŠ¶æ€ï¼Œå®ƒæ— æ³•å®ä¾‹åŒ–ï¼Œæ²¡æœ‰ä»»ä½•çš„ç”Ÿå‘½å‘¨æœŸå’Œæ–¹æ³•ã€‚åˆ›å»ºå‡½æ•°å¼ç»„ä»¶ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æ¨¡æ¿æ·»åŠ  functional å£°æ˜å³å¯ã€‚ä¸€èˆ¬é€‚åˆåªä¾èµ–äºå¤–éƒ¨æ•°æ®çš„å˜åŒ–è€Œå˜åŒ–çš„ç»„ä»¶ï¼Œå› å…¶è½»é‡ï¼Œæ¸²æŸ“æ€§èƒ½ä¹Ÿä¼šæœ‰æ‰€æé«˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template functional&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"list"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item"</span> v-<span class="keyword">for</span>=<span class="string">"item in props.list"</span> :key=<span class="string">"item.id"</span> @click=<span class="string">"props.itemClick(item)"</span>&gt;</span><br><span class="line">            &lt;p&gt;&#123;&#123;item.title&#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;p&gt;&#123;&#123;item.content&#125;&#125;&lt;/</span>p&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ**"></a>ç”Ÿå‘½å‘¨æœŸ**</h3><table><thead><tr><th align="left"><span style='display: block;text-align: left;'> ç”Ÿå‘½å‘¨æœŸ    </span></th><th align="left"><span style='display: block;text-align: left;'> æè¿°</span></th></tr></thead><tbody><tr><td align="left">beforeCreate</td><td align="left">ç»„ä»¶å®ä¾‹è¢«åˆ›å»ºä¹‹åˆï¼Œç»„ä»¶çš„å±æ€§ç”Ÿæ•ˆä¹‹å‰</td></tr><tr><td align="left">created</td><td align="left">ç»„ä»¶å®ä¾‹å·²ç»å®Œå…¨åˆ›å»ºï¼Œå±æ€§ä¹Ÿç»‘å®šï¼Œä½†çœŸå® dom è¿˜æ²¡æœ‰ç”Ÿæˆï¼Œ$el è¿˜ä¸å¯ç”¨</td></tr><tr><td align="left">beforeMount</td><td align="left">åœ¨æŒ‚è½½å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨ï¼šç›¸å…³çš„ render å‡½æ•°é¦–æ¬¡è¢«è°ƒç”¨</td></tr><tr><td align="left">mounted</td><td align="left">el è¢«æ–°åˆ›å»ºçš„ vm.$el æ›¿æ¢ï¼Œå¹¶æŒ‚è½½åˆ°å®ä¾‹ä¸Šå»ä¹‹åè°ƒç”¨è¯¥é’©å­</td></tr><tr><td align="left">beforeUpdate</td><td align="left">ç»„ä»¶æ•°æ®æ›´æ–°ä¹‹å‰è°ƒç”¨ï¼Œå‘ç”Ÿåœ¨è™šæ‹Ÿ DOM æ‰“è¡¥ä¸ä¹‹å‰</td></tr><tr><td align="left">update</td><td align="left">ç»„ä»¶æ•°æ®æ›´æ–°ä¹‹å</td></tr><tr><td align="left">activated</td><td align="left"><code>keep-alive ä¸“å±</code>ï¼Œç»„ä»¶è¢«æ¿€æ´»æ—¶è°ƒç”¨</td></tr><tr><td align="left">deactivated</td><td align="left"><code>keep-alive ä¸“å±</code>ï¼Œç»„ä»¶è¢«é”€æ¯æ—¶è°ƒç”¨</td></tr><tr><td align="left">beforeDestory</td><td align="left">ç»„ä»¶é”€æ¯å‰è°ƒç”¨</td></tr><tr><td align="left">destoryed</td><td align="left">ç»„ä»¶é”€æ¯åè°ƒç”¨</td></tr></tbody></table><h3 id="è·¯ç”±ä½¿ç”¨"><a href="#è·¯ç”±ä½¿ç”¨" class="headerlink" title="è·¯ç”±ä½¿ç”¨"></a>è·¯ç”±ä½¿ç”¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: <span class="string">"/"</span>,</span><br><span class="line">    redirect: <span class="string">"/accountSum"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/accountDetails/id:?"</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../components/AccountDetails.vue'</span>),</span><br><span class="line">    meta: &#123;<span class="attr">keepAlive</span>: <span class="literal">true</span>,&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    path: <span class="string">"*"</span>,</span><br><span class="line">    redirect: <span class="string">"/accountSum"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  mode: <span class="string">"history"</span>,<span class="comment">//é»˜è®¤æ˜¯hashæ¨¡å¼</span></span><br><span class="line">  routes,</span><br><span class="line">  <span class="comment">// linkActiveClass: "active"</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="è·¯ç”±çš„æ–¹æ³•"><a href="#è·¯ç”±çš„æ–¹æ³•" class="headerlink" title="è·¯ç”±çš„æ–¹æ³•"></a>è·¯ç”±çš„æ–¹æ³•</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.$router.back()  <span class="comment">// å›é€€</span></span><br><span class="line"><span class="keyword">this</span>.$router.go(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.$router.replace()</span><br><span class="line"><span class="keyword">this</span>.$router.push(<span class="string">`/permission/role-detail/<span class="subst">$&#123;val&#125;</span>`</span>);  <span class="comment">// è·³è½¬åˆ°å½“å‰role-detailé¡µé¢</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> &#123;name, meta, path, params, fullPath, query, hash&#125; = <span class="keyword">this</span>.$route <span class="comment">// è·å–å€¼</span></span><br></pre></td></tr></table></figure><h4 id="å…¨å±€å®ˆå«"><a href="#å…¨å±€å®ˆå«" class="headerlink" title="å…¨å±€å®ˆå«"></a>å…¨å±€å®ˆå«</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js å…¥å£æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span>; <span class="comment">// å¼•å…¥è·¯ç”±</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123; </span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line">router.beforeResolve(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'afterEach å…¨å±€åç½®é’©å­'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="è·¯ç”±ç‹¬äº«å®ˆå«"><a href="#è·¯ç”±ç‹¬äº«å®ˆå«" class="headerlink" title="è·¯ç”±ç‹¬äº«å®ˆå«"></a>è·¯ç”±ç‹¬äº«å®ˆå«</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: workspace,</span><br><span class="line">      component: Foo,</span><br><span class="line">      beforeEnter: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123; </span><br><span class="line">        <span class="comment">// å‚æ•°ç”¨æ³•ä»€ä¹ˆçš„éƒ½ä¸€æ ·,è°ƒç”¨é¡ºåºåœ¨å…¨å±€å‰ç½®å®ˆå«åé¢ï¼Œæ‰€ä»¥ä¸ä¼šè¢«å…¨å±€å®ˆå«è¦†ç›–</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="AJAXæ•°æ®è°ƒå–"><a href="#AJAXæ•°æ®è°ƒå–" class="headerlink" title="AJAXæ•°æ®è°ƒå–"></a>AJAXæ•°æ®è°ƒå–</h3><p>å¯ä»¥åœ¨é’©å­å‡½æ•° <code>createdã€beforeMountã€mounted</code> ä¸­è¿›è¡Œè°ƒç”¨ï¼Œå› ä¸ºåœ¨è¿™ä¸‰ä¸ªé’©å­å‡½æ•°ä¸­ï¼Œdata å·²ç»åˆ›å»ºï¼Œ<br>å¯ä»¥å°†æœåŠ¡ç«¯ç«¯è¿”å›çš„æ•°æ®è¿›è¡Œèµ‹å€¼ã€‚æ¨èåœ¨ <code>created</code> é’©å­å‡½æ•°ä¸­è°ƒç”¨å¼‚æ­¥è¯·æ±‚ï¼Œå› ä¸ºåœ¨ <code>created</code> é’©å­å‡½æ•°ä¸­è°ƒç”¨å¼‚æ­¥è¯·æ±‚æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>èƒ½æ›´å¿«è·å–åˆ°æœåŠ¡ç«¯æ•°æ®ï¼Œå‡å°‘é¡µé¢ loading æ—¶é—´ï¼›</li><li>ssr ä¸æ”¯æŒ beforeMount ã€mounted é’©å­å‡½æ•°ï¼Œæ‰€ä»¥æ”¾åœ¨ created ä¸­æœ‰åŠ©äºä¸€è‡´æ€§ï¼›</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">   data () &#123;</span><br><span class="line">     <span class="keyword">return</span> &#123;</span><br><span class="line">        commitList:[],</span><br><span class="line">        show:<span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   methods: &#123;</span><br><span class="line">      <span class="keyword">async</span> queryCommit()&#123;</span><br><span class="line">       <span class="keyword">this</span>.show = <span class="literal">true</span></span><br><span class="line">       <span class="keyword">this</span>.commitList =  <span class="keyword">await</span> fetch(<span class="string">`https://api.xxxx.cn`</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                method: <span class="string">'GET'</span>,</span><br><span class="line">                headers: &#123;</span><br><span class="line">                    <span class="string">'Authorization'</span>: <span class="string">'token xxxx'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         ).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">             <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">                <span class="keyword">this</span>.show = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">return</span> response.json();</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'æ¥å£è°ƒå–å¤±è´¥ï¼'</span>);</span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   created()&#123;</span><br><span class="line">       <span class="keyword">this</span>.queryCommit();</span><br><span class="line">   &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¯­æ³•ç¤ºä¾‹"><a href="#è¯­æ³•ç¤ºä¾‹" class="headerlink" title="è¯­æ³•ç¤ºä¾‹*"></a>è¯­æ³•ç¤ºä¾‹*</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &lt;!-- å°èƒ¡å­è¯­æ³• --&gt;</span><br><span class="line">    &#123;&#123; msg &#125;&#125;</span><br><span class="line"></span><br><span class="line">    &lt;!-- v-onäº‹ä»¶ç»‘å®šï¼Œå¯ç®€å†™ä¸º @ --&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; msg &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button v-on="reverseMsg"&gt;ç‚¹å‡»ç¿»è½¬&lt;/</span>button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- v-bindæ•°æ®åŠ¨æ€ç»‘å®šï¼Œå¯ç®€å†™ä¸º : --&gt;</span><br><span class="line">    &lt;span v-bind:message=<span class="string">"msgTime"</span>&gt;åˆ›å»ºæ—¶é—´&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &lt;!-- v-if/</span>v-<span class="keyword">else</span>/v-showæ§åˆ¶å…ƒç´ å‡ºç°ï¼ˆv-<span class="keyword">if</span>å’Œv-<span class="keyword">else</span>ç›´æ¥æ“ä½œçš„DOMï¼›v-showæ§åˆ¶çš„æ˜¯styleï¼‰ --&gt;</span><br><span class="line">    &lt;p v-<span class="keyword">if</span>=<span class="string">"seen"</span>&gt;Now you see <span class="keyword">this</span>&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p v-else&gt;Now you see that&lt;/</span>p&gt;</span><br><span class="line">    &lt;p v-show=<span class="string">"seen"</span>&gt;This is v-show<span class="string">'s content&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;!-- v-foråˆ—è¡¨æ¸²æŸ“ï¼Œå¯æ¸²æŸ“å¯¹è±¡ã€æ•°ç»„ã€å­—ç¬¦ä¸²ã€æ•°å­—ï¼Œç”Ÿæˆè°å°±v-forè°ï¼Œv-forä¹‹åä¸€å®šè¦å†™:keyå±æ€§ --&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">        &lt;li v-for="(item, index) in toDoList" :key="item.id"&gt;</span></span><br><span class="line"><span class="string">            &#123;&#123; index &#125;&#125;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;!-- v-text/v-htmlå°†å±æ€§ç»‘å®šåˆ°DOMå…ƒç´ ä¸­ï¼Œtextä¸è¯†åˆ«æ ‡ç­¾ï¼Œhtmlè¯†åˆ« --&gt;</span></span><br><span class="line"><span class="string">    &lt;div v-text="title"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div v-html="title"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;!-- v-modelåŒå‘æ•°æ®ç»‘å®šï¼Œæ³¨æ„åªèƒ½ç»‘å®šè¡¨å•å…ƒç´  --&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;&#123;&#123; phone &#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;input type="text" v-model="phone"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">new Vue(&#123;</span></span><br><span class="line"><span class="string">    // ç»‘å®šæ ¹DOMå…ƒç´ èŠ‚ç‚¹ï¼Œåœ¨æ­¤å…ƒç´ èŠ‚ç‚¹ä¸‹çš„æ“ä½œéƒ½å¯ä»¥è¢«vueè¯†åˆ«</span></span><br><span class="line">    el : '#app',</span><br><span class="line">    <span class="comment">// å‚¨å­˜</span></span><br><span class="line">    data : &#123;</span><br><span class="line">        msg : <span class="string">'Hello World'</span>,</span><br><span class="line">        msgTime : <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(),</span><br><span class="line">        seen : <span class="literal">true</span>,</span><br><span class="line">        toDoList : [</span><br><span class="line">            &#123;<span class="attr">item</span> : sleep&#125;,</span><br><span class="line">            &#123;<span class="attr">item</span> : eat&#125;</span><br><span class="line">        ],</span><br><span class="line">        title : <span class="string">'&lt;h2&gt;è¿™æ˜¯ä¸ªtitle&lt;/h2&gt;'</span>,</span><br><span class="line">        phone : <span class="string">'231231231'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æ–¹æ³•</span></span><br><span class="line">    methods : &#123;</span><br><span class="line">        reverseMsg () &#123;</span><br><span class="line">            <span class="keyword">this</span>.msg = <span class="keyword">this</span>.msg.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç”¨äºå¤„ç†æ•°æ®ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜åŸæ•°æ®çš„æ•°æ®å¤„ç†æ–¹å¼ï¼Œä¸€èˆ¬ç”¨æ¥æ ¼å¼åŒ–æ•°æ®ï¼ˆæ–‡æœ¬æ•°æ®æ ¼å¼åŒ–ï¼‰</span></span><br><span class="line">    filters: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ä¾¦å¬å™¨å±æ€§ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼›é”®æ˜¯éœ€è¦è§‚å¯Ÿçš„è¡¨è¾¾å¼ï¼Œå€¼æ˜¯å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼›å½“è¢«è§‚å¯Ÿçš„è¡¨è¾¾å¼çš„å€¼å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œä¼šç”¨å¯¹åº”çš„å›è°ƒå‡½æ•°å®Œæˆç›¸åº”çš„ç›‘è§†æ“ä½œ</span></span><br><span class="line">    watch: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è®¡ç®—å±æ€§ï¼ŒåŸºäºä¾èµ–è¿›è¡Œç¼“å­˜ï¼Œåªæœ‰å½“ç¼“å­˜å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šé‡æ–°æ±‚å€¼ï¼›ä¸è¦æ”¾å…¥è¿‡å¤šçš„é€»è¾‘ï¼Œä¸èƒ½ä¸dataä¸­çš„å±æ€§é‡åï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line">    computed: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æŒ‚è½½å±€éƒ¨ç»„ä»¶ï¼Œåªèƒ½å½“å‰ä½¿ç”¨</span></span><br><span class="line">    components: &#123;</span><br><span class="line">        <span class="comment">// ä¸€ä¸ªå­—ç¬¦ä¸²æ¨¡æ¿ä½œä¸º Vue å®ä¾‹çš„æ ‡è¯†ä½¿ç”¨</span></span><br><span class="line">        template: <span class="string">``</span>,</span><br><span class="line">        <span class="comment">// åˆ›å»ºpropsåŠå…¶ä¼ é€’è¿‡æ¥çš„å±æ€§</span></span><br><span class="line">        props: []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”Ÿå‘½å‘¨æœŸçš„é’©å­å‡½æ•° - ä¸€ä¸ªç»„ä»¶ä»å¼€å§‹åˆ°æ¯ç­çš„è¿‡ç¨‹</span></span><br><span class="line">    beforeCreate () &#123;&#125;, <span class="comment">// åˆå§‹åŒ–å®ä¾‹åï¼Œæ•°æ®è§‚æµ‹å‰</span></span><br><span class="line">    created () <span class="comment">// åœ¨è¿™å„¿å¯ä»¥è°ƒç”¨methodsä¸­çš„æ–¹æ³•ã€æ”¹å˜dataæ•°æ®ï¼›å¸¸ç”¨æ¥å‘é€è¯·æ±‚ï¼Œè·å–æ•°æ®</span></span><br><span class="line">        axios.get/post/all() <span class="comment">// axiosè·å–ajaxçš„æ•°æ®</span></span><br><span class="line">    &#125;,</span><br><span class="line">    beforeMount () &#123;&#125;, <span class="comment">// æŒ‚è½½å¼€å§‹ä¹‹å‰</span></span><br><span class="line">    mounted () &#123;&#125;, <span class="comment">// å·²æŒ‚è½½ï¼Œå¯ä»¥è·å–ã€æ“ä½œelçš„DOMå…ƒç´ </span></span><br><span class="line">    beforeUpdate () &#123;&#125;, <span class="comment">// æ•°æ®æ›´æ–°æ—¶ï¼Œè·å–çš„æ•°æ®æ˜¯æ›´æ–°ä¹‹åçš„ï¼Œä½†é¡µé¢ä¸­çš„DOMå…ƒç´ æ˜¯æ›´æ–°ä¹‹å‰çš„</span></span><br><span class="line">    updated () &#123;&#125;, <span class="comment">// DOMå·²æ›´æ–°ï¼Œå¯ä»¥æ‰§è¡Œä¾èµ–DOMçš„æ“ä½œ</span></span><br><span class="line">    beforeDestroy () &#123;&#125;, <span class="comment">// å®ä¾‹é”€æ¯ä¹‹å‰ï¼Œæ­¤æ—¶æ‰€æœ‰æ–¹æ³•éƒ½å¯è°ƒç”¨ï¼Œå¸¸ç”¨æ¥æ‰§è¡Œæ¸…ç†ä»»åŠ¡</span></span><br><span class="line">    destroyed () &#123;&#125;, <span class="comment">// å®ä¾‹é”€æ¯ä¹‹åï¼Œæ‰€æœ‰äº‹ä»¶ã€å­å®ä¾‹éƒ½ä¼šé”€æ¯</span></span><br><span class="line">&#125;);</span><br><span class="line">vm.$<span class="keyword">set</span>(vm.toDoList, item, play) // å‘dataä¸­æ–°å¢å±æ€§éœ€è¦ä½¿ç”¨$<span class="keyword">set</span>æ–¹æ³•</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h3><p>Vuexæ˜¯ä¸€ä¸ªä¸“ä¸ºVueåº”ç”¨ç¨‹åºå¼€å‘çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚æ¯ä¸€ä¸ªVuexåº”ç”¨çš„æ ¸å¿ƒå°±æ˜¯store,å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒåŒ…å«ç€ä½ çš„åº”ç”¨ä¸­å¤§éƒ¨åˆ†çš„çŠ¶æ€stateã€‚</p><p><strong>ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š</strong></p><ul><li><strong>State</strong>ï¼šå®šä¹‰äº†åº”ç”¨çŠ¶æ€çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®é»˜è®¤çš„åˆå§‹çŠ¶æ€ã€‚</li><li><strong>Getter</strong>ï¼šå…è®¸ç»„ä»¶ä» Store ä¸­è·å–æ•°æ®ï¼ŒmapGetters è¾…åŠ©å‡½æ•°ä»…ä»…æ˜¯å°† store ä¸­çš„ getter æ˜ å°„åˆ°å±€éƒ¨è®¡ç®—å±æ€§ã€‚</li><li><strong>Mutation</strong>ï¼šæ˜¯å”¯ä¸€æ›´æ”¹ store ä¸­çŠ¶æ€çš„æ–¹æ³•ï¼Œä¸”å¿…é¡»æ˜¯åŒæ­¥å‡½æ•°ï¼Œ<code>ç›¸å½“äºrudexçš„reducer</code></li><li><strong>Action</strong>ï¼šç”¨äºæäº¤ mutationï¼Œè€Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€ï¼Œå¯ä»¥åŒ…å«ä»»æ„å¼‚æ­¥æ“ä½œï¼Œ<code>ç›¸å½“äºrudexçš„action</code></li><li><strong>Module</strong>ï¼šå…è®¸å°†å•ä¸€çš„ Store æ‹†åˆ†ä¸ºå¤šä¸ªstoreä¸”åŒæ—¶ä¿å­˜åœ¨å•ä¸€çš„çŠ¶æ€æ ‘ä¸­ã€‚</li></ul><h4 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h4><pre><code>â”œâ”€â”€ main.jsâ”œâ”€â”€ apiâ”‚   â””â”€â”€ ... // APIè¯·æ±‚â”œâ”€â”€ components â”‚   â”œâ”€â”€ App.vueâ”‚   â””â”€â”€ ...â””â”€â”€ store    â”œâ”€â”€ index.js          # æˆ‘ä»¬ç»„è£…æ¨¡å—å¹¶å¯¼å‡º store çš„åœ°æ–¹    â”œâ”€â”€ actions.js        # æ ¹çº§åˆ«çš„ action    â”œâ”€â”€ mutations.js      # æ ¹çº§åˆ«çš„ mutation    â””â”€â”€ modules        â””â”€â”€ test.js       # æµ‹è¯•demo</code></pre><h4 id="vuexé…ç½®"><a href="#vuexé…ç½®" class="headerlink" title="vuexé…ç½®"></a>vuexé…ç½®</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// modules/test.js</span></span><br><span class="line"><span class="keyword">const</span> test = &#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">       <span class="comment">// stateå°±æ˜¯æ•°æ®ï¼Œå¦‚æœæ•°æ®å®šä¹‰åœ¨stateä¸­ç»„ä»¶ä¸­å¦‚æœè¦ä½¿ç”¨è¿™ä¸ªæ•°æ®ï¼šé»˜è®¤æ˜¯this.$store.state.å±æ€§å çš„æ–¹å¼è·å–</span></span><br><span class="line">        count: <span class="number">15</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">      <span class="comment">// state ä¸­çš„æ•°æ®ä¸èƒ½è¢«ç›´æ¥ä¿®æ”¹ï¼Œå¦‚æœè¦ä¿®æ”¹è¿™äº›æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨mutationï¼Œæ³¨æ„mutationä¸­ä¸èƒ½ä½¿ç”¨å¼‚æ­¥æ›´æ–°state</span></span><br><span class="line">      <span class="comment">// ç»„ä»¶ä¸­ä½¿ç”¨this.$store.commit('add')æ›´æ–°</span></span><br><span class="line">        add(state, payload) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(payload);</span><br><span class="line">            state.count++</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">      <span class="comment">// actionå¯ä»¥ä½¿ç”¨å¼‚æ­¥ï¼Œä½†æ˜¯æ›´æ–°æ•°æ®ä»ç„¶éœ€è¦ commit å¯¹åº”çš„mutation</span></span><br><span class="line">      <span class="comment">// ç»„ä»¶ä¸­ä½¿ç”¨this.$store.dispatch('syncAdd')æ›´æ–°</span></span><br><span class="line">        syncAdd(context) &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                context.commit(<span class="string">'add'</span>, <span class="number">11</span>)</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">       <span class="keyword">async</span> asyncAdd(context, val) &#123;</span><br><span class="line">           <span class="keyword">await</span> <span class="built_in">console</span>.log(val);</span><br><span class="line">            context.commit(<span class="string">'add'</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    getters: &#123; <span class="comment">// è·Ÿåœ¨å¤–é¢å•ç‹¬å£°æ˜æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">        getCount(state) &#123; <span class="comment">// this.$store.getters.getCount</span></span><br><span class="line">            <span class="keyword">return</span> state.count</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> test</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// getters.js</span></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line"> <span class="comment">// this.$store.getters.count</span></span><br><span class="line">    count: <span class="function"><span class="params">state</span> =&gt;</span> state.test.count,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">'./getters'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡nodeçš„ require.contextï¼Œè·å–æ‰€æœ‰çš„çš„æ–‡ä»¶ç›®å½•,ä¸éœ€è¦æ¯æ¬¡æ˜¾å¼çš„è°ƒç”¨importå¯¼å…¥æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> files = <span class="built_in">require</span>.context(<span class="string">'./modules'</span>, <span class="literal">false</span>, /\.js$/);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> modules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">files.keys().forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name = path.basename(key, <span class="string">'.js'</span>); <span class="comment">// å½“å‰æ–‡ä»¶çš„åå­—ï¼Œæ²¡æœ‰åç¼€</span></span><br><span class="line">    modules[name] = files(key).default || files(key)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> debug = process.env.NODE_ENV !== <span class="string">'production'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    modules,</span><br><span class="line">    getters, <span class="comment">// è¿™é‡Œä¹Ÿå¯ä»¥å†™åœ¨modulesé‡Œé¢</span></span><br><span class="line">    strict: debug,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ•°ç»„é‡Œé¢æ˜¯å‡½æ•°</span></span><br><span class="line">        (...state) =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(state);</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; main.js</span><br><span class="line">import store from &quot;.&#x2F;store&quot;</span><br><span class="line">new Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    store, &#x2F;&#x2F; è¿™é‡Œå¯¼å…¥å°±å¯ä»¥this.$storeä½¿ç”¨äº†</span><br><span class="line">    render: h &#x3D;&gt; h(App)</span><br><span class="line">&#125;).$mount(&#39;#app&#39;);</span><br></pre></td></tr></table></figure><h4 id="ç»„ä»¶ä¸­ä½¿ç”¨"><a href="#ç»„ä»¶ä¸­ä½¿ç”¨" class="headerlink" title="ç»„ä»¶ä¸­ä½¿ç”¨"></a>ç»„ä»¶ä¸­ä½¿ç”¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;h1 @click&#x3D;&quot;changeCount&quot;&gt;Vuex&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123;num&#125;&#125;&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123;count&#125;&#125;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;mapMutations, mapState, mapActions, mapGetters&#125; from &#39;vuex&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;test&#39;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">    &#x2F;&#x2F;  num: this.$store.state.test.count  &#x2F;&#x2F;è¿™é‡Œè·å–åªä¼šåŠ è½½ä¸€æ¬¡ï¼Œä¸èƒ½åŠ¨æ€å“åº”</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">      &#x2F;&#x2F; console.log(&#96;%c store&#96;, &#96;color:#42b983&#96;, this.$store.state.test.count);</span><br><span class="line">      &#x2F;&#x2F; console.log(&#96;%c store&#96;, &#96;color:#42b983&#96;, this.$store.getters.count);</span><br><span class="line">      console.log(&#96;%c store&#96;, &#96;color:#42b983&#96;, this.$store);</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    changeCount() &#123;</span><br><span class="line">      &#x2F;&#x2F; this.$store.commit(&#39;add&#39;); &#x2F;&#x2F; åœ¨ä¸ä½¿ç”¨è¾…åŠ©å‡½æ•°ï¼Œé»˜è®¤æ˜¯è¿™ä¹ˆç”¨çš„  å¯¹åº”çš„æ˜¯mutations</span><br><span class="line">      &#x2F;&#x2F; this.$store.dispatch(&#39;syncAdd&#39;); &#x2F;&#x2F; å¯¹åº”çš„æ˜¯actions</span><br><span class="line">      this.add();  &#x2F;&#x2F; è¿™é‡Œæ˜¯ä½¿ç”¨è¾…åŠ©å‡½æ•°ä¹‹åçš„ç”¨æ³•</span><br><span class="line">      this.syncAdd()</span><br><span class="line">    &#125;,</span><br><span class="line">    ...mapMutations([&#39;add&#39;]),</span><br><span class="line">    ...mapActions(&#123;</span><br><span class="line">        syncAdd: &#39;syncAdd&#39; &#x2F;&#x2F; å¯é‡å‘½å</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">      &#x2F;&#x2F; vuex çš„æ•°æ®å»ºè®®åœ¨è¿™é‡Œé¢å£°æ˜ï¼Œå¯ä¿æŒé¡µé¢çš„æ•´æ´</span><br><span class="line">      &#x2F;&#x2F; count() &#123;</span><br><span class="line">      &#x2F;&#x2F;     return this.$store.state.test.count</span><br><span class="line">      &#x2F;&#x2F; &#125;,</span><br><span class="line">      ...mapGetters([&#39;count&#39;]), &#x2F;&#x2F; è·Ÿä¸Šé¢çš„ä¸€è‡´</span><br><span class="line">      ...mapState(&#123;  &#x2F;&#x2F; ç›´æ¥ç ¸å®¹å™¨å†…éƒ¨è·å–å€¼</span><br><span class="line">          num: state &#x3D;&gt; state.test.count  &#x2F;&#x2F; å¦‚æœå¤–é¢æœ‰numçš„å­—æ®µï¼Œå¤–é¢çš„ä¼˜å…ˆçº§é«˜</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h3 id="element-ui"><a href="#element-ui" class="headerlink" title="element ui"></a>element ui</h3><h4 id="formè¡¨å•è‡ªå®šä¹‰éªŒè¯è§„åˆ™"><a href="#formè¡¨å•è‡ªå®šä¹‰éªŒè¯è§„åˆ™" class="headerlink" title="formè¡¨å•è‡ªå®šä¹‰éªŒè¯è§„åˆ™"></a>formè¡¨å•è‡ªå®šä¹‰éªŒè¯è§„åˆ™</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rules &#x3D; &#123;</span><br><span class="line">    roleName: [</span><br><span class="line">        &#123;required: true, message: &#39;è¯·è¾“å…¥åç§°&#39;, trigger: &#39;blur&#39;&#125;,</span><br><span class="line">        &#123;max: 10, message: &#39;é•¿åº¦è¶…è¿‡ 10 ä¸ªå­—ç¬¦&#39;, trigger: [&#39;blur&#39;, &#39;change&#39;]&#125;,</span><br><span class="line">        &#123;validator: this.repeatRoleName, trigger: &#39;blur&#39;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line">&#x2F;&#x2F; æŸ¥è¯¢å½“å‰åç§°æ˜¯å¦å·²ç»è¢«å ç”¨</span><br><span class="line">async repeatRoleName(rule: any, value: string, callback: (val?: string) &#x3D;&gt; void) &#123;</span><br><span class="line">    if (this.formData.tempRoleName &#x3D;&#x3D;&#x3D; value) return callback();</span><br><span class="line">    const usable &#x3D; await checkRoleName(value);</span><br><span class="line">    if (!usable) &#123;</span><br><span class="line">        callback(&#39;è¯¥è§’è‰²åç§°å·²è¢«å ç”¨&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">    callback()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; æ ¼å¼åŒ–</span><br><span class="line">&lt;el-table-column </span><br><span class="line">  min-width&#x3D;&quot;180&quot; </span><br><span class="line">  align&#x3D;&quot;right&quot;</span><br><span class="line">  prop&#x3D;&quot;cpm&quot; </span><br><span class="line">  label&#x3D;&quot;åƒæ¬¡å±•ç°æ¶ˆè´¹ï¼ˆå…ƒï¼‰&quot;</span><br><span class="line">  :formatter&#x3D;&quot;row &#x3D;&gt; formatterNumber(row.cpm)&quot;</span><br><span class="line">&#x2F;&gt;</span><br><span class="line">&#x2F;&#x2F; è‡ªå®šä¹‰å†…å®¹</span><br><span class="line">&lt;el-table-column&gt;</span><br><span class="line">&lt;template slot-scope&#x3D;&quot;scope&quot;&gt;</span><br><span class="line">  &lt;span&gt;&#123;&#123;scope.row.amount&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;&#x2F;el-table-column&gt;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://cn.vuejs.org/" target="_blank" rel="noopener">vuejs</a><br><a href="https://vuex.vuejs.org/zh/guide/actions.html" target="_blank" rel="noopener">vuex</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> VueåŸºæœ¬ç”¨æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vueä¸­ä½¿ç”¨JSX</title>
      <link href="/2020/02/17/workspace/Frame/vue/jsx/"/>
      <url>/2020/02/17/workspace/Frame/vue/jsx/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>vueä¸­ä½¿ç”¨JSX</strong></p><p>[[toc]]</p><h3 id="vueä¸­ä½¿ç”¨JSX"><a href="#vueä¸­ä½¿ç”¨JSX" class="headerlink" title="vueä¸­ä½¿ç”¨JSX"></a>vueä¸­ä½¿ç”¨JSX</h3><p><strong>Template</strong></p><ul><li>å­¦ä¹ æˆæœ¬ä½</li><li>å¤§é‡å†…ç½®æŒ‡ä»¤ç®€åŒ–å¼€å‘</li><li>ç»„ä»¶ä½œç”¨åŸŸcss</li><li>ä½†çµæ´»æ€§ä½</li></ul><p><strong>JSX</strong></p><ul><li>çµæ´»</li><li>JSXæ›´æ˜“è¯»ä¹Ÿæ˜¯ JavaScriptã€‚</li><li>JSXä½¿è‡ªå®šä¹‰Vueç»„ä»¶æ›´å®¹æ˜“å¯¼å…¥å’Œç®¡ç†,å¯¼å…¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨å†é€šè¿‡componentsäº†</li></ul><p>å¯ä»¥ä¾‹å­å¯ä»¥çœ‹å‡ºjsxçš„å†™æ³•ï¼Œæ¯”è¾ƒå¹²å‡€ï¼Œå¯è¯»æ€§é«˜</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;textarea v-<span class="keyword">if</span>=<span class="string">"multiline"</span> v-model=<span class="string">"content"</span> :name=<span class="string">"name"</span> :placeholder=<span class="string">"placeholder"</span> :aria-invalid=<span class="string">"false"</span>&gt;</span><br><span class="line">  &lt;input v-<span class="keyword">else</span> v-model=<span class="string">"content"</span> :name=<span class="string">"name"</span> :placeholder=<span class="string">"placeholder"</span> :aria-invalid=<span class="string">"false"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">render (createElement) &#123;</span></span><br><span class="line"><span class="regexp">    const inputAttributes = &#123;</span></span><br><span class="line"><span class="regexp">        class: 'input-field has-outline',</span></span><br><span class="line"><span class="regexp">        onClick: this.handleClick,</span></span><br><span class="line"><span class="regexp">        placeholder: 'placeholder',</span></span><br><span class="line"><span class="regexp">        value:this.value,</span></span><br><span class="line"><span class="regexp">        onchange:()=&gt;&#123;&#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    const inputMarkup = this.multiline</span></span><br><span class="line"><span class="regexp">        ? &lt;textarea &#123;...inputAttributes&#125;&gt;&lt;/</span>textarea&gt;</span><br><span class="line">        : <span class="xml"><span class="tag">&lt;<span class="name">input</span> &#123;<span class="attr">...inputAttributes</span>&#125;/&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> inputMarkup</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®vueä»¥ä½¿ç”¨JSX"><a href="#é…ç½®vueä»¥ä½¿ç”¨JSX" class="headerlink" title="é…ç½®vueä»¥ä½¿ç”¨JSX"></a>é…ç½®vueä»¥ä½¿ç”¨JSX</h3><p>å¦‚æœä½¿ç”¨çš„Vue-cliå¤§äºæˆ–ç­‰äº 3.0 ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±ç›´æ¥å¯ä»¥ä½¿ç”¨JSXçš„è¯­æ³•äº†ã€‚</p><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ä¸æ”¯æŒ <code>JSX</code> çš„<code>Vue-cli</code>è¾ƒæ—§ç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥é€šè¿‡å®‰è£…<code>babel-preset-vue-app</code>æ¥æ·»åŠ å®ƒï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„<code>.babelrc</code>æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yarn add  babel-preset-vue-app -D</span><br></pre></td></tr></table></figure><p>åœ¨<code>.babelrc</code>æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">"presets"</span>: [<span class="string">"vue-app"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨ç»„ä»¶çš„renderå‡½æ•°ä¸­ä½¿ç”¨JSXã€‚</p><h3 id="ä½¿ç”¨JSXéœ€è¦æ³¨æ„çš„"><a href="#ä½¿ç”¨JSXéœ€è¦æ³¨æ„çš„" class="headerlink" title="ä½¿ç”¨JSXéœ€è¦æ³¨æ„çš„"></a>ä½¿ç”¨JSXéœ€è¦æ³¨æ„çš„</h3><h4 id="slot"><a href="#slot" class="headerlink" title="slot"></a>slot</h4><p>slot æ˜¯æŒ‚åœ¨ <code>this.$slots</code> çš„è¿™ä¸ªå±æ€§ä¸Šçš„ï¼Œthis.$slot[â€˜propertyâ€™] å¯ä»¥ç›´æ¥æ‹¿åˆ°slotçš„vNode,ä¹Ÿå¯ä»¥é€šè¿‡æ•°ç»„ç´¢å¼•æ‹¿åˆ°ï¼ˆä¸æ¨èï¼‰</p><p>æ‰€ä»¥ï¼Œjsx ä¸­ï¼Œé€šè¿‡è®¿é—®this.$slotsæ¥ä»£æ›¿ slot çš„å®šä¹‰:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//çˆ¶ç»„ä»¶ï¼šparent.jsx</span></span><br><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;child&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        I am the slot</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      &lt;div slot='namedSlot'&gt;I am the named slot&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/child&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ å­ç»„ä»¶ï¼šchild.jsx</span></span><br><span class="line"><span class="regexp">render() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div class='child'&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;I am a component&lt;/</span>span&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">this</span>.$slots.default</span><br><span class="line">      &#125;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">this</span>.$slots.default[<span class="number">1</span>]</span><br><span class="line">      &#125;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">this</span>.$slots.namedSlot</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="scoped-slots"><a href="#scoped-slots" class="headerlink" title="scoped slots"></a>scoped slots</h4><p><code>scopedSlot</code> æ˜¯æŒ‚åœ¨ <code>this.$scopedSlots</code> çš„è¿™ä¸ªå±æ€§ä¸Šçš„ï¼Œ<code>this.$scopedSlots[&#39;property&#39;]</code> å¯ä»¥ç›´æ¥æ‹¿åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°å°±æ˜¯ <code>scopeSlots</code> å¤–ä¼ çš„æ•°æ®ï¼Œè¿”å›å€¼æ˜¯VNode.</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç»„ä»¶ï¼šparent.jsx</span></span><br><span class="line">&lt;child</span><br><span class="line">    scopedSlots=&#123;&#123;</span><br><span class="line">        <span class="keyword">default</span>: <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                &lt;div style=<span class="string">"line-height: 30px;"</span>&gt;</span><br><span class="line">                    &#123;props.info.title&#125;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            );</span></span><br><span class="line"><span class="regexp">        &#125;,</span></span><br><span class="line"><span class="regexp">        other: props =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            return (</span></span><br><span class="line"><span class="regexp">                &lt;div style="line-height: 30px;"&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;props.info.title&#125;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&#125;</span><br><span class="line">/&gt;</span><br><span class="line"><span class="comment">// å­ç»„ä»¶ï¼šchild.jsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            info: &#123;</span><br><span class="line">                title: <span class="string">"æ ‡é¢˜ä¸€"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            info2: &#123;</span><br><span class="line">                title: <span class="string">"æ ‡é¢˜äºŒ"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;<span class="keyword">this</span>.$scopedSlots.default(&#123;</span><br><span class="line">                    info: <span class="keyword">this</span>.info</span><br><span class="line">                &#125;)&#125;</span><br><span class="line"></span><br><span class="line">                &#123;<span class="keyword">this</span>.$scopedSlots.other(&#123;</span><br><span class="line">                    info: <span class="keyword">this</span>.info2</span><br><span class="line">                &#125;)&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><h4 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h4><p>è¦ç›‘å¬ <code>JSX</code> ä¸­çš„äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦â€œonâ€å‰ç¼€ã€‚ ä¾‹å¦‚ï¼Œå°†<code>onClick</code>ç”¨äºå•å‡»äº‹ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line"> <span class="keyword">return</span> (</span><br><span class="line">     &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"> )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è¦é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼Œè¯·ä½¿ç”¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line"> <span class="keyword">return</span> (</span><br><span class="line">     &lt;button onClick:prevent=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"> )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h4><p>v-model å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;Component v-model=<span class="string">'test'</span>&gt;&lt;<span class="regexp">/Component&gt;</span></span><br></pre></td></tr></table></figure><p>ç­‰ä»·äº</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;component :value=<span class="string">'test'</span> @input=<span class="string">'test = arguments[0]'</span>&gt;&lt;<span class="regexp">/component&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨jsxå†™æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;component</span><br><span class="line">  value=&#123; <span class="keyword">this</span>.test &#125;</span><br><span class="line">  onInput=&#123; val =&gt; &#123; <span class="keyword">this</span>.test = val &#125; &#125;</span><br><span class="line">&gt;</span><br><span class="line">&lt;<span class="regexp">/component&gt;</span></span><br></pre></td></tr></table></figure><p>vue-clié»˜è®¤æ­å»ºçš„è„šæ‰‹æ¶æ—¶é…ç½®å¥½è¿™ä¸ªpluginçš„ï¼Œå¯ç›´æ¥ä½¿ç”¨<code>v-model</code></p><p><a href="https://github.com/nickmessing/babel-plugin-jsx-v-model" target="_blank" rel="noopener">å¯ä»¥é€šè¿‡è¿™ä¸ªplugin,åœ¨vue jsxé‡Œå†™v-modelçš„sè¯­æ³•</a></p><h4 id="sync-ä¿®é¥°ç¬¦"><a href="#sync-ä¿®é¥°ç¬¦" class="headerlink" title="sync ä¿®é¥°ç¬¦"></a>sync ä¿®é¥°ç¬¦</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;comp :foo.sync=<span class="string">"bar"</span>&gt;&lt;<span class="regexp">/comp&gt;</span></span><br></pre></td></tr></table></figure><p>ç­‰ä»·äº</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;component  visible=&#123;dialogFormVisible&#125;</span><br><span class="line">            &#123;...&#123;<span class="attr">on</span>: &#123;<span class="string">'update:visible'</span>: <span class="keyword">this</span>.handelVisible&#125;&#125;&#125;/&gt;</span><br></pre></td></tr></table></figure><p>å…¶å®ä¼šè¢«æ‹“å±•ä¸º</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;comp :foo=<span class="string">"bar"</span> @update:foo=<span class="string">"val =&gt; bar = val"</span>&gt;&lt;<span class="regexp">/comp&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ æ›´æ–°çš„æ—¶å€™</span></span><br><span class="line"><span class="regexp">this.$emit('update:foo', newValue)</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨jsxå†™æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;component</span><br><span class="line">  foo=&#123; <span class="keyword">this</span>.bar &#125;</span><br><span class="line">  &#123;</span><br><span class="line">    on: &#123;</span><br><span class="line">      <span class="string">'update:foo'</span>: <span class="function"><span class="params">val</span> =&gt;</span> <span class="keyword">this</span>.bar = val</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;</span><br><span class="line">&lt;<span class="regexp">/component&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/nickmessing" target="_blank" rel="noopener">åœ¨jsxé‡Œé¢ç›´æ¥ç”¨.syncçš„æ–¹æ³•</a></p><h4 id="v-html"><a href="#v-html" class="headerlink" title="v-html"></a>v-html</h4><p>å°†HTMLå­—ç¬¦ä¸²è®¾ç½®ä¸ºå…ƒç´ çš„å†…å®¹ï¼Œä½¿ç”¨domPropsInnerHTMLè€Œä¸æ˜¯ä½¿ç”¨v-html</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line"> <span class="keyword">return</span> (</span><br><span class="line">     &lt;button domPropsInnerHTML=&#123;htmlContent&#125;&gt;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"> )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="å¯ä»¥ä½¿ç”¨æ‹“å±•è¿ç®—ç¬¦"><a href="#å¯ä»¥ä½¿ç”¨æ‹“å±•è¿ç®—ç¬¦" class="headerlink" title="å¯ä»¥ä½¿ç”¨æ‹“å±•è¿ç®—ç¬¦"></a>å¯ä»¥ä½¿ç”¨æ‹“å±•è¿ç®—ç¬¦</h4><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å±•å¼€ä¸€ä¸ªå¤§å¯¹è±¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line"> <span class="keyword">return</span> (</span><br><span class="line">     &lt;button &#123;...this.largeProps&#125;&gt;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"> )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç”¨å¥½jsxéœ€è¦çŸ¥é“çš„"><a href="#ç”¨å¥½jsxéœ€è¦çŸ¥é“çš„" class="headerlink" title="ç”¨å¥½jsxéœ€è¦çŸ¥é“çš„**"></a>ç”¨å¥½jsxéœ€è¦çŸ¥é“çš„**</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">render (h) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div</span><br><span class="line">      id&#x3D;&quot;foo&quot;</span><br><span class="line">      domPropsInnerHTML&#x3D;&quot;bar&quot;</span><br><span class="line">      onClick&#x3D;&#123;this.clickHandler&#125;</span><br><span class="line">      nativeOnClick&#x3D;&#123;this.nativeClickHandler&#125;</span><br><span class="line">      class&#x3D;&#123;&#123; foo: true, bar: false &#125;&#125;</span><br><span class="line">      style&#x3D;&#123;&#123; color: &#39;red&#39;, fontSize: &#39;14px&#39; &#125;&#125;</span><br><span class="line">      key&#x3D;&quot;key&quot;</span><br><span class="line">      ref&#x3D;&quot;ref&quot;</span><br><span class="line">      refInFor</span><br><span class="line">      slot&#x3D;&quot;slot&quot; &#x2F;&gt;</span><br><span class="line"> )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">render (h) &#123;</span><br><span class="line">    <span class="keyword">return</span> h(<span class="string">'div'</span>, &#123;</span><br><span class="line">      props: &#123; <span class="comment">// ç»„ä»¶çš„å‚æ•°</span></span><br><span class="line">        msg: <span class="string">'hi'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      attrs: &#123; </span><br><span class="line">        id: <span class="string">'foo'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      domProps: &#123; </span><br><span class="line">        innerHTML: <span class="string">'bar'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      on: &#123; <span class="comment">// ä¸€äº›äº‹ä»¶</span></span><br><span class="line">        click: <span class="keyword">this</span>.clickHandler</span><br><span class="line">      &#125;,</span><br><span class="line">      nativeOn: &#123;</span><br><span class="line">        click: <span class="keyword">this</span>.nativeClickHandler</span><br><span class="line">      &#125;,</span><br><span class="line">      class: &#123;</span><br><span class="line">        foo: <span class="literal">true</span>,</span><br><span class="line">        bar: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      style: &#123;</span><br><span class="line">        color: <span class="string">'red'</span>,</span><br><span class="line">        fontSize: <span class="string">'14px'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      key: <span class="string">'key'</span>,</span><br><span class="line">      ref: <span class="string">'ref'</span>,</span><br><span class="line">      refInFor: <span class="literal">true</span>,</span><br><span class="line">      slot: <span class="string">'slot'</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¿…è¦æƒ…å†µä¸‹è¦è¿™ä¹ˆç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  &#123;...&#123;</span><br><span class="line">    attrs: &#123;</span><br><span class="line">      id: <span class="string">'foo'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    domProps: &#123;</span><br><span class="line">      innerHTML: <span class="string">'bar'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    class: &#123;</span><br><span class="line">      foo: <span class="literal">true</span>,</span><br><span class="line">      bar: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    style: &#123;</span><br><span class="line">      color: <span class="string">'red'</span>,</span><br><span class="line">      fontSize: <span class="string">'14px'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    on: &#123;</span><br><span class="line">      click: <span class="keyword">this</span>.clickHandler</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><h3 id="JSXä»£ç ç¤ºä¾‹"><a href="#JSXä»£ç ç¤ºä¾‹" class="headerlink" title="JSXä»£ç ç¤ºä¾‹"></a>JSXä»£ç ç¤ºä¾‹</h3><p>ä»¥ä¸‹æ˜¯jsxå†™æ³•</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; index.vue</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Props from &quot;.&#x2F;Props&quot;;</span><br><span class="line">import Event from &quot;.&#x2F;Event&quot;;</span><br><span class="line">import Slot from &quot;.&#x2F;Slot&quot;;</span><br><span class="line">import BigProps from &quot;.&#x2F;BigProps&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    Props,</span><br><span class="line">    Event,</span><br><span class="line">    SlotDemo: Slot,</span><br><span class="line">    BigProps</span><br><span class="line">  &#125;,</span><br><span class="line">  data: () &#x3D;&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name: &quot;&quot;,</span><br><span class="line">      type: &quot;success&quot;,</span><br><span class="line">      bigPropsName: &quot;Hello world!&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handlePropChange(val) &#123;</span><br><span class="line">      this.type &#x3D; val;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleEventChange(val) &#123;</span><br><span class="line">      this.name &#x3D; val;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleBigPropChange(val) &#123;</span><br><span class="line">      this.bigPropsName &#x3D; val;</span><br><span class="line">    &#125;,</span><br><span class="line">    getDefault() &#123;</span><br><span class="line">      return [&lt;p&gt;default slot&lt;&#x2F;p&gt;];</span><br><span class="line">    &#125;,</span><br><span class="line">    getTitle() &#123;</span><br><span class="line">      return [&lt;p&gt;title slot1&lt;&#x2F;p&gt;, &lt;p&gt;title slot2&lt;&#x2F;p&gt;];</span><br><span class="line">    &#125;,</span><br><span class="line">    getItem(props) &#123;</span><br><span class="line">      return [&lt;p&gt;&#123;&#96;item slot-scope $&#123;JSON.stringify(props)&#125;&#96;&#125;&lt;&#x2F;p&gt;];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123;</span><br><span class="line">      type,</span><br><span class="line">      handlePropChange,</span><br><span class="line">      name,</span><br><span class="line">      handleEventChange,</span><br><span class="line">      bigPropsName,</span><br><span class="line">      getDefault,</span><br><span class="line">      getTitle,</span><br><span class="line">      getItem,</span><br><span class="line">      handleBigPropChange</span><br><span class="line">    &#125; &#x3D; this;</span><br><span class="line">    const slotDemoProps &#x3D; &#123;</span><br><span class="line">      scopedSlots: &#123;</span><br><span class="line">        item(props) &#123;</span><br><span class="line">          return &#96;item slot-scope $&#123;JSON.stringify(props)&#125;&#96;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      props: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    const bigProps &#x3D; &#123;</span><br><span class="line">      props: &#123;</span><br><span class="line">        onChange: handleBigPropChange</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;a-tabs&gt;</span><br><span class="line">          &lt;a-tab-pane key&#x3D;&quot;props&quot; tab&#x3D;&quot;å±æ€§&quot;&gt;</span><br><span class="line">            &lt;Props</span><br><span class="line">              name&#x3D;&quot;Hello Vueï¼&quot;</span><br><span class="line">              type&#x3D;&#123;type&#125;</span><br><span class="line">              isVisible&#x3D;&#123;false&#125;</span><br><span class="line">              &#123;...&#123; props: &#123; onChange: handlePropChange &#125; &#125;&#125;</span><br><span class="line">              title&#x3D;&quot;å±æ€§Demo&quot;</span><br><span class="line">              class&#x3D;&quot;test1&quot;</span><br><span class="line">              class&#x3D;&#123;[&quot;test1&quot;, &quot;test2&quot;]&#125;</span><br><span class="line">              style&#x3D;&#123;&#123; marginTop: &quot;10px&quot; &#125;&#125;</span><br><span class="line">            &#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;a-tab-pane&gt;</span><br><span class="line">          &lt;a-tab-pane key&#x3D;&quot;event&quot; tab&#x3D;&quot;äº‹ä»¶&quot;&gt;</span><br><span class="line">            &lt;Event name&#x3D;&#123;name&#125; onChange&#x3D;&#123;handleEventChange&#125; &#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;a-tab-pane&gt;</span><br><span class="line">          &lt;a-tab-pane key&#x3D;&quot;slot&quot; tab&#x3D;&quot;æ’æ§½&quot;&gt;</span><br><span class="line">            &lt;SlotDemo &#123;...slotDemoProps&#125;&gt;</span><br><span class="line">              &lt;p&gt;default slot&lt;&#x2F;p&gt;</span><br><span class="line">              &lt;p slot&#x3D;&quot;title&quot;&gt;title slot1&lt;&#x2F;p&gt;</span><br><span class="line">              &lt;p slot&#x3D;&quot;title&quot;&gt;title slot2&lt;&#x2F;p&gt;</span><br><span class="line">            &lt;&#x2F;SlotDemo&gt;</span><br><span class="line">          &lt;&#x2F;a-tab-pane&gt;</span><br><span class="line">          &lt;a-tab-pane key&#x3D;&quot;bigProps&quot; tab&#x3D;&quot;å¤§å±æ€§&quot;&gt;</span><br><span class="line">            &lt;BigProps</span><br><span class="line">              name&#x3D;&#123;bigPropsName&#125;</span><br><span class="line">              &#123;...bigProps&#125;</span><br><span class="line">              slotDefault&#x3D;&#123;getDefault()&#125;</span><br><span class="line">              slotTitle&#x3D;&#123;getTitle()&#125;</span><br><span class="line">              slotScopeItem&#x3D;&#123;getItem&#125;</span><br><span class="line">            &#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;a-tab-pane&gt;</span><br><span class="line">        &lt;&#x2F;a-tabs&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; bigProps</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;BigProps&quot;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    VNodes: &#123;</span><br><span class="line">      functional: true,</span><br><span class="line">      render: (h, ctx) &#x3D;&gt; ctx.props.vnodes</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: String,</span><br><span class="line">    onChange: &#123;</span><br><span class="line">      type: Function,</span><br><span class="line">      default: () &#x3D;&gt; &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    slotDefault: Array,</span><br><span class="line">    slotTitle: Array,</span><br><span class="line">    slotScopeItem: &#123;</span><br><span class="line">      type: Function,</span><br><span class="line">      default: () &#x3D;&gt; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleChange() &#123;</span><br><span class="line">      this.onChange(&quot;Hello vue!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; name, handleChange, slotDefault, slotTitle, slotScopeItem &#125; &#x3D; this;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;name&#125;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        &lt;button onClick&#x3D;&#123;handleChange&#125;&gt;change name&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        &#123;slotDefault&#125;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        &#123;slotTitle&#125;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        &#123;slotScopeItem(&#123; value: &quot;vue&quot; &#125;)&#125;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; Events.vue</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;EventDemo&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: String</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleChange(e) &#123;</span><br><span class="line">      this.$emit(&quot;change&quot;, e.target.value);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleDivClick() &#123;</span><br><span class="line">      this.$emit(&quot;change&quot;, &quot;&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleClick(e, stop) &#123;</span><br><span class="line">      console.log(&quot;stop&quot;, stop);</span><br><span class="line">      if (stop) &#123;</span><br><span class="line">        e.stopPropagation();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; name, handleChange, handleDivClick, handleClick &#125; &#x3D; this;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        name: &#123;name || &quot;--&quot;&#125;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        &lt;input value&#x3D;&#123;name&#125; onChange&#x3D;&#123;handleChange&#125; &#x2F;&gt;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        &lt;div onClick&#x3D;&#123;handleDivClick&#125;&gt;</span><br><span class="line">          &lt;button onClick&#x3D;&#123;handleClick&#125;&gt;é‡ç½®æˆåŠŸ&lt;&#x2F;button&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">          &lt;button onClick&#x3D;&#123;e &#x3D;&gt; handleClick(e, true)&#125;&gt;é‡ç½®å¤±è´¥&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; Props.vue</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;PropsDemo&quot;,</span><br><span class="line">  &#x2F;&#x2F; inheritAttrs: false,</span><br><span class="line">  &#x2F;&#x2F; props: [&#39;name&#39;, &#39;type&#39;, &#39;list&#39;, &#39;isVisible&#39;],</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: String,</span><br><span class="line">    type: &#123;</span><br><span class="line">      validator: function(value) &#123;</span><br><span class="line">        &#x2F;&#x2F; è¿™ä¸ªå€¼å¿…é¡»åŒ¹é…ä¸‹åˆ—å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ª</span><br><span class="line">        return [&quot;success&quot;, &quot;warning&quot;, &quot;danger&quot;].includes(value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    list: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      &#x2F;&#x2F; å¯¹è±¡æˆ–æ•°ç»„é»˜è®¤å€¼å¿…é¡»ä»ä¸€ä¸ªå·¥å‚å‡½æ•°è·å–</span><br><span class="line">      default: () &#x3D;&gt; []</span><br><span class="line">    &#125;,</span><br><span class="line">    isVisible: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    onChange: &#123;</span><br><span class="line">      type: Function,</span><br><span class="line">      default: () &#x3D;&gt; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick() &#123;</span><br><span class="line">      &#x2F;&#x2F; ä¸è¦è¿™ä¹ˆåšã€ä¸è¦è¿™ä¹ˆåšã€ä¸è¦è¿™ä¹ˆåš</span><br><span class="line">      &#x2F;&#x2F;this.type &#x3D; &quot;warning&quot;;</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; å¯ä»¥ï¼Œè¿˜å¯ä»¥æ›´å¥½</span><br><span class="line">      this.onChange(this.type &#x3D;&#x3D;&#x3D; &quot;success&quot; ? &quot;warning&quot; : &quot;success&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; name, type, list, isVisible, handleClick &#125; &#x3D; this;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        name: &#123;name&#125;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        type: &#123;type&#125;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        list: &#123;list&#125;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        isVisible: &#123;isVisible&#125;</span><br><span class="line">        &lt;br &#x2F;&gt;</span><br><span class="line">        &lt;button onClick&#x3D;&#123;handleClick&#125;&gt;change type&lt;&#x2F;button&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; Slot</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;SlotDemo&quot;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; $scopedSlots &#125; &#x3D; this;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;$scopedSlots.default()&#125;</span><br><span class="line">        &#123;$scopedSlots.title()&#125;</span><br><span class="line">        &#123;$scopedSlots.item(&#123; value: &quot;vue&quot; &#125;)&#125;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰çœ‹èµ·æ¥è¿˜æ˜¯æ²¡æœ‰reactçš„é¡ºçœ¼</p><h3 id="åŸºäºç±»reactçš„ç¼–ç æ ¼å¼"><a href="#åŸºäºç±»reactçš„ç¼–ç æ ¼å¼" class="headerlink" title="åŸºäºç±»reactçš„ç¼–ç æ ¼å¼ **"></a>åŸºäºç±»reactçš„ç¼–ç æ ¼å¼ **</h3><p><a href="https://cn.vuejs.org/v2/guide/typescript.html#%E5%9F%BA%E4%BA%8E%E7%B1%BB%E7%9A%84-Vue-%E7%BB%84%E4%BB%B6" target="_blank" rel="noopener">åŸºäºç±»çš„Vueç»„ä»¶</a></p><p>å¦‚æœæ‚¨åœ¨å£°æ˜ç»„ä»¶æ—¶æ›´å–œæ¬¢åŸºäºç±»çš„ APIï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®˜æ–¹ç»´æŠ¤çš„ <code>vue-class-component</code> è£…é¥°å™¨</p><p><code>vue-property-decorator</code> æ˜¯ä¸€ä¸ªéå®˜æ–¹åº“ï¼Œæ˜¯ <code>vue-class-component</code> çš„å¾ˆå¥½çš„è¡¥å……ã€‚å®ƒå¯ä»¥è®©<code>vue</code>çš„æŸäº›å±æ€§å’Œæ–¹æ³•ï¼Œé€šè¿‡ä¿®é¥°å™¨çš„å†™æ³•è®©å®ƒä¹Ÿå†™åˆ°<code>vue</code>ç»„ä»¶å®ä¾‹çš„ç±»é‡Œé¢ã€‚</p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">@Component (å®Œå…¨ç»§æ‰¿äºvue-class-component)</span><br><span class="line">@Emit</span><br><span class="line">@Inject</span><br><span class="line">@Provice    </span><br><span class="line">@Prop</span><br><span class="line">@Watch</span><br><span class="line">@Model</span><br><span class="line">Mixins (ç»§æ‰¿vue-class-componentä¸­çš„mixins)</span><br></pre></td></tr></table></figure><h4 id="ç±»å†™çš„JSX"><a href="#ç±»å†™çš„JSX" class="headerlink" title="ç±»å†™çš„JSX"></a>ç±»å†™çš„JSX</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// import Vue from 'vue'</span></span><br><span class="line"><span class="comment">// import Component from 'vue-class-component'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;Component, Vue&#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// @Component ä¿®é¥°ç¬¦æ³¨æ˜äº†æ­¤ç±»ä¸ºä¸€ä¸ª Vue ç»„ä»¶</span></span><br><span class="line">@Component(&#123;</span><br><span class="line">  <span class="comment">// æ‰€æœ‰çš„ç»„ä»¶é€‰é¡¹éƒ½å¯ä»¥æ”¾åœ¨è¿™é‡Œ,å»ºè®®ç›´æ¥å†™åœ¨renderé‡Œé¢</span></span><br><span class="line">  template: <span class="string">'&lt;button @click="onClick"&gt;Click!&lt;/button&gt;'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åˆå§‹æ•°æ®å¯ä»¥ç›´æ¥å£°æ˜ä¸ºå®ä¾‹çš„å±æ€§ data()&#123;return&#123;&#125;&#125;</span></span><br><span class="line">  private message: string = <span class="string">'Hello!'</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// computed</span></span><br><span class="line">  <span class="keyword">get</span> subMessage(): string &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`boy <span class="subst">$&#123;<span class="keyword">this</span>.message&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">  mounted () &#123;</span><br><span class="line">      <span class="keyword">this</span>.greet()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç»„ä»¶æ–¹æ³•ä¹Ÿå¯ä»¥ç›´æ¥å£°æ˜ä¸ºå®ä¾‹çš„æ–¹æ³•</span></span><br><span class="line">  public onClick (): <span class="keyword">void</span> &#123;</span><br><span class="line">     <span class="built_in">window</span>.alert(<span class="keyword">this</span>.message)</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="comment">// è¿™é‡Œå¯ä»¥ä»£æ›¿è£…é¥°å™¨é‡Œé¢çš„template,é‡‡ç”¨çš„jsxçš„ç¼–ç æ–¹å¼</span></span><br><span class="line"> <span class="comment">//  public render() &#123;</span></span><br><span class="line"> <span class="comment">//    const &#123;onClick,message&#125; = this;</span></span><br><span class="line"> <span class="comment">//    return (&lt;button @click="onClick"&gt;Click!&lt;/button&gt;)</span></span><br><span class="line"> <span class="comment">//  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ å£°æ˜æ–‡ä»¶"><a href="#æ·»åŠ å£°æ˜æ–‡ä»¶" class="headerlink" title="æ·»åŠ å£°æ˜æ–‡ä»¶"></a>æ·»åŠ å£°æ˜æ–‡ä»¶</h4><p>æˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šè‡ªå®šä¹‰ä¸€äº›å…¨å±€çš„æŒ‡ä»¤æˆ–è€…ä¸€äº›çš„æ–¹æ³•ç­‰ç­‰ï¼Œå¦‚æœä¸æ·»åŠ å£°æ˜çš„è¯ï¼Œå¯èƒ½éœ€è¦æ¯ä¸€ä¸ªéƒ½<code>// @ts-ignore</code>,ç”šè‡³æœ‰çš„æŠ¥é”™ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; main.js</span><br><span class="line">&#x2F;&#x2F; æ·»åŠ ä¸€ä¸ªå…¨å±€çš„æ–¹æ³•</span><br><span class="line">Vue.prototype.$fetch &#x3D; function (url) &#123;</span><br><span class="line">  return fetch(url).then(e &#x3D;&gt; e.json()).then(val &#x3D;&gt; &#123;</span><br><span class="line">    return val</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; tsconfig.json</span><br><span class="line">&#123;</span><br><span class="line">   &quot;compilerOptions&quot;: &#123;</span><br><span class="line">      &#x2F;&#x2F; ...</span><br><span class="line">      &quot;typeRoots&quot;: [</span><br><span class="line">   &quot;node_modules&#x2F;@types&quot;,</span><br><span class="line">   &quot;src&#x2F;type&#x2F;global.d.ts&quot;</span><br><span class="line">      ]</span><br><span class="line">      &#x2F;&#x2F; ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; global.d.ts</span><br><span class="line">import Vue from &#39;vue&#39;  &#x2F;&#x2F; å¿…é¡»æ·»åŠ å¦åˆ™æ— æ•ˆ</span><br><span class="line"></span><br><span class="line">declare module &#39;vue&#x2F;types&#x2F;vue&#39; &#123;</span><br><span class="line">    &#x2F;&#x2F; åœ¨å®ä¾‹ä¸Šçš„å±æ€§</span><br><span class="line">    interface Vue &#123;</span><br><span class="line">        $fetch: string</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; ä½¿ç”¨ &#96;VueConstructor&#96; æ¥å£</span><br><span class="line">    &#x2F;&#x2F; å£°æ˜å…¨å±€å±æ€§</span><br><span class="line">    interface VueConstructor &#123;</span><br><span class="line">      $myGlobal: string</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare module &#39;vue&#x2F;types&#x2F;options&#39; &#123;</span><br><span class="line"></span><br><span class="line">  interface ComponentOptions&lt;V extends Vue&gt; &#123;</span><br><span class="line">    myOption?: string  &#x2F;&#x2F; é¢å¤–çš„ç»„ä»¶é€‰é¡¹</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ä½¿ç”¨</span><br><span class="line">vm.$fetch()</span><br><span class="line">Vue.$myGlobal</span><br><span class="line">var vm &#x3D; new Vue(&#123;</span><br><span class="line">  myOption: &#39;Hello&#39;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-Mixins"><a href="#ä½¿ç”¨-Mixins" class="headerlink" title="ä½¿ç”¨ Mixins"></a>ä½¿ç”¨ Mixins</h4><p><a href="/workspace/Frame/vue/vue.html#mixins">templateçš„å£°æ˜æ–¹å¼</a></p><p>å£°æ˜ mixin çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// assets/mixins/mixin.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Component <span class="keyword">from</span> <span class="string">'vue-class-component'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ å¯ä»¥æƒ³å£°æ˜ä¸€ä¸ªç»„ä»¶ä¸€æ ·å£°æ˜ä¸€ä¸ª mixin</span></span><br><span class="line">@Component</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixin</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è¿™ä¸ªé‡Œé¢å¯ä»¥æŠ½ç¦»ä¸€äº›å…¬å…±é€»è¾‘</span></span><br><span class="line">  mixinValue = <span class="string">'Hello'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// import Component, &#123; mixins &#125; from 'vue-class-component'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Component, Mixins&#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="keyword">import</span> MyMixin <span class="keyword">from</span> <span class="string">'@/assets/mixins/mixin'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ `mixins` å¸®åŠ©å‡½æ•°ï¼Œè€Œä¸æ˜¯ `Vue`.</span></span><br><span class="line"><span class="comment">// `mixins` å¯ä»¥è·å–ä»»ä½•æ•°é‡çš„å‚æ•°</span></span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComp</span> <span class="keyword">extends</span> <span class="title">Mixins</span>(<span class="title">MyMixin</span>) </span>&#123;</span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.mixinValue) <span class="comment">// -&gt; Hello</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰ä¿®é¥°å™¨"><a href="#è‡ªå®šä¹‰ä¿®é¥°å™¨" class="headerlink" title="è‡ªå®šä¹‰ä¿®é¥°å™¨"></a>è‡ªå®šä¹‰ä¿®é¥°å™¨</h4><p><code>vue-class-component</code> æä¾› <code>createDecorator</code> å¸®åŠ©å‡½æ•°ç”¨æ¥åˆ›å»ºè‡ªå®šä¹‰ä¿®é¥°å™¨ã€‚</p><p><code>createDecorator</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–ä¸€ä¸‹å‚æ•°ï¼š</p><p><code>options</code>: vue ç»„ä»¶é€‰é¡¹ç»„æˆçš„å¯¹è±¡ï¼Œæ”¹å˜è¿™äº›é€‰é¡¹ä¼šå½±å“æ‰€æä¾›çš„ç»„ä»¶<br/><br><code>key</code>: ä¿®é¥°å™¨æ‰€ä½œä¸ºçš„å±æ€§æˆ–æ–¹æ³•çš„ key<br/><br><code>parameterIndex</code>: ä¿®é¥°å™¨ä½œç”¨äºå‚æ•°æ—¶ï¼Œè¿™ä¸ªå‚æ•°çš„ç´¢å¼•<br/></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; decorators.js</span><br><span class="line">import &#123; createDecorator &#125; from &#39;vue-class-component&#39;</span><br><span class="line"></span><br><span class="line">export const NoCache &#x3D; createDecorator((options, key) &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; ç»„ä»¶çš„é€‰é¡¹åº”è¯¥ä¼ ç»™å›è°ƒå‡½æ•°ï¼ŒåŒæ—¶ä¼šæ›´æ–°é€‰é¡¹å¯¹è±¡ï¼ˆoptions objectï¼‰</span><br><span class="line">  &#x2F;&#x2F; è¿›è€Œä½œç”¨äºç»„ä»¶</span><br><span class="line">  options.computed[key].cache &#x3D; false</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; NoCache &#125; from &#39;.&#x2F;decorators&#39;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">class MyComp extends Vue &#123;</span><br><span class="line">  &#x2F;&#x2F; è¿™ä¸ªè®¡ç®—å±æ€§ä¸ä¼šè¢«ç¼“å­˜</span><br><span class="line">  @NoCache</span><br><span class="line">  get random () &#123;</span><br><span class="line">    return Math.random()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ è‡ªå®šä¹‰é’©å­"><a href="#æ·»åŠ è‡ªå®šä¹‰é’©å­" class="headerlink" title="æ·»åŠ è‡ªå®šä¹‰é’©å­"></a>æ·»åŠ è‡ªå®šä¹‰é’©å­</h4><p>å¦‚æœä½ ä½¿ç”¨äº†ä¸€äº›Vue æ’ä»¶æ¯”å¦‚ Vue Routerï¼Œä½ å¯èƒ½ä¼šå¸Œæœ› class ç»„ä»¶è§£æå®ƒä»¬æ‰€æä¾›çš„é’©å­ï¼Œ <code>Component.registerHooks</code> å°±å…è®¸ä½ æ³¨å†Œè¿™äº›é’©å­</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class-component-hooks.js</span></span><br><span class="line"><span class="keyword">import</span> Component <span class="keyword">from</span> <span class="string">'vue-class-component'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡è¿™äº›é’©å­çš„åç§°æ¥æ³¨å†Œå®ƒä»¬</span></span><br><span class="line">Component.registerHooks([</span><br><span class="line">  <span class="string">'beforeRouteEnter'</span>,</span><br><span class="line">  <span class="string">'beforeRouteLeave'</span>,</span><br><span class="line">  <span class="string">'beforeRouteUpdate'</span> <span class="comment">// for vue-router 2.2+</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MyComp.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Component <span class="keyword">from</span> <span class="string">'vue-class-component'</span></span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComp</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="comment">// class ç»„ä»¶ç°åœ¨å¯ä»¥å¤„ç† beforeRouteEnter é’©å­å’Œ </span></span><br><span class="line">  <span class="comment">// beforeRouteLeave é’©å­ä½œä¸º Vue Router é’©å­</span></span><br><span class="line">  beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'beforeRouteEnter'</span>)</span><br><span class="line">    next() <span class="comment">// éœ€è¦è°ƒç”¨è¿™ä¸ªæ¥ç¡®è®¤å¯¼èˆª</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'beforeRouteLeave'</span>)</span><br><span class="line">    next() <span class="comment">// éœ€è¦è°ƒç”¨è¿™ä¸ªæ¥ç¡®è®¤å¯¼èˆª</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½ å¿…é¡»åœ¨ç»„ä»¶å®šä¹‰ä¹‹å‰æ³¨å†Œé’©å­</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®ä¿åœ¨å¼•å…¥ä»»ä½•ç»„ä»¶ä¹‹å‰æ³¨å†Œ</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./class-component-hooks'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> MyComp <span class="keyword">from</span> <span class="string">'./MyComp'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    MyComp</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™ç§ä¹ä¸€çœ‹è·Ÿreactçš„ç¼–ç æ ¼å¼å¾ˆåƒï¼Œä½†æ˜¯ä»£ç å‹ç¼©åæ–‡ä»¶å¤ªå¤§ï¼Œ<br>è€Œä¸”vueçš„ç‰ˆæœ¬è¿­ä»£é€Ÿåº¦å¾ˆå¿«ï¼Œvue3å·²ç»ä¸æ¨å´‡è¿™ç§å†™æ³•äº†ï¼Œvue3æ¨å´‡ä½¿ç”¨å‡½æ•°å¼å¼€å‘ï¼Œå¯¹reactçš„ç”¨æˆ·å¾ˆæ˜¯å‹å¥½</p><h3 id="vue-property-decorator"><a href="#vue-property-decorator" class="headerlink" title="vue-property-decorator"></a>vue-property-decorator</h3><p><code>vue-property-decorator</code> æ˜¯ä¸€ä¸ªéå®˜æ–¹åº“ï¼Œæ˜¯ <code>vue-class-component</code> çš„å¾ˆå¥½çš„è¡¥å……ã€‚å®ƒå¯ä»¥è®©<code>vue</code>çš„æŸäº›å±æ€§å’Œæ–¹æ³•ï¼Œé€šè¿‡ä¿®é¥°å™¨çš„å†™æ³•è®©å®ƒä¹Ÿå†™åˆ°<code>vue</code>ç»„ä»¶å®ä¾‹çš„ç±»é‡Œé¢ã€‚</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> (å®Œå…¨ç»§æ‰¿äºvue-<span class="keyword">class</span>-component)</span><br><span class="line"><span class="meta">@Emit</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Provice</span></span><br><span class="line"><span class="meta">@Prop</span></span><br><span class="line"><span class="meta">@Watch</span></span><br><span class="line"><span class="meta">@Model</span></span><br><span class="line">Mixins (ç»§æ‰¿vue-<span class="keyword">class</span>-componentä¸­çš„mixins)</span><br></pre></td></tr></table></figure><h4 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h4><p>@Component ä¿®é¥°ç¬¦æ³¨æ˜äº†æ­¤ç±»ä¸ºä¸€ä¸ª Vue ç»„ä»¶</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  name: <span class="string">'A'</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    B</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// æ‰€æœ‰çš„ç»„ä»¶é€‰é¡¹éƒ½å¯ä»¥æ”¾åœ¨è¿™é‡Œ,å»ºè®®ç›´æ¥å†™åœ¨renderé‡Œé¢</span></span><br><span class="line">  template: <span class="string">'&lt;button @click="onClick"&gt;Click!&lt;/button&gt;'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Props"><a href="#Props" class="headerlink" title="@Props"></a>@Props</h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Prop</span>(&#123;<span class="keyword">default</span>: <span class="string">'é»˜è®¤çš„title'</span>, <span class="keyword">type</span>: [<span class="built_in">String</span>, <span class="built_in">Number</span>]&#125;) <span class="keyword">public</span> readonly title!: <span class="built_in">string</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ <code>!æ˜¯å¿…é€‰çš„</code>  <code>?å¯é€‰å‚æ•°</code>, !å‘Šè¯‰TypeScriptæˆ‘è¿™é‡Œä¸€å®šæœ‰å€¼,å®è·µæ„Ÿè§‰å¹¶æ²¡æœ‰tsçš„ç±»å‹æ£€éªŒï¼Œä»…ä»…ç¼–è¾‘å™¨æœ‰æç¤ºï¼Œä»£ç æ­£å¸¸è¿è¡Œ</p><p>ä¸‹é¢è¿™ç§å†™æ³•ï¼Œèƒ½å°‘ç”¨@Prop,æˆ‘çš„ä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­å¿…é¡»æ˜¯<code>x-xx</code>,ç±»å‹çš„ï¼Œåœ¨å­ç»„ä»¶<code>xXx</code>ï¼Œå³å¯ä½¿ç”¨ï¼Œä¸ç„¶æ²¡åŠæ³•æ‰“åŒ…ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç»„ä»¶</span></span><br><span class="line">&lt;Child</span><br><span class="line">     z-context=&#123;&#123;</span><br><span class="line">        title: message,</span><br><span class="line">        changeTitle: <span class="function">(<span class="params">val: <span class="built_in">string</span></span>) =&gt;</span> <span class="keyword">this</span>.state.message = val  <span class="comment">// è¿™é‡Œåªèƒ½æ˜¯this.state.messageï¼Œä¸èƒ½ç›´æ¥ message = valï¼Œé»˜è®¤æ˜¯åªè¯»å±æ€§</span></span><br><span class="line">    &#125;&#125;</span><br><span class="line">/&gt;</span><br><span class="line"><span class="comment">// å­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">interface</span> IProps &#123;</span><br><span class="line">    changeTitle: <span class="function">(<span class="params">val: <span class="built_in">string</span></span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">    title: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Prop</span>(&#123;<span class="keyword">default</span>: &#123;&#125;, <span class="keyword">type</span>: <span class="built_in">Object</span>&#125;) zContext: IProps; <span class="comment">// è¿™æ ·tsæœ‰ç±»å‹æ£€éªŒ,ä½†æ˜¯çˆ¶çº§çš„ç±»å‹æ£€æµ‹ä¸å‡ºæ¥</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;title,changeTitle&#125; = <span class="keyword">this</span>.zContext;</span><br><span class="line">changeTitle(<span class="string">'åªèƒ½æ˜¯å­—ç¬¦ä¸²'</span>)</span><br></pre></td></tr></table></figure><h4 id="Watch"><a href="#Watch" class="headerlink" title="@Watch"></a>@Watch</h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Watch</span>(<span class="string">'message'</span>, &#123;immediate: <span class="literal">true</span>, deep: <span class="literal">false</span>&#125;)</span><br><span class="line"><span class="comment">// ä¸Šé¢çš„è£…é¥°å™¨ï¼Œå°±æ˜¯æ£€æµ‹ä¸‹é¢è¿™ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> onMsgChane(val: <span class="built_in">string</span>, oldVal: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'onMsgChane'</span>, val, oldVal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mixins"><a href="#Mixins" class="headerlink" title="Mixins"></a>Mixins</h4><p>åœ¨ä½¿ç”¨<code>Vue</code>è¿›è¡Œå¼€å‘æ—¶æˆ‘ä»¬ç»å¸¸è¦ç”¨åˆ°æ··åˆ,ç»“åˆ<code>TypeScript</code>ä¹‹åæˆ‘ä»¬æœ‰ä¸¤ç§<code>mixins</code>çš„æ–¹æ³•</p><p><strong>ä¸€ç§æ˜¯vue-class-componentæä¾›çš„</strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰è¦æ··åˆçš„ç±» mixins.ts</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span>  Component  <span class="keyword">from</span> <span class="string">'vue-class-component'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">// ä¸€å®šè¦ç”¨Componentä¿®é¥°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> myMixins <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    value: <span class="built_in">string</span> = <span class="string">"Hello"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span>  Component  &#123;mixins&#125;  <span class="keyword">from</span> <span class="string">'vue-class-component'</span>;</span><br><span class="line"><span class="keyword">import</span> myMixins <span class="keyword">from</span> <span class="string">'mixins.ts'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> myComponent <span class="keyword">extends</span> mixins(myMixins) &#123;</span><br><span class="line">                          <span class="comment">// ç›´æ¥extends myMinxins ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œ</span></span><br><span class="line">      created()&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="keyword">this</span>.value) <span class="comment">// =&gt; Hello</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒç§æ–¹å¼æ˜¯åœ¨@Componentä¸­æ··å…¥</strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mixins.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Vue, Component &#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="comment">// è¿™é‡Œæ˜¯tsçš„ç±»å‹å£°æ˜ï¼Œå»ºè®®ç›´æ¥å†™åœ¨ type/global.d.ts</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> 'vue/types/vue' &#123;</span><br><span class="line">    <span class="keyword">interface</span> Vue &#123;</span><br><span class="line">        value: <span class="built_in">string</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> myMixins <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    value: <span class="built_in">string</span> = <span class="string">'Hello'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Vue, Component, Prop &#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="keyword">import</span> myMixins <span class="keyword">from</span> <span class="string">'mixins.ts'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    mixins: [myMixins]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> myComponent <span class="keyword">extends</span> Vue&#123;</span><br><span class="line">    created()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.value) <span class="comment">// =&gt; Hello</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨JSXé‡åˆ°çš„å‘"><a href="#ä½¿ç”¨JSXé‡åˆ°çš„å‘" class="headerlink" title="ä½¿ç”¨JSXé‡åˆ°çš„å‘"></a>ä½¿ç”¨JSXé‡åˆ°çš„å‘</h3><ul><li>åœ¨ä½¿ç”¨uiæ¡†æ¶çš„æ—¶å€™ï¼Œ@éƒ½ç”¨ on- ä»£æ›¿</li><li>el-popconfirm åœ¨ table é‡Œé¢ä¸èƒ½ç›´æ¥ä½¿ç”¨<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// åœ¨tableé‡Œé¢ä¸èƒ½ç›´æ¥ä½¿ç”¨</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-popconfirm</span></span></span><br><span class="line"><span class="tag">  <span class="attr">title</span>=<span class="string">"è¿™æ˜¯ä¸€æ®µå†…å®¹ç¡®å®šåˆ é™¤å—ï¼Ÿ"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">slot</span>=<span class="string">"reference"</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-popconfirm</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">// è¿™ç§å¯ä»¥</span><br><span class="line"><span class="tag">&lt;<span class="name">el-popconfirm</span></span></span><br><span class="line"><span class="tag">   <span class="attr">icon</span>=<span class="string">"el-icon-info"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">iconColor</span>=<span class="string">"red"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">title</span>=<span class="string">"ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">onConfirm</span>=<span class="string">"handelCancel"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">onCancel</span>=<span class="string">"handelCancel"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">scopedSlots</span>=<span class="string">&#123;&#123;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">reference:</span> <span class="attr">props</span> =&gt;</span> &#123;</span><br><span class="line">            console.log(props);</span><br><span class="line">            return (</span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">solt</span>=<span class="string">&#123;</span>'<span class="attr">reference</span>'&#125; <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"medium"</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tableè·å–è¡Œçš„æ•°æ®</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&lt;el-table-column</span><br><span class="line">  fixed=<span class="string">"right"</span></span><br><span class="line">  label=<span class="string">"æ“ä½œ"</span></span><br><span class="line">  width=<span class="string">"100"</span>&gt;</span><br><span class="line">  &lt;template slot-scope=<span class="string">"scope"</span>&gt;</span><br><span class="line">    &lt;el-button @click=<span class="string">"handleClick(scope.row)"</span> type=<span class="string">"text"</span> size=<span class="string">"small"</span>&gt;æŸ¥çœ‹&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>template&gt;</span><br><span class="line">&lt;<span class="regexp">/el-table-column&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">&lt;el-table-column</span></span><br><span class="line"><span class="regexp">   prop="edit"</span></span><br><span class="line"><span class="regexp">   label="æ“ä½œ"</span></span><br><span class="line"><span class="regexp">   fixed="right"</span></span><br><span class="line"><span class="regexp">   width="180"</span></span><br><span class="line"><span class="regexp">   scopedSlots=&#123;&#123;</span></span><br><span class="line"><span class="regexp">       default: (&#123;$index, row&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">       return (/</span><span class="regexp">/...)</span></span><br><span class="line"><span class="regexp">       &#125;</span></span><br><span class="line"><span class="regexp">   &#125;&#125;</span></span><br><span class="line"><span class="regexp">/</span>&gt;</span><br></pre></td></tr></table></figure><ul><li>ç”¨from</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;el-form :model=<span class="string">"form"</span>&gt;&lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;el-form props=&#123;&#123;model: this.formPass&#125;&#125;    /</span><span class="regexp">/ è¿™é‡Œä¸èƒ½ç›´æ¥ä½¿ç”¨model   rulesé‡Œé¢æ‹¿ä¸åˆ°value,æœ€åä¸èƒ½æ ¡éªŒ</span></span><br><span class="line"><span class="regexp">        label-position=&#123;'left'&#125;</span></span><br><span class="line"><span class="regexp">        ref=&#123;'formData'&#125;</span></span><br><span class="line"><span class="regexp">        label-width=&#123;'100px'&#125;</span></span><br><span class="line"><span class="regexp">        rules=&#123;this.rules&#125;&gt;</span></span><br><span class="line"><span class="regexp">  &lt;el-input  autocomplete="off"&gt;&lt;/</span>el-input&gt;</span><br><span class="line">&lt;<span class="regexp">/el-form&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>v-modelä¸èƒ½ä½¿ç”¨è§£æ„å‡ºæ¥çš„ï¼Œè§£æ„é»˜è®¤æ˜¯åªè¯»å±æ€§çš„</p></li><li><p>ç®­å¤´å‡½æ•°æ…ç”¨ï¼Œå½“å‰çš„thisæ˜¯ç±»çš„å®ä¾‹ï¼Œtempä¸­çš„thisæ˜¯Vueçš„å®ä¾‹, ï¼ˆå¯ä½¿ç”¨bindè§£å†³ä¼ å€¼ï¼‰</p></li><li><p>tsxå†™çš„ç»„ä»¶ï¼Œä¼ é€’æ€§éœ€è¦æ˜¯ x-xxx å¦‚ zy-props={}</p><ul><li>tsxå¼•å…¥tsxï¼Œå¦‚æœä¸ä½¿ç”¨@Componentè£…é¥°å™¨çš„è¯ï¼Œï¼ˆPascalCaseï¼‰ä¼ é€’æ€§éœ€è¦æ˜¯ x-xxx å¦‚ zy-props={}ï¼Œå¤§é©¼å³°ï¼Œä½¿ç”¨@Componentæ­£å¸¸ï¼ˆkebab-caseï¼‰</li><li>tsxå¼•å…¥.vueçš„ï¼Œå¦‚æœä¸ä½¿ç”¨@Componentè£…é¥°å™¨çš„è¯ï¼Œé»˜è®¤å¼€å‘ç¯å¢ƒæ˜¯æ²¡äº‹çš„ï¼Œæ‰“åŒ…æŠ¥é”™ï¼Œä½¿ç”¨@Componentæ­£å¸¸ </li></ul></li><li><p>ä¸€äº›äº‹ä»¶ï¼Œåœ¨tsxä¸­ä¸èƒ½ç›´æ¥ç”¨v-model,éœ€è¦ç”¨onChangeæ–¹æ³•è·å–å€¼</p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  v-model="formData.roleId"</span></span><br><span class="line">&lt;el-select value=&#123;<span class="keyword">this</span>.formData.roleId&#125; onChange=&#123;<span class="keyword">this</span>.setSelect&#125; size=<span class="string">"small"</span>&gt;</span><br><span class="line">    &#123;roles.map(<span class="function">(<span class="params">item: any</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;el-option</span><br><span class="line">                key=&#123;item.roleId&#125;</span><br><span class="line">                label=&#123;item.roleId + <span class="string">'-'</span> + item.roleName&#125;</span><br><span class="line">                value=&#123;item.roleId&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;)&#125;</span><br><span class="line">&lt;<span class="regexp">/el-select&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://juejin.im/post/5d7e662e6fb9a06b1f1460c2" target="_blank" rel="noopener">https://juejin.im/post/5d7e662e6fb9a06b1f1460c2</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> è°ƒç ”JSX </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é—®é¢˜éªŒè¯è§£æ</title>
      <link href="/2020/02/17/workspace/Frame/vue/problem/"/>
      <url>/2020/02/17/workspace/Frame/vue/problem/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>é—®é¢˜éªŒè¯è§£æ</strong></p><p>[[toc]]</p><h3 id="vueä¸­ç»„ä»¶çš„dataä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå‡½æ•°"><a href="#vueä¸­ç»„ä»¶çš„dataä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå‡½æ•°" class="headerlink" title="vueä¸­ç»„ä»¶çš„dataä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå‡½æ•°"></a>vueä¸­ç»„ä»¶çš„dataä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•ä¸€</span></span><br><span class="line">data () &#123;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">      count:<span class="number">0</span>,</span><br><span class="line">      show:<span class="literal">true</span>,</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒ</span></span><br><span class="line">data: &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    show:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»„ä»¶æ˜¯å¯å¤ç”¨çš„<code>vue</code>å®ä¾‹ï¼Œä¸€ä¸ªç»„ä»¶è¢«åˆ›å»ºå¥½ä¹‹åï¼Œå°±å¯èƒ½è¢«ç”¨åœ¨å„ä¸ªåœ°æ–¹ï¼Œè€Œç»„ä»¶ä¸ç®¡è¢«å¤ç”¨äº†å¤šå°‘æ¬¡ï¼Œ<br>ç»„ä»¶ä¸­çš„<code>data</code>æ•°æ®éƒ½åº”è¯¥æ˜¯<code>ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“</code>çš„ï¼ŒåŸºäºè¿™ä¸€ç†å¿µï¼Œç»„ä»¶æ¯å¤ç”¨ä¸€æ¬¡ï¼Œ<code>data</code>æ•°æ®å°±åº”è¯¥è¢«å¤åˆ¶ä¸€æ¬¡ï¼Œä¹‹åï¼Œ<br>å½“æŸä¸€å¤„å¤ç”¨çš„åœ°æ–¹ç»„ä»¶å†…<code>data</code>æ•°æ®è¢«æ”¹å˜æ—¶ï¼Œå…¶ä»–å¤ç”¨åœ°æ–¹ç»„ä»¶çš„<code>data</code>æ•°æ®ä¸å—å½±å“</p><p><strong>æ–¹æ³•ä¸€</strong> ä¾‹å­ä¸­çš„<code>data</code>ä¸æ˜¯ä¸€ä¸ªå•çº¯çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªå‡½æ•°è¿”å›å€¼çš„å½¢å¼ï¼Œæ‰€ä»¥æ¯ä¸ªç»„ä»¶å®ä¾‹å¯ä»¥ç»´æŠ¤ä¸€ä»½è¢«è¿”å›å¯¹è±¡çš„ç‹¬ç«‹æ‹·è´ï¼Œå¦‚æœæˆ‘ä»¬å°†ä¸Šè¿°ä¾‹å­ä¸­çš„<code>data</code>ä¿®æ”¹ä¸º <strong>æ–¹æ³•äºŒ</strong>ã€‚<br/><br>é‚£ä¹ˆå°±ä¼šé€ æˆæ— è®ºåœ¨å“ªä¸ªç»„ä»¶é‡Œæ”¹å˜äº†<code>count</code>å€¼ï¼Œéƒ½ä¼šå½±å“åˆ°å…¶ä»–ç»„ä»¶é‡Œçš„<code>count</code>ã€‚è¿™æ˜¯å› ä¸ºå½“dataå¦‚æ­¤å®šä¹‰åï¼Œè¿™å°±è¡¨ç¤ºæ‰€æœ‰çš„ç»„ä»¶å®ä¾‹å…±ç”¨äº†ä¸€ä»½<code>data</code>æ•°æ®ï¼Œå› æ­¤ï¼Œæ— è®ºåœ¨å“ªä¸ªç»„ä»¶å®ä¾‹ä¸­ä¿®æ”¹äº†<code>data</code>,éƒ½ä¼šå½±å“åˆ°æ‰€æœ‰çš„ç»„ä»¶å®ä¾‹ã€‚</p><h3 id="v-show-ä¸-v-if-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#v-show-ä¸-v-if-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="v-show ä¸ v-if æœ‰ä»€ä¹ˆåŒºåˆ«"></a>v-show ä¸ v-if æœ‰ä»€ä¹ˆåŒºåˆ«</h3><p><strong>v-if</strong> æ˜¯çœŸæ­£çš„æ¡ä»¶æ¸²æŸ“ï¼Œå› ä¸ºå®ƒä¼šç¡®ä¿åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­æ¡ä»¶å—å†…çš„äº‹ä»¶ç›‘å¬å™¨å’Œå­ç»„ä»¶é€‚å½“åœ°è¢«é”€æ¯å’Œé‡å»ºï¼›<br>ä¹Ÿæ˜¯æƒ°æ€§çš„ï¼šå¦‚æœåœ¨åˆå§‹æ¸²æŸ“æ—¶æ¡ä»¶ä¸ºå‡ï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸åšâ€”â€”ç›´åˆ°æ¡ä»¶ç¬¬ä¸€æ¬¡å˜ä¸ºçœŸæ—¶ï¼Œæ‰ä¼šå¼€å§‹æ¸²æŸ“æ¡ä»¶å—ã€‚<strong>v-if</strong> æœ‰æ›´é«˜çš„åˆ‡æ¢å¼€é”€</p><p><strong>v-show</strong> å°±ç®€å•å¾—å¤šâ€”â€”ä¸ç®¡åˆå§‹æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Œå…ƒç´ æ€»æ˜¯ä¼šè¢«æ¸²æŸ“ï¼Œæ‰€ä»¥æœ‰æ›´é«˜çš„åˆå§‹æ¸²æŸ“å¼€é”€ï¼Œå¹¶ä¸”åªæ˜¯ç®€å•åœ°åŸºäº <strong>CSS çš„ â€˜displayâ€™</strong> å±æ€§è¿›è¡Œåˆ‡æ¢ã€‚<br>é€‚ç”¨äºéœ€è¦éå¸¸é¢‘ç¹åˆ‡æ¢æ¡ä»¶çš„åœºæ™¯</p><h3 id="vue-çš„çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ‰§è¡Œé¡ºåº"><a href="#vue-çš„çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ‰§è¡Œé¡ºåº" class="headerlink" title="vue çš„çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ‰§è¡Œé¡ºåº"></a>vue çš„çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ‰§è¡Œé¡ºåº</h3><ul><li>åŠ è½½æ¸²æŸ“è¿‡ç¨‹<ul><li>çˆ¶ beforeCreate -&gt; çˆ¶ created -&gt; çˆ¶ beforeMount -&gt; å­ beforeCreate -&gt; å­ created -&gt; å­ beforeMount -&gt; å­ mounted -&gt; çˆ¶ mounted</li></ul></li></ul><ul><li>å­ç»„ä»¶æ›´æ–°è¿‡ç¨‹<ul><li>çˆ¶ beforeUpdate -&gt; å­ beforeUpdate -&gt; å­ updated -&gt; çˆ¶ updated</li></ul></li></ul><ul><li>çˆ¶ç»„ä»¶æ›´æ–°è¿‡ç¨‹ <ul><li>çˆ¶ beforeUpdate -&gt; çˆ¶ updated</li></ul></li></ul><ul><li>é”€æ¯è¿‡ç¨‹<ul><li>çˆ¶ beforeDestroy -&gt; å­ beforeDestroy -&gt; å­ destroyed -&gt; çˆ¶ destroyed</li></ul></li></ul><h3 id="vue-é¡¹ç›®è¿›è¡Œå“ªäº›ä¼˜åŒ–"><a href="#vue-é¡¹ç›®è¿›è¡Œå“ªäº›ä¼˜åŒ–" class="headerlink" title="vue é¡¹ç›®è¿›è¡Œå“ªäº›ä¼˜åŒ–"></a>vue é¡¹ç›®è¿›è¡Œå“ªäº›ä¼˜åŒ–</h3><p><strong>ä»£ç å±‚é¢çš„ä¼˜åŒ–</strong></p><ul><li>v-if å’Œ v-show åŒºåˆ†ä½¿ç”¨åœºæ™¯</li><li>computed å’Œ watch  åŒºåˆ†ä½¿ç”¨åœºæ™¯</li><li>v-for éå†å¿…é¡»ä¸º item æ·»åŠ  keyï¼Œä¸”é¿å…åŒæ—¶ä½¿ç”¨ v-if</li><li>é•¿åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–</li><li>äº‹ä»¶çš„é”€æ¯</li><li>å›¾ç‰‡èµ„æºæ‡’åŠ è½½</li><li>è·¯ç”±æ‡’åŠ è½½(æŒ‰éœ€åŠ è½½)</li><li>ç¬¬ä¸‰æ–¹æ’ä»¶çš„æŒ‰éœ€å¼•å…¥</li><li>ä¼˜åŒ–æ— é™åˆ—è¡¨æ€§èƒ½</li><li>æœåŠ¡ç«¯æ¸²æŸ“ SSR or é¢„æ¸²æŸ“</li></ul><p><strong>Webpack å±‚é¢çš„ä¼˜åŒ–</strong></p><ul><li>Webpack å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©</li><li>å‡å°‘ ES6 è½¬ä¸º ES5 çš„å†—ä½™ä»£ç </li><li>æå–å…¬å…±ä»£ç </li><li>æ¨¡æ¿é¢„ç¼–è¯‘</li><li>æå–ç»„ä»¶çš„ CSS</li><li>ä¼˜åŒ– SourceMap</li><li>æ„å»ºç»“æœè¾“å‡ºåˆ†æ</li><li>Vue é¡¹ç›®çš„ç¼–è¯‘ä¼˜åŒ–</li></ul><p><strong>åŸºç¡€çš„ Web æŠ€æœ¯çš„ä¼˜åŒ–</strong></p><ul><li>å¼€å¯ gzip å‹ç¼©</li><li>httpç¼“å­˜</li><li>CDN çš„ä½¿ç”¨</li><li>ä½¿ç”¨ Chrome Performance æŸ¥æ‰¾æ€§èƒ½ç“¶é¢ˆ</li></ul><h3 id="Vue-é‡‡ç”¨æ•°æ®åŠ«æŒçš„æ‰‹æ®µå¯ä»¥ç²¾å‡†æ‹¿åˆ°å˜åŒ–çš„æ•°æ®-ä¸ºä»€ä¹ˆè¿˜éœ€è¦è™šæ‹ŸDOMè¿›â¾diffæ£€æµ‹å·®å¼‚"><a href="#Vue-é‡‡ç”¨æ•°æ®åŠ«æŒçš„æ‰‹æ®µå¯ä»¥ç²¾å‡†æ‹¿åˆ°å˜åŒ–çš„æ•°æ®-ä¸ºä»€ä¹ˆè¿˜éœ€è¦è™šæ‹ŸDOMè¿›â¾diffæ£€æµ‹å·®å¼‚" class="headerlink" title="Vue é‡‡ç”¨æ•°æ®åŠ«æŒçš„æ‰‹æ®µå¯ä»¥ç²¾å‡†æ‹¿åˆ°å˜åŒ–çš„æ•°æ®,ä¸ºä»€ä¹ˆè¿˜éœ€è¦è™šæ‹ŸDOMè¿›â¾diffæ£€æµ‹å·®å¼‚?"></a>Vue é‡‡ç”¨æ•°æ®åŠ«æŒçš„æ‰‹æ®µå¯ä»¥ç²¾å‡†æ‹¿åˆ°å˜åŒ–çš„æ•°æ®,ä¸ºä»€ä¹ˆè¿˜éœ€è¦è™šæ‹ŸDOMè¿›â¾diffæ£€æµ‹å·®å¼‚?</h3><p>ç°åœ¨å‰ç«¯æ¡†æ¶æœ‰ä¸¤ç§æ•°æ®å˜åŠ¨ä¾¦æµ‹æ–¹å¼ï¼Œä¸€ç§æ˜¯pullï¼Œä¸€ç§æ˜¯push.<br>pull çš„ä»£è¡¨æ˜¯React ï¼Œåœ¨è¿›è¡Œ setState æ“ä½œåæ˜¾ç¤ºæ›´æ–°æ•°æ®ï¼ŒReact ä¼šä½¿ç”¨ diff ç®—æ³•ä¸€å±‚å±‚æ‰¾å‡ºå·®å¼‚ï¼Œç„¶å patch åˆ° DOM æ ‘ä¸Šï¼ŒReact ä¸€å¼€å§‹ä¸çŸ¥é“é‚£é‡Œå˜åŒ–äº†ï¼Œåªæ˜¯çŸ¥é“å˜åŒ–äº†ï¼Œç„¶åæš´åŠ›è¿›è¡ŒæŸ¥æ‰¾é‚£å˜åŒ–äº†æˆ–è€…ä½¿ç”¨<code>PureComponent/shouldComponentUpdate</code>ï¼Œå¦ä¸€ä¸ªä»£è¡¨æ˜¯ Angular çš„è„æ£€æŸ¥ã€‚</p><p>Vue çš„å“åº”å¼ç³»ç»Ÿå°±æ˜¯ Push çš„ä»£è¡¨ï¼ŒVue åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šå¯¹ data çš„æ•°æ®è¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå› æ­¤Vueèƒ½å®æ—¶çŸ¥é“é‚£é‡Œå‘ç”Ÿäº†å˜åŒ–ï¼Œä¸€èˆ¬ç»‘å®šçš„ç»†ç²’åº¦è¿‡é«˜ï¼Œä¼šç”Ÿæˆå¤§é‡çš„Watcher å®ä¾‹ï¼Œåˆ™ä¼šé€ æˆè¿‡å¤§çš„å†…å­˜å’Œä¾èµ–è¿½è¸ªçš„å¼€é”€ï¼Œè€Œç»†ç²’åº¦è¿‡ä½æ— æ³•ä¾¦æµ‹åˆ°å˜åŒ–ã€‚å› æ­¤ï¼ŒVueé‡‡ç”¨çš„æ˜¯ä¸­ç­‰ç»†ç²’åº¦çš„æ–¹æ¡ˆï¼Œåªé’ˆå¯¹ç»„ä»¶çº§åˆ«çš„è¿›è¡Œå“åº”å¼ç›‘å¬ä¹Ÿå°±æ˜¯pushï¼Œè¿™æ ·å¯ä»¥çŸ¥é“é‚£ä¸ªç»„ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œå†å¯¹ç»„ä»¶è¿›è¡Œdiffç®—æ³•æ‰¾åˆ°å…·ä½“å˜åŒ–çš„ä½ç½®ï¼Œè¿™æ˜¯pullæ“ä½œï¼Œvueæ˜¯pull + push ç»“åˆè¿›è¡Œå˜åŒ–ä¾¦æµ‹çš„ã€‚</p><h3 id="vue-ä¸­æ€ä¹ˆé‡ç½®-data"><a href="#vue-ä¸­æ€ä¹ˆé‡ç½®-data" class="headerlink" title="vue ä¸­æ€ä¹ˆé‡ç½® data"></a>vue ä¸­æ€ä¹ˆé‡ç½® data</h3><p>ä½¿ç”¨Object.assign()ï¼Œvm.$dataå¯ä»¥è·å–å½“å‰çŠ¶æ€ä¸‹çš„dataï¼Œvm.$options.dataå¯ä»¥è·å–åˆ°ç»„ä»¶åˆå§‹åŒ–çŠ¶æ€ä¸‹çš„data</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.assign(<span class="keyword">this</span>.$data, <span class="keyword">this</span>.$options.data())</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶ä¸­å†™-name-é€‰é¡¹æœ‰ä»€ä¹ˆä½œç”¨"><a href="#ç»„ä»¶ä¸­å†™-name-é€‰é¡¹æœ‰ä»€ä¹ˆä½œç”¨" class="headerlink" title="ç»„ä»¶ä¸­å†™ name é€‰é¡¹æœ‰ä»€ä¹ˆä½œç”¨"></a>ç»„ä»¶ä¸­å†™ name é€‰é¡¹æœ‰ä»€ä¹ˆä½œç”¨</h3><ol><li>é¡¹ç›®ä½¿ç”¨ keep-alive æ—¶ï¼Œå¯æ­é…ç»„ä»¶ name è¿›è¡Œç¼“å­˜è¿‡æ»¤</li><li>DOM åšé€’å½’ç»„ä»¶æ—¶éœ€è¦è°ƒç”¨è‡ªèº« name</li><li>vue-devtools è°ƒè¯•å·¥å…·é‡Œæ˜¾ç¤ºçš„ç»„è§åç§°æ˜¯ç”±vueä¸­ç»„ä»¶nameå†³å®šçš„</li></ol><h3 id="route-å’Œ-router-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#route-å’Œ-router-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="route å’Œ router çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"></a>route å’Œ router çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</h3><ol><li>$routeæ˜¯â€œè·¯ç”±ä¿¡æ¯å¯¹è±¡â€ï¼ŒåŒ…æ‹¬path,params,hash,query,fullPath,matched,nameç­‰è·¯ç”±ä¿¡æ¯å‚æ•°ã€‚</li><li>$routeræ˜¯â€œè·¯ç”±å®ä¾‹å¯¹è±¡â€ï¼ŒåŒ…æ‹¬äº†è·¯ç”±çš„è·³è½¬æ–¹æ³•(pushã€replace)ï¼Œé’©å­å‡½æ•°ç­‰</li></ol><h3 id="vueç»„ä»¶é‡Œå†™çš„åŸç”ŸaddEventListenersç›‘å¬äº‹ä»¶ï¼Œè¦æ‰‹åŠ¨å»é”€æ¯å—"><a href="#vueç»„ä»¶é‡Œå†™çš„åŸç”ŸaddEventListenersç›‘å¬äº‹ä»¶ï¼Œè¦æ‰‹åŠ¨å»é”€æ¯å—" class="headerlink" title="vueç»„ä»¶é‡Œå†™çš„åŸç”ŸaddEventListenersç›‘å¬äº‹ä»¶ï¼Œè¦æ‰‹åŠ¨å»é”€æ¯å—"></a>vueç»„ä»¶é‡Œå†™çš„åŸç”ŸaddEventListenersç›‘å¬äº‹ä»¶ï¼Œè¦æ‰‹åŠ¨å»é”€æ¯å—</h3><p>è¦ </p><p>ä¸€æ–¹é¢æ˜¯ç»‘å®šå¤šæ¬¡ï¼Œå¦ä¸€æ–¹é¢æ˜¯å‡½æ•°æ²¡é‡Šæ”¾ä¼šå†…å­˜æº¢å‡º</p><h3 id="v-clockå’Œv-preæŒ‡ä»¤"><a href="#v-clockå’Œv-preæŒ‡ä»¤" class="headerlink" title="v-clockå’Œv-preæŒ‡ä»¤"></a>v-clockå’Œv-preæŒ‡ä»¤</h3><p>v-cloakæŒ‡ä»¤åªæ˜¯åœ¨æ ‡ç­¾ä¸­åŠ å…¥ä¸€ä¸ªv-cloakè‡ªå®šä¹‰å±æ€§ï¼Œåœ¨HTMLè¿˜ç¼–è¯‘å®Œæˆä¹‹åè¯¥å±æ€§ä¼šè¢«åˆ é™¤ã€‚<br>v-preå¯ä»¥ç”¨æ¥é˜»æ­¢é¢„ç¼–è¯‘ï¼Œæœ‰v-preæŒ‡ä»¤çš„æ ‡ç­¾å†…éƒ¨çš„å†…å®¹ä¸ä¼šè¢«ç¼–è¯‘ï¼Œä¼šåŸæ ·è¾“å‡ºã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;h1 v-pre&gt;</span><br><span class="line">    &#123;&#123;showPage&#125;&#125;</span><br><span class="line">&lt;<span class="regexp">/h1&gt;/</span><span class="regexp">/ ä»ç„¶æ˜¯æ˜¾ç¤ºçš„ &#123;&#123;showPage&#125;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="æƒé™æŒ‡ä»¤"><a href="#æƒé™æŒ‡ä»¤" class="headerlink" title="æƒé™æŒ‡ä»¤"></a>æƒé™æŒ‡ä»¤</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.directive(<span class="string">'hasPermission'</span>, &#123;</span><br><span class="line">  bind(el, binding, vnode) &#123;</span><br><span class="line">    el.parentNode ? el.parentNode.removeChild(el) : el.style.display = <span class="string">'none'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> permissions = vnode.context.$store.state.account.permissions; <span class="comment">// å­˜æ”¾åœ¨vuex</span></span><br><span class="line">    <span class="keyword">if</span> (binding.value === <span class="string">''</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> value = binding.value.split(<span class="string">','</span>)</span><br><span class="line">    <span class="keyword">let</span> flag = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> v <span class="keyword">of</span> value) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!permissions.includes(v)) &#123;</span><br><span class="line">        flag = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">v-hasPermission=<span class="string">"[1,2,3,4,5]"</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> é¡¹ç›®è¸©å‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è„šæ‰‹æ¶vue-cli</title>
      <link href="/2020/02/11/workspace/Frame/vue/vue-cli/"/>
      <url>/2020/02/11/workspace/Frame/vue/vue-cli/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>è„šæ‰‹æ¶vue-cli</strong></p><p>[[toc]]</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å®‰è£… Vue CLI 3.x</span><br><span class="line">yarn global @vue&#x2F;cli</span><br><span class="line"></span><br><span class="line"># my-project æ˜¯ä½ çš„é¡¹ç›®åç§°</span><br><span class="line">vue create my-project</span><br></pre></td></tr></table></figure><p>vue-cli ä¸­åŒ…å«ç€ typescript é€‰é¡¹ï¼Œåªéœ€è¦é€‰æ‹©å³å¯</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">vue create repo</span><br><span class="line"># æ‰‹åŠ¨é…ç½®çš„æ—¶å€™éœ€è¦é€‰æ‹© TypeScript</span><br><span class="line">Check the features needed <span class="keyword">for</span> your project:</span><br><span class="line"> â—‰ Babel</span><br><span class="line"> â—‰ TypeScript</span><br><span class="line"> â—¯ Progressive Web App (PWA) Support</span><br><span class="line"> â—¯ Router</span><br><span class="line"> â—‰ Vuex</span><br><span class="line"> â—‰ CSS Pre-processors</span><br><span class="line"> â—‰ Linter / Formatter</span><br><span class="line"> â—¯ Unit Testing</span><br><span class="line"> â—¯ E2E Testing</span><br></pre></td></tr></table></figure><h3 id="vue-config-js-çš„é…ç½®"><a href="#vue-config-js-çš„é…ç½®" class="headerlink" title="vue.config.js çš„é…ç½®"></a>vue.config.js çš„é…ç½®</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªæ–‡ä»¶ç”¨äºä¿®æ”¹cliå’Œwebpackçš„é…ç½®</span></span><br><span class="line"><span class="comment">// åŸºäºCommonJS çš„é£æ ¼å¯¼å‡ºä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">// å’Œwebpack.config.jsä¸€æ ·ï¼Œä¿®æ”¹åéœ€è¦é‡å¯</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    outputDir: <span class="string">'./dist'</span>, <span class="comment">// æŒ‡å®šæ–‡ä»¶æ‰“åŒ…åçš„è¾“å‡ºè·¯å¾„</span></span><br><span class="line">    lintOnSave: <span class="literal">true</span>, <span class="comment">// å¯ç”¨eslintè¯­æ³•æ£€æŸ¥ï¼Œé»˜è®¤å¯ç”¨</span></span><br><span class="line">    productionSourceMap: <span class="literal">false</span>, <span class="comment">// ç”Ÿäº§ç¯å¢ƒæ˜¯å¦éœ€è¦source-map,å¦‚æœè®¾ä¸ºfalseå¯ä»¥åŠ é€Ÿæ„å»º(æ‰“åŒ…)</span></span><br><span class="line">    devServer: &#123; <span class="comment">// vue-cli æ”¯æŒæ‰€æœ‰webpack-dev-serverçš„é…ç½®</span></span><br><span class="line">        port: <span class="number">8082</span>, <span class="comment">// ç«¯å£å·</span></span><br><span class="line">        open: <span class="literal">true</span>, <span class="comment">// è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨</span></span><br><span class="line">        host: <span class="string">'0.0.0.0'</span>, <span class="comment">// æŒ‡å®šä½¿ç”¨ä¸€ä¸ª hostã€‚é»˜è®¤æ˜¯ localhost</span></span><br><span class="line">        https: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦å¯ç”¨https</span></span><br><span class="line">        proxy: &#123; <span class="comment">// è¿™ä¸ªå¿…é¡»ä¼šï¼Œç”¨æ¥è§£å†³å¼€å‘ç¯å¢ƒè·¨åŸŸçš„é—®é¢˜</span></span><br><span class="line">            <span class="string">'/api'</span>: &#123;</span><br><span class="line">                target: <span class="string">'http://localhost:8000'</span>,</span><br><span class="line">                changeOrigin: <span class="literal">true</span>,</span><br><span class="line">                secure: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å¼€å¯Gzipå‹ç¼©"><a href="#å¼€å¯Gzipå‹ç¼©" class="headerlink" title="å¼€å¯Gzipå‹ç¼©"></a>å¼€å¯Gzipå‹ç¼©</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* vue.config.js */</span></span><br><span class="line"><span class="keyword">const</span> isPro = process.env.NODE_ENV === <span class="string">'production'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    configureWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isPro) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                plugins: [</span><br><span class="line">                    <span class="keyword">new</span> CompressionWebpackPlugin(&#123;</span><br><span class="line">                         <span class="comment">// ç›®æ ‡æ–‡ä»¶åç§°ã€‚[path] è¢«æ›¿æ¢ä¸ºåŸå§‹æ–‡ä»¶çš„è·¯å¾„å’Œ [query] æŸ¥è¯¢</span></span><br><span class="line">                        asset: <span class="string">'[path].gz[query]'</span>,</span><br><span class="line">                        <span class="comment">// ä½¿ç”¨ gzip å‹ç¼©</span></span><br><span class="line">                        algorithm: <span class="string">'gzip'</span>, </span><br><span class="line">                        <span class="comment">// å¤„ç†ä¸æ­¤æ­£åˆ™ç›¸åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">                        test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(</span><br><span class="line">                            <span class="string">'\\.(js|css)$'</span></span><br><span class="line">                        ),</span><br><span class="line">                        <span class="comment">// åªå¤„ç†å¤§äºæ­¤å¤§å°çš„æ–‡ä»¶</span></span><br><span class="line">                        threshold: <span class="number">10240</span>,</span><br><span class="line">                        <span class="comment">// æœ€å°å‹ç¼©æ¯”è¾¾åˆ° 0.8 æ—¶æ‰ä¼šè¢«å‹ç¼©</span></span><br><span class="line">                        minRatio: <span class="number">0.8</span>ï¼Œ</span><br><span class="line">                    &#125;)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†æåŒ…æ–‡ä»¶"><a href="#åˆ†æåŒ…æ–‡ä»¶" class="headerlink" title="åˆ†æåŒ…æ–‡ä»¶"></a>åˆ†æåŒ…æ–‡ä»¶</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin;</span><br><span class="line"></span><br><span class="line">chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿®å¤HMR</span></span><br><span class="line">    config.resolve.symlinks(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (isAnalyze) &#123;</span><br><span class="line">        config</span><br><span class="line">            .plugin(<span class="string">'webpack-bundle-analyzer'</span>)</span><br><span class="line">            .use(</span><br><span class="line">                <span class="keyword">new</span> BundleAnalyzerPlugin(&#123;</span><br><span class="line">                    analyzerPort: <span class="number">9999</span>,</span><br><span class="line">                    openAnalyzer: <span class="literal">true</span>,</span><br><span class="line">                &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‹†åŒ…"><a href="#æ‹†åŒ…" class="headerlink" title="æ‹†åŒ…"></a>æ‹†åŒ…</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">configureWebpack: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">        cacheGroups: &#123;</span><br><span class="line">            vendor:&#123;</span><br><span class="line">            chunks:<span class="string">"all"</span>,</span><br><span class="line">                test: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                name:<span class="string">"vendor"</span>,</span><br><span class="line">                minChunks: <span class="number">1</span>,</span><br><span class="line">                maxInitialRequests: <span class="number">5</span>,</span><br><span class="line">                minSize: <span class="number">0</span>,</span><br><span class="line">                priority:<span class="number">100</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            common: &#123;</span><br><span class="line">                chunks:<span class="string">"all"</span>,</span><br><span class="line">                test:<span class="regexp">/[\\/]src[\\/]js[\\/]/</span>,</span><br><span class="line">                name: <span class="string">"common"</span>,</span><br><span class="line">                minChunks: <span class="number">2</span>,</span><br><span class="line">                maxInitialRequests: <span class="number">5</span>,</span><br><span class="line">                minSize: <span class="number">0</span>,</span><br><span class="line">                priority:<span class="number">60</span></span><br><span class="line">            &#125;,</span><br><span class="line">            styles: &#123;</span><br><span class="line">                name: <span class="string">'styles'</span>,</span><br><span class="line">                test: <span class="regexp">/\.(sa|sc|c)ss$/</span>,</span><br><span class="line">                chunks: <span class="string">'all'</span>,</span><br><span class="line">                enforce: <span class="literal">true</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                runtimeChunk: &#123;</span><br><span class="line">                name: <span class="string">'manifest'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="é»˜è®¤æ’ä»¶ç®€ä»‹"><a href="#é»˜è®¤æ’ä»¶ç®€ä»‹" class="headerlink" title="é»˜è®¤æ’ä»¶ç®€ä»‹"></a>é»˜è®¤æ’ä»¶ç®€ä»‹</h3><p>é€šè¿‡å¯¹ <code>vue.config.js</code> çš„äº†è§£ï¼Œæˆ‘ä»¬çŸ¥é“äº† <code>vue-cli 3.x</code>ä¸ºæˆ‘ä»¬é»˜è®¤å°è£…äº†é¡¹ç›®è¿è¡Œçš„å¸¸ç”¨ <code>webpack</code> é…ç½®ï¼Œé‚£ä¹ˆå®ƒç»™æˆ‘ä»¬æä¾›äº†å“ªäº›é»˜è®¤æ’ä»¶ï¼Œæ¯ä¸€ä¸ª<code>plugin</code> åˆæœ‰ç€æ€æ ·çš„ç”¨é€”å‘¢ï¼Ÿé™¤äº†ä½¿ç”¨ <strong>vue inspect plugins</strong> æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è¿è¡Œ <strong>vue ui</strong> è¿›å…¥å¯è§†åŒ–é¡µé¢æŸ¥çœ‹ï¼Œæ­¥éª¤å¦‚ä¸‹</p><ul><li>æ‰“å¼€å¯è§†åŒ–é¡µé¢ï¼Œç‚¹å‡»å¯¹åº”é¡¹ç›®è¿›å…¥ç®¡ç†é¡µé¢ï¼ˆå¦‚æœæ²¡æœ‰å¯¹åº”é¡¹ç›®ï¼Œéœ€è¦å¯¼å…¥æˆ–æ–°å»ºï¼‰</li><li>ç‚¹å‡»ä¾§è¾¹æ  <code>Tasks</code> é€‰é¡¹ï¼Œå†ç‚¹å‡»äºŒçº§æ  <code>inspect</code>é€‰é¡¹</li><li>ç‚¹å‡»<code>Run task</code> æŒ‰é’®æ‰§è¡Œå®¡æŸ¥å‘½ä»¤</li></ul><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hb1e97ba0e7ce4cb2b72ea6466cbb0ba6N.png" alt=""></p><blockquote><p>æœ€åæˆ‘ä»¬ä»è¾“å‡ºçš„å†…å®¹ä¸­æ‰¾åˆ° <code>plugins</code> æ•°ç»„ï¼Œå…¶åŒ…å«äº†å¦‚ä¸‹æ’ä»¶ï¼ˆé…ç½®é¡¹å·²ç»çœç•¥ï¼Œå¢åŠ äº†å®šä¹‰æ’ä»¶çš„ä»£ç ï¼‰ï¼š</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue-loaderæ˜¯ webpack çš„åŠ è½½å™¨ï¼Œå…è®¸ä½ ä»¥å•æ–‡ä»¶ç»„ä»¶çš„æ ¼å¼ç¼–å†™ Vue ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> VueLoaderPlugin = <span class="built_in">require</span>(<span class="string">'vue-loader/lib/plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack å†…ç½®æ’ä»¶ï¼Œç”¨äºåˆ›å»ºåœ¨ç¼–è¯‘æ—¶å¯ä»¥é…ç½®çš„å…¨å±€å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> &#123; DefinePlugin &#125; = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºå¼ºåˆ¶æ‰€æœ‰æ¨¡å—çš„å®Œæ•´è·¯å¾„å¿…éœ€ä¸ç£ç›˜ä¸Šå®é™…è·¯å¾„çš„ç¡®åˆ‡å¤§å°å†™ç›¸åŒ¹é…</span></span><br><span class="line"><span class="keyword">const</span> CaseSensitivePathsPlugin = <span class="built_in">require</span>(<span class="string">'case-sensitive-paths-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯†åˆ«æŸäº›ç±»å‹çš„ webpack é”™è¯¯å¹¶æ•´ç†ï¼Œä»¥æä¾›å¼€å‘äººå‘˜æ›´å¥½çš„ä½“éªŒã€‚</span></span><br><span class="line"><span class="keyword">const</span> FriendlyErrorsPlugin = <span class="built_in">require</span>(<span class="string">'friendly-errors-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† CSS æå–åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œä¸ºæ¯ä¸ªåŒ…å« CSS çš„ JS æ–‡ä»¶åˆ›å»ºä¸€ä¸ª CSS æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºåœ¨ webpack æ„å»ºæœŸé—´ä¼˜åŒ–ã€æœ€å°åŒ– CSSæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCssnanoPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack å†…ç½®æ’ä»¶ï¼Œç”¨äºæ ¹æ®æ¨¡å—çš„ç›¸å¯¹è·¯å¾„ç”Ÿæˆ hash ä½œä¸ºæ¨¡å— id, ä¸€èˆ¬ç”¨äºç”Ÿäº§ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">const</span> &#123; HashedModuleIdsPlugin &#125; = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºæ ¹æ®æ¨¡æ¿æˆ–ä½¿ç”¨åŠ è½½å™¨ç”Ÿæˆ HTML æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºåœ¨ä½¿ç”¨ html-webpack-plugin ç”Ÿæˆçš„ html ä¸­æ·»åŠ  &lt;link rel ='preload'&gt; æˆ– &lt;link rel ='prefetch'&gt;ï¼Œæœ‰åŠ©äºå¼‚æ­¥åŠ è½½</span></span><br><span class="line"><span class="keyword">const</span> PreloadPlugin = <span class="built_in">require</span>(<span class="string">'preload-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºå°†å•ä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªç›®å½•å¤åˆ¶åˆ°æ„å»ºç›®å½•</span></span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">/* config.plugin('vue-loader') */</span></span><br><span class="line">        <span class="keyword">new</span> VueLoaderPlugin(), </span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('define') */</span></span><br><span class="line">        <span class="keyword">new</span> DefinePlugin(),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('case-sensitive-paths') */</span></span><br><span class="line">        <span class="keyword">new</span> CaseSensitivePathsPlugin(),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('friendly-errors') */</span></span><br><span class="line">        <span class="keyword">new</span> FriendlyErrorsWebpackPlugin(),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('extract-css') */</span></span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('optimize-css') */</span></span><br><span class="line">        <span class="keyword">new</span> OptimizeCssnanoPlugin(),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('hash-module-ids') */</span></span><br><span class="line">        <span class="keyword">new</span> HashedModuleIdsPlugin(),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('html') */</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('preload') */</span></span><br><span class="line">        <span class="keyword">new</span> PreloadPlugin(),</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* config.plugin('copy') */</span></span><br><span class="line">        <span class="keyword">new</span> CopyWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-alias-ç®€åŒ–è·¯å¾„"><a href="#ä½¿ç”¨-alias-ç®€åŒ–è·¯å¾„" class="headerlink" title="ä½¿ç”¨ alias ç®€åŒ–è·¯å¾„"></a>ä½¿ç”¨ alias ç®€åŒ–è·¯å¾„</h3><p>è€Œåœ¨ <code>CLI 3.x</code>ä¸­æˆ‘ä»¬æ— æ³•ç›´æ¥æ“ä½œ <code>webpack</code> çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ <code>chainWebpack</code> æ¥è¿›è¡Œé—´æ¥ä¿®æ”¹ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* vue.config.js */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        config.resolve.alias</span><br><span class="line">            .set(<span class="string">'@'</span>, resolve(<span class="string">'src'</span>))</span><br><span class="line">            .set(<span class="string">'_lib'</span>, resolve(<span class="string">'src/common'</span>))</span><br><span class="line">            .set(<span class="string">'_com'</span>, resolve(<span class="string">'src/components'</span>))</span><br><span class="line">            .set(<span class="string">'_img'</span>, resolve(<span class="string">'src/images'</span>))</span><br><span class="line">            .set(<span class="string">'_ser'</span>, resolve(<span class="string">'src/services'</span>))</span><br><span class="line">    &#125;, </span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬ä¿®æ”¹ <code>webpack alias</code> æ¥ç®€åŒ–è·¯å¾„çš„ä¼˜åŒ–å°±å®ç°äº†ã€‚<br>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºåœ¨æ ·å¼åŠ <code>htm</code>l æ¨¡æ¿ä¸­å¼•ç”¨è·¯å¾„çš„ç®€å†™æ—¶ï¼Œå‰é¢éœ€è¦åŠ ä¸Š <code>ï½</code> ç¬¦ï¼Œå¦åˆ™è·¯å¾„è§£æä¼šå¤±è´¥ï¼Œå¦‚ï¼š</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.img</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: (~_img/home.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºå¤šé¡µåº”ç”¨"><a href="#æ„å»ºå¤šé¡µåº”ç”¨" class="headerlink" title="æ„å»ºå¤šé¡µåº”ç”¨"></a>æ„å»ºå¤šé¡µåº”ç”¨</h3><h4 id="å¤šå…¥å£"><a href="#å¤šå…¥å£" class="headerlink" title="å¤šå…¥å£"></a>å¤šå…¥å£</h4><p>åœ¨å•é¡µåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬çš„å…¥å£æ–‡ä»¶åªæœ‰ä¸€ä¸ªï¼Œ<code>CLI</code> é»˜è®¤é…ç½®çš„æ˜¯ <code>main.js</code>ï¼Œä½†æ˜¯åˆ°äº†å¤šé¡µåº”ç”¨ï¼Œ<br>æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ä¾¿åŒ…å«äº† <code>page1.jsã€page2.jsã€index.js</code>ç­‰ï¼Œæ•°é‡å–å†³äº pages æ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼Œ<br>è¿™æ—¶å€™ä¸ºäº†é¡¹ç›®çš„å¯æ‹“å±•æ€§ï¼Œæˆ‘ä»¬éœ€è¦è‡ªåŠ¨è®¡ç®—å…¥å£æ–‡ä»¶çš„æ•°é‡å¹¶è§£æè·¯å¾„é…ç½®åˆ° <code>webpack</code> ä¸­çš„ <code>entry</code> å±æ€§ä¸Šï¼Œå¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    entry: &#123;</span><br><span class="line">        page1: <span class="string">'/xxx/pages/page1/page1.js'</span>,</span><br><span class="line">        page2: <span class="string">'/xxx/pages/page2/page2.js'</span>,</span><br><span class="line">        index: <span class="string">'/xxx/pages/index/index.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">   <span class="comment">//  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¯»å–å¹¶è§£æè¿™æ ·çš„è·¯å¾„å‘¢ï¼Œè¿™é‡Œå°±éœ€è¦ä½¿ç”¨å·¥å…·å’Œå‡½æ•°æ¥è§£å†³äº†ã€‚<br>æˆ‘ä»¬å¯ä»¥åœ¨æ ¹ç›®å½•æ–°å»º <code>build</code> æ–‡ä»¶å¤¹å­˜æ”¾ <code>utils.js</code> è¿™æ ·å…±ç”¨çš„ <code>webpack</code> åŠŸèƒ½æ€§æ–‡ä»¶ï¼Œå¹¶åŠ å…¥å¤šå…¥å£è¯»å–è§£ææ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* utils.js *&#x2F;</span><br><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; glob æ˜¯ webpack å®‰è£…æ—¶ä¾èµ–çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œè¯¥æ¨¡å—å…è®¸ä½ ä½¿ç”¨ * ç­‰ç¬¦å·,</span><br><span class="line">&#x2F;&#x2F; ä¾‹å¦‚ lib&#x2F;*.js å°±æ˜¯è·å– lib æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ js åç¼€åçš„æ–‡ä»¶</span><br><span class="line">const glob &#x3D; require(&#39;glob&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å–å¾—ç›¸åº”çš„é¡µé¢è·¯å¾„ï¼Œå› ä¸ºä¹‹å‰çš„é…ç½®ï¼Œæ‰€ä»¥æ˜¯ src æ–‡ä»¶å¤¹ä¸‹çš„ pages æ–‡ä»¶å¤¹</span><br><span class="line">const PAGE_PATH &#x3D; path.resolve(__dirname, &#39;..&#x2F;src&#x2F;pages&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;* </span><br><span class="line">* å¤šå…¥å£é…ç½®</span><br><span class="line">* é€šè¿‡ glob æ¨¡å—è¯»å– pages æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å¯¹åº”æ–‡ä»¶å¤¹ä¸‹çš„ js * åç¼€æ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨</span><br><span class="line">* é‚£ä¹ˆå°±ä½œä¸ºå…¥å£å¤„ç†</span><br><span class="line">*&#x2F;</span><br><span class="line">exports.getEntries &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    let entryFiles &#x3D; glob.sync(PAGE_PATH + &#39;&#x2F;*&#x2F;*.js&#39;) &#x2F;&#x2F; åŒæ­¥è¯»å–æ‰€æœ‰å…¥å£æ–‡ä»¶</span><br><span class="line">    let map &#x3D; &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; éå†æ‰€æœ‰å…¥å£æ–‡ä»¶</span><br><span class="line">    entryFiles.forEach(filePath &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F; è·å–æ–‡ä»¶å</span><br><span class="line">        let filename &#x3D; filePath.substring(filePath.lastIndexOf(&#39;\&#x2F;&#39;) + 1, filePath.lastIndexOf(&#39;.&#39;))</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨</span><br><span class="line">        map[filename] &#x3D; filePath </span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    return map</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* vue.config.js *&#x2F;</span><br><span class="line"></span><br><span class="line">const utils &#x3D; require(&#39;.&#x2F;build&#x2F;utils&#39;)</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">    configureWebpack: config &#x3D;&gt; &#123;</span><br><span class="line">        config.entry &#x3D; utils.getEntries()</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤šæ¨¡æ¿"><a href="#å¤šæ¨¡æ¿" class="headerlink" title="å¤šæ¨¡æ¿"></a>å¤šæ¨¡æ¿</h4><p>ç›¸å¯¹äºå¤šå…¥å£æ¥è¯´ï¼Œå¤šæ¨¡æ¿çš„é…ç½®ä¹Ÿæ˜¯å¤§åŒå°å¼‚ï¼Œè¿™é‡Œæ‰€è¯´çš„æ¨¡æ¿ä¾¿æ˜¯æ¯ä¸ª<code>page</code> ä¸‹çš„<code>html</code> æ¨¡æ¿æ–‡ä»¶ï¼Œ<br>è€Œæ¨¡æ¿æ–‡ä»¶çš„ä½œç”¨ä¸»è¦ç”¨äº <code>webpack</code>ä¸­ <code>html-webpack-plugin</code> æ’ä»¶çš„é…ç½®ï¼Œ<br>å…¶ä¼šæ ¹æ®æ¨¡æ¿æ–‡ä»¶ç”Ÿäº§ä¸€ä¸ªç¼–è¯‘åçš„ <code>html</code> æ–‡ä»¶å¹¶è‡ªåŠ¨åŠ å…¥æºå¸¦ <code>hash</code>çš„è„šæœ¬å’Œæ ·å¼ï¼ŒåŸºæœ¬é…ç½®å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* webpack é…ç½®æ–‡ä»¶ */</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>) <span class="comment">// å®‰è£…å¹¶å¼•ç”¨æ’ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            title: <span class="string">'My Page'</span>, <span class="comment">// ç”Ÿæˆ html ä¸­çš„ title</span></span><br><span class="line">            filename: <span class="string">'demo.html'</span>, <span class="comment">// ç”Ÿæˆ html çš„æ–‡ä»¶å</span></span><br><span class="line">            template: <span class="string">'xxx/xxx/demo.html'</span>, <span class="comment">// æ¨¡æ¿è·¯å¾„</span></span><br><span class="line">            chunks: [<span class="string">'manifest'</span>, <span class="string">'vendor'</span>, <span class="string">'demo'</span>], <span class="comment">// æ‰€è¦åŒ…å«çš„æ¨¡å—</span></span><br><span class="line">            inject: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ³¨å…¥èµ„æº</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* utils.js */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šé¡µé¢è¾“å‡ºé…ç½®</span></span><br><span class="line"><span class="comment">// ä¸ä¸Šé¢çš„å¤šé¡µé¢å…¥å£é…ç½®ç›¸åŒï¼Œè¯»å– page æ–‡ä»¶å¤¹ä¸‹çš„å¯¹åº”çš„ html åç¼€æ–‡ä»¶ï¼Œç„¶åæ”¾å…¥æ•°ç»„ä¸­</span></span><br><span class="line">exports.htmlPlugin = <span class="function"><span class="params">configs</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> entryHtml = glob.sync(PAGE_PATH + <span class="string">'/*/*.html'</span>)</span><br><span class="line">    <span class="keyword">let</span> arr = []</span><br><span class="line">    </span><br><span class="line">    entryHtml.forEach(<span class="function"><span class="params">filePath</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> filename = filePath.substring(filePath.lastIndexOf(<span class="string">'\/'</span>) + <span class="number">1</span>, filePath.lastIndexOf(<span class="string">'.'</span>))</span><br><span class="line">        <span class="keyword">let</span> conf = &#123;</span><br><span class="line">            template: filePath, <span class="comment">// æ¨¡æ¿è·¯å¾„</span></span><br><span class="line">            filename: filename + <span class="string">'.html'</span>, <span class="comment">// ç”Ÿæˆ html çš„æ–‡ä»¶å</span></span><br><span class="line">            chunks: [<span class="string">'manifest'</span>, <span class="string">'vendor'</span>,  filename],</span><br><span class="line">            inject: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰è‡ªå®šä¹‰é…ç½®å¯ä»¥è¿›è¡Œ merge</span></span><br><span class="line">        <span class="keyword">if</span> (configs) &#123;</span><br><span class="line">            conf = merge(conf, configs)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒé…ç½®</span></span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line">            conf = merge(conf, &#123;</span><br><span class="line">                minify: &#123;</span><br><span class="line">                    removeComments: <span class="literal">true</span>, <span class="comment">// åˆ é™¤ html ä¸­çš„æ³¨é‡Šä»£ç </span></span><br><span class="line">                    collapseWhitespace: <span class="literal">true</span>, <span class="comment">// åˆ é™¤ html ä¸­çš„ç©ºç™½ç¬¦</span></span><br><span class="line">                    <span class="comment">// removeAttributeQuotes: true // åˆ é™¤ html å…ƒç´ ä¸­å±æ€§çš„å¼•å·</span></span><br><span class="line">                &#125;,</span><br><span class="line">                chunksSortMode: <span class="string">'manual'</span> <span class="comment">// æŒ‰ manual çš„é¡ºåºå¼•å…¥</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        arr.push(<span class="keyword">new</span> HtmlWebpackPlugin(conf))</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* vue.config.js *&#x2F;</span><br><span class="line"></span><br><span class="line">const utils &#x3D; require(&#39;.&#x2F;build&#x2F;utils&#39;)</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">    configureWebpack: config &#x3D;&gt; &#123;</span><br><span class="line">        config.entry &#x3D; utils.getEntries() &#x2F;&#x2F; ç›´æ¥è¦†ç›– entry é…ç½®</span><br><span class="line">        &#x2F;&#x2F; ä½¿ç”¨ return ä¸€ä¸ªå¯¹è±¡ä¼šé€šè¿‡ webpack-merge è¿›è¡Œåˆå¹¶ï¼Œplugins ä¸ä¼šç½®ç©º</span><br><span class="line">        return &#123;</span><br><span class="line">            plugins: [...utils.htmlPlugin()]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤æˆ‘ä»¬å¤šé¡µåº”ç”¨çš„å¤šå…¥å£å’Œå¤šæ¨¡æ¿çš„é…ç½®å°±å®Œæˆäº†ï¼Œ<br>è¿™æ—¶å€™æˆ‘ä»¬è¿è¡Œå‘½ä»¤ <code>yarn build</code> åä½ ä¼šå‘ç° <code>dist</code> ç›®å½•ä¸‹ç”Ÿæˆäº† 3 ä¸ª html æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ <code>index.htmlã€page1.html å’Œ page2.html</code></p><h4 id="ä½¿ç”¨-pages-é…ç½®"><a href="#ä½¿ç”¨-pages-é…ç½®" class="headerlink" title="ä½¿ç”¨ pages é…ç½®"></a>ä½¿ç”¨ pages é…ç½®</h4><p>å…¶å®ï¼Œåœ¨ <code>vue.config.js</code> ä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé…ç½®æ²¡æœ‰ä½¿ç”¨ï¼Œä¾¿æ˜¯ <code>pages</code>ã€‚<code>pages</code> å¯¹è±¡å…è®¸æˆ‘ä»¬ä¸ºåº”ç”¨é…ç½®å¤šä¸ªå…¥å£åŠæ¨¡æ¿ï¼Œ<br>è¿™å°±ä¸ºæˆ‘ä»¬çš„å¤šé¡µåº”ç”¨æä¾›äº†å¼€æ”¾çš„é…ç½®å…¥å£ã€‚å®˜æ–¹ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* vue.config.js */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    pages: &#123;</span><br><span class="line">        index: &#123;</span><br><span class="line">            <span class="comment">// page çš„å…¥å£</span></span><br><span class="line">            entry: <span class="string">'src/index/main.js'</span>,</span><br><span class="line">            <span class="comment">// æ¨¡æ¿æ¥æº</span></span><br><span class="line">            template: <span class="string">'public/index.html'</span>,</span><br><span class="line">            <span class="comment">// åœ¨ dist/index.html çš„è¾“å‡º</span></span><br><span class="line">            filename: <span class="string">'index.html'</span>,</span><br><span class="line">            <span class="comment">// å½“ä½¿ç”¨ title é€‰é¡¹æ—¶ï¼Œ</span></span><br><span class="line">            <span class="comment">// template ä¸­çš„ title æ ‡ç­¾éœ€è¦æ˜¯ &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;</span></span><br><span class="line">            title: <span class="string">'Index Page'</span>,</span><br><span class="line">            <span class="comment">// åœ¨è¿™ä¸ªé¡µé¢ä¸­åŒ…å«çš„å—ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåŒ…å«</span></span><br><span class="line">            <span class="comment">// æå–å‡ºæ¥çš„é€šç”¨ chunk å’Œ vendor chunkã€‚</span></span><br><span class="line">            chunks: [<span class="string">'chunk-vendors'</span>, <span class="string">'chunk-common'</span>, <span class="string">'index'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// å½“ä½¿ç”¨åªæœ‰å…¥å£çš„å­—ç¬¦ä¸²æ ¼å¼æ—¶ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ¨¡æ¿ä¼šè¢«æ¨å¯¼ä¸º `public/subpage.html`</span></span><br><span class="line">        <span class="comment">// å¹¶ä¸”å¦‚æœæ‰¾ä¸åˆ°çš„è¯ï¼Œå°±å›é€€åˆ° `public/index.html`ã€‚</span></span><br><span class="line">        <span class="comment">// è¾“å‡ºæ–‡ä»¶åä¼šè¢«æ¨å¯¼ä¸º `subpage.html`ã€‚</span></span><br><span class="line">        subpage: <span class="string">'src/subpage/main.js'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œ<code>pages</code> å¯¹è±¡ä¸­çš„ <code>key</code> å°±æ˜¯å…¥å£çš„åˆ«åï¼Œè€Œå…¶ <code>value</code> å¯¹è±¡å…¶å®æ˜¯å…¥å£ <code>entry</code> å’Œæ¨¡æ¿å±æ€§çš„åˆå¹¶ï¼Œ<br>è¿™æ ·æˆ‘ä»¬ä¸Šè¿°ä»‹ç»çš„è·å–å¤šå…¥å£å’Œå¤šæ¨¡æ¿çš„æ–¹æ³•å°±å¯ä»¥åˆå¹¶æˆä¸€ä¸ªå‡½æ•°æ¥è¿›è¡Œå¤šé¡µçš„å¤„ç†ï¼Œåˆå¹¶åçš„ <code>setPages</code> æ–¹æ³•å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">/ pages å¤šå…¥å£é…ç½®</span><br><span class="line">exports.setPages = <span class="function"><span class="params">configs</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> entryFiles = glob.sync(PAGE_PATH + <span class="string">'/*/*.js'</span>)</span><br><span class="line">    <span class="keyword">let</span> map = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    entryFiles.forEach(<span class="function"><span class="params">filePath</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> filename = filePath.substring(filePath.lastIndexOf(<span class="string">'\/'</span>) + <span class="number">1</span>, filePath.lastIndexOf(<span class="string">'.'</span>))</span><br><span class="line">        <span class="keyword">let</span> tmp = filePath.substring(<span class="number">0</span>, filePath.lastIndexOf(<span class="string">'\/'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> conf = &#123;</span><br><span class="line">            <span class="comment">// page çš„å…¥å£</span></span><br><span class="line">            entry: filePath, </span><br><span class="line">            <span class="comment">// æ¨¡æ¿æ¥æº</span></span><br><span class="line">            template: tmp + <span class="string">'.html'</span>, </span><br><span class="line">            <span class="comment">// åœ¨ dist/index.html çš„è¾“å‡º</span></span><br><span class="line">            filename: filename + <span class="string">'.html'</span>, </span><br><span class="line">            <span class="comment">// é¡µé¢æ¨¡æ¿éœ€è¦åŠ å¯¹åº”çš„jsè„šæœ¬ï¼Œå¦‚æœä¸åŠ è¿™è¡Œåˆ™æ¯ä¸ªé¡µé¢éƒ½ä¼šå¼•å…¥æ‰€æœ‰çš„jsè„šæœ¬</span></span><br><span class="line">            chunks: [<span class="string">'manifest'</span>, <span class="string">'vendor'</span>, filename], </span><br><span class="line">            inject: <span class="literal">true</span>,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (configs) &#123;</span><br><span class="line">            conf = merge(conf, configs)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line">            conf = merge(conf, &#123;</span><br><span class="line">                minify: &#123;</span><br><span class="line">                    removeComments: <span class="literal">true</span>, <span class="comment">// åˆ é™¤ html ä¸­çš„æ³¨é‡Šä»£ç </span></span><br><span class="line">                    collapseWhitespace: <span class="literal">true</span>, <span class="comment">// åˆ é™¤ html ä¸­çš„ç©ºç™½ç¬¦</span></span><br><span class="line">                    <span class="comment">// removeAttributeQuotes: true // åˆ é™¤ html å…ƒç´ ä¸­å±æ€§çš„å¼•å·</span></span><br><span class="line">                &#125;,</span><br><span class="line">                chunksSortMode: <span class="string">'manual'</span><span class="comment">// æŒ‰ manual çš„é¡ºåºå¼•å…¥</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map[filename] = conf</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> map</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* vue.config.js */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">'./build/utils'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    pages: utils.setPages(),</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å¤šé¡µåº”ç”¨åŸºäº <code>pages</code> é…ç½®çš„æ”¹è¿›å°±å¤§åŠŸå‘Šæˆäº†ï¼Œå½“ä½ è¿è¡Œæ‰“åŒ…å‘½ä»¤æ¥æŸ¥çœ‹è¾“å‡ºç»“æœçš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°å’Œä¹‹å‰çš„æ–¹å¼ç›¸æ¯”å¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œ<br>è¿™å°±è¯´æ˜è¿™ä¸¤ç§æ–¹å¼éƒ½é€‚ç”¨äºå¤šé¡µçš„æ„å»ºï¼Œä½†æ˜¯è¿™é‡Œè¿˜æ˜¯<code>æ¨è</code>å¤§å®¶ä½¿ç”¨æ›´ä¾¿æ·çš„ <code>pages</code> é…ç½®</p><blockquote><p>å¦‚æœæ”¯æŒåˆ†é¡¹ç›®ç¼–è¯‘æ‰“åŒ…åˆ°ç›¸åº”æ–‡ä»¶å¤¹ä¸­,è¯·çœ‹æˆ‘çš„github  <a href="https://github.com/hzfvictory/vue-mpa" target="_blank" rel="noopener">ç¼–è¯‘æ‰“åŒ…åˆ°ç›¸åº”æ–‡ä»¶å¤¹</a></p></blockquote><h4 id="è·¯ç”±é…ç½®"><a href="#è·¯ç”±é…ç½®" class="headerlink" title="è·¯ç”±é…ç½®"></a>è·¯ç”±é…ç½®</h4><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ç‚¹å°±æ˜¯ï¼Œå¤šé¡µåº”ç”¨ä¸­çš„æ¯ä¸ªå•é¡µéƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå³å¦‚æœä½ æƒ³ä» <code>page1</code> ä¸‹çš„è·¯ç”±è·³åˆ° <code>page2</code> ä¸‹çš„è·¯ç”±ï¼Œ<br>ä½ æ— æ³•ä½¿ç”¨ <code>vue-router</code> ä¸­çš„æ–¹æ³•è¿›è¡Œè·³è½¬ï¼Œéœ€è¦ä½¿ç”¨åŸç”Ÿæ–¹æ³•ï¼š<code>location.href</code> æˆ– <code>location.replace</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;nav&quot;&gt;</span><br><span class="line">      &lt;a @click&#x3D;&quot;goFn(&#39;&#39;)&quot;&gt;Index&lt;&#x2F;a&gt; |</span><br><span class="line">      &lt;a @click&#x3D;&quot;goFn(&#39;page1&#39;)&quot;&gt;Page1&lt;&#x2F;a&gt; |</span><br><span class="line">      &lt;a @click&#x3D;&quot;goFn(&#39;page2&#39;)&quot;&gt;Page2&lt;&#x2F;a&gt; |</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;router-view&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        goFn(name) &#123;</span><br><span class="line">            location.href &#x3D; &#96;$&#123;process.env.BASE_URL&#125;&#96; + name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸ºäº†ä¿æŒå’Œ<code>Vue</code> è·¯ç”±è·³è½¬åŒæ ·çš„é£æ ¼ï¼Œæˆ‘å¯ä»¥å¯¹å•é¡µä¹‹é—´çš„è·³è½¬åšä¸€ä¸‹å°è£…ï¼Œ<br>å®ç°ä¸€ä¸ª<code>Navigator</code> ç±»ï¼Œç±»çš„ä»£ç å¯ä»¥æŸ¥çœ‹æœ¬æ–‡æœ€åçš„ç¤ºä¾‹ï¼Œå°è£…å®Œæˆåæˆ‘ä»¬å¯ä»¥å°†è·³è½¬æ–¹æ³•ä¿®æ”¹ä¸º</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">this.$openRouter(&#123;</span><br><span class="line">    name: name, &#x2F;&#x2F; è·³è½¬åœ°å€</span><br><span class="line">    query: &#123;</span><br><span class="line">        text: &#39;hello&#39; &#x2F;&#x2F; å¯ä»¥è¿›è¡Œå‚æ•°ä¼ é€’</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å°†å…¶ç»‘å®šåˆ° Vue çš„åŸå‹é“¾ä¸Š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; Navigator &#125; from &#39;..&#x2F;..&#x2F;common&#39; &#x2F;&#x2F; å¼•å…¥ Navigator</span><br><span class="line"></span><br><span class="line">Vue.prototype.$openRouter &#x3D; Navigator.openRouter; &#x2F;&#x2F; æ·»åŠ è‡³ Vue åŸå‹é“¾</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æˆ‘ä»¬å·²ç»èƒ½å¤ŸæˆåŠŸæ¨¡ä»¿ <code>vue-router</code>è¿›è¡Œå•é¡µé—´çš„è·³è½¬ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å› ä¸ºå…¶æœ¬è´¨ä½¿ç”¨çš„æ˜¯ <code>location</code> è·³è½¬ï¼Œæ‰€ä»¥å¿…ç„¶ä¼šäº§ç”Ÿæµè§ˆå™¨çš„åˆ·æ–°ä¸é‡è½½</p><h4 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h4><p>å½“æˆ‘ä»¬å®Œæˆä¸Šè¿°è·¯ç”±è·³è½¬çš„åŠŸèƒ½åï¼Œå¯ä»¥åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šæ¥è¿›è¡Œä¸€ä¸‹æµ‹è¯•ï¼Œä½ ä¼šå‘ç°<code>Index</code> é¦–é¡µå¯ä»¥æ­£å¸¸æ‰“å¼€ï¼Œ<br>ä½†æ˜¯è·³è½¬ <code>Page1ã€Page2</code>å´ä»ç„¶å¤„äº <code>Index</code> çˆ¶ç»„ä»¶ä¸‹ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨è®¤ä¸ºä½ æ‰€è¦è·³è½¬çš„é¡µé¢è¿˜æ˜¯åœ¨ <code>Index</code> æ ¹è·¯ç”±ä¸‹ï¼Œ<br>åŒæ—¶åˆæ²¡æœ‰åŒ¹é…åˆ°<code>Index</code> å•é¡µä¸­å¯¹åº”çš„è·¯ç”±ã€‚è¿™æ—¶å€™æˆ‘ä»¬æœåŠ¡å™¨éœ€è¦åšä¸€æ¬¡é‡å®šå‘ï¼Œå°†ä¸‹æ–¹è·¯ç”±æŒ‡å‘å¯¹åº”çš„ <code>html</code>æ–‡ä»¶å³å¯</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;vue&#x2F;page1 -&gt; &#x2F;vue&#x2F;page1.html</span><br><span class="line">&#x2F;vue&#x2F;page2 -&gt; &#x2F;vue&#x2F;page2.html</span><br></pre></td></tr></table></figure><p>åœ¨ <code>vue.config.js</code> ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ <code>devServer</code> è¿›è¡Œé…ç½®ï¼Œæ·»åŠ  <code>historyApiFallback</code>é…ç½®é¡¹ï¼Œ<br>è¯¥é…ç½®é¡¹ä¸»è¦ç”¨äºè§£å†³ <code>HTML5 History API</code> äº§ç”Ÿçš„é—®é¢˜ï¼Œæ¯”å¦‚å…¶ <code>rewrites</code> é€‰é¡¹ç”¨äºé‡å†™è·¯ç”±</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* vue.config.js */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> baseUrl = <span class="string">'/vue/'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        historyApiFallback: &#123;</span><br><span class="line">            rewrites: [</span><br><span class="line">                &#123; <span class="attr">from</span>: <span class="keyword">new</span> <span class="built_in">RegExp</span>(baseUrl + <span class="string">'page1'</span>), <span class="attr">to</span>: baseUrl + <span class="string">'page1.html'</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">from</span>: <span class="keyword">new</span> <span class="built_in">RegExp</span>(baseUrl + <span class="string">'page2'</span>), <span class="attr">to</span>: baseUrl + <span class="string">'page2.html'</span> &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é”™è¯¯æœºåˆ¶</title>
      <link href="/2020/01/17/workspace/Frame/vue/error-handler/"/>
      <url>/2020/01/17/workspace/Frame/vue/error-handler/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>é”™è¯¯æœºåˆ¶</strong></p><p>[[toc]]</p><h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><p>æ–‡ä»¶è·¯å¾„<code>vue/src/core/util/error.js</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import config from &#39;..&#x2F;config&#39;</span><br><span class="line">import &#123;warn&#125; from &#39;.&#x2F;debug&#39;</span><br><span class="line">import &#123;inBrowser, inWeex&#125; from &#39;.&#x2F;env&#39;  &#x2F;&#x2F; è¿è¡Œçš„å¹³å°</span><br><span class="line">import &#123;isPromise&#125; from &#39;shared&#x2F;util&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;*è‡ªå·±å®ç°ä¸€ä¸ªç‰ˆæœ¬ï¼Œå‰å‡ å¤©ä¸€ä¸ªnpmå°é¡¹ç›®çš„æ›´æ–°ç»™æ•´ä¸ªnpmç”Ÿæ€ç³»ç»Ÿåˆ¶é€ äº†ä¸€åœºæ··ä¹±ï¼Œå½±å“åˆ°äº†æ•°ç™¾ä¸‡ JS é¡¹ç›®ã€‚è¿™ä¸ªåº“å°±æ˜¯ is-promiseï¼›</span><br><span class="line">* function isPromise(val)&#123;</span><br><span class="line">*    return (typeof val &#x3D;&#x3D;&#x3D; &#39;object&#39; || typeof val &#x3D;&#x3D;&#x3D; &#39;function&#39;) &amp;&amp; val !&#x3D;&#x3D;null &amp;&amp;  typeof val.then &#x3D;&#x3D;&#x3D; &#39;function&#39; &amp;&amp; typeof val.catch &#x3D;&#x3D;&#x3D; &#39;function&#39;</span><br><span class="line">*  &#125;</span><br><span class="line">* *&#x2F;</span><br><span class="line">import &#123;pushTarget, popTarget&#125; from &#39;..&#x2F;observer&#x2F;dep&#39;</span><br><span class="line"></span><br><span class="line">export function handleError(err: Error, vm: any, info: string) &#123;</span><br><span class="line">  &#x2F;&#x2F; å¤„ç†é”™è¯¯ä¿¡æ¯, è¿›è¡Œé”™è¯¯ä¸ŠæŠ¥</span><br><span class="line">  &#x2F;&#x2F; erré”™è¯¯å¯¹è±¡</span><br><span class="line">  &#x2F;&#x2F; vm Vueå®ä¾‹</span><br><span class="line">  &#x2F;&#x2F; infoæ˜¯ Vue ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯æ‰€åœ¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­</span><br><span class="line">  &#x2F;&#x2F; åªåœ¨ 2.2.0+ å¯ç”¨</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; å½“é”™è¯¯å‡½æ•°å¤„ç†é”™è¯¯æ—¶ï¼Œåœç”¨depsè·Ÿè¸ªä»¥é¿å…å¯èƒ½å‡ºç°çš„infinite rendering</span><br><span class="line">  &#x2F;&#x2F; See: https:&#x2F;&#x2F;github.com&#x2F;vuejs&#x2F;vuex&#x2F;issues&#x2F;1505</span><br><span class="line">  pushTarget()</span><br><span class="line">  try &#123;</span><br><span class="line">    if (vm) &#123;</span><br><span class="line">      let cur &#x3D; vm  &#x2F;&#x2F; è·å–å½“å‰çš„é”™è¯¯ç»„ä»¶ï¼Œç„¶åé€’å½’æŸ¥æ‰¾å½“å‰ç»„ä»¶çš„çˆ¶ç»„ä»¶ï¼Œä¾æ¬¡è°ƒç”¨errorCaptured æ–¹æ³•ã€‚</span><br><span class="line">      while ((cur &#x3D; cur.$parent)) &#123;</span><br><span class="line">        const hooks &#x3D; cur.$options.errorCaptured</span><br><span class="line">        if (hooks) &#123;</span><br><span class="line">          for (let i &#x3D; 0; i &lt; hooks.length; i++) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">              &#x2F;&#x2F; é€ä¸ªæ‰§è¡Œ</span><br><span class="line">              const capture &#x3D; hooks[i].call(cur, err, vm, info) &#x3D;&#x3D;&#x3D; false</span><br><span class="line">              if (capture) return   &#x2F;&#x2F; è¿”å›false é»˜è®¤ä¸ä¼šå‘ä¸Šé€’å½’</span><br><span class="line">            &#125; catch (e) &#123;</span><br><span class="line">              globalHandleError(e, cur, &#39;errorCaptured hook&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; æœ€åæ‰§è¡Œå…¨å±€çš„errorHandlerï¼Œè¿”å›è¿”å›falseå°±ä¸­æ–­äº†</span><br><span class="line">    globalHandleError(err, vm, info)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    popTarget()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; å¤„ç†å¼‚æ­¥é”™è¯¯</span><br><span class="line">export function invokeWithErrorHandling(</span><br><span class="line">  handler: Function,</span><br><span class="line">  context: any,</span><br><span class="line">  args: null | any[],</span><br><span class="line">  vm: any,</span><br><span class="line">  info: string</span><br><span class="line">) &#123;</span><br><span class="line">  let res</span><br><span class="line">  try &#123;</span><br><span class="line">    res &#x3D; args ? handler.apply(context, args) : handler.call(context)</span><br><span class="line">    if (res &amp;&amp; !res._isVue &amp;&amp; isPromise(res) &amp;&amp; !res._handled) &#123;</span><br><span class="line">      res.catch(e &#x3D;&gt; handleError(e, vm, info + &#96; (Promise&#x2F;async)&#96;))</span><br><span class="line">      res._handled &#x3D; true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    handleError(e, vm, info)</span><br><span class="line">  &#125;</span><br><span class="line">  return res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function globalHandleError(err, vm, info) &#123;</span><br><span class="line">  if (config.errorHandler) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      return config.errorHandler.call(null, err, vm, info)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      &#x2F;&#x2F;å¦‚æœç”¨æˆ·æœ‰æ„åœ¨å¤„ç†ç¨‹åºä¸­æŠ›å‡ºåŸå§‹é”™è¯¯ï¼Œ</span><br><span class="line">      &#x2F;&#x2F;ä¸è¦è®°å½•ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ€§è¾“å‡º</span><br><span class="line">      if (e !&#x3D;&#x3D; err) &#123;</span><br><span class="line">        logError(e, null, &#39;config.errorHandler&#39;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  logError(err, vm, info)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function logError(err, vm, info) &#123;</span><br><span class="line">  if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39;) &#123;</span><br><span class="line">    warn(&#96;Error in $&#123;info&#125;: &quot;$&#123;err.toString()&#125;&quot;&#96;, vm)</span><br><span class="line">  &#125;</span><br><span class="line">  if ((inBrowser || inWeex) &amp;&amp; typeof console !&#x3D;&#x3D; &#39;undefined&#39;) &#123;</span><br><span class="line">    console.error(err)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    throw err</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line">* ErrorBoundary  é”™è¯¯è¾¹ç•Œ</span><br><span class="line">*</span><br><span class="line">* react</span><br><span class="line">* class ErrorBoundary extends React.Component &#123;</span><br><span class="line">*    constructor(props) &#123;</span><br><span class="line">*        super(props);</span><br><span class="line">*        this.state &#x3D; &#123; hasError: false &#125;;</span><br><span class="line">*    &#125;</span><br><span class="line">*    componentDidCatch(error, info) &#123;</span><br><span class="line">*        this.setState(&#123; hasError: true &#125;);</span><br><span class="line">*        &#x2F;&#x2F; å°†å¼‚å¸¸ä¿¡æ¯ä¸ŠæŠ¥ç»™æœåŠ¡å™¨</span><br><span class="line">*        logErrorToMyService(error, info);</span><br><span class="line">*    &#125;</span><br><span class="line">*    render() &#123;</span><br><span class="line">*        if (this.state.hasError) &#123;</span><br><span class="line">*            return &#39;å‡ºé”™äº†&#39;;</span><br><span class="line">*        &#125;</span><br><span class="line">*        return this.props.children;</span><br><span class="line">*    &#125;</span><br><span class="line">* &#125;</span><br><span class="line">* vue</span><br><span class="line">* Vue.component(&#39;ErrorBoundary&#39;, &#123;</span><br><span class="line">*  data: () &#x3D;&gt; (&#123; error: null &#125;),</span><br><span class="line">*  errorCaptured (err, vm, info) &#123;</span><br><span class="line">*    this.error &#x3D; &#96;$&#123;err.stack&#125;\n\nfound in $&#123;info&#125; of component&#96;</span><br><span class="line">*    return false</span><br><span class="line">*  &#125;,</span><br><span class="line">*  render (h) &#123;</span><br><span class="line">*    if (this.error) &#123;</span><br><span class="line">*      return h(&#39;pre&#39;, &#123; style: &#123; color: &#39;red&#39; &#125;&#125;, this.error)</span><br><span class="line">*    &#125;</span><br><span class="line">*    &#x2F;&#x2F; ignoring edge cases for the sake of demonstration</span><br><span class="line">*    return this.$slots.default[0]</span><br><span class="line">*  &#125;</span><br><span class="line">*&#125;)</span><br><span class="line">**</span><br><span class="line">* &lt;ErrorBoundary&gt;</span><br><span class="line">*   &lt;this.props.children&gt;</span><br><span class="line">* &lt;&#x2F;ErrorBoundary&gt;</span><br><span class="line">*</span><br><span class="line">* ç¬”è®°</span><br><span class="line">*</span><br><span class="line">* ç»„ä»¶å†…éƒ¨ä½¿ç”¨</span><br><span class="line">* errorCaptured(...opt) &#123;</span><br><span class="line">*   &#x2F;&#x2F;  å½“å‰ç»„ä»¶æŠ¥é”™ï¼Œä»–ä¼šé¡ºç€çˆ¶ç»„ä»¶å‘ä¸Šä¼ é€’ï¼Œç›´æ¥åˆ°å…¨å±€çš„errorHandler</span><br><span class="line">*    console.log(&#39;ä½ å¤§çˆ·çš„&#39;, opt);</span><br><span class="line">*    return false   &#x2F;&#x2F; é”™è¯¯ä¼šè¢«é˜»æ­¢ï¼Œä¸ä¼šæ¢èµ·ä¸Šä¸€çº§çš„ errorCaptured å’Œå…¨å±€çš„errorHandler</span><br><span class="line">*  &#125;,</span><br><span class="line">*</span><br><span class="line">* å…¨å±€ä½¿ç”¨</span><br><span class="line">*Vue.config.errorHandler &#x3D; function (err, vm, info) &#123;</span><br><span class="line">*  &#x2F;&#x2F; throw Error(&#39;æŠ›å‡ºä¸€ä¸ªé”™è¯¯&#39;)</span><br><span class="line">*  let &#123;</span><br><span class="line">*    message, &#x2F;&#x2F; å¼‚å¸¸ä¿¡æ¯</span><br><span class="line">*    name, &#x2F;&#x2F; å¼‚å¸¸åç§°</span><br><span class="line">*   stack  &#x2F;&#x2F; å¼‚å¸¸å †æ ˆä¿¡æ¯</span><br><span class="line">* &#125; &#x3D; err;</span><br><span class="line">* console.log(&#39;----1111----&#39;, name);</span><br><span class="line">* console.log(&#39;----1111----&#39;, message);</span><br><span class="line">* console.log(&#39;----1111----&#39;, stack);</span><br><span class="line">*</span><br><span class="line">* console.log(&#39;----2222----&#39;, vm,);</span><br><span class="line">* console.log(&#39;----3333----&#39;, info);</span><br><span class="line">* &#x2F;&#x2F; å¯ä»¥æ‰§è¡Œä¸€æ­¥æ“ä½œ</span><br><span class="line">&#125;;</span><br><span class="line">* throw Error(&#39;æŠ›å‡ºä¸€ä¸ªé”™è¯¯&#39;)</span><br><span class="line">*</span><br><span class="line">* *&#x2F;</span><br></pre></td></tr></table></figure><h3 id="reactçš„errorè§£æ"><a href="#reactçš„errorè§£æ" class="headerlink" title="reactçš„errorè§£æ"></a>reactçš„errorè§£æ</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// koa2</span></span><br><span class="line">router.post(<span class="string">'/errorMsg/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> error = ctx.request.body;; <span class="comment">// è·å–å‰ç«¯ä¼ è¿‡æ¥çš„æŠ¥é”™å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">let</span> url = error.scriptURI; <span class="comment">// å‹ç¼©æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="keyword">if</span> (url) &#123;</span><br><span class="line">        <span class="comment">// mapæ–‡ä»¶è·¯å¾„  vueçš„å®˜æ–¹ä¸å»ºè®®ä¸Šä¼  .map æ–‡ä»¶ï¼Œè¯´æ˜¯å®¹æ˜“çœ‹åˆ°å¾ˆå¤šæºç ï¼Œreactä½•å°ä¸æ˜¯å‘¢</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥å¯ä»¥ç›´æ¥ä¼ é€’ç»™æœåŠ¡å™¨å½“å‰çš„ .map æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">let</span> fileUrl = url.slice(url.indexOf(<span class="string">'client/'</span>)) + <span class="string">'.map'</span>; </span><br><span class="line">        <span class="comment">// è§£æsourceMap</span></span><br><span class="line">        <span class="keyword">let</span> smc = <span class="keyword">new</span> sourceMap.SourceMapConsumer(fs.readFileSync(resolve(<span class="string">'../'</span> + fileUrl), <span class="string">'utf8'</span>)); <span class="comment">// è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡</span></span><br><span class="line">        smc.then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// è§£æåŸå§‹æŠ¥é”™æ•°æ®</span></span><br><span class="line">            <span class="keyword">let</span> ret = result.originalPositionFor(&#123;</span><br><span class="line">                line: error.lineNo, <span class="comment">// å‹ç¼©åçš„è¡Œå·</span></span><br><span class="line">                column: error.columnNo <span class="comment">// å‹ç¼©åçš„åˆ—å·</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">let</span> url = <span class="string">''</span>; <span class="comment">// ä¸ŠæŠ¥åœ°å€</span></span><br><span class="line">            <span class="comment">// å°†å¼‚å¸¸ä¸ŠæŠ¥è‡³åå°</span></span><br><span class="line">            fetch(url, &#123;</span><br><span class="line">                method: <span class="string">'POST'</span>,</span><br><span class="line">                headers: &#123;</span><br><span class="line">                    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">                &#125;,</span><br><span class="line">                body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">                    errorMessage: error.errorMessage, <span class="comment">// æŠ¥é”™ä¿¡æ¯</span></span><br><span class="line">                    source: ret.source, <span class="comment">// æŠ¥é”™æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">                    line: ret.line, <span class="comment">// æŠ¥é”™æ–‡ä»¶è¡Œå·</span></span><br><span class="line">                    column: ret.column, <span class="comment">// æŠ¥é”™æ–‡ä»¶åˆ—å·</span></span><br><span class="line">                    stack: error.stack <span class="comment">// æŠ¥é”™å †æ ˆ</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> response.json();</span><br><span class="line">            &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">                res.json(json);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vueä¹‹JSXå°è£…table</title>
      <link href="/2020/01/17/workspace/Frame/vue/table-jsx/"/>
      <url>/2020/01/17/workspace/Frame/vue/table-jsx/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>vueä¹‹JSXå°è£…table</strong></p><p>[[toc]]</p><p><a href="https://cn.vuejs.org/v2/guide/render-function.html#%E6%B7%B1%E5%85%A5%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener">å°è£…ä¹‹å‰å…ˆçœ‹ä¸‹</a></p><p><a href="https://github.com/vuejs/babel-plugin-transform-vue-jsx" target="_blank" rel="noopener">babel-plugin-transform-vue-jsx</a></p><p>åŸºäºElementUIçš„tableäºŒæ¬¡å°è£…</p><p>æœ€è¿‘æä¸­å°å¼€å‘ï¼Œç”¨çš„ElementUIçš„Tableç»„ä»¶æ¯”è¾ƒå¤šï¼Œå‡ ä¹æ¯ä¸ªé¡µé¢éƒ½ç”¨ï¼Œç›¸æ¯”reactçš„antd,é¥¿äº†ä¹ˆçš„tableå°±ç›¸å¯¹è‡ƒè‚¿äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ¡†æ¶çš„åŸå› å§ã€‚</p><p>æœ¬æ¬¡å°è£…ç”¨çš„jsxè¯­æ³•ï¼Œvueæ¨¡æ¿æ‹“å±•æ€§ä¸æ˜¯ç‰¹åˆ«æ˜¾ä¼˜åŠ¿ï¼Œæ²¡æœ‰jsxçµæ´»ã€‚<a href="/workspace/Frame/vue/jsx.html">æƒ³çœ‹jsxåœ¨vueä¸­æ€ä¹ˆä½¿ç”¨çš„è¯·è½¬çœ‹ä¸‹ä¹‹å‰çš„æ–‡ç« </a></p><h3 id="ç»„ä»¶å°è£…æºç "><a href="#ç»„ä»¶å°è£…æºç " class="headerlink" title="ç»„ä»¶å°è£…æºç "></a>ç»„ä»¶å°è£…æºç </h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EnhanceTable.jsx</span></span><br><span class="line"><span class="keyword">import</span> table <span class="keyword">from</span> <span class="string">"../mixins/table"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  mixins: [table],</span><br><span class="line">  props: &#123;</span><br><span class="line">    otherTableParams: &#123; <span class="comment">// è®¾ç½®tableå…¶ä»–å‚æ•°</span></span><br><span class="line">      type: <span class="built_in">Object</span>,</span><br><span class="line">       <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;; <span class="comment">// Object/Arrayçš„å±æ€§å¿…é¡»ä½¿ç”¨å‡½æ•°è¿”å›é»˜è®¤å€¼  ç®­å¤´å‡½æ•°ä¸è¡Œ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    otherPaginationParams: &#123; <span class="comment">// è®¾ç½®åˆ†é¡µå…¶ä»–å‚æ•°</span></span><br><span class="line">      type: <span class="built_in">Object</span>,</span><br><span class="line">       <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    tableColumn: &#123; <span class="comment">// tableçš„column</span></span><br><span class="line">      type: <span class="built_in">Array</span>,</span><br><span class="line">       <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    multiple: &#123;</span><br><span class="line">      type: <span class="built_in">Boolean</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleButtons(item, record) &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†æ“ä½œéƒ¨åˆ†æŒ‰é’® -&gt; å¯ä»¥åœ¨å¤–é¢è‡ªå®šä¹‰ï¼Œå¿…é¡»æ˜¯jsx</span></span><br><span class="line">      <span class="keyword">if</span> (item.handleButtons) <span class="keyword">return</span> item.handleButtons(record);</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        !!item.list.length &amp;&amp; item.list.map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            &lt;el-button</span><br><span class="line">              disabled=&#123;item.disabled&#125;</span><br><span class="line">              key=&#123;item.title&#125;</span><br><span class="line">              type=<span class="string">"text"</span></span><br><span class="line">              size=<span class="string">"small"</span></span><br><span class="line">              style=&#123;item.styles&#125;</span><br><span class="line">              onClick=&#123;() =&gt; item.cb(record)&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;item.title&#125;</span><br><span class="line">            &lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">          )</span></span><br><span class="line"><span class="regexp">        &#125;)</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ handleCurrentChange(val) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/   this.$emit('currentChange', val);</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ &#125;,</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  mounted() &#123;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123;tableOptions, paginationOptions, paginationOptionsMethod, tableOptionsMethod, otherTableParams, tableColumn, multiple&#125; = this;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;el-table</span></span><br><span class="line"><span class="regexp">          &#123;...&#123;</span></span><br><span class="line"><span class="regexp">            props: &#123;</span></span><br><span class="line"><span class="regexp">              ...tableOptions,</span></span><br><span class="line"><span class="regexp">              ...otherTableParams.props,</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">            on: &#123;</span></span><br><span class="line"><span class="regexp">              ...tableOptionsMethod,</span></span><br><span class="line"><span class="regexp">              ...otherTableParams.on</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &#123;/</span>* tableå¤šé€‰ *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">          &#123;</span></span><br><span class="line"><span class="regexp">            multiple &amp;&amp; (</span></span><br><span class="line"><span class="regexp">              &lt;el-table-column</span></span><br><span class="line"><span class="regexp">                type="selection"</span></span><br><span class="line"><span class="regexp">                width="55"</span></span><br><span class="line"><span class="regexp">                fixed=&#123;'left'&#125;</span></span><br><span class="line"><span class="regexp">              /</span>&gt;</span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">          &#123;<span class="comment">/* tableåˆ—è¡¨ */</span>&#125;</span><br><span class="line">          &#123;</span><br><span class="line">            tableColumn.map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (item.type === <span class="string">'button'</span>) &#123;</span><br><span class="line">                <span class="comment">// æ“ä½œéƒ¨åˆ†</span></span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                  &lt;el-table-column</span><br><span class="line">                    label=&#123;item.label || <span class="string">'æ“ä½œ'</span>&#125;</span><br><span class="line">                    width=&#123;item.width || <span class="string">'88'</span>&#125;</span><br><span class="line">                    fixed=&#123;item.fixed || <span class="string">'right'</span>&#125;</span><br><span class="line">                    &#123;...&#123;</span><br><span class="line">                      scopedSlots: &#123;</span><br><span class="line">                        <span class="keyword">default</span>: <span class="function">(<span class="params">&#123;row&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                          <span class="keyword">return</span> <span class="keyword">this</span>.handleButtons(item, row)</span><br><span class="line">                        &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;&#125;</span><br><span class="line">                  /&gt;</span><br><span class="line">                )</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> (</span><br><span class="line">                &lt;el-table-column</span><br><span class="line">                  props=&#123;item&#125;</span><br><span class="line">                  key=&#123;item.prop&#125;</span><br><span class="line">                  &#123;...&#123;</span><br><span class="line">                    <span class="comment">// è‡ªå®šä¹‰çš„æ¸²æŸ“æ–¹å¼ï¼Œæ‹“å±•æ€§</span></span><br><span class="line">                    scopedSlots: &#123;</span><br><span class="line">                      <span class="keyword">default</span>: <span class="function">(<span class="params">&#123;row&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> item.render ? item.render(row[item.prop], row) : row[item.prop]</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;&#125;</span><br><span class="line">                /&gt;</span><br><span class="line">              )</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &lt;<span class="regexp">/el-table&gt;</span></span><br><span class="line"><span class="regexp">        &#123;/</span>*åˆ†é¡µ*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">        &lt;el-pagination</span></span><br><span class="line"><span class="regexp">          &#123;...&#123;</span></span><br><span class="line"><span class="regexp">            class: paginationOptions.class,  /</span><span class="regexp">/ æ”¯æŒæ‹“å±•</span></span><br><span class="line"><span class="regexp">            props: &#123;</span></span><br><span class="line"><span class="regexp">              ...paginationOptions,</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">            on: &#123;</span></span><br><span class="line"><span class="regexp">              ...paginationOptionsMethod</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><h3 id="EnhanceTable-æ–‡æ¡£"><a href="#EnhanceTable-æ–‡æ¡£" class="headerlink" title="EnhanceTable æ–‡æ¡£"></a>EnhanceTable æ–‡æ¡£</h3><h3 id="ç»„ä»¶ä½¿ç”¨"><a href="#ç»„ä»¶ä½¿ç”¨" class="headerlink" title="ç»„ä»¶ä½¿ç”¨"></a>ç»„ä»¶ä½¿ç”¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;enhance-table ref=<span class="string">"table"</span> :multiple=<span class="string">"true"</span> :otherTableParams=<span class="string">"otherTableParams"</span> :tableColumn=<span class="string">"column"</span></span><br><span class="line">    /&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  import EnhanceTable from "../</span>components/EnhanceTable<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  export default &#123;</span></span><br><span class="line"><span class="string">    data() &#123;</span></span><br><span class="line"><span class="string">      return &#123;</span></span><br><span class="line"><span class="string">        otherTableParams: &#123;// tableçš„å‚æ•°</span></span><br><span class="line"><span class="string">          props: &#123;</span></span><br><span class="line"><span class="string">            border: true,</span></span><br><span class="line"><span class="string">            stripe: true,</span></span><br><span class="line"><span class="string">            size: 'small',</span></span><br><span class="line"><span class="string">            'default-sort': &#123;prop: 'createTime', order: 'ascending'&#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        otherPaginationParams:&#123;&#125;,// åˆ†é¡µçš„å‚æ•°</span></span><br><span class="line"><span class="string">        column: [  // tableçš„åˆ—</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            prop: "</span>roleId<span class="string">",</span></span><br><span class="line"><span class="string">            label: "</span>åºå·<span class="string">",</span></span><br><span class="line"><span class="string">            width: 100,</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            prop: 'roleName',</span></span><br><span class="line"><span class="string">            label: "</span>è§’è‰²åç§°<span class="string">",</span></span><br><span class="line"><span class="string">            'width': "</span><span class="number">110</span><span class="string">"</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            prop: "</span>createTime<span class="string">",</span></span><br><span class="line"><span class="string">            label: "</span>åˆ›å»ºæ—¶é—´<span class="string">",</span></span><br><span class="line"><span class="string">            sortable: true</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            prop: 'roleName',</span></span><br><span class="line"><span class="string">            label: "</span>è§’è‰²åç§°<span class="string">",</span></span><br><span class="line"><span class="string">            //formatter  å®Œå…¨å¯ä»¥ç”¨renderä»£æ›¿</span></span><br><span class="line"><span class="string">            render: (text, record) =&gt; &#123; // å½“å‰è¡Œçš„å€¼ï¼Œå½“å‰è¡Œæ•°æ®</span></span><br><span class="line"><span class="string">              // console.log(record);</span></span><br><span class="line"><span class="string">              return &lt;h4&gt;&#123;text&#125;&lt;/h4&gt;</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123; // æœ€åçš„æ“ä½œåˆ—ï¼Œå¯æ ¹æ®listé‡Œé¢å±•ç¤ºè¦æ“ä½œçš„æŒ‰é’®ï¼Œå’Œå›è°ƒ</span></span><br><span class="line"><span class="string">            type: 'button',</span></span><br><span class="line"><span class="string">            width: '118',</span></span><br><span class="line"><span class="string">            label: "</span>è®¾ç½®<span class="string">",</span></span><br><span class="line"><span class="string">            list: [</span></span><br><span class="line"><span class="string">              &#123;title: 'æŸ¥çœ‹', disabled: false, styles: &#123;color: '#777'&#125;, cb: this.seeHandle&#125;,</span></span><br><span class="line"><span class="string">              &#123;title: 'ç¼–è¾‘', cb: this.editHandle&#125;</span></span><br><span class="line"><span class="string">            ],</span></span><br><span class="line"><span class="string">            // handleButtons: () =&gt; (&lt;div&gt;111&lt;/div&gt;)  // è‡ªå®šä¹‰çš„å†…å®¹</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    components: &#123;EnhanceTable&#125;,</span></span><br><span class="line"><span class="string">    methods: &#123;</span></span><br><span class="line"><span class="string">      queryList() &#123; // å­ç»„ä»¶é»˜è®¤çš„è¯·æ±‚åç§°</span></span><br><span class="line"><span class="string">        this.$nextTick(async () =&gt; &#123;  </span></span><br><span class="line"><span class="string">          // å› ä¸ºå½“å‰ç®—æ˜¯çˆ¶ç»„ä»¶ï¼Œå½“æ‰§è¡Œåˆ°çˆ¶ç»„ä»¶çš„createdå‘¨æœŸæ‰ä¼šæ‰§è¡Œå®ƒçš„å­ç»„ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å­ç»„ä»¶çš„dataçš„ä¸€äº›æ–¹æ³•è·å–ä¸åˆ°ï¼Œæˆ–è€…å¯ä»¥åœ¨mountedå‘¨æœŸé‡Œé¢æ‰§è¡Œå¼‚æ­¥è¯·æ±‚</span></span><br><span class="line"><span class="string">          const &#123;paginationOptions: &#123;pageSize, currentPage&#125;, handlePageData&#125; = this.$refs.table;// è·å–å­ç»„ä»¶mixinsé‡Œé¢çš„å‚æ•°</span></span><br><span class="line"><span class="string">          const &#123;data: &#123;items, page: &#123;totalRecord&#125;&#125;&#125; = </span></span><br><span class="line"><span class="string">          await this.$fetch(`http://xx..xx/role?pageSize=$&#123;pageSize&#125;&amp;pageNum=$&#123;currentPage&#125;`, &#123;</span></span><br><span class="line"><span class="string">            headers: &#123;</span></span><br><span class="line"><span class="string">              Authentication: 'xxxxx'</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">          &#125;);</span></span><br><span class="line"><span class="string">          handlePageData(items, totalRecord);  // mixiné‡Œé¢ç»Ÿä¸€å¤„ç†</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      editHandle(...options) &#123;</span></span><br><span class="line"><span class="string">        console.log(options, 'ç¼–è¾‘');</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      seeHandle(...options) &#123;</span></span><br><span class="line"><span class="string">        console.log(options, 'æŸ¥çœ‹');</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    created() &#123;</span></span><br><span class="line"><span class="string">      this.queryList();//å¿…é¡»æ˜¯è¿™ä¸ªåç§° </span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    mounted() &#123;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;style type="</span>text/scss<span class="string">" lang="</span>scss<span class="string">" scoped&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æœ€ååœ¨é€ä¸€ä¸ªå½“å‰ä½¿ç”¨çš„mixins"><a href="#æœ€ååœ¨é€ä¸€ä¸ªå½“å‰ä½¿ç”¨çš„mixins" class="headerlink" title="æœ€ååœ¨é€ä¸€ä¸ªå½“å‰ä½¿ç”¨çš„mixins"></a>æœ€ååœ¨é€ä¸€ä¸ªå½“å‰ä½¿ç”¨çš„mixins</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// table.mixins.js</span></span><br><span class="line"><span class="keyword">const</span> table = &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      tableOptions: &#123;</span><br><span class="line">        data: [], <span class="comment">// åˆ—è¡¨æ•°æ®</span></span><br><span class="line">        border: <span class="literal">true</span>, <span class="comment">// å¸¦è¾¹æ¡†</span></span><br><span class="line">        style: <span class="string">"width: 100%"</span>,</span><br><span class="line">        size: <span class="string">"small"</span>,</span><br><span class="line">        multipleSelection: [], <span class="comment">// åˆ—è¡¨å¤šé€‰</span></span><br><span class="line">      &#125;,</span><br><span class="line">      tableOptionsMethod: &#123;</span><br><span class="line">        <span class="string">"selection-change"</span>: <span class="keyword">this</span>.handleSelectionChange</span><br><span class="line">      &#125;,</span><br><span class="line">      paginationOptions: &#123;</span><br><span class="line">        class: "fyDiv",</span><br><span class="line">        background: <span class="literal">true</span>, <span class="comment">// å¸¦æœ‰èƒŒæ™¯è‰²</span></span><br><span class="line">        layout: <span class="string">"total, sizes, prev, pager, next"</span>,</span><br><span class="line">        pageSizes: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>],</span><br><span class="line">        total: <span class="number">0</span>, <span class="comment">// åº”ç”¨åˆ—è¡¨æ€»æ•°é‡</span></span><br><span class="line">        pageSize: <span class="number">10</span>, <span class="comment">// å½“å‰åˆ†é¡µæ•°é‡</span></span><br><span class="line">        currentPage: <span class="number">1</span>, <span class="comment">// å½“å‰é¡µæ•°ç¬¬ä¸€é¡µ</span></span><br><span class="line">        showPage: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦æ˜¾ç¤ºåˆ†é¡µç»„ä»¶,å¿…é¡»totalæ€»æ•°ä¹Ÿè¦å°äºå½“å‰è¦å±•ç¤ºçš„é¡µæ•°</span></span><br><span class="line">      &#125;,</span><br><span class="line">      paginationOptionsMethod: &#123;</span><br><span class="line">        <span class="string">"size-change"</span>: <span class="keyword">this</span>.handleSizeChange,</span><br><span class="line">        <span class="string">"current-change"</span>: <span class="keyword">this</span>.handleCurrentChange</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// è·å–æ•°æ®å›è°ƒå¤„ç†åˆ†é¡µå’Œdata</span></span><br><span class="line">    handlePageData(data, total) &#123;</span><br><span class="line">      <span class="keyword">this</span>.tableOptions.data = data;</span><br><span class="line">      <span class="comment">// å¦‚æœè¿˜æœ‰ä¸‹ä¸€é¡µï¼Œåˆ™æ˜¾ç¤ºåˆ†é¡µæ’ä»¶</span></span><br><span class="line">      <span class="keyword">if</span> (total &gt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.paginationOptions.showPage = <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.paginationOptions.showPage = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.paginationOptions.currentPage = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.paginationOptions.pageSize = <span class="number">10</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.paginationOptions.total = total;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// é€‰é¡¹å˜åŒ–</span></span><br><span class="line">    handleSelectionChange(multipleSelection) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(multipleSelection, <span class="string">"é€‰ä¸­"</span>);</span><br><span class="line">      <span class="keyword">this</span>.tableOptions.multipleSelection = multipleSelection;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æ”¹å˜é¡µæ•°</span></span><br><span class="line">    handleCurrentChange(currentPage) &#123;</span><br><span class="line">      <span class="keyword">this</span>.paginationOptions.currentPage = currentPage;</span><br><span class="line">      <span class="keyword">this</span>.queryList ? <span class="keyword">this</span>.queryList() : <span class="keyword">this</span>.$parent.queryList();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// é€‰æ‹©é¡µæ•°</span></span><br><span class="line">    handleSizeChange(currentSize) &#123;</span><br><span class="line">      <span class="keyword">this</span>.paginationOptions.pageSize = currentSize;</span><br><span class="line">      <span class="keyword">this</span>.paginationOptions.currentPage = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">this</span>.queryList ? <span class="keyword">this</span>.queryList() : <span class="keyword">this</span>.$parent.queryList();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æœç´¢ä¸“ç”¨</span></span><br><span class="line">    handleSearchChange(page = <span class="number">1</span>, size = <span class="number">10</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.paginationOptions.pageSize = size;</span><br><span class="line">      <span class="keyword">this</span>.paginationOptions.currentPage = page;</span><br><span class="line">      <span class="keyword">this</span>.queryList ? <span class="keyword">this</span>.queryList() : <span class="keyword">this</span>.$parent.queryList();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> table;</span><br></pre></td></tr></table></figure><h3 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h3><p>å½“å‰çš„tableç»„ä»¶æ˜¯é’ˆå¯¹è‡ªå·±é¡¹ç›®çš„éœ€æ±‚å°è£…ï¼Œå…¼å®¹äº†é¥¿äº†ä¹ˆtableå¤§éƒ¨åˆ†çš„ä¸šåŠ¡åœºæ™¯ï¼Œéšç€åæœŸçš„ä¸šåŠ¡æ‹“å±•ï¼Œå½“å‰çš„ç»„ä»¶çš„æ‹“å±•æ€§ä¹Ÿä¼šå¢å¼ºï¼Œå°è£…è·¯æ¼«æ¼«ï¼Œä¸€ç‚¹ç‚¹å®Œå–„å§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> ç»„ä»¶å°è£… </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å°è£…æ ‘å½¢èœå•</title>
      <link href="/2020/01/17/workspace/Frame/vue/tree-menu/"/>
      <url>/2020/01/17/workspace/Frame/vue/tree-menu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>å°è£…æ ‘å½¢èœå•</strong></p><p>ä¹‹å‰é¢è¯•æœ‰è®©ç”¨reactåšè¿‡ä¸€æ¬¡ ï¼Œä»Šå¤©ä»¿é€ elementUIç”¨Vueåœ¨åšä¸€ä¸ª</p><p><strong>è€å¥—è·¯å…ˆçœ‹çœ‹æ€ä¹ˆä½¿ç”¨çš„</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…·ä½“ä½¿ç”¨</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=<span class="string">"test"</span>&gt;</span><br><span class="line">    &lt;trees :data=<span class="string">"treeData"</span> :treeProps=<span class="string">"treeProps"</span>&gt;&lt;<span class="regexp">/trees&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  import trees from "./</span>../test/index<span class="string">";</span></span><br><span class="line"><span class="string">  export default &#123;</span></span><br><span class="line"><span class="string">    data() &#123;</span></span><br><span class="line"><span class="string">      return &#123;</span></span><br><span class="line"><span class="string">        treeProps: &#123;</span></span><br><span class="line"><span class="string">          children: 'children',</span></span><br><span class="line"><span class="string">          label: 'name'</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        treeData: [&#123;</span></span><br><span class="line"><span class="string">            name: "</span>ä¸€çº§ <span class="number">1</span><span class="string">",</span></span><br><span class="line"><span class="string">            children: [&#123;</span></span><br><span class="line"><span class="string">              name: "</span>äºŒçº§ <span class="number">1</span><span class="number">-1</span><span class="string">",</span></span><br><span class="line"><span class="string">              children: [&#123;</span></span><br><span class="line"><span class="string">                name: "</span>ä¸‰çº§ <span class="number">1</span><span class="number">-1</span><span class="number">-1</span><span class="string">"</span></span><br><span class="line"><span class="string">              &#125;]</span></span><br><span class="line"><span class="string">            &#125;]</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            name: "</span>ä¸€çº§ <span class="number">2</span><span class="string">",</span></span><br><span class="line"><span class="string">            children: [&#123;</span></span><br><span class="line"><span class="string">                name: "</span>äºŒçº§ <span class="number">2</span><span class="number">-1</span><span class="string">",</span></span><br><span class="line"><span class="string">                children: [&#123;</span></span><br><span class="line"><span class="string">                  name: "</span>ä¸‰çº§ <span class="number">2</span><span class="number">-1</span><span class="number">-1</span><span class="string">"</span></span><br><span class="line"><span class="string">                &#125;]</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                name: "</span>äºŒçº§ <span class="number">2</span><span class="number">-2</span><span class="string">",</span></span><br><span class="line"><span class="string">                children: [&#123;</span></span><br><span class="line"><span class="string">                  name: "</span>ä¸‰çº§ <span class="number">2</span><span class="number">-2</span><span class="number">-1</span><span class="string">"</span></span><br><span class="line"><span class="string">                &#125;]</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            ]</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            name: "</span>ä¸€çº§ <span class="number">3</span><span class="string">",</span></span><br><span class="line"><span class="string">            children: [&#123;</span></span><br><span class="line"><span class="string">                name: "</span>äºŒçº§ <span class="number">3</span><span class="number">-1</span><span class="string">",</span></span><br><span class="line"><span class="string">                children: [&#123;</span></span><br><span class="line"><span class="string">                  name: "</span>ä¸‰çº§ <span class="number">3</span><span class="number">-1</span><span class="number">-1</span><span class="string">"</span></span><br><span class="line"><span class="string">                &#125;]</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                name: "</span>äºŒçº§ <span class="number">3</span><span class="number">-2</span><span class="string">",</span></span><br><span class="line"><span class="string">                children: [&#123;</span></span><br><span class="line"><span class="string">                  name: "</span>ä¸‰çº§ <span class="number">3</span><span class="number">-2</span><span class="number">-1</span><span class="string">"</span></span><br><span class="line"><span class="string">                &#125;]</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            ]</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    components: &#123;</span></span><br><span class="line"><span class="string">      trees</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p><strong>å­ç»„ä»¶çš„å°è£…</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// èœå•èŠ‚ç‚¹</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;li&gt;</span><br><span class="line">        &lt;span @click=<span class="string">"toggle"</span> &gt;</span><br><span class="line">            &lt;span v-<span class="keyword">if</span>=<span class="string">"hasChild"</span> &gt;&#123;&#123;isOpen ? <span class="string">'down'</span> : <span class="string">'up'</span>&#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">            &lt;!-- æœ«èœå• --&gt;</span></span><br><span class="line"><span class="regexp">            &lt;span v-if="!hasChild" &gt;'='&lt;/</span>span&gt; </span><br><span class="line">            &#123;&#123; data[treeProps.label] &#125;&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ å¦‚æœè¿˜æœ‰å­é›†èœå•ï¼Œç»§ç»­é€’å½’</span></span><br><span class="line"><span class="regexp">        &lt;ul v-show="isOpen" v-if="hasChild"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;tree-item v-for="(item, index) in data[treeProps.children]" :data="item" :key="index" :treeProps="treeProps" &gt;&lt;/</span>tree-item&gt;</span><br><span class="line">        &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>li&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">    name: 'TreeItem', /</span><span class="regexp">/é€’å½’ç»„ä»¶å¿…é¡»æœ‰name</span></span><br><span class="line"><span class="regexp">    props: &#123;</span></span><br><span class="line"><span class="regexp">        data: &#123;</span></span><br><span class="line"><span class="regexp">            type: [Object, Array], /</span><span class="regexp">/å¤šä¸ªå¯èƒ½çš„ç±»å‹</span></span><br><span class="line"><span class="regexp">            required: true</span></span><br><span class="line"><span class="regexp">        &#125;,</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ labelã€children é»˜è®¤å€¼</span></span><br><span class="line"><span class="regexp">      treeProps:&#123;</span></span><br><span class="line"><span class="regexp">          type:Object,</span></span><br><span class="line"><span class="regexp">          default:()=&gt;(&#123;</span></span><br><span class="line"><span class="regexp">            children:'children',</span></span><br><span class="line"><span class="regexp">            label:'label'</span></span><br><span class="line"><span class="regexp">          &#125;)</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    data() &#123;</span></span><br><span class="line"><span class="regexp">        return &#123;</span></span><br><span class="line"><span class="regexp">            isOpen: false,</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    computed: &#123;</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ åˆ¤æ–­å½“å‰çº§åˆ«æ˜¯å¦è¿˜æœ‰children</span></span><br><span class="line"><span class="regexp">        hasChild() &#123;</span></span><br><span class="line"><span class="regexp">            return this.data[this.treeProps.children] &amp;&amp; this.data[this.treeProps.children].length</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    methods: &#123;</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ ç‚¹å‡»å­èœå•ä¹Ÿè¦åˆ¤æ–­æ˜¯å¦æœ‰childrenï¼Œæœ‰å°±å±•å¼€</span></span><br><span class="line"><span class="regexp">        toggle() &#123;</span></span><br><span class="line"><span class="regexp">            if(this.hasChild) &#123;</span></span><br><span class="line"><span class="regexp">                this.isOpen = !this.isOpen</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">ul &#123;</span><br><span class="line">    list-style: none;</span><br><span class="line">    margin: <span class="number">10</span>px <span class="number">0</span>;</span><br><span class="line">    padding-left: <span class="number">20</span>px;</span><br><span class="line">&#125;</span><br><span class="line">li &#123;</span><br><span class="line">      color: #000;</span><br><span class="line">&#125;</span><br><span class="line">li &gt; span &#123;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    font-size: <span class="number">14</span>px;</span><br><span class="line">    line-height: <span class="number">20</span>px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// èœå•æ ‡é¢˜</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ul v-<span class="keyword">for</span>=<span class="string">"(item,index) in data"</span> :key=<span class="string">"index"</span>&gt;</span><br><span class="line">      &lt;tree-item :data=<span class="string">"item"</span> :treeProps=<span class="string">"treeProps"</span>&gt;&lt;<span class="regexp">/tree-item&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/u</span>l&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">import</span> treeItem <span class="keyword">from</span> <span class="string">'./item'</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        type: [<span class="built_in">Object</span>, <span class="built_in">Array</span>],</span><br><span class="line">        required: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      treeProps: &#123;</span><br><span class="line">        type: <span class="built_in">Object</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">          children: <span class="string">'children'</span>,</span><br><span class="line">          label: <span class="string">'label'</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      treeItem</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>è·Ÿreactå¤§åŒå°å¼‚ï¼Œä¾æ—§æ˜¯ç”¨äº†é€’å½’çš„æ€æƒ³ï¼Œä¸è¿‡vueçš„è¿™ä¸ªç»„ä»¶è‡ªèº«é€’å½’çœ‹çš„å¾ˆæ–°å¥‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Vue </category>
          
          <category> ç»„ä»¶å°è£… </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="/2020/01/16/test/"/>
      <url>/2020/01/16/test/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">abbrlink: ee34d04d</span><br><span class="line">categories: TypeScript</span><br><span class="line">tags: JS Notes</span><br><span class="line">title:  MAC æ•´ç†</span><br><span class="line">hidden: <span class="literal">true</span></span><br><span class="line">date: <span class="number">2019</span><span class="number">-05</span><span class="number">-16</span></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">abbrlink: <span class="string">'214639e1'</span></span><br><span class="line">categories: </span><br><span class="line">- TypeScript</span><br><span class="line">title: TypeScript</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">abbrlink: <span class="number">1301e6</span>de</span><br><span class="line">categories: </span><br><span class="line">- TypeScript</span><br><span class="line">title: æ¨èåº“</span><br><span class="line">top: <span class="literal">true</span></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">abbrlink: <span class="number">2</span>b423c9</span><br><span class="line">categories: </span><br><span class="line">- TypeScript</span><br><span class="line">- jest</span><br><span class="line">title: TypeScript</span><br><span class="line">sticky: <span class="number">10086</span></span><br><span class="line">---</span><br></pre></td></tr></table></figure><div class="note default">            <p>defaultæç¤ºå—æ ‡ç­¾</p>          </div><div class="note primary no-icon">            <p>primaryæç¤ºå—æ ‡ç­¾</p>          </div><div class="note success">            <p>successæç¤ºå—æ ‡ç­¾</p>          </div><div class="note info">            <p>infoæç¤ºå—æ ‡ç­¾</p>          </div><div class="note warning">            <p>warningæç¤ºå—æ ‡ç­¾</p>          </div><div class="note danger">            <p>dangeræç¤ºå—æ ‡ç­¾</p>          </div>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é…ç½®WS</title>
      <link href="/2020/01/16/other/ws-configure/"/>
      <url>/2020/01/16/other/ws-configure/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>é…ç½®WS</strong></p><p>[[toc]]</p><h3 id="webstorm-ä»£ç æ ¼å¼åŒ–è®¾ç½®ä¸eslint-standardä¸€è‡´"><a href="#webstorm-ä»£ç æ ¼å¼åŒ–è®¾ç½®ä¸eslint-standardä¸€è‡´" class="headerlink" title="webstorm ä»£ç æ ¼å¼åŒ–è®¾ç½®ä¸eslint standardä¸€è‡´"></a>webstorm ä»£ç æ ¼å¼åŒ–è®¾ç½®ä¸eslint standardä¸€è‡´</h3><p>æ–°å¼„äº†ä¸ªvueé¡¹ç›®ï¼Œä½¿ç”¨çš„eslintæ˜¯standardè§„èŒƒã€‚</p><p>æ–°å»ºé¡¹ç›®ï¼Œç”¨webstormæ‰“å¼€é¡¹ç›®ï¼Œé¡ºåˆ©å¼€æï¼Œç»“æœä¸€åˆ°vueç»„ä»¶é‡Œï¼Œå°±æŠ¥é»„è‰²å¹å·è­¦å‘Šâš ï¸äº†ã€‚</p><p>è¿™é‡Œå°±éœ€è¦é…ç½®ä¸€ä¸‹webstormé‡Œçš„ <code>code style</code></p><p><code>command + &#39;,&#39;</code>æ‰“å¼€è®¾ç½® -&gt; <code>Editor</code></p><h4 id="é…ç½®jsæ ¼å¼åŒ–è§„èŒƒ"><a href="#é…ç½®jsæ ¼å¼åŒ–è§„èŒƒ" class="headerlink" title="é…ç½®jsæ ¼å¼åŒ–è§„èŒƒ"></a>é…ç½®jsæ ¼å¼åŒ–è§„èŒƒ</h4><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H86506f0d0b25471d9826e543af0bc40cz.jpg" alt=""><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hbf762eeef1074a3aa8d614167de006355.jpg" alt=""><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hf694848fcefb4849a3171f607dec5c99W.jpg" alt=""><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Ha4e8713c7aeb4dc19bfddb5df4e67146l.jpg" alt=""></p><h4 id="é…ç½®html-vueç»„ä»¶"><a href="#é…ç½®html-vueç»„ä»¶" class="headerlink" title="é…ç½®html/vueç»„ä»¶"></a>é…ç½®html/vueç»„ä»¶</h4><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H0e31c6cdba2e4cf5b1430509f83ad1bcF.jpg" alt=""></p><p>åœ¨do not indent children ofé‡ŒåŠ å…¥scriptæ ‡ç­¾</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Ha11bf52407204bc496b2b54e4ba314eeM.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
          <category> é…ç½®WS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WebStorm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²</title>
      <link href="/2020/01/16/workspace/Jenkins/base/"/>
      <url>/2020/01/16/workspace/Jenkins/base/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²</strong></p><p>[[toc]]</p><p><strong>Jenkinså­¦ä¹ è®°å½•</strong></p><p>å­¦å‰äº†è§£ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">linux  shell</span><br><span class="line">jenkins</span><br><span class="line">jdk tomcat </span><br><span class="line">Java Development Kitæ˜¯æ•´ä¸ªJavaæ ¸å¿ƒï¼ŒåŒ…æ‹¬Javaè¿è¡Œç¯å¢ƒã€Javaå·¥å…·å’ŒJavaåŸºç¡€ç±»åº“ã€‚JDKä½œä¸ºJAVAå¼€å‘çš„ç¯å¢ƒï¼Œä¸ç®¡åšJAVAå¼€å‘è¿˜æ˜¯åšå®‰å“å¼€å‘ï¼Œéƒ½å¿…é¡»åœ¨ç”µè„‘ä¸Šå®‰è£…JDK</span><br><span class="line">tomcat:ç”±Apacheç»„ç»‡æä¾›çš„ä¸€ç§WebæœåŠ¡å™¨,æä¾›å¯¹jspå’ŒServletçš„æ”¯æŒã€‚å®ƒæ˜¯ä¸€ç§è½»é‡çº§çš„javaWebå®¹å™¨(æœåŠ¡å™¨),ä¹Ÿæ˜¯å½“å‰åº”ç”¨æœ€å¹¿çš„JavaWebæœåŠ¡å™¨(å…è´¹)</span><br><span class="line"></span><br><span class="line">node npm</span><br><span class="line">ssh</span><br><span class="line">git github</span><br><span class="line">docker</span><br></pre></td></tr></table></figure><h3 id="Why-Jenkins"><a href="#Why-Jenkins" class="headerlink" title="Why Jenkins"></a>Why Jenkins</h3><p><code>æ˜¯ä¸šç•Œæµè¡Œå¼€æºçš„æŒç»­é›†æˆçš„å·¥å…·ï¼Œå¹¿æ³›ç”¨äºé¡¹ç›®å¼€å‘ï¼Œå…·æœ‰è‡ªåŠ¨åŒ–æ„å»ºï¼Œæµ‹è¯•ï¼Œéƒ¨ç½²ç­‰åŠŸèƒ½</code></p><p> CI æŒç»­é›†æˆ</p><p> CD æŒç»­éƒ¨ç½²</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/jenkins.jpeg'/><h3 id="é…ç½®jdkå®‰è£…Javaç¯å¢ƒ"><a href="#é…ç½®jdkå®‰è£…Javaç¯å¢ƒ" class="headerlink" title="é…ç½®jdkå®‰è£…Javaç¯å¢ƒ"></a>é…ç½®jdkå®‰è£…Javaç¯å¢ƒ</h3><p><code>jenkinsæ˜¯javaç¼–å†™çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£…jdk</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;src &#x2F;&#x2F;é€‰æ‹©ä¸‹è½½ç›®å½•</span><br><span class="line"></span><br><span class="line">wget https:&#x2F;&#x2F;download.oracle.com&#x2F;otn&#x2F;java&#x2F;jdk&#x2F;8u221-b11&#x2F;230deb18db3e4014bb8e3e8324f81b43&#x2F;jdk-8u221-linux-x64.tar.gz</span><br><span class="line">wget http:&#x2F;&#x2F;img.zhufengpeixun.cn&#x2F;jdk1.8.0_211.tar.gz  &#x2F;&#x2F;ä¸‹è½½ç›®å½•å¤‡ä»½</span><br><span class="line"></span><br><span class="line">tar -xzvf [name] &#x2F;&#x2F;è§£å‹</span><br><span class="line"></span><br><span class="line">mkdir &#x2F;usr&#x2F;java &#x2F;&#x2F;åˆ›å»ºJavaçš„ç›®å½•</span><br><span class="line"></span><br><span class="line">cp -r [name]   &#x2F;usr&#x2F;java &#x2F;&#x2F;copy</span><br><span class="line"></span><br><span class="line">ln -s  &#x2F;usr&#x2F;java&#x2F;[name]&#x2F;bin&#x2F;java &#x2F;usr&#x2F;bin&#x2F;java   &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥ or åˆ›å»ºå…¨å±€å˜é‡</span><br><span class="line"></span><br><span class="line">java -version &#x2F;&#x2F;æŸ¥çœ‹ç‰ˆæœ¬å·æ˜¯å¦æˆåŠŸ</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-å¯åŠ¨-Jenkins"><a href="#é…ç½®-å¯åŠ¨-Jenkins" class="headerlink" title="é…ç½®/å¯åŠ¨ Jenkins"></a>é…ç½®/å¯åŠ¨ Jenkins</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">cd /etc/yum.repos.d</span><br><span class="line"></span><br><span class="line">wget http:<span class="comment">//pkg.jenkins.io/redhat/jenkins.repo   //å®‰è£…æº</span></span><br><span class="line"></span><br><span class="line">rpm --<span class="keyword">import</span> http:<span class="comment">//pkg.jenkins.io/redhat/jenkins.io.key//å¯¼å…¥éªŒè¯çš„key</span></span><br><span class="line"></span><br><span class="line">yum install -y jenkins     <span class="comment">//yumå®‰è£…</span></span><br><span class="line"></span><br><span class="line">service jenkins start/stop/restart</span><br><span class="line"></span><br><span class="line">æ‰“å¼€ <span class="string">`http://120.79.229.197:8080`</span>  <span class="comment">//æ‰“å¼€jenkins</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//ip/exit //å…³é—­jenkinsæœåŠ¡.</span></span><br><span class="line">http:<span class="comment">//ip/reload //é‡æ–°åŠ è½½é…ç½®ä¿¡æ¯</span></span><br><span class="line">http:<span class="comment">//ip/restart //é‡å¯</span></span><br><span class="line"></span><br><span class="line">-------------</span><br><span class="line"></span><br><span class="line">systemctl start  mysqld.service</span><br><span class="line">systemctl start  docker</span><br><span class="line">docker ps -a</span><br><span class="line">docker start  [name]</span><br></pre></td></tr></table></figure><h4 id="å¦‚æœæ˜¯wget-å®‰è£…çš„è¯"><a href="#å¦‚æœæ˜¯wget-å®‰è£…çš„è¯" class="headerlink" title="å¦‚æœæ˜¯wget å®‰è£…çš„è¯"></a>å¦‚æœæ˜¯wget å®‰è£…çš„è¯</h4><p><code>å¯åŠ¨jenkins</code><br/><br>java -jar jenkins.war â€“httpPort=8081</p><p><code>å¦‚æœæƒ³è¦åœ¨linuxåå°ä¸€ç›´è¿è¡Œï¼Œåˆ™è¦å¼€å§‹åŠ nohupï¼Œåœ¨æœ«å°¾åŠ &amp;å·</code><br/><br>nohup java -jar jenkins.war â€“httpPort=8081 &amp;</p><p>å¯åŠ¨å ä¼šç”Ÿæˆä¸€ä¸ªnohup.outè¾“å‡ºï¼Œéœ€è¦çš„è¯ï¼Œå¯ä»¥tail -f nohup.outå®æ—¶æŸ¥çœ‹æ—¥å¿—</p><p><code>åˆ—å‡ºjenkinsçš„æ‰€æœ‰è¿›ç¨‹</code><br/><br>ps -aux|grep jenkins</p><p><code>æ€æ­»è¿™ä¸ªè¿›ç¨‹</code><br/><br>kill -9 [PID]</p><h4 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h4><p>è´¦å·ï¼šadmin <br/><br>å¯†ç ï¼š<code>cat /var/lib/jenkins/secrets/initialAdminPassword</code>ï¼ˆåˆå§‹å¯†ç ï¼‰</p><h3 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h3><p>é¦–å…ˆé‡ç½®å®‰è£…æºï¼Œåˆ‡æ¢åˆ°ä¸­å›½çš„é•œåƒ</p><p>ç³»ç»Ÿç®¡ç†-&gt;æ’ä»¶ç®¡ç†-&gt;é«˜çº§-&gt;å‡çº§çš„ç«™ç‚¹</p><p><code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code> æ¸…åå¤§å­¦çš„ç«™ç‚¹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Generic Webhook Trigger  <span class="comment">//webè§¦å‘å™¨</span></span><br><span class="line"></span><br><span class="line">Publish Over SSH  <span class="comment">//é€šè¿‡sshéƒ¨ç½²æœåŠ¡å™¨</span></span><br><span class="line"></span><br><span class="line">nvm wrapper   <span class="comment">//æä¾›nodeç¯å¢ƒ </span></span><br><span class="line"></span><br><span class="line">Role-based Authorization Strategy<span class="comment">//å¢åŠ ç”¨æˆ·çš„æƒé™ç®¡ç†</span></span><br></pre></td></tr></table></figure><h4 id="æ‰‹åŠ¨ä¸‹è½½jenkinsæ’ä»¶"><a href="#æ‰‹åŠ¨ä¸‹è½½jenkinsæ’ä»¶" class="headerlink" title="æ‰‹åŠ¨ä¸‹è½½jenkinsæ’ä»¶"></a>æ‰‹åŠ¨ä¸‹è½½jenkinsæ’ä»¶</h4><p>æ’ä»¶ä¸‹è½½åœ°å€ï¼š<code>http://updates.jenkins-ci.org/download/plugins/</code></p><p>å¦‚æœæœ‰æ’ä»¶ä¸€ç›´å®‰è£…å¤±è´¥çš„æƒ…å†µï¼Œå¯ä»¥ä»jenkinså®˜ç½‘ä¸‹è½½æ’ä»¶ï¼Œç„¶åå¯¼å…¥åˆ°jenkinsã€‚</p><p>ç¤ºä¾‹ï¼šæˆ‘ä»å®˜æ–¹ä¸‹è½½gitlab-pluginæ’ä»¶åˆ°æœ¬åœ°ï¼Œç„¶åå¯¼å…¥åˆ°jenkinsä¸­ã€‚</p><p>åœ¨jenkins<code>æ’ä»¶ç®¡ç†-&gt;é«˜çº§</code>é€‰æ‹©ä¸Šä¼ æ’ä»¶è¿›è¡Œå®‰è£…ã€‚</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/plugin.png'/><h3 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è®¾ç½®å¼€æœºå¯ç”¨é˜²ç«å¢™ï¼šsystemctl enable firewalld.service</span><br><span class="line">è®¾ç½®å¼€æœºç¦ç”¨é˜²ç«å¢™ï¼šsystemctl disable firewalld.service</span><br><span class="line">å¯åŠ¨é˜²ç«å¢™ï¼šsystemctl start firewalld</span><br><span class="line">å…³é—­é˜²ç«å¢™ï¼šsystemctl stop firewalld.service</span><br><span class="line">æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ï¼šsystemctl status firewalld</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ é¡¹ç›®"><a href="#æ·»åŠ é¡¹ç›®" class="headerlink" title="æ·»åŠ é¡¹ç›®"></a>æ·»åŠ é¡¹ç›®</h3><p>æ–°å»ºä¸€ä¸ªä»»åŠ¡[name]-&gt;æ„æ¶ä¸€ä¸ªè‡ªç”±é£æ ¼çš„é¡¹ç›®-&gt;ç¡®å®š</p><p>æºä»£ç -&gt;git-&gt;<a href="https://github.com/hzfvictory/weapp.git-&gt;æ·»åŠ æƒé™ã€git" target="_blank" rel="noopener">https://github.com/hzfvictory/weapp.git-&gt;æ·»åŠ æƒé™ã€git</a> çš„ç”¨æˆ·åå’Œå¯†ç ã€‘-&gt;æ„å»ºè§¦å‘å™¨(Generic Webhook Trigger)-&gt;åº”ç”¨ä¿å­˜</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/addGit.png'/><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/trigger.png'/><h3 id="é…ç½®webhook"><a href="#é…ç½®webhook" class="headerlink" title="é…ç½®webhook"></a>é…ç½®webhook</h3><p>æ­¤æ—¶å¯ä»¥æ„å»ºäº†ï¼Œä½†æ˜¯éœ€è¦åœ¨è¿˜ç»™Gitä¸­æ·»åŠ Webhooksï¼Œå¦åˆ™ä¸èƒ½è‡ªåŠ¨åŒ–æ„å»º</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/webhooks.png'/><p><code>http://JENKINS_URL/generic-webhook-trigger/invoke</code> </p><p>JENKINS_URLæ ¼å¼ä¸º <code>ç”¨æˆ·å:token@ip:8080</code></p><p><strong>tokenç”Ÿæˆçš„ä½ç½®</strong><br/><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/token.png'/></p><p>admin<br/><br>1108c27bdd32e70d8ba6ba7893bcf57450<br/><br>120.79.229.197:8080<br/><br><a href="http://admin:1108c27bdd32e70d8ba6ba7893bcf57450@120.79.229.197:8080/generic-webhook-trigger/invoke" target="_blank" rel="noopener">http://admin:1108c27bdd32e70d8ba6ba7893bcf57450@120.79.229.197:8080/generic-webhook-trigger/invoke</a></p><h3 id="è§¦å‘"><a href="#è§¦å‘" class="headerlink" title="è§¦å‘"></a>è§¦å‘</h3><p>æ‰‹åŠ¨è§¦å‘ï¼ŒæŸ¥çœ‹æ—¥å¿—æ˜¯å¦æˆåŠŸ<br/><br>ä»£ç é»˜è®¤ç›®å½•,åœ¨æ§åˆ¶å°æŸ¥çœ‹  cd /var/lib/jenkins/workspace/[name]</p><p>ä¹Ÿå¯ä»¥Gitæäº¤ä¸€ç‰ˆä»£ç è§¦å‘çœ‹æ˜¯å¦æˆåŠŸ</p><h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><p>ä¸‹æ‹‰ä»»åŠ¡åå­—-&gt;é…ç½®-&gt;æ„å»ºç¯å¢ƒï¼ˆé€‰ä¸­Run the build in an NVM managed environmentï¼Œã€æˆ‘ä»¬è‡ªå·±ä¸‹è½½çš„æ’ä»¶æä¾›nodeç¯å¢ƒã€‘ï¼‰-&gt;<br>è¾“å…¥nodeçš„ç‰ˆæœ¬å·-&gt;æ„å»º-&gt;é€‰æ‹©shell</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/nvm.png'/><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo $GIT_BRANCH</span><br><span class="line">npm config set registry https:&#x2F;&#x2F;registry.npm.taobao.org</span><br><span class="line">npm install -g yarn </span><br><span class="line">yarn config set registry https:&#x2F;&#x2F;registry.npm.taobao.org</span><br><span class="line">yarn install</span><br><span class="line">yarn global add @tarojs&#x2F;cli@1.3.14</span><br><span class="line">yarn build:h5</span><br><span class="line">tar -czvf dist.tar.gz dist&#x2F;h5</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ æœåŠ¡å™¨çš„ç§é’¥"><a href="#æ·»åŠ æœåŠ¡å™¨çš„ç§é’¥" class="headerlink" title="æ·»åŠ æœåŠ¡å™¨çš„ç§é’¥"></a>æ·»åŠ æœåŠ¡å™¨çš„ç§é’¥</h3><p>ç³»ç»Ÿç®¡ç†-&gt;ç³»ç»Ÿè®¾ç½®-&gt;Publish over SSH</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/ssh.png'/><h3 id="é…ç½®å…è´¹ç™»å½•ï¼ˆåŒä¸€å°ä¹Ÿè¦ï¼‰"><a href="#é…ç½®å…è´¹ç™»å½•ï¼ˆåŒä¸€å°ä¹Ÿè¦ï¼‰" class="headerlink" title="é…ç½®å…è´¹ç™»å½•ï¼ˆåŒä¸€å°ä¹Ÿè¦ï¼‰"></a>é…ç½®å…è´¹ç™»å½•ï¼ˆåŒä¸€å°ä¹Ÿè¦ï¼‰</h3><p>ssh-keygen -t rsa</p><p>ssh-copy-id 120.79.229.197</p><p><code>è¿™é‡Œä¸é…ç½®å…ç™»å½•ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°è¦éƒ¨ç½²çš„æœåŠ¡å™¨</code></p><h3 id="æ„å»ºåæ“ä½œ"><a href="#æ„å»ºåæ“ä½œ" class="headerlink" title="æ„å»ºåæ“ä½œ"></a>æ„å»ºåæ“ä½œ</h3><p>ä¸‹æ‹‰ä»»åŠ¡åå­—-&gt;é…ç½®-&gt;æ„å»ºåæ“ä½œ-&gt;Send build artifacts over SSH<br><br/><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/deploy.png'/></p><h3 id="é‚®ä»¶æé†’"><a href="#é‚®ä»¶æé†’" class="headerlink" title="é‚®ä»¶æé†’"></a>é‚®ä»¶æé†’</h3><p>1.ç³»ç»Ÿç®¡ç†-&gt;ç³»ç»Ÿè®¾ç½®-&gt;Jenkins Location(ç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€) <a href="mailto:feng960106@163.com">feng960106@163.com</a></p><p>2.ç³»ç»Ÿç®¡ç†-&gt;ç³»ç»Ÿè®¾ç½®-&gt;Extended E-mail Notification</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/email.png'/><p>3.ç³»ç»Ÿç®¡ç†-&gt;ç³»ç»Ÿè®¾ç½®-&gt;é‚®ä»¶é€šçŸ¥</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/nextEmail.png'/><p>4.æ‹‰ä»»åŠ¡åå­—-&gt;é…ç½®-&gt;æ„å»ºåæ“ä½œ-&gt;Editable Email Notification</p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/nextDeployEmail.png'/><br/><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/always.png'/><blockquote><p>ä¼˜åŒ–jenkinsè¿è¡Œå†…å­˜ vim /etc/sysconfig/jenkins</p></blockquote><h3 id="Jenkinsæƒé™è®¾ç½®é”™è¯¯"><a href="#Jenkinsæƒé™è®¾ç½®é”™è¯¯" class="headerlink" title="Jenkinsæƒé™è®¾ç½®é”™è¯¯"></a>Jenkinsæƒé™è®¾ç½®é”™è¯¯</h3><h4 id="ä¿®æ”¹config-xml"><a href="#ä¿®æ”¹config-xml" class="headerlink" title="ä¿®æ”¹config.xml"></a>ä¿®æ”¹config.xml</h4><p>å…ˆæŸ¥çœ‹ç›®å½• find / -name jenkins</p><ul><li>cd /var/lib/jenkins</li></ul><p>å…ˆå¤‡ä»½ cp config.xml hzf.xml</p><p>åˆ é™¤ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;authorizationStrategy <span class="class"><span class="keyword">class</span></span>=<span class="string">"hudson.security.ProjectMatrixAuthorizationStrategy"</span>&gt; </span><br><span class="line">  ...</span><br><span class="line">&lt;<span class="regexp">/authorizationStrategy&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;securityRealm class="hudson.security.HudsonPrivateSecurityRealm"&gt;</span></span><br><span class="line"><span class="regexp">&lt;disableSignup&gt;true&lt;/</span>disableSignup&gt;</span><br><span class="line">&lt;enableCaptcha&gt;<span class="literal">false</span>&lt;<span class="regexp">/enableCaptcha&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>securityRealm&gt;</span><br></pre></td></tr></table></figure><p><strong>å¯åŠ¨jenkins</strong></p><p>service jenkins restart</p><p><strong>å†æ¬¡è®¿é—®Jenkinsåï¼Œé¦–å…ˆè¦è®¾ç½®ç™»å½•è®¤è¯ã€‚</strong></p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src='/assets/img/security.png'/><h3 id="Jenkinsè°ƒä¼˜"><a href="#Jenkinsè°ƒä¼˜" class="headerlink" title="Jenkinsè°ƒä¼˜"></a>Jenkinsè°ƒä¼˜</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹ç‰©ç†CPUä¸ªæ•°</span><br><span class="line">cat &#x2F;proc&#x2F;cpuinfo| grep &quot;physical id&quot;| sort| uniq| wc -l</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ¯ä¸ªç‰©ç†CPUä¸­coreçš„ä¸ªæ•°(å³æ ¸æ•°)</span><br><span class="line">cat &#x2F;proc&#x2F;cpuinfo| grep &quot;cpu cores&quot;| uniq</span><br><span class="line"></span><br><span class="line"># é™åˆ¶jenkins å¯åŠ¨å ç”¨å†…å­˜</span><br><span class="line">vim &#x2F;etc&#x2F;sysconfig&#x2F;jenkins</span><br><span class="line">JENKINS_JAVA_OPTIONS&#x3D;&quot;-XX:MaxPermSize&#x3D;512m -Djava.awt.headless&#x3D;true&quot;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">cd /usr/mongodb/bin</span><br><span class="line">./mongod  --config /usr/local/mongodb/mongodb.conf</span><br><span class="line"></span><br><span class="line">pm2 start /home/admin/fenggeServer/bin/www --name=<span class="string">'fenggezaoxing'</span></span><br><span class="line">pm2 start /home/admin/workplaceServer/bin/www --name=<span class="string">'workplace'</span></span><br><span class="line">pm2 start /home/admin/transition/bin/www --name=<span class="string">'transition'</span></span><br><span class="line">pm2 start /home/admin/wangyiyunServer/app.js --name=<span class="string">'wangyiyunServer'</span></span><br></pre></td></tr></table></figure><h3 id="å¸è½½jenkins"><a href="#å¸è½½jenkins" class="headerlink" title="å¸è½½jenkins"></a>å¸è½½jenkins</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">service jenkins stop</span><br><span class="line"> </span><br><span class="line">yum clean all</span><br><span class="line"> </span><br><span class="line">yum -y remove jenkins</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
          <category> Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½² </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªåŠ¨åŒ–éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RN IOSç¯å¢ƒæ­å»º</title>
      <link href="/2019/11/17/workspace/Frame/react-native/base/"/>
      <url>/2019/11/17/workspace/Frame/react-native/base/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>RN IOSç¯å¢ƒæ­å»º</strong></p><p>[[toc]]</p><h3 id="iOS-å®‰è£…CocoaPods"><a href="#iOS-å®‰è£…CocoaPods" class="headerlink" title="iOS å®‰è£…CocoaPods"></a>iOS å®‰è£…CocoaPods</h3><p>1ã€å‡çº§Rubyç¯å¢ƒ</p><p>sudo gem update â€“system</p><p>å¦‚æœå¤±è´¥</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ERROR:  While executing gem ... (Errno::EPERM)</span><br><span class="line">    Operation not permitted @ rb_sysopen - <span class="regexp">/System/</span>Library/Frameworks/Ruby.framework/Versions/<span class="number">2.3</span>/usr/bin/gem</span><br></pre></td></tr></table></figure><p>åˆ™æ‰§è¡Œ<br>sudo gem install -n /usr/local/bin cocoapods</p><p>2ã€æ›´æ¢Rubyé•œåƒ</p><p>é¦–å…ˆç§»é™¤ç°æœ‰çš„Rubyé•œåƒ<br/><br>ç»ˆç«¯è¾“å…¥ï¼šgem sources â€“remove <a href="https://rubygems.org/" target="_blank" rel="noopener">https://rubygems.org/</a></p><p>ç„¶åæ·»åŠ å›½å†…æœ€æ–°é•œåƒæºï¼ˆæ·˜å®çš„Rubyé•œåƒå·²ç»ä¸æ›´æ–°äº†ï¼‰<br/><br>ç»ˆç«¯è¾“å…¥ï¼šgem sources -a <a href="https://gems.ruby-china.com/" target="_blank" rel="noopener">https://gems.ruby-china.com/</a></p><p>æ‰§è¡Œå®Œæ¯•ä¹‹åè¾“å…¥gem sources -læ¥æŸ¥çœ‹å½“å‰é•œåƒ<br>ç»ˆç«¯è¾“å…¥ï¼šgem sources -l</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">*** CURRENT SOURCES ***</span><br><span class="line"></span><br><span class="line">https:<span class="comment">//gems.ruby-china.com</span></span><br></pre></td></tr></table></figure><p>3ã€å®‰è£…CocoaPods</p><p>ç»ˆç«¯è¾“å…¥ï¼šsudo gem install cocoapods</p><p>å¦‚æœå‡ºç°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">While executing gem ... (Gem::FilePermissionError)</span><br><span class="line">   You don<span class="string">'t have write permissions for the /usr/bin directory.</span></span><br></pre></td></tr></table></figure><p>æ”¹ä¸º sudo gem install -n /usr/local/bin cocoapods</p><p>4.podåˆ‡æ¢æº</p><p>æŸ¥çœ‹æº <br/><br>ç»ˆç«¯è¾“å…¥ï¼š pod repo</p><p>æ‰§è¡Œï¼š<br/><br>git clone <a href="https://git.coding.net/CocoaPods/Specs.git" target="_blank" rel="noopener">https://git.coding.net/CocoaPods/Specs.git</a> ~/.cocoapods/repos/master<br/><br>æ—¶é—´æœ‰ç‚¹ä¹…</p><p>æœ€ååˆ‡è®°è¦ï¼š<br/><br>pod repo update</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">master</span><br><span class="line">- Type: git (master)</span><br><span class="line">- URL:  https:<span class="comment">//git.coding.net/CocoaPods/Specs.git</span></span><br><span class="line">- Path: <span class="regexp">/Users/</span>leiming/.cocoapods/repos/master</span><br></pre></td></tr></table></figure><h3 id="fatal-unable-to-access-â€˜https-chromium-googlesource-com-webm-libwebp-39-è§£å†³æ–¹æ³•"><a href="#fatal-unable-to-access-â€˜https-chromium-googlesource-com-webm-libwebp-39-è§£å†³æ–¹æ³•" class="headerlink" title="fatal: unable to access â€˜https://chromium.googlesource.com/webm/libwebp/&#39;è§£å†³æ–¹æ³•"></a>fatal: unable to access â€˜<a href="https://chromium.googlesource.com/webm/libwebp/&#39;è§£å†³æ–¹æ³•" target="_blank" rel="noopener">https://chromium.googlesource.com/webm/libwebp/&#39;è§£å†³æ–¹æ³•</a></h3><p>::: danger<br>[!] Error installing libwebp<br>[!] /usr/local/bin/git clone <a href="https://chromium.googlesource.com/webm/libwebp" target="_blank" rel="noopener">https://chromium.googlesource.com/webm/libwebp</a> /var/folders/pw/vctwmfjd5h9cg9dgql17_25m0000gn/T/d20191023-10469-1unjlyk â€“template= â€“single-branch â€“depth 1 â€“branch v1.0.3</p><p>Cloning into â€˜/var/folders/pw/vctwmfjd5h9cg9dgql17_25m0000gn/T/d20191023-10469-1unjlykâ€™â€¦<br>fatal: unable to access â€˜<a href="https://chromium.googlesource.com/webm/libwebp/&#39;" target="_blank" rel="noopener">https://chromium.googlesource.com/webm/libwebp/&#39;</a>: Failed to connect to chromium.googlesource.com port 443: Operation timed out<br>:::</p><p>ä¸»è¦æ˜¯clone <a href="https://chromium.googlesource.com/webm/libwebp/" target="_blank" rel="noopener">https://chromium.googlesource.com/webm/libwebp/</a> è¿™ä¸ªgoogleçš„gitåœ°å€å‡ºçš„é”™(å¹¶ä¸”æˆ‘å¼€çš„å…¨å±€æ¨¡å¼çš„ä»£ç†è½¯ä»¶ä¹Ÿæ— æ•ˆ)</p><p><strong>è§£å†³æ–¹æ³•:</strong></p><p>Finder -&gt; å‰å¾€æ–‡ä»¶å¤¹ (â‡§âŒ˜G) -&gt; ~/.cocoapods/repos/master/Specs/1/9/2/libwebp</p><p>é€‰æ‹©æœ€æ–°ç‰ˆæœ¬   è¿›å…¥ libwebp.podspec.json </p><p>æŠŠ<a href="https://chromium.googlesource.com/webm/libwebp" target="_blank" rel="noopener">https://chromium.googlesource.com/webm/libwebp</a> æ›¿æ¢ä¸º <a href="https://github.com/webmproject/libwebp.git" target="_blank" rel="noopener">https://github.com/webmproject/libwebp.git</a> å¹¶ä¿å­˜</p><p>æ¥ç€pod install</p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> ReactNative </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>XCODEæ¨¡æ‹Ÿå™¨æŠ¥é”™ä¿®å¤</title>
      <link href="/2019/11/17/workspace/Frame/react-native/bug/"/>
      <url>/2019/11/17/workspace/Frame/react-native/bug/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>XCODEæ¨¡æ‹Ÿå™¨æŠ¥é”™ä¿®å¤</strong></p><h1 id="XCODEæ¨¡æ‹Ÿå™¨æŠ¥é”™ä¿®å¤"><a href="#XCODEæ¨¡æ‹Ÿå™¨æŠ¥é”™ä¿®å¤" class="headerlink" title="XCODEæ¨¡æ‹Ÿå™¨æŠ¥é”™ä¿®å¤"></a><code>XCODEæ¨¡æ‹Ÿå™¨æŠ¥é”™ä¿®å¤</code></h1><p><strong>1.MACä¸Šè°ƒè¯•å·¥å…·React-native-debuggerä¸‹è½½ç¼“æ…¢åŠå…¶è§£å†³åŠæ³•ã€‚</strong></p><p>æˆ‘ä»¬å¯ä»¥ä¸‹è½½React-native-debugger,ç”¨äºRNé¡¹ç›®çš„ è°ƒè¯•</p><p>æˆ‘åœ¨ä¸‹è½½çš„æ—¶å€™ï¼Œé‡åˆ°ä¸¤ä¸ªæ— è¯­çš„é—®é¢˜</p><p>è¿™ç©æ„å„¿æ˜¯æ²¡æœ‰å®˜ç½‘çš„ï¼Œä½ åªèƒ½ä»githubä¸Šä¸‹è½½ï¼Œæˆ‘è¿™é‡Œç»™ä¸€ä¸ªç‚¹å‡»å°±èƒ½ç›´æ¥ä¸‹è½½çš„é“¾æ¥ï¼š<a href="https://github.com/jhen0409/react-native-debugger/releases/download/v0.10.0/rn-debugger-macos-x64.zip" target="_blank" rel="noopener">https://github.com/jhen0409/react-native-debugger/releases/download/v0.10.0/rn-debugger-macos-x64.zip</a><br>è¿™ä¸ªä¸œè¥¿å¤§æ¦‚90Må·¦å³ï¼Œä¸‹è½½æ…¢ä¸è¯´ï¼Œè€Œä¸”å› ä¸ºç½‘ç»œåŸå› ï¼Œç»å¸¸ä¸‹è½½åˆ°å¿«å®Œæˆçš„æ—¶å€™å¤±è´¥ï¼ åŠ å¿«ä¸‹è½½é€Ÿåº¦çš„æ–¹å¼å¦‚ä¸‹ï¼š<br>æ‰“å¼€ä½ çš„VPN<br>æ‰“å¼€ä¸Šé¢çš„é“¾æ¥ï¼š<a href="https://github.com/jhen0409/react-native-debugger/releases/download/v0.10.0/rn-debugger-macos-x64.zipï¼Œå¾ˆå¿«å°±èƒ½ä¸‹å¥½" target="_blank" rel="noopener">https://github.com/jhen0409/react-native-debugger/releases/download/v0.10.0/rn-debugger-macos-x64.zipï¼Œå¾ˆå¿«å°±èƒ½ä¸‹å¥½</a></p><p><strong>2.è°ƒè¯•ä¸­ï¼Œå¯èƒ½å¶å°”å°±ä¼šå‡ºç°è®©äººéå¸¸æ— è¯­çš„çº¢å±é—®é¢˜ï¼ŒæŠ¥ï¼ˆCould not connect to development serverï¼‰</strong></p><p>æ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ªä¸èƒ½è¿æ¥åˆ°æœåŠ¡å™¨å°±æ˜¯æˆ‘å¶å°”æˆ–ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œ</p><p>è§£å†³æ–¹æ³•ï¼šä¸€èˆ¬åˆ·æ–°å‡ æ¬¡å°±å¥½äº†ï¼Œå¦‚æœåˆ·æ–°å¤šæ¬¡æ— æ•ˆï¼Œé‚£ä¹ˆé‡æ–°é€šè¿‡react-nativeå¯åŠ¨é¡¹ç›®</p><p>ï¼ˆå¦‚æœIOSæ¨¡æ‹Ÿå™¨æ˜¯ä¸ªäººæˆ‘å·²ç»æƒ³è¦æ‰“æ­»ä»–äº†ã€‚ã€‚ã€‚ï¼‰</p><p><strong>3.è°ƒè¯•ä¸­æŠ¥é”™ï¼šMissing request token for request</strong></p><p>è§£å†³æ–¹æ³•ï¼šåæ­£é‡å¯å°±ä¸‡å®Œäº‹äº†ã€‚ã€‚ã€‚ä¸è¡Œå°±å†é‡å¯</p><p><strong>4. å¯¼å…¥æ–°çš„å›¾ç‰‡imageåï¼Œæ˜¾ç¤ºçº¢å±ï¼ˆéæ³•å­—ç¬¦ Error on load image on React-native: Unexpected character ï¼‰</strong></p><p>è§£å†³æ–¹æ³•ï¼š1.å…³é—­é¡¹ç›®ï¼Œé‡æ–°é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨ã€‚ 2.å¦‚æœè¿˜ä¸è¡Œï¼Œé‚£ä¹ˆå†é‡è¯•å¤šæ¬¡ï¼Œä¸€èˆ¬ä¼šè¡Œçš„</p><p><strong>5.çº¢å±ï¼Œæç¤º JSON value â€˜XXXXâ€™  of type NSString cannot be converted to  a YGValue. Did you forget the % or pt suffix ?</strong></p><p><strong>6.çº¢å±ï¼Œå’Œä¸Šé¢ä¸€æ ·ï¼Œä½†æç¤ºçš„æ–‡å­—æ˜¯â€œRuntime is not ready for debuggingâ€</strong></p><p>è¿™ä¸€èˆ¬æ˜¯è¿™ç§æƒ…å†µï¼š å°±æ˜¯ä½ å…ˆæ‰“å¼€äº†è°ƒè¯•å™¨ï¼ˆReact-Native-debuggerï¼‰ï¼Œç„¶åæ‰å¯åŠ¨çš„é¡¹ç›®ï¼Œé¡¹ç›®è®¤ä¸ºâ€œè‡ªå·±è¿˜æ²¡æœ‰å‡†å¤‡å¥½è°ƒè¯•â€ï¼Œæ‰€ä»¥æŠ¥äº†è¿™ä¸ªé”™è¯¯</p><p>è§£å†³æ–¹æ³•</p><p>è°ƒå‡ºæ§åˆ¶å°èœå•ï¼ˆIOSæ¨¡æ‹Ÿå™¨ä¸‹é€šè¿‡control + Då¼€å¯ï¼‰<br>é€‰æ‹©Stop Remote JS Debugging</p><p><strong>7.çº¢å±ï¼Œå’Œä¸Šé¢ä¸€æ ·ï¼Œæç¤ºæ–‡å­—: â€œUnhandled JS Exception:  global.nativeTraceBeginSection is not a functionâ€</strong></p><p>è¿™ä¸ªé—®é¢˜æ®è¯´ä¸å°‘äººé‡åˆ°è¿‡ï¼Œè§£å†³æ–¹æ³•æ˜¯ï¼šåœ¨æ¨¡æ‹Ÿå™¨ä¸Šåˆ æ‰APPï¼Œç„¶åé‡æ–°ç¼–è¯‘å®‰è£…ï¼Œ</p><p>å®ƒå±äºâ€œå®Œå…¨çš„ä¸å¯æŠ—åŠ›â€ï¼Œä¸æ˜¯å› ä¸ºä½ åšé”™äº†ä»€ä¹ˆï¼Œä½†é—®é¢˜æ°æ°å°±è¿™æ ·å‡ºç°äº†ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>å‚è€ƒé“¾æ¥ <a href="https://cloud.tencent.com/developer/ask/216506/answer/333025" target="_blank" rel="noopener">https://cloud.tencent.com/developer/ask/216506/answer/333025</a></p><p><strong>8. å‘ç°ç¨‹åºæœ‰é”™ä½†æ˜¯æ§åˆ¶å°çœ‹ä¸åˆ°çº¢è‰²é”™è¯¯ï¼ˆerrorï¼‰???</strong></p><p>è¿™æ˜¯å› ä¸ºã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æŠ¥çš„é”™è¯¯å¯èƒ½ä¸æ˜¯çº¢è‰²çš„ï¼Œè€Œæ˜¯ç™½è‰²çš„</p><p>ä¸‹é¢çš„è¿™ä½errorè€å¼Ÿï¼Œæˆ‘è¿˜æ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°é•¿å¾—è¿™ä¹ˆâ€œç™½ç™½å‡€å‡€â€ çš„Error, éš¾é“ä½ ä¸åº”è¯¥æ˜¯â€œçº¢è„¸å…³å…¬â€ğŸ ï¼Ÿ</p><p>è§£å†³åŠæ³•ï¼šè®¤çœŸä»ä¸€å¤§å †è¾“å‡ºä¸­é€šè¿‡è¿‡æ»¤æ‰å…¶ä»–ä¿¡æ¯çš„æ–¹å¼ï¼Œå®šä½åˆ°ç™½è‰²è‰²å—çš„errorè¾“å‡º</p><p><strong>9.è°ƒå‡ºReact-Native-Debuggerçš„æ—¶å€™,æŠ¥è­¦å‘Šï¼šAnother debugger is already connected</strong></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„æµè§ˆå™¨é¡µé¢æ‰“å¼€äº†debuggeré¡µé¢ï¼Œé•¿è¿™æ ·çš„</p><p>è§£å†³åŠæ³•ï¼šæŠŠæµè§ˆå™¨çš„debuggerå…³æ‰å°±å¯ä»¥äº†</p><p><strong>10.è§£å†³MACå’ŒIOSæ¨¡æ‹Ÿå™¨ä¹‹é—´çš„å¤åˆ¶ç²˜è´´é—®é¢˜</strong></p><p>ç”¨è¿‡IOSæ¨¡æ‹Ÿå™¨çš„äººå°±ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼ŒMACä¸Šçš„ä¸œä¸œæ˜¯ä¸èƒ½ç›´æ¥ç²˜è´´åˆ°æ¨¡æ‹Ÿå™¨çš„APPä¸Šçš„</p><p>è§£å†³åŠæ³•ï¼š <a href="https://www.jianshu.com/p/a34ab4933211" target="_blank" rel="noopener">https://www.jianshu.com/p/a34ab4933211</a></p><p><strong>11.å¦‚æœæŠ¥é”™ï¼šç»„ä»¶ä¸æ˜¯class/function,è€Œæ˜¯undefined</strong></p><p>ä¸ä¸€å®šæ˜¯å½“å‰ç»„ä»¶æ²¡æœ‰æ­£ç¡®å¯¼å…¥ï¼Œè¿˜å¯èƒ½æ˜¯å½“å‰ç»„ä»¶çš„å­ç»„ä»¶æ²¡æœ‰æ­£ç¡®å¯¼å…¥</p><p><strong>12.æ¶‰åŠå›¾ç‰‡å¼•ç”¨æ”¹å˜çš„æ—¶å€™ï¼Œå¶å°”ä¼šå‡ºç°çƒ­é‡è½½å¤±æ•ˆçš„ç°è±¡</strong></p><p>ä½ è¯´å¤±æ•ˆï¼Œè¾£å°±æ˜¯å¤±æ•ˆï¼Œä¸ç‹¡è¾©ï¼ˆè¯æ®ç¡®å‡¿ï¼Œç™¾å£è«è¾©ï¼‰</p><p><strong>13.IOSæ¨¡æ‹Ÿå™¨ä½¿ç”¨èµ·æ¥éå¸¸ç¼“æ…¢ï¼Œå¦‚åŒä¹Œé¾Ÿå’Œæ ‘ç­ä¸€èˆ¬ï¼Œè€Œä¸”å¡é¡¿æ­»æœºçœ‹å¿ƒæƒ…</strong></p><p>è§£å†³åŠæ³•ï¼šæ¯«æ— åŠæ³•ï¼Œå¬å¤©ç”±å‘½</p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> ReactNative </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RNåŸºæœ¬ç”¨æ³•</title>
      <link href="/2019/11/17/workspace/Frame/react-native/guide/"/>
      <url>/2019/11/17/workspace/Frame/react-native/guide/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>RNåŸºæœ¬ç”¨æ³•</strong></p><p>[[toc]]</p><h3 id="React-NativeåŒºåˆ†å®‰å“-iOSå¹³å°"><a href="#React-NativeåŒºåˆ†å®‰å“-iOSå¹³å°" class="headerlink" title="React NativeåŒºåˆ†å®‰å“/iOSå¹³å°"></a>React NativeåŒºåˆ†å®‰å“/iOSå¹³å°</h3><p><a href="https://reactnative.cn/docs/platform-specific-code/" target="_blank" rel="noopener">ç‰¹å®šå¹³å°ä»£ç </a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Platform &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="built_in">JSON</span>.stringify(Platform)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"OS"</span>:<span class="string">"android"</span>,<span class="string">"Version"</span>:<span class="number">25</span>,<span class="string">"is Testing"</span>:<span class="literal">false</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="RNæ ·å¼"><a href="#RNæ ·å¼" class="headerlink" title="RNæ ·å¼"></a>RNæ ·å¼</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;height, width&#125; = Dimensions.get(<span class="string">'window'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//æ·»åŠ é˜´å½±</span><br><span class="line">shadowColor: '0px 6px 10px 0px rgba(0,0,0,0.1)',</span><br><span class="line"><span class="selector-tag">shadowOffset</span>: &#123;<span class="attribute">width</span>: <span class="number">1</span>, height: <span class="number">1</span>&#125;,</span><br><span class="line"><span class="selector-tag">shadowOpacity</span>: 0<span class="selector-class">.1</span>,</span><br><span class="line"></span><br><span class="line">//å¹³ç§»</span><br><span class="line"><span class="selector-tag">transform</span>: <span class="selector-attr">[&#123;translateY: 100&#125;]</span>,</span><br><span class="line"></span><br><span class="line">//è¾¹æ¡†</span><br><span class="line">borderColor: '#F4F4F4',</span><br><span class="line"><span class="selector-tag">borderWidth</span>: 1,</span><br><span class="line"></span><br><span class="line">//åœ†è§’       </span><br><span class="line"><span class="selector-tag">borderTopLeftRadius</span>: 20,</span><br><span class="line"><span class="selector-tag">borderTopRightRadius</span>: 20,</span><br><span class="line"><span class="selector-tag">borderBottomRightRadius</span>: 20,</span><br><span class="line"><span class="selector-tag">borderBottomLeftRadius</span>: 20,</span><br></pre></td></tr></table></figure><h3 id="RNå¸¦æœ‰ç‚¹å‡»äº‹ä»¶çš„æ ‡ç­¾"><a href="#RNå¸¦æœ‰ç‚¹å‡»äº‹ä»¶çš„æ ‡ç­¾" class="headerlink" title="RNå¸¦æœ‰ç‚¹å‡»äº‹ä»¶çš„æ ‡ç­¾"></a>RNå¸¦æœ‰ç‚¹å‡»äº‹ä»¶çš„æ ‡ç­¾</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ²¡æœ‰ä»»ä½•è§†è§‰åé¦ˆ,åªæ”¯æŒä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆä¸èƒ½æ²¡æœ‰å­èŠ‚ç‚¹ä¹Ÿä¸èƒ½å¤šäºä¸€ä¸ª),å¦‚æœä½ å¸Œæœ›åŒ…å«å¤šä¸ªå­ç»„ä»¶ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªViewæ¥åŒ…è£…å®ƒä»¬ã€‚</span></span><br><span class="line"> &lt;TouchableWithoutFeedback onPress=&#123;() =&gt; &#123;&#125;&#125;/&gt;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//å°è£…çš„è§†å›¾çš„ä¸é€æ˜åº¦ä¼šé™ä½,é»˜è®¤ä¸º0.2</span></span><br><span class="line">&lt;TouchableOpacity</span><br><span class="line"> style=&#123;styles.button&#125;</span><br><span class="line"> onPress=&#123;()=&gt;&#123;&#125;&#125;</span><br><span class="line"> activeOpacity=&#123;<span class="number">0</span><span class="number">-1</span>,é»˜è®¤<span class="number">0.2</span>&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;Text&gt; Touch Here &lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>TouchableOpacity&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è£…çš„è§†å›¾çš„ä¸é€æ˜åº¦ä¼šé™ä½ï¼ŒåŒæ—¶ä¼šæœ‰ä¸€ä¸ªåº•å±‚çš„é¢œè‰²é€è¿‡è€Œè¢«ç”¨æˆ·çœ‹åˆ°ï¼Œä½¿å¾—è§†å›¾å˜æš—æˆ–å˜äº®ã€‚</span></span><br><span class="line"> &lt;TouchableHighlight</span><br><span class="line">  activeOpacity=&#123;<span class="number">0</span><span class="number">-1</span>,é»˜è®¤ä¸º<span class="number">0.85</span>&#125;</span><br><span class="line">  underlayColor=&#123;<span class="string">'#ccc'</span>&#125;</span><br><span class="line">  onPress=&#123;<span class="keyword">this</span>._onPressButton&#125;</span><br><span class="line">  &gt;</span><br><span class="line">  &lt;FastImage</span><br><span class="line">    style=&#123;styles.button&#125;</span><br><span class="line">    source=&#123;<span class="built_in">require</span>(<span class="string">'./myButton.png'</span>)&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;<span class="regexp">/TouchableHighlight&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å…¥æ¡†"><a href="#è¾“å…¥æ¡†" class="headerlink" title="è¾“å…¥æ¡†"></a>è¾“å…¥æ¡†</h3><p><a href="https://reactnative.cn/docs/textinput/" target="_blank" rel="noopener">textinput</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;TextInput</span><br><span class="line">     style=&#123;styles.postTitle&#125;</span><br><span class="line">     autoFocus</span><br><span class="line">     multiline</span><br><span class="line">     underlineColorAndroid=<span class="string">'transparent'</span></span><br><span class="line">     placeholder=<span class="string">'æ¬¢è¿æ‚¨çš„æ„è§å’Œå»ºè®®â€¦'</span></span><br><span class="line">     placeholderTextColor=<span class="string">'#9B9B9B'</span></span><br><span class="line">     value=&#123;note&#125;</span><br><span class="line">     onChangeText=&#123;setPostTitle&#125;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å±…é¡¶æ˜¾ç¤º</span></span><br><span class="line">textAlignVertical: <span class="string">'top'</span></span><br></pre></td></tr></table></figure><h3 id="è·å–ç›’å­çš„ä½ç½®ä¿¡æ¯"><a href="#è·å–ç›’å­çš„ä½ç½®ä¿¡æ¯" class="headerlink" title="è·å–ç›’å­çš„ä½ç½®ä¿¡æ¯"></a>è·å–ç›’å­çš„ä½ç½®ä¿¡æ¯</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> layout = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handle = findNodeHandle(<span class="keyword">this</span>.progressBar);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        UIManager.measure(handle, (x, y, width, height, pageX, pageY) =&gt; &#123;</span><br><span class="line">            resolve(&#123;</span><br><span class="line">                x,</span><br><span class="line">                y,</span><br><span class="line">                width,</span><br><span class="line">                height,</span><br><span class="line">                pageX,</span><br><span class="line">                pageY</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;).then(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(val);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&lt;View ref=&#123;(c) =&gt; &#123;</span><br><span class="line">   <span class="keyword">this</span>.progressBar = c</span><br><span class="line">&#125;&#125; onLayout=&#123;<span class="keyword">this</span>.layout&#125; /&gt;</span><br></pre></td></tr></table></figure><h3 id="é¡µé¢é€šä¿¡"><a href="#é¡µé¢é€šä¿¡" class="headerlink" title="é¡µé¢é€šä¿¡"></a>é¡µé¢é€šä¿¡</h3><p><strong>æ–¹æ³•ä¸€:callbackå‡½æ•°åˆ·æ–°</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//æ¥æ”¶é¡µé¢</span></span><br><span class="line">_onPressBack=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.props.navigation.navigate(<span class="string">'list'</span>,&#123;</span><br><span class="line">        refresh:<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">         <span class="keyword">this</span>._refresh();</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line">_refresh=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'refresh'</span>)</span><br><span class="line">    alert(<span class="string">'åˆ·æ–°å“ˆ!'</span>)</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&lt;TouchableOpacity onPress=&#123;<span class="keyword">this</span>._onPressBack&#125; activeOpacity=&#123;<span class="number">0.8</span>&#125;&gt;</span><br><span class="line">    &lt;FastImage source=&#123;backIcon&#125; style=&#123;styles.backIcon&#125;/&gt;</span><br><span class="line">&lt;<span class="regexp">/TouchableOpacity&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/å‘é€é¡µé¢</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const goBack=()=&gt;&#123;</span></span><br><span class="line"><span class="regexp">     this.props.navigation.goBack();</span></span><br><span class="line"><span class="regexp">     this.props.navigation.state.params.refresh();</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;TouchableOpacity onPress=&#123;goBack&#125; activeOpacity=&#123;0.8&#125;&gt;</span></span><br><span class="line"><span class="regexp">    &lt;FastImage source=&#123;backIcon&#125; style=&#123;styles.backIcon&#125;/</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/TouchableOpacity&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒ:å‘é€é€šçŸ¥DeviceEventEmitteråˆ·æ–°</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ¥æ”¶é¡µé¢</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    View,</span><br><span class="line">    Text,</span><br><span class="line">    FlatList,</span><br><span class="line">    TouchableOpacity,</span><br><span class="line">    DeviceEventEmitter</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.queryList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.refreshSubScription = DeviceEventEmitter.addListener(<span class="string">'refresh'</span>, (&#123;refresh&#125;) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (refresh) &#123;</span><br><span class="line">            <span class="keyword">this</span>.queryList();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentWillUnmount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.refreshSubScription.remove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘é€é¡µé¢</span></span><br><span class="line"><span class="keyword">const</span> goBack=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    DeviceEventEmitter.emit(<span class="string">'refresh'</span>, &#123;</span><br><span class="line">        <span class="string">'refresh'</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    NavigationService.goBack()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;TouchableOpacity onPress=&#123;goBack&#125; activeOpacity=&#123;<span class="number">0.8</span>&#125;&gt;</span><br><span class="line">    &lt;FastImage source=&#123;backIcon&#125; style=&#123;styles.backIcon&#125;/&gt;</span><br><span class="line">&lt;<span class="regexp">/TouchableOpacity&gt;</span></span><br></pre></td></tr></table></figure><h3 id="RNæ’ä»¶"><a href="#RNæ’ä»¶" class="headerlink" title="RNæ’ä»¶"></a>RNæ’ä»¶</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;TabView&#125; <span class="keyword">from</span> <span class="string">"react-native-tab-view"</span>;    <span class="comment">//tabåˆ‡æ¢ç»„ä»¶</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> LinearGradient <span class="keyword">from</span> <span class="string">'react-native-linear-gradient'</span>    <span class="comment">//æ¸å˜è‰²æ’ä»¶</span></span><br><span class="line"></span><br><span class="line">&lt;LinearGradient</span><br><span class="line">  colors=&#123;[<span class="string">'#FE6E50'</span>, <span class="string">'#FF4542'</span>]&#125;</span><br><span class="line">  start=&#123;&#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;&#125;</span><br><span class="line">  end=&#123;&#123;<span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;Text style=&#123;styles.sure_text&#125;&gt;---&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>LinearGradient&gt;</span><br><span class="line"><span class="string">``</span><span class="string">`             </span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript          </span><br><span class="line"><span class="keyword">import</span> FastImage <span class="keyword">from</span> <span class="string">"react-native-fast-image"</span>;   <span class="comment">//å›¾ç‰‡çš„ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">&lt;FastImage source=&#123;æœ¬åœ°?æœ¬åœ°:&#123;<span class="attr">uri</span>:url&#125;&#125; style=&#123;styles.img&#125;/&gt;</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="keyword">import</span> DeviceInfo <span class="keyword">from</span> <span class="string">'react-native-device-info'</span>; <span class="comment">//è·å–è®¾å¤‡çš„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> componentWillMount() &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'apiç‰ˆæœ¬:'</span>, DeviceInfo.getAPILevel());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'å“ç‰Œ:'</span>, DeviceInfo.getBrand());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'å½“å‰åº”ç”¨åç§°:'</span>, DeviceInfo.getApplicationName());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'åº”ç”¨ç¼–è¯‘ç‰ˆæœ¬å·:'</span>, DeviceInfo.getBuildNumber());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–åº”ç”¨ç¨‹åºåŒ…æ ‡è¯†ç¬¦:'</span>, DeviceInfo.getBundleId());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è¿è¥å•†åç§°:'</span>, DeviceInfo.getCarrier());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡æ‰€å¤„å›½å®¶:'</span>, DeviceInfo.getDeviceCountry());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡ID:'</span>, DeviceInfo.getDeviceId());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡åœ°åŒº:'</span>, DeviceInfo.getDeviceLocale());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡åç§°:'</span>, DeviceInfo.getDeviceName());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–åº”ç”¨åˆå§‹å®‰è£…æ—¶é—´:'</span>, DeviceInfo.getFirstInstallTime());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡å­—ä½“å¤§å°:'</span>, DeviceInfo.getFontScale());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'å‰©ä½™å­˜å‚¨å®¹é‡(å­—èŠ‚):'</span>, DeviceInfo.getFreeDiskStorage());</span><br><span class="line">    <span class="keyword">await</span> DeviceInfo.getIPAddress().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡å½“å‰ç½‘ç»œåœ°å€IP:'</span>, res);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'åº”ç”¨ç¨‹åºå®ä¾‹ID:'</span>, DeviceInfo.getInstanceID());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–åº”ç”¨ä¸Šæ¬¡æ›´æ–°æ—¶é—´:'</span>, DeviceInfo.getLastUpdateTime());</span><br><span class="line">    <span class="keyword">await</span> DeviceInfo.getMACAddress().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'ç½‘ç»œé€‚é…å™¨MACåœ°å€:'</span>, res);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡åˆ¶é€ å•†:'</span>, DeviceInfo.getManufacturer());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–JVMè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡(å­—èŠ‚):'</span>, DeviceInfo.getMaxMemory());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–è®¾å¤‡æ¨¡å¼:'</span>, DeviceInfo.getModel());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–ç”µè¯å·ç :'</span>, DeviceInfo.getPhoneNumber());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–åº”ç”¨ç¨‹åºå¯è¯»ç‰ˆæœ¬:'</span>, DeviceInfo.getReadableVersion());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡å”¯ä¸€åºåˆ—å·:'</span>, DeviceInfo.getSerialNumber());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–ç³»ç»Ÿåç§°:'</span>, DeviceInfo.getSystemName());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è·å–ç³»ç»Ÿç‰ˆæœ¬:'</span>, DeviceInfo.getSystemVersion());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'ç³»ç»Ÿæ—¶åŒº:'</span>, DeviceInfo.getTimezone());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'å®Œæ•´ç£ç›˜ç©ºé—´å¤§å°(å­—èŠ‚):'</span>, DeviceInfo.getTotalDiskCapacity());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡æ€»å†…å­˜(å­—èŠ‚):'</span>, DeviceInfo.getTotalMemory());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡å”¯ä¸€ID:'</span>, DeviceInfo.getUniqueID());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡ç”¨æˆ·ä»£ç†:'</span>, DeviceInfo.getUserAgent());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'è®¾å¤‡ç‰ˆæœ¬:'</span>, DeviceInfo.getVersion());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'ç”¨æˆ·åå¥½æ˜¯å¦è®¾ç½®ä¸º24å°æ—¶æ ¼å¼:'</span>, DeviceInfo.is24Hour());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'ç¨‹åºæ˜¯å¦å…è®¸åœ¨æ¨¡æ‹Ÿå™¨ä¸­:'</span>, DeviceInfo.isEmulator());</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="string">'æ˜¯å¦æ˜¯å¹³æ¿ç”µè„‘:'</span>, DeviceInfo.isTablet());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;BoxShadow,BorderShadow&#125; <span class="keyword">from</span> <span class="string">'react-native-shadow'</span>     <span class="comment">//è§£å†³å®‰å“é˜´å½±</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ProgressBar <span class="keyword">from</span> <span class="string">'react-native-progress/Bar'</span>; <span class="comment">//è¿›åº¦æ¡</span></span><br><span class="line"></span><br><span class="line">&lt;ProgressBar</span><br><span class="line">    color=&#123;<span class="string">'red'</span>&#125;</span><br><span class="line">    animated=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">    width=&#123;width&#125;</span><br><span class="line">    height=&#123;<span class="number">2</span>&#125;</span><br><span class="line">    borderWidth=&#123;<span class="number">0</span>&#125;</span><br><span class="line">    progress=&#123;progress&#125; <span class="comment">//0-1</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NavigationEvents ,NavigationActions , StackActionsï¼ŒwithNavigation &#125; <span class="keyword">from</span> <span class="string">'react-navigation'</span>;</span><br><span class="line"></span><br><span class="line">onWillFocus=&#123;payload =&gt; <span class="built_in">console</span>.log(<span class="string">'will focus'</span>)&#125;<span class="comment">//å°†è¦è¢«ç‚¹å‡»</span></span><br><span class="line">onDidFocus=&#123;payload =&gt; <span class="keyword">this</span>.imagePicker() &#125;<span class="comment">//è¢«ç‚¹å‡»</span></span><br><span class="line">onWillBlur=&#123;payload =&gt; <span class="built_in">console</span>.log(<span class="string">'will blur'</span>, payload)&#125;<span class="comment">//å°†è¦ç¦»å¼€</span></span><br><span class="line">onDidBlur=&#123;payload =&gt; <span class="built_in">console</span>.log(<span class="string">'did blur'</span>, payload)&#125;<span class="comment">//ç¦»å¼€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¸…ç©ºæ‰€æœ‰çš„è·¯ç”±</span></span><br><span class="line"> <span class="keyword">const</span> resetAction = StackActions.reset(&#123;</span><br><span class="line">   index: <span class="number">1</span>,</span><br><span class="line">    actions: [</span><br><span class="line">        NavigationActions.navigate(&#123;<span class="attr">routeName</span>: <span class="string">"Tab"</span>&#125;),</span><br><span class="line">        NavigationActions.navigate(&#123;<span class="attr">routeName</span>: <span class="string">"LoginPage"</span>&#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;);</span><br><span class="line">navigation.dispatch(resetAction);</span><br><span class="line"><span class="comment">//navigationåœ¨pageså£°æ˜è¿‡å¾—é¡µé¢æ‰ä¼šæ·»åŠ ï¼Œå¦åˆ™å¯ä»¥ç”¨withNavigation(Index)é«˜é˜¶ä¸‹</span></span><br></pre></td></tr></table></figure><h3 id="å±è”½é»„å±"><a href="#å±è”½é»„å±" class="headerlink" title="å±è”½é»„å±"></a>å±è”½é»„å±</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; YellowBox&#125; <span class="keyword">from</span> <span class="string">'react-native'</span></span><br><span class="line"></span><br><span class="line">YellowBox.ignoreWarnings([</span><br><span class="line">    <span class="string">'Warning: isMounted(...) is deprecated'</span>,</span><br><span class="line">    <span class="string">'Module RCTImageLoader requires main queue setup'</span>,</span><br><span class="line">    <span class="string">'Module RNFetchBlob requires main queue setup'</span>,</span><br><span class="line">    <span class="string">'Module AudioRecorderManager requires main queue setup'</span>,</span><br><span class="line">    <span class="string">'Module RCTVideoManager requires main queue setup'</span>,</span><br><span class="line">    <span class="string">'Class RCTCxxModule was not exported'</span>,</span><br><span class="line">    <span class="string">'RCTBridge required dispatch_sync to load RCTDevLoadingView.'</span>,</span><br><span class="line">    <span class="string">'Require cycle:'</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h3 id="é˜»æ­¢å®‰å“å¿«é€ŸåŒå‡»é€€å‡ºåº”ç”¨"><a href="#é˜»æ­¢å®‰å“å¿«é€ŸåŒå‡»é€€å‡ºåº”ç”¨" class="headerlink" title="é˜»æ­¢å®‰å“å¿«é€ŸåŒå‡»é€€å‡ºåº”ç”¨"></a>é˜»æ­¢å®‰å“å¿«é€ŸåŒå‡»é€€å‡ºåº”ç”¨</h3><p><strong>éœ€æ±‚</strong></p><ul><li>éœ€è¦ç›‘å¬å®‰å“çš„è¿”å›é”®ï¼Œç‚¹å‡»å®‰å“è¿”å›é”®çš„æ—¶å€™å¯ä»¥æ­£å¸¸è¿”å›</li><li>ä½†æ˜¯å½“åœ¨tabsçš„å‡ ä¸ªé¡µé¢ä¸­æŒ‰è¿”å›é”®åšå¦‚ä¸‹çš„å‡ ä¸ªå¤„ç†<ul><li>å¦‚æœåœ¨é¦–é¡µtabï¼Œé‚£ä¹ˆåœ¨è¿ç»­ç‚¹å‡»ä¸¤æ¬¡è¿”å›é”®åé€€å‡ºåº”ç”¨</li><li>åœ¨å…¶ä»–tabï¼ŒæŒ‰è¿”å›é”®ä¸åšå¤„ç†</li></ul></li></ul><p><strong>app.js</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Platform,</span><br><span class="line">  BackHandler</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> componentWillMount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (Platform.OS === <span class="string">'android'</span>) &#123;</span><br><span class="line">      BackHandler.addEventListener(<span class="string">'hardwareBackPress'</span>, <span class="keyword">this</span>.onAndroidBackPress);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (Platform.OS === <span class="string">'android'</span>) &#123;</span><br><span class="line">      BackHandler.removeEventListener(<span class="string">'hardwareBackPress'</span>,<span class="keyword">this</span>.onAndroidBackPress);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">//BACKç‰©ç†æŒ‰é”®ç›‘å¬</span></span><br><span class="line">  onAndroidBackPress = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(store.dataFixStore.route)</span><br><span class="line">    <span class="keyword">const</span> &#123;route&#125; = store.dataFixStore;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (route != <span class="string">'Home'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//true è¡¨ç¤ºè¿”å›ä¸Šä¸€é¡µ</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.lastBackPressed &amp;&amp; <span class="keyword">this</span>.lastBackPressed + <span class="number">500</span> &gt;= <span class="built_in">Date</span>.now()) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;       </span><br><span class="line">       &#125;</span><br><span class="line">        <span class="comment">//æœ€è¿‘0.5ç§’å†…æŒ‰è¿‡backé”®ï¼Œå¯ä»¥é€€å‡ºåº”ç”¨ã€‚</span></span><br><span class="line">      <span class="keyword">this</span>.lastBackPressed = <span class="built_in">Date</span>.now();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><strong>Home.jsx</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span>  </span><br><span class="line">    &lt;View&gt;</span><br><span class="line">        &lt;NavigationEvents</span><br><span class="line">            onDidFocus=&#123; ()=&gt;&#123;</span><br><span class="line">              <span class="comment">//ä½¿ç”¨reduxæŠŠå¸¦æœ‰tabçš„é¡µé¢å­˜èµ·æ¥ï¼Œå¦‚æœæœ‰å¯¹åº”çš„å°±è®©å…¶å›åˆ°æ¡Œé¢</span></span><br><span class="line">                 dispatch(&#123;</span><br><span class="line">            type: <span class="string">"setRouter/changeItem"</span>,</span><br><span class="line">            payload: &#123;</span><br><span class="line">                router: <span class="string">'Home'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                 &#125;);</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            /&gt;    </span><br><span class="line">   &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="ç¦æ­¢IOSè¿”å›æ‰‹åŠ¿"><a href="#ç¦æ­¢IOSè¿”å›æ‰‹åŠ¿" class="headerlink" title="ç¦æ­¢IOSè¿”å›æ‰‹åŠ¿"></a>ç¦æ­¢IOSè¿”å›æ‰‹åŠ¿</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¦æ­¢æ‰€æœ‰é¡µé¢æ‰‹åŠ¿è¿”å›</span></span><br><span class="line"><span class="keyword">const</span> RootStackNavigator = StackNavigator(</span><br><span class="line">  &#123;</span><br><span class="line">    Login: &#123;</span><br><span class="line">      screen: LoginScreen</span><br><span class="line">    &#125;,</span><br><span class="line">    Main: &#123;</span><br><span class="line">      screen: MainDrawerNavigator</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    index: <span class="number">0</span>,</span><br><span class="line">    initialRouteName: <span class="string">'Login'</span>,</span><br><span class="line">    headerMode: <span class="string">'none'</span>,</span><br><span class="line">    navigationOptions: &#123;</span><br><span class="line">      gesturesEnabled: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç¦ç”¨æŸä¸ªé¡µé¢çš„æ‰‹åŠ¿</span></span><br><span class="line"><span class="keyword">static</span> navigationOptions = &#123;</span><br><span class="line">     ...</span><br><span class="line">     gesturesEnabled: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> ReactNative </category>
          
          <category> ReactNativeåŸºæœ¬ç”¨æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react-native </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VirtualDOM</title>
      <link href="/2019/11/17/workspace/Frame/react/dom_diff/"/>
      <url>/2019/11/17/workspace/Frame/react/dom_diff/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>VirtualDOM</strong></p><p>[[toc]]</p><p><strong>React çš„æ ¸å¿ƒæ€æƒ³</strong></p><p>ç»™æˆ‘ä¸€ä¸ªæ•°æ®ï¼Œæˆ‘æ ¹æ®è¿™ä¸ªæ•°æ®ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„<code>Virtual DOM</code>ï¼Œç„¶åè·Ÿæˆ‘ä¸Šä¸€æ¬¡ç”Ÿæˆçš„Virtual DOMå» <code>diff</code>ï¼Œå¾—åˆ°ä¸€ä¸ª<code>Patch</code>ï¼Œ<br>ç„¶åæŠŠè¿™ä¸ªPatchæ‰“åˆ°æµè§ˆå™¨çš„DOMä¸Šå»ã€‚å®Œäº‹,å¹¶ä¸”è¿™é‡Œçš„patchæ˜¾ç„¶<code>ä¸æ˜¯å®Œæ•´çš„è™šæ‹ŸDOM</code>ï¼Œ<br>è€Œæ˜¯æ–°çš„è™šæ‹ŸDOMå’Œä¸Šä¸€æ¬¡çš„è™šæ‹ŸDOMç»è¿‡<code>diff</code>åçš„<code>å·®å¼‚åŒ–</code>çš„éƒ¨åˆ†ã€‚</p><h3 id="JSXå’ŒcreateElement"><a href="#JSXå’ŒcreateElement" class="headerlink" title="JSXå’ŒcreateElement"></a>JSXå’ŒcreateElement</h3><p>æˆ‘ä»¬åœ¨å®ç°ä¸€ä¸ªReactç»„ä»¶æ—¶å¯ä»¥é€‰æ‹©ä¸¤ç§ç¼–ç æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨<code>JSX</code>ç¼–å†™ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello hzf<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ˜¯ç›´æ¥ä½¿ç”¨<code>React.createElement</code>ç¼–å†™ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(<span class="string">'div'</span>, <span class="literal">null</span>, <span class="string">`Hello hzf`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œä¸Šé¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œ<code>JSXåªæ˜¯ä¸º React.createElement(component, props, ...children)</code>æ–¹æ³•æä¾›çš„è¯­æ³•ç³–ã€‚ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„JSXä»£ç æœ€åéƒ½ä¼šè½¬æ¢æˆ<code>React.createElement(...)</code>ï¼Œ<code>Babel</code>å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†è¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šbabelåœ¨ç¼–è¯‘æ—¶ä¼šåˆ¤æ–­JSXä¸­ç»„ä»¶çš„é¦–å­—æ¯ï¼Œå½“<code>é¦–å­—æ¯ä¸ºå°å†™æ—¶</code>ï¼Œå…¶è¢«è®¤å®šä¸º<code>åŸç”ŸDOMæ ‡ç­¾</code>ï¼ŒcreateElementçš„ç¬¬ä¸€ä¸ªå˜é‡è¢«ç¼–è¯‘ä¸ºå­—ç¬¦ä¸²ï¼›å½“<code>é¦–å­—æ¯ä¸ºå¤§å†™æ—¶</code>ï¼Œå…¶è¢«è®¤å®šä¸ºè‡ªå®šä¹‰<code>ç»„ä»¶</code>ï¼ŒcreateElementçš„ç¬¬ä¸€ä¸ªå˜é‡è¢«<code>ç¼–è¯‘ä¸ºå¯¹è±¡</code>,æ‰€ä»¥ç»„ä»¶é¦–å­—æ¯è¦å¤§å†™</p><h3 id="Virtual-DOM"><a href="#Virtual-DOM" class="headerlink" title="Virtual DOM"></a>Virtual DOM</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/%E8%99%9A%E6%8B%9Fdom.png" alt=""></p><p>å†·é™å¯¹å¾…è™šæ‹Ÿdomï¼Œä»–ä¸æ˜¯ä¸€å®šèƒ½å¤Ÿæå‡é¡µé¢çš„æ€§èƒ½ï¼Œå¦‚æœæ˜¯é¦–æ¬¡æ¸²æŸ“ï¼ŒVitrua lDomä¸å…·æœ‰ä»»ä½•ä¼˜åŠ¿ï¼Œç”šè‡³å®ƒè¦è¿›è¡Œæ›´å¤šçš„è®¡ç®—ï¼Œæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼Œæ˜¯å› ä¸ºæœ‰diffä»–æ‰ä¼šå±•ç°å®ƒçš„ä¼˜åŠ¿</p><h4 id="Virtual-DOMçš„å­˜åœ¨çš„æ„ä¹‰"><a href="#Virtual-DOMçš„å­˜åœ¨çš„æ„ä¹‰" class="headerlink" title="Virtual DOMçš„å­˜åœ¨çš„æ„ä¹‰"></a>Virtual DOMçš„å­˜åœ¨çš„æ„ä¹‰</h4><ul><li>Vitrua Domä¸ºReactå¸¦æ¥äº†è·¨å¹³å°æ¸²æŸ“çš„èƒ½åŠ›ã€‚ä»¥React Nativeä¸ºä¾‹å­;Reactæ ¹æ®Vitrual Domç”»å‡ºç›¸åº”å¹³å°çš„uiå±‚ï¼Œåªä¸è¿‡ä¸åŒå¹³å°ç”»çš„å§¿åŠ¿ä¸åŒè€Œå·²</li><li>æœåŠ¡ç«¯æ¸²æŸ“</li><li>å‡½æ•°å¼ç¼–ç¨‹</li></ul><h4 id="Virtual-DOM-åŸºæœ¬æ­¥éª¤"><a href="#Virtual-DOM-åŸºæœ¬æ­¥éª¤" class="headerlink" title="Virtual DOM åŸºæœ¬æ­¥éª¤:"></a>Virtual DOM åŸºæœ¬æ­¥éª¤:</h4><ol><li>ç”¨<code>jså¯¹è±¡æ¥è¡¨ç¤ºDOMæ ‘çš„ç»“æ„</code>ï¼› ç„¶åç”¨è¿™ä¸ªæ ‘æ„å»ºä¸€ä¸ªçœŸæ­£çš„DOMæ ‘ï¼Œæ’å…¥åˆ°æ–‡æ¡£ä¸­ã€‚</li><li>å½“çŠ¶æ€å˜æ›´çš„æ—¶å€™ï¼Œ<code>é‡æ–°æ„é€ ä¸€ä¸ªæ–°çš„å¯¹è±¡</code>ï¼Œç„¶åç”¨è¿™ä¸ªæ–°çš„æ ‘å’Œæ—§çš„æ ‘ä½œå¯¹æ¯”ï¼Œè®°å½•<code>ä¸¤ä¸ªæ ‘çš„å·®å¼‚</code>ã€‚ </li><li>æŠŠ2æ‰€è®°å½•çš„å·®å¼‚åº”ç”¨åœ¨æ­¥éª¤1æ‰€æ„å»ºçš„çœŸæ­£çš„DOMæ ‘ä¸Šï¼Œè§†å›¾å°±æ›´æ–°äº†ã€‚</li></ol><p>çœ‹çœ‹è™šæ‹ŸDOMçš„çœŸå®æ¨¡æ ·</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H66008463790e4f8d9feaa1f12800ee9cm.png" alt=""></p><ul><li><code>type</code>ï¼šå…ƒç´ çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯åŸç”Ÿhtmlç±»å‹ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œæˆ–è€…è‡ªå®šä¹‰ç»„ä»¶ï¼ˆå‡½æ•°æˆ–classï¼‰</li><li><code>key</code>ï¼šç»„ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºDiffç®—æ³•</li><li><code>ref</code>ï¼šç”¨äºè®¿é—®åŸç”ŸdomèŠ‚ç‚¹</li><li><code>props</code>ï¼šä¼ å…¥ç»„ä»¶çš„props</li><li><code>owner</code>ï¼šå½“å‰æ­£åœ¨æ„å»ºçš„Componentæ‰€å±çš„Component</li><li><code>$$typeof</code>ï¼šé˜²æ­¢xssæ”»å‡»ï¼Œå¦‚æœä½ çš„æœåŠ¡å™¨æœ‰ä¸€ä¸ªæ¼æ´ï¼Œå…è®¸ç”¨æˆ·å­˜å‚¨ä»»æ„JSONå¯¹è±¡ï¼Œ è€Œå®¢æˆ·ç«¯ä»£ç éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™å¯èƒ½ä¸ºä½ çš„åº”ç”¨ç¨‹åºå¸¦æ¥é£é™©ã€‚JSONä¸­ä¸èƒ½å­˜å‚¨Symbolç±»å‹çš„å˜é‡ï¼Œè€ŒReactæ¸²æŸ“æ—¶ä¼šæŠŠæ²¡æœ‰<code>$$typeof</code>æ ‡è¯†çš„ç»„ä»¶è¿‡æ»¤æ‰ã€‚</li><li><code>self</code>æŒ‡å®šå½“å‰ä½äºå“ªä¸ªç»„ä»¶å®ä¾‹ã€‚</li><li><code>_source</code>æŒ‡å®šè°ƒè¯•ä»£ç æ¥è‡ªçš„æ–‡ä»¶(fileName)å’Œä»£ç è¡Œæ•°(lineNumber)ã€‚</li></ul><h4 id="ç®€å•å®ç°-vdom"><a href="#ç®€å•å®ç°-vdom" class="headerlink" title="ç®€å•å®ç° vdom"></a>ç®€å•å®ç° vdom</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./createElement.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">React</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè™šæ‹Ÿdomç”¨çš„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>type æ ‡ç­¾çš„ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>options props</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param  <span class="type">&#123;...any&#125;</span> </span>arg å­ä»£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> createElement(type, options, ...arg) &#123;</span><br><span class="line">        <span class="comment">// optionsè‚¯å®šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸ç®¡ä¼ è¿˜æ˜¯ä¸ä¼ </span></span><br><span class="line">        options = options || <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//argæ˜¯å­˜å‚¨ä¸Šä¸‹çš„å‚æ•°ï¼Œå³ä½¿æ²¡æœ‰å…¶ä»–çš„å‚æ•°ï¼Œargä¹Ÿæ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼Œ</span></span><br><span class="line">        <span class="keyword">let</span> obj = &#123;</span><br><span class="line">            type,</span><br><span class="line">            key: <span class="literal">null</span>,</span><br><span class="line">            ref: <span class="literal">null</span>,</span><br><span class="line">            props: &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//key ref</span></span><br><span class="line">        [<span class="string">"key"</span>, <span class="string">"ref"</span>].forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item <span class="keyword">in</span> options) &#123;</span><br><span class="line">                obj[item] = options[item];</span><br><span class="line">                <span class="keyword">delete</span> options[item]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//å¤„ç†props</span></span><br><span class="line">        obj.props = &#123; ...options &#125;;</span><br><span class="line">        <span class="comment">//å› ä¸ºæˆ‘è¿™ç”¨çš„es6è¯­æ³•ï¼Œä¸‹é¢çš„åˆ¤æ–­æ²¡ä»€ä¹ˆä½œç”¨ï¼Œç”¨es5çš„è¯éœ€è¦åŠ ä¸Š</span></span><br><span class="line">        <span class="keyword">let</span> len = arg.length;</span><br><span class="line">        <span class="keyword">switch</span> (len) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                obj.props.children = arg[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// æ‹¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">                obj.props.children = arg</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReactDom</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†è™šæ‹ŸèŠ‚ç‚¹è½¬æ¢æˆçœŸå®çš„domèŠ‚ç‚¹ï¼Œæœ€åæ’å…¥åˆ°containerå®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>objJSX ç¼–è¯‘åçš„è™šæ‹ŸèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>container è¦æ¸²æŸ“åˆ°é‚£ä¸ªå®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>callback å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> render(objJSX, container, callback) &#123;</span><br><span class="line">        <span class="keyword">let</span> newEle = ReactDom.createDomElementFromVnode(objJSX)</span><br><span class="line">        container.appendChild(newEle);</span><br><span class="line">        callback &amp;&amp; callback();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> createDomElementFromVnode(objJSX)&#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; type, props &#125; = objJSX;</span><br><span class="line">        objJSX.newEle = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">        <span class="comment">//è®¾ç½®å±æ€§</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!props.hasOwnProperty(key)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">//className</span></span><br><span class="line">            <span class="keyword">if</span> (key === <span class="string">"className"</span>) &#123;</span><br><span class="line">                objJSX.newEle.setAttribute(<span class="string">"class"</span>, props[<span class="string">"className"</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//styleè®¾ç½®</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">"style"</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> props[<span class="string">'style'</span>]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (props[<span class="string">"style"</span>].hasOwnProperty(key)) &#123;</span><br><span class="line">                        objJSX.newEle[<span class="string">"style"</span>][key] = props[<span class="string">"style"</span>][key]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//children</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">"children"</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> children = props[<span class="string">'children'</span>];</span><br><span class="line">                <span class="keyword">if</span> (children <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">                    children.forEach(<span class="function"><span class="params">itemChildren</span> =&gt;</span> &#123;</span><br><span class="line">                        ReactDom.handChildren(itemChildren, objJSX.newEle)</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                ReactDom.handChildren(children, objJSX.newEle);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                objJSX.newEle.setAttribute(key, props[key]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> objJSX.newEle</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> handChildren(children, newEle) &#123;</span><br><span class="line">        <span class="comment">//åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> children === <span class="string">"object"</span>) &#123;</span><br><span class="line">            <span class="comment">//å½“å‰å”¯ä¸€çš„æ–°å¯¹è±¡</span></span><br><span class="line">            ReactDom.render(children, newEle)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newEle.appendChild(<span class="built_in">document</span>.createTextNode(children))</span><br><span class="line">            <span class="built_in">console</span>.log(newEle)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> styleObj = &#123; <span class="attr">color</span>: <span class="string">'red'</span> &#125;;</span><br><span class="line"></span><br><span class="line">ReactDom.render(</span><br><span class="line">    React.createElement(<span class="string">"div"</span>, &#123;</span><br><span class="line">        id: <span class="string">"box"</span>,</span><br><span class="line">        className: <span class="string">"box"</span>,</span><br><span class="line">        style: styleObj</span><br><span class="line">      &#125;, React.createElement(<span class="string">"h2"</span>, &#123;</span><br><span class="line">        className: <span class="string">"title"</span></span><br><span class="line">      &#125;, <span class="string">"\u8FD9\u91CC\u662F\u5934\u90E8"</span>), React.createElement(<span class="string">"ul"</span>, &#123;</span><br><span class="line">        className: <span class="string">"newsItem"</span></span><br><span class="line">      &#125;, React.createElement(<span class="string">"li"</span>, &#123;</span><br><span class="line">        key: <span class="string">"1"</span>,</span><br><span class="line">        style: &#123;</span><br><span class="line">          color: <span class="string">"#ccc"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="string">"\u54C8\u54C8\u54C8"</span>), React.createElement(<span class="string">"li"</span>, &#123;</span><br><span class="line">        key: <span class="string">"2"</span></span><br><span class="line">      &#125;, <span class="string">"\u5475\u5475\u5475"</span>)), <span class="string">"1221"</span>), </span><br><span class="line">    <span class="built_in">window</span>.app</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œæ¥è¿›è¡Œæ ‘ä¸ŠèŠ‚ç‚¹çš„å¢åˆ æ”¹çš„æ“ä½œã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯åˆ†ä¸ºdiffå’Œpatchï¼š</p><ul><li><strong>diff</strong>ï¼šé€’å½’å¯¹æ¯”ä¸¤æ£µ VDom æ ‘çš„ã€å¯¹åº”ä½ç½®çš„èŠ‚ç‚¹å·®å¼‚</li><li><strong>patch</strong>ï¼šæ ¹æ®ä¸åŒçš„å·®å¼‚ï¼Œè¿›è¡ŒèŠ‚ç‚¹çš„æ›´æ–°</li></ul><h3 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h3><p>å…¶å®Reactçš„ virtual domçš„æ€§èƒ½å¥½ä¹Ÿç¦»ä¸å¼€å®ƒæœ¬èº«ç‰¹æ®Šçš„diffç®—æ³•ã€‚ä¼ ç»Ÿçš„diffç®—æ³•æ—¶é—´å¤æ‚åº¦è¾¾åˆ°O(n3)ï¼Œè€Œreactçš„diffç®—æ³•æ—¶é—´å¤æ‚åº¦åªæ˜¯o(n)ï¼Œreactçš„diffèƒ½å‡å°‘åˆ°o(n)ä¾é çš„æ˜¯react diffçš„ä¸‰å¤§ç­–ç•¥ã€‚</p><h4 id="ä¼ ç»Ÿdiff-å¯¹æ¯”-react-diff"><a href="#ä¼ ç»Ÿdiff-å¯¹æ¯”-react-diff" class="headerlink" title="ä¼ ç»Ÿdiff å¯¹æ¯” react diff"></a>ä¼ ç»Ÿdiff å¯¹æ¯” react diff</h4><p>ä¼ ç»Ÿçš„diffç®—æ³•è¿½æ±‚çš„æ˜¯â€œ<code>å®Œå…¨</code>â€ä»¥åŠâ€œ<code>æœ€å°</code>â€ï¼Œè€Œreact diffåˆ™æ˜¯æ”¾å¼ƒäº†è¿™ä¸¤ç§è¿½æ±‚ï¼š<br>åœ¨ä¼ ç»Ÿçš„diffç®—æ³•ä¸‹ï¼Œå¯¹æ¯”å‰åä¸¤ä¸ªèŠ‚ç‚¹ï¼Œ<code>å¦‚æœå‘ç°èŠ‚ç‚¹æ”¹å˜äº†ï¼Œä¼šç»§ç»­å»æ¯”è¾ƒèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œä¸€å±‚ä¸€å±‚å»å¯¹æ¯”</code>ã€‚å°±è¿™æ ·å¾ªç¯é€’å½’å»è¿›è¡Œå¯¹æ¯”ï¼Œå¤æ‚åº¦å°±è¾¾åˆ°äº†O(n3)ï¼Œnæ˜¯æ ‘çš„èŠ‚ç‚¹æ•°ï¼Œæƒ³è±¡ä¸€ä¸‹å¦‚æœè¿™æ£µæ ‘æœ‰1000ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¾—æ‰§è¡Œä¸Šåäº¿æ¬¡æ¯”è¾ƒï¼Œè¿™ç§é‡çº§çš„å¯¹æ¯”æ¬¡æ•°ï¼Œæ—¶é—´åŸºæœ¬è¦ç”¨ç§’æ¥åšè®¡æ•°å•ä½äº†ã€‚</p><h4 id="React-diff-ä¸‰å¤§ç­–ç•¥"><a href="#React-diff-ä¸‰å¤§ç­–ç•¥" class="headerlink" title="React diff ä¸‰å¤§ç­–ç•¥"></a>React diff ä¸‰å¤§ç­–ç•¥</h4><ul><li><strong>tree diff</strong>ï¼šWeb UIä¸­DOMèŠ‚ç‚¹è·¨å±‚çº§çš„ç§»åŠ¨æ“ä½œç‰¹åˆ«å°‘ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚<code>ï¼ˆDOMç»“æ„å‘ç”Ÿæ”¹å˜-----ç›´æ¥å¸è½½å¹¶é‡æ–°creatï¼‰</code></li><li><strong>component diff</strong>ï¼šç»„ä»¶çš„DOMç»“æ„ä¸€æ ·â€”â€“ä¸ä¼šå¸è½½,ä½†æ˜¯ä¼šupdate</li><li><strong>element diff</strong>ï¼šæ‰€æœ‰åŒä¸€å±‚çº§çš„å­èŠ‚ç‚¹.ä»–ä»¬éƒ½å¯ä»¥é€šè¿‡keyæ¥åŒºåˆ†â€”â€“åŒæ—¶éµå¾ª1.2ä¸¤ç‚¹</li></ul><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H9b1d122f787048f7afc393265e732d28D.png" alt=""></p><h4 id="è™šæ‹ŸDOMæ ‘åˆ†å±‚æ¯”è¾ƒï¼ˆtree-diffï¼‰"><a href="#è™šæ‹ŸDOMæ ‘åˆ†å±‚æ¯”è¾ƒï¼ˆtree-diffï¼‰" class="headerlink" title="è™šæ‹ŸDOMæ ‘åˆ†å±‚æ¯”è¾ƒï¼ˆtree diffï¼‰"></a>è™šæ‹ŸDOMæ ‘åˆ†å±‚æ¯”è¾ƒï¼ˆ<code>tree diff</code>ï¼‰</h4><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H087b9d785877406b94078d9b6a07c15av.png" alt=""></p><p>ä¸Šå›¾ä¸­ï¼Œ<strong>divåªä¼šå’ŒåŒä¸€å±‚çº§çš„divå¯¹æ¯”ï¼Œç¬¬äºŒå±‚çº§çš„åªä¼šå’Œç¬¬äºŒå±‚çº§å¯¹æ¯”ã€‚ è¿™æ ·ç®—æ³•å¤æ‚åº¦å°±å¯ä»¥è¾¾åˆ°O(n)</strong>ã€‚</p><p>ä½†æ˜¯å¦‚æœDOMèŠ‚ç‚¹å‡ºç°äº†è·¨å±‚çº§æ“ä½œï¼Œdiffä¼šå¦‚ä½•å¤„ç†ï¼Ÿ</p><p>Reactæ˜¯ä¸ä¼šæœºæ™ºçš„åˆ¤æ–­å‡ºå­æ ‘ä»…ä»…æ˜¯å‘ç”Ÿäº†ç§»åŠ¨ï¼Œè€Œæ˜¯<strong>ä¼šç›´æ¥é”€æ¯</strong>ï¼Œå¹¶é‡æ–°åˆ›å»ºè¿™ä¸ªå­æ ‘ï¼Œç„¶åå†æŒ‚åœ¨åˆ°ç›®æ ‡DOMä¸Š;<br/><br>å®é™…ä¸Šï¼ŒReactå®˜æ–¹ä¹Ÿå¹¶ä¸æ¨èæˆ‘ä»¬åšå‡ºè·¨å±‚çº§çš„éªšæ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»ä¸­æ‚Ÿå‡ºä¸€ä¸ªé“ç†ï¼šå°±æ˜¯æˆ‘ä»¬è‡ªå·±åœ¨å®ç°ç»„ä»¶çš„æ—¶å€™ï¼Œä¸€ä¸ªç¨³å®šçš„DOMç»“æ„æ˜¯æœ‰åŠ©äºæˆ‘ä»¬çš„æ€§èƒ½æå‡çš„ã€‚</p><h4 id="ç»„ä»¶é—´çš„æ¯”è¾ƒï¼ˆcomponent-diffï¼‰"><a href="#ç»„ä»¶é—´çš„æ¯”è¾ƒï¼ˆcomponent-diffï¼‰" class="headerlink" title="ç»„ä»¶é—´çš„æ¯”è¾ƒï¼ˆcomponent diffï¼‰"></a>ç»„ä»¶é—´çš„æ¯”è¾ƒï¼ˆ<code>component diff</code>ï¼‰</h4><p>æ ¸å¿ƒçš„ç­–ç•¥è¿˜æ˜¯çœ‹ç»“æ„æ˜¯å¦å‘ç”Ÿæ”¹å˜ã€‚Reactæ˜¯åŸºäºç»„ä»¶æ„å»ºåº”ç”¨çš„ï¼Œå¯¹äºç»„ä»¶é—´çš„æ¯”è¾ƒæ‰€é‡‡ç”¨çš„ç­–ç•¥ä¹Ÿæ˜¯éå¸¸ç®€æ´å’Œé«˜æ•ˆçš„ã€‚</p><p><strong>å¦‚æœæ˜¯åŒä¸€ä¸ªç±»å‹çš„ç»„ä»¶</strong>ï¼Œåˆ™æŒ‰ç…§åŸç­–ç•¥è¿›è¡ŒVirtual DOMæ¯”è¾ƒã€‚<br/><br><strong>å¦‚æœä¸æ˜¯åŒä¸€ç±»å‹çš„ç»„ä»¶</strong>ï¼Œåˆ™å°†å…¶åˆ¤æ–­ä¸ºdirty componentï¼Œä»è€Œæ›¿æ¢æ•´ä¸ªç»„ä»·ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚<br/><br><strong>å¦‚æœæ˜¯åŒä¸€ä¸ªç±»å‹çš„ç»„ä»¶ï¼Œæœ‰å¯èƒ½ç»è¿‡ä¸€è½®Virtual DOMæ¯”è¾ƒä¸‹æ¥ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–</strong>ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæå‰ç¡®åˆ‡çŸ¥é“è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥çœä¸‹å¤§é‡çš„diffè¿ç®—æ—¶é—´ã€‚å› æ­¤ï¼ŒReactå…è®¸ç”¨æˆ·é€šè¿‡shouldComponentUpdate()æ¥åˆ¤æ–­è¯¥ç»„ä»¶æ˜¯å¦éœ€è¦è¿›è¡Œdiffç®—æ³•åˆ†æã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹æ¯”è‡ªå®šä¹‰ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">diffComponent</span>(<span class="params">oldNode, newNode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (oldNode._component &amp;&amp; (oldNode._component.constructor !== newNode.nodeName)) &#123; <span class="comment">// å¦‚æœæ–°è€ç»„ä»¶ä¸åŒ, åˆ™ç›´æ¥å°†æ–°ç»„ä»¶æ›¿æ¢è€ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">const</span> newDom = vdomToDom(newNode)</span><br><span class="line">    oldNode._component.parentNode.insertBefore(newDom, oldNode._component)</span><br><span class="line">    oldNode._component.parentNode.removeChild(oldNode._component)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    setProps(oldNode._component, newNode.attributes) <span class="comment">// å¦‚æœæ–°è€ç»„ä»¶ç›¸åŒ, åˆ™å°†æ–°ç»„ä»¶çš„ props èµ‹åˆ°è€ç»„ä»¶ä¸Š</span></span><br><span class="line">    renderComponent(oldNode._component)              <span class="comment">// å¯¹è·å¾—æ–° props å‰åçš„è€ç»„ä»¶åš diff æ¯”è¾ƒï¼ˆrenderComponent ä¸­è°ƒç”¨äº† diffï¼‰</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…ƒç´ é—´çš„æ¯”è¾ƒï¼ˆelement-diffï¼‰"><a href="#å…ƒç´ é—´çš„æ¯”è¾ƒï¼ˆelement-diffï¼‰" class="headerlink" title="å…ƒç´ é—´çš„æ¯”è¾ƒï¼ˆelement diffï¼‰"></a>å…ƒç´ é—´çš„æ¯”è¾ƒï¼ˆ<code>element diff</code>ï¼‰</h4><p>å½“èŠ‚ç‚¹å¤„äºåŒä¸€å±‚çº§çš„æ—¶å€™ï¼Œreact diff æä¾›äº†ä¸‰ç§èŠ‚ç‚¹æ“ä½œï¼š<strong>æ’å…¥ã€åˆ é™¤ã€ç§»åŠ¨</strong>ã€‚</p><p><span style='display: block;text-align: left;'> æ“ä½œ</span>|<span style='display: block;text-align: left;'> æè¿°</span>|<br>â€“|:â€“:|:â€“:|â€“|<br>æ’å…¥|æ–°èŠ‚ç‚¹ä¸å­˜åœ¨äºè€é›†åˆå½“ä¸­ï¼Œå³å…¨æ–°çš„èŠ‚ç‚¹ï¼Œå°±ä¼šæ‰§è¡Œæ’å…¥æ“ä½œ|<br>ç§»åŠ¨|æ–°èŠ‚ç‚¹åœ¨è€é›†åˆä¸­å­˜åœ¨ï¼Œå¹¶ä¸”åªåšäº†ä½ç½®ä¸Šçš„æ›´æ–°ï¼Œå°±ä¼šå¤ç”¨ä¹‹å‰çš„èŠ‚ç‚¹ï¼Œåšç§»åŠ¨æ“ä½œï¼ˆä¾èµ–äºKeyï¼‰|<br>åˆ é™¤|æ–°èŠ‚ç‚¹åœ¨è€é›†åˆä¸­å­˜åœ¨ï¼Œä½†èŠ‚ç‚¹åšå‡ºäº†æ›´æ”¹ä¸èƒ½ç›´æ¥å¤ç”¨ï¼Œåšå‡ºåˆ é™¤æ“ä½œ|</p><h4 id="Keyçš„ä½œç”¨"><a href="#Keyçš„ä½œç”¨" class="headerlink" title="Keyçš„ä½œç”¨"></a>Keyçš„ä½œç”¨</h4><p><strong>reactåˆ©ç”¨keyæ¥è¯†åˆ«ç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ç§èº«ä»½æ ‡è¯†æ ‡è¯†ï¼Œå°±åƒæˆ‘ä»¬çš„èº«ä»½è¯ç”¨æ¥è¾¨è¯†ä¸€ä¸ªäººä¸€æ ·</strong>ã€‚æ¯ä¸ªkeyå¯¹åº”ä¸€ä¸ªç»„ä»¶ï¼Œç›¸åŒçš„key reactè®¤ä¸ºæ˜¯åŒä¸€ä¸ªç»„ä»¶ï¼Œè¿™æ ·åç»­ç›¸åŒçš„keyå¯¹åº”ç»„ä»¶éƒ½ä¸ä¼šè¢«åˆ›å»ºã€‚</p><p><strong>keyçš„ä½¿ç”¨åœºæ™¯</strong></p><ul><li>æ•°ç»„åŠ¨æ€åˆ›å»ºçš„å­ç»„ä»¶</li><li>ä¸ºä¸€ä¸ªæœ‰å¤æ‚ç¹çé€»è¾‘çš„ç»„ä»¶æ·»åŠ keyåï¼Œåç»­æ“ä½œå¯ä»¥æ”¹å˜è¯¥ç»„ä»¶çš„keyå±æ€§å€¼ï¼Œä»è€Œè¾¾åˆ°å…ˆé”€æ¯ä¹‹å‰çš„ç»„ä»¶ï¼Œå†é‡æ–°åˆ›å»ºè¯¥ç»„ä»¶ã€‚</li></ul><p>æˆ‘ä»¬åœ¨å¾ªç¯æ¸²æŸ“åˆ—è¡¨æ—¶å€™(map)æ—¶å€™å¿˜è®°æ ‡è®°keyå€¼æŠ¥çš„è­¦å‘Š,æ—¢ç„¶æ˜¯è­¦å‘Š,å°±è¯´æ˜å³ä½¿æ²¡æœ‰keyçš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šå½±å“ç¨‹åºæ‰§è¡Œçš„æ­£ç¡®æ€§,å…¶å®è¿™ä¸ªkeyçš„å­˜åœ¨åªä¼š<code>å½±å“diffç®—æ³•çš„å¤æ‚åº¦</code>(ä¸æ˜¯ä¸€å®šä¼šæé«˜æ€§èƒ½),ä¹Ÿå°±æ˜¯è¯´ä½ ä¸åŠ ä¸ŠKeyå°±ä¼šæš´åŠ›æ¸²æŸ“ï¼ŒåŠ äº†Keyä¹‹åï¼ŒReactå°±å¯ä»¥åšå‡ºç§»åŠ¨çš„æ“ä½œäº†ï¼Œçœ‹ä¾‹å­ï¼š</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H1f3780ed47c947c8b8b9c9a5092a06507.png" alt=""></p><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½åŠ ä¸Šäº†å”¯ä¸€çš„keyå€¼ï¼Œé€šè¿‡è¿™ä¸ª<strong>Keyå€¼å‘ç°æ–°è€é›†åˆé‡Œé¢å…¶å®å…¨éƒ¨éƒ½æ˜¯ç›¸åŒçš„å…ƒç´ </strong>ï¼Œåªä¸è¿‡ä½ç½®å‘ç”Ÿäº†æ”¹å˜ã€‚å› æ­¤å°±æ— éœ€è¿›è¡ŒèŠ‚ç‚¹çš„æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œäº†ï¼Œåªéœ€è¦å°†è€é›†åˆå½“ä¸­èŠ‚ç‚¹çš„ä½ç½®è¿›è¡Œç§»åŠ¨å°±å¯ä»¥äº†ã€‚Reactç»™å‡ºçš„diffç»“æœä¸ºï¼š<code>Bã€Dä¸åšæ“ä½œï¼ŒAã€Cè¿›è¡Œç§»åŠ¨æ“ä½œ</code>ã€‚reactæ˜¯å¦‚ä½•åˆ¤æ–­è°è¯¥ç§»åŠ¨ï¼Œè°è¯¥ä¸åŠ¨çš„å‘¢ï¼Ÿ</p><p>reactä¼šå»å¾ªç¯æ•´ä¸ªæ–°çš„é›†åˆï¼š</p><p>â‘  ä»æ–°é›†åˆä¸­å–åˆ°<code>B</code>ï¼Œç„¶åå»æ—§é›†åˆä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„<code>B</code>ï¼Œç¡®è®¤<code>B</code>å­˜åœ¨åï¼Œå†å»åˆ¤æ–­æ˜¯å¦è¦ç§»åŠ¨ï¼š<br><code>B</code>åœ¨æ—§é›†åˆä¸­çš„<code>index = 1</code>ï¼Œæœ‰ä¸€ä¸ªæ¸¸æ ‡å«åš<code>lastindex</code>ã€‚é»˜è®¤<code>lastindex = 0</code>ï¼Œç„¶åä¼šæŠŠæ—§é›†åˆçš„<code>indexå’Œæ¸¸æ ‡ä½œ</code>å¯¹æ¯”æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»åŠ¨ï¼Œå¦‚æœ<strong>index &lt; lastindex ï¼Œé‚£ä¹ˆå°±åšç§»åŠ¨æ“ä½œ</strong>ï¼Œåœ¨è¿™é‡Œ<code>Bçš„index = 1</code>ï¼Œä¸æ»¡è¶³äº <code>index &lt; lastindex</code>,æ‰€ä»¥å°±ä¸åšç§»åŠ¨æ“ä½œï¼Œç„¶åæ¸¸æ ‡lastindexæ›´æ–°ï¼Œ<code>å–(index, lastindex) çš„è¾ƒå¤§å€¼</code>ï¼Œè¿™é‡Œå°±æ˜¯<code>lastindex = 1</code></p><p>â‘¡ ç„¶åéå†åˆ°<code>A</code>ï¼Œ<code>A</code>åœ¨è€é›†åˆä¸­çš„<code>index = 0</code>ï¼Œæ­¤æ—¶çš„æ¸¸æ ‡<code>lastindex = 1</code>ï¼Œæ»¡è¶³<code>index &lt; lastinde</code>xï¼Œæ‰€ä»¥å¯¹Aéœ€è¦ç§»åŠ¨åˆ°å¯¹åº”çš„ä½ç½®ï¼Œæ­¤æ—¶<code>lastindex = max(index, lastindex) = 1</code></p><p>â‘¢ ç„¶åéå†åˆ°<code>D</code>ï¼Œ<code>D</code>åœ¨è€é›†åˆä¸­çš„<code>index = 3</code>ï¼Œæ­¤æ—¶æ¸¸æ ‡<code>lastindex = 1</code>ï¼Œä¸æ»¡è¶³<code>index &lt; lastindex</code>ï¼Œæ‰€ä»¥Dä¿æŒä¸åŠ¨ã€‚<code>lastindex = max(index, lastindex) = 3</code></p><p>â‘£ ç„¶åéå†åˆ°<code>C</code>ï¼Œ<code>C</code>åœ¨è€é›†åˆä¸­çš„<code>index = 2</code>ï¼Œæ­¤æ—¶æ¸¸æ ‡<code>lastindex = 3</code>ï¼Œæ»¡è¶³ <code>index &lt; lastindex</code>ï¼Œæ‰€ä»¥Cç§»åŠ¨åˆ°å¯¹åº”ä½ç½®ã€‚Cä¹‹åæ²¡æœ‰èŠ‚ç‚¹äº†ï¼Œdiffå°±ç»“æŸäº†</p><p>ä»¥ä¸Šä¸»è¦åˆ†ææ–°è€é›†åˆä¸­<code>èŠ‚ç‚¹ç›¸åŒä½†ä½ç½®ä¸åŒ</code>çš„æƒ…æ™¯ï¼Œä»…å¯¹èŠ‚ç‚¹è¿›è¡Œä½ç½®ç§»åŠ¨çš„æƒ…å†µï¼Œå¦‚æœæ–°é›†åˆä¸­æœ‰æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸”è€é›†åˆå­˜åœ¨éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ React diff åˆæ˜¯å¦‚ä½•å¯¹æ¯”è¿ä½œçš„å‘¢ï¼Ÿ</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Haafdd54eefeb47e1ad5fbb10e7f8ba9bE.png" alt=""></p><p>å’Œç¬¬ä¸€ç§æƒ…æ™¯åŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œreactè¿˜æ˜¯å»å¾ªç¯æ•´ä¸ªæ–°çš„é›†åˆï¼š<br>â‘  ä¸èµ˜è¿°äº†ï¼Œå’Œä¸Šé¢çš„ç¬¬ä¸€æ­¥æ˜¯ä¸€æ ·çš„ï¼Œ<code>Bä¸åšç§»åŠ¨ï¼Œlastindex = 1</code></p><p>â‘¡ æ–°é›†åˆå–å¾—<code>E</code>ï¼Œå‘ç°æ—§é›†åˆä¸­ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºEå¹¶æ”¾åœ¨æ–°é›†åˆå¯¹åº”çš„ä½ç½®ï¼Œ<code>lastindex = 1</code></p><p>â‘¢ éå†åˆ°<code>C</code>ï¼Œä¸æ»¡è¶³<code>index &lt; lastindex</code>ï¼Œ<code>C</code>ä¸åŠ¨ï¼Œ<code>lastindex = 2</code></p><p>â‘£ éå†åˆ°<code>A</code>ï¼Œæ»¡è¶³<code>index &lt; lastindex</code>ï¼Œ<code>A</code>ç§»åŠ¨åˆ°å¯¹åº”ä½ç½®ï¼Œ<code>lastindex = 2</code></p><p>â‘¤ å½“å®Œæˆæ–°é›†åˆä¸­æ‰€æœ‰èŠ‚ç‚¹ <code>diff</code> æ—¶ï¼Œæœ€åè¿˜éœ€è¦å¯¹è€é›†åˆè¿›è¡Œå¾ªç¯éå†ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–°é›†åˆä¸­æ²¡æœ‰ä½†è€é›†åˆä¸­ä»å­˜åœ¨çš„èŠ‚ç‚¹ï¼Œå‘ç°å­˜åœ¨è¿™æ ·çš„èŠ‚ç‚¹ <code>D</code>ï¼Œå› æ­¤<code>åˆ é™¤èŠ‚ç‚¹ D</code>ï¼Œåˆ°æ­¤ diff å…¨éƒ¨å®Œæˆ</p><p>ä½†æ˜¯ react diffä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå’Œéœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hc94d1ce042be45a5b6e694b0b034817cU.png" alt=""></p><p>åœ¨ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ï¼Œ<strong>Aã€Bã€Cã€D</strong>éƒ½æ²¡æœ‰å˜åŒ–ï¼Œä»…ä»…æ˜¯<code>D</code>çš„ä½ç½®å‘ç”Ÿäº†æ”¹å˜ã€‚çœ‹ä¸Šé¢çš„å›¾æˆ‘ä»¬å°±çŸ¥é“reactå¹¶æ²¡æœ‰æŠŠDçš„ä½ç½®ç§»åŠ¨åˆ°å¤´éƒ¨ï¼Œè€Œæ˜¯æŠŠ <strong>Aã€Bã€C</strong>åˆ†åˆ«ç§»åŠ¨åˆ°<code>D</code>çš„åé¢äº†ï¼Œé€šè¿‡å‰é¢çš„ä¸¤ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¹Ÿå¤§æ¦‚çŸ¥é“ï¼Œä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™æ ·çš„æƒ…å†µäº†ï¼š</p><p>å› ä¸º<code>D</code>èŠ‚ç‚¹åœ¨è€é›†åˆé‡Œé¢çš„<code>index</code> æ˜¯æœ€å¤§çš„ï¼Œä½¿å¾—<strong>Aã€Bã€C</strong>ä¸‰ä¸ªèŠ‚ç‚¹éƒ½ä¼š <code>index &lt; lastindex</code>ï¼Œä»è€Œå¯¼è‡´<strong>Aã€Bã€C</strong>éƒ½ä¼šå»åšç§»åŠ¨æ“ä½œã€‚æ‰€ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°½é‡å‡å°‘ç±»ä¼¼å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°åˆ—è¡¨é¦–éƒ¨çš„æ“ä½œï¼Œå½“èŠ‚ç‚¹æ•°é‡è¿‡å¤§æˆ–æ›´æ–°æ“ä½œè¿‡äºé¢‘ç¹æ—¶ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“ React çš„æ¸²æŸ“æ€§èƒ½ã€‚</p><h4 id="ä¸‰å¥ç®´è¨€"><a href="#ä¸‰å¥ç®´è¨€" class="headerlink" title="ä¸‰å¥ç®´è¨€"></a>ä¸‰å¥ç®´è¨€</h4><p>æ‰€ä»¥ç»è¿‡è¿™ä¹ˆä¸€åˆ†æ<code>react diff</code>çš„ä¸‰å¤§ç­–ç•¥ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨å¼€å‘ä¸­æ›´åŠ è¿›ä¸€æ­¥çš„æé«˜reactçš„æ¸²æŸ“æ•ˆç‡ã€‚</p><ul><li>åœ¨å¼€å‘ç»„ä»¶æ—¶ï¼Œä¿æŒç¨³å®šçš„ DOM ç»“æ„ä¼šæœ‰åŠ©äºæ€§èƒ½çš„æå‡ï¼›</li><li>ä½¿ç”¨ <code>shouldComponentUpdate()</code>æ–¹æ³•èŠ‚çœdiffçš„å¼€é”€</li><li>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°½é‡å‡å°‘ç±»ä¼¼å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°åˆ—è¡¨é¦–éƒ¨çš„æ“ä½œï¼Œå½“èŠ‚ç‚¹æ•°é‡è¿‡å¤§æˆ–æ›´æ–°æ“ä½œè¿‡äºé¢‘ç¹æ—¶ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“ React çš„æ¸²æŸ“æ€§èƒ½ã€‚</li></ul><h4 id="ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨indexä½œä¸ºKey"><a href="#ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨indexä½œä¸ºKey" class="headerlink" title="ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨indexä½œä¸ºKey"></a>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨indexä½œä¸ºKey</h4><p>çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">   state = &#123;</span><br><span class="line">      list: [&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">val</span>: <span class="string">'A'</span> &#125;, &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">val</span>: <span class="string">'B'</span> &#125;, &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">val</span>: <span class="string">'C'</span> &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">  click = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; list &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      list:list.reverse()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">this</span>.state.list.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">              &lt;li key=&#123;index&#125; &gt;</span><br><span class="line">                &#123;item.val&#125;</span><br><span class="line">                &lt;input type=<span class="string">"text"</span>&gt;&lt;<span class="regexp">/input&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>li&gt;</span><br><span class="line">            )</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.click&#125;&gt;Reverse&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/u</span>l&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ä¸‰ä¸ªè¾“å…¥æ¡†é‡Œé¢ï¼Œä¾æ¬¡è¾“å…¥1ï¼Œ2ï¼Œ3ï¼Œç‚¹å‡»ReverseæŒ‰é’®ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸï¼Œè¿™æ—¶å€™é¡µé¢åº”è¯¥æ¸²æŸ“æˆ3ï¼Œ2ï¼Œ1ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œé¡ºåºä¾ç„¶è¿˜æ˜¯1ï¼Œ2ï¼Œ3ï¼Œè¯æ˜æ•°æ®ç¡®å®æ˜¯æ›´æ–°äº†çš„ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æä¸€ä¸‹ï¼š</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H3ecb41d8764e4834b940428652f66478s.png" alt=""></p><p>å‡ºç°è¿™ç§æƒ…å†µï¼Œä½¿ç”¨keyæ˜¯ç”¨æ¥è¡¨ç¤ºå”¯ä¸€çš„æ ‡è¯†ç»„ä»¶ï¼Œå½“å‘ç°setStateå‰åkeyçš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ– ï¼Œreactå°±ä¼šè®¤ä¸ºä½ setStateå‰åæ˜¯åŒä¸€ä¸ªç»„ä»¶ï¼Œè¿›è€Œåªä¼šå¯¹å†…éƒ¨çš„å±æ€§è¿›è¡Œä¿®æ”¹ï¼š</p><ul><li>æ£€æµ‹keyå€¼å‘ç°éƒ½æ˜¯0ï¼Œåˆ¤å®šç»„ä»¶ä¸ºåŒä¸€ä¸ªã€‚</li><li>æ£€æµ‹item.valéƒ¨åˆ†ï¼Œå‘ç°æœ‰å˜åŒ–é‡æ–°æ¸²æŸ“è¿™éƒ¨åˆ†</li><li>æ£€æµ‹inputï¼Œå‘ç°ä¸ä¾èµ–propsï¼Œæ‰€ä»¥ä¸è¿›è¡Œé‡æ–°æ¸²æŸ“</li></ul><h4 id="diff-æºç "><a href="#diff-æºç " class="headerlink" title="diff æºç "></a>diff æºç </h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; diffå‡½æ•°ï¼Œå¯¹æ¯”ä¸¤é¢—æ ‘</span><br><span class="line">function diff(oldTree, newTree) &#123;</span><br><span class="line">    &#x2F;&#x2F; å½“å‰çš„èŠ‚ç‚¹çš„æ ‡å¿—ã€‚å› ä¸ºåœ¨æ·±åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªindexã€‚</span><br><span class="line">    var index &#x3D; 0;</span><br><span class="line">    &#x2F;&#x2F; åœ¨éå†åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œéƒ½éœ€è¦è¿›è¡Œå¯¹æ¯”ï¼Œæ‰¾åˆ°å·®å¼‚ï¼Œå¹¶è®°å½•åœ¨ä¸‹é¢çš„å¯¹è±¡ä¸­ã€‚</span><br><span class="line">    var pathches &#x3D; &#123;&#125;;</span><br><span class="line">    &#x2F;&#x2F; å¼€å§‹è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†</span><br><span class="line">    dfsWalk(oldTree, newTree, index, pathches);</span><br><span class="line">    &#x2F;&#x2F; æœ€ç»ˆdiffç®—æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªä¸¤æ£µæ ‘çš„å·®å¼‚ã€‚</span><br><span class="line">    return pathches;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å¯¹ä¸¤æ£µæ ‘è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ã€‚</span><br><span class="line">function dfsWalk(oldNode, newNode, index, pathches) &#123;</span><br><span class="line">    &#x2F;&#x2F; å¯¹æ¯”oldNodeå’ŒnewNodeçš„ä¸åŒï¼Œè®°å½•ä¸‹æ¥</span><br><span class="line">    pathches[index] &#x3D; [...];</span><br><span class="line">  if (_.isString(newNode)) &#123;</span><br><span class="line">    &#x2F;&#x2F; å¯¹æ¯”æ–‡æœ¬ dom èŠ‚ç‚¹</span><br><span class="line">    return diffTextDom(oldNode, newNode, index, pathches)   </span><br><span class="line">  &#125;</span><br><span class="line">  if (oldNode.nodeName.toLowerCase() !&#x3D;&#x3D; newNode.nodeName) &#123;</span><br><span class="line">    &#x2F;&#x2F; å¯¹æ¯”éæ–‡æœ¬ dom èŠ‚ç‚¹</span><br><span class="line">    diffNotTextDom(oldNode, newNode, index, pathches)     </span><br><span class="line">  &#125;</span><br><span class="line">  if (_.isFunction(newNode.nodeName)) &#123;</span><br><span class="line">    &#x2F;&#x2F; å¯¹æ¯”è‡ªå®šä¹‰ç»„ä»¶</span><br><span class="line">    return diffComponent(oldNode, newNode, index, pathches) </span><br><span class="line">  &#125;</span><br><span class="line">  if (</span><br><span class="line">     &#x2F;&#x2F; å€¼å¯¹æ¯”æ ‡ç­¾çš„ç±»å‹å’Œkeyå€¼æ˜¯å¦ä¸€è‡´</span><br><span class="line">      oldNode.type &#x3D;&#x3D;&#x3D; newNode.type &amp;&amp;</span><br><span class="line">      oldNode.key &#x3D;&#x3D;&#x3D; newNode.key</span><br><span class="line">    ) &#123;</span><br><span class="line">      var propsPatches &#x3D; diffProps(oldNode, newNode) &#x2F;&#x2F; å¯¹æ¯”å±æ€§</span><br><span class="line">      if (propsPatches) &#123;</span><br><span class="line">        pathches.push(&#123; type: patch.PROPS, props: propsPatches &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">     if (newVdom.children.length &gt; 0) &#123;</span><br><span class="line">       &#x2F;&#x2F; éå†å¯¹æ¯”å­èŠ‚ç‚¹</span><br><span class="line">       diffChildren(oldNode.children, newNode.children, index, pathches);  </span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; éå†å­èŠ‚ç‚¹</span><br><span class="line">function diffChildren(oldChildren, newChildren, index, pathches) &#123;  </span><br><span class="line">    var leftNode &#x3D; null;</span><br><span class="line">    var currentNodeIndex &#x3D; index;</span><br><span class="line">    oldChildren.forEach(function (child, i) &#123;</span><br><span class="line">    var newChild &#x3D; newChildren[i];</span><br><span class="line">    currentNodeIndex &#x3D; (leftNode &amp;&amp; leftNode.count)</span><br><span class="line">    ? currentNodeIndex + leftNode.count + 1</span><br><span class="line">    : currentNodeIndex + 1</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; æ·±åº¦éå†å­èŠ‚ç‚¹</span><br><span class="line">    dfsWalk(child, newChild, currentNodeIndex, pathches);</span><br><span class="line">    leftNode &#x3D; child;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/livoras/simple-virtual-dom/blob/master/lib/diff.js#L5" target="_blank" rel="noopener">è¯¦ç»†diffè·³è½¬</a></p><h3 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h3><p>å› ä¸ºæ­¥éª¤ä¸€æ‰€æ„å»ºçš„ JavaScript å¯¹è±¡æ ‘å’Œrenderå‡ºæ¥çœŸæ­£çš„DOMæ ‘çš„ä¿¡æ¯ã€ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹é‚£æ£µDOMæ ‘ä¹Ÿè¿›è¡Œæ·±åº¦ä¼˜å…ˆçš„éå†ï¼Œéå†çš„æ—¶å€™ä»æ­¥éª¤äºŒç”Ÿæˆçš„patcheså¯¹è±¡ä¸­æ‰¾å‡ºå½“å‰éå†çš„èŠ‚ç‚¹å·®å¼‚ï¼Œç„¶åè¿›è¡Œ DOM æ“ä½œã€‚</p><p><strong>å·®å¼‚ç±»å‹</strong></p><p>DOMæ“ä½œå¯èƒ½ä¼šï¼š</p><ul><li>æ›¿æ¢åŸæ¥çš„èŠ‚ç‚¹ï¼Œå¦‚æŠŠä¸Šé¢çš„divæ¢æˆäº†sectionã€‚ </li><li>ç§»åŠ¨ã€åˆ é™¤ã€æ–°å¢å­èŠ‚ç‚¹ï¼Œ ä¾‹å¦‚ä¸Šé¢divçš„å­èŠ‚ç‚¹ï¼ŒæŠŠpå’Œulé¡ºåºäº’æ¢ã€‚</li><li>ä¿®æ”¹äº†èŠ‚ç‚¹çš„å±æ€§ã€‚ </li><li>å¯¹äºæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ–‡æœ¬å†…å®¹å¯èƒ½ä¼šæ”¹å˜ã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸‹é¢çš„å‡ ç§ç±»å‹ï¼š</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> REPLACE = <span class="number">0</span>; </span><br><span class="line"><span class="keyword">var</span> REORDER = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> PROPS = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> TEXT = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//patchesé‡Œé¢å­˜å‚¨ç€å·®å¼‚çš„dom,æ˜¯ä¸ªæ•°ç»„</span></span><br><span class="line">patches[<span class="number">0</span>] = [</span><br><span class="line">  &#123;</span><br><span class="line">   type:  TEXT,</span><br><span class="line">   content: <span class="string">'word'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; </span><br><span class="line">    type: PROPS,</span><br><span class="line">    props: &#123;</span><br><span class="line">      id: <span class="string">'container'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>patch æºç </strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span> (<span class="params">node, patches</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> walker = &#123;<span class="attr">index</span>: <span class="number">0</span>&#125;</span><br><span class="line">  dfsWalk(node, walker, patches)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dfsWalk</span> (<span class="params">node, walker, patches</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> currentPatches = patches[walker.index] <span class="comment">// ä»patchesæ‹¿å‡ºå½“å‰èŠ‚ç‚¹çš„å·®å¼‚</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> len = node.childNodes</span><br><span class="line">    ? node.childNodes.length</span><br><span class="line">    : <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123; <span class="comment">// æ·±åº¦éå†å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">var</span> child = node.childNodes[i]</span><br><span class="line">    walker.index++</span><br><span class="line">    dfsWalk(child, walker, patches)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (currentPatches) &#123;</span><br><span class="line">    applyPatches(node, currentPatches) <span class="comment">// å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡ŒDOMæ“ä½œ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>applyPatchesï¼Œæ ¹æ®ä¸åŒç±»å‹çš„å·®å¼‚å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡Œ DOM æ“ä½œï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyPatches</span> (<span class="params">node, currentPatches</span>) </span>&#123;</span><br><span class="line">  currentPatches.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">currentPatch</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (currentPatch.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> REPLACE:</span><br><span class="line">        node.parentNode.replaceChild(currentPatch.node.render(), node)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> REORDER:</span><br><span class="line">        reorderChildren(node, currentPatch.moves)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> PROPS:</span><br><span class="line">        setProps(node, currentPatch.props)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> TEXT:</span><br><span class="line">        node.textContent = currentPatch.content</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Unknown patch type '</span> + currentPatch.type)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/livoras/simple-virtual-dom/blob/master/lib/patch.js#L8" target="_blank" rel="noopener">è¯¦ç»†patchè·³è½¬</a></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>virtual DOMç®—æ³•ä¸»è¦å®ç°ä¸Šé¢æ­¥éª¤çš„ä¸‰ä¸ªå‡½æ•°ï¼š <code>react.createElement</code>ã€<code>diff</code>ã€<code>patch</code>ï¼Œç„¶åå°±å¯ä»¥å®é™…çš„è¿›è¡Œä½¿ç”¨äº†ã€‚ </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. æ„å»ºè™šæ‹ŸDOM</span></span><br><span class="line"><span class="keyword">let</span> tree = React.createElement(<span class="string">"div"</span>, &#123;</span><br><span class="line">  id: <span class="string">"box"</span>,</span><br><span class="line">  className: <span class="string">"box"</span>,</span><br><span class="line">  style: &#123;</span><br><span class="line">    color: <span class="string">"#ccc"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, </span><br><span class="line">React.createElement(<span class="string">"h2"</span>, &#123;</span><br><span class="line">   className: <span class="string">"title"</span></span><br><span class="line"> &#125;, <span class="string">"hhhh222"</span>),</span><br><span class="line"><span class="string">"divdivdiv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. é€šè¿‡è™šæ‹ŸDOMæ„å»ºçœŸæ­£çš„DOM</span></span><br><span class="line"><span class="keyword">var</span> root = tree.render()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ç”Ÿæˆæ–°çš„è™šæ‹ŸDOM</span></span><br><span class="line"><span class="keyword">var</span> newTree = React.createElement(<span class="string">"div"</span>, &#123;</span><br><span class="line">  id: <span class="string">"box"</span>,</span><br><span class="line">  className: <span class="string">"box"</span>,</span><br><span class="line">  style: &#123;</span><br><span class="line">    color: <span class="string">"#ccc"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, </span><br><span class="line">React.createElement(<span class="string">"h2"</span>, &#123;</span><br><span class="line">   className: <span class="string">"title"</span></span><br><span class="line"> &#125;, <span class="string">"--hhhh222"</span>),</span><br><span class="line"><span class="string">"--divdivdiv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. æ¯”è¾ƒä¸¤æ£µè™šæ‹ŸDOMæ ‘çš„ä¸åŒ</span></span><br><span class="line"><span class="keyword">var</span> patches = diff(tree, newTree)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. åœ¨çœŸæ­£çš„DOMå…ƒç´ ä¸Šåº”ç”¨å˜æ›´</span></span><br><span class="line">patch(root, patches)</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™æ˜¯éå¸¸ç²—ç³™çš„å®è·µï¼Œå®é™…ä¸­è¿˜éœ€è¦å¤„ç†äº‹ä»¶ç›‘å¬ç­‰ï¼›ç”Ÿæˆè™šæ‹Ÿ DOM çš„æ—¶å€™ä¹Ÿå¯ä»¥åŠ å…¥ JSX è¯­æ³•ã€‚è¿™äº›äº‹æƒ…éƒ½åšäº†çš„è¯ï¼Œå°±å¯ä»¥æ„é€ ä¸€ä¸ªç®€å•çš„ReactJSäº†ã€‚</p><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://juejin.im/post/5cb66fdaf265da0384128445" target="_blank" rel="noopener">https://juejin.im/post/5cb66fdaf265da0384128445</a><br/><br><a href="https://blog.csdn.net/qq_36407875/article/details/84965311" target="_blank" rel="noopener">https://blog.csdn.net/qq_36407875/article/details/84965311</a><br/><br><a href="https://www.cnblogs.com/zhuzhenwei918/p/7271305.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhuzhenwei918/p/7271305.html</a><br/><br><a href="http://react-china.org/t/react-react/26788" target="_blank" rel="noopener">http://react-china.org/t/react-react/26788</a><br/><br><a href="https://github.com/MuYunyun/blog/blob/master/React/%E4%BB%8E0%E5%88%B01%E5%AE%9E%E7%8E%B0React/4.diff%E7%AE%97%E6%B3%95.md" target="_blank" rel="noopener">https://github.com/MuYunyun/blog/blob/master/React/%E4%BB%8E0%E5%88%B01%E5%AE%9E%E7%8E%B0React/4.diff%E7%AE%97%E6%B3%95.md</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
          <category> VirtualDOM </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>reactäº‹ä»¶å§”æ‰˜æœºåˆ¶</title>
      <link href="/2019/11/17/workspace/Frame/react/event/"/>
      <url>/2019/11/17/workspace/Frame/react/event/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>reactäº‹ä»¶å§”æ‰˜æœºåˆ¶</strong></p><p>[[toc]]</p><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨äº‹ä»¶å§”æ‰˜"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨äº‹ä»¶å§”æ‰˜" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨äº‹ä»¶å§”æ‰˜"></a>ä¸ºä»€ä¹ˆè¦ç”¨äº‹ä»¶å§”æ‰˜</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œdoméœ€è¦æœ‰äº‹ä»¶å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬éƒ½ä¼šç›´æ¥ç»™å®ƒè®¾äº‹ä»¶å¤„ç†ç¨‹åºå°±å¥½äº†ï¼Œé‚£å¦‚æœæ˜¯å¾ˆå¤šçš„doméœ€è¦æ·»åŠ äº‹ä»¶å¤„ç†å‘¢ï¼Ÿæ¯”å¦‚æˆ‘ä»¬æœ‰100ä¸ªliï¼Œæ¯ä¸ªliéƒ½æœ‰ç›¸åŒçš„clickç‚¹å‡»äº‹ä»¶ï¼Œå¯èƒ½æˆ‘ä»¬ä¼šç”¨forå¾ªç¯çš„æ–¹æ³•ï¼Œæ¥éå†ï¼Œè¿™æ ·çš„è¯æ¯ä¸ªå‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯å¯¹è±¡å°±ä¼šå ç”¨å†…å­˜ï¼Œå¯¹è±¡è¶Šå¤šï¼Œå†…å­˜å ç”¨ç‡å°±è¶Šå¤§ï¼Œå¦‚æœæ•°é‡æ›´å¤§çš„è¯å°±ggäº†ã€‚</p><h3 id="äº‹ä»¶å§”æ‰˜çš„ä½œç”¨"><a href="#äº‹ä»¶å§”æ‰˜çš„ä½œç”¨" class="headerlink" title="äº‹ä»¶å§”æ‰˜çš„ä½œç”¨"></a>äº‹ä»¶å§”æ‰˜çš„ä½œç”¨</h3><ul><li>æ”¯æŒä¸ºåŒä¸€ä¸ªDOMå…ƒç´ æ³¨å†Œå¤šä¸ªåŒç±»å‹äº‹ä»¶</li><li>å¯å°†äº‹ä»¶åˆ†æˆäº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡æœºåˆ¶</li></ul><h3 id="dom-ç»‘å®šäº‹ä»¶"><a href="#dom-ç»‘å®šäº‹ä»¶" class="headerlink" title="dom ç»‘å®šäº‹ä»¶"></a>dom ç»‘å®šäº‹ä»¶</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>onclick</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">div1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ‰“å°ç¬¬ä¸€æ¬¡'</span>)</span><br><span class="line">&#125;</span><br><span class="line">div1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ‰“å°ç¬¬äºŒæ¬¡'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç»“æœæ˜¯ç¬¬äºŒä¸ªç‚¹å‡»æ³¨å†Œäº‹ä»¶è¦†ç›–äº†ç¬¬ä¸€ä¸ªç‚¹å‡»äº‹ä»¶,åªæ‰§è¡Œäº†console.log('æ‰“å°ç¬¬äºŒæ¬¡');</span></span><br></pre></td></tr></table></figure><p><strong>DOM 2 å®ç°</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">addEventListener(type,listener,useCapture)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">div1.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'æ‰“å°ç¬¬ä¸€æ¬¡'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">div1.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ‰“å°ç¬¬äºŒæ¬¡'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ³¨å†Œäº‹ä»¶éƒ½ä¼šæˆåŠŸè§¦å‘</span></span><br></pre></td></tr></table></figure><h3 id="äº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡æœºåˆ¶"><a href="#äº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡æœºåˆ¶" class="headerlink" title="äº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡æœºåˆ¶"></a>äº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡æœºåˆ¶</h3><p><strong>äº‹ä»¶æ•è·</strong><br/><br>å½“ä¸€ä¸ªäº‹ä»¶è§¦å‘å,ä»Windowå¯¹è±¡è§¦å‘,ä¸æ–­ç»è¿‡ä¸‹çº§èŠ‚ç‚¹,ç›´åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚åœ¨äº‹ä»¶åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹ä¹‹å‰çš„è¿‡ç¨‹å°±æ˜¯æ•è·é˜¶æ®µã€‚æ‰€æœ‰ç»è¿‡çš„èŠ‚ç‚¹,éƒ½ä¼šè§¦å‘å¯¹åº”çš„äº‹ä»¶</p><p><strong>äº‹ä»¶å†’æ³¡</strong><br/><br>å½“äº‹ä»¶åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹åï¼Œä¼šæ²¿ç€æ•è·é˜¶æ®µçš„è·¯çº¿åŸè·¯è¿”å›ã€‚åŒæ ·ï¼Œæ‰€æœ‰ç»è¿‡çš„èŠ‚ç‚¹,éƒ½ä¼šè§¦å‘å¯¹åº”çš„äº‹ä»¶</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H872695a92b914492ab8ba0d9783368cdg.jpg" alt=""></p><p>ä¸Šé¢çš„<code>addEventListener</code>çš„ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯è®¾ç½®æ˜¯æ•è·è¿˜æ˜¯å†’æ³¡é˜¶æ®µï¼Œé»˜è®¤æ˜¯falseæ˜¯<code>å†’æ³¡é˜¶æ®µ</code>ï¼Œå½“è®¾ä¸ºtrueçš„æ—¶å€™æ˜¯<code>äº‹ä»¶æ•è·</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">body.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ‰“å°body'</span>)</span><br><span class="line">&#125;,<span class="literal">true</span>)</span><br><span class="line">div1.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ‰“å°div1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// æ‰“å°body   æ‰“å°div1</span></span><br></pre></td></tr></table></figure><h3 id="addEventListener-å’Œ-onclickçš„åŒºåˆ«"><a href="#addEventListener-å’Œ-onclickçš„åŒºåˆ«" class="headerlink" title="addEventListener() å’Œ onclickçš„åŒºåˆ«"></a>addEventListener() å’Œ onclickçš„åŒºåˆ«</h3><ul><li>onclick ä¸èƒ½åŒæ—¶æ‰§è¡Œä¸¤ä¸ªå‡½æ•°ï¼ŒaddEventListener()å¯ä»¥æ‰§è¡Œä¸¤ä¸ªä¸åŒçš„å‡½æ•°</li><li>ç§»é™¤äº‹ä»¶ä¾¦å¬çš„æ–¹å¼ä¸åŒ (onclickç›´æ¥è¦†ç›–å°±è¡Œ ï¼ŒaddEventListenerç”¨removeEventListenerç§»é™¤)</li><li>addEventListenerå¯ä»¥åœ¨æ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µè§¦å‘ï¼Œè€Œonclickåªèƒ½å†’æ³¡é˜¶æ®µè§¦å‘</li><li>onclickæ”¯æŒIEä½ç‰ˆæœ¬ï¼ŒaddEventListenerä¸æ”¯æŒIE8ä¸€ä¸‹ï¼Œä½ç‰ˆæœ¬çš„IEä½¿ç”¨ attachEvent è¿›è¡Œäº‹ä»¶ä¾¦å¬ï¼›ä½¿ç”¨ detachEvent ç§»é™¤äº‹ä»¶ä¾¦å¬ã€‚</li></ul><h3 id="äº‹ä»¶å§”æ‰˜çš„ä¼˜ç‚¹"><a href="#äº‹ä»¶å§”æ‰˜çš„ä¼˜ç‚¹" class="headerlink" title="äº‹ä»¶å§”æ‰˜çš„ä¼˜ç‚¹"></a>äº‹ä»¶å§”æ‰˜çš„ä¼˜ç‚¹</h3><p><strong>æé«˜æ€§èƒ½</strong> æ¯ä¸€ä¸ªå‡½æ•°éƒ½ä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºä»£ç†æ‰€æœ‰äº‹ä»¶,æ‰€å ç”¨çš„å†…å­˜ç©ºé—´æ›´å°‘ã€‚<br><strong>åŠ¨æ€ç›‘å¬</strong> ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¯ä»¥è‡ªåŠ¨ç»‘å®šåŠ¨æ€æ·»åŠ çš„å…ƒç´ ,å³æ–°å¢çš„èŠ‚ç‚¹ä¸éœ€è¦ä¸»åŠ¨æ·»åŠ ä¹Ÿå¯ä»¥ä¸€æ ·å…·æœ‰å’Œå…¶ä»–å…ƒç´ ä¸€æ ·çš„äº‹ä»¶ã€‚</p><h3 id="reactçš„äº‹ä»¶å§”æ‰˜æœºåˆ¶"><a href="#reactçš„äº‹ä»¶å§”æ‰˜æœºåˆ¶" class="headerlink" title="reactçš„äº‹ä»¶å§”æ‰˜æœºåˆ¶"></a>reactçš„äº‹ä»¶å§”æ‰˜æœºåˆ¶</h3><p>reactäº‹ä»¶æœºåˆ¶åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š<strong>1ã€äº‹ä»¶æ³¨å†Œ 2ã€äº‹ä»¶åˆ†å‘</strong></p><p><strong>äº‹ä»¶æ³¨å†Œ</strong>éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½ä¼šæ³¨å†Œåˆ°documentä¸Šï¼Œæ‹¥æœ‰ç»Ÿä¸€çš„å›è°ƒå‡½æ•°dispatchEventæ¥æ‰§è¡Œäº‹ä»¶åˆ†å‘</p><p><strong>äº‹ä»¶åˆ†å‘</strong>éƒ¨åˆ†ï¼Œé¦–å…ˆç”Ÿæˆåˆæˆäº‹ä»¶ï¼Œæ³¨æ„åŒä¸€ç§äº‹ä»¶ç±»å‹åªèƒ½ç”Ÿæˆä¸€ä¸ªåˆæˆäº‹ä»¶<code>Event</code>ï¼Œå¦‚<code>onClick</code>è¿™ä¸ªç±»å‹çš„äº‹ä»¶ï¼Œdomä¸Šæ‰€æœ‰å¸¦æœ‰é€šè¿‡jsxç»‘å®šçš„<code>onClick</code>çš„å›è°ƒå‡½æ•°éƒ½ä¼šæŒ‰é¡ºåºï¼ˆå†’æ³¡æˆ–è€…æ•è·ï¼‰ä¼šæ”¾åˆ°<code>Event._dispatchListeners</code> è¿™ä¸ªæ•°ç»„é‡Œï¼Œåé¢ä¾æ¬¡æ‰§è¡Œå®ƒã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">   <span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'document click'</span>)</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="built_in">document</span>.getElementsByClassName(<span class="string">'App'</span>)[<span class="number">0</span>].addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'app click'</span>) </span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="built_in">document</span>.getElementsByTagName(<span class="string">'button'</span>)[<span class="number">0</span>].addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'button click'</span>)  </span><br><span class="line">     <span class="comment">// e.stopPropagation();</span></span><br><span class="line">   &#125;)</span><br><span class="line"> &#125; </span><br><span class="line"> onClick = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">   e.stopPropagation() <span class="comment">// èƒ½å¤Ÿé˜»æ­¢div.appçš„è§¦å‘</span></span><br><span class="line">   e.nativeEvent.stopImmediatePropagation(); <span class="comment">// nativeEventæ˜¯åŸç”Ÿçš„äº‹ä»¶ ï¼Œ èƒ½å¤Ÿé˜»æ­¢documentçš„è§¦å‘  </span></span><br><span class="line">   e.nativeEvent.stopPropagation(); <span class="comment">// ä»€ä¹ˆéƒ½é˜»æ­¢ä¸äº†,å› ä¸ºonClickåˆæˆäº‹ä»¶éƒ½ä¼šæ³¨å†Œåˆ°documentä¸Š</span></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'react button click'</span>);</span><br><span class="line"> &#125;;</span><br><span class="line"> render() &#123;</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     &lt;div className=<span class="string">"App"</span> onClick=&#123;() =&gt; &#123;<span class="built_in">console</span>.log(<span class="string">'react app click'</span>)&#125;&#125;&gt;</span><br><span class="line">       &lt;button onClick=&#123;<span class="keyword">this</span>.onClick&#125;&gt;æŒ‰é’®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">     &lt;/</span>div&gt;</span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// button click -&gt; app click -&gt; react button click</span></span><br></pre></td></tr></table></figure><p><strong>çœ‹ä¸‹å®ç°å°æ­¥éª¤</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> vdom = &#123;</span><br><span class="line">  type: <span class="string">'div'</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    onClick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//åˆæˆäº‹ä»¶</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'react app click'</span>)    </span><br><span class="line">    &#125;,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'button'</span>,</span><br><span class="line">        props: &#123;</span><br><span class="line">           onClick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">'react button click'</span>)    </span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨å†Œäº‹ä»¶</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">bankForRegistrationName = &#123; <span class="comment">// å›è°ƒäº‹ä»¶çš„ä¿å­˜</span></span><br><span class="line">    <span class="comment">// æ•°å­—æ˜¯_debugID,reactç”¨äºè¯†åˆ«æ¯ä¸€ä¸ªdom</span></span><br><span class="line">    <span class="number">5</span>: &#123;</span><br><span class="line">      click: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'react app click'</span>)    </span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">6</span>: &#123;</span><br><span class="line">      click: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'react button click'</span>)    </span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>äº‹ä»¶è§¦å‘</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆæˆäº‹ä»¶ç®€å•å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SyntheticEvent</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">this</span>.nativeEvent = e;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// e: eventï¼Œ type: äº‹ä»¶ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchEvent</span>(<span class="params">e, type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> synE = <span class="keyword">new</span> SyntheticEvent(e);</span><br><span class="line">  <span class="comment">// æ‰§è¡Œç›‘å¬äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">let</span> debugID = e.target.__reactInternalInstance$om8tco7dvl._debugID;</span><br><span class="line">  bankForRegistrationName[debugID][type](synE); </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// documentäº‹ä»¶å§”æ‰˜</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  dispatchEvent(e, <span class="string">'click'</span>); <span class="comment">// æ€»ä¹‹æœ€åæ˜¯é€šè¿‡ç‚¹å‡»documentåšäº‹ä»¶å§”æ‰˜è§¦å‘çš„</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h4><p><a href="https://www.jianshu.com/p/b249793fd2a7" target="_blank" rel="noopener">https://www.jianshu.com/p/b249793fd2a7</a><br/><br><a href="https://www.jianshu.com/p/c01756e520c7" target="_blank" rel="noopener">https://www.jianshu.com/p/c01756e520c7</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hooks</title>
      <link href="/2019/10/17/workspace/Frame/react/react-hooks/"/>
      <url>/2019/10/17/workspace/Frame/react/react-hooks/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Hooks</strong></p><p>[[toc]]</p><h3 id="Hookçš„è§„åˆ™"><a href="#Hookçš„è§„åˆ™" class="headerlink" title="Hookçš„è§„åˆ™"></a>Hookçš„è§„åˆ™</h3><ul><li>åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook<ul><li>ä¸è¦åœ¨<code>å¾ªç¯</code>ï¼Œ<code>æ¡ä»¶</code>æˆ–<code>åµŒå¥—å‡½æ•°</code>ä¸­è°ƒç”¨ Hookï¼Œ ç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„ React å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨ä»–ä»¬ã€‚éµå®ˆè¿™æ¡è§„åˆ™ï¼Œä½ å°±èƒ½ç¡®ä¿ Hook åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½æŒ‰ç…§åŒæ ·çš„ <strong><code>é¡ºåº</code></strong> è¢«è°ƒç”¨ã€‚è¿™è®© React èƒ½å¤Ÿåœ¨å¤šæ¬¡çš„ useState å’Œ useEffect è°ƒç”¨ä¹‹é—´ä¿æŒ hook çŠ¶æ€çš„æ­£ç¡®ã€‚</li></ul></li><li>åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hook     <ul><li>åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hook</li><li>åœ¨è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨å…¶ä»– Hook<ul><li><strong>åœ¨ç±»ä¸­ä½¿ç”¨æŠ¥é”™è­¦å‘Š</strong> ã€ŒHooks can only be called inside the body of a function componentã€</li></ul></li></ul></li></ul><h3 id="ä½¿ç”¨Hooksçš„å¥½å¤„"><a href="#ä½¿ç”¨Hooksçš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨Hooksçš„å¥½å¤„"></a>ä½¿ç”¨Hooksçš„å¥½å¤„</h3><p><strong>1.class å­¦ä¹ æˆæœ¬é«˜</strong><br/><br>ç”Ÿå‘½å‘¨æœŸï¼ŒthisæŒ‡å‘å•¥çš„ï¼Œhooksåªè¦ä¼šusestate   useeffectå·®ä¸å¤šèƒ½è§£å†³æ‰€æœ‰é—®é¢˜<br/><br><strong>2.classä¸šåŠ¡é€»è¾‘åˆ†æ•£</strong><br/><br>å®šæ—¶å™¨ï¼Œdom2äº‹ä»¶å•¥çš„ä¸€å®šè¦åœ¨componentWillUnMount å»å¸è½½ã€‚è€Œæ˜¯ç”¨hookså°±éå¸¸èšåˆäº†ï¼Œç›´æ¥è¿”å›å‡½æ•°é‡Œé¢æ¸…æ¥šå°±å¯ä»¥äº†<br/><br><strong>3.classé€»è¾‘å¤ç”¨å›°éš¾</strong><br/><br>hooksæœ€æœ‰ä¼˜åŠ¿çš„å°±æ•°å¥¹çš„é€»è¾‘å¤ç”¨èƒ½åŠ›äº†<br/><br>åœ¨classä¸­ä¸€èˆ¬ç”¨Render Propsï¼ˆå±€é™æ€§ï¼‰å’Œé«˜é˜¶ç»„ä»¶ï¼ˆåµŒå¥—å¤ªæ·±ï¼‰åšé€»è¾‘å¤ç”¨<br/><br>æ¯”å¦‚ä¸€ä¸ªåˆ—è¡¨æ¸²æŸ“ï¼Œclassæ¯æ¬¡éƒ½è¦å†™æ•°æ®è¯·æ±‚ï¼Œä¸‹æ‹‰åŠ è½½ï¼Œä¸Šæ‹‰åˆ·æ–°é‡ç½®åˆ†é¡µï¼Œloadingå±•ç¤ºï¼Œè€Œåœ¨hooksé‡Œç›´æ¥è‡ªå®šä¹‰ä¸€ä¸ªhookså°±å¯ä»¥åšåˆ°å…¨éƒ¨çš„åˆ—è¡¨åŠ è½½é€»è¾‘å…¬ç”¨<br/><br><strong>4.</strong> class æ‰“åŒ…æ—¶æ— æ³•å¯¹ class çš„å±æ€§æ–¹æ³•è¿›è¡Œä¼˜åŒ–ï¼Œè€Œä½¿ç”¨ hooks åˆ™å¯ä»¥å°†ä»£ç å‹ç¼©åˆ°æè‡´ã€‚<br/><br><strong>5.</strong> æœ€ç›´æ¥çš„å°±æ˜¯ä¸šåŠ¡å˜æ›´çš„æ—¶å€™ä¸éœ€è¦å†æŠŠå‡½æ•°å¼ç»„ä»¶å˜æˆclassäº†</p><p><strong>ç¼ºç‚¹</strong><br/><br>å½¢æˆå¤ªå¤šé—­åŒ…ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼<br/><br>functionå†™å¤ªå¤šä»£ç åæœŸä¸å¥½ç»´æŠ¤</p><p><strong>è‡ªå®šä¹‰è¿‡çš„</strong><br/><br>useFetch<br/><br>useMouse<br/><br>useScroll<br/><br>useSize<br/><br>useFrom<br/><br>useTable<br/><br>useStore<br/></p><p>çœŸæ­£è¯´æœæˆ‘ä½¿ç”¨ react hooks çš„ï¼Œæ˜¯ react blog é‡Œé¢æåˆ°çš„ï¼Œä½¿ç”¨ class component æ‰“åŒ…æ—¶æ— æ³•å¯¹ class çš„å±æ€§æ–¹æ³•è¿›è¡Œä¼˜åŒ–ï¼Œè€Œ<strong>ä½¿ç”¨ hooks åˆ™å¯ä»¥å°†ä»£ç å‹ç¼©åˆ°æè‡´</strong>ã€‚<br/><br>æœ‰äººä¼šè¯´ hooks æ˜¯è¶‹åŠ¿æ˜¯æœªæ¥å•¥çš„ï¼Œä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œhooks æ¯” class å¤æ‚å’Œéš¾ç†è§£å¤šäº†ï¼Œè€Œä¸”éšç€ä¸šåŠ¡é€»è¾‘çš„å¢é•¿ï¼Œä¸€ä¸ª function é‡Œé¢å°†ä¼šå†™å‡ºè¶Šæ¥è¶Šå¤šçš„ä»£ç ï¼Œ<br>è¶Šæ¥è¶Šå¤æ‚ï¼Œè®©ä½ æ— æ³•ç»´æŠ¤ã€‚è€Œå®é™…ä¸Šï¼Œåœ¨è¿è¡Œæ—¶ï¼Œä¸¤åˆ™çš„å·®åˆ«ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œéƒ½æ²¡æœ‰æ€§èƒ½ä¸Šçš„ä¼˜åŠ£ã€‚<br/></p><h3 id="Hooksçš„æ–¹æ³•"><a href="#Hooksçš„æ–¹æ³•" class="headerlink" title="Hooksçš„æ–¹æ³•"></a>Hooksçš„æ–¹æ³•</h3><table><thead><tr><th align="left"><span style='display: block;text-align: left;'> é’©å­å</span></th><th align="left"><span style='display: block;text-align: left;'> ä½œç”¨</span></th></tr></thead><tbody><tr><td align="left">useState</td><td align="left">åˆå§‹åŒ–å’Œè®¾ç½®çŠ¶æ€</td></tr><tr><td align="left">useEffect</td><td align="left">componentDidMountï¼ŒcomponentDidUpdateå’ŒcomponentWillUnmountå’Œç»“åˆä½“,æ‰€ä»¥å¯ä»¥ç›‘å¬useStateå®šä¹‰å€¼çš„å˜åŒ–</td></tr><tr><td align="left">useContext</td><td align="left">å®šä¹‰ä¸€ä¸ªå…¨å±€çš„å¯¹è±¡,ç±»ä¼¼ context</td></tr><tr><td align="left">useReducer</td><td align="left">å¯ä»¥å¢å¼ºå‡½æ•°æä¾›ç±»ä¼¼ Redux çš„åŠŸèƒ½</td></tr><tr><td align="left">useCallback</td><td align="left">è®°å¿†ä½œç”¨,å…±æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦åˆ›å»ºçš„å‡½æ•°ä½“ã€‚ç¬¬äºŒå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢çš„æ¯ä¸€é¡¹æ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°åˆ›å»ºå‡½æ•°ä½“çš„å˜é‡ï¼Œå¦‚æœä¼ å…¥çš„å˜é‡å€¼ä¿æŒä¸å˜ï¼Œè¿”å›è®°å¿†ç»“æœã€‚å¦‚æœä»»ä½•ä¸€é¡¹æ”¹å˜ï¼Œåˆ™è¿”å›æ–°çš„ç»“æœ</td></tr><tr><td align="left">useMemo</td><td align="left">ä½œç”¨å’Œä¼ å…¥å‚æ•°ä¸ useCallback ä¸€è‡´,useCallbackè¿”å›å‡½æ•°,useDemo è¿”å›å€¼</td></tr><tr><td align="left">useRef</td><td align="left">è·å– ref å±æ€§å¯¹åº”çš„ dom</td></tr><tr><td align="left">useImperativeMethods</td><td align="left">è‡ªå®šä¹‰ä½¿ç”¨refæ—¶å…¬å¼€ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼</td></tr><tr><td align="left">useLayoutEffect</td><td align="left">ä½œç”¨ä¸useEffectç›¸åŒï¼Œä½†åœ¨æ‰€æœ‰DOMæ”¹å˜ååŒæ­¥è§¦å‘</td></tr><tr><td align="left">useDebugValue</td><td align="left">useDebugValue å¯ç”¨äºåœ¨ React å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ hook çš„æ ‡ç­¾ã€‚</td></tr></tbody></table><h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ç›´æ¥ä¼ å…¥åˆå§‹å€¼</span><br><span class="line">const [state, setState] &#x3D; useState(initialState);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­è®¡ç®—å¹¶è¿”å›åˆå§‹çš„ stateï¼Œæ­¤å‡½æ•°åªåœ¨åˆå§‹æ¸²æŸ“æ—¶è¢«è°ƒç”¨</span><br><span class="line">const [state, setState] &#x3D; useState(() &#x3D;&gt; &#123;</span><br><span class="line">  const initialState &#x3D; ff(props);</span><br><span class="line">  return initialState;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å®˜æ–¹å»ºè®®æ¨èæŠŠ state åˆ‡åˆ†æˆå¤šä¸ª state å˜é‡ï¼Œæ¯ä¸ªå˜é‡åŒ…å«çš„ä¸åŒå€¼ä¼šåœ¨åŒæ—¶å‘ç”Ÿå˜åŒ–ã€‚</p><p><strong>å¥½å¤„æ˜¯</strong></p><ul><li>åæœŸæŠŠä¸€äº›ç›¸å…³çš„é€»è¾‘æŠ½å–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hook å˜å¾—å®¹æ˜“<br/></li><li>èµ‹å€¼çš„æ—¶å€™ç®€å•ï¼Œå¤šä¸ªéœ€è¦å…‹éš†ä¸‹ï¼ŒæŠŠä¸å˜çš„å­˜å‚¨ä¸‹æ¥</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setState(state+<span class="number">1</span>);  <span class="comment">//ç›´æ¥ä»åˆå§‹å€¼é‡Œé¢è·å–</span></span><br><span class="line">setState(<span class="function"><span class="params">prevState</span>=&gt;</span>prevState+<span class="number">1</span>) <span class="comment">//è¯¥å‡½æ•°å°†æ¥æ”¶å…ˆå‰çš„state,å¹¶è¿”å›ä¸€ä¸ªæ›´æ–°åçš„å€¼</span></span><br></pre></td></tr></table></figure><h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><p><code>componentDidMount</code>, <code>componentDidUpdate</code>, <code>componentWillUnmount</code>ï¼šuseEffect Hook å¯ä»¥è¡¨è¾¾æ‰€æœ‰è¿™äº›(åŒ…æ‹¬ ä¸é‚£ä¹ˆ å¸¸è§ çš„åœºæ™¯)çš„ç»„åˆã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œeffect å°†åœ¨æ¯è½®<code>æ¸²æŸ“ç»“æŸåæ‰§è¡Œ</code>ï¼Œä½†ä½ å¯ä»¥é€‰æ‹©è®©å®ƒ åœ¨åªæœ‰<code>æŸäº›å€¼æ”¹å˜</code>çš„æ—¶å€™ æ‰æ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] &#x3D; useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() &#x3D;&gt; &#123;</span><br><span class="line">    const timer &#x3D; setInterval(() &#x3D;&gt; &#123;</span><br><span class="line">      setCount(c &#x3D;&gt; c + 1); </span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () &#x3D;&gt; clearInterval(timer);</span><br><span class="line">  &#125;, []); </span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;&#x2F;h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œæ¸…é™¤å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½å‰æ‰§è¡Œã€‚å¦å¤–ï¼Œå¦‚æœç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼ˆé€šå¸¸å¦‚æ­¤ï¼‰ï¼Œåˆ™åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ª effect ä¹‹å‰ï¼Œ<code>ä¸Šä¸€ä¸ª effect å°±å·²è¢«æ¸…é™¤</code>ã€‚çœ‹ä¸‹ä¸ªæ —å­ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;Fragment, useState, useEffect, useRef&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const Example &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    const [count, setCount] &#x3D; useState(1);</span><br><span class="line">    useEffect(() &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&quot;11&quot;);</span><br><span class="line">        return () &#x3D;&gt; &#123;</span><br><span class="line">            console.log(&quot;22&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    return (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            &#123;console.log(&quot;æ¸²æŸ“&quot;)&#125;</span><br><span class="line">            &lt;h1&gt;&#123;count&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;() &#x3D;&gt; &#123;</span><br><span class="line">                setCount(count + 1)</span><br><span class="line">            &#125;&#125;&gt; +</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line">export default Example</span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H66bfd87154314ad49baee2dd855336acT.gif" alt=""></p><p>æ‰“å°çš„é¡ºåºä¸º <strong>æ¸²æŸ“-&gt;22-&gt;11</strong></p><p>è‹¥å¤šæ¬¡æ‰§è¡Œeffectï¼Œå…¶å†…éƒ¨ä¼šç”Ÿæˆæ–°çš„å‡½æ•°ï¼Œï¼ˆeffectè¿˜æ˜¯åŸå‡½æ•°ï¼Œæˆ–è€…è¯´æŒ‡å‘åŸåœ°å€ï¼‰è¿™æ ·çš„è¯å¦‚æœæˆ‘æ˜¯å®šä¹‰çš„äº‹ä»¶ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šæ‰§è¡Œï¼Œé‚£ä¹ˆå²‚ä¸æ˜¯åœ¨äº‹ä»¶è¿˜æ²¡æœ‰ç§»é™¤æ‰åˆå®šä¹‰äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥useEffectåŠ å…¥äº†è¿™ä¸ªåŠŸèƒ½ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;useState, useEffect&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const Example &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    const [width, setWidth] &#x3D; useState(window.innerWidth);</span><br><span class="line">    const [count, setCount] &#x3D; useState(1);</span><br><span class="line">    const resizeHandle &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">        setWidth(window.innerWidth);</span><br><span class="line">        console.log(window.innerWidth);</span><br><span class="line">    &#125;;</span><br><span class="line">    const a &#x3D; useEffect(() &#x3D;&gt; &#123;</span><br><span class="line">        window.addEventListener(&quot;resize&quot;, resizeHandle);</span><br><span class="line">        return () &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F; window.removeEventListener(&quot;resize&quot;, resizeHandle)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);  &#x2F;&#x2F;æˆ–è€…ä½¿ç”¨[]</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            &lt;h1&gt;&#123;width&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;() &#x3D;&gt; &#123;</span><br><span class="line">                setCount(count + 1)</span><br><span class="line">            &#125;&#125;&gt;+</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">export default Example</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹é¢å›¾ç‰‡å¯ä»¥çœ‹å‡ºæ¥ï¼Œé‡å¤å¤šæ¬¡æ‰§è¡Œäº†<code>resize</code>æ–¹æ³•</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H9d109cbe0722447baf4ef132fa24268fE.gif" alt=""></p><p><a href="http://file.jing999.cn/workspace/Frame/react/use-hooks.html#useeffect%E5%9C%A8%E5%A4%96%E9%9D%A2%E5%A3%B0%E6%98%8E%E5%87%BD%E6%95%B0'">å®˜æ–¹å»ºè®®effectä½¿ç”¨çš„æ–¹æ³•å£°æ˜åœ¨å…¶å†…éƒ¨</a></p><h3 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h3><p>React16ä¸­æ›´æ–°äº†Context APIï¼ŒContextä¸»è¦ç”¨äºçˆ·å­™ç»„ä»¶çš„ä¼ å€¼é—®é¢˜ï¼Œæ–°çš„Context APIä½¿ç”¨è®¢é˜…å‘å¸ƒè€…æ¨¡å¼æ–¹å¼å®ç°åœ¨çˆ·å­™ç»„ä»¶ä¸­ä¼ å€¼</p><p>React Hookså‡ºç°ä¹‹åä¹Ÿå¯¹Context APIå‡ºäº†å“åº”çš„Hook useContextã€‚åŒæ ·ä¹Ÿæ˜¯è§£ä¼ å€¼çš„é—®é¢˜</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const stateContext &#x3D; createContext(&#39;default&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;çˆ¶ç»„ä»¶</span><br><span class="line">&lt;stateContext.Provider</span><br><span class="line">    value&#x3D;&#123;&quot;Hello React&quot;&#125;</span><br><span class="line">&gt;</span><br><span class="line">    &lt;ContextComponent&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;stateContext.Provider&gt;</span><br><span class="line">&#x2F;&#x2F;å­ç»„ä»¶ </span><br><span class="line">const ContextComponent &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    const value &#x3D; useContext(stateContext);</span><br><span class="line">    return (</span><br><span class="line">        &lt;&gt;</span><br><span class="line">            &lt;h1&gt;&#123;value&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;&#x2F;&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨<code>useContextä»ç„¶éœ€è¦åœ¨ä¸Šå±‚ç»„ä»¶ä¸­ä½¿ç”¨&lt;MyContext.Provider&gt;</code>æ¥ä¸ºä¸‹å±‚ç»„ä»¶æä¾›contextã€‚</p><h3 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h3><p>çœ‹åˆ°<code>useReducer</code>,è‚¯å®šä¼šæƒ³åˆ°Reduxï¼Œæ²¡é”™å®ƒå’ŒReduxçš„å·¥ä½œæ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚useReducerçš„å‡ºç°æ˜¯useStateçš„æ›¿ä»£æ–¹æ¡ˆï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬æ›´å¥½çš„ç®¡ç†çŠ¶æ€ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialArg, init);</span><br></pre></td></tr></table></figure><p>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒuseReducer ä¼šæ¯” useState æ›´é€‚ç”¨ï¼Œä¾‹å¦‚ state <code>é€»è¾‘è¾ƒå¤æ‚ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ª state ä¾èµ–äºä¹‹å‰çš„ state</code>ç­‰ã€‚<br>å¹¶ä¸”ï¼Œä½¿ç”¨ useReducer è¿˜èƒ½ç»™é‚£äº›ä¼šè§¦å‘æ·±æ›´æ–°çš„ç»„ä»¶åšæ€§èƒ½ä¼˜åŒ–ï¼Œ<code>å› ä¸ºä½ å¯ä»¥å‘å­ç»„ä»¶ä¼ é€’ dispatch è€Œä¸æ˜¯å›è°ƒå‡½æ•°</code> ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const initialState &#x3D; &#123;count: 0&#125;;</span><br><span class="line"></span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case &#39;increment&#39;:</span><br><span class="line">      return &#123;count: state.count + 1&#125;;</span><br><span class="line">    case &#39;decrement&#39;:</span><br><span class="line">      return &#123;count: state.count - 1&#125;;</span><br><span class="line">    default:</span><br><span class="line">      throw new Error();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const [state, dispatch] &#x3D; useReducer(reducer, initialState);</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      Count: &#123;state.count&#125;</span><br><span class="line">      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;decrement&#39;&#125;)&#125;&gt;-&lt;&#x2F;button&gt;</span><br><span class="line">      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;increment&#39;&#125;)&#125;&gt;+&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;&#x2F;&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰ä¸ªå‚æ•°(æƒ°æ€§åˆå§‹åŒ–)</strong></p><p>useReducerçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶æŠŠç¬¬äºŒä¸ªå‚æ•°å½“ä½œå‡½æ•°çš„å‚æ•°æ‰§è¡Œã€‚ä¸»è¦ä½œç”¨æ˜¯åˆå§‹å€¼çš„æƒ°æ€§æ±‚å€¼ï¼ŒæŠŠä¸€äº›å¯¹çŠ¶æ€çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œæœ‰åˆ©äºé‡ç½®stateã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;Fragment, useState, useEffect, useRef, useCallback, useMemo, useReducer&#125; from &quot;react&quot;;</span><br><span class="line">const initialState &#x3D; &#123;count: 0&#125;;</span><br><span class="line">function init(s) &#123;</span><br><span class="line">    console.log(s);</span><br><span class="line">    return &#123;...s&#125;;</span><br><span class="line">&#125;</span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">    switch (action.type) &#123;</span><br><span class="line">        case &#39;increment&#39;:</span><br><span class="line">            return &#123;count: state.count + 1&#125;;</span><br><span class="line">        case &#39;decrement&#39;:</span><br><span class="line">            return &#123;count: state.count - 1&#125;;</span><br><span class="line">        case &#39;reset&#39;:</span><br><span class="line">            return init(action.payload);</span><br><span class="line">        default:</span><br><span class="line">            throw new Error();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">function Counter() &#123;</span><br><span class="line">    const [state, dispatch] &#x3D; useReducer(reducer, initialState, init);</span><br><span class="line">    return (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            Count: &#123;state.count&#125;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;decrement&#39;&#125;)&#125;&gt;-&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;increment&#39;&#125;)&#125;&gt;+&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;reset&#39;, payload: initialState&#125;)&#125;&gt;é‡ç½®&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">export default Counter</span><br></pre></td></tr></table></figure><h3 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h3><p>è¿”å›ä¸€ä¸ªmemoizedå›è°ƒ<code>å‡½æ•°</code>ã€‚</p><p><a href="http://file.jing999.cn/workspace/Frame/react/use-hooks.html#usecallback%E7%A4%BA%E4%BE%8B%E4%BD%95%E6%97%B6%E6%9B%B4%E6%96%B0">ä¸‹é¢ä»‹ç»çš„ä½¿ç”¨æ–¹å¼</a></p><h3 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h3><p>è¿”å›ä¸€ä¸ªmemoized<code>å€¼</code>ã€‚</p><p>useMemoå’ŒuseCallbackå¾ˆåƒï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯</p><p>useCallback(fn, deps) ç›¸å½“äº useMemo(() =&gt; fn, deps)ã€‚</p><p>å…¬ç”¨çš„<code>æ–¹æ³•</code>ç”¨<code>useCallback</code>,è‹¥æ˜¯ç›´æ¥<code>æ¸²æŸ“å€¼</code>åˆ™ç”¨<code>useMemo</code>ï¼Œç”¨<code>useCallback</code>çš„è¯ä¹Ÿæ˜¯æ¯æ¬¡éƒ½è¦æ‰§è¡Œçš„ï¼Œä½†æ˜¯<code>useMemo</code>æ˜¯ç›´æ¥æŠŠå€¼è®°å¿†å­˜å‚¨äº†ï¼ˆå‰é¢çš„éƒ½æ˜¯åºŸè¯ï¼Œå…¶å®éƒ½èƒ½å®ç°ï¼Œä¸è¿‡è¿™æ ·æ›´ç¬¦åˆä¹ æƒ¯ï¼‰</p><h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p>æœ¬è´¨ä¸Š<code>useRef</code>å°±åƒæ˜¯å¯ä»¥åœ¨å…¶<code>.current</code>å±æ€§ä¸­ä¿å­˜ä¸€ä¸ªå¯å˜å€¼çš„â€œç›’å­â€ï¼Œ<code>useRef(null)è¿”å›å€¼</code>æ˜¯ä¸å¯æ‹“å±•çš„å±æ€§,<code>.current</code>å¯ä»¥ã€‚</p><p>ä¸‹ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•ä½¿ç”¨è€ŒuseRefè‡ªå·±æœ€æ–°çš„å€¼ï¼Œæˆ–è€…å­˜å‚¨ä¸Šä¸€æ¬¡propsæˆ–è€…stateçš„å€¼ï¼›æˆ‘ä»¬ç›´æ¥å£°æ˜ä¸€ä¸ªå€¼å­˜å‚¨å½“å‰çš„å€¼ä¸å¥½å—ï¼Œä¸ºå•¥è¦å€ŸåŠ©useRef()</p><p><strong>è¿™æ˜¯å› ä¸ºå®ƒåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ™®é€šJavascriptå¯¹è±¡ã€‚è€ŒuseRef()å’Œè‡ªå»ºä¸€ä¸ª {current: â€¦}å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼ŒuseRefä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ªrefå¯¹è±¡ã€‚</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;Fragment, useState, useEffect, useRef, useCallback, useMemo, useReducer&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const Example &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    let inputRef &#x3D; useRef(null);</span><br><span class="line">    useEffect(() &#x3D;&gt; &#123;</span><br><span class="line">        inputRef.current.focus();</span><br><span class="line">    &#125;, []);</span><br><span class="line">    return (</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; ref&#x3D;&#123;inputRef&#125;&#x2F;&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Example</span><br></pre></td></tr></table></figure><h3 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">useImperativeHandle(ref, createHandle, [deps])</span><br></pre></td></tr></table></figure><p><code>useImperativeHandle</code>å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶<code>è‡ªå®šä¹‰</code>æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚<code>useImperativeHandle</code> åº”å½“ä¸ <code>forwardRef</code> ä¸€èµ·ä½¿ç”¨</p><p>å°±æ˜¯è¯´ï¼šå½“æˆ‘ä»¬ä½¿ç”¨çˆ¶ç»„ä»¶æŠŠrefä¼ é€’ç»™å­ç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªHookså…è®¸åœ¨å­ç»„ä»¶ä¸­æŠŠè‡ªå®šä¹‰å®ä¾‹é™„åŠ åˆ°çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„refä¸Šï¼Œæœ‰åˆ©äºçˆ¶ç»„ä»¶æ§åˆ¶å­ç»„ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;</span><br><span class="line">    Fragment,</span><br><span class="line">    useRef,</span><br><span class="line">    useImperativeHandle,</span><br><span class="line">    forwardRef,</span><br><span class="line">    useEffect</span><br><span class="line">&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">function FancyInput(props, ref) &#123;</span><br><span class="line">    const inputRef &#x3D; useRef();</span><br><span class="line">    useImperativeHandle(ref, () &#x3D;&gt; (</span><br><span class="line">        &#123;</span><br><span class="line">            addText: () &#x3D;&gt; &#123;</span><br><span class="line">                inputRef.current.value &#x3D; &quot;æˆ‘æ˜¯ç”±çˆ¶çº§æ·»åŠ çš„&quot;;</span><br><span class="line">            &#125;,</span><br><span class="line">            focus: () &#x3D;&gt; &#123;</span><br><span class="line">                inputRef.current.focus();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ));</span><br><span class="line">    return &lt;input ref&#x3D;&#123;inputRef&#125;&#x2F;&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const TempFancyInput &#x3D; forwardRef(FancyInput);</span><br><span class="line"></span><br><span class="line">const Example &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    let ref &#x3D; useRef(null);</span><br><span class="line">    useEffect(() &#x3D;&gt; &#123;</span><br><span class="line">        console.log(ref);</span><br><span class="line">        ref.current.addText();</span><br><span class="line">        ref.current.focus();</span><br><span class="line">    &#125;);</span><br><span class="line">    return (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            &lt;TempFancyInput ref&#x3D;&#123;ref&#125;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;Fragment&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br><span class="line">export default Example</span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H3eab0df2695d4654a1f9e9a9b1f20edem.png" alt=""></p><h3 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a>useLayoutEffect</h3><p>è¿™ä¸ªé’©å­å‡½æ•°ä¸useEffectç›¸åŒï¼Œä½†å®ƒä¼šåœ¨æ‰€æœ‰çš„DOMå˜æ›´ä¹‹å<code>åŒæ­¥</code>è°ƒç”¨effectã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–DOMå¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼ŒuseLayoutEffect å†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°ã€‚</p><p>å®˜ç½‘å»ºè®®è¿˜æ˜¯å°½å¯èƒ½çš„æ˜¯ä½¿ç”¨æ ‡å‡†çš„useEffecä»¥é¿å…é˜»å¡è§†è§‰æ›´æ–°ã€‚</p><h3 id="useDebugValue"><a href="#useDebugValue" class="headerlink" title="useDebugValue"></a>useDebugValue</h3><p>useDebugValue å¯ç”¨äºåœ¨ React å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ hook çš„æ ‡ç­¾ã€‚</p><h3 id="è‡ªå®šä¹‰-Hook-å¿…é¡»ä»¥-use-å¼€å¤´å—ï¼Ÿ"><a href="#è‡ªå®šä¹‰-Hook-å¿…é¡»ä»¥-use-å¼€å¤´å—ï¼Ÿ" class="headerlink" title="è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ use å¼€å¤´å—ï¼Ÿ"></a>è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ use å¼€å¤´å—ï¼Ÿ</h3><p>å¿…é¡»å¦‚æ­¤ã€‚è¿™ä¸ªçº¦å®šéå¸¸é‡è¦ã€‚ä¸éµå¾ªçš„è¯ï¼Œç”±äºæ— æ³•åˆ¤æ–­æŸä¸ªå‡½æ•°æ˜¯å¦åŒ…å«å¯¹å…¶å†…éƒ¨ Hook çš„è°ƒç”¨ï¼ŒReact å°†æ— æ³•è‡ªåŠ¨æ£€æŸ¥ä½ çš„ Hook æ˜¯å¦è¿åäº† Hook çš„<a href="https://react.docschina.org/docs/hooks-rules.html" target="_blank" rel="noopener">è§„åˆ™</a>ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> useWinResize = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> [size, setSize] = useState(&#123;</span><br><span class="line">     width: <span class="built_in">document</span>.documentElement.clientWidth,</span><br><span class="line">     height: <span class="built_in">document</span>.documentElement.clientHeight</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="keyword">const</span> resize = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">     setSize(&#123;</span><br><span class="line">     width: <span class="built_in">document</span>.documentElement.clientWidth,</span><br><span class="line">     height: <span class="built_in">document</span>.documentElement.clientHeight</span><br><span class="line"> &#125;)</span><br><span class="line"> &#125;, [])</span><br><span class="line"> useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, resize);</span><br><span class="line">     <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">'resize'</span>, resize);</span><br><span class="line"> &#125;, []);</span><br><span class="line"> <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> &#123;width, height&#125; = useWinResize();</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">         <span class="tag">&lt;<span class="name">p</span>&gt;</span>width: &#123;width&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">         <span class="tag">&lt;<span class="name">p</span>&gt;</span>height: &#123;height&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="é¢è¯•é¢˜ç¤ºä¾‹"><a href="#é¢è¯•é¢˜ç¤ºä¾‹" class="headerlink" title="é¢è¯•é¢˜ç¤ºä¾‹"></a>é¢è¯•é¢˜ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Fragment, useState, useEffect, useRef, useCallback&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> useInterval = <span class="function">(<span class="params">callback, delay</span>) =&gt;</span> &#123;</span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (delay !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> id = setInterval(callback, delay);</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> clearInterval(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [delay]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> [diff, setDiff] = useState(<span class="number">500</span>);</span><br><span class="line">    useInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setCount(count + <span class="number">1</span>);</span><br><span class="line">    &#125;, diff);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            &lt;p&gt; count: &#123;count&#125; &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;p&gt; diff: &#123;diff&#125;ms &lt;/</span>p&gt;</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">                &lt;button onClick=&#123;() =&gt; setDiff(diff - <span class="number">50</span>)&#125;&gt; åŠ å¿«<span class="number">50</span>ms&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;() =&gt; setDiff(diff + 50)&#125;&gt; å‡æ…¢50ms&lt;/</span>button&gt;</span><br><span class="line">            &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure><p>å¯æ˜¯è¿™æ®µè¿è¡Œåå¾ˆå¥‡æ€ªï¼Œé¡µé¢ä»0åˆ°1åï¼Œå°±å†ä¹Ÿä¸å˜äº†ï¼Œconsole.log(count)çš„è¾“å‡ºè¡¨æ˜ä»£ç å¹¶æ²¡æœ‰å¡æ­»ï¼Œé‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªå„¿äº†ï¼Ÿ<br/><br>Reactç»„ä»¶ä¸­çš„propså’Œstateæ˜¯å¯ä»¥æ”¹å˜çš„ï¼ŒReactä¼šé‡æ¸²æŸ“å®ƒä»¬ä¸”ã€Œä¸¢å¼ƒã€ä»»ä½•å…³äºä¸Šä¸€æ¬¡æ¸²æŸ“çš„ç»“æœï¼Œå®ƒä»¬ä¹‹é—´ä¸å†æœ‰ç›¸å…³æ€§ã€‚<br/><br>useEffect()Hookä¹Ÿã€Œä¸¢å¼ƒã€ä¸Šä¸€æ¬¡æ¸²æŸ“ç»“æœï¼Œå®ƒä¼šæ¸…é™¤ä¸Šä¸€æ¬¡effectå†å»ºç«‹ä¸‹ä¸€ä¸ªeffectï¼Œä¸‹ä¸€ä¸ªeffect<code>é”ä½æ–°çš„propså’Œstate</code>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡å°è¯•ç®€å•ç¤ºä¾‹å¯ä»¥æ­£ç¡®å·¥ä½œçš„åŸå› ã€‚<br/><br>ä½†setIntervalä¸ä¼šã€Œä¸¢å¼ƒã€ã€‚å®ƒä¼šä¸€ç›´å¼•ç”¨è€çš„propså’Œstateç›´åˆ°ä½ æŠŠå®ƒæ¢æ‰â€”â€”ä¸é‡ç½®æ—¶é—´ä½ æ˜¯æ— æ³•åšåˆ°çš„ã€‚è¿™é‡Œå°±è¦ç”¨åˆ°useRefè¿™ä¸ªhookäº†ï¼Œæˆ‘ä»¬æŠŠcallbackå­˜å‚¨åˆ°refä¸­ï¼Œå½“callbackæ›´æ–°æ—¶å»æ›´æ–°ref.currentçš„å€¼ï¼š</p><p>ä¸¤ç§æ–¹æ³•:ã€ä¸€ç§æ˜¯æŠŠcountå­˜èµ·æ¥ï¼Œä¸€ç§æ˜¯æŠŠå®šæ—¶å™¨é‡Œé¢çš„å‡½æ•°å­˜èµ·æ¥ã€‘</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Fragment, useState, useEffect, useRef, useCallback&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> useInterval = <span class="function">(<span class="params">callback, delay, val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> saveCallback = useRef();</span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        saveCallback.current = val</span><br><span class="line">    &#125;,[val]);</span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (delay !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> id = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> callback(saveCallback.current), delay);</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> clearInterval(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [delay]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> [diff, setDiff] = useState(<span class="number">500</span>);</span><br><span class="line">    useInterval(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">        setCount(val + <span class="number">1</span>);</span><br><span class="line">    &#125;, diff, count);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            &lt;p&gt; count: &#123;count&#125; &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;p&gt; diff: &#123;diff&#125;ms &lt;/</span>p&gt;</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">                &lt;button onClick=&#123;() =&gt; setDiff(diff - <span class="number">50</span>)&#125;&gt; åŠ å¿«<span class="number">50</span>ms&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;() =&gt; setDiff(diff + 50)&#125;&gt; å‡æ…¢50ms&lt;/</span>button&gt;</span><br><span class="line">            &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// const useInterval = (callback, delay) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     const saveCallback = useRef();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//         // æ¯æ¬¡æ¸²æŸ“åï¼Œä¿å­˜æ–°çš„å›è°ƒåˆ°æˆ‘ä»¬çš„ ref é‡Œ</span></span><br><span class="line"><span class="comment">//         saveCallback.current = callback;</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//         function tick() &#123;</span></span><br><span class="line"><span class="comment">//             saveCallback.current();  //æ¯æ¬¡æ‰§è¡Œæœ€æ–°çš„callback</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//         if (delay !== null) &#123;</span></span><br><span class="line"><span class="comment">//             let id = setInterval(tick, delay);</span></span><br><span class="line"><span class="comment">//             return () =&gt; clearInterval(id);</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;, [delay]);</span></span><br><span class="line"><span class="comment">// &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure><h3 id="Hooks-FAQ"><a href="#Hooks-FAQ" class="headerlink" title="Hooks FAQ"></a><code>Hooks FAQ</code></h3><h4 id="useEffectåœ¨å¤–é¢å£°æ˜å‡½æ•°"><a href="#useEffectåœ¨å¤–é¢å£°æ˜å‡½æ•°" class="headerlink" title="useEffectåœ¨å¤–é¢å£°æ˜å‡½æ•°"></a>useEffectåœ¨å¤–é¢å£°æ˜å‡½æ•°</h4><p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œä¸å®‰å…¨</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params">&#123; someProp &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(someProp);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    doSomething();</span><br><span class="line">  &#125;, []); <span class="comment">// ğŸ”´ è¿™æ ·ä¸å®‰å…¨ï¼ˆå®ƒè°ƒç”¨çš„ `doSomething` å‡½æ•°ä½¿ç”¨äº† `someProp`ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è®°ä½ effect å¤–éƒ¨çš„å‡½æ•°ä½¿ç”¨äº†å“ªäº› props å’Œ state å¾ˆéš¾ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ é€šå¸¸ä½ ä¼šæƒ³è¦åœ¨ effect å†…éƒ¨ å»å£°æ˜å®ƒæ‰€éœ€è¦çš„å‡½æ•°ã€‚ è¿™æ ·å°±èƒ½å®¹æ˜“çš„çœ‹å‡ºé‚£ä¸ª effect ä¾èµ–äº†ç»„ä»¶ä½œç”¨åŸŸä¸­çš„å“ªäº›å€¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params">&#123; someProp &#125;</span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(someProp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    doSomething();</span><br><span class="line">  &#125;, [someProp]); <span class="comment">// âœ… å®‰å…¨ï¼ˆæˆ‘ä»¬çš„ effect ä»…ç”¨åˆ°äº† `someProp`ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœå¤„äºæŸäº›åŸå› ä½ æ— æ³•æŠŠä¸€ä¸ªå‡½æ•°ç§»åŠ¨åˆ°effectå†…éƒ¨ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–åŠæ³•ï¼š</strong></p><ul><li><p>ä½ å¯ä»¥å°è¯•æŠŠé‚£ä¸ªå‡½æ•°ç§»åŠ¨åˆ°ä½ çš„ç»„ä»¶ä¹‹å¤–ã€‚é‚£æ ·ä¸€æ¥ï¼Œè¿™ä¸ªå‡½æ•°å°±è‚¯å®šä¸ä¼šä¾èµ–ä»»ä½• props,æˆ–stateå¹¶ä¸”ä¹Ÿä¸ç”¨å‡ºç°åœ¨ä¾èµ–åˆ—è¡¨ä¸­äº†ã€‚</p></li><li><p>å¦‚æœä½ æ‰€è°ƒç”¨çš„æ–¹æ³•æ˜¯ä¸€ä¸ªçº¯è®¡ç®—ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¸²æŸ“æ—¶è°ƒç”¨ï¼Œä½ å¯ä»¥ è½¬è€Œåœ¨ effect ä¹‹å¤–è°ƒç”¨å®ƒï¼Œ å¹¶è®© effect ä¾èµ–äºå®ƒçš„è¿”å›å€¼ã€‚</p></li><li><p>ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥æŠŠå‡½æ•°åŠ å…¥effectçš„ä¾èµ–ä½† æŠŠå®ƒçš„å®šä¹‰åŒ…è£¹ è¿›<code>useCallback Hook</code>ã€‚è¿™å°±ç¡®ä¿äº†å®ƒä¸éšæ¸²æŸ“è€Œæ”¹å˜ï¼Œé™¤é å®ƒè‡ªèº« çš„ä¾èµ–å‘ç”Ÿäº†æ”¹å˜</p></li></ul><h4 id="å¦‚ä½•è·å–ä¸Šä¸€è½®çš„-props-æˆ–-state"><a href="#å¦‚ä½•è·å–ä¸Šä¸€è½®çš„-props-æˆ–-state" class="headerlink" title="å¦‚ä½•è·å–ä¸Šä¸€è½®çš„ props æˆ– state"></a>å¦‚ä½•è·å–ä¸Šä¸€è½®çš„ props æˆ– state</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Fragment, useState, useEffect, useRef&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usePrevious</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ref = useRef();</span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        ref.current = value;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> ref.current;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> prevCount = usePrevious(count);</span><br><span class="line">    <span class="comment">//æ­¤æ—¶prevCountæ˜¯ä¸Šä¸€æ¬¡çš„effectçš„è°ƒç”¨ï¼Œå†…éƒ¨å·²ç»æ”¹å˜,åªæ˜¯æ²¡æœ‰é‡æ–°æ¸²æŸ“</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)  <span class="comment">//å…ˆæ¸²æŸ“åæ‰§è¡Œè¿™ä¸ªeffect</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Now: &#123;count&#125;, before: &#123;prevCount&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">        &lt;div onClick=&#123;() =&gt; setCount((val) =&gt; val + 1)&#125;&gt;</span><br><span class="line">            ç‚¹å‡»åŠ ä¸€</span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example</span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hd6588fe44428462c90a0d7ee879c5948a.gif" alt=""></p><p>è€ƒè™‘åˆ°è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Œå¾ˆå¯èƒ½åœ¨æœªæ¥ React ä¼šè‡ªå¸¦ä¸€ä¸ª usePrevious Hookã€‚</p><h4 id="ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹ååœ¨åˆ«çš„å‡½æ•°ä¸­è·å–çš„è¿˜æ˜¯ä¸Šä¸€æ¬¡çš„å€¼"><a href="#ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹ååœ¨åˆ«çš„å‡½æ•°ä¸­è·å–çš„è¿˜æ˜¯ä¸Šä¸€æ¬¡çš„å€¼" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹ååœ¨åˆ«çš„å‡½æ•°ä¸­è·å–çš„è¿˜æ˜¯ä¸Šä¸€æ¬¡çš„å€¼"></a>ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹ååœ¨åˆ«çš„å‡½æ•°ä¸­è·å–çš„è¿˜æ˜¯ä¸Šä¸€æ¬¡çš„å€¼</h4><p>ç»„ä»¶å†…éƒ¨çš„ä»»ä½•å‡½æ•°ï¼ŒåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°å’Œ effectï¼Œéƒ½æ˜¯ä»å®ƒ<code>è¢«åˆ›å»º</code>çš„é‚£æ¬¡æ¸²æŸ“ä¸­æ‹¿åˆ°çš„</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;useState, useRef&#125; from &quot;react&quot;;</span><br><span class="line">function Example() &#123;</span><br><span class="line">    const [count, setCount] &#x3D; useState(0);</span><br><span class="line">    function handleClick() &#123;</span><br><span class="line">        console.log(count,&#39;å‡½æ•°å†…éƒ¨&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">    const add &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">        let val &#x3D; count + 1;</span><br><span class="line">        setCount(val);</span><br><span class="line">        handleClick()</span><br><span class="line">    &#125;;</span><br><span class="line">     console.log(count,&#39;å‡½æ•°å¤–é¢&#39;);</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;p&gt;You clicked &#123;count&#125; times&lt;&#x2F;p&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;add&#125;&gt;</span><br><span class="line">                ç‚¹å‡»æˆ‘</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;handleClick&#125;&gt;</span><br><span class="line">                è·å–å€¼</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">export default Example;</span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H70f6508f638a4c35bb9d095a2a5fde9cE.gif" alt=""></p><p>ä½ å‘ç°<code>handleClick</code>æ¯æ¬¡è·å–çš„éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„å€¼ï¼Œ<strong>å› ä¸ºå®ƒè·å–çš„æ˜¯åˆ›å»ºå®ƒçš„é‚£æ¬¡å€¼</strong>ï¼Œæ­¤æ—¶å¯ä»¥ç”¨<code>useRef</code>æ›²çº¿æ•‘å›½</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;useState, useRef&#125; from &quot;react&quot;;</span><br><span class="line">function Example() &#123;</span><br><span class="line">    const [count, setCount] &#x3D; useState(0);</span><br><span class="line">    const ref &#x3D; useRef();</span><br><span class="line">    function handleClick() &#123;</span><br><span class="line">        console.log(count, ref.current);</span><br><span class="line">    &#125;</span><br><span class="line">    const add &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">        let val &#x3D; count + 1;</span><br><span class="line">        setCount(val);</span><br><span class="line">        ref.current &#x3D; val;</span><br><span class="line">        handleClick()</span><br><span class="line">    &#125;;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;p&gt;You clicked &#123;count&#125; times&lt;&#x2F;p&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;add&#125;&gt;</span><br><span class="line">                ç‚¹å‡»æˆ‘</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;handleClick&#125;&gt;</span><br><span class="line">                è·å–å€¼</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">export default Example;</span><br></pre></td></tr></table></figure><h4 id="è·å–DOM-èŠ‚ç‚¹"><a href="#è·å–DOM-èŠ‚ç‚¹" class="headerlink" title="è·å–DOM èŠ‚ç‚¹"></a>è·å–DOM èŠ‚ç‚¹</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;Fragment,useState, useRef, useCallback&#125; from &quot;react&quot;;</span><br><span class="line">function Example() &#123;</span><br><span class="line">    const [width, setWidth] &#x3D; useState(0);</span><br><span class="line">    &#x2F;&#x2F; const inputEl &#x3D; useRef(null)</span><br><span class="line">    &#x2F;&#x2F; useEffect(() &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F;      setWidth(inputEl.current.getBoundingClientRect().width);</span><br><span class="line">    &#x2F;&#x2F; &#125;);</span><br><span class="line">          </span><br><span class="line">    let ref &#x3D; useCallback(node &#x3D;&gt; &#123;</span><br><span class="line">        if (node !&#x3D;&#x3D; null) &#123;</span><br><span class="line">            setWidth(node.getBoundingClientRect().width);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, []);</span><br><span class="line">    return (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            &lt;h1 ref&#x3D;&#123;ref&#125;&gt;Hello, world&lt;&#x2F;h1&gt;</span><br><span class="line">            &lt;h2&gt;å½“å‰å±å¹•å®½åº¦ä¸º &#123;Math.round(width)&#125;px&lt;&#x2F;h2&gt;</span><br><span class="line">        &lt;&#x2F;Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">export default Example</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰é€‰æ‹©ä½¿ç”¨<code>useRef</code>ï¼Œç”¨çš„refçš„å›è°ƒå‡½æ•°ï¼Œå› ä¸ºå½“refæ˜¯ä¸€ä¸ªå¯¹è±¡æ—¶å®ƒå¹¶ä¸ä¼šæŠŠå½“å‰refçš„å€¼çš„å˜åŒ–é€šçŸ¥åˆ°æˆ‘ä»¬ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦å€ŸåŠ©effectæ¥å®ç°ã€Œä»£ç å¦‚ä¸Šã€</p><p><strong>æŠ½ç¦»å‡ºæ¥</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;useState, useRef, useCallback&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const useClientRect &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    const [width, setWidth] &#x3D; useState(0);</span><br><span class="line">    let ref &#x3D; useCallback(node &#x3D;&gt; &#123;</span><br><span class="line">        if (node !&#x3D;&#x3D; null) &#123;</span><br><span class="line">            setWidth(node.getBoundingClientRect().width);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, []);</span><br><span class="line">    return [width, ref]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">    const [width, ref] &#x3D; useClientRect(0);</span><br><span class="line">    return (</span><br><span class="line">        &lt;&gt;</span><br><span class="line">            &lt;h1 ref&#x3D;&#123;ref&#125;&gt;Hello, world&lt;&#x2F;h1&gt;</span><br><span class="line">            &lt;h2&gt;å½“å‰å±å¹•å®½åº¦ä¸º &#123;Math.round(width)&#125;px&lt;&#x2F;h2&gt;</span><br><span class="line">        &lt;&#x2F;&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Example</span><br></pre></td></tr></table></figure><h4 id="useCallbackç¤ºä¾‹ä½•æ—¶æ›´æ–°"><a href="#useCallbackç¤ºä¾‹ä½•æ—¶æ›´æ–°" class="headerlink" title="useCallbackç¤ºä¾‹ä½•æ—¶æ›´æ–°"></a>useCallbackç¤ºä¾‹ä½•æ—¶æ›´æ–°</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;Fragment, useState, useEffect, useRef, useCallback&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const set1 &#x3D; new Set();</span><br><span class="line"></span><br><span class="line">let c &#x3D; 21;&#x2F;&#x2F;ã€2ã€‘</span><br><span class="line"></span><br><span class="line">let obj &#x3D; &#123;</span><br><span class="line">    name: &quot;hzf&quot;</span><br><span class="line">&#125;;&#x2F;&#x2F;ã€1ã€‘å¦‚æœæ˜¯å¯¹è±¡çš„è¯ï¼Œä»–ä¼šæŒ‡å‘ä¸€ä¸ªåœ°å€ï¼Œé™¤éæ”¹å˜åœ°å€ä»–æ‰ä¼šé‡æ–°æ‰§è¡ŒuseCallbackï¼Œå¦åˆ™ä»–è¿”å›çš„æ˜¯ä¸Šæ¬¡ç¼“å­˜çš„å‡½æ•°</span><br><span class="line"></span><br><span class="line">function Form() &#123;</span><br><span class="line">    const [text, updateText] &#x3D; useState(&#39;&#39;);</span><br><span class="line">    const textRef &#x3D; useRef();</span><br><span class="line"></span><br><span class="line">    useEffect(() &#x3D;&gt; &#123;</span><br><span class="line">        c &#x3D; Math.random(); &#x2F;&#x2F;ã€2ã€‘</span><br><span class="line"></span><br><span class="line">        textRef.current &#x3D; text;</span><br><span class="line"></span><br><span class="line">        obj &#x3D; &#123;...textRef&#125;; &#x2F;&#x2F;ã€1ã€‘</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const handleSubmit &#x3D; useCallback(() &#x3D;&gt; &#123;</span><br><span class="line">        const currentText &#x3D; textRef.current;</span><br><span class="line">        console.log((currentText));</span><br><span class="line">    &#125;, [obj]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    set1.add(handleSubmit);</span><br><span class="line">    console.log(set1.size);</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">        &lt;&gt;</span><br><span class="line">            &lt;input value&#x3D;&#123;text&#125; onChange&#x3D;&#123;e &#x3D;&gt; updateText(e.target.value)&#125;&#x2F;&gt;</span><br><span class="line">            &#123;&#x2F;*&lt;div&gt;&#123;textRef.current&#125;&lt;&#x2F;div&gt;*&#x2F;&#125;</span><br><span class="line">            &lt;div&gt;&#123;c&#125;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;handleSubmit&#125;&gt;ç‚¹å‡»&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Form</span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H7410c03e8eab4361b28a18bfce16c4ba9.gif" alt=""></p><p>ç”±æ­¤å¯è§objæ¯æ¬¡æ‰§è¡Œéƒ½è¦<code>æµ…å…‹éš†</code>ï¼ŒuseCallbackä¾èµ–äº<code>obj</code>æ‰€ä»¥æ¯æ¬¡éƒ½ä¼šç”Ÿæˆæ–°çš„å‡½æ•°ã€‚</p><h4 id="useMemoä¼˜åŒ–ç»„ä»¶"><a href="#useMemoä¼˜åŒ–ç»„ä»¶" class="headerlink" title="useMemoä¼˜åŒ–ç»„ä»¶"></a>useMemoä¼˜åŒ–ç»„ä»¶</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Example(&#123; a, b &#125;) &#123;</span><br><span class="line">  &#x2F;&#x2F; Only re-rendered if &#96;a&#96; changes:</span><br><span class="line">  const child1 &#x3D; useMemo(() &#x3D;&gt; &lt;Child1 a&#x3D;&#123;a&#125; &#x2F;&gt;, [a]);</span><br><span class="line">  &#x2F;&#x2F; Only re-rendered if &#96;b&#96; changes:</span><br><span class="line">  const child2 &#x3D; useMemo(() &#x3D;&gt; &lt;Child2 b&#x3D;&#123;b&#125; &#x2F;&gt;, [b]);</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &#123;child1&#125;</span><br><span class="line">      &#123;child2&#125;</span><br><span class="line">    &lt;&#x2F;&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">export default Example</span><br></pre></td></tr></table></figure><p><code>æ³¨æ„è¿™ç§æ–¹å¼åœ¨å¾ªç¯ä¸­æ˜¯æ— æ•ˆçš„</code></p><h4 id="å¦‚ä½•å‘ä¸‹ä¼ é€’å›è°ƒï¼Ÿ"><a href="#å¦‚ä½•å‘ä¸‹ä¼ é€’å›è°ƒï¼Ÿ" class="headerlink" title="å¦‚ä½•å‘ä¸‹ä¼ é€’å›è°ƒï¼Ÿ"></a>å¦‚ä½•å‘ä¸‹ä¼ é€’å›è°ƒï¼Ÿ</h4><p>æˆ‘ä»¬å·²ç»å‘ç°å¤§éƒ¨åˆ†äººå¹¶ä¸å–œæ¬¢åœ¨ç»„ä»¶æ ‘çš„æ¯ä¸€å±‚æ‰‹åŠ¨ä¼ é€’å›è°ƒã€‚å°½ç®¡è¿™ç§å†™æ³•æ›´æ˜ç¡®ï¼Œä½†è¿™ç»™äººæ„Ÿè§‰åƒé”™ç»¼å¤æ‚çš„ç®¡é“å·¥ç¨‹ä¸€æ ·éº»çƒ¦ã€‚</p><p>åœ¨<code>å¤§å‹</code>çš„ç»„ä»¶æ ‘ä¸­å»ºè®®ä½¿ç”¨ context ç”¨ useReducer å¾€ä¸‹ä¼ ä¸€ä¸ª <code>dispatch</code> å‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const TodosDispatch &#x3D; React.createContext(null);</span><br><span class="line"></span><br><span class="line">function TodosApp() &#123;</span><br><span class="line">  &#x2F;&#x2F; æç¤ºï¼š&#96;dispatch&#96; ä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´å˜åŒ–</span><br><span class="line">  const [todos, dispatch] &#x3D; useReducer(todosReducer);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;TodosDispatch.Provider value&#x3D;&#123;dispatch&#125;&gt;</span><br><span class="line">      &lt;DeepTree todos&#x3D;&#123;todos&#125; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;TodosDispatch.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function DeepTree(props) &#123;</span><br><span class="line">  &#x2F;&#x2F; å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰§è¡Œä¸€ä¸ª actionï¼Œæˆ‘ä»¬å¯ä»¥ä» context ä¸­è·å– dispatchã€‚</span><br><span class="line">  const dispatch &#x3D; useContext(TodosDispatch);</span><br><span class="line"></span><br><span class="line">  function handleClick() &#123;</span><br><span class="line">    dispatch(&#123; type: &#39;add&#39;, text: &#39;hello&#39; &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;button onClick&#x3D;&#123;handleClick&#125;&gt;Add todo&lt;&#x2F;button&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰Hooks"><a href="#è‡ªå®šä¹‰Hooks" class="headerlink" title="è‡ªå®šä¹‰Hooks"></a>è‡ªå®šä¹‰Hooks</h3><h4 id="useFetch"><a href="#useFetch" class="headerlink" title="useFetch"></a>useFetch</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> useDataApi = <span class="function">(<span class="params">initialUrl, initialData</span>) =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> [data, setData] = useState(initialData);</span><br><span class="line">    <span class="keyword">const</span> [url, setUrl] = useState(initialUrl);</span><br><span class="line">    <span class="keyword">const</span> [isLoading, setIsLoading] = useState(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> [isError, setIsError] = useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> fetchData = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            setIsError(<span class="literal">false</span>);</span><br><span class="line">            setIsLoading(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> result = <span class="keyword">await</span> fetch(url).then(<span class="function"><span class="params">response</span> =&gt;</span> response.json());</span><br><span class="line">                <span class="comment">// const result = await axios.get(url);</span></span><br><span class="line">                setData(result);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                setIsError(<span class="literal">true</span>);</span><br><span class="line">                setData(initialData);</span><br><span class="line">            &#125;</span><br><span class="line">            setIsLoading(<span class="literal">false</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    fetchData();</span><br><span class="line">    &#125;, [url]);</span><br><span class="line">    <span class="keyword">return</span> [&#123;data, isLoading, isError&#125;, setUrl];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="HooksåŸç†åˆ†æ"><a href="#HooksåŸç†åˆ†æ" class="headerlink" title="HooksåŸç†åˆ†æ"></a>HooksåŸç†åˆ†æ</h3><h4 id="ç®€å•å®ç°ä¸€ä¸ªuseState"><a href="#ç®€å•å®ç°ä¸€ä¸ªuseState" class="headerlink" title="ç®€å•å®ç°ä¸€ä¸ªuseState"></a>ç®€å•å®ç°ä¸€ä¸ªuseState</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> _state;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initialValue</span>)</span>&#123;</span><br><span class="line">    _state = _state || initialValue;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setState</span>(<span class="params">newState</span>)</span>&#123;</span><br><span class="line">        _state = newState;</span><br><span class="line">        render()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [_state,setState]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>setStateç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä½¿å‡½æ•°ï¼Œå½“ä¸ºå‡½æ•°çš„æ—¶å€™ï¼Œå‚æ•°ä¸ºå½“å‰çš„_state</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> _state;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initialValue</span>)</span>&#123;</span><br><span class="line">    _state = _state || initialValue;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setState</span>(<span class="params">fun</span>)</span>&#123;</span><br><span class="line">        _state = fun(_state) || _state</span><br><span class="line">        render()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [_state,setState]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setCount(<span class="function"><span class="params">state</span>=&gt;</span>state+<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">"antd"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _state; <span class="comment">// æŠŠ state å­˜å‚¨åœ¨å¤–é¢</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initialValue</span>) </span>&#123;</span><br><span class="line">  _state = _state | initialValue; <span class="comment">// å¦‚æœæ²¡æœ‰ _stateï¼Œè¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼ŒæŠŠ initialValue å¤åˆ¶ç»™å®ƒ</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setState</span>(<span class="params">newState</span>) </span>&#123;</span><br><span class="line">    _state = newState;</span><br><span class="line">    render();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [_state, setState];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;&#123;count&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Button</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          setCount(count + 1);</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        ç‚¹å‡»1</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const rootElement = document.getElementById("root");</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function render() &#123;</span></span><br><span class="line"><span class="regexp">  ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br><span class="line">&#125;</span><br><span class="line">render();</span><br></pre></td></tr></table></figure><h4 id="ç®€å•å®ç°ä¸€ä¸ªuseEffect"><a href="#ç®€å•å®ç°ä¸€ä¸ªuseEffect" class="headerlink" title="ç®€å•å®ç°ä¸€ä¸ªuseEffect"></a>ç®€å•å®ç°ä¸€ä¸ªuseEffect</h4><p>dependencies:ä¾èµ–å…³ç³»</p><p>Effectæœ‰å‡ ä¸ªç‰¹ç‚¹</p><ul><li>æœ‰ä¸¤ä¸ªå‚æ•° callback å’Œ dependencies æ•°ç»„</li><li>å¦‚æœ dependencies ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ callback æ¯æ¬¡ render éƒ½ä¼šæ‰§è¡Œ</li><li>å¦‚æœ dependencies å­˜åœ¨ï¼Œåªæœ‰å½“å®ƒå‘ç”Ÿäº†å˜åŒ–ï¼Œ callback æ‰ä¼šæ‰§è¡Œ</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> _deps; <span class="comment">// _deps è®°å½• useEffect ä¸Šä¸€æ¬¡çš„ ä¾èµ–</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useEffect</span>(<span class="params">callback, depArray</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> hasNoDeps = !depArray; <span class="comment">// å¦‚æœ dependencies ä¸å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">const</span> hasChangedDeps = (_deps</span><br><span class="line">    ? !depArray.every(<span class="function">(<span class="params">el, i</span>) =&gt;</span> el === _deps[i]) <span class="comment">// ä¸¤æ¬¡çš„ dependencies æ˜¯å¦å®Œå…¨ç›¸ç­‰</span></span><br><span class="line">    : <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">/* å¦‚æœ dependencies ä¸å­˜åœ¨ï¼Œæˆ–è€… dependencies æœ‰å˜åŒ–*/</span></span><br><span class="line">  <span class="keyword">if</span> (hasNoDeps || hasChangedDeps) &#123;</span><br><span class="line">    callback();</span><br><span class="line">    _deps = depArray;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°ç°åœ¨çš„è¯ï¼Œåœ¨é¡µé¢èƒ½æ­£å¸¸ä½¿ç”¨äº†ï¼Œä½†æ˜¯æ¯æ¬¡ä½¿ç”¨åªèƒ½ç”¨ä¸€æ¬¡ï¼Œå› ä¸ºä½ å£°æ˜å¤šæ¬¡çš„è¯ï¼Œå®ƒæ˜¯å…¬ç”¨çš„ä¸€ä¸ªå˜é‡ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨ã€‚</p><p>ä»¬å¯ä»¥ä½¿ç”¨æ•°ç»„ï¼Œæ¥è§£å†³ Hooks çš„å¤ç”¨é—®é¢˜</p><p><strong>ä»£ç å…³é”®åœ¨äºï¼š</strong></p><p>åˆæ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼ŒæŒ‰ç…§ <code>useStateï¼ŒuseEffect</code> çš„é¡ºåºï¼ŒæŠŠ <code>stateï¼Œdeps</code> ç­‰æŒ‰é¡ºåºå¡åˆ° <code>memoizedState</code> æ•°ç»„ä¸­ã€‚<br>æ›´æ–°çš„æ—¶å€™ï¼ŒæŒ‰ç…§é¡ºåºï¼Œä» <code>memoizedState</code> ä¸­æŠŠä¸Šæ¬¡è®°å½•çš„å€¼æ‹¿å‡ºæ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> memoizedState = []; <span class="comment">// hooks å­˜æ”¾åœ¨è¿™ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="keyword">let</span> cursor = <span class="number">0</span>; <span class="comment">// å½“å‰ memoizedState ä¸‹æ ‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initialValue</span>) </span>&#123;</span><br><span class="line">  memoizedState[cursor] = memoizedState[cursor] || initialValue;</span><br><span class="line">  <span class="keyword">const</span> currentCursor = cursor;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setState</span>(<span class="params">newState</span>) </span>&#123;</span><br><span class="line">    memoizedState[currentCursor] = newState;</span><br><span class="line">    render();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [memoizedState[cursor++], setState]; <span class="comment">// è¿”å›å½“å‰ stateï¼Œå¹¶æŠŠ cursor åŠ  1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useEffect</span>(<span class="params">callback, depArray</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> hasNoDeps = !depArray;</span><br><span class="line">  <span class="keyword">const</span> deps = memoizedState[cursor];</span><br><span class="line">  <span class="keyword">const</span> hasChangedDeps = (deps</span><br><span class="line">    ? !depArray.every(<span class="function">(<span class="params">el, i</span>) =&gt;</span> el === deps[i])</span><br><span class="line">    : <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">if</span> (hasNoDeps || hasChangedDeps) &#123;</span><br><span class="line">    callback();</span><br><span class="line">    memoizedState[cursor] = depArray;</span><br><span class="line">  &#125;</span><br><span class="line">  cursor++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡ŒåŸºæœ¬çš„ä¸šåŠ¡å·²ç»æ»¡è¶³äº†ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li>memoizedState æ•°ç»„æ˜¯æŒ‰ hookå®šä¹‰çš„é¡ºåºæ¥æ”¾ç½®æ•°æ®çš„ï¼Œå¦‚æœhooksçš„é¡ºåºå˜åŒ–ï¼ŒmemoizedState å¹¶ä¸ä¼šæ„ŸçŸ¥åˆ°æ‰€ä»¥ä¸è¦å†å¾ªç¯æˆ–è€…åˆ¤æ–­è¯­å¥ä¸­è°ƒç”¨ã€‚</li><li>è‡ªå®šä¹‰çš„hooksä¹Ÿæ˜¯å…±äº«åŒä¸€ä¸ª memoizedStateï¼Œå…±äº«åŒä¸€ä¸ªé¡ºåºã€‚</li></ul><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://react.docschina.org/docs/hooks-reference.html" target="_blank" rel="noopener">hooks</a></p><p><a href="https://www.robinwieruch.de/react-hooks" target="_blank" rel="noopener">react-hooks-fetch</a></p><p><a href="https://react.docschina.org/docs/hooks-faq.html" target="_blank" rel="noopener">hooks-faq</a></p><p><a href="https://github.com/facebook/react/blob/master/packages/react/src/ReactHooks.js" target="_blank" rel="noopener">ReactHooksæºç </a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
          <category> Hooks </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GraphQL</title>
      <link href="/2019/10/15/workspace/Server/api/GraphQL/"/>
      <url>/2019/10/15/workspace/Server/api/GraphQL/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>GraphQL</strong></p><p>[[toc]]</p><h3 id="BFF-â€”â€”-Backend-For-Frontend"><a href="#BFF-â€”â€”-Backend-For-Frontend" class="headerlink" title="BFF â€”â€” Backend For Frontend"></a>BFF â€”â€” Backend For Frontend</h3><p><code>BFFï¼Œå³ Backend For Frontendï¼ˆæœåŠ¡äºå‰ç«¯çš„åç«¯ï¼‰,BFF åªæ˜¯ä¸€ç§é€»è¾‘åˆ†å±‚ï¼Œè€Œéä¸€ç§æŠ€æœ¯</code></p><p><img style="       width: 50%;       transform: translateX(50%);       "       src='/assets/img/jiaohu.png'/></p><p>æ­¤æ—¶ä¸ºäº†ä¿éšœå¤šç«¯çš„ä¸åŒéœ€æ±‚ï¼Œéœ€è¦ä¸ºä¸åŒçš„å¹³å°å†™ä¸åŒçš„ API æ¥å£ï¼Œ<br>è€Œæ¯å½“å€¼å‘ç”Ÿä¸€äº›å˜åŒ–æ—¶ï¼Œéœ€è¦å¤šæ®µåŒæ—¶åšå‡ºä¿®æ”¹,è¿™æ ·çš„ä»£ä»·æ˜¾ç„¶ç›¸å½“å¤§ã€‚</p><p>äºæ˜¯ï¼Œæˆ‘ä»¬å°±éœ€è¦ BFF ä½œä¸ºä¸­é—´ä»¶ã€‚åœ¨è¿™ä¸ªä¸­é—´ä»¶ä¸Šæˆ‘ä»¬å°†åšä¸€äº›ä¸šåŠ¡é€»è¾‘å¤„ç†</p><p>è€Œå½“æˆ‘ä»¬æœ‰äº† BFF è¿™ä¸€å±‚æ—¶ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦è€ƒè™‘ç³»ç»Ÿåç«¯çš„è¿ç§»ã€‚åç«¯å‘ç”Ÿçš„å˜åŒ–éƒ½å¯ä»¥åœ¨ BFF å±‚åšä¸€äº›å“åº”çš„ä¿®æ”¹ã€‚</p><p><img style="       width: 50%;       transform: translateX(50%);       "       src='/assets/img/bff.png'/></p><h3 id="GraphQL-è¯­è¨€è®¾è®¡ä¸­çš„å¿…ç„¶æ€§"><a href="#GraphQL-è¯­è¨€è®¾è®¡ä¸­çš„å¿…ç„¶æ€§" class="headerlink" title="GraphQL è¯­è¨€è®¾è®¡ä¸­çš„å¿…ç„¶æ€§"></a>GraphQL è¯­è¨€è®¾è®¡ä¸­çš„å¿…ç„¶æ€§</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æŸ¥è¯¢è¯­æ³•è·ŸæŸ¥è¯¢ç»“æœç›¸è¿‘ï¼ˆè‡ªå®šä¹‰æ¥å£æ•°æ®çš„å­—æ®µï¼‰</span><br><span class="line"></span><br><span class="line">èƒ½ç²¾ç¡®æŸ¥è¯¢æƒ³è¦çš„å­—æ®µï¼ˆè¯·æ±‚ä½ æ‰€è¦çš„æ•°æ®ä¸å¤šä¸å°‘ï¼‰</span><br><span class="line"></span><br><span class="line">èƒ½åˆå¹¶å¤šä¸ªè¯·æ±‚åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼ˆè·å–å¤šä¸ªèµ„æºåªç”¨ä¸€ä¸ªè¯·æ±‚ï¼‰</span><br><span class="line"></span><br><span class="line">æ— æ¥å£ç‰ˆæœ¬ç®¡ç†é—®é¢˜ï¼ˆå‡çº§è¿­ä»£å‡ ä¹æ²¡å½±å“ï¼‰</span><br><span class="line"></span><br><span class="line">ä»£ç å³æ–‡æ¡£ã€‚</span><br><span class="line"></span><br><span class="line">å¼ºå¤§çš„å¼€å‘è€…å·¥å…·</span><br></pre></td></tr></table></figure><p><a href="https://graphql.cn/graphql-js/" target="_blank" rel="noopener">æ–‡æ¡£</a></p><p><a href="https://mp.weixin.qq.com/s/8FgP1LeO6eDd8xuIMGzIIA" target="_blank" rel="noopener">åšå®¢</a></p><h3 id="reactéœ€è¦çš„æŠ€æœ¯æ ˆ"><a href="#reactéœ€è¦çš„æŠ€æœ¯æ ˆ" class="headerlink" title="reactéœ€è¦çš„æŠ€æœ¯æ ˆ"></a>reactéœ€è¦çš„æŠ€æœ¯æ ˆ</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">apollo-boost åŒ…å«å¯åŠ¨é˜¿æ³¢ç½—å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¾èµ–</span><br><span class="line">react-apollo  è§†å›¾å±‚é¢çš„é›†åˆ</span><br><span class="line">graphql-tag  è§£ææŸ¥è¯¢è¯­å¥å¿…é¡»</span><br><span class="line">graphql ä¹Ÿæ˜¯è§£ææŸ¥è¯¢è¯­å¥</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> GraphQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxçš„ä½¿ç”¨æŒ‡å—</title>
      <link href="/2019/10/15/workspace/Server/nginx/nginx_base/"/>
      <url>/2019/10/15/workspace/Server/nginx/nginx_base/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Nginxçš„ä½¿ç”¨æŒ‡å—</strong></p><p>[[toc]]</p><h2 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h2><p><a href="http://www.nginx.cn/76.html" target="_blank" rel="noopener">nginxåŸºæœ¬é…ç½®ä¸å‚æ•°è¯´æ˜</a></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#è¿è¡Œç”¨æˆ·</span><br><span class="line">user nobody;</span><br><span class="line">#å¯åŠ¨è¿›ç¨‹,é€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#å…¨å±€é”™è¯¯æ—¥å¿—åŠPIDæ–‡ä»¶</span><br><span class="line">#error_log  logs&#x2F;error.log;</span><br><span class="line">#error_log  logs&#x2F;error.log  notice;</span><br><span class="line">#error_log  logs&#x2F;error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line">#å·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™</span><br><span class="line">events &#123;</span><br><span class="line">    #epollæ˜¯å¤šè·¯å¤ç”¨IO(I&#x2F;O Multiplexing)ä¸­çš„ä¸€ç§æ–¹å¼,</span><br><span class="line">    #ä»…ç”¨äºlinux2.6ä»¥ä¸Šå†…æ ¸,å¯ä»¥å¤§å¤§æé«˜nginxçš„æ€§èƒ½</span><br><span class="line">    use   epoll; </span><br><span class="line"></span><br><span class="line">    #å•ä¸ªåå°worker processè¿›ç¨‹çš„æœ€å¤§å¹¶å‘é“¾æ¥æ•°    </span><br><span class="line">    worker_connections  1024;</span><br><span class="line"></span><br><span class="line">    # å¹¶å‘æ€»æ•°æ˜¯ worker_processes å’Œ worker_connections çš„ä¹˜ç§¯</span><br><span class="line">    # å³ max_clients &#x3D; worker_processes * worker_connections</span><br><span class="line">    # åœ¨è®¾ç½®äº†åå‘ä»£ç†çš„æƒ…å†µä¸‹ï¼Œmax_clients &#x3D; worker_processes * worker_connections &#x2F; 4  ä¸ºä»€ä¹ˆ</span><br><span class="line">    # ä¸ºä»€ä¹ˆä¸Šé¢åå‘ä»£ç†è¦é™¤ä»¥4ï¼Œåº”è¯¥è¯´æ˜¯ä¸€ä¸ªç»éªŒå€¼</span><br><span class="line">    # æ ¹æ®ä»¥ä¸Šæ¡ä»¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹çš„Nginx Serverå¯ä»¥åº”ä»˜çš„æœ€å¤§è¿æ¥æ•°ä¸ºï¼š4 * 8000 &#x3D; 32000</span><br><span class="line">    # worker_connections å€¼çš„è®¾ç½®è·Ÿç‰©ç†å†…å­˜å¤§å°æœ‰å…³</span><br><span class="line">    # å› ä¸ºå¹¶å‘å—IOçº¦æŸï¼Œmax_clientsçš„å€¼é¡»å°äºç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°</span><br><span class="line">    # è€Œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°å’Œå†…å­˜å¤§å°æˆæ­£æ¯”ï¼Œä¸€èˆ¬1GBå†…å­˜çš„æœºå™¨ä¸Šå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°å¤§çº¦æ˜¯10ä¸‡å·¦å³</span><br><span class="line">    # æˆ‘ä»¬æ¥çœ‹çœ‹360Må†…å­˜çš„VPSå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°æ˜¯å¤šå°‘ï¼š</span><br><span class="line">    # $ cat &#x2F;proc&#x2F;sys&#x2F;fs&#x2F;file-max</span><br><span class="line">    # è¾“å‡º 34336</span><br><span class="line">    # 32000 &lt; 34336ï¼Œå³å¹¶å‘è¿æ¥æ€»æ•°å°äºç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ€»æ•°ï¼Œè¿™æ ·å°±åœ¨æ“ä½œç³»ç»Ÿå¯ä»¥æ‰¿å—çš„èŒƒå›´ä¹‹å†…</span><br><span class="line">    # æ‰€ä»¥ï¼Œworker_connections çš„å€¼éœ€æ ¹æ® worker_processes è¿›ç¨‹æ•°ç›®å’Œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ€»æ•°è¿›è¡Œé€‚å½“åœ°è¿›è¡Œè®¾ç½®</span><br><span class="line">    # ä½¿å¾—å¹¶å‘æ€»æ•°å°äºæ“ä½œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ç›®</span><br><span class="line">    # å…¶å®è´¨ä¹Ÿå°±æ˜¯æ ¹æ®ä¸»æœºçš„ç‰©ç†CPUå’Œå†…å­˜è¿›è¡Œé…ç½®</span><br><span class="line">    # å½“ç„¶ï¼Œç†è®ºä¸Šçš„å¹¶å‘æ€»æ•°å¯èƒ½ä¼šå’Œå®é™…æœ‰æ‰€åå·®ï¼Œå› ä¸ºä¸»æœºè¿˜æœ‰å…¶ä»–çš„å·¥ä½œè¿›ç¨‹éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚</span><br><span class="line">    # ulimit -SHn 65535</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰</span><br><span class="line">    include    mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line">    #è®¾å®šæ—¥å¿—æ ¼å¼</span><br><span class="line">    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    access_log  logs&#x2F;access.log  main;</span><br><span class="line"></span><br><span class="line">    #sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œ</span><br><span class="line">    #å¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸º on,</span><br><span class="line">    #å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œ</span><br><span class="line">    #ä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI&#x2F;Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„uptime.</span><br><span class="line">    sendfile     on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    tcp_nodelay     on;</span><br><span class="line"></span><br><span class="line">    #å¼€å¯gzipå‹ç¼©</span><br><span class="line">    gzip on; &#x2F;&#x2F; å¼€å¯gzip</span><br><span class="line">    gzip_min_length 1k; &#x2F;&#x2F; æœ€å°1kçš„æ–‡ä»¶æ‰ä½¿ç”¨gzip</span><br><span class="line">    gzip_buffers 4 8k; &#x2F;&#x2F; ä»£è¡¨ä»¥8kä¸ºå•ä½ï¼ŒæŒ‰ç…§åŸå§‹æ•°æ®å¤§å°ä»¥8kä¸ºå•ä½çš„4å€ç”³è¯·å†…å­˜</span><br><span class="line">    gzip_comp_level 5; &#x2F;&#x2F; 1 å‹ç¼©æ¯”æœ€å°å¤„ç†é€Ÿåº¦æœ€å¿«ï¼Œ9 å‹ç¼©æ¯”æœ€å¤§ä½†å¤„ç†æœ€æ…¢ï¼ˆä¼ è¾“å¿«ä½†æ¯”è¾ƒæ¶ˆè€—cpuï¼‰</span><br><span class="line">    gzip_types application&#x2F;javascript text&#x2F;plain application&#x2F;x-javascript text&#x2F;css application&#x2F;xml text&#x2F;javascript application&#x2F;x-httpd-php image&#x2F;jpeg image&#x2F;gif image&#x2F;png; &#x2F;&#x2F; æ”¯æŒçš„æ–‡ä»¶ç±»å‹</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;; &#x2F;&#x2F; IE6ä¸€ä¸‹ Gzipæ”¯æŒçš„ä¸å¥½ï¼Œæ•…ä¸å®ç”¨gzip</span><br><span class="line"></span><br><span class="line">    #è®¾å®šè¯·æ±‚ç¼“å†²</span><br><span class="line">    client_header_buffer_size    128k;</span><br><span class="line">    large_client_header_buffers  4 128k;</span><br><span class="line"></span><br><span class="line">    #è®¾å®šè™šæ‹Ÿä¸»æœºé…ç½®</span><br><span class="line">    server &#123;</span><br><span class="line">        #ä¾¦å¬80ç«¯å£</span><br><span class="line">        listen    80;</span><br><span class="line">        #å®šä¹‰ä½¿ç”¨ www.nginx.cnè®¿é—®</span><br><span class="line">        server_name  www.nginx.cn;</span><br><span class="line"></span><br><span class="line">        #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®</span><br><span class="line">        root html;</span><br><span class="line"></span><br><span class="line">        #è®¾å®šæœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—</span><br><span class="line">        access_log  logs&#x2F;nginx.access.log  main;</span><br><span class="line"></span><br><span class="line">        #é»˜è®¤è¯·æ±‚</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">          #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line">             try_files $uri $uri&#x2F; &#x2F;index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # å®šä¹‰é”™è¯¯æç¤ºé¡µé¢</span><br><span class="line">        error_page   500 502 503 504 &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†</span><br><span class="line">        location ~ ^&#x2F;(images|javascript|js|css|flash|media|static)&#x2F; &#123;</span><br><span class="line">            #è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€ä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹ï¼Œ</span><br><span class="line">            #å¦‚æœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚</span><br><span class="line">            expires 30d;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #PHP è„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘åˆ° FastCGIå¤„ç†. ä½¿ç”¨FastCGIé»˜è®¤é…ç½®.</span><br><span class="line">        location ~ .php$ &#123;</span><br><span class="line">            fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">            fastcgi_index index.php;</span><br><span class="line">            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">            include fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #ç¦æ­¢è®¿é—® .htxxx æ–‡ä»¶</span><br><span class="line">        location ~ &#x2F;.ht &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è´Ÿè½½å‡è¡¡ï¼ˆåå‘ä»£ç†ï¼‰"><a href="#è´Ÿè½½å‡è¡¡ï¼ˆåå‘ä»£ç†ï¼‰" class="headerlink" title="è´Ÿè½½å‡è¡¡ï¼ˆåå‘ä»£ç†ï¼‰"></a>è´Ÿè½½å‡è¡¡ï¼ˆåå‘ä»£ç†ï¼‰</h2><p>1.ç”¨æˆ·è¾“å…¥<code>http://test-openai.com</code> æ—¶ï¼Œè®¿é—®<code>80</code>ç«¯å£<br/><br>2.nginxç›‘å¬åˆ°80ç«¯å£<code>è¢«è®¿é—®</code>ï¼ŒåŒ¹é…åˆ°çš„<code>/</code>è·¯å¾„ï¼Œè¢«åå‘ä»£ç†åˆ°<code>http://dramatic-offical-website</code><br/><br>3.<code>dramatic-offical-website</code>é›†ç¾¤ç®¡ç†ç€ä¸€å †æœºå™¨åœ°å€ï¼Œä»è€Œå®ç°è´Ÿè½½å‡è¡¡ã€‚<br/><br>4.å¦‚æœåŒ¹é…åˆ°<code>http://test-openai.com/images/</code> è·¯å¾„ï¼Œåˆ™ç›´æ¥æ˜ å°„<code>/data</code>ä¸‹çš„æ–‡ä»¶<br/></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è™šæ‹Ÿä¸»æœºé…ç½®</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">server_name</span> test-openai.com; <span class="comment"># è¯·æ±‚åˆ°è¾¾çš„æœåŠ¡å™¨å</span></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>; <span class="comment"># ç›‘å¬80ç«¯å£</span></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; <span class="comment"># httpsé»˜è®¤ç«¯å£æ˜¯443</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹ / æ‰€æœ‰åšè´Ÿè½½å‡è¡¡+åå‘ä»£ç†</span></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://dramatic-offical-website; <span class="comment"># ä»£ç†åˆ°ç›®æ ‡åœ°å€</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†</span></span><br><span class="line">    <span class="attribute">location</span> /images/ &#123;</span><br><span class="line">        <span class="attribute">root</span> /data; <span class="comment"># æ˜ å°„åˆ°/data/images</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾å®šè´Ÿè½½å‡è¡¡åå°æœåŠ¡å™¨åˆ—è¡¨</span></span><br><span class="line"><span class="attribute">upstream</span> dramatic-offical-website &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">10.192.106.133</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">10.192.106.134</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/conf.d</span></span><br><span class="line"><span class="comment"># /usr/local/nginx/conf/vhost</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /api &#123;</span><br><span class="line">   <span class="attribute">rewrite</span> <span class="regexp"> ^/api/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">   <span class="attribute">proxy_pass</span> <span class="string">'XXXXXXXXXXXXX'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HTTPç¼“å­˜æ§åˆ¶"><a href="#HTTPç¼“å­˜æ§åˆ¶" class="headerlink" title="HTTPç¼“å­˜æ§åˆ¶"></a>HTTPç¼“å­˜æ§åˆ¶</h2><p>å¸¸ç”¨çš„ç¼“å­˜è®¾ç½®é‡Œé¢æœ‰ä¸¤ç§æ–¹å¼ï¼Œéƒ½æ˜¯ä½¿ç”¨add_headeræ¥è®¾ç½®ï¼šåˆ†åˆ«ä¸º<code>Cache-Control</code>å’Œ<code>Pragma</code></p><p><code>Pragma</code>å¯ä»¥åº”ç”¨åˆ°http 1.0 å’Œhttp 1.1ï¼Œåªèƒ½åº”ç”¨äºhttp 1.1<br/><br><code>Pragma</code>æ˜¯æ—§äº§ç‰©ï¼Œå·²ç»é€æ­¥æŠ›å¼ƒ</p><h3 id="Pragma"><a href="#Pragma" class="headerlink" title="Pragma"></a><code>Pragma</code></h3><p><code>Pragma</code>æœ‰ä¸¤ä¸ªå­—æ®µ<code>Pragma</code>å’Œ<code>Expires</code>ã€‚Pragmaçš„å€¼ä¸ºno-cacheæ—¶ï¼Œè¡¨ç¤ºç¦ç”¨ç¼“å­˜ï¼ŒExpiresçš„å€¼æ˜¯ä¸€ä¸ªGMTæ—¶é—´ï¼Œè¡¨ç¤ºè¯¥ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´ã€‚</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ .*\.(css|js|swf|php|htm|html</span> )$ &#123;</span><br><span class="line"><span class="attribute">add_header</span> Cache-Control max-age=<span class="number">10</span>;</span><br><span class="line"><span class="attribute">add_header</span> Pragma <span class="literal">no</span>-cache;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Pragmaçš„ä¼˜å…ˆçº§é«˜äºCache-Control</span></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ .*\.(js|css)$</span> &#123;</span><br><span class="line">   <span class="attribute">expires</span> <span class="number">10d</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è‹¥æŠ¥æ–‡ä¸­åŒæ—¶å‡ºç°äº† Expires å’Œ Cache-Controlï¼Œåˆ™ä»¥ Cache-Control ä¸ºå‡†ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="Cache-Control-ã€Œå¼ºåˆ¶ç¼“å­˜ã€"><a href="#Cache-Control-ã€Œå¼ºåˆ¶ç¼“å­˜ã€" class="headerlink" title="Cache-Control ã€Œå¼ºåˆ¶ç¼“å­˜ã€"></a><code>Cache-Control ã€Œå¼ºåˆ¶ç¼“å­˜ã€</code></h3><p>å¯¹äºå¼ºç¼“å­˜æ¥è¯´ï¼Œä¼šç›´æ¥å»æŸ¥çœ‹<code>ç¼“å­˜èµ„æºä¸­çš„å“åº”å¤´</code>çš„å­—æ®µå€¼ï¼Œä»¥æ­¤æ¥åˆ¤æ–­ç¼“å­˜çš„èµ„æºæ˜¯å¦è¿˜èƒ½ä½¿ç”¨ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>ä¸éœ€è¦</code>å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</p><p><code>public</code>æŒ‡ç¤ºå“åº”å¯è¢«ä»»ä½•ç¼“å­˜åŒºç¼“å­˜ã€‚ã€å¦‚æœå®šä¹‰äº†<code>max-age</code>ï¼Œå¯ä»¥ä¸ç”¨å†å®šä¹‰<code>public</code>ï¼Œå®ƒä»¬çš„æ„ä¹‰æ˜¯ä¸€æ ·çš„ã€‚ã€‘<br/><br><code>private</code>æŒ‡ç¤ºå¯¹äºå•ä¸ªç”¨æˆ·çš„æ•´ä¸ªæˆ–éƒ¨åˆ†å“åº”æ¶ˆæ¯ï¼Œä¸èƒ½è¢«å…±äº«ç¼“å­˜å¤„ç†ã€‚è¿™å…è®¸æœåŠ¡å™¨ä»…ä»…æè¿°å½“ç”¨æˆ·çš„éƒ¨åˆ†å“åº”æ¶ˆæ¯ï¼Œæ­¤å“åº”æ¶ˆæ¯å¯¹äºå…¶ä»–ç”¨æˆ·çš„è¯·æ±‚æ— æ•ˆã€‚<br/><br><code>no-cache</code>å¯ä»¥åœ¨æœ¬åœ°ç¼“å­˜ï¼Œå¯ä»¥åœ¨ä»£ç†æœåŠ¡å™¨ç¼“å­˜ï¼Œä½†æ˜¯è¿™ä¸ªç¼“å­˜è¦æœåŠ¡å™¨éªŒè¯æ‰å¯ä»¥ä½¿ç”¨<br/><br><code>no-store</code>å½»åº•å¾—ç¦ç”¨ç¼“å†²ï¼Œæœ¬åœ°å’Œä»£ç†æœåŠ¡å™¨éƒ½ä¸ç¼“å†²ï¼Œæ¯æ¬¡éƒ½ä»æœåŠ¡å™¨è·å–<br/><br><code>max-age</code>æŒ‡ç¤ºå®¢æˆ·æœºå¯ä»¥æ¥æ”¶ç”Ÿå­˜æœŸä¸å¤§äºæŒ‡å®šæ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰çš„å“åº” ã€max-age=1008611ã€‘<br/><br><code>only-if-cached</code>è¡¨ç¤ºä¸è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œå®Œå…¨åªä½¿ç”¨ç¼“å­˜ï¼Œè‹¥ç¼“å­˜ä¸å‘½ä¸­ï¼Œåˆ™è¿”å›503é”™è¯¯<br/><br><code>must-revalidate</code>ï¼šå‘Šè¯‰æµè§ˆå™¨ã€ç¼“å­˜æœåŠ¡å™¨ï¼Œæœ¬åœ°å‰¯æœ¬è¿‡æœŸå‰ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°å‰¯æœ¬ï¼›æœ¬åœ°å‰¯æœ¬ä¸€æ—¦è¿‡æœŸï¼Œå¿…é¡»å»æºæœåŠ¡å™¨è¿›è¡Œæœ‰æ•ˆæ€§æ ¡éªŒ<br/></p><h3 id="ç¼“å­˜æ ¡éªŒã€Œåå•†ç¼“å­˜ã€"><a href="#ç¼“å­˜æ ¡éªŒã€Œåå•†ç¼“å­˜ã€" class="headerlink" title="ç¼“å­˜æ ¡éªŒã€Œåå•†ç¼“å­˜ã€"></a><code>ç¼“å­˜æ ¡éªŒã€Œåå•†ç¼“å­˜ã€</code></h3><p>å½“è¶…è¿‡max-agesè®¾ç½®çš„æ—¶é—´,è¿™ä¸ªå°±ä¼šèµ·ä½œç”¨</p><p>è€Œå¯¹äºåå•†ç¼“å­˜æ¥è¯´ï¼Œè¦åˆ¤æ–­ç¼“å­˜æ˜¯å¦èƒ½ä½¿ç”¨ï¼Œéœ€è¦é€šè¿‡å‘èµ·è¯·æ±‚ï¼Œå¸¦ç€ä¸ç¼“å­˜ç›¸å…³çš„å­—æ®µï¼Œåˆ°æœåŠ¡å™¨å»åšè¿‡æœŸåˆ¤æ–­åï¼Œæ‰èƒ½é€šè¿‡ç›¸åº”çš„å†…å®¹åšå‡ºç›¸åº”çš„æ“ä½œã€‚ï¼ˆæ˜¯å›å»æ‹¿ç¼“å­˜çš„èµ„æºï¼Œè¿˜æ˜¯æ‹¿è¿™æ¬¡æœåŠ¡å™¨è¿”å›çš„èµ„æºï¼‰</p><h3 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified/If-Modified-Since"></a><code>Last-Modified/If-Modified-Since</code></h3><p><code>Last-Modified</code>ï¼šæ ‡ç¤ºè¿™ä¸ª<code>å“åº”</code>èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚webæœåŠ¡å™¨åœ¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚<br/><br><code>If-Modified-Since</code>æ˜¯æ ‡å‡†çš„HTTPè¯·æ±‚å¤´æ ‡ç­¾ï¼Œåœ¨å‘é€HTTP<code>è¯·æ±‚</code>æ—¶ï¼Œ<strong>æŠŠæµè§ˆå™¨ç«¯ç¼“å­˜é¡µé¢çš„æœ€åä¿®æ”¹æ—¶é—´ä¸€èµ·å‘åˆ°æœåŠ¡å™¨å»ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¿™ä¸ªæ—¶é—´ä¸æœåŠ¡å™¨ä¸Šå®é™…æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´è¿›è¡Œæ¯”è¾ƒ</strong>ã€‚<br/><br>å¦‚æœæ—¶é—´ä¸€è‡´ï¼Œé‚£ä¹ˆè¿”å›HTTPçŠ¶æ€ç 304ï¼ˆä¸è¿”å›æ–‡ä»¶å†…å®¹ï¼‰ï¼Œå®¢æˆ·ç«¯æ¥åˆ°ä¹‹åï¼Œå°±ç›´æ¥æŠŠæœ¬åœ°ç¼“å­˜æ–‡ä»¶æ˜¾ç¤ºåˆ°æµè§ˆå™¨ä¸­ã€‚<br/><br>å¦‚æœæ—¶é—´ä¸ä¸€è‡´ï¼Œå°±è¿”å›HTTPçŠ¶æ€ç 200å’Œæ–°çš„æ–‡ä»¶å†…å®¹ï¼Œå®¢æˆ·ç«¯æ¥åˆ°ä¹‹åï¼Œä¼šä¸¢å¼ƒæ—§æ–‡ä»¶ï¼ŒæŠŠæ–°æ–‡ä»¶ç¼“å­˜èµ·æ¥ï¼Œå¹¶æ˜¾ç¤ºåˆ°æµè§ˆå™¨ä¸­</p><p><code>If-Modified-Since</code>å’Œ<code>If-Unmodified-Since</code>çš„åŒºåˆ«æ˜¯ï¼š<br/><br>If-Modified-Sinceï¼šå‘Šè¯‰æœåŠ¡å™¨å¦‚æœæ—¶é—´ä¸€è‡´ï¼Œè¿”å›çŠ¶æ€ç 304<br/><br>If-Unmodified-Sinceï¼šå‘Šè¯‰æœåŠ¡å™¨å¦‚æœæ—¶é—´ä¸ä¸€è‡´ï¼Œè¿”å›çŠ¶æ€ç 412</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">last_modified = res.headers[<span class="string">'Last-Modified'</span>]</span><br><span class="line"># ä¿®æ”¹headers</span><br><span class="line">headers[<span class="string">'If-Unmodified-Since'</span>] = last_modified</span><br></pre></td></tr></table></figure><h3 id="ETag-If-None-Match"><a href="#ETag-If-None-Match" class="headerlink" title="ETag/If-None-Match"></a><code>ETag/If-None-Match</code></h3><p>::: tip ä¸ºä»€ä¹ˆè¦æœ‰etagï¼Ÿ<br>1ã€ä¸€äº›æ–‡ä»¶ä¹Ÿè®¸ä¼šå‘¨æœŸæ€§çš„æ›´æ”¹ï¼Œä½†æ˜¯ä»–çš„å†…å®¹å¹¶ä¸æ”¹å˜(ä»…ä»…æ”¹å˜çš„ä¿®æ”¹æ—¶é—´)ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®¢æˆ·ç«¯è®¤ä¸ºè¿™ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œè€Œé‡æ–°get<br/><br>2ã€æŸäº›æ–‡ä»¶ä¿®æ”¹éå¸¸é¢‘ç¹ï¼Œæ¯”å¦‚åœ¨ç§’ä»¥ä¸‹çš„æ—¶é—´å†…è¿›è¡Œä¿®æ”¹ï¼Œ(æ¯”æ–¹è¯´1så†…ä¿®æ”¹äº†Næ¬¡)ï¼Œif-modified-sinceèƒ½æ£€æŸ¥åˆ°çš„ç²’åº¦æ˜¯ç§’çº§çš„ï¼Œè¿™ç§ä¿®æ”¹æ— æ³•åˆ¤æ–­<br/><br>3ã€æŸäº›æœåŠ¡å™¨ä¸èƒ½ç²¾ç¡®çš„å¾—åˆ°æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ã€‚<br/><br>:::</p><p><code>etag</code>çš„æ–¹å¼æ˜¯è¿™æ ·ï¼šæœåŠ¡å™¨é€šè¿‡æŸä¸ªç®—æ³•å¯¹èµ„æºè¿›è¡Œè®¡ç®—ï¼Œå–å¾—ä¸€ä¸²å€¼,ä¹‹åå°†è¯¥å€¼é€šè¿‡etagè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡è¯·æ±‚æ—¶é€šè¿‡<code>If-None-Matchæˆ–If-Match</code>å¸¦ä¸Šè¯¥å€¼ï¼ŒæœåŠ¡å™¨å¯¹è¯¥å€¼è¿›è¡Œå¯¹æ¯”æ ¡éªŒ,å¦‚æœä¸€è‡´åˆ™ä¸è¦è¿”å›èµ„æºã€‚</p><p><code>If-None-Match</code>å’Œ<code>If-Match</code>çš„åŒºåˆ«æ˜¯ï¼š</p><p><code>If-None-Match</code>ï¼šå‘Šè¯‰æœåŠ¡å™¨å¦‚æœä¸€è‡´ï¼Œè¿”å›çŠ¶æ€ç 304ï¼Œä¸ä¸€è‡´åˆ™è¿”å›èµ„æº<br/><br><code>If-Match</code>ï¼šå‘Šè¯‰æœåŠ¡å™¨å¦‚æœä¸ä¸€è‡´ï¼Œè¿”å›çŠ¶æ€ç 412</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"> <span class="attribute">location</span> <span class="regexp">~* ^.+\.(css|js|txt|xml|swf|wav)$</span> &#123;</span><br><span class="line"><span class="comment">#            expires      24h;</span></span><br><span class="line"><span class="comment">#            add_header Cache-Control no-store;</span></span><br><span class="line"><span class="comment">#            add_header Cache-Control max-age=43200;</span></span><br><span class="line">            <span class="attribute">add_header</span> Cache-Control  max-age=<span class="number">86400</span>,s-maxage=<span class="number">3600</span>,must-revalidate;</span><br><span class="line"><span class="comment">#            add_header Cache-Control only-if-cached;</span></span><br><span class="line"><span class="comment">#            add_header Cache-Control no-cache;</span></span><br><span class="line"><span class="comment">#            add_header Cache-Control must-revalidate;</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><strong>æœ‰ä¸€ç§åœºæ™¯éœ€è¦æ³¨æ„</strong></p><ul><li>åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œå¤šå°æœºå™¨é—´æ–‡ä»¶çš„Last-Modifiedå¿…é¡»ä¿æŒä¸€è‡´ï¼Œä»¥å…è´Ÿè½½å‡è¡¡åˆ°ä¸åŒæœºå™¨å¯¼è‡´æ¯”å¯¹å¤±è´¥ï¼›</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿå°½é‡å…³é—­æ‰ETag(æ¯å°æœºå™¨ç”Ÿæˆçš„ETagéƒ½ä¼šä¸ä¸€æ ·ï¼‰ï¼›</li><li>äº¬ä¸œé¡µé¢çš„èµ„æºè¯·æ±‚ï¼Œè¿”å›çš„repsones headerå°±åªæœ‰Last-Modifiedï¼Œæ²¡æœ‰ETagï¼š</li></ul><h3 id="ç”¨æˆ·è¡Œä¸º"><a href="#ç”¨æˆ·è¡Œä¸º" class="headerlink" title="ç”¨æˆ·è¡Œä¸º"></a>ç”¨æˆ·è¡Œä¸º</h3><p>F5åˆ·æ–°é‚£ä¸ªå¯ä»¥å»ç«ç‹çœ‹çœ‹</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/He00c7b1f799e40f39f6b6ab2f9f60710J.jpg" alt=""></p><h3 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hcca8568c990e4f33b30636b57b2fd65cc.jpg" alt=""></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åœ¨å‰åç«¯ä¸åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠå¼ºç¼“å­˜è®¾ç½®çš„æ—¶é—´ç‰¹åˆ«é•¿ï¼Œä¸€æ–¹é¢æ˜¯å‡å°‘304ç¼“å­˜ï¼Œ<br>å¦ä¸€æ–¹é¢æ˜¯webpackæ‰“åŒ…çš„é¡¹ç›®ä¼šå¸¦æœ‰hashå€¼ï¼Œåªè¦æ–‡ä»¶å‘ç”Ÿæ”¹å˜å¯¹åº”çš„jsæˆ–è€…cssçš„hashå€¼å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ—¶å€™æœåŠ¡ç«¯å°±ä¼šé‡æ–°è¯·æ±‚æ•°æ®ï¼Œè¿™é‡Œä¸ä¼šè§¦ç¢°åˆ°ä»»ä½•çš„ç¼“å­˜ã€‚<br>æ‰€ä»¥ä¸ºäº†æ›´å¥½åœ°è¿ç”¨ç¼“å­˜ï¼Œæå‡å®¢æˆ·ç«¯çš„ä½“éªŒï¼Œå‡è½»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæˆ‘ä»¬ä¸€å®šè¦è¦æŠŠç»å¸¸ç”¨çš„åº“ï¼Œå¦‚antd,echartsç­‰ç­‰ï¼Œå•ç‹¬æ‰“åŒ…æˆä¸€ä¸ªjsï¼Œè¿™æ ·ä¸ä¼šæ¯æ¬¡ä¸Šçº¿éƒ½ä¼šé‡æ–°è¯·æ±‚æ•°æ®äº†ã€‚<br>å¦‚æœçº¿ä¸Šé‡åˆ°å°çš„é—®é¢˜ç‰¹åˆ«æ€¥ï¼Œæºç åˆä¸åœ¨èº«è¾¹ï¼Œéœ€è¦ç™»å½•æœåŠ¡å™¨æ”¹ä»£ç ï¼Œä¹Ÿå°½å¯èƒ½çš„ä¸ç›´æ¥ä¿®æ”¹jsæˆ–è€…cssé‡Œé¢çš„ä»£ç ï¼Œ<br>è¿™æ ·åœ¨å¼ºç¼“å­˜æ—¶é—´å†…æˆ–è€…ç”¨æˆ·åˆ·æ–°é¡µé¢å¹¶ä¸ä¼šè¯·æ±‚åˆ°çœŸæ­£çš„è¯·æ±‚æ•°æ®ï¼Œä¼šç›´æ¥ä½¿ç”¨æœ¬åœ°çš„ç¼“å­˜ï¼Œæµè§ˆå™¨å¼ºåˆ¶åˆ·æ–°ä¼šè§£å†³æ­¤é—®é¢˜ï¼Œä½†æ˜¯åœ¨æ‰‹æœºç«¯å°±ggäº†ï¼Œ<br>å¥½çš„åŠæ³•å°±æ˜¯ç›´æ¥æŠŠæ–‡ä»¶åç§°ï¼ŒåŠ ä¸€äº›hashå€¼ï¼Œç„¶ååœ¨å¯¹åº”çš„é¡µé¢ä¿®æ”¹ä¸‹ï¼Œè¿™æ ·å°±èƒ½æ‹¿åˆ°çœŸæ­£çš„èµ„æºäº†ã€‚ï¼ˆä¸Šä¸€å®¶å…¬å¸é‡åˆ°çš„å‘ï¼‰</p><h2 id="ç³»ç»Ÿå¸¸ç”¨ç›®å½•"><a href="#ç³»ç»Ÿå¸¸ç”¨ç›®å½•" class="headerlink" title="ç³»ç»Ÿå¸¸ç”¨ç›®å½•"></a>ç³»ç»Ÿå¸¸ç”¨ç›®å½•</h2><p><code>/etc</code>ä¸‹ä¸€èˆ¬æ˜¯ç³»ç»Ÿ<code>å…¨å±€æ€§</code>çš„å…¬å…±æ–‡ä»¶ç›®å½• <br/><br><code>/usr/local</code>ä¸€èˆ¬æ˜¯<code>ç¬¬ä¸‰æ–¹è½¯ä»¶</code>æ‰€å­˜æ”¾çš„ç›®å½•çš„åˆ†åŒºï¼Œå¯ä»¥å•ç‹¬åˆ†åŒºï¼Œä¸”å»ºè®®å•ç‹¬æŒ‚è½½åˆ†åŒºã€‚ <br/><br><code>/usr/local/src</code>ä¸€èˆ¬æ˜¯<code>ä¸‹è½½çš„ç¬¬ä¸‰æ–¹è½¯ä»¶</code>ã€‚ <br/><br><code>/usr/local/etc</code>ä¸‹ä¸€èˆ¬æŒ‡ä»£<code>ç”¨æˆ·çº§</code>çš„å…¬å…±æ–‡ä»¶ç›®å½• <br/><br><code>/usr/local/bin</code>ç›®å½•æ˜¯ç»™ç”¨æˆ·æ”¾ç½®è‡ªå·±çš„å¯æ‰§è¡Œç¨‹åº. <br/><br><code>/usr/bin</code>ä¸‹é¢çš„éƒ½æ˜¯ç³»ç»Ÿé¢„è£…çš„<code>å¯æ‰§è¡Œç¨‹åº</code>ï¼Œç³»ç»Ÿå‡çº§æœ‰å¯èƒ½ä¼šè¢«è¦†ç›–. <br/></p>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ¬åœ°å®‰è£…Nginxè¸©åˆ°çš„å‘</title>
      <link href="/2019/10/15/workspace/Server/nginx/nginx_local/"/>
      <url>/2019/10/15/workspace/Server/nginx/nginx_local/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>æœ¬åœ°å®‰è£…Nginxè¸©åˆ°çš„å‘</strong></p><p>[[toc]]</p><h3 id="è£…æœº"><a href="#è£…æœº" class="headerlink" title="è£…æœº"></a>è£…æœº</h3><p>å…ˆè¿›å…¥ <code>cd /user/local/src</code> æ²¡æœ‰<code>src</code>,<code>mkdir src</code>è‡ªè¡Œæ–°å»º</p><p><a href="https://nginx.org/download/" target="_blank" rel="noopener">nginxä¸‹è½½åœ°å€</a></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…</span></span><br><span class="line"><span class="attribute">wget</span> wget http://nginx.org/download/nginx-1.18.0.tar.gz</span><br><span class="line"></span><br><span class="line">#è§£å‹  </span><br><span class="line">tar -xzvf nginx-<span class="number">1</span>.<span class="number">18</span>.<span class="number">0</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›å…¥nginxç›®å½•</span></span><br><span class="line">cd nginx-<span class="number">1</span>.<span class="number">18</span>.<span class="number">0</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®</span></span><br><span class="line">./configure --prefix=/usr/local/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#make</span></span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ"></a>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> /user/local/nginx</span><br><span class="line">./sbin/nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£å¸¸æƒ…å†µçš„ä¿¡æ¯è¾“å‡ºï¼š</span></span><br><span class="line"></span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨nginx"><a href="#å¯åŠ¨nginx" class="headerlink" title="å¯åŠ¨nginx"></a>å¯åŠ¨nginx</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> /usr/local/nginx/sbin</span><br><span class="line">./nginx //å¯åŠ¨nginx</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<a href="http://localhost:80" target="_blank" rel="noopener">localhost</a> é»˜è®¤æ˜¯ 80 ç«¯å£ï¼Œ<strong>åˆ‡è®°è¿™é‡Œä¸è¦ä½¿ç”¨6666ç«¯å£å·</strong>è°·æ­Œå’Œç«ç‹ç¦ç”¨6666ç«¯å£å·ã€‚</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H4ba122e3923a46dfa1ba5477c8d80eaax.jpg" alt=""></p><p>èƒ½çœ‹è§è¿™ä¸ªé¡µé¢è¯´æ˜å·²ç»æˆåŠŸäº†ã€‚</p><p>ä¸ºäº†åæœŸæ›´å¥½çš„æ—¶å€™nginxï¼Œå¯ä»¥é…ç½®ä¸‹å…¨å±€å˜é‡ æˆ‘ç”¨çš„æ˜¯è½¯è¿æ¥ <code>ln -s /usr/local/nginx/sbin/nginx /usr/local/bin/</code></p><h3 id="éƒ¨ç½²æœåŠ¡"><a href="#éƒ¨ç½²æœåŠ¡" class="headerlink" title="éƒ¨ç½²æœåŠ¡"></a>éƒ¨ç½²æœåŠ¡</h3><p>æ—¢ç„¶æ˜¯åœ¨æœ¬åœ°é…ç½®çš„nginxå°±å¯ä»¥ç”¨ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶äº†ï¼Œæ‰“å¼€è®¿è¾¾ç„¶å <code>shift+com+g</code> è¾“å…¥ <code>/usr/local/nginx/conf</code>,ç„¶åç”¨ç¼–è¾‘å™¨æ‰“å¼€ <code>nginx.conf</code>é…ç½®æ–‡ä»¶</p><p>æ‰“å¼€åæ˜¯å¤§è‡´æ˜¯è¿™ä¸ªæ ·å­çš„æœ‰åˆ å‡</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">         <span class="attribute">location</span> / &#123;</span><br><span class="line">           <span class="attribute">root</span> html;</span><br><span class="line">           <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œçš„httpå—ï¼š</strong> å¯ä»¥åµŒå¥—å¤šä¸ªserverï¼Œé…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ã€‚</p><p><strong>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæƒé™çš„é—®é¢˜</strong> ï¼Œå¯èƒ½å¯¼è‡´é¡¹ç›®æ‰“å¼€æ˜¯403ï¼Œåœ¨nginxç›®å½•ä¸Šä¸€çº§ç›®å½•æ‰§è¡Œ <code>sudo chown -R $(whoami) ./nginx</code>ï¼Œç„¶åé‡æ–°åŠ è½½nginx,ä¸è¡Œçš„è¯çœ‹çœ‹æ˜¯ä¸æ˜¯çš„æ‰“åŒ…åçš„æ–‡ä»¶æ²¡æœ‰æƒé™ã€‚</p><p><strong>ç„¶åæˆ‘éƒ¨ç½²è‡ªå·±çš„æœåŠ¡</strong></p><p>å¯ä»¥ä¿æŒè¿™ä¸ªé¡µé¢çš„ç®€æ´ï¼Œå•ç‹¬æ–°å»ºä¸€ä¸ªvhostæ–‡ä»¶å¤¹ ç„¶ååœ¨é‡Œé¢é…ç½®æ–°é¡¹ç›®ï¼Œæœ€åç”¨ <code>include vhost/*.conf;</code> ç›´æ¥å¼•å…¥è¿›æ¥ï¼›</p><p>æˆ‘è¿™é‡Œå±•ç¤ºç›´æ¥å°±è¿™æ ·äº†</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">server</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8891</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">root</span>  /Users/hzf/Desktop/my-project/dist;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">index</span> index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">      <span class="comment">#å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span></span><br><span class="line">      <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span></span><br><span class="line"><span class="regexp"></span>    &#123;</span><br><span class="line">        <span class="attribute">expires</span>      <span class="number">30d</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ .*\.(js|css)?$</span></span><br><span class="line"><span class="regexp"></span>    &#123;</span><br><span class="line">        <span class="attribute">expires</span>      <span class="number">12h</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /.well-known</span> &#123;</span><br><span class="line">        <span class="attribute">allow</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /\.</span></span><br><span class="line"><span class="regexp"></span>    &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªå·¨å‘ï¼Œåœ¨ä¹‹å‰äº‘æœåŠ¡å™¨çš„æ—¶å€™ root å¯¹åº”é¡¹ç›®çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ï¼Œä½†æ˜¯åœ¨æœ¬åœ°è¿è¡Œçš„æ—¶å€™ï¼Œæ˜¯æ²¡åŠæ³•åŠ è½½æœ¬åœ°èµ„æºçš„ğŸ˜Œï¼Œå…¨éƒ¨åŒ…404ï¼Œçœ‹éå¥½å¤šæ–‡ç« éƒ½ä¸è¡Œï¼Œè€½è¯¯äº†åŠå¤©ã€‚å®é™…çš„åŸå› æ˜¯ <code>nginxåšä»£ç†åçš„è™šæ‹Ÿè·¯å¾„å’Œé™æ€èµ„æºçš„è¯·æ±‚è·¯å¾„ä¸ä¸€è‡´å¯¼çš„</code></p><p>ç„¶åå…¶å®å°±æ˜¯å•ç‹¬ç»™é™æ€çš„èµ„æºè®¾ç½®å¯¹åº”çš„rootç›®å½•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"> <span class="attribute">location</span> /js/ &#123;</span><br><span class="line">    <span class="attribute">root</span>   /Users/hzf/Desktop/my-project/dist/js;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /font/ &#123;</span><br><span class="line">    <span class="attribute">root</span>   /Users/hzf/Desktop/my-project/dist/font;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /css/ &#123;</span><br><span class="line">    <span class="attribute">root</span>   /Users/hzf/Desktop/my-project/dist/css;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># å¦‚æœæ‰“åŒ…åè¿˜æœ‰åˆ«çš„æ–‡ä»¶ï¼Œå¦‚:imgï¼Œç»§ç»­æ·»åŠ å°±å¥½äº†...</span></span><br></pre></td></tr></table></figure><br/><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ¬åœ°çš„nginxå°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œåé¢é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘åœ¨åŠæ—¶æ›´æ–°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> Nginx </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>äº‘æœåŠ¡å™¨é…ç½®</title>
      <link href="/2019/09/15/workspace/Server/lnmp/"/>
      <url>/2019/09/15/workspace/Server/lnmp/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>äº‘æœåŠ¡å™¨é…ç½®</strong></p><p>[[toc]]</p><h3 id="è£…æœº"><a href="#è£…æœº" class="headerlink" title="è£…æœº"></a>è£…æœº</h3><p><a href="https://lnmp.org/faq/lnmp-vhost-add-howto.html" target="_blank" rel="noopener">LNMPæ–‡æ¡£</a></p><h3 id="æ·»åŠ ã€åˆ é™¤è™šæ‹Ÿä¸»æœºä½¿ç”¨æ•™ç¨‹"><a href="#æ·»åŠ ã€åˆ é™¤è™šæ‹Ÿä¸»æœºä½¿ç”¨æ•™ç¨‹" class="headerlink" title="æ·»åŠ ã€åˆ é™¤è™šæ‹Ÿä¸»æœºä½¿ç”¨æ•™ç¨‹"></a>æ·»åŠ ã€åˆ é™¤è™šæ‹Ÿä¸»æœºä½¿ç”¨æ•™ç¨‹</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ </span></span><br><span class="line"><span class="comment"># å¦‚æœè¾“å…¥æœ‰é”™è¯¯éœ€è¦åˆ é™¤æ—¶ï¼Œå¯ä»¥æŒ‰ä½Ctrlå†æŒ‰Backspaceé”®è¿›è¡Œåˆ é™¤ã€‚</span></span><br><span class="line"><span class="attribute">lnmp</span> vhost add </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—è¡¨</span></span><br><span class="line">nmp vhost list</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ç½‘ç«™ä¼šå…ˆåˆ—å‡ºå½“å‰å·²æœ‰è™šæ‹Ÿä¸»æœºï¼ŒæŒ‰æç¤ºè¾“å…¥è¦åˆ é™¤çš„è™šæ‹Ÿä¸»æœºåŸŸå å›è½¦ç¡®è®¤ã€‚</span></span><br><span class="line"><span class="comment"># è¿™é‡Œåªæ˜¯åˆ é™¤è™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶ï¼Œç½‘ç«™æ–‡ä»¶å¹¶ä¸ä¼šåˆ é™¤éœ€è¦è‡ªå·±åˆ é™¤ã€‚</span></span><br><span class="line">lnmp vhost del</span><br></pre></td></tr></table></figure><h4 id="LNMPç›¸å…³è½¯ä»¶å®‰è£…ç›®å½•"><a href="#LNMPç›¸å…³è½¯ä»¶å®‰è£…ç›®å½•" class="headerlink" title="LNMPç›¸å…³è½¯ä»¶å®‰è£…ç›®å½•"></a>LNMPç›¸å…³è½¯ä»¶å®‰è£…ç›®å½•</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Nginx ç›®å½•</span></span><br><span class="line">/usr/local/nginx/</span><br><span class="line"><span class="comment"># é»˜è®¤ç½‘ç«™ç›®å½• : 0.9ç‰ˆæœ¬ä¸º </span></span><br><span class="line">/home/wwwroot/</span><br><span class="line"><span class="comment">#1.0åŠä»¥åç‰ˆæœ¬ä¸º </span></span><br><span class="line">/home/wwwroot/default/</span><br><span class="line"><span class="comment"># Nginxæ—¥å¿—ç›®å½•</span></span><br><span class="line">/home/wwwlogs/</span><br></pre></td></tr></table></figure><h4 id="LNMPç›¸å…³é…ç½®æ–‡ä»¶ä½ç½®"><a href="#LNMPç›¸å…³é…ç½®æ–‡ä»¶ä½ç½®" class="headerlink" title="LNMPç›¸å…³é…ç½®æ–‡ä»¶ä½ç½®"></a>LNMPç›¸å…³é…ç½®æ–‡ä»¶ä½ç½®</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Nginxä¸»é…ç½®(é»˜è®¤è™šæ‹Ÿä¸»æœº)æ–‡ä»¶</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line"># è™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;vhost&#x2F;åŸŸå.conf</span><br><span class="line"># MySQLé…ç½®æ–‡ä»¶</span><br><span class="line">&#x2F;etc&#x2F;my.cnf</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹linux-root-åé¢çš„åˆ«å"><a href="#ä¿®æ”¹linux-root-åé¢çš„åˆ«å" class="headerlink" title="ä¿®æ”¹linux root@åé¢çš„åˆ«å"></a>ä¿®æ”¹linux root@åé¢çš„åˆ«å</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi</span> /etc/hostname  <span class="comment"># é‡å¯æœåŠ¡å™¨</span></span><br></pre></td></tr></table></figure><h3 id="Operation-Not-Permitted-é”™è¯¯é—®é¢˜"><a href="#Operation-Not-Permitted-é”™è¯¯é—®é¢˜" class="headerlink" title="Operation Not Permitted é”™è¯¯é—®é¢˜"></a>Operation Not Permitted é”™è¯¯é—®é¢˜</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chattr</span> -i [name]</span><br><span class="line">rm -rf [name]</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…node"><a href="#å®‰è£…node" class="headerlink" title="å®‰è£…node"></a>å®‰è£…node</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install -y node </span><br><span class="line">node -v  <span class="comment"># v6.17.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰ˆæœ¬å‡çº§</span></span><br><span class="line">npm i -g n</span><br><span class="line">rm -rf /usr/bin/node</span><br><span class="line">n stable  <span class="comment"># æœ€ç¨³å®šçš„ç‰ˆæœ¬</span></span><br><span class="line">ln -s /usr/local/bin/node /usr/bin/node</span><br><span class="line">node -v  <span class="comment"># v12.14.0</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NodeJs æ’ä»¶æ‹“å±•</title>
      <link href="/2019/09/15/workspace/Server/node/node-2/"/>
      <url>/2019/09/15/workspace/Server/node/node-2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>NodeJs æ’ä»¶æ‹“å±•</strong></p><p>[[toc]]</p><h2 id="node-scheduleNodejså®šæ—¶ä»»åŠ¡"><a href="#node-scheduleNodejså®šæ—¶ä»»åŠ¡" class="headerlink" title="node-scheduleNodejså®šæ—¶ä»»åŠ¡"></a>node-scheduleNodejså®šæ—¶ä»»åŠ¡</h2><p><a href="https://github.com/node-schedule/node-schedule" target="_blank" rel="noopener">node-schedule</a>  Nodejså®šæ—¶ä»»åŠ¡</p><p><strong>å®‰è£…</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yarn add node-schedule -D</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨</strong></p><h3 id="Croné£æ ¼å®šæ—¶å™¨"><a href="#Croné£æ ¼å®šæ—¶å™¨" class="headerlink" title="Croné£æ ¼å®šæ—¶å™¨"></a>Croné£æ ¼å®šæ—¶å™¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> scheduleCronstyle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  schedule.scheduleJob(<span class="string">'1-59 * * * * *'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// sendEmail();</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">11</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">scheduleCronstyle();</span><br></pre></td></tr></table></figure><p>6ä¸ªå ä½ç¬¦ä»å·¦åˆ°å³åˆ†åˆ«ä»£è¡¨ï¼š<code>ç§’ã€åˆ†ã€æ—¶ã€æ—¥ã€æœˆã€å‘¨å‡ </code></p><p><code>*</code>è¡¨ç¤ºé€šé…ç¬¦ï¼ŒåŒ¹é…ä»»æ„ï¼Œå½“ç§’æ˜¯<code>*</code>æ—¶ï¼Œè¡¨ç¤ºä»»æ„ç§’æ•°éƒ½è§¦å‘ï¼Œå…¶å®ƒç±»æ¨</p><p>ä¸‹é¢å¯ä»¥çœ‹çœ‹ä»¥ä¸‹ä¼ å…¥å‚æ•°åˆ†åˆ«ä»£è¡¨çš„æ„æ€</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¯åˆ†é’Ÿçš„ç¬¬59ç§’è§¦å‘ï¼š &#39;59 * * * * *&#39;</span><br><span class="line">æ¯å°æ—¶çš„1åˆ†59ç§’è§¦å‘ ï¼š&#39;59 1 * * * *&#39;</span><br><span class="line">æ¯å¤©çš„å‡Œæ™¨1ç‚¹1åˆ†59ç§’è§¦å‘ ï¼š&#39;59 1 1 * * *&#39;</span><br><span class="line">æ¯æœˆçš„1æ—¥1ç‚¹1åˆ†59ç§’è§¦å‘ ï¼š&#39;59 1 1 1 * *&#39;</span><br><span class="line">2020å¹´çš„1æœˆ1æ—¥1ç‚¹1åˆ†59ç§’è§¦å‘ ï¼š&#39;59 1 1 1 2020 *&#39;</span><br><span class="line">æ¯å‘¨å¤©çš„1ç‚¹1åˆ†30ç§’è§¦å‘ ï¼š&#39;30 1 1 * * 0&#39;</span><br></pre></td></tr></table></figure><h3 id="åŸºäºæ—¥æœŸçš„è®¡åˆ’"><a href="#åŸºäºæ—¥æœŸçš„è®¡åˆ’" class="headerlink" title="åŸºäºæ—¥æœŸçš„è®¡åˆ’"></a>åŸºäºæ—¥æœŸçš„è®¡åˆ’</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> scheduleCronstyle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2020</span>, <span class="number">4</span>, <span class="number">26</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">const</span> j = schedule.scheduleJob(date, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'scheduleObjectLiteralSyntax:'</span> + <span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å¯¹è±¡æ–‡æœ¬è¯­æ³•å®šæ—¶å™¨"><a href="#å¯¹è±¡æ–‡æœ¬è¯­æ³•å®šæ—¶å™¨" class="headerlink" title="å¯¹è±¡æ–‡æœ¬è¯­æ³•å®šæ—¶å™¨"></a>å¯¹è±¡æ–‡æœ¬è¯­æ³•å®šæ—¶å™¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">second (0-59)</span><br><span class="line">minute (0-59)</span><br><span class="line">hour (0-23)</span><br><span class="line">date (1-31)</span><br><span class="line">month (0-11)</span><br><span class="line">year</span><br><span class="line">dayOfWeek (0-6) Starting with Sunday</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> scheduleCronstyle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// å‘¨æœ«çš„10ç‚¹11åˆ†</span></span><br><span class="line">  <span class="keyword">const</span> j = schedule.scheduleJob(&#123;<span class="attr">hour</span>: <span class="number">10</span>, <span class="attr">minute</span>: <span class="number">11</span>, <span class="attr">dayOfWeek</span>: <span class="number">0</span>&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hi å°å“¥æ˜å¤©è¯¥ä¸Šç­äº†å•Š:'</span> + <span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´"><a href="#è®¾ç½®å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´" class="headerlink" title="è®¾ç½®å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´"></a>è®¾ç½®å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 5ç§’åè¿è¡Œï¼Œå¹¶åœ¨10ç§’ååœæ­¢</span></span><br><span class="line"><span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.now() + <span class="number">5000</span>);</span><br><span class="line"><span class="keyword">let</span> endTime = <span class="keyword">new</span> <span class="built_in">Date</span>(startTime.getTime() + <span class="number">5000</span>);</span><br><span class="line"><span class="keyword">var</span> j = schedule.scheduleJob(&#123; <span class="attr">start</span>: startTime, <span class="attr">end</span>: endTime, <span class="attr">rule</span>: <span class="string">'*/1 * * * * *'</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Time for tea!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="å–æ¶ˆå®šæ—¶å™¨"><a href="#å–æ¶ˆå®šæ—¶å™¨" class="headerlink" title="å–æ¶ˆå®šæ—¶å™¨"></a>å–æ¶ˆå®šæ—¶å™¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> scheduleCronstyle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// å‘¨æœ«çš„10ç‚¹11åˆ†</span></span><br><span class="line">  <span class="keyword">const</span> j = schedule.scheduleJob(&#123;<span class="attr">hour</span>: <span class="number">10</span>, <span class="attr">minute</span>: <span class="number">11</span>, <span class="attr">dayOfWeek</span>: <span class="number">0</span>&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hi å°å“¥æ˜å¤©è¯¥ä¸Šç­äº†å•Š:'</span> + <span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å®šæ—¶å™¨å–æ¶ˆ'</span>);</span><br><span class="line">    <span class="comment">// å®šæ—¶å™¨å–æ¶ˆ</span></span><br><span class="line">    j.cancel();</span><br><span class="line">  &#125;, <span class="number">5000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å†™åœ¨ä¹‹å</strong></p><p>å®šæ—¶å™¨åŠŸèƒ½å¤§éƒ¨åˆ†éœ€æ±‚éƒ½å¯ä»¥å€ŸåŠ©<code>node-schedule</code>å®Œæˆäº†ï¼Œç”¨å®ƒåœ¨é¡¹ç›®ä¸­ä½¿ç”¨æ•ˆæœä¹Ÿä¸é”™ï¼Œå„ç§éœ€æ±‚å¯ä»¥æ»¡è¶³^_^!</p><h2 id="qrcode-terminalåœ¨ç»ˆç«¯è¾“å‡ºäºŒç»´ç "><a href="#qrcode-terminalåœ¨ç»ˆç«¯è¾“å‡ºäºŒç»´ç " class="headerlink" title="qrcode-terminalåœ¨ç»ˆç«¯è¾“å‡ºäºŒç»´ç "></a>qrcode-terminalåœ¨ç»ˆç«¯è¾“å‡ºäºŒç»´ç </h2><p><a href="https://github.com/gtanner/qrcode-terminal" target="_blank" rel="noopener">qrcode-terminal</a>åœ¨ç»ˆç«¯è¾“å‡ºäºŒç»´ç </p><p><strong>å®‰è£…</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yarn add qrcode-terminal -D</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> qrcode = <span class="built_in">require</span>(<span class="string">'qrcode-terminal'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'http://www.jing999.cn'</span>;</span><br><span class="line">qrcode.generate(url);</span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ªå‚æ•° &#123;small:true&#125; ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å›è°ƒ</span></span><br></pre></td></tr></table></figure><h2 id="nodeçˆ¬è™«"><a href="#nodeçˆ¬è™«" class="headerlink" title="nodeçˆ¬è™«"></a>nodeçˆ¬è™«</h2><h3 id="superagent-axios-node-fetch-è¯·æ±‚æ•°æ®"><a href="#superagent-axios-node-fetch-è¯·æ±‚æ•°æ®" class="headerlink" title="superagent / axios / node-fetch  è¯·æ±‚æ•°æ®"></a>superagent / axios / node-fetch  è¯·æ±‚æ•°æ®</h3><blockquote><p><strong>superagent</strong> æ‹“å±•æ€§å¼ºï¼ŒåŒæ—¶æ”¯æŒ Node.js å’Œæµè§ˆå™¨ï¼Œé€šè¿‡æ„å»ºæ’ä»¶å¯ä»¥å®ç°æ›´å¤šåŠŸèƒ½ ï¼›ç¼ºç‚¹ï¼šå…¶ API ä¸ç¬¦åˆä»»ä½•æ ‡å‡†<br/><br><strong>axios</strong> æ”¯æŒ Promise APIï¼ŒåŒæ—¶æ”¯æŒ Node.js å’Œæµè§ˆå™¨<br/><br><strong>node-fetch</strong> è½»é‡çº§çš„æ¨¡å—,ä¸window.fetchAPI ä¿æŒä¸€è‡´ï¼Œåœ¨nodeJsä¸­ä½¿ç”¨</p></blockquote><h3 id="cheerio"><a href="#cheerio" class="headerlink" title="cheerio"></a>cheerio</h3><p><a href="https://cheerio.js.org/" target="_blank" rel="noopener">cheerio</a> å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªNode.jsç‰ˆæœ¬çš„jquery</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</span><br><span class="line"><span class="keyword">let</span> $ = cheerio.load(<span class="string">"&lt;div id='helloworld'&gt;hello world&lt;/div&gt;"</span>, &#123;<span class="attr">ignoreWhitespace</span>: <span class="literal">true</span>...&#125;)</span><br></pre></td></tr></table></figure><h4 id="é€‰æ‹©å™¨"><a href="#é€‰æ‹©å™¨" class="headerlink" title="é€‰æ‹©å™¨"></a>é€‰æ‹©å™¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; å±æ€§æ“ä½œ</span><br><span class="line">.attr(name, value)</span><br><span class="line">.removeAtrr(name)</span><br><span class="line">.hasClass(className)</span><br><span class="line">.addClass(className)</span><br><span class="line">.remoteClass([className])</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; éå†</span><br><span class="line">.find(selector)</span><br><span class="line">.parent()</span><br><span class="line">.next()</span><br><span class="line">.prev()</span><br><span class="line">.siblings()</span><br><span class="line">.children( selector )</span><br><span class="line">.each( function(index, element) )</span><br><span class="line">.map( function(index, element) )</span><br><span class="line">.filter( selector )</span><br><span class="line">.filter( function(index) )</span><br><span class="line">.first()</span><br><span class="line">.last()</span><br><span class="line">.eq(i)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; æ“ä½œDOM</span><br><span class="line">.append( content, [content, ...] )</span><br><span class="line">.prepend( content, [content, ...] )</span><br><span class="line">.after( content, [content, ...] )</span><br><span class="line">.before( content, [content, ...] )</span><br><span class="line">.remove( [selector] )</span><br><span class="line">.replaceWith( content )</span><br><span class="line">.empty()</span><br><span class="line">.html( [htmlString] )</span><br><span class="line">.text( [textString] )</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å…¶ä»–</span><br><span class="line">$.html()</span><br><span class="line">$(&#39;ul&#39;).text()</span><br><span class="line">.toArray()</span><br><span class="line">.clone()</span><br><span class="line">$.root()</span><br><span class="line">$.contains( container, contained )</span><br></pre></td></tr></table></figure><h3 id="iconv-lite"><a href="#iconv-lite" class="headerlink" title="iconv-lite"></a>iconv-lite</h3><p>æœ‰äº›æ—¶å€™,è·å–åˆ°çš„æ•°æ®æ˜¯ä¸€äº›ä¹±ç ,å°¤å…¶æ˜¯ä¸­æ–‡çš„æƒ…å†µ.æ‰€ä»¥æˆ‘ä»¬éœ€è¦è§£å†³ä¹±ç çš„é—®é¢˜,<code>iconv-lite</code>æ¨¡å—å°±å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜.</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">homeBody = iconv.decode(homeBody,<span class="string">"GBK"</span>); <span class="comment">//è¿›è¡Œgbkè§£ç </span></span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰ä¹±ç å°±åœ¨ <code>cheerio.load()</code>ä¹‹å‰è¿›è¡Œè§£ç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span> /&gt; <span class="comment">//è¿™é‡Œæ˜¯utf-8,å°±ä¸éœ€è¦è§£ç </span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é™æ€é¡µé¢ä¸Šé¢çš„æ“ä½œåŸºæœ¬ä¸Šå°±å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯ç°å®ä¸­æ¯•ç«Ÿéƒ½æ˜¯spa å¤§è¡Œå…¶é“å¾ˆå¤šéƒ½ä¸æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ cheerio æ¨¡å—æ¥è§£æã€‚</p><h3 id="åŠ¨æ€é¡µé¢çˆ¬å–"><a href="#åŠ¨æ€é¡µé¢çˆ¬å–" class="headerlink" title="åŠ¨æ€é¡µé¢çˆ¬å–"></a>åŠ¨æ€é¡µé¢çˆ¬å–</h3><ul><li><p><strong>æ‰‹åŠ¨å¤åˆ¶body,ç”¨IDEæˆ–è€…nodeèµ·æœåŠ¡è¿›è¡Œçˆ¬å–ï¼ŒäººåŠ›æˆæœ¬æ¯”è¾ƒé«˜</strong></p></li><li><p><strong>æ‰¾åˆ°æ•°æ®æ¥å£,ç›´æ¥çˆ¬å»</strong>ï¼Œæœ‰çš„ç½‘é¡µæ‰“å¼€æ§åˆ¶å°å…¨éƒ¨æ˜¯debug,å¹¶ä¸èƒ½é«˜æ•ˆçš„æ‰¾åˆ°å¯¹åº”çš„æ•°æ®æ¥å£ <a href="https://blog.csdn.net/zhang6223284/article/details/80152368" target="_blank" rel="noopener">csdn</a></p></li><li><p><strong>æœ€è¿‘åˆšçœ‹åˆ°çš„ï¼Œ<a href="https://github.com/puppeteer/puppeteer" target="_blank" rel="noopener">puppeteer</a></strong> <a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&version=v3.0.1&show=api-class-puppeteer" target="_blank" rel="noopener">æ–‡æ¡£é“¾æ¥</a></p></li><li><p><strong>phantomjs è·Ÿä¸Šé¢çš„ç±»ä¼¼</strong></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> NodeJS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Nodeå¯åŠ¨å·¥å…·</title>
      <link href="/2019/09/15/workspace/Server/node/pm2/"/>
      <url>/2019/09/15/workspace/Server/node/pm2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Nodeå¯åŠ¨å·¥å…·</strong></p><p>[[toc]]</p><h3 id="nodemon"><a href="#nodemon" class="headerlink" title="nodemon"></a>nodemon</h3><p><strong>å¼€å‘ç¯å¢ƒç”¨</strong></p><h5 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h5><p>yarn global add  nodemon</p><h5 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h5><p>nodemon app.js</p><h3 id="pm2"><a href="#pm2" class="headerlink" title="pm2"></a>pm2</h3><h5 id="ä¸‹è½½-1"><a href="#ä¸‹è½½-1" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h5><p>yarn global add  pm2</p><h5 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h5><figure class="highlight"><table><tr><td class="code"><pre><span class="line">$ pm2 start app.js              # å¯åŠ¨app.jsåº”ç”¨ç¨‹åº</span><br><span class="line">$ pm2 start app.js -i 4         # cluster mode æ¨¡å¼å¯åŠ¨4ä¸ªapp.jsçš„åº”ç”¨å®ä¾‹    </span><br><span class="line">$ pm2 start app.js --name="api" # å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶å‘½åä¸º "api"</span><br><span class="line">$ pm2 start app.js --watch      # å½“æ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡å¯åº”ç”¨</span><br><span class="line">$ pm2 list  / pm2 ls            # åˆ—è¡¨ PM2 å¯åŠ¨çš„æ‰€æœ‰çš„åº”ç”¨ç¨‹åº</span><br><span class="line">$ pm2 logs                      # æ˜¾ç¤ºæ‰€æœ‰åº”ç”¨ç¨‹åºçš„æ—¥å¿—</span><br><span class="line">$ pm2 logs [app-name|id]        # æ˜¾ç¤ºæŒ‡å®šåº”ç”¨ç¨‹åºçš„æ—¥å¿—</span><br><span class="line">$ pm2 stop all                  # åœæ­¢æ‰€æœ‰çš„åº”ç”¨ç¨‹åº</span><br><span class="line">$ pm2 stop 0                    # åœæ­¢ idä¸º 0çš„æŒ‡å®šåº”ç”¨ç¨‹åº</span><br><span class="line">$ pm2 restart all               # é‡å¯æ‰€æœ‰åº”ç”¨</span><br><span class="line">$ pm2 delete all                # å…³é—­å¹¶åˆ é™¤æ‰€æœ‰åº”ç”¨</span><br><span class="line">$ pm2 delete 0                  # åˆ é™¤æŒ‡å®šåº”ç”¨ id 0</span><br></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹æ—¥å¿—"><a href="#æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—"></a>æŸ¥çœ‹æ—¥å¿—</h5><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> /root/.pm2/logs</span><br><span class="line"></span><br><span class="line">pm2 log id</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> NodeJS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Github API è°ƒç”¨</title>
      <link href="/2019/07/19/workspace/Git/github/"/>
      <url>/2019/07/19/workspace/Git/github/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Github API è°ƒç”¨</strong></p><p>[[toc]]</p><h3 id="åŸºæœ¬è®¿é—®"><a href="#åŸºæœ¬è®¿é—®" class="headerlink" title="åŸºæœ¬è®¿é—®"></a>åŸºæœ¬è®¿é—®</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">curl https:<span class="comment">//api.github.com/users/hzfvictory</span></span><br></pre></td></tr></table></figure><ul><li>ä¸ªäººä¸»è¦ä¿¡æ¯<code>https://api.github.com/users/ç”¨æˆ·å</code></li><li>ä¸ªäººæ‰€æœ‰repoã€‚<code>https://api.github.com/users/ç”¨æˆ·å/repos</code>ã€‚ä¼šå¾—åˆ°ä¸€ä¸ªrepoçš„JSONæ ¼å¼åˆ—è¡¨ã€‚</li><li>repoè¯¦ç»†ä¿¡æ¯ã€‚<code>https://api.github.com/repos/ç”¨æˆ·å/ä»“åº“å</code>ã€‚repoçš„è·¯å¾„å°±å¼€å§‹å’Œä¸ªäººä¿¡æ¯ä¸åŒäº†ã€‚</li><li>è·å–æŸæ–‡ä»¶çš„åŸå§‹å†…å®¹ï¼ˆRawï¼‰ã€‚<ul><li>é€šè¿‡ä¸Šé¢çš„æ–‡ä»¶ä¿¡æ¯ä¸­æå–download_urlè¿™æ¡é“¾æ¥ï¼Œå°±èƒ½è·å–å®ƒçš„åŸå§‹å†…å®¹äº†ã€‚</li><li>æˆ–è€…ç›´æ¥è®¿é—®ï¼š<code>https://raw.githubusercontent.com/ç”¨æˆ·å/ä»“åº“å/åˆ†æ”¯å/æ–‡ä»¶è·¯å¾„</code></li></ul></li><li><strong>repoä¸­æ‰€æœ‰çš„commitsåˆ—è¡¨ã€‚<code>https://api.github.com/repos/ç”¨æˆ·å/ä»“åº“å/commits</code>ã€‚</strong></li><li>æŸä¸€æ¡commitè¯¦æƒ…ã€‚<code>https://api.github.com/repos/ç”¨æˆ·å/ä»“åº“å/commits/æŸä¸€æ¡commitçš„SHA</code></li><li><strong>issuesåˆ—è¡¨ã€‚<code>https://api.github.com/repos/ç”¨æˆ·å/ä»“åº“å/issues</code>ã€‚</strong></li><li>æŸæ¡issueè¯¦æƒ…ã€‚<code>https://api.github.com/repos/ç”¨æˆ·å/ä»“åº“å/issues/åºå·</code>ã€‚issueséƒ½æ˜¯ä»¥1,2,3è¿™æ ·çš„åºåˆ—æ’å·çš„ã€‚</li><li><strong>æŸissueä¸­çš„commentsåˆ—è¡¨ã€‚<code>https://api.github.com/repos/ç”¨æˆ·å/ä»“åº“å/issues/åºå·/comments</code>ã€‚</strong></li><li>æŸcommentè¯¦æƒ…ã€‚<code>https://api.github.com/repos/ç”¨æˆ·å/ä»“åº“å/issues/comments/è¯„è®ºè¯¦æƒ…çš„ID</code>ã€‚å…¶ä¸­è¯„è®ºIDæ˜¯ä»issuesåˆ—è¡¨ä¸­è·å¾—çš„ã€‚</li></ul><h3 id="æŸ¥è¯¢å‚æ•°"><a href="#æŸ¥è¯¢å‚æ•°" class="headerlink" title="æŸ¥è¯¢å‚æ•°"></a>æŸ¥è¯¢å‚æ•°</h3><ul><li>åˆ†é¡µåŠŸèƒ½ã€‚æ ¼å¼æ˜¯<code>?page=é¡µæ•°&amp;per_page=æ¯é¡µåŒ…å«æ•°é‡</code>ã€‚</li><li>issuesçŠ¶æ€ã€‚æ ¼å¼æ˜¯<code>?state=çŠ¶æ€</code>ã€‚</li></ul><h3 id="æƒé™è®¤è¯-Authentication"><a href="#æƒé™è®¤è¯-Authentication" class="headerlink" title="æƒé™è®¤è¯ Authentication"></a>æƒé™è®¤è¯ Authentication</h3><p>æˆ‘çš„é¡¹ç›®ä¸€èˆ¬ç§æœ‰çš„ï¼Œç›´æ¥è·å–æ²¡æœ‰æƒé™ï¼Œéœ€è¦æ·»åŠ token</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H0fec58c800544c24b103e00bf3f4e82aY.png" alt=""></p><p><strong>1.ç›´æ¥ä½œä¸ºurlä¸­çš„å‚æ•°ä¼ è¾“</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">curl https:<span class="comment">//api.github.com/?access_token=OAUTH-TOKEN</span></span><br></pre></td></tr></table></figure><p><strong>2.ä½œä¸ºheaderä¸­çš„å‚æ•°ä¼ è¾“</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">curl -H <span class="string">"Authorization: token OAUTH-TOKEN"</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fetch(<span class="string">`https://api.github.com/repos/hzfvictory/file/commits?per_page=15&amp;sha=develop`</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        method: <span class="string">'GET'</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">            <span class="string">'Authorization'</span>: <span class="string">'token OAUTH-TOKEN'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">        <span class="keyword">this</span>.show = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span> response.json();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'æ¥å£è°ƒå–å¤±è´¥ï¼'</span>);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://segmentfault.com/a/1190000015144126" target="_blank" rel="noopener">Github Api</a></p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElectronåŸºç¡€</title>
      <link href="/2019/07/16/workspace/Electron/base/"/>
      <url>/2019/07/16/workspace/Electron/base/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ElectronåŸºç¡€</strong></p><p>[[toc]]</p><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p><code>â€‹Electron æ˜¯ä¸€ä¸ªç”± GitHub å¼€å‘çš„å¼€æºåº“ï¼Œé€šè¿‡å°† Chromium) å’ŒNode.js ç»„åˆå¹¶ä½¿ç”¨ HTMLï¼ŒCSS å’Œ JavaScript è¿›è¡Œæ„å»º Macï¼ŒWindowsï¼Œå’Œ Linux è·¨å¹³å°æ¡Œé¢åº”ç”¨ç¨‹åºã€‚</code></p><p><strong>ä¼˜ç‚¹:</strong></p><p>æ–¹ä¾¿å¿«æ·çš„å¼€å‘æ¡Œé¢åº”ç”¨ï¼Œè·¨å¹³å°ï¼Œå¯¹å‰ç«¯å¼€å‘è€…å‹å¥½ï¼Œæ´»è·ƒçš„ç¤¾åŒºï¼Œä¸°å¯Œçš„apiâ€¦â€¦</p><p><strong>ç¼ºç‚¹:</strong></p><p>æ€§èƒ½è‚¯å®šæ¯”ä¸ä¸ŠåŸç”Ÿçš„æ¡Œé¢åº”ç”¨ï¼Œå‘å¸ƒçš„åŒ…å¾ˆå¤§ã€‚ï¼ˆDeskGapè¿™ä¸ªä¸å¸¦æµè§ˆå™¨çš„åŠŸèƒ½ï¼ŒåŒ…æ¯”è¾ƒå°ï¼‰</p><h3 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h3><p><strong>1.electron-react-boilerplate</strong></p><p><a href="https://github.com/electron-react-boilerplate/electron-react-boilerplate" target="_blank" rel="noopener">star~13000</a></p><p><strong>2.</strong> ä½¿ç”¨è„šæ‰‹æ¶<code>electron-forge</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å…¨å±€å®‰è£…è„šæ‰‹æ¶</span></span><br><span class="line">yarn global add @electron-forge/cli</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–é¡¹ç›®</span></span><br><span class="line">yarn create electron-app my-app</span><br></pre></td></tr></table></figure><p><strong>3.</strong> è‡ªå·±æ­å»º</p><ul><li><p>æ–°å»ºmain.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: hzf;</span></span><br><span class="line"><span class="comment"> * Date: 2019-08-08 13:57;</span></span><br><span class="line"><span class="comment"> * Description:ä¸»è¿›ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">'electron'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;app, BrowserWindow&#125; = electron;</span><br><span class="line"><span class="comment">//ä¿æŒå¯¹windowå¯¹è±¡çš„å…¨å±€å¼•ç”¨</span></span><br><span class="line"><span class="comment">// åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œwindowå¯¹è±¡å°†ä¼šè‡ªåŠ¨çš„å…³é—­</span></span><br><span class="line"><span class="keyword">let</span> win;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createWindow = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæµè§ˆå™¨çª—å£</span></span><br><span class="line">    win = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">        width: <span class="number">800</span>,</span><br><span class="line">        height: <span class="number">600</span>,</span><br><span class="line">        webPreferences: &#123;</span><br><span class="line">            preload: path.join(__dirname, <span class="string">'preload.js'</span>),</span><br><span class="line">            nodeIntegration: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// åŠ è½½index.htmlæ–‡ä»¶</span></span><br><span class="line">    win.loadFile(<span class="string">'index.html'</span>);</span><br><span class="line">    <span class="comment">// æ‰“å¼€å¼€å‘è€…å·¥å…·</span></span><br><span class="line">    win.webContents.openDevTools();</span><br><span class="line">    <span class="comment">// å½“ window è¢«å…³é—­ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè¢«è§¦å‘ã€‚</span></span><br><span class="line">    win.on(<span class="string">'closed'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="comment">// å–æ¶ˆå¼•ç”¨ window å¯¹è±¡ï¼Œå¦‚æœä½ çš„åº”ç”¨æ”¯æŒå¤šçª—å£çš„è¯ï¼Œ</span></span><br><span class="line">        <span class="comment">// é€šå¸¸ä¼šæŠŠå¤šä¸ª window å¯¹è±¡å­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œé¢ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä¸æ­¤åŒæ—¶ï¼Œä½ åº”è¯¥åˆ é™¤ç›¸åº”çš„å…ƒç´ ã€‚</span></span><br><span class="line">        win = <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Electron ä¼šåœ¨åˆå§‹åŒ–åå¹¶å‡†å¤‡</span></span><br><span class="line"><span class="comment">// åˆ›å»ºæµè§ˆå™¨çª—å£æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">// éƒ¨åˆ† API åœ¨ ready äº‹ä»¶è§¦å‘åæ‰èƒ½ä½¿ç”¨ã€‚</span></span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'ready'</span>, createWindow);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å…¨éƒ¨çª—å£å…³é—­æ—¶é€€å‡ºã€‚</span></span><br><span class="line">app.on(<span class="string">'window-all-closed'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// åœ¨ macOS ä¸Šï¼Œé™¤éç”¨æˆ·ç”¨ Cmd + Q ç¡®å®šåœ°é€€å‡ºï¼Œ</span></span><br><span class="line">    <span class="comment">// å¦åˆ™ç»å¤§éƒ¨åˆ†åº”ç”¨åŠå…¶èœå•æ ä¼šä¿æŒæ¿€æ´»ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (process.platform !== <span class="string">'darwin'</span>) app.quit()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'activate'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// åœ¨macOSä¸Šï¼Œå½“å•å‡»dockå›¾æ ‡å¹¶ä¸”æ²¡æœ‰å…¶ä»–çª—å£æ‰“å¼€æ—¶ï¼Œ</span></span><br><span class="line">    <span class="comment">// é€šå¸¸åœ¨åº”ç”¨ç¨‹åºä¸­é‡æ–°åˆ›å»ºä¸€ä¸ªçª—å£ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (win === <span class="literal">null</span>) createWindow()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºindex.html</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ¸²æŸ“è¿›ç¨‹</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"zh-Hans-CN"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Hello!&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>åˆå§‹åŒ–git </p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm init -y</span><br><span class="line"><span class="comment">//electron è¿è¡Œ package.json çš„ main è„šæœ¬çš„è¿›ç¨‹è¢«ç§°ä¸ºä¸»è¿›ç¨‹ã€‚ åœ¨ä¸»è¿›ç¨‹ä¸­è¿è¡Œçš„è„šæœ¬é€šè¿‡åˆ›å»ºwebé¡µé¢æ¥å±•ç¤ºç”¨æˆ·ç•Œé¢ã€‚</span></span><br><span class="line"><span class="comment">// ä¸€ä¸ª Electron åº”ç”¨æ€»æ˜¯æœ‰ä¸”åªæœ‰ä¸€ä¸ªä¸»è¿›ç¨‹ã€‚</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"electron"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"main.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"electron ."</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"keywords"</span>: [],</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"electron"</span>: <span class="string">"^6.0.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½index.htmlæ–‡ä»¶</span></span><br><span class="line">win.loadFile(path.join(__dirname, <span class="string">'index.html'</span>));</span><br><span class="line"><span class="comment">//åŠ è½½URL</span></span><br><span class="line">win.loadURL(<span class="string">'http://music.migu.cn/'</span>);</span><br><span class="line"><span class="comment">//æ‰“å¼€å¼€å‘è€…å·¥å…·</span></span><br><span class="line">win.webContents.openDevTools();</span><br><span class="line"><span class="comment">//å…³é—­å¼€å‘è€…å·¥å…·</span></span><br><span class="line">win.webContents.closeDevTools();</span><br></pre></td></tr></table></figure><h3 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h3><p><code>devDependenciesä¸dependenciesçš„åŒºåˆ«</code></p><p><code>dependencies</code> è¡¨ç¤ºæˆ‘ä»¬è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨è¯¥ä¾èµ–ï¼Œ<code>devDependencies</code> åˆ™è¡¨ç¤ºæˆ‘ä»¬ä»…åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨è¯¥ä¾èµ–ã€‚<br>åœ¨æ‰“åŒ…æ—¶ï¼Œä¸€å®šè¦åˆ†æ¸…å“ªäº›åŒ…å±äºç”Ÿäº§ä¾èµ–ï¼Œå“ªäº›å±äºå¼€å‘ä¾èµ–ï¼Œå°¤å…¶æ˜¯åœ¨é¡¹ç›®è¾ƒå¤§ï¼Œä¾èµ–åŒ…è¾ƒå¤šçš„æƒ…å†µä¸‹ã€‚<br>è‹¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹é”™åº”æˆ–è€…å°‘å¼•ä¾èµ–åŒ…ï¼Œå³ä¾¿æ˜¯æˆåŠŸæ‰“åŒ…ï¼Œä½†åœ¨ä½¿ç”¨åº”ç”¨ç¨‹åºæœŸé—´ä¹Ÿä¼šæŠ¥é”™ï¼Œå¯¼è‡´æ‰“åŒ…å¥½çš„ç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Electron </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>FlutteråŸºç¡€</title>
      <link href="/2019/07/16/workspace/Flutter/base/"/>
      <url>/2019/07/16/workspace/Flutter/base/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>FlutteråŸºç¡€</strong></p><p>[[toc]]</p><h3 id="å¾…æ€»ç»“"><a href="#å¾…æ€»ç»“" class="headerlink" title="å¾…æ€»ç»“"></a>å¾…æ€»ç»“</h3>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Taroä¸€äº›é…ç½®</title>
      <link href="/2019/07/01/workspace/Frame/taro/taroAdvanced/"/>
      <url>/2019/07/01/workspace/Frame/taro/taroAdvanced/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Taroä¸€äº›é…ç½®</strong></p><p>[[toc]]</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*è·å–å½“å‰é¡µurl*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCurrentPageUrl = (): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.TARO_ENV === <span class="string">'h5'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">window</span>.location.pathname</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> pages = Taro.getCurrentPages();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (process.env.TARO_ENV === <span class="string">'tt'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> pages[pages.length - <span class="number">1</span>][<span class="string">'__route__'</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> currentPage = pages[pages.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> currentPage.route;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*åŸºäºPromiseäºŒæ¬¡å°è£…Taro.request*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Taro <span class="keyword">from</span> <span class="string">'@tarojs/taro'</span></span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span></span><br><span class="line"><span class="keyword">import</span> &#123;BASE_URL, HTTP_ERROR&#125; <span class="keyword">from</span> <span class="string">"./config.default"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;getCurrentPageUrl&#125; <span class="keyword">from</span> <span class="string">"../utils/common"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  request(options: <span class="built_in">any</span>, method?: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;url, data&#125; = options;</span><br><span class="line">    <span class="keyword">let</span> contentType = <span class="string">"application/json"</span>;</span><br><span class="line">    contentType = options.contentType || contentType;</span><br><span class="line">    <span class="comment">//åŸºäºPromiseäºŒæ¬¡å°è£…ï¼Œæ–¹ä¾¿ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> params: <span class="built_in">any</span> = &#123;</span><br><span class="line">        url: <span class="string">`<span class="subst">$&#123;BASE_URL&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>,</span><br><span class="line">        data: data,</span><br><span class="line">        method: method || <span class="string">'GET'</span>,</span><br><span class="line">        header: &#123;</span><br><span class="line">          <span class="string">'content-type'</span>: contentType,</span><br><span class="line">          <span class="string">'Authorization'</span>: Taro.getStorageSync(<span class="string">"Authorization"</span>),</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      Taro.request(params).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;statusCode, data&#125; = res;</span><br><span class="line">        <span class="keyword">if</span> (statusCode &gt;= <span class="number">200</span> &amp;&amp; statusCode &lt; <span class="number">300</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> resolve(data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (statusCode === <span class="number">401</span>) &#123;</span><br><span class="line">            Taro.setStorageSync(<span class="string">"Authorization"</span>, <span class="string">""</span>);</span><br><span class="line">            <span class="keyword">let</span> path = getCurrentPageUrl();</span><br><span class="line">            <span class="keyword">if</span> (path !== <span class="string">"pages/login/login"</span>) &#123;</span><br><span class="line">              Taro.navigateTo(&#123;</span><br><span class="line">                url: <span class="string">"/pages/login/login"</span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(HTTP_ERROR[statusCode]);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        reject(<span class="string">'æœåŠ¡å™¨æ­£åœ¨ç»´æŠ¤ä¸­!'</span>);</span><br><span class="line">        <span class="keyword">if</span> (err.msg) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'æœåŠ¡å™¨æ­£åœ¨ç»´æŠ¤ä¸­!'</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">get</span>(url: <span class="built_in">String</span>, data: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;url, data&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.request(params)</span><br><span class="line">  &#125;,</span><br><span class="line">  post(url: <span class="built_in">String</span>, data: <span class="built_in">any</span>) &#123;</span><br><span class="line">    data = qs.stringify(data);</span><br><span class="line">    <span class="keyword">const</span> params = &#123;url, data&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.request(params, <span class="string">'POST'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  put(url: <span class="built_in">String</span>, data: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;url, data&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.request(params, <span class="string">'PUT'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">delete</span>(url: <span class="built_in">String</span>, data: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;url, data&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.request(params, <span class="string">'DELETE'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*è·¯ç”±çš„è·³è½¬*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> jumpUrl = <span class="function">(<span class="params">url: <span class="built_in">string</span>, options = &#123;&#125; <span class="keyword">as</span> IOptions</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> pages: <span class="built_in">any</span>[] = [];</span><br><span class="line">    <span class="keyword">if</span> (process.env.TARO_ENV !== <span class="string">'h5'</span>) &#123;</span><br><span class="line">        pages = Taro.getCurrentPages();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> method = options.method || <span class="string">'navigateTo'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> tabList = [</span><br><span class="line">        <span class="string">'pages/functionArea/index'</span>,</span><br><span class="line">        <span class="string">'pages/personCenter/index'</span>,</span><br><span class="line">        <span class="string">'pages/message/index'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (url) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tabList.findIndex(<span class="function"><span class="params">x</span> =&gt;</span> <span class="string">'/'</span> + x == url) != <span class="number">-1</span>) &#123;</span><br><span class="line">            Taro[<span class="string">'switchTab'</span>](&#123;</span><br><span class="line">                url</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">'navigateTo'</span> &amp;&amp; pages.length === PAGE_LEVEL_LIMIT) &#123;</span><br><span class="line">            Taro[<span class="string">'redirectTo'</span>](&#123;</span><br><span class="line">                url</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">'redirectTo'</span>) &#123;</span><br><span class="line">            Taro[<span class="string">'redirectTo'</span>](&#123;</span><br><span class="line">                url</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Taro[<span class="string">'navigateTo'</span>](&#123;</span><br><span class="line">                url</span><br><span class="line">            &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">let</span> page: <span class="built_in">any</span> = Taro.getCurrentPages().pop();</span><br><span class="line">              <span class="keyword">if</span> (page === <span class="literal">undefined</span> || page === <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">              page.onLoad()</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Taro </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TaroåŸºæœ¬ç”¨æ³•</title>
      <link href="/2019/07/01/workspace/Frame/taro/taroBase/"/>
      <url>/2019/07/01/workspace/Frame/taro/taroBase/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>TaroåŸºæœ¬ç”¨æ³•</strong></p><p>[[toc]]</p><h3 id="å¸¸ç”¨çš„å°æ–¹æ³•"><a href="#å¸¸ç”¨çš„å°æ–¹æ³•" class="headerlink" title="å¸¸ç”¨çš„å°æ–¹æ³•"></a>å¸¸ç”¨çš„å°æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;è¿è¡Œæ—¶çš„å°ºå¯¸è½¬æ¢</span><br><span class="line">Taro.pxTransform(10) &#x2F;&#x2F; å°ç¨‹åºï¼šrpxï¼ŒH5ï¼šrem</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;tabbarå³ä¸Šè§’çš„æ•°å­—</span><br><span class="line">Taro.setTabBarBadge(&#123;</span><br><span class="line">    index: 0,</span><br><span class="line">    text: &#39;1&#39;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å¼¹æ¡†</span><br><span class="line"> Taro.showToast(&#123;</span><br><span class="line">    title: &#39;æˆåŠŸ&#39;,</span><br><span class="line">    icon: &#39;loading&#39;,</span><br><span class="line">    duration: 2000</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;loadingå›¾</span><br><span class="line">Taro.showLoading(&#123;</span><br><span class="line">    title: &#39;åŠ è½½ä¸­...&#39;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; æ‰“ç”µè¯</span><br><span class="line">Taro.makePhoneCall(&#123;</span><br><span class="line">    phoneNumber: &#39;18331883557&#39;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å±å¹•æœ€äº® 0-1</span><br><span class="line">Taro.setScreenBrightness(&#123;</span><br><span class="line">    value: 1</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; éœ‡åŠ¨</span><br><span class="line">Taro.vibrateShort() &#x2F; Taro.vibrateLong()</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å¼¹æ¡†</span><br><span class="line">Taro.showToast(&#123;</span><br><span class="line">    title: &#39;æˆåŠŸ&#39;,</span><br><span class="line">    icon: &#39;success&#39;,</span><br><span class="line">    duration: 2000</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;åŠ¨æ€ä¿®æ”¹title</span><br><span class="line">Taro.setNavigationBarTitle(&#123;</span><br><span class="line">    title: &#39;å½“å‰é¡µé¢&#39;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;åº•éƒ¨å¯¹è¯æ¡†</span><br><span class="line">Taro.showActionSheet(&#123;</span><br><span class="line">     itemList: [&quot;ä¸æ„Ÿå…´è¶£&quot;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ç‚¹å‡»tabbar,ä»…weappæ”¯æŒ</span><br><span class="line">onTabItemTap(res) &#123;</span><br><span class="line">    console.log(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åˆ·æ–°äº‹ä»¶</span><br><span class="line">onPullDownRefresh() </span><br><span class="line">éœ€è¦åœ¨å…¨å±€é…ç½®çš„ window é€‰é¡¹ä¸­æˆ–é¡µé¢é…ç½®ä¸­å¼€å¯ enablePullDownRefresh</span><br><span class="line">Taro.startPullDownRefresh()&#x2F;&#x2F;è§¦å‘ä¸‹æ‹‰åˆ·æ–°</span><br><span class="line">Taro.stopPullDownRefresh()  &#x2F;&#x2F;åœæ­¢å½“å‰é¡µé¢çš„ä¸‹æ‹‰åˆ·æ–°</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ä¸Šæ‹‰åŠ è½½</span><br><span class="line">onReachBottom()  </span><br><span class="line">å¯ä»¥åœ¨å…¨å±€é…ç½®çš„ window é€‰é¡¹ä¸­æˆ–é¡µé¢é…ç½®ä¸­è®¾ç½®è§¦å‘è·ç¦» onReachBottomDistance</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ç›‘å¬ç”¨æˆ·æ»‘åŠ¨é¡µé¢äº‹ä»¶</span><br><span class="line">onPageScroll(res)&#123;</span><br><span class="line">   console.log(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;æ»šå®šåˆ°é¡¶éƒ¨</span><br><span class="line">Taro.pageScrollTo(&#123;</span><br><span class="line">     scrollTop: 0</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;è½¬å‘æŒ‰é’®</span><br><span class="line">onShareAppMessage(res) &#123;</span><br><span class="line">  if (res.from &#x3D;&#x3D;&#x3D; &#39;button&#39;) &#123;</span><br><span class="line">        &#x2F;&#x2F; æ¥è‡ªé¡µé¢å†…è½¬å‘æŒ‰é’®</span><br><span class="line">        console.log(res.target)</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;imageUrl:&#39;https:&#x2F;&#x2F;storage.360buyimg.com&#x2F;mtd&#x2F;home&#x2F;111543234387022.jpg&#39;</span><br><span class="line">    return &#123;</span><br><span class="line">        title: &#39;å·¥ä½œå°&#39;,</span><br><span class="line">        path: &#39;&#x2F;pages&#x2F;functionArea&#x2F;index&#39;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; é¡µé¢å†…éƒ¨è½¬å‘</span><br><span class="line">&lt;Button open-type&#x3D;&quot;share&quot; onClick&#x3D;&#123;this.onShareAppMessage&#125;&gt;åˆ†äº«&lt;&#x2F;Button&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;è·å–ç³»ç»Ÿä¿¡æ¯åŒæ­¥æ¥å£ã€‚</span><br><span class="line">const res &#x3D; Taro.getSystemInfoSync()</span><br><span class="line">console.log(res.model)&#x2F;&#x2F;æ‰‹æœºå‹å·</span><br><span class="line">console.log(res.pixelRatio)&#x2F;&#x2F;è®¾å¤‡åƒç´ æ¯”</span><br><span class="line">console.log(res.windowWidth)&#x2F;&#x2F;å¯ä½¿ç”¨çª—å£å®½åº¦</span><br><span class="line">console.log(res.windowHeight)&#x2F;&#x2F;å¯ä½¿ç”¨çª—å£é«˜åº¦</span><br><span class="line">console.log(res.language)&#x2F;&#x2F;å¾®ä¿¡è®¾ç½®çš„è¯­è¨€</span><br><span class="line">console.log(res.version)&#x2F;&#x2F;å¾®ä¿¡ç‰ˆæœ¬å·</span><br><span class="line">console.log(res.platform)&#x2F;&#x2F;å®¢æˆ·ç«¯å¹³å°</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; æ‰“å¼€è®¾ç½®é¡µé¢</span><br><span class="line">Taro.openSetting(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    console.log(res.authSetting)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F;å‘ç”¨æˆ·å‘èµ·æˆæƒè¯·æ±‚</span><br><span class="line"> Taro.getSetting(&#123; &#x2F;&#x2F;æŸ¥çœ‹ç”¨æˆ·æˆæƒç»“æœ</span><br><span class="line">  success(res) &#123;</span><br><span class="line">    if (!res.authSetting[&#39;scope.userLocation&#39;]) &#123;</span><br><span class="line">      Taro.authorize(&#123;</span><br><span class="line">        scope: &#39;scope.userLocation&#39;,</span><br><span class="line">        success() &#123;</span><br><span class="line">          console.log(&#39;æ‰“å¼€userLocation&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å¯¼èˆªæ å±•ç¤ºloading</span><br><span class="line">Taro.showNavigationBarLoading(); &#x2F;&#x2F; open</span><br><span class="line">Taro.hideNavigationBarLoading(); &#x2F;&#x2F; close</span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±åŠŸèƒ½"><a href="#è·¯ç”±åŠŸèƒ½" class="headerlink" title="è·¯ç”±åŠŸèƒ½"></a>è·¯ç”±åŠŸèƒ½</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·³è½¬åˆ°ç›®çš„é¡µé¢ï¼Œæ‰“å¼€æ–°é¡µé¢</span></span><br><span class="line">Taro.navigateTo(&#123;</span><br><span class="line">  url: <span class="string">'/pages/page/path/name'</span>,</span><br><span class="line">  success:<span class="function"><span class="keyword">function</span>,</span></span><br><span class="line"><span class="function">  <span class="title">fail</span>:<span class="title">function</span>,</span></span><br><span class="line"><span class="function">  <span class="title">complete</span>:<span class="title">function</span></span></span><br><span class="line"><span class="function">&#125;)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// è·³è½¬åˆ°ç›®çš„é¡µé¢ï¼Œåœ¨å½“å‰é¡µé¢æ‰“å¼€</span></span><br><span class="line"><span class="function"><span class="title">Taro</span>.<span class="title">redirectTo</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  url: <span class="string">'/pages/page/path/name'</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//è·³è½¬åˆ° <span class="title">tabBar</span> é¡µé¢ï¼Œå¹¶å…³é—­å…¶ä»–æ‰€æœ‰é <span class="title">tabBar</span> é¡µé¢</span></span><br><span class="line"><span class="function"><span class="title">Taro</span>.<span class="title">switchTab</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  url: <span class="string">'/pages/page/path/name'</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//å…³é—­å½“å‰é¡µé¢ï¼Œè¿”å›ä¸Šä¸€é¡µé¢æˆ–å¤šçº§é¡µé¢</span></span><br><span class="line"><span class="function"><span class="title">Taro</span>.<span class="title">navigateBack</span>(<span class="params">&#123; delta: <span class="number">2</span> &#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//å…³é—­æ‰€æœ‰é¡µé¢ï¼Œæ‰“å¼€åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢</span></span><br><span class="line"><span class="function"><span class="title">wx</span>.<span class="title">reLaunch</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  url: <span class="string">'test?id=1'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>)</span></span><br><span class="line"><span class="function">// ä¼ å…¥å‚æ•° <span class="title">id</span>=2&amp;<span class="title">type</span>=<span class="title">test</span></span></span><br><span class="line"><span class="function"><span class="title">Taro</span>.<span class="title">navigateTo</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  url: <span class="string">'/pages/page/path/name?id=2&amp;type=test'</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//<span class="title">his</span>.<span class="title">$router</span>.<span class="title">params</span> è·å–åˆ°ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">C</span> <span class="title">extends</span> <span class="title">Taro</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentWillMount () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.$router.params) <span class="comment">// è¾“å‡º &#123; id: 2, type: 'test' &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–å†å²è®°å½•çš„æ¡æ•°</span></span><br><span class="line">Taro.getCurrentPages()</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶çš„å¤–éƒ¨æ ·å¼å’Œå…¨å±€æ ·å¼"><a href="#ç»„ä»¶çš„å¤–éƒ¨æ ·å¼å’Œå…¨å±€æ ·å¼" class="headerlink" title="ç»„ä»¶çš„å¤–éƒ¨æ ·å¼å’Œå…¨å±€æ ·å¼"></a>ç»„ä»¶çš„å¤–éƒ¨æ ·å¼å’Œå…¨å±€æ ·å¼</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åœ¨taro ä¸­</span></span><br><span class="line">#a &#123; &#125; /* åœ¨ç»„ä»¶ä¸­ä¸èƒ½ä½¿ç”¨ */</span><br><span class="line">[a] &#123; &#125; <span class="comment">/* åœ¨ç»„ä»¶ä¸­ä¸èƒ½ä½¿ç”¨ */</span></span><br><span class="line">button &#123; &#125; <span class="comment">/* åœ¨ç»„ä»¶ä¸­ä¸èƒ½ä½¿ç”¨ */</span></span><br><span class="line">.a &gt; .b &#123; &#125; <span class="comment">/* é™¤é .a æ˜¯ view ç»„ä»¶èŠ‚ç‚¹ï¼Œå¦åˆ™ä¸ä¸€å®šä¼šç”Ÿæ•ˆ */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¯¥è‡ªå®šä¹‰ç»„ä»¶çš„é»˜è®¤æ ·å¼ æ”¯æŒ */</span></span><br><span class="line">:host &#123;</span><br><span class="line">  color: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤–éƒ¨æ ·å¼ç±»</strong></p><p>å¦‚æœæƒ³ä¼ é€’æ ·å¼ç»™å¼•ç”¨çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œç›´æ¥ä¼ é€’ classNameï¼‰ä¸å¯è¡Œï¼Œåœ¨reactæ˜¯å¯ä»¥çš„ï¼Œåœ¨taroä¸­ï¼š</p><p><code>æ³¨æ„ï¼šexternalClasses éœ€è¦ä½¿ç”¨ çŸ­æ¨ªçº¿å‘½åæ³• (kebab-case)ï¼Œè€Œä¸æ˜¯ React æƒ¯ç”¨çš„ é©¼å³°å‘½åæ³• (camelCase)ã€‚å¦åˆ™æ— æ•ˆã€‚</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* CustomComp.js å­ç»„ä»¶*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomComp</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> externalClasses = [<span class="string">'my-class'</span>]</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">className</span>=<span class="string">"my-class"</span>&gt;</span>è¿™æ®µæ–‡æœ¬çš„é¢œè‰²ç”±ç»„ä»¶å¤–çš„ class å†³å®š<span class="tag">&lt;/<span class="name">View</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* MyPage.js çˆ¶ç»„ä»¶*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">CustomComp</span> <span class="attr">my-class</span>=<span class="string">"red-text"</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* MyPage.scss çˆ¶ç»„ä»¶çš„æ ·å¼*/</span></span><br><span class="line">.red-text &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨taroæ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨taroæ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨taroæ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨taroæ³¨æ„äº‹é¡¹</h3><p><code>1.å¿…é¡»å£°æ˜ Taro å’Œç»„ä»¶</code></p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">å³ä½¿å˜é‡ View æ²¡æœ‰è¢«è°ƒç”¨ï¼Œä½†ä¹Ÿå¿…é¡»ä» @tarojs/components ä¸­å¼•å…¥å£°æ˜ã€‚å˜é‡ Taro ä¹Ÿæ˜¯ä¸€ä¸ªå¿…é¡»å¼•å…¥å£°æ˜çš„å˜é‡ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ç¼–è¯‘æœŸå’Œè¿è¡Œæ—¶ä¼šä¾èµ–è¿™ä¸ªå˜é‡åšä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚**å½“ä½ å¼•å…¥äº†å…¶ä»–ç»„ä»¶æ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨ï¼Œä¸è¦å‡ºç°æ²¡æœ‰ä½¿ç”¨çš„å˜é‡**ã€‚</span><br><span class="line"></span><br><span class="line">å½“ä½ åªç”¨æ”¯æŒå¾®ä¿¡å°ç¨‹åºæ—¶ï¼Œå¯ä»¥ä¸ç”¨å¼•å…¥ç»„ä»¶ä¾‹å¦‚ View è¿™æ ·çš„å£°æ˜ã€‚ä½†æˆ‘ä»¬ä»ç„¶å¼ºçƒˆæ¨èä½ åœ¨é¡¶éƒ¨å¼•å…¥ä½ å°†è¦ä½¿ç”¨çš„ç»„ä»¶ï¼Œè¿™æ ·ç¼–è¾‘å™¨/IDE èƒ½æ›´å¥½åœ°æå‰å‘ç°å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œä¹Ÿä¸ºå°†æ¥å¯èƒ½éœ€è¦çš„å¤šç«¯è½¬æ¢ç•™æœ‰ä½™åœ°ã€‚</span><br></pre></td></tr></table></figure><p><code>2.é¦–å­—æ¯å¤§å†™ä¸é©¼å³°å¼å‘½å</code></p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">&lt;home_page message="Hello World!" /&gt;  //ä¸æ”¯æŒ</span><br><span class="line">&lt;Home_Page message="Hello World!" /&gt;  //æ”¯æŒ</span><br><span class="line">&lt;HomePage message="Hello World!" /&gt;   //æ”¯æŒ</span><br></pre></td></tr></table></figure><p><code>3.JavaScript è¡¨è¾¾å¼</code></p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">ä¸èƒ½åœ¨åŒ…å« JSX å…ƒç´ çš„ map å¾ªç¯ä¸­ä½¿ç”¨ if è¡¨è¾¾å¼;</span><br><span class="line">è§£å†³æ–¹æ¡ˆ:å°½é‡åœ¨ map å¾ªç¯ä¸­ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼æˆ–é€»è¾‘è¡¨è¾¾å¼ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸èƒ½åœ¨ JSX å‚æ•°ä¸­ä½¿ç”¨å¯¹è±¡å±•å¼€ç¬¦</span></span><br><span class="line">&lt;View &#123;...this.props&#125; /&gt;</span><br><span class="line"><span class="comment">//è§£å†³</span></span><br><span class="line">render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id, title &#125; = obj</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">id</span>=<span class="string">&#123;id&#125;</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>4.JS ç¼–ç å¿…é¡»ç”¨å•å¼•å·</code></p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">åœ¨ Taro ä¸­ï¼ŒJS ä»£ç é‡Œå¿…é¡»ä¹¦å†™å•å¼•å·ï¼Œç‰¹åˆ«æ˜¯ JSX ä¸­ï¼Œå¦‚æœå‡ºç°åŒå¼•å·ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚</span><br></pre></td></tr></table></figure><p><code>5.ç»„ä»¶ä¼ é€’å‡½æ•°å±æ€§åä»¥ on å¼€å¤´</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åœ¨ v1.3.0-beta.0 ä¹‹åï¼Œè‡ªå®šä¹‰ç»„ä»¶é—´çš„äº‹ä»¶ä¼ é€’å¯ä»¥ä¸ç”¨ on å¼€å¤´ï¼Œä½†å†…ç½®ç»„ä»¶çš„äº‹ä»¶ä¾ç„¶æ˜¯ä»¥ on å¼€å¤´çš„ï¼Œä¸ºäº†ä¸€è‡´æ€§æˆ‘ä»¬ä»ç„¶æ¨èä½ ä»¥ on å¼€å¤´å‘½åä½ çš„äº‹ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ Taro ä¸­ï¼Œçˆ¶ç»„ä»¶è¦å¾€å­ç»„ä»¶ä¼ é€’å‡½æ•°ï¼Œå±æ€§åå¿…é¡»ä»¥ on å¼€å¤´</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  handleEvent () &#123;&#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Custom onTrigger=&#123;<span class="keyword">this</span>.handleEvent&#125;&gt;&lt;<span class="regexp">/Custom&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><code>6.å°ç¨‹åºç«¯ä¸è¦åœ¨ç»„ä»¶ä¸­æ‰“å°ä¼ å…¥çš„å‡½æ•°</code><br><code>7.å°ç¨‹åºç«¯ä¸è¦åœ¨ç»„ä»¶ä¸­æ‰“å° this.props.children</code><br><code>8.å°ç¨‹åºç«¯ä¸è¦å°†åœ¨æ¨¡æ¿ä¸­ç”¨åˆ°çš„æ•°æ®è®¾ç½®ä¸º undefined</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ç”±äºå°ç¨‹åºä¸æ”¯æŒå°† data ä¸­ä»»ä½•ä¸€é¡¹çš„ value è®¾ä¸º <span class="literal">undefined</span> ï¼Œåœ¨ setState çš„æ—¶å€™ä¹Ÿè¯·é¿å…è¿™ä¹ˆç”¨ã€‚ä½ å¯ä»¥ä½¿ç”¨ <span class="literal">null</span> æ¥æ›¿ä»£ã€‚</span><br></pre></td></tr></table></figure><p><code>9.ç»„ä»¶ state ä¸ props é‡Œå­—æ®µé‡åçš„é—®é¢˜</code></p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">ä¸è¦åœ¨ state ä¸ props ä¸Šç”¨åŒåçš„å­—æ®µï¼Œå› ä¸ºè¿™äº›å­—æ®µåœ¨å¾®ä¿¡å°ç¨‹åºä¸­éƒ½ä¼šæŒ‚åœ¨ data ä¸Šã€‚</span><br></pre></td></tr></table></figure><p><code>10.å°ç¨‹åºä¸­é¡µé¢ç”Ÿå‘½å‘¨æœŸ componentWillMount ä¸ä¸€è‡´é—®é¢˜</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç”±äºå¾®ä¿¡å°ç¨‹åºé‡Œé¡µé¢åœ¨ onLoad æ—¶æ‰èƒ½æ‹¿åˆ°é¡µé¢çš„è·¯ç”±å‚æ•°ï¼Œè€Œé¡µé¢ onLoad å‰ç»„ä»¶éƒ½å·²ç» attached äº†ã€‚å› æ­¤é¡µé¢çš„ componentWillMount å¯èƒ½ä¼šä¸é¢„æœŸä¸å¤ªä¸€è‡´ã€‚ä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="comment">// é”™è¯¯å†™æ³•</span></span><br><span class="line">render () &#123;</span><br><span class="line">  <span class="comment">// åœ¨ willMount ä¹‹å‰æ— æ³•æ‹¿åˆ°è·¯ç”±å‚æ•°</span></span><br><span class="line">  <span class="keyword">const</span> abc = <span class="keyword">this</span>.$router.params.abc</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Custom</span> <span class="attr">adc</span>=<span class="string">&#123;abc&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®å†™æ³•</span></span><br><span class="line">componentWillMount () &#123;</span><br><span class="line">  <span class="keyword">const</span> abc = <span class="keyword">this</span>.$router.params.abc</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    abc</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">render () &#123;</span><br><span class="line">  <span class="comment">// å¢åŠ ä¸€ä¸ªå…¼å®¹åˆ¤æ–­</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.state.abc &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Custom</span> <span class="attr">adc</span>=<span class="string">&#123;abc&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¯¹äºä¸éœ€è¦ç­‰åˆ°é¡µé¢ willMount ä¹‹åå–è·¯ç”±å‚æ•°çš„é¡µé¢åˆ™æ²¡æœ‰ä»»ä½•å½±å“ã€‚</span></span><br></pre></td></tr></table></figure><p><code>11.ç¯å¢ƒå˜é‡ process.env çš„ä½¿ç”¨</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯å†™æ³•ï¼Œä¸æ”¯æŒ</span></span><br><span class="line"><span class="keyword">const</span> &#123; NODE_ENV = <span class="string">'development'</span> &#125; = process.env</span><br><span class="line"><span class="keyword">if</span> (NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ­£ç¡®å†™æ³•</span></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>12.è¦æ·»åŠ åŒ…è£¹çš„å…ƒç´ </code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Block = <span class="function">(<span class="params">props</span>) =&gt;</span>  props.children</span><br><span class="line"><span class="keyword">const</span> Block = <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;props.children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>  <span class="comment">// âœ…</span></span><br></pre></td></tr></table></figure><p><code>13.å°ç¨‹åº</code></p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">è‹¥ä½¿ç”¨ å¾®ä¿¡å°ç¨‹åºé¢„è§ˆæ¨¡å¼ ï¼Œåˆ™éœ€ä¸‹è½½å¹¶ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ·»åŠ é¡¹ç›®è¿›è¡Œé¢„è§ˆï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„é¡¹ç›®è®¾ç½®</span><br><span class="line">éœ€è¦è®¾ç½®å…³é—­ ES6 è½¬ ES5 åŠŸèƒ½ï¼Œå¼€å¯å¯èƒ½æŠ¥é”™</span><br><span class="line">éœ€è¦è®¾ç½®å…³é—­ä¸Šä¼ ä»£ç æ—¶æ ·å¼è‡ªåŠ¨è¡¥å…¨ï¼Œå¼€å¯å¯èƒ½æŠ¥é”™</span><br><span class="line">éœ€è¦è®¾ç½®å…³é—­ä»£ç å‹ç¼©ä¸Šä¼ ï¼Œå¼€å¯å¯èƒ½æŠ¥é”™</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h3><blockquote><p>è·Ÿreact åŸºæœ¬ä¿æŒä¸€è‡´</p></blockquote><p><strong>ä½¿ç”¨ <code>this.$componentType</code> æ¥åˆ¤æ–­å½“å‰ <code>Taro.Component</code> æ˜¯é¡µé¢è¿˜æ˜¯ç»„ä»¶</strong><br><code>this.$componentType</code> å¯èƒ½å–å€¼åˆ†åˆ«ä¸º <code>PAGE</code> å’Œ<code>COMPONEN</code>Tï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®æ­¤å˜é‡çš„å–å€¼åˆ†åˆ«é‡‡å–ä¸åŒé€»è¾‘ã€‚</p><p><code>ä½¿ç”¨ PropTypes æ£€æŸ¥ç±»å‹</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">éšç€åº”ç”¨æ—¥æ¸åºå¤§ï¼Œä½ å¯ä»¥é€šè¿‡ç±»å‹æ£€æŸ¥æ•è·å¤§é‡é”™è¯¯ã€‚è¦æ£€æŸ¥ç»„ä»¶çš„å±æ€§ï¼Œä½ éœ€è¦é…ç½®ç‰¹æ®Šçš„ propTypes å±æ€§ï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;h1&gt;Hello, &#123;<span class="keyword">this</span>.props.name&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">Greeting.defaultProps = &#123;</span></span><br><span class="line"><span class="regexp">  name: 'word'</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">Greeting.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  name: PropTypes.string</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><h3 id="äº‹ä»¶å¤„ç†"><a href="#äº‹ä»¶å¤„ç†" class="headerlink" title="äº‹ä»¶å¤„ç†"></a>äº‹ä»¶å¤„ç†</h3><p><code>ä½¿ç”¨åŒ¿åå‡½æ•°</code> è‡ª v1.2.9 å¼€å§‹æ”¯æŒ<br><br/><br><code>æŸ¯é‡ŒåŒ–</code> è‡ª v1.3.0-beta.1 å¼€å§‹æ”¯æŒ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">handleClick = <span class="function">(<span class="params">index</span>) =&gt;</span> <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.stopPropagation()</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      currentIndex: index</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>å‡½æ•°å¼ç»„ä»¶</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [c1, setC1] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [c3, setC3] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> increment = <span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åªæœ‰ useCallback å¯¹åº”çš„ c1çš„å€¼æ”¹å˜æ—¶ï¼Œæ‰ä¼šè¿”å›æ–°çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> increment1 = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> setC1(increment), [c1]);</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">View</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Text</span>&gt;</span> Counter 1 is &#123;c1&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Text</span>&gt;</span> Counter 3 is &#123;c3&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line">    &lt;View&gt;</span><br><span class="line">      &lt;Button onClick=&#123;increment1&#125;&gt;Increment Counter 1&lt;/Button&gt;</span><br><span class="line">      &lt;Button onClick=&#123;() =&gt; setC3(increment)&#125;&gt;Increment Counter 3&lt;/Button&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">View</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">View</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ä»»ä½•ç»„ä»¶çš„äº‹ä»¶ä¼ é€’éƒ½è¦ä»¥ on å¼€å¤´</code> åœ¨ v1.3.0-beta.0 ä¹‹åï¼Œè‡ªå®šä¹‰ç»„ä»¶é—´çš„äº‹ä»¶ä¼ é€’å¯ä»¥ä¸ç”¨ on å¼€å¤´ï¼Œä½†å†…ç½®ç»„ä»¶çš„äº‹ä»¶ä¾ç„¶æ˜¯ä»¥ on å¼€å¤´çš„ï¼Œä¸ºäº†ä¸€è‡´æ€§æˆ‘ä»¬ä»ç„¶æ¨èä½ ä»¥ on å¼€å¤´å‘½åä½ çš„äº‹ä»¶ã€‚</p><h3 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="headerlink" title="æ¡ä»¶æ¸²æŸ“"></a>æ¡ä»¶æ¸²æŸ“</h3><p><code>if-else</code><br><code>é€»è¾‘è¿ç®—ç¬¦ &amp;&amp;</code><br><code>ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆæ¡ä»¶è¡¨è¾¾å¼ï¼‰</code><br><code>æšä¸¾æ¡ä»¶æ¸²æŸ“</code> ç¬¬ä¸€æ¬¡çœ‹åˆ°ï¼Œæ„Ÿè§‰è¿˜æŒºå¥½ç©çš„</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; loadingText, LOADING_STATUS, loadingStatus, onRetry &#125; = props</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;View className=<span class="string">'loading-status'</span>&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">'loading'</span>: loadingText,</span><br><span class="line">          <span class="string">'fail'</span>: <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">onClick</span>=<span class="string">&#123;onRetry&#125;</span>&gt;</span> åŠ è½½å¤±è´¥, ç‚¹å‡»é‡è¯• <span class="tag">&lt;/<span class="name">View</span>&gt;</span></span>,</span><br><span class="line">          <span class="string">'no-more'</span>: <span class="string">'æ²¡æœ‰æ›´å¤šäº†'</span></span><br><span class="line">        &#125;[loadingStatus] <span class="comment">/** loadingStatus æ˜¯ `loading`ã€`fail`ã€`no-more`  å…¶ä¸­ä¸€ç§çŠ¶æ€ **/</span></span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Refs-å¼•ç”¨"><a href="#Refs-å¼•ç”¨" class="headerlink" title="Refs å¼•ç”¨"></a>Refs å¼•ç”¨</h3><p><code>ä½¿ç”¨å­—ç¬¦ä¸²åˆ›å»º ref</code>  æ­¤æ–¹æ³•åœ¨reactä¸­å·²ç»åºŸå¼ƒ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ ref çš„æ˜¯å°ç¨‹åºåŸç”Ÿç»„ä»¶ï¼Œé‚£åªæœ‰åœ¨ didMount ç”Ÿå‘½å‘¨æœŸä¹‹åæ‰èƒ½é€šè¿‡</span></span><br><span class="line">    <span class="comment">// this.refs.input è®¿é—®åˆ°å°ç¨‹åºåŸç”Ÿç»„ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.TARO_ENV === <span class="string">'weapp'</span>) &#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œ this.refs.input è®¿é—®çš„æ—¶å€™é€šè¿‡ `wx.createSeletorQuery` å–åˆ°çš„å°ç¨‹åºåŸç”Ÿç»„ä»¶</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.TARO_ENV === <span class="string">'h5'</span>) &#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œ this.refs.input è®¿é—®åˆ°çš„æ˜¯ `@tarojs/components` çš„ `Input` ç»„ä»¶å®ä¾‹</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Input</span> <span class="attr">ref</span>=<span class="string">'input'</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>é€šè¿‡å‡½æ•°åˆ›å»º ref</code>  <strong>Taroæ¨èä½¿ç”¨</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  refCat = <span class="function">(<span class="params">node</span>) =&gt;</span> <span class="keyword">this</span>.cat = node <span class="comment">// `this.cat` ä¼šå˜æˆ `Cat` ç»„ä»¶å®ä¾‹çš„å¼•ç”¨</span></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Cat</span> <span class="attr">ref</span>=<span class="string">&#123;this.refCat&#125;</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>é€šè¿‡ createRef åˆ›å»º ref</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cat = Taro.createRef()</span><br><span class="line">  componentDidMount(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.cat.current</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Cat</span> <span class="attr">ref</span>=<span class="string">&#123;this.cat&#125;</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…ç½®ç¯å¢ƒå˜é‡"><a href="#å†…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="å†…ç½®ç¯å¢ƒå˜é‡"></a>å†…ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//weapp / swan / alipay / h5 / rn / tt</span></span><br><span class="line">process.env.TARO_ENV</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯ä»¥åœ¨ JSX ä¸­ä½¿ç”¨ï¼Œå†³å®šä¸åŒç«¯è¦åŠ è½½çš„ç»„ä»¶</span></span><br><span class="line">render () &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;View&gt;</span><br><span class="line">      &#123;process.env.TARO_ENV === <span class="string">'weapp'</span> &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">ScrollViewWeapp</span> /&gt;</span></span>&#125;</span><br><span class="line">      &#123;process.env.TARO_ENV === <span class="string">'h5'</span> &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">ScrollViewH5</span> /&gt;</span></span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>ç»Ÿä¸€æ¥å£çš„å¤šç«¯æ–‡ä»¶</strong></p><p>å†…ç½®ç¯å¢ƒå˜é‡è™½ç„¶å¯ä»¥è§£å†³å¤§éƒ¨åˆ†è·¨ç«¯çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šè®©ä»£ç ä¸­å……æ–¥ç€é€»è¾‘åˆ¤æ–­çš„ä»£ç ï¼Œå½±å“ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼Œè€Œä¸”ä¹Ÿè®©ä»£ç å˜å¾—æ„ˆå‘ä¸‘é™‹ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜, å¼€å‘è€…å¯ä»¥é€šè¿‡å°†æ–‡ä»¶ä¿®æ”¹æˆåŸ <code>æ–‡ä»¶å + ç«¯ç±»å‹</code> çš„å‘½åå½¢å¼ </p><p><strong>å¤šç«¯ç»„ä»¶ ğŸ‘</strong></p><p>å‡å¦‚æœ‰ä¸€ä¸ª Test ç»„ä»¶å­˜åœ¨å¾®ä¿¡å°ç¨‹åºã€ç™¾åº¦å°ç¨‹åºå’Œ H5 ä¸‰ä¸ªä¸åŒç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±å¯ä»¥åƒå¦‚ä¸‹ç»„ç»‡ä»£ç <br>test.js æ–‡ä»¶ï¼Œè¿™æ˜¯ Test ç»„ä»¶é»˜è®¤çš„å½¢å¼ï¼Œç¼–è¯‘åˆ°å¾®ä¿¡å°ç¨‹åºã€ç™¾åº¦å°ç¨‹åºå’Œ H5 ä¸‰ç«¯ä¹‹å¤–çš„ç«¯ä½¿ç”¨çš„ç‰ˆæœ¬<br>test.h5.js æ–‡ä»¶ï¼Œè¿™æ˜¯ Test ç»„ä»¶çš„ H5 ç‰ˆæœ¬<br>test.weapp.js æ–‡ä»¶ï¼Œè¿™æ˜¯ Test ç»„ä»¶çš„ å¾®ä¿¡å°ç¨‹åº ç‰ˆæœ¬<br>test.swan.js æ–‡ä»¶ï¼Œè¿™æ˜¯ Test ç»„ä»¶çš„ ç™¾åº¦å°ç¨‹åº ç‰ˆæœ¬<br>å››ä¸ªæ–‡ä»¶ï¼Œå¯¹å¤–æš´éœ²çš„æ˜¯ç»Ÿä¸€çš„æ¥å£ï¼Œå®ƒä»¬æ¥å—ä¸€è‡´çš„å‚æ•°ï¼Œåªæ˜¯å†…éƒ¨æœ‰é’ˆå¯¹å„è‡ªå¹³å°çš„ä»£ç å®ç°</p><p>è€Œæˆ‘ä»¬ä½¿ç”¨ Test ç»„ä»¶çš„æ—¶å€™ï¼Œå¼•ç”¨çš„æ–¹å¼ä¾ç„¶å’Œä¹‹å‰ä¿æŒä¸€è‡´ï¼Œimport çš„æ˜¯ä¸å¸¦ç«¯ç±»å‹çš„æ–‡ä»¶åï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æ·»åŠ ç«¯ç±»å‹åç¼€</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Test <span class="keyword">from</span> <span class="string">'../../components/test'</span></span><br><span class="line"></span><br><span class="line">&lt;Test argA=&#123;<span class="number">1</span>&#125; argA=&#123;<span class="number">2</span>&#125; /&gt;</span><br></pre></td></tr></table></figure><h3 id="å°ç¨‹åºåŸç”Ÿä½œç”¨åŸŸè·å–"><a href="#å°ç¨‹åºåŸç”Ÿä½œç”¨åŸŸè·å–" class="headerlink" title="å°ç¨‹åºåŸç”Ÿä½œç”¨åŸŸè·å–"></a>å°ç¨‹åºåŸç”Ÿä½œç”¨åŸŸè·å–</h3><p><code>this.$scope</code></p><h3 id="é€šç”¨é…ç½®"><a href="#é€šç”¨é…ç½®" class="headerlink" title="é€šç”¨é…ç½®"></a>é€šç”¨é…ç½®</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="comment">// é¡¹ç›®åç§°</span></span><br><span class="line">  projectName: <span class="string">'kj'</span>,</span><br><span class="line">  <span class="comment">// é¡¹ç›®åˆ›å»ºæ—¥æœŸ</span></span><br><span class="line">  date: <span class="string">'2018-6-8'</span>,</span><br><span class="line">  <span class="comment">// è®¾è®¡ç¨¿å°ºå¯¸</span></span><br><span class="line">  designWidth: <span class="number">750</span>,</span><br><span class="line">  <span class="comment">// é¡¹ç›®æºç ç›®å½•</span></span><br><span class="line">  sourceRoot: <span class="string">'src'</span>,</span><br><span class="line">  <span class="comment">// é¡¹ç›®äº§å‡ºç›®å½•</span></span><br><span class="line">  outputRoot: <span class="string">'dist'</span>,</span><br><span class="line">  <span class="comment">// é€šç”¨æ’ä»¶é…ç½®</span></span><br><span class="line">  plugins: &#123;</span><br><span class="line">    babel: &#123;</span><br><span class="line">      sourceMap: <span class="literal">true</span>,</span><br><span class="line">      presets: [<span class="string">'env'</span>],</span><br><span class="line">      plugins: [<span class="string">'transform-class-properties'</span>, <span class="string">'transform-decorators-legacy'</span>, <span class="string">'transform-object-rest-spread'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å…¨å±€å˜é‡è®¾ç½®</span></span><br><span class="line">  defineConstants: &#123;&#125;,</span><br><span class="line">  <span class="comment">// æ–‡ä»¶ copy é…ç½®</span></span><br><span class="line">  copy: &#123;</span><br><span class="line">    patterns: [</span><br><span class="line">    ],</span><br><span class="line">    options: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å°ç¨‹åºç«¯ä¸“ç”¨é…ç½®</span></span><br><span class="line">  weapp: &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      postcss: &#123;</span><br><span class="line">        autoprefixer: &#123;</span><br><span class="line">          enable: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// å°ç¨‹åºç«¯æ ·å¼å¼•ç”¨æœ¬åœ°èµ„æºå†…è”é…ç½®</span></span><br><span class="line">        url: &#123;</span><br><span class="line">          enable: <span class="literal">true</span>,</span><br><span class="line">          config: &#123;</span><br><span class="line">            limit: <span class="number">10240</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æ›¿æ¢ JSX ä¸­çš„å±æ€§åï¼Œå‚è€ƒï¼š</span></span><br><span class="line">    <span class="comment">// https://github.com/NervJS/taro/issues/2077</span></span><br><span class="line">    jsxAttributeNameReplace: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// H5 ç«¯ä¸“ç”¨é…ç½®</span></span><br><span class="line">  h5: &#123;</span><br><span class="line">    publicPath: <span class="string">'/'</span>,</span><br><span class="line">    staticDirectory: <span class="string">'static'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'js/[name].[hash:8].js'</span>,</span><br><span class="line">        chunkFilename: <span class="string">'js/[name].[chunkhash:8].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    miniCssExtractPluginOption: &#123;</span><br><span class="line">        filename: <span class="string">'css/[name].[hash:8].css'</span>,</span><br><span class="line">        chunkFilename: <span class="string">'css/[name].[chunkhash:8].css'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    imageUrlLoaderOption: &#123;</span><br><span class="line">        limit: <span class="number">5000</span>,</span><br><span class="line">        name: <span class="string">'static/images/[name].[hash:8].[ext]'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      postcss: &#123;</span><br><span class="line">        autoprefixer: &#123;</span><br><span class="line">          enable: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//ä¿®æ”¹urlçš„è·¯å¾„</span></span><br><span class="line">    router: &#123;</span><br><span class="line">      mode: <span class="string">'browser'</span>,</span><br><span class="line">      customRoutes: &#123;</span><br><span class="line">        <span class="string">'/pages/login/index'</span>: <span class="string">'/login'</span>,</span><br><span class="line">        <span class="string">'/pages/functionArea/index'</span>: <span class="string">'/functionArea'</span>,</span><br><span class="line">        <span class="string">'/pages/personCenter/index'</span>: <span class="string">'/personCenter'</span>,</span><br><span class="line">        <span class="string">'/pages/message/index'</span>: <span class="string">'/message'</span>,</span><br><span class="line">        <span class="string">'/pages/ticketCode/index'</span>:<span class="string">'/ticketCode'</span>,</span><br><span class="line">        <span class="string">'/pages/ticketList/index'</span>:<span class="string">'/ticketList'</span>,</span><br><span class="line">        <span class="string">'/pages/activityCode/index'</span>:<span class="string">'/activityCode'</span>,</span><br><span class="line">        <span class="string">'/pages/activityList/index'</span>:<span class="string">'/activityList'</span>,</span><br><span class="line">        <span class="string">'/pages/activityVerify/index'</span>:<span class="string">'/activityVerify'</span>,</span><br><span class="line">        <span class="string">'/pages/analysis/index'</span>:Analysis,</span><br><span class="line">        <span class="string">'/pages/feedBack/index'</span>:<span class="string">'/feedBack'</span>,</span><br><span class="line">        <span class="string">'/pages/set/index'</span>:<span class="string">'/set'</span>,</span><br><span class="line">        <span class="string">'/pages/scenicList/index'</span>:<span class="string">'/scenicList'</span>,</span><br><span class="line">        <span class="string">'/pages/selectPosition/index'</span>:<span class="string">'/selectPosition'</span>,</span><br><span class="line">        <span class="string">'/pages/selectActivity/index'</span>:<span class="string">'/selectActivity'</span>,</span><br><span class="line">        <span class="string">'/pages/codeResult/index'</span>:<span class="string">'/codeResult'</span>,</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰ Webpack é…ç½®</span></span><br><span class="line">    webpackChain: &#123;&#125;,</span><br><span class="line">     devServer: &#123;</span><br><span class="line">      <span class="string">"proxy"</span>: &#123;</span><br><span class="line">        <span class="string">"/api"</span>: &#123;</span><br><span class="line">          <span class="string">"target"</span>: <span class="string">"https://www.v2ex.com/api/"</span>,</span><br><span class="line">          <span class="string">"changeOrigin"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="string">"secure"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="string">"pathRewrite"</span>: &#123; <span class="string">"^/api"</span>: <span class="string">""</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">merge</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> merge(&#123;&#125;, config, <span class="built_in">require</span>(<span class="string">'./dev'</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> merge(&#123;&#125;, config, <span class="built_in">require</span>(<span class="string">'./prod'</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¯‘é…ç½®è¯¦æƒ…"><a href="#ç¼–è¯‘é…ç½®è¯¦æƒ…" class="headerlink" title="ç¼–è¯‘é…ç½®è¯¦æƒ…"></a>ç¼–è¯‘é…ç½®è¯¦æƒ…</h3><blockquote><p>configç›®å½•ä¸‹é¢çš„index</p></blockquote><p><strong>defineConstants</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ¥é…ç½®ä¸€äº›å…¨å±€å˜é‡ä¾›ä»£ç ä¸­è¿›è¡Œä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</span><br><span class="line"></span><br><span class="line">defineConstants: &#123;</span><br><span class="line">  A: &#39;&quot;a&quot;&#39; &#x2F;&#x2F; JSON.stringify(&#39;a&#39;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>alias</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">alias: &#123;</span><br><span class="line">  <span class="string">'@'</span>: path.resolve(__dirname, <span class="string">'..'</span>, <span class="string">'src'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸ºäº†è®©ç¼–è¾‘å™¨ï¼ˆVS Codeï¼‰ä¸æŠ¥é”™ï¼Œå¹¶ç»§ç»­ä½¿ç”¨è‡ªåŠ¨è·¯å¾„è¡¥å…¨çš„åŠŸèƒ½ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ jsconfig.json æˆ–è€… tsconfig.json ä¸­é…ç½® paths è®©ç¼–è¾‘å™¨è®¤å¾—æˆ‘ä»¬çš„åˆ«åï¼Œå½¢å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="string">"baseUrl"</span>: <span class="string">"."</span>,</span><br><span class="line">    <span class="string">"paths"</span>: &#123;</span><br><span class="line">      <span class="string">"@/*"</span>: [<span class="string">"./src/*"</span>],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ä½†è‹¥è¦åœ¨ Sass ä¸­ä½¿ç”¨åˆ«åï¼Œå¦‚ @styles æŒ‡å‘ src/stylesï¼š</code></p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">"@styles/theme.scss"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/index.js</span></span><br><span class="line">plugins: &#123;</span><br><span class="line">  sass: &#123;</span><br><span class="line">    importer: <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> reg = <span class="regexp">/^@styles\/(.*)/</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        file: reg.test(url) ? path.resolve(__dirname, <span class="string">'..'</span>, <span class="string">'src/styles'</span>, url.match(reg)[<span class="number">1</span>]) : url</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¤‡æ³¨ï¼šç›®å‰èµ„æºå¼•ç”¨æ—¶ä»æ— æ³•ä½¿ç”¨åˆ«åï¼Œå¦‚ background: url('@assets/logo.png')</span></span><br></pre></td></tr></table></figure><p>è¿˜éœ€è¦é¢å¤–çš„é…ç½®ï¼ˆTaro å¯¹æ ·å¼çš„å¤„ç†æ˜¯ node-sass -&gt; postcssï¼Œåœ¨ sass è¿™æ­¥å°±æŠ¥é”™äº†ï¼Œä¸èƒ½ç”¨ postcss-import æ’ä»¶è§£å†³ï¼‰ï¼š</p><h3 id="é€šè¿‡ç¯å¢ƒå˜é‡å®ç°-config-çš„å¤šå…ƒæ§åˆ¶"><a href="#é€šè¿‡ç¯å¢ƒå˜é‡å®ç°-config-çš„å¤šå…ƒæ§åˆ¶" class="headerlink" title="é€šè¿‡ç¯å¢ƒå˜é‡å®ç° config çš„å¤šå…ƒæ§åˆ¶"></a>é€šè¿‡ç¯å¢ƒå˜é‡å®ç° config çš„å¤šå…ƒæ§åˆ¶</h3><blockquote><p>package.json </p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"dev:weapp:mock"</span>: <span class="string">"MOCK=1 npm run dev:weapp"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MOCK=1 å¯ä»¥åœ¨ config ä¸­é€šè¿‡ process.env.MOCK è®¿é—®åˆ°</span></span><br></pre></td></tr></table></figure><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Taro, &#123; Component, PageConfig &#125; <span class="keyword">from</span> <span class="string">'@tarojs/taro'</span>;</span><br><span class="line"><span class="keyword">class</span> ReportList <span class="keyword">extends</span> Component &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æŒ‡å®šconfigçš„ç±»å‹å£°æ˜ä¸º: Taro.PageConfig</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * ç”±äº typescript å¯¹äº object ç±»å‹æ¨å¯¼åªèƒ½æ¨å‡º Key çš„åŸºæœ¬ç±»å‹</span></span><br><span class="line"><span class="comment">   * å¯¹äºåƒ navigationBarTextStyle: 'black' è¿™æ ·çš„æ¨å¯¼å‡ºçš„ç±»å‹æ˜¯ string</span></span><br><span class="line"><span class="comment">   * æç¤ºå’Œå£°æ˜ navigationBarTextStyle: 'black' | 'white' ç±»å‹å†²çª, éœ€è¦æ˜¾ç¤ºå£°æ˜ç±»å‹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  config: PageConfig = &#123;</span><br><span class="line">    navigationBarTitleText: <span class="string">'å¯ç–‘æ•°æ®æ±‡æ€»'</span>,</span><br><span class="line">    enablePullDownRefresh: <span class="literal">true</span>,   <span class="comment">// è¿™ä¸ªæ˜¯å¯ç”¨ä¸‹æ‹‰åˆ·æ–°ç‰¹æ€§</span></span><br><span class="line">    backgroundTextStyle: <span class="string">"dark"</span>,   <span class="comment">// æŠŠæ˜¾ç¤ºçš„æ–‡æœ¬é¢œè‰²æ”¹æˆæš—è‰²è°ƒ,äº®è‰²çš„è¯.ä½ èƒŒæ™¯ä¸æ”¹çœ‹ä¸åˆ°,å› ä¸ºåŒè‰²</span></span><br><span class="line">    backgroundColor:<span class="string">'#f7f7f7'</span> <span class="comment">// é¡µé¢çš„èƒŒæ™¯è‰²</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ç”¨å,è®°å¾—åŠ å¯¹åº”çš„æ¡ä»¶å…³é—­,ä¸ç„¶ä¼šä¸€ç›´æ˜¾ç¤º</span></span><br><span class="line"> <span class="comment">// ä¸‹æ‹‰åˆ·æ–°</span></span><br><span class="line"> onPullDownRefresh = () :<span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªloadingæ˜¯ å¯¼èˆªæ ,é¡µé¢æ ‡é¢˜é‚£å—æ˜¾ç¤ºä¸€ä¸ªloading  , å¾®ä¿¡å†…ç½®çš„</span></span><br><span class="line">    Taro.showLoading(&#123;</span><br><span class="line">      title: <span class="string">'loading....'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å› ä¸ºæˆ‘çš„æ¥å£è¯·æ±‚éƒ½æ˜¯ async awaitçš„å§¿åŠ¿,æ‰€ä»¥å¯ä»¥é˜Ÿåˆ—æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">this</span>.getList(); </span><br><span class="line">    <span class="keyword">this</span>.unselect();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¥å£è¯·æ±‚å®Œæ¯•åéšè—ä¸¤ä¸ªloading , æ ‡é¢˜å’Œä¸‹æ‹‰åŒºåŸŸ</span></span><br><span class="line">    Taro.hideLoading();</span><br><span class="line">    Taro.stopPullDownRefresh();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="æ›´æ–°Taro"><a href="#æ›´æ–°Taro" class="headerlink" title="æ›´æ–°Taro"></a>æ›´æ–°Taro</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;æ›´æ–° Taro CLI å·¥å…·</span><br><span class="line">taro</span><br><span class="line">$ taro update self</span><br><span class="line">npm</span><br><span class="line">$ npm i -g @tarojs&#x2F;cli@latest</span><br><span class="line">yarn</span><br><span class="line">$ yarn global add @tarojs&#x2F;cli@latest</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;æ›´æ–°é¡¹ç›®ä¸­ Taro ç›¸å…³çš„ä¾èµ–</span><br><span class="line">$ taro update project</span><br><span class="line"></span><br><span class="line">$ taro info æ‰“å°çš„ä¿¡æ¯</span><br><span class="line">$ taro doctor è¯Šæ–­é¡¹ç›®çš„ä¾èµ–ã€è®¾ç½®ã€ç»“æ„ï¼Œä»¥åŠä»£ç çš„è§„èŒƒæ˜¯å¦å­˜åœ¨é—®é¢˜ï¼Œå¹¶å°è¯•ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚</span><br></pre></td></tr></table></figure><h3 id="Taroçš„æ³¨æ„äº‹é¡¹"><a href="#Taroçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="Taroçš„æ³¨æ„äº‹é¡¹"></a>Taroçš„æ³¨æ„äº‹é¡¹</h3><p> <strong>1. åœ¨H5ç«¯ å‘¨æœŸå‡½æ•°é‡Œé¢ä½¿ç”¨åŠ¨æ€ä¿®æ”¹tabbarçš„å†…å®¹ï¼Œä¼šå¾ªç¯æ‰§è¡Œé’©å­å‡½æ•°</strong></p><p> <strong>2. taroè·¯ç”±åœ¨h5ç«¯ ï¼Œä¸èƒ½ä½¿ç”¨å¼•ç”¨çš„å˜é‡</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> method=<span class="string">'navigateTo'</span>;</span><br><span class="line">Taro[method](&#123;</span><br><span class="line">      url</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//è¿™ç§çš„åœ¨h5ç«¯ï¼ŒæŠ¥é”™</span></span><br><span class="line"><span class="comment">//è®¾ç½®å˜é‡åœ¨h5ä¸‹ä¸èƒ½è·³è½¬ï¼Œå¿…é¡»æ˜¯Taro['navigateTo'] or Taro.navigateTo</span></span><br></pre></td></tr></table></figure><p><strong>3. H5ä¸‹ScrollView,åªæ˜¾ç¤ºé¦–å±ï¼Œä¸‹é¢çš„éƒ½æ˜¯ç©ºç™½,TaroUIé‡Œé¢overflow:hidden</strong></p><p><strong>4. cssModules åœ¨å­—èŠ‚å¤´æ¡é‡Œé¢ï¼Œä¿®æ”¹å…¨å±€çš„æ ·å¼å¿…é¡»å£°æ˜åœ¨æœ€å¤–é¢</strong></p><p><strong>5. H5ä¸‹:global{}åçš„æ ·å¼ï¼Œæœ‰æ±¡æŸ“çš„å½±å“,å‰ææ˜¯å…¼å®¹tt</strong></p><p> <strong>6. TaroUIåœ¨è·¯ç”±ç»„ä»¶é‡Œé¢å¯ä»¥ä¿®æ”¹å…¨å±€çš„æ ·å¼ï¼Œä½†æ˜¯æ‹†åˆ†ç»„ä»¶ä¹‹åï¼Œå°±ä¸èƒ½ä¿®æ”¹æ ·å¼,h5ä¸‹æ­£å¸¸æ˜¾ç¤ºã€cssModulesã€‘</strong></p><p><code>å°ç¨‹åºçš„ addGlobalClass åªèƒ½ä½¿ page é¡µé¢ä¸Šçš„æ ·å¼å¯ä»¥å½±å“</code></p><p><strong>7. è‡ªå®šä¹‰è‹¥å¹²ä¸ªå¤–éƒ¨æ ·å¼ç±» ç”¨ <code>static externalClasses = [&#39;class-name-style&#39;];</code>ï¼Œç„¶åä¼ é€’ç»™å­ç»„ä»¶</strong> </p><p>ç¼ºé™· <code>1.H5ç«¯ä¸å…¼å®¹;2.å¿…é¡»ç”¨å°é©¼å³°</code></p><p><strong>8. å°ç¨‹åºæ‹†åŒ…åœ¨ttä¸‹éœ€è¦æ‰‹åŠ¨æ”¾åˆ°pagesé‡Œé¢,åœ¨H5ä¸‹æ­£å¸¸æ˜¾ç¤º</strong></p><p><strong>9. é˜»æ­¢å†’æ³¡</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//jsx</span></span><br><span class="line"> &#123;</span><br><span class="line">   [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;View key=&#123;item&#125; onClick=&#123;<span class="keyword">this</span>.parent(item)&#125;&gt;</span><br><span class="line">                &lt;Text&gt;</span><br><span class="line">                    æˆ‘æ˜¯çˆ¶ç›’å­&#123;item&#125;</span><br><span class="line">                &lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">                &lt;View onClick=&#123;this.son(item)&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Text&gt;</span></span><br><span class="line"><span class="regexp">                        æˆ‘æ˜¯å­ç›’å­ &#123;item&#125;</span></span><br><span class="line"><span class="regexp">                    &lt;/</span>Text&gt;</span><br><span class="line">                &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>View&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ–¹æ³•</span></span><br><span class="line">parent = <span class="function">(<span class="params">val</span>) =&gt;</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'parent'</span>, val);</span><br><span class="line"> &#125;;</span><br><span class="line"> son = <span class="function">(<span class="params">val</span>) =&gt;</span>ï¼ˆeï¼‰=&gt; &#123;</span><br><span class="line">     e.stopPropagation();</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'son'</span>, val);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°å¼ç»„ä»¶</strong></p><pre><code>H5  æŸ¯ç†åŒ–å‡½æ•°é˜»æ­¢å†’æ³¡æˆåŠŸ  bindé˜»æ­¢å†’æ³¡æˆåŠŸweapp  æŸ¯ç†åŒ–å‡½æ•°é˜»æ­¢å†’æ³¡å¤±æ•ˆ  bindé˜»æ­¢å†’æ³¡å¤±æ•ˆ</code></pre><p><strong>ç±»ç»„ä»¶</strong></p><pre><code>H5æŸ¯ç†åŒ–å‡½æ•°é˜»æ­¢å†’æ³¡æˆåŠŸbindé˜»æ­¢å†’æ³¡æˆåŠŸweappæŸ¯ç†åŒ–å‡½æ•°é˜»æ­¢å†’æ³¡å¤±æ•ˆbindé˜»æ­¢å†’æ³¡æˆåŠŸ</code></pre><p><strong>é€šç”¨</strong></p><pre><code>1.æ™®é€šçš„ç®­å¤´å‡½æ•°,æ‰€æœ‰å…¼å®¹ï¼Œæœ‰å±€é™æ€§;2.è¡Œå†…é˜»æ­¢å†’æ³¡ï¼Œå†™ä¸šåŠ¡ä»£ç </code></pre><p> <strong>10. iconfontåªèƒ½ä½¿ç”¨ä¸‹è½½æœ¬åœ°çš„æ–¹å¼,ç›´æ¥ä½¿ç”¨é“¾æ¥é¡µé¢æ˜¾ç¤ºæ–¹æ¡†</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸‰ç§ä½¿ç”¨æ–¹å¼</span></span><br><span class="line">&lt;Text className=&#123;classNames(<span class="string">'icon'</span>, <span class="string">'icon-home'</span>, styles.setIcon)&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Text className=&#123;'icon'&#125;&gt;&amp;#xe64e;&lt;/Text&gt;</span><br><span class="line"></span><br><span class="line">&lt;AtIcon prefixClass=<span class="string">'icon'</span> value=<span class="string">'home'</span> size=<span class="string">'20'</span> color=<span class="string">'#fff'</span>/&gt;</span><br></pre></td></tr></table></figure><p><strong>11. TaroUIåœ¨H5æ¨¡å¼ä¸‹ç¼–è¯‘æŠ¥é”™</strong></p><p>è¯·åœ¨ config/index.js æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®é¡¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">h5: &#123;</span><br><span class="line">  esnextModules: [<span class="string">'taro-ui'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Taro </category>
          
          <category> TaroåŸºæœ¬ç”¨æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Nodeç”Ÿæˆæ¨¡æ¿</title>
      <link href="/2019/07/01/workspace/Frame/taro/template/"/>
      <url>/2019/07/01/workspace/Frame/taro/template/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Nodeç”Ÿæˆæ¨¡æ¿</strong></p><p>[[toc]]</p><p><strong>åŸºäºnodejsç¼–å†™è‡ªåŠ¨ç”Ÿæˆè·¯ç”±éœ€è¦çš„æ–‡ä»¶</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pagesæ¨¡ç‰ˆå¿«é€Ÿç”Ÿæˆè„šæœ¬,æ‰§è¡Œå‘½ä»¤ npm run tep `æ–‡ä»¶å`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dirName = process.argv[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!dirName) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ–‡ä»¶å¤¹åç§°ä¸èƒ½ä¸ºç©ºï¼'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ç¤ºä¾‹ï¼šyarn template goodMenu/test'</span>);</span><br><span class="line">    process.exit(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">titleCase</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> array = str.toLowerCase().split(<span class="string">' '</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">        array[i] = array[i][<span class="number">0</span>].toUpperCase() + array[i].substring(<span class="number">1</span>, array[i].length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> string = array.join(<span class="string">' '</span>);</span><br><span class="line">    <span class="keyword">return</span> string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢æ¨¡ç‰ˆ</span></span><br><span class="line"><span class="keyword">const</span> indexTep = <span class="string">`</span></span><br><span class="line"><span class="string">import React, &#123;Component, Fragment&#125; from 'react';</span></span><br><span class="line"><span class="string">import &#123;connect&#125; from 'react-redux'</span></span><br><span class="line"><span class="string">import PropTypes from "prop-types"</span></span><br><span class="line"><span class="string">import &#123;Form, Input, Button, DatePicker, Checkbox, InputNumber, Upload, Icon, Modal, Radio, Drawer, Card&#125; from 'antd';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import "./index.less"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">class Index extends Component &#123;</span></span><br><span class="line"><span class="string">    constructor(props) &#123;</span></span><br><span class="line"><span class="string">        super(props);</span></span><br><span class="line"><span class="string">        this.state = &#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    componentDidMount() &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    render() &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        return (</span></span><br><span class="line"><span class="string">            &lt;div&gt;</span></span><br><span class="line"><span class="string">                111</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default Index;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Index.defaultProps = &#123;</span></span><br><span class="line"><span class="string">    data:[]</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">Index.propTypes = &#123;</span></span><br><span class="line"><span class="string">    data: PropTypes.array.isRequired//å¿…é¡»æœ‰</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lessæ–‡ä»¶æ¨¡ç‰ˆ</span></span><br><span class="line"><span class="keyword">const</span> lessTep = <span class="string">``</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// modelæ–‡ä»¶æ¨¡ç‰ˆ</span></span><br><span class="line"><span class="keyword">const</span> modelTep = <span class="string">`</span></span><br><span class="line"><span class="string">import &#123;queryShopList&#125; from './service';</span></span><br><span class="line"><span class="string">import &#123;scenicid, shopid&#125; from '@/utils/scenicid';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default &#123;</span></span><br><span class="line"><span class="string">    namespace: 'groupBuy',</span></span><br><span class="line"><span class="string">    state: &#123;</span></span><br><span class="line"><span class="string">        data: [],</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    effects: &#123;</span></span><br><span class="line"><span class="string">        * fetch(action, &#123;call, put&#125;) &#123;</span></span><br><span class="line"><span class="string">            // const &#123; banner &#125; = yield select(state =&gt; state.home);</span></span><br><span class="line"><span class="string">            const &#123;data&#125; = yield call(queryShopList, scenicid()['id']);</span></span><br><span class="line"><span class="string">            yield put(&#123;</span></span><br><span class="line"><span class="string">                type: 'save',</span></span><br><span class="line"><span class="string">                payload: &#123;</span></span><br><span class="line"><span class="string">                    data: data,</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    reducers: &#123;</span></span><br><span class="line"><span class="string">        save(state, &#123;payload&#125;) &#123;</span></span><br><span class="line"><span class="string">            return &#123;...state, ...payload&#125;;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// serviceé¡µé¢æ¨¡ç‰ˆ</span></span><br><span class="line"><span class="keyword">const</span> serviceTep = <span class="string">`</span></span><br><span class="line"><span class="string">import axios from '@/api/axios';</span></span><br><span class="line"><span class="string">import &#123;url&#125; from '@/api/config'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import &#123;getCookie&#125; from "@/utils/cookie";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export const queryShopList = (id) =&gt; &#123;</span></span><br><span class="line"><span class="string">    const baseUrl = '';</span></span><br><span class="line"><span class="string">    return axios.get(baseUrl);</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fs.mkdirSync(<span class="string">`./src/pages/<span class="subst">$&#123;dirName&#125;</span>`</span>); <span class="comment">// mkdir $1</span></span><br><span class="line">process.chdir(<span class="string">`./src/pages/<span class="subst">$&#123;dirName&#125;</span>`</span>); <span class="comment">// cd $1</span></span><br><span class="line"></span><br><span class="line">fs.writeFileSync(<span class="string">'index.js'</span>, indexTep);</span><br><span class="line">fs.writeFileSync(<span class="string">'index.less'</span>, lessTep);</span><br><span class="line">fs.writeFileSync(<span class="string">'model.js'</span>, modelTep);</span><br><span class="line">fs.writeFileSync(<span class="string">'service.js'</span>, serviceTep);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`æ¨¡ç‰ˆ<span class="subst">$&#123;dirName&#125;</span>å·²åˆ›å»º,è¯·æ‰‹åŠ¨å¢åŠ models`</span>);</span><br><span class="line"></span><br><span class="line">process.exit(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Taro </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¡¹ç›®ç›®å½•</title>
      <link href="/2019/07/01/workspace/Frame/taro/toc/"/>
      <url>/2019/07/01/workspace/Frame/taro/toc/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>é¡¹ç›®ç›®å½•</strong></p><p>[[toc]]</p><p><strong>ä»¥Taroä¸ºæ —å­</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â”œâ”€config   -- é…ç½®æ–‡ä»¶(æ’ä»¶ç­‰)  </span><br><span class="line">â”‚      dev.js  --å¼€å‘é¡¹ç›®é…ç½®</span><br><span class="line">â”‚      index.js  --é€‚ç”¨äºå¼€å‘å’Œç”Ÿäº§</span><br><span class="line">â”‚      prod.js   --ç”Ÿäº§é¡¹ç›®é…ç½®</span><br><span class="line">â”‚      template.js  --nodeå†™çš„æ–‡ä»¶æ¨¡æ¿ï¼Œç›´æ¥æ„å»º</span><br><span class="line">â”œâ”€src  </span><br><span class="line">â”‚  â”‚--app.tsx  --é¡¹ç›®å…¥å£æ–‡ä»¶ </span><br><span class="line">â”‚  â”‚--app.scss  -- å…¨å±€æ ·å¼æ–‡ä»¶(ä¼šè‡ªåŠ¨å¼•å…¥)  </span><br><span class="line">â”‚  â”‚--global.tsx  -- é¡¹ç›®å…¨å±€å¼•å…¥(å¯åœ¨é‡Œé¢å¼•å…¥ä¸€äº›å…¨å±€ç”¨åˆ°çš„åŒ…)  </span><br><span class="line">â”‚  â”œâ”€assets  --èµ„æºæ–‡ä»¶  </span><br><span class="line">â”‚  â”œâ”€components    --ç³»ç»Ÿé€šç”¨ç»„ä»¶</span><br><span class="line">â”‚  â”œâ”€layouts   -- å¸ƒå±€æ–‡ä»¶å¤¹   </span><br><span class="line">â”‚  â”œâ”€models  --å…¨å±€model(éå…¨å±€çš„ä¸èƒ½æ”¾åˆ°è¿™ä¸ªä¸‹é¢)  </span><br><span class="line">â”‚  â”œâ”€pages  --ä¸šåŠ¡ç›¸å…³é¡µé¢  </span><br><span class="line">â”‚  |ä¸šåŠ¡ä¸­ç”¨åˆ°çš„é¡µé¢å»ºè®®æŒ‰æ¨¡å—åˆ’åˆ†ï¼Œæ³¨æ„å¤§å°å†™ä¿æŒä¸€è‡´  </span><br><span class="line">â”‚  |å¦‚æœç”¨åˆ°modelï¼Œæ³¨æ„å¢åŠ modelsæ–‡ä»¶å¤¹ modelçš„namespaceå¾—å…¨å±€å”¯ä¸€ï¼Œå»ºè®®æŒ‰æ–‡ä»¶å¤¹å±‚çº§å‘½å  </span><br><span class="line">â”‚  |</span><br><span class="line">â”‚  â”œâ”€service  -- æœåŠ¡æ–¹æ³• </span><br><span class="line">â”‚  â”‚      api.ts --requestçš„äºŒæ¬¡å°è£…</span><br><span class="line">â”‚  â”‚      global.service.ts   --å…¨å±€ç”¨åˆ°çš„æ¥å£</span><br><span class="line">â”‚  â”‚      config.default.ts  --çŠ¶æ€ç å’Œç”Ÿäº§å¼€å‘åŸŸåçš„é…ç½®</span><br><span class="line">â”‚  â”œâ”€dev  --å¼€å‘ä¸“ç”¨çš„ä¸€äº›å¿«æ·æ–¹å¼</span><br><span class="line">â”‚  â”œâ”€bases  -- åº•å±‚æ¡†æ¶çš„å°è£…</span><br><span class="line">â”‚  â”œâ”€types  --ç³»ç»Ÿä¸­ç”¨åˆ°çš„ä¸€äº›ç±»å‹å®šä¹‰    </span><br><span class="line">â”‚  â”œâ”€utils  --è¾…åŠ©æ–¹æ³•</span><br><span class="line">â”‚  â”‚      lodash.ts  --æƒé™è¾…åŠ©æ–¹æ³•  </span><br><span class="line">â”‚  â”‚      storage.ts  --æœ¬åœ°å­˜å‚¨çš„ä¸€äº›æ–¹æ³•</span><br><span class="line">â”‚  â”‚      index.ts  --é€šç”¨è¾…åŠ©æ–¹æ³•(å¯¼å…¥çš„æ—¶å€™ import &#123;xx&#125; from &#39;@&#x2F;utils&#39;å³å¯)  </span><br><span class="line">â”‚  â”‚      docs.ts   --ä¸€äº›çŠ¶æ€å±•ç¤ºç”¨çš„æ–¹æ³•</span><br><span class="line">â”‚  â”‚      constants.ts  --å®šä¹‰çš„ä¸€äº›å¸¸é‡</span><br><span class="line">â”‚  â”‚      regexp.ts --æ­£åˆ™ç›¸å…³è¾…åŠ©æ–¹æ³•   </span><br><span class="line">â”‚  â”‚      router.ts --è·¯ç”±ç›¸å…³çš„æ–¹æ³•</span><br><span class="line">â”‚  â””â”€</span><br><span class="line">â””â”€project.config.json --å¾®ä¿¡å°ç¨‹åºçš„é…ç½®</span><br><span class="line">â””â”€project.swan.json --ç™¾åº¦æ™ºèƒ½å°ç¨‹åº</span><br><span class="line">â””â”€project.tt.json --å¤´æ¡å°ç¨‹åºçš„é…ç½®</span><br><span class="line">â””â”€project.quickapp.json --å¿«åº”ç”¨</span><br><span class="line">â””â”€project.qq.json --QQå°ç¨‹åº</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Taro </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å•å…ƒæµ‹è¯•æ¡†æ¶Jestå­¦ä¹ æ€»ç»“</title>
      <link href="/2019/07/01/workspace/Frame/unit-test/jest/"/>
      <url>/2019/07/01/workspace/Frame/unit-test/jest/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>å•å…ƒæµ‹è¯•æ¡†æ¶Jestå­¦ä¹ æ€»ç»“</strong></p><p>[[toc]]</p><h3 id="æµ‹è¯•æ¡†æ¶"><a href="#æµ‹è¯•æ¡†æ¶" class="headerlink" title="æµ‹è¯•æ¡†æ¶"></a>æµ‹è¯•æ¡†æ¶</h3><p><code>Mocha+chai</code>(æ–­è¨€åº“)<br/><br>yarn add mocha chai -D</p><p><code>Jest</code><br/><br>yarn add jest -D</p><h3 id="é€‚åˆåœºæ™¯"><a href="#é€‚åˆåœºæ™¯" class="headerlink" title="é€‚åˆåœºæ™¯"></a>é€‚åˆåœºæ™¯</h3><ul><li>ä¸šåŠ¡æ¯”è¾ƒå¤æ‚</li><li>å…¬å¸éå¸¸æ³¨é‡ä»£ç è´¨é‡ï¼Œæƒ³å°½ä¸€åˆ‡åŠæ³•æœç»çº¿ä¸Šå‡ºbug</li><li>éœ€è¦é•¿æœŸç»´æŠ¤çš„é¡¹ç›®ã€‚å®ƒä»¬éœ€è¦æµ‹è¯•æ¥ä¿éšœä»£ç å¯ç»´æŠ¤æ€§ã€åŠŸèƒ½çš„ç¨³å®šæ€§</li><li>è¢«å¤šæ¬¡å¤ç”¨çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚ä¸€äº›é€šç”¨ç»„ä»¶å’Œåº“å‡½æ•°ã€‚å› ä¸ºå¤šå¤„å¤ç”¨ï¼Œæ›´è¦ä¿éšœè´¨é‡</li><li>å¼€æºé¡¹ç›®</li></ul><h3 id="æµ‹è¯•çš„æ­¥éª¤"><a href="#æµ‹è¯•çš„æ­¥éª¤" class="headerlink" title="æµ‹è¯•çš„æ­¥éª¤"></a>æµ‹è¯•çš„æ­¥éª¤</h3><ul><li>å†™æµ‹è¯•è¯´æ˜ï¼Œé’ˆå¯¹ä½ çš„æ¯æ¡æµ‹è¯•è¯´æ˜æµ‹è¯•äº†ä»€ä¹ˆåŠŸèƒ½ï¼Œé¢„æœŸç»“æœæ˜¯ä»€ä¹ˆã€‚</li><li>å†™æµ‹è¯•ä¸»ä½“ï¼Œé€šå¸¸æ˜¯ è¾“å…¥ -&gt; è¾“å‡ºã€‚</li><li>åˆ¤æ–­æµ‹è¯•ç»“æœï¼Œæ‹¿è¾“å‡ºå’Œé¢„æœŸåšå¯¹æ¯”ã€‚å¦‚æœè¾“å‡ºå’Œé¢„æœŸç›¸ç¬¦ï¼Œåˆ™æµ‹è¯•é€šè¿‡ã€‚åä¹‹ï¼Œä¸é€šè¿‡ã€‚</li></ul><p><strong>yarn add jest @types/jest  babel-jest babel-core babel-preset-env regenerator-runtime -D</strong></p><p>Jestæœ¬èº«æ˜¯ä¸æ”¯æŒes6çš„ï¼Œä½†æ˜¯åœ¨reactä¸­å·²ç»é…ç½®å¥½babelç­‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ES6çš„è¯­æ³•ç‰¹æ€§è¿›è¡Œå•å…ƒæµ‹è¯•</p><p><strong>ä½¿ç”¨æ–¹å¼</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">expect(<span class="number">1</span>).not.toBe(<span class="number">2</span>)<span class="comment">//åˆ¤æ–­ä¸ç­‰</span></span><br></pre></td></tr></table></figure><p><code>toBe()</code> ç»å¯¹ç›¸ç­‰<br/><br><code>toEqual()</code> åˆ¤æ–­å¯¹è±¡æˆ–è€…æ•°ç»„æ˜¯å¦ç›¸ç­‰<br/><br><code>toBeNull()</code>åªåŒ¹é…null<br/><br><code>toContain()</code>æ£€æµ‹æ•°ç»„ä¸­æ˜¯å¦åŒ…å«ç‰¹å®šæŸä¸€é¡¹<br/><br><code>toBeUndefined()</code>åªåŒ¹é…undefined<br/><br><code>toBeDefine()</code>ä¸toBeUndefinedç›¸å<br/><br><code>toBeTruthy()</code>åŒ¹é…ä»»ä½•ifè¯­å¥ä¸ºçœŸ<br/><br><code>toBeFalsy()</code>åŒ¹é…ä»»ä½•ifè¯­å¥ä¸ºå‡<br/><br><code>toBeCloseTo(0.3)</code> æµ®ç‚¹æ•°åˆ¤æ–­ç›¸ç­‰<br/></p><p> <strong>æ•°å­—åŒ¹é…å™¨</strong><br/><br><code>toBeGreaterThan()</code>å¤§äº<br/><br><code>toBeGreaterThanOrEqual()</code>å¤§äºæˆ–è€…ç­‰äº<br/><br><code>toBeLessThan()</code>å°äº<br/><br><code>toBeLessThanOrEqual()</code>å°äºæˆ–ç­‰äº<br/></p><h3 id="reacté¡¹ç›®packageé‡Œé¢å…³äºjestçš„é…ç½®"><a href="#reacté¡¹ç›®packageé‡Œé¢å…³äºjestçš„é…ç½®" class="headerlink" title="reacté¡¹ç›®packageé‡Œé¢å…³äºjestçš„é…ç½®"></a>reacté¡¹ç›®packageé‡Œé¢å…³äºjestçš„é…ç½®</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">   <span class="string">"test"</span>:<span class="string">"jest"</span>, <span class="comment">//å…¨éƒ¨æµ‹è¯•</span></span><br><span class="line">   <span class="string">"app"</span>:<span class="string">"jest /test/app.test.js --watch"</span>  <span class="comment">//å•ä¸ªæµ‹è¯•  --watchæŒç»­æ£€æµ‹</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"jest"</span>: &#123;</span><br><span class="line">   <span class="string">"collectCoverage"</span>:<span class="literal">true</span>,  <span class="comment">//æŸ¥çœ‹è¦†ç›–çš„æ–‡ä»¶  `å¯ä»¥ç›´æ¥è¾“å…¥ jest --coverage ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š`</span></span><br><span class="line">   <span class="string">"collectCoverageFrom"</span>: [ <span class="comment">//å“ªäº›æ–‡ä»¶éœ€è¦æ”¶é›†è¦†ç›–ç‡ä¿¡æ¯ </span></span><br><span class="line">     <span class="string">"src/**/*.&#123;js,jsx,ts,tsx&#125;"</span>,</span><br><span class="line">     <span class="string">"!src/**/*.d.ts"</span></span><br><span class="line">   ],</span><br><span class="line">   <span class="string">"coverageDirectory"</span>: <span class="string">"tests/coverage"</span>, <span class="comment">//è¦†ç›–çš„æ–‡ä»¶è¾“å…¥åˆ°testsæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line">   <span class="string">"resolver"</span>: <span class="string">"jest-pnp-resolver"</span>,</span><br><span class="line">   <span class="string">"setupFiles"</span>: [</span><br><span class="line">     <span class="string">"react-app-polyfill/jsdom"</span></span><br><span class="line">   ],</span><br><span class="line">   <span class="string">"testMatch"</span>: [ <span class="comment">//è®¾ç½®è¯†åˆ«å“ªäº›æ–‡ä»¶æ˜¯æµ‹è¯•æ–‡ä»¶</span></span><br><span class="line">     <span class="string">"&lt;rootDir&gt;/test/**/__tests__/**/*.&#123;js,jsx,ts,tsx&#125;"</span>,</span><br><span class="line">     <span class="string">"&lt;rootDir&gt;/test/**/?(*.)(spec|test).&#123;js,jsx,ts,tsx&#125;"</span></span><br><span class="line">   ],</span><br><span class="line">   <span class="string">"testEnvironment"</span>: <span class="string">"jsdom"</span>,</span><br><span class="line">   <span class="string">"testURL"</span>: <span class="string">"http://localhost"</span>,</span><br><span class="line">   <span class="string">"transform"</span>: &#123;</span><br><span class="line">     <span class="string">"^.+\\.(js|jsx|ts|tsx)$"</span>: <span class="string">"&lt;rootDir&gt;/node_modules/babel-jest"</span>,</span><br><span class="line">     <span class="string">"^.+\\.css$"</span>: <span class="string">"&lt;rootDir&gt;/config/jest/cssTransform.js"</span>,</span><br><span class="line">     <span class="string">"^(?!.*\\.(js|jsx|ts|tsx|css|json)$)"</span>: <span class="string">"&lt;rootDir&gt;/config/jest/fileTransform.js"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"transformIgnorePatterns"</span>: [</span><br><span class="line">     <span class="string">"[/\\\\]node_modules[/\\\\].+\\.(js|jsx|ts|tsx)$"</span>,</span><br><span class="line">     <span class="string">"^.+\\.module\\.(css|sass|scss|less)$"</span></span><br><span class="line">   ],</span><br><span class="line">   <span class="string">"moduleNameMapper"</span>: &#123; </span><br><span class="line">     <span class="string">"^react-native$"</span>: <span class="string">"react-native-web"</span>,</span><br><span class="line">     <span class="string">"^.+\\.module\\.(css|sass|scss|less)$"</span>: <span class="string">"identity-obj-proxy"</span>, <span class="comment">//css moduleçš„é—®é¢˜</span></span><br><span class="line">     <span class="string">"^@(.*)$"</span>: <span class="string">"&lt;rootDir&gt;/src$1"</span> <span class="comment">//jestçš„åˆ«åè®¾ç½®</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"moduleFileExtensions"</span>: [ <span class="comment">//æµ‹è¯•æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">     <span class="string">"js"</span>,</span><br><span class="line">     <span class="string">"ts"</span>,</span><br><span class="line">     <span class="string">"tsx"</span>,</span><br><span class="line">     <span class="string">"json"</span>,</span><br><span class="line">     <span class="string">"jsx"</span>,</span><br><span class="line">     <span class="string">"node"</span></span><br><span class="line">   ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç è¦†ç›–ç‡"><a href="#ä»£ç è¦†ç›–ç‡" class="headerlink" title="ä»£ç è¦†ç›–ç‡"></a>ä»£ç è¦†ç›–ç‡</h3><p>å¯ä»¥æŸ¥çœ‹ä½ é‚£äº›ä»£ç æ²¡æœ‰è¢«è¦†ç›–ï¼Œå¸®åŠ©ä½ å‘ç°ç›²ç‚¹</p><ul><li>åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ â€œâ€“coverageâ€ flag æŒ‡å®š</li><li>åœ¨ package.json ä¸­æ‰‹åŠ¨é…ç½®</li></ul><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H90bd3a97f33a427ebe9de0b3a3e42a2dc.png" alt=""></p><p><strong>Uncovered Line</strong> æ˜¯å“ªè¡Œæ²¡æœ‰è¢«è¦†ç›–</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ç¼–å†™æµ‹è¯•æ–‡ä»¶æ—¶éµå¾ªçš„å‘½åè§„èŒƒï¼š<code>æµ‹è¯•æ–‡ä»¶çš„æ–‡ä»¶å</code> = <code>è¢«æµ‹è¯•æ¨¡å—å</code> + .test.js</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//function.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    fetchUser() &#123;</span><br><span class="line">        <span class="keyword">return</span> axios.get(<span class="string">'http://jsonplaceholder.typicode.com/users/1'</span>)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span> =&gt;</span> res.data)</span><br><span class="line">            .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error));</span><br><span class="line">    &#125;,</span><br><span class="line">    sum(a, b) &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//function.test.js</span></span><br><span class="line"><span class="keyword">import</span> functions <span class="keyword">from</span> <span class="string">'../src/functions'</span>;</span><br><span class="line">test(<span class="string">'fetchUser() å¯ä»¥è¯·æ±‚åˆ°ä¸€ä¸ªå«æœ‰nameå±æ€§å€¼ä¸ºLeanne Grahamçš„å¯¹è±¡'</span>, () =&gt; &#123;</span><br><span class="line">    expect.assertions(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> functions.fetchUser()</span><br><span class="line">        .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            expect(data.name).toBe(<span class="string">'Leanne Graham'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">it(<span class="string">'fetchUser() å¯ä»¥è¯·æ±‚åˆ°ä¸€ä¸ªå«æœ‰nameå±æ€§å€¼ä¸ºLeanne Grahamçš„å¯¹è±¡  async -- await'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    expect.assertions(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> functions.fetchUser();</span><br><span class="line"></span><br><span class="line">    expect(data.name).toBe(<span class="string">'Leanne Graham'</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">describe(<span class="string">'åŠ æ³•å‡½æ•°æµ‹è¯•'</span>, () =&gt; &#123;</span><br><span class="line">    it(<span class="string">'1åŠ 2åº”è¯¥ç­‰äº3'</span>, () =&gt; &#123;</span><br><span class="line">        expect(functions.sum(<span class="number">1</span>, <span class="number">2</span>)).toBe(<span class="number">3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">test(<span class="string">'sum(2 + 2) ç­‰äº 4'</span>, () =&gt; &#123;</span><br><span class="line">    expect(functions.sum(<span class="number">2</span>, <span class="number">2</span>)).toBe(<span class="number">4</span>);</span><br><span class="line">&#125;);</span><br><span class="line">test(<span class="string">'sum(2 + 2) ç­‰äº 4'</span>, () =&gt; &#123;</span><br><span class="line">    expect(functions.sum(<span class="number">2</span>, <span class="number">2</span>)).not.toBe(<span class="number">1008611</span>);</span><br><span class="line">&#125;);</span><br><span class="line">test(<span class="string">'there is no I in team'</span>, () =&gt; &#123;</span><br><span class="line">    expect(<span class="string">'team'</span>).not.toMatch(<span class="regexp">/I/</span>);</span><br><span class="line">&#125;);</span><br><span class="line">test(<span class="string">'but there is a â€œstopâ€ in Christoph'</span>, () =&gt; &#123;</span><br><span class="line">    expect(<span class="string">'Christoph'</span>).toMatch(<span class="regexp">/stop/</span>);</span><br><span class="line">&#125;);</span><br><span class="line">test(<span class="string">'æµ‹è¯•æµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰'</span>, () =&gt; &#123;</span><br><span class="line">    expect(<span class="number">0.003</span> + <span class="number">0.01</span>).toBeCloseTo(<span class="number">0.013</span>);  <span class="comment">//è¿™é‡Œä¸èƒ½ä½¿ç”¨toBe</span></span><br><span class="line">&#125;);</span><br><span class="line">test(<span class="string">'å¯¹è±¡åˆ¤æ–­æ˜¯å¦ç›¸ç­‰'</span>, () =&gt; &#123;</span><br><span class="line">    expect(&#123;<span class="attr">test</span>: <span class="string">"11111"</span>&#125;).toEqual(&#123;<span class="attr">test</span>: <span class="string">"11111"</span>&#125;); <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">describe(<span class="string">"ç­›é€‰æ•°ç»„"</span>, () =&gt; &#123;</span><br><span class="line">    test(<span class="string">"it should filter by a search term (link)"</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> input = [</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">url</span>: <span class="string">"https://www.url1.dev"</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">url</span>: <span class="string">"https://www.url2.dev"</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">url</span>: <span class="string">"https://www.link3.dev"</span>&#125;</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> output = [&#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">url</span>: <span class="string">"https://www.link3.dev"</span>&#125;];</span><br><span class="line"></span><br><span class="line">        expect(filterByTerm(input, <span class="string">"link"</span>)).toEqual(output);</span><br><span class="line"></span><br><span class="line">        expect(filterByTerm(input, <span class="string">"LINK"</span>)).toEqual(output);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterByTerm</span>(<span class="params">inputArr, searchTerm</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(searchTerm, <span class="string">"i"</span>);</span><br><span class="line">    <span class="keyword">const</span> a = inputArr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">arrayElement</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arrayElement.url.match(regex);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœªå®Œå¾…ç»­â€¦"><a href="#æœªå®Œå¾…ç»­â€¦" class="headerlink" title="æœªå®Œå¾…ç»­â€¦"></a>æœªå®Œå¾…ç»­â€¦</h3><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://zh-hans.reactjs.org/docs/test-utils.html" target="_blank" rel="noopener">*ReactTestUtils</a></p><p><a href="https://www.jianshu.com/p/aee9a19d5e6a" target="_blank" rel="noopener">å‚è€ƒæ–‡æ¡£</a></p><p><a href="https://www.jianshu.com/p/aee9a19d5e6a" target="_blank" rel="noopener">å‚è€ƒæ–‡æ¡£2</a></p><p><a href="http://www.voidcn.com/article/p-ftetcszg-btt.html" target="_blank" rel="noopener">jest åˆ«å</a></p><p><a href="https://juejin.im/post/5df73d35e51d45581509a1c2?utm_source=gold_browser_extension" target="_blank" rel="noopener">Jest å…¥é—¨æ•™ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> Jest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Mongooseä½¿ç”¨</title>
      <link href="/2019/06/10/workspace/Server/sql/mongoose/"/>
      <url>/2019/06/10/workspace/Server/sql/mongoose/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Mongooseä½¿ç”¨</strong></p><p>[[toc]]</p><h3 id="é“¾æ¥mongo"><a href="#é“¾æ¥mongo" class="headerlink" title="é“¾æ¥mongo"></a>é“¾æ¥mongo</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @ use æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../../config/common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dbConfig = config[process.env.NODE_ENV || <span class="string">'development'</span>];</span><br><span class="line"></span><br><span class="line">mongoose.connect(dbConfig.mongo.url, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">mongoose.set(<span class="string">'useCreateIndex'</span>, <span class="literal">true</span>); <span class="comment">//åŠ ä¸Šè¿™ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æˆåŠŸ</span></span><br><span class="line">mongoose.connection.on(<span class="string">'connected'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//console.log('è¿æ¥æˆåŠŸ ' + dbConfig.mongo.url);</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥å¤±è´¥</span></span><br><span class="line">mongoose.connection.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'è¿æ¥å¤±è´¥ '</span> + err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–­å¼€è¿æ¥</span></span><br><span class="line">mongoose.connection.on(<span class="string">'disconnected'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ–­å¼€è¿æ¥'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰Schema"><a href="#å®šä¹‰Schema" class="headerlink" title="å®šä¹‰Schema"></a>å®šä¹‰Schema</h3><h4 id="Schema-Type"><a href="#Schema-Type" class="headerlink" title="Schema.Type"></a>Schema.Type</h4><ul><li>String</li><li>Number</li><li>Date</li><li>Buffer</li><li>Boolean</li><li>Mixed</li><li>Objectid</li><li>Array</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">var</span> Schema   = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> UserSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    name  : &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">unique</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    posts : [&#123; <span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">'Post'</span> &#125;]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> User = mongoose.model(<span class="string">'User'</span>, UserSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> PostSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    poster   : &#123; <span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">'User'</span> &#125;,</span><br><span class="line">    comments : [&#123; <span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">'Comment'</span> &#125;],</span><br><span class="line">    title    : <span class="built_in">String</span>,</span><br><span class="line">    content  : <span class="built_in">String</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> Post = mongoose.model(<span class="string">'Post'</span>, PostSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> CommentSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    post      : &#123; <span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">"Post"</span> &#125;,</span><br><span class="line">    commenter : &#123; <span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">'User'</span> &#125;,</span><br><span class="line">    content   : &#123;</span><br><span class="line">        main: <span class="built_in">String</span>,</span><br><span class="line">        label: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    points: [</span><br><span class="line">        point: [&#123;<span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">'Point'</span>&#125;]</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> Comment = mongoose.model(<span class="string">'Comment'</span>, CommentSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> PointSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  name: <span class="built_in">String</span>,</span><br><span class="line">  parent: &#123;<span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">'point'</span>&#125;,</span><br><span class="line">  children: [&#123;<span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">'point'</span>&#125;]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> Point = mongoose.model(<span class="string">'Point'</span>, PointSchema);</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢æ¡ä»¶"><a href="#æŸ¥è¯¢æ¡ä»¶" class="headerlink" title="æŸ¥è¯¢æ¡ä»¶"></a>æŸ¥è¯¢æ¡ä»¶</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">$orã€€ã€€ã€€ã€€æˆ–å…³ç³»</span><br><span class="line">$norã€€ã€€ã€€ æˆ–å…³ç³»å–å</span><br><span class="line">$gtã€€ã€€ã€€ã€€å¤§äº</span><br><span class="line">$gteã€€ã€€ã€€ å¤§äºç­‰äº</span><br><span class="line">$ltã€€ã€€ã€€ã€€ å°äº</span><br><span class="line">$lteã€€ã€€ã€€  å°äºç­‰äº</span><br><span class="line">$ne            ä¸ç­‰äº</span><br><span class="line">$in             åœ¨å¤šä¸ªå€¼èŒƒå›´å†…</span><br><span class="line">$nin           ä¸åœ¨å¤šä¸ªå€¼èŒƒå›´å†…</span><br><span class="line">$all            åŒ¹é…æ•°ç»„ä¸­å¤šä¸ªå€¼</span><br><span class="line">$regexã€€ã€€æ­£åˆ™ï¼Œç”¨äºæ¨¡ç³ŠæŸ¥è¯¢</span><br><span class="line">$sizeã€€ã€€ã€€åŒ¹é…æ•°ç»„å¤§å°</span><br><span class="line">$maxDistanceã€€ã€€èŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»ï¼ˆåŸºäºLBSï¼‰</span><br><span class="line">$modã€€ã€€   å–æ¨¡è¿ç®—</span><br><span class="line">$nearã€€ã€€ã€€é‚»åŸŸæŸ¥è¯¢ï¼ŒæŸ¥è¯¢é™„è¿‘çš„ä½ç½®ï¼ˆåŸºäºLBSï¼‰</span><br><span class="line">$existsã€€ã€€  å­—æ®µæ˜¯å¦å­˜åœ¨</span><br><span class="line">$elemMatchã€€ã€€åŒ¹é…å†…æ•°ç»„å†…çš„å…ƒç´ </span><br><span class="line">$withinã€€ã€€èŒƒå›´æŸ¥è¯¢ï¼ˆåŸºäºLBSï¼‰</span><br><span class="line">$boxã€€ã€€ã€€ èŒƒå›´æŸ¥è¯¢ï¼ŒçŸ©å½¢èŒƒå›´ï¼ˆåŸºäºLBSï¼‰</span><br><span class="line">$center       èŒƒå›´é†’è¯¢ï¼Œåœ†å½¢èŒƒå›´ï¼ˆåŸºäºLBSï¼‰</span><br><span class="line">$centerSphereã€€ã€€èŒƒå›´æŸ¥è¯¢ï¼Œçƒå½¢èŒƒå›´ï¼ˆåŸºäºLBSï¼‰</span><br><span class="line">$sliceã€€ã€€ã€€ã€€æŸ¥è¯¢å­—æ®µé›†åˆä¸­çš„å…ƒç´ ï¼ˆæ¯”å¦‚ä»ç¬¬å‡ ä¸ªä¹‹åï¼Œç¬¬Nåˆ°ç¬¬Mä¸ªå…ƒç´ ï¼‰</span><br></pre></td></tr></table></figure><h3 id="mongodbå¯¹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œä¸€æ¬¡æ€§ä¿®æ”¹æ–¹æ³•"><a href="#mongodbå¯¹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œä¸€æ¬¡æ€§ä¿®æ”¹æ–¹æ³•" class="headerlink" title="mongodbå¯¹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œä¸€æ¬¡æ€§ä¿®æ”¹æ–¹æ³•"></a>mongodbå¯¹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œä¸€æ¬¡æ€§ä¿®æ”¹æ–¹æ³•</h3><p><strong>$[]</strong></p><p>å¯ä»¥é€šè¿‡$[element] é…åˆ $cond æ¡ä»¶æ“ä½œç¬¦ç­‰ï¼Œæ¥è¾¾åˆ°å¯¹æ•°ç»„çš„ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ç»Ÿä¸€æ›´æ–°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    name: <span class="number">4</span>,</span><br><span class="line">    list: [&#123;</span><br><span class="line">        id: <span class="string">"a"</span>,</span><br><span class="line">        date: <span class="number">1504195200000</span>,</span><br><span class="line">        other: <span class="string">"c"</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        id: <span class="string">"b"</span>,</span><br><span class="line">        date: <span class="number">1504195200000</span>,</span><br><span class="line">        other: <span class="string">"c"</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¦æŠŠotherå…¨éƒ¨æ›´æ–°ä¸ºâ€aâ€,æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">db.getCollection(<span class="string">'test'</span>).update(&#123;<span class="string">'name'</span>: <span class="number">4</span>&#125;, &#123;<span class="attr">$set</span>: &#123;<span class="string">'list.$[].other'</span>: <span class="string">'a'</span>&#125;&#125;, &#123;<span class="attr">multi</span>: <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“ä¸­â€¦"><a href="#æ€»ç»“ä¸­â€¦" class="headerlink" title="æ€»ç»“ä¸­â€¦"></a>æ€»ç»“ä¸­â€¦</h3>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> Mongodb </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mongoose </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å †å†…å­˜ &amp; æ ˆå†…å­˜</title>
      <link href="/2019/05/16/workspace/Js/heap_stack/"/>
      <url>/2019/05/16/workspace/Js/heap_stack/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>å †å†…å­˜ &amp; æ ˆå†…å­˜</strong></p><p>[[toc]]</p><p>å‰å‡ å¤©é¢è¯•åˆšé—®åˆ°çš„ ï¼Œè¿™å‡ å¤©æœ‰ç©ºè¯æ€»ç»“ä¸‹ </p><p>åœ¨jså¼•æ“ä¸­å¯¹å˜é‡çš„å­˜å‚¨ä¸»è¦æœ‰ä¸¤ç§å†…å­˜ï¼Œå †å†…å­˜ï¼ˆheapï¼‰å’Œæ ˆå†…å­˜ï¼ˆstackï¼‰ï¼Œä¸‹é¢ä»ä¸‰ä¸ªæ–¹é¢ç®€å•ä»‹ç»</p><h3 id="å­˜å‚¨è§’åº¦"><a href="#å­˜å‚¨è§’åº¦" class="headerlink" title="å­˜å‚¨è§’åº¦"></a>å­˜å‚¨è§’åº¦</h3><p><strong>æ ˆå†…å­˜</strong> ä¸»è¦ç”¨äºå­˜å‚¨å„ç§åŸºæœ¬ç±»å‹çš„å˜é‡ï¼ŒåŒ…æ‹¬<code>Booleanã€Numberã€Stringã€Undefinedã€Null</code>ä»¥åŠå¯¹è±¡å˜é‡çš„<code>æŒ‡é’ˆ</code>ï¼Œè¿™æ—¶å€™æ ˆå†…å­˜ç»™äººçš„æ„Ÿè§‰å°±åƒä¸€ä¸ªçº¿æ€§æ’åˆ—çš„ç©ºé—´ï¼Œæ¯ä¸ªå°å•å…ƒå¤§å°åŸºæœ¬ç›¸ç­‰ã€‚</p><p><strong>å †å†…å­˜</strong> ä¸»è¦è´Ÿè´£åƒå¯¹è±¡<code>Object</code>è¿™ç§å˜é‡ç±»å‹çš„å­˜å‚¨</p><p>ç›—ç”¨ä¸€å¼ å›¾</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H98e4d550d5d444d9b8d1666c70024915J.png" alt=""></p><p>æˆ‘ä»¬å¹³æ—¶ç”¨<code>const</code>å®šä¹‰çš„å¸¸é‡ï¼Œå¦‚æœæ˜¯å¼•ç”¨æ•°æ®ç±»å‹çš„è¯ï¼Œä»…ä»…æ˜¯åœ¨æ ˆå†…å­˜ä¿å­˜çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œå¯¹äºconstå®šä¹‰çš„åŸºç¡€å˜é‡è€Œè¨€ï¼Œè¿™ä¸ªå€¼å°±ç›¸å½“äºconstå¯¹è±¡çš„æŒ‡é’ˆï¼Œæ˜¯ä¸å¯å˜ã€‚å½“<code>let cosnt</code>åœ¨é‡æ–°å£°æ˜çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆéå†å½“å‰çš„<code>å†…å­˜æ ˆ</code>ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰é‡åå˜é‡ï¼Œæœ‰çš„è¯å°±è¿”å›é”™è¯¯</p><h3 id="å­˜å–é€Ÿåº¦"><a href="#å­˜å–é€Ÿåº¦" class="headerlink" title="å­˜å–é€Ÿåº¦"></a>å­˜å–é€Ÿåº¦</h3><p>æ ˆåŒºç”±äºåŸºæœ¬æ•°æ®ç±»å‹å€¼æ¯”è¾ƒç®€å•ï¼Œä»–ä»¬éƒ½æ˜¯ç›´æ¥åœ¨æ ˆå†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªä½ç½®ï¼ŒæŠŠå€¼ç›´æ¥å­˜å‚¨è¿›å»çš„ï¼Œç³»ç»Ÿåˆ†é…æ•ˆç‡é«˜ï¼Œå­˜å–é€Ÿåº¦å¿«</p><p>å †å†…å­˜é¦–å…ˆè¦åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼Œä¹‹ååˆè¦æŠŠæŒ‡é’ˆå­˜å‚¨åˆ°æ ˆå†…å­˜ä¸­ï¼Œæ•ˆç‡ç›¸å¯¹å°±è¦ä½ä¸€äº›äº†ã€‚</p><h3 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h3><p>æ ˆåŒºGCæ¯”è¾ƒé¢‘ç¹ï¼Œå˜é‡åŸºæœ¬ä¸Šç”¨å®Œå°±å›æ”¶äº†</p><p>å †åŒºå†…å­˜ä¸­çš„å˜é‡å› ä¸ºå­˜åœ¨å¾ˆå¤šä¸ç¡®å®šçš„å¼•ç”¨ï¼Œä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œ è‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶æ‰å¯èƒ½è¢«é”€æ¯</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>tsconfigäº†è§£ä¸€ä¸‹</title>
      <link href="/2019/05/11/workspace/Typescript/tsConfig/"/>
      <url>/2019/05/11/workspace/Typescript/tsConfig/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>tsconfigäº†è§£ä¸€ä¸‹</strong></p><p>[[toc]]</p><h3 id="ä¸€äº›å¸¸ç”¨çš„é…ç½®"><a href="#ä¸€äº›å¸¸ç”¨çš„é…ç½®" class="headerlink" title="ä¸€äº›å¸¸ç”¨çš„é…ç½®"></a>ä¸€äº›å¸¸ç”¨çš„é…ç½®</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="comment">/* åŸºæœ¬é€‰é¡¹ */</span></span><br><span class="line">    <span class="string">"target"</span>: <span class="string">"es5"</span>,                       <span class="comment">// æŒ‡å®š ECMAScript ç›®æ ‡ç‰ˆæœ¬: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017', or 'ESNEXT'ï¼ˆ"ESNext"è¡¨ç¤ºæœ€æ–°çš„ESè¯­æ³•ï¼ŒåŒ…æ‹¬è¿˜å¤„åœ¨stage Xé˜¶æ®µï¼‰</span></span><br><span class="line">    <span class="string">"module"</span>: <span class="string">"commonjs"</span>,                  <span class="comment">// æŒ‡å®šä½¿ç”¨æ¨¡å—: 'commonjs', 'amd', 'system', 'umd' or 'es2015'</span></span><br><span class="line">    <span class="string">"lib"</span>: [],                             <span class="comment">// æŒ‡å®šè¦åŒ…å«åœ¨ç¼–è¯‘ä¸­çš„åº“æ–‡ä»¶</span></span><br><span class="line">    <span class="string">"allowJs"</span>: <span class="literal">true</span>,                       <span class="comment">// å…è®¸ç¼–è¯‘ javascript æ–‡ä»¶</span></span><br><span class="line">    <span class="string">"checkJs"</span>: <span class="literal">true</span>,                       <span class="comment">// æŠ¥å‘Š javascript æ–‡ä»¶ä¸­çš„é”™è¯¯</span></span><br><span class="line">    <span class="string">"jsx"</span>: <span class="string">"preserve"</span>,                     <span class="comment">// æŒ‡å®š jsx ä»£ç çš„ç”Ÿæˆ: 'preserve', 'react-native', or 'react'</span></span><br><span class="line">    <span class="string">"declaration"</span>: <span class="literal">true</span>,                   <span class="comment">// ç”Ÿæˆç›¸åº”çš„ '.d.ts' æ–‡ä»¶</span></span><br><span class="line">    <span class="string">"sourceMap"</span>: <span class="literal">true</span>,                     <span class="comment">// ç”Ÿæˆç›¸åº”çš„ '.map' æ–‡ä»¶</span></span><br><span class="line">    <span class="string">"outFile"</span>: <span class="string">"./"</span>,                       <span class="comment">// å°†è¾“å‡ºæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="string">"outDir"</span>: <span class="string">"./"</span>,                        <span class="comment">// æŒ‡å®šè¾“å‡ºç›®å½•</span></span><br><span class="line">    <span class="string">"rootDir"</span>: <span class="string">"./"</span>,                       <span class="comment">// ç”¨æ¥æ§åˆ¶è¾“å‡ºç›®å½•ç»“æ„ --outDir.</span></span><br><span class="line">    <span class="string">"removeComments"</span>: <span class="literal">true</span>,                <span class="comment">// åˆ é™¤ç¼–è¯‘åçš„æ‰€æœ‰çš„æ³¨é‡Š</span></span><br><span class="line">    <span class="string">"noEmit"</span>: <span class="literal">true</span>,                        <span class="comment">// ä¸ç”Ÿæˆè¾“å‡ºæ–‡ä»¶</span></span><br><span class="line">    <span class="string">"importHelpers"</span>: <span class="literal">true</span>,                 <span class="comment">// ä» tslib å¯¼å…¥è¾…åŠ©å·¥å…·å‡½æ•°</span></span><br><span class="line">    <span class="string">"isolatedModules"</span>: <span class="literal">true</span>,               <span class="comment">// å°†æ¯ä¸ªæ–‡ä»¶åšä¸ºå•ç‹¬çš„æ¨¡å— ï¼ˆä¸ 'ts.transpileModule' ç±»ä¼¼ï¼‰.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥é€‰é¡¹ */</span></span><br><span class="line">    <span class="string">"strict"</span>: <span class="literal">true</span>,                        <span class="comment">// å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥é€‰é¡¹</span></span><br><span class="line">    <span class="string">"noImplicitAny"</span>: <span class="literal">true</span>,                 <span class="comment">// åœ¨è¡¨è¾¾å¼å’Œå£°æ˜ä¸Šæœ‰éšå«çš„ anyç±»å‹æ—¶æŠ¥é”™</span></span><br><span class="line">    <span class="string">"strictNullChecks"</span>: <span class="literal">true</span>,              <span class="comment">// å¯ç”¨ä¸¥æ ¼çš„ null æ£€æŸ¥</span></span><br><span class="line">    <span class="string">"noImplicitThis"</span>: <span class="literal">true</span>,                <span class="comment">// å½“ this è¡¨è¾¾å¼å€¼ä¸º any ç±»å‹çš„æ—¶å€™ï¼Œç”Ÿæˆä¸€ä¸ªé”™è¯¯</span></span><br><span class="line">    <span class="string">"alwaysStrict"</span>: <span class="literal">true</span>,                  <span class="comment">// ä»¥ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥æ¯ä¸ªæ¨¡å—ï¼Œå¹¶åœ¨æ¯ä¸ªæ–‡ä»¶é‡ŒåŠ å…¥ 'use strict'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* é¢å¤–çš„æ£€æŸ¥ */</span></span><br><span class="line">    <span class="string">"noUnusedLocals"</span>: <span class="literal">true</span>,                <span class="comment">// æœ‰æœªä½¿ç”¨çš„å˜é‡æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯</span></span><br><span class="line">    <span class="string">"noUnusedParameters"</span>: <span class="literal">true</span>,            <span class="comment">// æœ‰æœªä½¿ç”¨çš„å‚æ•°æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯</span></span><br><span class="line">    <span class="string">"noImplicitReturns"</span>: <span class="literal">true</span>,              <span class="comment">// å¹¶ä¸æ˜¯æ‰€æœ‰å‡½æ•°é‡Œçš„ä»£ç éƒ½æœ‰è¿”å›å€¼æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯</span></span><br><span class="line">    <span class="string">"noFallthroughCasesInSwitch"</span>: <span class="literal">true</span>,     <span class="comment">// æŠ¥å‘Š switch è¯­å¥çš„ fallthrough é”™è¯¯ã€‚ï¼ˆå³ï¼Œä¸å…è®¸ switch çš„ case è¯­å¥è´¯ç©¿ï¼‰</span></span><br><span class="line">    <span class="string">"allowUnreachableCode"</span>: <span class="literal">true</span>,           <span class="comment">//æŠ¥å‘Šæ‰§è¡Œä¸åˆ°çš„ä»£ç é”™è¯¯ã€‚</span></span><br><span class="line">    <span class="string">"skipDefaultLibCheck"</span>: <span class="literal">false</span>,            <span class="comment">//å¿½ç•¥ åº“çš„é»˜è®¤å£°æ˜æ–‡ä»¶çš„ç±»å‹æ£€æŸ¥ã€‚</span></span><br><span class="line">    <span class="string">"skipLibCheck"</span>: <span class="literal">false</span>,                   <span class="comment">//å¿½ç•¥æ‰€æœ‰çš„å£°æ˜æ–‡ä»¶ï¼ˆ *.d.tsï¼‰çš„ç±»å‹æ£€æŸ¥ã€‚</span></span><br><span class="line">    <span class="string">"allowUnusedLabels"</span>: <span class="literal">false</span>,              <span class="comment">//ä¸æŠ¥å‘Šæœªä½¿ç”¨çš„æ ‡ç­¾é”™è¯¯ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ¨¡å—è§£æé€‰é¡¹ */</span></span><br><span class="line">    <span class="string">"moduleResolution"</span>: <span class="string">"node"</span>,            <span class="comment">// é€‰æ‹©æ¨¡å—è§£æç­–ç•¥ï¼š 'node' (Node.js) or 'classic' (TypeScript pre-1.6)ã€‚é»˜è®¤æ˜¯classic</span></span><br><span class="line">    <span class="string">"baseUrl"</span>: <span class="string">"./"</span>,                       <span class="comment">// ç”¨äºè§£æéç›¸å¯¹æ¨¡å—åç§°çš„åŸºç›®å½•</span></span><br><span class="line">    <span class="string">"paths"</span>: &#123;&#125;,                           <span class="comment">// æ¨¡å—ååˆ°åŸºäº baseUrl çš„è·¯å¾„æ˜ å°„çš„åˆ—è¡¨</span></span><br><span class="line">    <span class="string">"rootDirs"</span>: [],                        <span class="comment">// æ ¹æ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œå…¶ç»„åˆå†…å®¹è¡¨ç¤ºé¡¹ç›®è¿è¡Œæ—¶çš„ç»“æ„å†…å®¹</span></span><br><span class="line">    <span class="string">"typeRoots"</span>: [],                       <span class="comment">// åŒ…å«ç±»å‹å£°æ˜çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">    <span class="string">"types"</span>: [],                           <span class="comment">// éœ€è¦åŒ…å«çš„ç±»å‹å£°æ˜æ–‡ä»¶ååˆ—è¡¨</span></span><br><span class="line">    <span class="string">"allowSyntheticDefaultImports"</span>: <span class="literal">true</span>,  <span class="comment">// å…è®¸ä»æ²¡æœ‰è®¾ç½®é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ä¸­é»˜è®¤å¯¼å…¥ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Source Map Options */</span></span><br><span class="line">    <span class="string">"sourceRoot"</span>: <span class="string">"./"</span>,                    <span class="comment">// æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ° TypeScript æ–‡ä»¶è€Œä¸æ˜¯æºæ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">    <span class="string">"mapRoot"</span>: <span class="string">"./"</span>,                       <span class="comment">// æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ°æ˜ å°„æ–‡ä»¶è€Œä¸æ˜¯ç”Ÿæˆæ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">    <span class="string">"inlineSourceMap"</span>: <span class="literal">true</span>,               <span class="comment">// ç”Ÿæˆå•ä¸ª soucemaps æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å°† sourcemaps ç”Ÿæˆä¸åŒçš„æ–‡ä»¶</span></span><br><span class="line">    <span class="string">"inlineSources"</span>: <span class="literal">true</span>,                 <span class="comment">// å°†ä»£ç ä¸ sourcemaps ç”Ÿæˆåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¦æ±‚åŒæ—¶è®¾ç½®äº† --inlineSourceMap æˆ– --sourceMap å±æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å…¶ä»–é€‰é¡¹ */</span></span><br><span class="line">    <span class="string">"experimentalDecorators"</span>: <span class="literal">true</span>,         <span class="comment">// å¯ç”¨è£…é¥°å™¨</span></span><br><span class="line">    <span class="string">"emitDecoratorMetadata"</span>: <span class="literal">true</span>,          <span class="comment">// ä¸ºè£…é¥°å™¨æä¾›å…ƒæ•°æ®çš„æ”¯æŒ</span></span><br><span class="line">    <span class="string">"strictFunctionTypes"</span>: <span class="literal">false</span>,           <span class="comment">// ç¦ç”¨å‡½æ•°å‚æ•°åŒå‘åå˜æ£€æŸ¥ã€‚</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/* æŒ‡å®šç¼–è¯‘æ–‡ä»¶æˆ–æ’é™¤æŒ‡å®šç¼–è¯‘æ–‡ä»¶ */</span></span><br><span class="line">  <span class="string">"include"</span>: [</span><br><span class="line">      <span class="string">"src/**/*"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"exclude"</span>: [</span><br><span class="line">      <span class="string">"node_modules"</span>,</span><br><span class="line">      <span class="string">"**/*.spec.ts"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    <span class="string">"core.ts"</span>,</span><br><span class="line">    <span class="string">"sys.ts"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// ä»å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œç»§æ‰¿é…ç½®</span></span><br><span class="line">  <span class="string">"extends"</span>: <span class="string">"./config/base"</span>,</span><br><span class="line">  <span class="comment">// è®©IDEåœ¨ä¿å­˜æ–‡ä»¶çš„æ—¶å€™æ ¹æ®tsconfig.jsoné‡æ–°ç”Ÿæˆæ–‡ä»¶</span></span><br><span class="line">  <span class="string">"compileOnSave"</span>: <span class="literal">true</span> <span class="comment">// æ”¯æŒè¿™ä¸ªç‰¹æ€§éœ€è¦Visual Studio 2015ï¼Œ TypeScript1.8.4ä»¥ä¸Šå¹¶ä¸”å®‰è£…atom-typescriptæ’ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> TypeScript </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨æŒ‡å—ï¼ˆantdpï¼‰</title>
      <link href="/2019/05/11/workspace/Typescript/use/"/>
      <url>/2019/05/11/workspace/Typescript/use/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ä½¿ç”¨æŒ‡å—ï¼ˆantdpï¼‰</strong></p><p>[[toc]]</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> type SiderTheme = <span class="string">'light'</span> | <span class="string">'dark'</span>;</span><br><span class="line"><span class="keyword">export</span> interface GlobalHeaderRightProps extends ConnectProps &#123;</span><br><span class="line">  theme?: SiderTheme;</span><br><span class="line">  layout: <span class="string">'sidemenu'</span> | <span class="string">'topmenu'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">validateFields(<span class="function">(<span class="params">err: unknown, fieldsValue: searchParamsType</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line">interface IProps &#123;</span><br><span class="line"> form: FormComponentProps[<span class="string">'form'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(e: React.FormEvent)=&gt;&#123;&#125;</span><br></pre></td></tr></table></figure><p><strong>d.ts</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Reducer,</span><br><span class="line">  AnyAction,</span><br><span class="line">  ReducersMapObject,</span><br><span class="line">  Dispatch,</span><br><span class="line">  MiddlewareAPI,</span><br><span class="line">  StoreEnhancer</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; History &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface onActionFunc &#123;</span><br><span class="line">  (api: MiddlewareAPI&lt;any&gt;): <span class="keyword">void</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface ReducerEnhancer &#123;</span><br><span class="line">  (reducer: Reducer&lt;any&gt;): <span class="keyword">void</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface Hooks &#123;</span><br><span class="line">  onError?: <span class="function">(<span class="params">e: <span class="built_in">Error</span>, dispatch: Dispatch&lt;any&gt;</span>) =&gt;</span> <span class="keyword">void</span>,</span><br><span class="line">  onAction?: onActionFunc | onActionFunc[],</span><br><span class="line">  onStateChange?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>,</span><br><span class="line">  onReducer?: ReducerEnhancer,</span><br><span class="line">  onEffect?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>,</span><br><span class="line">  onHmr?: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>,</span><br><span class="line">  extraReducers?: ReducersMapObject,</span><br><span class="line">  extraEnhancers?: StoreEnhancer&lt;any&gt;[],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type DvaOption = Hooks &amp; &#123;</span><br><span class="line">  initialState?: <span class="built_in">Object</span>,</span><br><span class="line">  history?: <span class="built_in">Object</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface EffectsCommandMap &#123;</span><br><span class="line">  put: <span class="xml"><span class="tag">&lt;<span class="name">A</span> <span class="attr">extends</span> <span class="attr">AnyAction</span>&gt;</span>(action: A) =&gt; any,</span></span><br><span class="line"><span class="xml">  call: Function,</span></span><br><span class="line"><span class="xml">  select: Function,</span></span><br><span class="line"><span class="xml">  take: Function,</span></span><br><span class="line"><span class="xml">  cancel: Function,</span></span><br><span class="line"><span class="xml">  [key: string]: any,</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">export type Effect = (action: AnyAction, effects: EffectsCommandMap) =&gt; void;</span></span><br><span class="line"><span class="xml">export type EffectType = 'takeEvery' | 'takeLatest' | 'watcher' | 'throttle';</span></span><br><span class="line"><span class="xml">export type EffectWithType = [Effect, &#123; type : EffectType &#125;];</span></span><br><span class="line"><span class="xml">export type Subscription = (api: SubscriptionAPI, done: Function) =&gt; void;</span></span><br><span class="line"><span class="xml">export type ReducersMapObjectWithEnhancer = [ReducersMapObject, ReducerEnhancer];</span></span><br><span class="line"></span><br><span class="line"><span class="xml">export interface EffectsMapObject &#123;</span></span><br><span class="line"><span class="xml">  [key: string]: Effect | EffectWithType,</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">export interface SubscriptionAPI &#123;</span></span><br><span class="line"><span class="xml">  history: History,</span></span><br><span class="line">  dispatch: Dispatch&lt;any&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface SubscriptionsMapObject &#123;</span><br><span class="line">  [key: string]: Subscription,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface Model &#123;</span><br><span class="line">  namespace: string,</span><br><span class="line">  state?: any,</span><br><span class="line">  reducers?: ReducersMapObject | ReducersMapObjectWithEnhancer,</span><br><span class="line">  effects?: EffectsMapObject,</span><br><span class="line">  subscriptions?: SubscriptionsMapObject,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface RouterAPI &#123;</span><br><span class="line">  history: History,</span><br><span class="line">  app: DvaInstance,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface Router &#123;</span><br><span class="line">  (api?: RouterAPI): JSX.Element | Object,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface DvaInstance &#123;</span><br><span class="line">  /**</span><br><span class="line">   * Register an object of hooks on the application.</span><br><span class="line">   *</span><br><span class="line">   * @param hooks</span><br><span class="line">   */</span><br><span class="line">  use: (hooks: Hooks) =&gt; void,</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Register a model.</span><br><span class="line">   *</span><br><span class="line">   * @param model</span><br><span class="line">   */</span><br><span class="line">  model: (model: Model) =&gt; void,</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Unregister a model.</span><br><span class="line">   *</span><br><span class="line">   * @param namespace</span><br><span class="line">   */</span><br><span class="line">  unmodel: (namespace: string) =&gt; void,</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Config router. Takes a function with arguments &#123; history, dispatch &#125;,</span><br><span class="line">   * and expects router config. It use the same api as react-router,</span><br><span class="line">   * return jsx elements or JavaScript Object for dynamic routing.</span><br><span class="line">   *</span><br><span class="line">   * @param router</span><br><span class="line">   */</span><br><span class="line">  router: (router: Router) =&gt; void,</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Start the application. Selector is optional. If no selector</span><br><span class="line">   * arguments, it will return a function that return JSX elements.</span><br><span class="line">   *</span><br><span class="line">   * @param selector</span><br><span class="line">   */</span><br><span class="line">  start: (selector?: HTMLElement | string) =&gt; any,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default function dva(opts?: DvaOption): DvaInstance;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Connects a React component to Dva.</span><br><span class="line"> */</span><br><span class="line">export function connect(</span><br><span class="line">  mapStateToProps?: Function,</span><br><span class="line">  mapDispatchToProps?: Function,</span><br><span class="line">  mergeProps?: Function,</span><br><span class="line">  options?: Object</span><br><span class="line">): Function;</span><br></pre></td></tr></table></figure><p><strong>model</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Reducer &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Subscription, Effect &#125; <span class="keyword">from</span> <span class="string">'dva'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; NoticeIconData &#125; <span class="keyword">from</span> <span class="string">'@/components/NoticeIcon'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; queryNotices &#125; <span class="keyword">from</span> <span class="string">'@/services/user'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ConnectState &#125; <span class="keyword">from</span> <span class="string">'./connect.d'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface NoticeItem extends NoticeIconData &#123;</span><br><span class="line">  id: string;</span><br><span class="line">  type: string;</span><br><span class="line">  status: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface GlobalModelState &#123;</span><br><span class="line">  collapsed: boolean;</span><br><span class="line">  notices: NoticeItem[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface GlobalModelType &#123;</span><br><span class="line">  namespace: <span class="string">'global'</span>;</span><br><span class="line">  state: GlobalModelState;</span><br><span class="line">  effects: &#123;</span><br><span class="line">    fetchNotices: Effect;</span><br><span class="line">    clearNotices: Effect;</span><br><span class="line">    changeNoticeReadState: Effect;</span><br><span class="line">  &#125;;</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    changeLayoutCollapsed: Reducer&lt;GlobalModelState&gt;;</span><br><span class="line">    saveNotices: Reducer&lt;GlobalModelState&gt;;</span><br><span class="line">    saveClearedNotices: Reducer&lt;GlobalModelState&gt;;</span><br><span class="line">  &#125;;</span><br><span class="line">  subscriptions: &#123; <span class="attr">setup</span>: Subscription &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> GlobalModel: GlobalModelType = &#123;</span><br><span class="line">  namespace: <span class="string">'global'</span>,</span><br><span class="line"></span><br><span class="line">  state: &#123;</span><br><span class="line">    collapsed: <span class="literal">false</span>,</span><br><span class="line">    notices: [],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  effects: &#123;</span><br><span class="line">    *fetchNotices(_, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">yield</span> call(queryNotices);</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'saveNotices'</span>,</span><br><span class="line">        payload: data,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">const</span> unreadCount: number = <span class="keyword">yield</span> select(</span><br><span class="line">        (state: ConnectState) =&gt; state.global.notices.filter(<span class="function"><span class="params">item</span> =&gt;</span> !item.read).length,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'user/changeNotifyCount'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          totalCount: data.length,</span><br><span class="line">          unreadCount,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    *clearNotices(&#123; payload &#125;, &#123; put, select &#125;) &#123;</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'saveClearedNotices'</span>,</span><br><span class="line">        payload,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">const</span> count: number = <span class="keyword">yield</span> select(<span class="function">(<span class="params">state: ConnectState</span>) =&gt;</span> state.global.notices.length);</span><br><span class="line">      <span class="keyword">const</span> unreadCount: number = <span class="keyword">yield</span> select(</span><br><span class="line">        (state: ConnectState) =&gt; state.global.notices.filter(<span class="function"><span class="params">item</span> =&gt;</span> !item.read).length,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'user/changeNotifyCount'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          totalCount: count,</span><br><span class="line">          unreadCount,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    *changeNoticeReadState(&#123; payload &#125;, &#123; put, select &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> notices: NoticeItem[] = <span class="keyword">yield</span> select(<span class="function">(<span class="params">state: ConnectState</span>) =&gt;</span></span><br><span class="line">        state.global.notices.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> notice = &#123; ...item &#125;;</span><br><span class="line">          <span class="keyword">if</span> (notice.id === payload) &#123;</span><br><span class="line">            notice.read = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> notice;</span><br><span class="line">        &#125;),</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'saveNotices'</span>,</span><br><span class="line">        payload: notices,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'user/changeNotifyCount'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          totalCount: notices.length,</span><br><span class="line">          unreadCount: notices.filter(<span class="function"><span class="params">item</span> =&gt;</span> !item.read).length,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  reducers: &#123;</span><br><span class="line">    changeLayoutCollapsed(state = &#123; <span class="attr">notices</span>: [], <span class="attr">collapsed</span>: <span class="literal">true</span> &#125;, &#123; payload &#125;): GlobalModelState &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        collapsed: payload,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    saveNotices(state, &#123; payload &#125;): GlobalModelState &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        collapsed: <span class="literal">false</span>,</span><br><span class="line">        ...state,</span><br><span class="line">        notices: payload,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    saveClearedNotices(state = &#123; <span class="attr">notices</span>: [], <span class="attr">collapsed</span>: <span class="literal">true</span> &#125;, &#123; payload &#125;): GlobalModelState &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        collapsed: <span class="literal">false</span>,</span><br><span class="line">        ...state,</span><br><span class="line">        notices: state.notices.filter((item): <span class="function"><span class="params">boolean</span> =&gt;</span> item.type !== payload),</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  subscriptions: &#123;</span><br><span class="line">    setup(&#123; history &#125;): <span class="keyword">void</span> &#123;</span><br><span class="line">      <span class="comment">// Subscribe history(url) change, trigger `load` action if pathname is `/`</span></span><br><span class="line">      history.listen((&#123; pathname, search &#125;): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span>.ga !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">          <span class="built_in">window</span>.ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>, pathname + search);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> GlobalModel;</span><br></pre></td></tr></table></figure><p><strong>connect</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Dispatch, AnyAction &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line">interface LoginProps &#123;</span><br><span class="line">  dispatch: Dispatch&lt;AnyAction&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@connect(<span class="function">(<span class="params">&#123; login, loading &#125;: ConnectState</span>) =&gt;</span> (&#123;</span><br><span class="line">  userLogin: login,</span><br><span class="line">  submitting: loading.effects[<span class="string">'login/login'</span>],</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface Loading &#123;</span><br><span class="line">  global: boolean;</span><br><span class="line">  effects: &#123; [key: string]: boolean | <span class="literal">undefined</span> &#125;;</span><br><span class="line">  models: &#123;</span><br><span class="line">    global?: boolean;</span><br><span class="line">    menu?: boolean;</span><br><span class="line">    setting?: boolean;</span><br><span class="line">    user?: boolean;</span><br><span class="line">    login?: boolean;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface ConnectState &#123;</span><br><span class="line">  global: GlobalModelState;</span><br><span class="line">  loading: Loading;</span><br><span class="line">  settings: SettingModelState;</span><br><span class="line">  user: UserModelState;</span><br><span class="line">  login: LoginModelType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> TypeScript </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript</title>
      <link href="/2019/05/11/workspace/Typescript/ts/"/>
      <url>/2019/05/11/workspace/Typescript/ts/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>TypeScript</strong></p><p>[[toc]]</p><h3 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h3><p>TypeScript æ˜¯ Microsoft å¼€å‘å’Œç»´æŠ¤çš„ä¸€ç§é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ã€‚å®ƒæ˜¯ JavaScript çš„è¶…é›†ï¼ŒåŒ…å«äº† JavaScript çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯ä»¥è½½å…¥ JavaScript ä»£ç è¿è¡Œï¼Œå¹¶æ‰©å±•äº† JavaScript çš„è¯­æ³•ã€‚</p><ul><li><p>TypeScript å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>TypeScript æ˜¯ Microsoft æ¨å‡ºçš„å¼€æºè¯­è¨€ï¼Œä½¿ç”¨ Apache æˆæƒåè®®</li><li>TypeScript <strong>å¢åŠ äº†é™æ€ç±»å‹ã€ç±»ã€æ¨¡å—ã€æ¥å£å’Œç±»å‹æ³¨è§£</strong></li><li>TypeScript å¯ç”¨äºå¼€å‘å¤§å‹çš„åº”ç”¨</li><li>TypeScript æ˜“å­¦æ˜“äºç†è§£</li></ul></li><li><p>TypeScript çš„ä¼˜åŠ¿ï¼š</p><ul><li>é™æ€è¾“å…¥  å¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨æ£€æŸ¥ç±»å‹é”™è¯¯ï¼Œä»¥ä¾¿å†™å¥½æ›´å¥å£®çš„ä»£ç å¹¶å¯¹å…¶è¿›è¡Œç»´æŠ¤ï¼Œä½¿å¾—ä»£ç è´¨é‡æ›´å¥½ã€æ›´æ¸…æ™°ã€‚</li><li>å¤§å‹çš„å¼€å‘é¡¹ç›®   ä½¿ç”¨TypeScriptå·¥å…·æ¥è¿›è¡Œé‡æ„æ›´å˜çš„å®¹æ˜“ã€å¿«æ·ã€‚ï¼ˆæœ‰æ—¶ä¸ºäº†æ”¹è¿›å¼€å‘é¡¹ç›®ï¼Œéœ€è¦å¯¹ä»£ç åº“è¿›è¡Œå°çš„å¢é‡æ›´æ”¹ã€‚è¿™äº›å°å°çš„å˜åŒ–å¯èƒ½ä¼šäº§ç”Ÿä¸¥é‡çš„ã€æ„æƒ³ä¸åˆ°çš„åæœï¼Œå› æ­¤æœ‰å¿…è¦æ’¤é”€è¿™äº›å˜åŒ–ï¼‰</li><li>æ›´å¥½çš„åä½œ</li><li>æ›´å¼ºçš„ç”Ÿäº§åŠ›</li></ul></li></ul><h3 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h3><p><code>Boolean</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let isDone: boolean &#x3D; false;</span><br><span class="line">&#x2F;&#x2F; ç¼–è¯‘é€šè¿‡</span><br><span class="line">&#x2F;&#x2F; åé¢çº¦å®šï¼Œæœªå¼ºè°ƒç¼–è¯‘é”™è¯¯çš„ä»£ç ç‰‡kkæ®µï¼Œé»˜è®¤ä¸ºç¼–è¯‘é€šè¿‡</span><br><span class="line"></span><br><span class="line">let createdByNewBoolean: boolean &#x3D; new Boolean(1);</span><br><span class="line">&#x2F;&#x2F; index.ts(1,5): error TS2322: Type &#39;Boolean&#39; is not assignable to type &#39;boolean&#39;.</span><br><span class="line">&#x2F;&#x2F; åé¢çº¦å®šï¼Œæ³¨é‡Šä¸­æ ‡å‡ºäº†ç¼–è¯‘æŠ¥é”™çš„ä»£ç ç‰‡æ®µï¼Œè¡¨ç¤ºç¼–è¯‘æœªé€šè¿‡</span><br></pre></td></tr></table></figure><p><code>Number</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> decLiteral: <span class="built_in">number</span> = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">let</span> hexLiteral: <span class="built_in">number</span> = <span class="number">0xf00d</span>;</span><br><span class="line"><span class="comment">// ES6 ä¸­çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ³•</span></span><br><span class="line"><span class="keyword">let</span> binaryLiteral: <span class="built_in">number</span> = <span class="number">0b1010</span>;</span><br><span class="line"><span class="comment">// ES6 ä¸­çš„å…«è¿›åˆ¶è¡¨ç¤ºæ³•</span></span><br><span class="line"><span class="keyword">let</span> octalLiteral: <span class="built_in">number</span> = <span class="number">0o744</span>;</span><br><span class="line"><span class="keyword">let</span> notANumber: <span class="built_in">number</span> = <span class="literal">NaN</span>;</span><br><span class="line"><span class="keyword">let</span> infinityNumber: <span class="built_in">number</span> = <span class="literal">Infinity</span>;</span><br><span class="line"><span class="comment">//ç¼–è¯‘çš„ç»“æœ</span></span><br><span class="line"><span class="keyword">var</span> decLiteral = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">var</span> hexLiteral = <span class="number">0xf00d</span>;</span><br><span class="line"><span class="comment">// ES6 ä¸­çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ³•</span></span><br><span class="line"><span class="keyword">var</span> binaryLiteral = <span class="number">10</span>;</span><br><span class="line"><span class="comment">// ES6 ä¸­çš„å…«è¿›åˆ¶è¡¨ç¤ºæ³•</span></span><br><span class="line"><span class="keyword">var</span> octalLiteral = <span class="number">484</span>;</span><br><span class="line"><span class="keyword">var</span> notANumber = <span class="literal">NaN</span>;</span><br><span class="line"><span class="keyword">var</span> infinityNumber = <span class="literal">Infinity</span>;</span><br></pre></td></tr></table></figure><p><code>String</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myName: <span class="built_in">string</span> = <span class="string">'Tom'</span>;</span><br></pre></td></tr></table></figure><p><code>Void</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//JavaScript æ²¡æœ‰ç©ºå€¼ï¼ˆVoidï¼‰çš„æ¦‚å¿µï¼Œåœ¨ TypeScript ä¸­ï¼Œå¯ä»¥ç”¨ void è¡¨ç¤ºæ²¡æœ‰ä»»ä½•è¿”å›å€¼çš„å‡½æ•°ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertName</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">    alert(<span class="string">'My name is Tom'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//èƒ½å°†å®ƒèµ‹å€¼ä¸º undefined å’Œ nullï¼š</span></span><br><span class="line"><span class="keyword">let</span> unusable: <span class="built_in">void</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> unusable: <span class="built_in">void</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p><code>Null å’Œ Undefined</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> u: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> n: <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//ä¸ void çš„åŒºåˆ«æ˜¯ï¼Œundefined å’Œ null æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ undefined ç±»å‹çš„å˜é‡ï¼Œå¯ä»¥èµ‹å€¼ç»™ number ç±»å‹çš„å˜é‡ï¼š</span></span><br><span class="line"><span class="comment">// è¿™æ ·ä¸ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="comment">//è€Œ void ç±»å‹çš„å˜é‡ä¸èƒ½èµ‹å€¼ç»™ number ç±»å‹çš„å˜é‡ï¼š</span></span><br><span class="line"><span class="keyword">let</span> u: <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> = u;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts(2,5): error TS2322: Type 'void' is not assignable to type 'number'.</span></span><br></pre></td></tr></table></figure><p><code>Any</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä»»æ„å€¼ï¼ˆAnyï¼‰ç”¨æ¥è¡¨ç¤ºå…è®¸èµ‹å€¼ä¸ºä»»æ„ç±»å‹ã€‚</span></span><br><span class="line"><span class="keyword">let</span> myFavoriteNumber: <span class="built_in">any</span> = <span class="string">'seven'</span>;</span><br><span class="line">myFavoriteNumber = <span class="number">7</span>;</span><br></pre></td></tr></table></figure><h3 id="å…ƒç»„"><a href="#å…ƒç»„" class="headerlink" title="å…ƒç»„"></a>å…ƒç»„</h3><p><code>æ•°ç»„åˆå¹¶äº†ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œè€Œå…ƒç»„ï¼ˆTupleï¼‰åˆå¹¶äº†ä¸åŒç±»å‹çš„å¯¹è±¡</code></p><p>å®šä¹‰ä¸€å¯¹å€¼åˆ†åˆ«ä¸º string å’Œ number çš„å…ƒç»„ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> x: [<span class="built_in">string</span>, <span class="built_in">number</span>];</span><br><span class="line"><span class="comment">// Initialize it</span></span><br><span class="line">x = [<span class="string">'hello'</span>, <span class="number">10</span>]; <span class="comment">// OK</span></span><br><span class="line"><span class="comment">// Initialize it incorrectly</span></span><br><span class="line">x = [<span class="number">10</span>, <span class="string">'hello'</span>]; <span class="comment">// Error</span></span><br><span class="line"></span><br><span class="line">onsole.log(x[<span class="number">0</span>].substr(<span class="number">1</span>)); <span class="comment">// OK</span></span><br><span class="line"><span class="built_in">console</span>.log(x[<span class="number">1</span>].substr(<span class="number">1</span>)); <span class="comment">// Error, 'number' does not have 'substr'</span></span><br></pre></td></tr></table></figure><p><code>è¶Šç•Œçš„å…ƒç´ </code></p><p>åœ¨ 2.6 åŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œè¶…å‡ºè§„å®šä¸ªæ•°çš„å…ƒç´ ç§°ä½œè¶Šç•Œå…ƒç´ ï¼Œä½†æ˜¯åªè¦è¶Šç•Œå…ƒç´ çš„ç±»å‹æ˜¯å®šä¹‰çš„ç±»å‹ä¸­çš„ä¸€ç§å³å¯ã€‚<br>æ¯”å¦‚æˆ‘ä»¬å®šä¹‰çš„ç±»å‹æœ‰ä¸¤ç§ï¼šstring å’Œ numberï¼Œè¶Šç•Œçš„å…ƒç´ æ˜¯ string ç±»å‹ï¼Œå±äºè”åˆç±»å‹ï¼Œ<br>æ‰€ä»¥æ²¡é—®é¢˜ï¼Œè”åˆç±»å‹çš„æ¦‚å¿µæˆ‘ä»¬åé¢ä¼šè®²åˆ°ã€‚string | number</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">x[<span class="number">3</span>] = <span class="string">'world'</span>; <span class="comment">// OK, å­—ç¬¦ä¸²å¯ä»¥èµ‹å€¼ç»™(string | number)ç±»å‹</span></span><br><span class="line"><span class="built_in">console</span>.log(x[<span class="number">5</span>].toString()); <span class="comment">// OK, 'string' å’Œ 'number' éƒ½æœ‰ toString</span></span><br><span class="line">x[<span class="number">6</span>] = <span class="literal">true</span>; <span class="comment">// Error, å¸ƒå°”ä¸æ˜¯(string | number)ç±»å‹</span></span><br></pre></td></tr></table></figure><p>åœ¨ 2.6 ä¹‹åçš„ç‰ˆæœ¬ï¼Œå»æ‰äº†è¿™ä¸ªè¶Šç•Œå…ƒç´ æ˜¯è”åˆç±»å‹çš„å­ç±»å‹å³å¯çš„æ¡ä»¶ï¼Œè¦æ±‚å…ƒç»„èµ‹å€¼å¿…é¡»ç±»å‹å’Œä¸ªæ•°éƒ½å¯¹åº”ã€‚</p><p>åœ¨ 2.6 ä¹‹åçš„ç‰ˆæœ¬ï¼Œ[string, number] å…ƒç»„ç±»å‹çš„å£°æ˜æ•ˆæœä¸Šå¯ä»¥çœ‹ä½œç­‰åŒäºä¸‹é¢çš„å£°æ˜ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Tuple <span class="keyword">extends</span> Array&lt;number | string&gt; &#123;<span class="number">0</span>: <span class="built_in">string</span>; <span class="number">1</span>: <span class="built_in">number</span>; length: <span class="number">2</span>;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå…ƒç´ ä¸ªæ•°è¶…è¿‡ 2 ä¸ªæ—¶ï¼Œå®ƒçš„ length å°±ä¸æ˜¯ 2 æ˜¯å¤§äº 2 çš„æ•°äº†ï¼Œå°±ä¸æ»¡è¶³è¿™ä¸ªæ¥å£å®šä¹‰äº†ï¼Œæ‰€ä»¥å°±ä¼šæŠ¥é”™ã€‚</p><p><strong>å¦‚æœä½ æƒ³è¦å’Œ 2.6 åŠä¹‹å‰ç‰ˆæœ¬ä¸€æ ·çš„å…ƒç»„ç‰¹æ€§ï¼Œé‚£ä½ å¯ä»¥è¿™æ ·å®šä¹‰æ¥å£ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Tuple <span class="keyword">extends</span> Array&lt;number | string&gt; &#123;<span class="number">0</span>: <span class="built_in">string</span>; <span class="number">1</span>: <span class="built_in">number</span>;&#125;</span><br></pre></td></tr></table></figure><h3 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h3><p><code>æšä¸¾ï¼ˆEnumï¼‰ç±»å‹ç”¨äºå–å€¼è¢«é™å®šåœ¨ä¸€å®šèŒƒå›´å†…çš„åœºæ™¯ï¼Œæ¯”å¦‚ä¸€å‘¨åªèƒ½æœ‰ä¸ƒå¤©ï¼Œé¢œè‰²é™å®šä¸ºçº¢ç»¿è“ç­‰ã€‚</code></p><p><strong>æ™®é€šæšä¸¾</strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> Days &#123;Sun, Mon, Tue, Wed, Thu, Fri, Sat&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æšä¸¾æˆå‘˜ä¼šè¢«èµ‹å€¼ä¸ºä» 0 å¼€å§‹é€’å¢çš„æ•°å­—ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¹æšä¸¾å€¼åˆ°æšä¸¾åè¿›è¡Œåå‘æ˜ å°„ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">"Sun"</span>] === <span class="number">0</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">"Mon"</span>] === <span class="number">1</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">"Tue"</span>] === <span class="number">2</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">"Sat"</span>] === <span class="number">6</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="number">0</span>] === <span class="string">"Sun"</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="number">1</span>] === <span class="string">"Mon"</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="number">2</span>] === <span class="string">"Tue"</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="number">6</span>] === <span class="string">"Sat"</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> Days &#123;Sun = <span class="number">7</span>, Mon = <span class="number">4</span>, Tue, Wed, Thu, Fri, Sat&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">"Sun"</span>] === <span class="number">7</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">"Mon"</span>] === <span class="number">4</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">"Tue"</span>] === <span class="number">5</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">"Thu"</span>] === <span class="number">7</span>); <span class="comment">// true</span></span><br><span class="line"><span class="comment">//æœªæ‰‹åŠ¨èµ‹å€¼çš„æšä¸¾é¡¹ä¼šæ¥ç€ä¸Šä¸€ä¸ªæšä¸¾é¡¹é€’å¢ã€‚</span></span><br><span class="line"><span class="comment">//å¦‚æœæœªæ‰‹åŠ¨èµ‹å€¼çš„æšä¸¾é¡¹ä¸æ‰‹åŠ¨èµ‹å€¼çš„é‡å¤äº†ï¼ŒTypeScript æ˜¯ä¸ä¼šå¯Ÿè§‰åˆ°è¿™ä¸€ç‚¹çš„ï¼š</span></span><br><span class="line"><span class="comment">//æ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œæœ€å¥½ä¸è¦å‡ºç°è¿™ç§è¦†ç›–çš„æƒ…å†µã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Days &#123;Sun = <span class="number">7</span>, Mon, Tue, Wed, Thu, Fri, Sat = &lt;<span class="built_in">any</span>&gt;<span class="string">"S"</span>&#125;;</span><br><span class="line"><span class="comment">//ä½¿ç”¨ç±»å‹æ–­è¨€æ¥è®© tsc æ— è§†ç±»å‹æ£€æŸ¥</span></span><br></pre></td></tr></table></figure><p><strong>å¸¸æ•°æšä¸¾</strong></p><p><code>å¸¸æ•°æšä¸¾æ˜¯ä½¿ç”¨ const enum å®šä¹‰çš„æšä¸¾ç±»å‹ï¼š</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> Directions &#123;</span><br><span class="line">    Up,</span><br><span class="line">    Down,</span><br><span class="line">    Left,</span><br><span class="line">    Right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> directions = [Directions.Up, Directions.Down, Directions.Left, Directions.Right];</span><br><span class="line"><span class="comment">//å¸¸æ•°æšä¸¾ä¸æ™®é€šæšä¸¾çš„åŒºåˆ«æ˜¯ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«åˆ é™¤ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«è®¡ç®—æˆå‘˜(èµ‹å€¼)ã€‚</span></span><br><span class="line"><span class="comment">//ä¸Šä¾‹çš„ç¼–è¯‘ç»“æœæ˜¯ï¼š</span></span><br><span class="line"><span class="keyword">var</span> directions = [<span class="number">0</span> <span class="comment">/* Up */</span>, <span class="number">1</span> <span class="comment">/* Down */</span>, <span class="number">2</span> <span class="comment">/* Left */</span>, <span class="number">3</span> <span class="comment">/* Right */</span>];</span><br></pre></td></tr></table></figure><h3 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> IProps &#123;</span><br><span class="line">    foo: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> IState &#123;</span><br><span class="line">  loading:<span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> MyComponent <span class="keyword">extends</span> React.Component&lt;IProps, IState&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;span&gt;&#123;<span class="keyword">this</span>.props.foo&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç±»å‹æ¨è®º"><a href="#ç±»å‹æ¨è®º" class="headerlink" title="ç±»å‹æ¨è®º"></a>ç±»å‹æ¨è®º</h3><p><code>å¦‚æœæ²¡æœ‰æ˜ç¡®çš„æŒ‡å®šç±»å‹ï¼Œé‚£ä¹ˆ TypeScript ä¼šä¾ç…§ç±»å‹æ¨è®ºï¼ˆType Inferenceï¼‰çš„è§„åˆ™æ¨æ–­å‡ºä¸€ä¸ªç±»å‹ã€‚</code><br><br/><br>ä»¥ä¸‹ä»£ç è™½ç„¶æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œä½†æ˜¯ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™æŠ¥é”™ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myFavoriteNumber = <span class="string">'seven'</span>;</span><br><span class="line">myFavoriteNumber = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts(2,1): error TS2322: Type 'number' is not assignable to type 'string'.</span></span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šï¼Œå®ƒç­‰ä»·äºï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myFavoriteNumber: <span class="built_in">string</span> = <span class="string">'seven'</span>;</span><br><span class="line">myFavoriteNumber = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts(2,1): error TS2322: Type 'number' is not assignable to type 'string'.</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœå®šä¹‰çš„æ—¶å€™æ²¡æœ‰èµ‹å€¼ï¼Œä¸ç®¡ä¹‹åæœ‰æ²¡æœ‰èµ‹å€¼ï¼Œéƒ½ä¼šè¢«æ¨æ–­æˆ any ç±»å‹è€Œå®Œå…¨ä¸è¢«ç±»å‹æ£€æŸ¥ï¼š</span></span><br><span class="line"><span class="keyword">let</span> myFavoriteNumber;</span><br><span class="line">myFavoriteNumber = <span class="string">'seven'</span>;</span><br><span class="line">myFavoriteNumber = <span class="number">7</span>;</span><br></pre></td></tr></table></figure><h3 id="è”åˆç±»å‹"><a href="#è”åˆç±»å‹" class="headerlink" title="è”åˆç±»å‹"></a>è”åˆç±»å‹</h3><p><code>è”åˆç±»å‹ï¼ˆUnion Typesï¼‰è¡¨ç¤ºå–å€¼å¯ä»¥ä¸ºå¤šç§ç±»å‹ä¸­çš„ä¸€ç§ã€‚</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myFavoriteNumber: <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line">myFavoriteNumber = <span class="string">'seven'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(myFavoriteNumber.length); <span class="comment">// 5</span></span><br><span class="line">myFavoriteNumber = <span class="number">7</span>;</span><br><span class="line"><span class="built_in">console</span>.log(myFavoriteNumber.length); <span class="comment">// ç¼–è¯‘æ—¶æŠ¥é”™,numberä¹ˆæœ‰length</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts(5,30): error TS2339: Property 'length' does not exist on type 'number'.</span></span><br></pre></td></tr></table></figure><h3 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç±»å‹æ–­è¨€æœ‰ä¸¤ç§å½¢å¼ã€‚ å…¶ä¸€æ˜¯â€œå°–æ‹¬å·â€è¯­æ³•ï¼š</span></span><br><span class="line"><span class="keyword">let</span> someValue: <span class="built_in">any</span> = <span class="string">"this is a string"</span>;</span><br><span class="line"><span class="keyword">let</span> strLength: <span class="built_in">number</span> = (&lt;<span class="built_in">string</span>&gt;someValue).length;</span><br><span class="line"><span class="comment">//å¦ä¸€ä¸ªä¸ºasè¯­æ³•ï¼š</span></span><br><span class="line"><span class="keyword">let</span> someValue: <span class="built_in">any</span> = <span class="string">"this is a string"</span>;</span><br><span class="line"><span class="keyword">let</span> strLength: <span class="built_in">number</span> = (someValue <span class="keyword">as</span> <span class="built_in">string</span>).length;</span><br><span class="line"><span class="comment">//ä¸¤ç§å½¢å¼æ˜¯ç­‰ä»·çš„ã€‚ è‡³äºä½¿ç”¨å“ªä¸ªå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å‡­ä¸ªäººå–œå¥½ï¼›ç„¶è€Œï¼Œå½“ä½ åœ¨TypeScripté‡Œä½¿ç”¨JSXæ—¶ï¼Œåªæœ‰asè¯­æ³•æ–­è¨€æ˜¯è¢«å…è®¸çš„ã€‚</span></span><br></pre></td></tr></table></figure><p><code>è§£å†³ä¸Šé¢è”åˆç±»å‹å­—ç¬¦ä¸²å’Œæ•°å­—lengthçš„é—®é¢˜</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params">something: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((&lt;<span class="built_in">string</span>&gt;something).length) &#123;</span><br><span class="line">        <span class="keyword">return</span> (&lt;<span class="built_in">string</span>&gt;something).length;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> something.toString().length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Interfaces-æ¥å£"><a href="#Interfaces-æ¥å£" class="headerlink" title="Interfaces æ¥å£"></a>Interfaces æ¥å£</h3><p><code>åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¥å£ï¼ˆInterfacesï¼‰æ¥å®šä¹‰å¯¹è±¡çš„ç±»å‹ã€‚</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    age?: <span class="built_in">number</span>;<span class="comment">//å¯é€‰å±æ€§</span></span><br><span class="line">    [propName: <span class="built_in">string</span>]: <span class="built_in">any</span>;<span class="comment">//ä»»æ„å±æ€§</span></span><br><span class="line">    readonly id: <span class="built_in">number</span>;<span class="comment">//åªè¯»å±æ€§</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tom: Person = &#123;</span><br><span class="line">    name: <span class="string">'Tom'</span>,</span><br><span class="line">    age: <span class="number">25</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦å®šä¹‰äº†ä»»æ„å±æ€§ï¼Œé‚£ä¹ˆç¡®å®šå±æ€§å’Œå¯é€‰å±æ€§çš„ç±»å‹éƒ½å¿…é¡»æ˜¯å®ƒçš„ç±»å‹çš„å­é›†ï¼š</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    age?: <span class="built_in">number</span>;</span><br><span class="line">    [propName: <span class="built_in">string</span>]: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tom: Person = &#123;</span><br><span class="line">    name: <span class="string">'Tom'</span>,</span><br><span class="line">    age: <span class="number">25</span>,</span><br><span class="line">    gender: <span class="string">'male'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts(3,5): error TS2411: Property 'age' of type 'number' is not assignable to string index type 'string'.</span></span><br><span class="line"><span class="comment">// index.ts(7,5): error TS2322: Type '&#123; [x: string]: string | number; name: string; age: number; gender: string; &#125;' is not assignable to type 'Person'.</span></span><br><span class="line"><span class="comment">//Index signatures are incompatible.</span></span><br><span class="line"><span class="comment">//Type 'string | number' is not assignable to type 'string'.</span></span><br><span class="line"><span class="comment">//Type 'number' is not assignable to type 'string'.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸Šä¾‹ä¸­ï¼Œä»»æ„å±æ€§çš„å€¼å…è®¸æ˜¯ stringï¼Œä½†æ˜¯å¯é€‰å±æ€§ age çš„å€¼å´æ˜¯ numberï¼Œnumber ä¸æ˜¯ string çš„å­å±æ€§ï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚</span></span><br></pre></td></tr></table></figure><p><strong><code>æ¥å£ç»§æ‰¿æ¥å£</code></strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Shape &#123;</span><br><span class="line">    color: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> PenStroke &#123;</span><br><span class="line">    penWidth: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Square <span class="keyword">extends</span> Shape, PenStroke &#123;</span><br><span class="line">    sideLength: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> square = &lt;Square&gt;&#123;&#125;;</span><br><span class="line">square.color = <span class="string">"blue"</span>;</span><br><span class="line">square.sideLength = <span class="number">10</span>;</span><br><span class="line">square.penWidth = <span class="number">5.0</span>;</span><br></pre></td></tr></table></figure><p><strong><code>æ··åˆç±»å‹</code></strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸€ä¸ªå¯¹è±¡å¯ä»¥åŒæ—¶åšä¸ºå‡½æ•°å’Œå¯¹è±¡ä½¿ç”¨ï¼Œå¹¶å¸¦æœ‰é¢å¤–çš„å±æ€§ã€‚</span></span><br><span class="line"><span class="keyword">interface</span> Counter &#123;</span><br><span class="line">    (start: <span class="built_in">number</span>): <span class="built_in">string</span>;</span><br><span class="line">    interval: <span class="built_in">number</span>;</span><br><span class="line">    reset(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCounter</span>(<span class="params"></span>): <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> counter = &lt;Counter&gt;<span class="function"><span class="keyword">function</span> (<span class="params">start: <span class="built_in">number</span></span>) </span>&#123; &#125;;</span><br><span class="line">    counter.interval = <span class="number">123</span>;</span><br><span class="line">    counter.reset = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line">    <span class="keyword">return</span> counter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = getCounter();</span><br><span class="line">c(<span class="number">10</span>);</span><br><span class="line">c.reset();</span><br><span class="line">c.interval = <span class="number">5.0</span>;</span><br></pre></td></tr></table></figure><p><strong><code>æ¥å£ç»§æ‰¿ç±»</code></strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç®€å•</span></span><br><span class="line"><span class="keyword">class</span> Point &#123;</span><br><span class="line">    x: <span class="built_in">number</span>;</span><br><span class="line">    y: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Point3d <span class="keyword">extends</span> Point &#123;</span><br><span class="line">    z: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> point3d: Point3d = &#123;x: <span class="number">1</span>, y: <span class="number">2</span>, z: <span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“æ¥å£ç»§æ‰¿äº†ä¸€ä¸ªç±»ç±»å‹æ—¶ï¼Œå®ƒä¼šç»§æ‰¿ç±»çš„æˆå‘˜ä½†ä¸åŒ…æ‹¬å…¶å®ç°ã€‚ å°±å¥½åƒæ¥å£å£°æ˜äº†æ‰€æœ‰ç±»ä¸­å­˜åœ¨çš„æˆå‘˜ï¼Œä½†å¹¶æ²¡æœ‰æä¾›å…·ä½“å®ç°ä¸€æ ·ã€‚ æ¥å£åŒæ ·ä¼šç»§æ‰¿åˆ°ç±»çš„privateå’Œprotectedæˆå‘˜ã€‚ è¿™æ„å‘³ç€å½“ä½ åˆ›å»ºäº†ä¸€ä¸ªæ¥å£ç»§æ‰¿äº†ä¸€ä¸ªæ‹¥æœ‰ç§æœ‰æˆ–å—ä¿æŠ¤çš„æˆå‘˜çš„ç±»æ—¶ï¼Œè¿™ä¸ªæ¥å£ç±»å‹åªèƒ½è¢«è¿™ä¸ªç±»æˆ–å…¶å­ç±»æ‰€å®ç°ï¼ˆimplementï¼‰ã€‚</span></span><br><span class="line"><span class="comment">//å½“ä½ æœ‰ä¸€ä¸ªåºå¤§çš„ç»§æ‰¿ç»“æ„æ—¶è¿™å¾ˆæœ‰ç”¨ï¼Œä½†è¦æŒ‡å‡ºçš„æ˜¯ä½ çš„ä»£ç åªåœ¨å­ç±»æ‹¥æœ‰ç‰¹å®šå±æ€§æ—¶èµ·ä½œç”¨ã€‚ è¿™ä¸ªå­ç±»é™¤äº†ç»§æ‰¿è‡³åŸºç±»å¤–ä¸åŸºç±»æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ ä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">class</span> Control &#123;</span><br><span class="line">    <span class="keyword">private</span> state: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> SelectableControl <span class="keyword">extends</span> Control &#123;</span><br><span class="line">    select(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> Button <span class="keyword">extends</span> Control <span class="keyword">implements</span> SelectableControl &#123;</span><br><span class="line">    select() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> TextBox <span class="keyword">extends</span> Control &#123;</span><br><span class="line">    select() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é”™è¯¯ï¼šâ€œImageâ€ç±»å‹ç¼ºå°‘â€œstateâ€å±æ€§ã€‚</span></span><br><span class="line"><span class="keyword">class</span> Image <span class="keyword">implements</span> SelectableControl &#123;</span><br><span class="line">    select() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> Location &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„çš„ç±»å‹"><a href="#æ•°ç»„çš„ç±»å‹" class="headerlink" title="æ•°ç»„çš„ç±»å‹"></a>æ•°ç»„çš„ç±»å‹</h3><p><code>åœ¨ TypeScript ä¸­ï¼Œæ•°ç»„ç±»å‹æœ‰å¤šç§å®šä¹‰æ–¹å¼ï¼Œæ¯”è¾ƒçµæ´»ã€‚</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ã€Œç±»å‹ + æ–¹æ‹¬å·ã€è¡¨ç¤ºæ³•</span></span><br><span class="line"><span class="keyword">let</span> fibonacci: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line">               <span class="built_in">number</span>|<span class="built_in">string</span>[] = [<span class="string">'1'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ•°ç»„æ³›å‹</span></span><br><span class="line"><span class="keyword">let</span> fibonacci: <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line">               <span class="built_in">Array</span>&lt;<span class="built_in">number</span>|<span class="built_in">string</span>&gt; = [<span class="string">'22'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line"><span class="comment">//              </span></span><br><span class="line"><span class="keyword">let</span> banners: <span class="built_in">Array</span>&lt;&#123; id: <span class="built_in">number</span>, name: <span class="built_in">string</span>, pic: <span class="built_in">string</span>, url: <span class="built_in">string</span> &#125;&gt;=[&#123;id: <span class="number">1</span>, name: <span class="string">"111"</span>, pic: <span class="string">"111"</span>, url: <span class="string">"111"</span>&#125;];</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç”¨æ¥å£è¡¨ç¤ºæ•°ç»„</span></span><br><span class="line"><span class="keyword">interface</span> NumberArray &#123;</span><br><span class="line">    [index: <span class="built_in">number</span>]: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> fibonacci: NumberArray = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">interface</span> NumberArray &#123;</span><br><span class="line">    id: <span class="built_in">number</span>;</span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">    pic: <span class="built_in">string</span>;</span><br><span class="line">    url: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> banners: NumberArray[] = [&#123;id: <span class="number">1</span>, name: <span class="string">"111"</span>, pic: <span class="string">"111"</span>, url: <span class="string">"111"</span>&#125;];</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//any åœ¨æ•°ç»„ä¸­çš„åº”ç”¨</span></span><br><span class="line"><span class="keyword">let</span> list: <span class="built_in">any</span>[] = [<span class="string">'Xcat Liu'</span>, <span class="number">25</span>, &#123; website: <span class="string">'http://xcatliu.com'</span> &#125;];</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°çš„ç±»å‹"><a href="#å‡½æ•°çš„ç±»å‹" class="headerlink" title="å‡½æ•°çš„ç±»å‹"></a>å‡½æ•°çš„ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mySum = <span class="function"><span class="keyword">function</span> (<span class="params">x: <span class="built_in">number</span> = 666, y?: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line"><span class="comment">//å‚æ•°é»˜è®¤å€¼</span></span><br><span class="line"><span class="comment">//å¯é€‰å‚æ•°åé¢ä¸å…è®¸å†å‡ºç°å¿…é¡»å‚æ•°äº†</span></span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//è¿™æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ï¼Œä¸è¿‡äº‹å®ä¸Šåº”è¯¥æ˜¯è¿™æ ·ï¼š</span></span><br><span class="line"><span class="keyword">let</span> mySum: <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = <span class="function"><span class="keyword">function</span> (<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//æ³¨æ„ä¸è¦æ··æ·†äº† TypeScript ä¸­çš„ =&gt; å’Œ ES6 ä¸­çš„ =&gt;ã€‚åœ¨ TypeScript çš„ç±»å‹å®šä¹‰ä¸­ï¼Œ=&gt; ç”¨æ¥è¡¨ç¤ºå‡½æ•°çš„å®šä¹‰ï¼Œå·¦è¾¹æ˜¯è¾“å…¥ç±»å‹ï¼Œéœ€è¦ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œå³è¾¹æ˜¯è¾“å‡ºç±»å‹ã€‚</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> SearchFunc &#123;</span><br><span class="line">    (source: <span class="built_in">string</span>, subString: <span class="built_in">string</span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySearch: SearchFunc;</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span>(<span class="params">source: <span class="built_in">string</span>, subString: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> source.search(subString) !== <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Classç±»"><a href="#Classç±»" class="headerlink" title="Classç±»"></a>Classç±»</h3><p><strong>é»˜è®¤ä¸º <code>public</code></strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±çš„è®¿é—®ç¨‹åºé‡Œå®šä¹‰çš„æˆå‘˜ã€‚ å¦‚æœä½ å¯¹å…¶å®ƒè¯­è¨€ä¸­çš„ç±»æ¯”è¾ƒäº†è§£ï¼Œå°±ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨ä¹‹å‰çš„ä»£ç é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨ publicæ¥åšä¿®é¥°ï¼›ä¾‹å¦‚ï¼ŒC#è¦æ±‚å¿…é¡»æ˜ç¡®åœ°ä½¿ç”¨ publicæŒ‡å®šæˆå‘˜æ˜¯å¯è§çš„ã€‚ åœ¨TypeScripté‡Œï¼Œæˆå‘˜éƒ½é»˜è®¤ä¸º publicã€‚</span></span><br><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">    <span class="keyword">public</span> name: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">theName: <span class="built_in">string</span></span>) &#123; <span class="keyword">this</span>.name = theName; &#125;</span><br><span class="line">    <span class="keyword">public</span> move(distanceInMeters: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> moved <span class="subst">$&#123;distanceInMeters&#125;</span>m.`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç†è§£ <code>private</code></strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æˆå‘˜è¢«æ ‡è®°æˆ privateæ—¶ï¼Œå®ƒå°±ä¸èƒ½åœ¨å£°æ˜å®ƒçš„ç±»çš„å¤–éƒ¨è®¿é—®ã€‚æ¯”å¦‚</span></span><br><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">    <span class="keyword">private</span> name: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">theName: <span class="built_in">string</span></span>) &#123; <span class="keyword">this</span>.name = theName; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Animal(<span class="string">"Cat"</span>).name; <span class="comment">// é”™è¯¯: 'name' æ˜¯ç§æœ‰çš„.</span></span><br></pre></td></tr></table></figure><p><strong>ç†è§£ <code>protected</code></strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//protectedä¿®é¥°ç¬¦ä¸ privateä¿®é¥°ç¬¦çš„è¡Œä¸ºå¾ˆç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼Œ protectedæˆå‘˜åœ¨å­ç±»ä¸­ä»ç„¶å¯ä»¥è®¿é—®ã€‚ä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">    <span class="keyword">protected</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Cat <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> Cat(<span class="string">'heshen'</span>).name</span><br><span class="line"><span class="comment">//æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥è¢«æ ‡è®°æˆ protectedã€‚ è¿™æ„å‘³ç€è¿™ä¸ªç±»ä¸èƒ½åœ¨åŒ…å«å®ƒçš„ç±»å¤–è¢«å®ä¾‹åŒ–ï¼Œä½†æ˜¯èƒ½è¢«ç»§æ‰¿ã€‚æ¯”å¦‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Person &#123;</span><br><span class="line">    <span class="keyword">protected</span> name: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">constructor</span>(<span class="params">theName: <span class="built_in">string</span></span>) &#123; <span class="keyword">this</span>.name = theName; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Employee èƒ½å¤Ÿç»§æ‰¿ Person</span></span><br><span class="line"><span class="keyword">class</span> Employee <span class="keyword">extends</span> Person &#123;</span><br><span class="line">    <span class="keyword">private</span> department: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span>, department: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        <span class="keyword">this</span>.department = department;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> getElevatorPitch() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`Hello, my name is <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> and I work in <span class="subst">$&#123;<span class="keyword">this</span>.department&#125;</span>.`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> howard = <span class="keyword">new</span> Employee(<span class="string">"Howard"</span>, <span class="string">"Sales"</span>);</span><br><span class="line"><span class="keyword">let</span> john = <span class="keyword">new</span> Person(<span class="string">"John"</span>); <span class="comment">// é”™è¯¯: 'Person' çš„æ„é€ å‡½æ•°æ˜¯è¢«ä¿æŠ¤çš„.</span></span><br></pre></td></tr></table></figure><p><strong><code>æŠ½è±¡ç±»</code></strong><br><code>abstract ç”¨äºå®šä¹‰æŠ½è±¡ç±»å’Œå…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é¦–å…ˆï¼ŒæŠ½è±¡ç±»æ˜¯ä¸å…è®¸è¢«å®ä¾‹åŒ–çš„ï¼š</span></span><br><span class="line"><span class="comment">//å…¶æ¬¡ï¼ŒæŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•å¿…é¡»è¢«å­ç±»å®ç°ï¼š</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> Animal &#123;</span><br><span class="line">    <span class="keyword">public</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> sayHi();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Cat <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">    <span class="keyword">public</span> eat() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> is eating.`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Animal(<span class="string">'Jack'</span>);</span><br><span class="line"><span class="comment">// index.ts(9,11): error TS2511: Cannot create an instance of the abstract class 'Animal'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> Cat(<span class="string">'Tom'</span>);</span><br><span class="line"><span class="comment">// index.ts(9,7): error TS2515: Non-abstract class 'Cat' does not implement inherited abstract member 'sayHi' from class 'Animal'.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±» Cat ç»§æ‰¿äº†æŠ½è±¡ç±» Animalï¼Œä½†æ˜¯æ²¡æœ‰å®ç°æŠ½è±¡æ–¹æ³• sayHi</span></span><br></pre></td></tr></table></figure><h3 id="å†…ç½®å¯¹è±¡"><a href="#å†…ç½®å¯¹è±¡" class="headerlink" title="å†…ç½®å¯¹è±¡"></a>å†…ç½®å¯¹è±¡</h3><p><code>ECMAScript æ ‡å‡†æä¾›çš„å†…ç½®å¯¹è±¡æœ‰ï¼š</code><br>Booleanã€Errorã€Dateã€RegExp  Object Numberâ€¦â€¦<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects" target="_blank" rel="noopener">æŸ¥çœ‹æ›´å¤š</a></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> b: <span class="built_in">Boolean</span> = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">let</span> e: <span class="built_in">Error</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Error occurred'</span>);</span><br><span class="line"><span class="keyword">let</span> d: <span class="built_in">Date</span> = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">let</span> r: <span class="built_in">RegExp</span> = <span class="regexp">/[a-z]/</span>;</span><br></pre></td></tr></table></figure><p><code>DOM å’Œ BOM çš„å†…ç½®å¯¹è±¡</code><br>Documentã€HTMLElementã€Eventã€NodeList â€¦..</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> body: HTMLElement = <span class="built_in">document</span>.body;</span><br><span class="line"><span class="keyword">let</span> allDiv: NodeList = <span class="built_in">document</span>.querySelectorAll(<span class="string">'div'</span>);</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e: MouseEvent</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Do something</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>TypeScript æ ¸å¿ƒåº“çš„å®šä¹‰æ–‡ä»¶</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>.pow(<span class="number">10</span>, <span class="string">'2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts(1,14): error TS2345: Argument of type 'string' is not assignable to parameter of type 'number'.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//äº‹å®ä¸ŠMath.pow çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="keyword">interface</span> Math &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of a base expression taken to a specified power.</span></span><br><span class="line"><span class="comment">     * @param x The base value of the expression.</span></span><br><span class="line"><span class="comment">     * @param y The exponent value of the expression.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    pow(x: <span class="built_in">number</span>, y: <span class="built_in">number</span>): <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="type-ç±»å‹åˆ«å"><a href="#type-ç±»å‹åˆ«å" class="headerlink" title="type ç±»å‹åˆ«å"></a>type ç±»å‹åˆ«å</h3><p>type ä¼šç»™ä¸€ä¸ªç±»å‹èµ·ä¸ªæ–°åå­—ã€‚ type æœ‰æ—¶å’Œ interface å¾ˆåƒï¼Œä½†æ˜¯å¯ä»¥ä½œç”¨äºåŸå§‹å€¼ï¼ˆåŸºæœ¬ç±»å‹ï¼‰ï¼Œè”åˆç±»å‹ï¼Œå…ƒç»„ä»¥åŠå…¶å®ƒä»»ä½•ä½ éœ€è¦æ‰‹å†™çš„ç±»å‹ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Name = <span class="built_in">string</span>; <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> NameResolver = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">string</span>; <span class="comment">// å‡½æ•°</span></span><br><span class="line"><span class="keyword">type</span> NameOrResolver = Name | NameResolver; <span class="comment">// è”åˆç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">n: NameOrResolver</span>): <span class="title">Name</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> n === <span class="string">'string'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç±»å‹åˆ«åå¸¸ç”¨äºè”åˆç±»å‹ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹"><a href="#å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹" class="headerlink" title="å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹"></a>å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹</h3><p><code>å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹ç”¨æ¥çº¦æŸå–å€¼åªèƒ½æ˜¯æŸå‡ ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªã€‚</code></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> EventNames = <span class="string">'click'</span> | <span class="string">'scroll'</span> | <span class="string">'mousemove'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleEvent</span>(<span class="params">ele: Element, event: EventNames</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">handleEvent(<span class="built_in">document</span>.getElementById(<span class="string">'hello'</span>), <span class="string">'scroll'</span>);  <span class="comment">// æ²¡é—®é¢˜</span></span><br><span class="line">handleEvent(<span class="built_in">document</span>.getElementById(<span class="string">'world'</span>), <span class="string">'dbclick'</span>); <span class="comment">// æŠ¥é”™ï¼Œevent ä¸èƒ½ä¸º 'dbclick'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts(7,47): error TS2345: Argument of type '"dbclick"' is not assignable to parameter of type 'EventNames'.</span></span><br></pre></td></tr></table></figure><p><strong><code>ç±»å‹åˆ«å</code> ä¸ <code>å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹</code> éƒ½æ˜¯ä½¿ç”¨ <code>type</code> è¿›è¡Œå®šä¹‰</strong></p><h3 id="interface-vs-type"><a href="#interface-vs-type" class="headerlink" title="interface vs type"></a>interface vs type</h3><p><strong>1. Objects / Functions</strong></p><p>ä¸¤è€…éƒ½å¯ä»¥ç”¨æ¥æè¿°å¯¹è±¡æˆ–å‡½æ•°çš„ç±»å‹ï¼Œä½†æ˜¯è¯­æ³•ä¸åŒã€‚</p><p>Interface</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Point &#123;</span><br><span class="line">  x: <span class="built_in">number</span>;</span><br><span class="line">  y: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> SetPoint &#123;</span><br><span class="line">  (x: <span class="built_in">number</span>, y: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Type alias</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Point = &#123;</span><br><span class="line">  x: <span class="built_in">number</span>;</span><br><span class="line">  y: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SetPoint = <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure><p><strong>2. Other Types</strong></p><p>ä¸æ¥å£ä¸åŒï¼Œç±»å‹åˆ«åè¿˜å¯ä»¥ç”¨äºå…¶ä»–ç±»å‹ï¼Œå¦‚åŸºæœ¬ç±»å‹ï¼ˆåŸå§‹å€¼ï¼‰ã€è”åˆç±»å‹ã€å…ƒç»„ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> Name = <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// object</span></span><br><span class="line"><span class="keyword">type</span> PartialPointX = &#123; x: <span class="built_in">number</span>; &#125;;</span><br><span class="line"><span class="keyword">type</span> PartialPointY = &#123; y: <span class="built_in">number</span>; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è”åˆç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> PartialPoint = PartialPointX | PartialPointY;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ƒç¥–</span></span><br><span class="line"><span class="keyword">type</span> Data = [<span class="built_in">number</span>, <span class="built_in">string</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// dom</span></span><br><span class="line"><span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">type</span> B = <span class="keyword">typeof</span> div;</span><br></pre></td></tr></table></figure><p><strong>3. Extend</strong></p><p>Interface extends interface</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> PartialPointX &#123; x: <span class="built_in">number</span>; &#125;</span><br><span class="line"><span class="keyword">interface</span> Point <span class="keyword">extends</span> PartialPointX &#123; y: <span class="built_in">number</span>; &#125;</span><br></pre></td></tr></table></figure><p>Type alias extends type alias</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> PartialPointX = &#123; x: <span class="built_in">number</span>; &#125;;</span><br><span class="line"><span class="keyword">type</span> Point = PartialPointX &amp; &#123; y: <span class="built_in">number</span>; &#125;;</span><br></pre></td></tr></table></figure><p>Interface extends type alias</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> PartialPointX = &#123; x: <span class="built_in">number</span>; &#125;;</span><br><span class="line"><span class="keyword">interface</span> Point <span class="keyword">extends</span> PartialPointX &#123; y: <span class="built_in">number</span>; &#125;</span><br></pre></td></tr></table></figure><p>Type alias extends interface</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> PartialPointX &#123; x: <span class="built_in">number</span>; &#125;</span><br><span class="line"><span class="keyword">type</span> Point = PartialPointX &amp; &#123; y: <span class="built_in">number</span>; &#125;;</span><br></pre></td></tr></table></figure><p><strong>4. Declaration merging</strong><br>ä¸ç±»å‹åˆ«åä¸åŒï¼Œæ¥å£å¯ä»¥å®šä¹‰å¤šæ¬¡ï¼Œå¹¶å°†è¢«è§†ä¸ºå•ä¸ªæ¥å£(åˆå¹¶æ‰€æœ‰å£°æ˜çš„æˆå‘˜)ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Point &#123; x: <span class="built_in">number</span>; &#125;</span><br><span class="line"><span class="keyword">interface</span> Point &#123; y: <span class="built_in">number</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> point: Point = &#123; x: <span class="number">1</span>, y: <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure><p><strong>5. è®¡ç®—å±æ€§ï¼Œç”Ÿæˆæ˜ å°„ç±»å‹</strong></p><p>type èƒ½ä½¿ç”¨ in å…³é”®å­—ç”Ÿæˆæ˜ å°„ç±»å‹ï¼Œä½† interface ä¸è¡Œã€‚</p><p>è¯­æ³•ä¸ç´¢å¼•ç­¾åçš„è¯­æ³•ç±»å‹ï¼Œå†…éƒ¨ä½¿ç”¨äº† for .. inã€‚ å…·æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>ç±»å‹å˜é‡ Kï¼Œå®ƒä¼šä¾æ¬¡ç»‘å®šåˆ°æ¯ä¸ªå±æ€§ã€‚</li><li>å­—ç¬¦ä¸²å­—é¢é‡è”åˆçš„ Keysï¼Œå®ƒåŒ…å«äº†è¦è¿­ä»£çš„å±æ€§åçš„é›†åˆã€‚</li><li>å±æ€§çš„ç»“æœç±»å‹ã€‚</li></ul><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Keys = <span class="string">"firstname"</span> | <span class="string">"surname"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DudeType = &#123;</span><br><span class="line">  [key <span class="keyword">in</span> Keys]: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> test: DudeType = &#123;</span><br><span class="line">  firstname: <span class="string">"Pawel"</span>,</span><br><span class="line">  surname: <span class="string">"Grzybek"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠ¥é”™</span></span><br><span class="line"><span class="comment">//interface DudeType2 &#123;</span></span><br><span class="line"><span class="comment">//  [key in keys]: string</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure><p><strong>6. å…¶ä»–ç»†èŠ‚</strong></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">interface</span> Config &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export default type Config1 = &#123;</span></span><br><span class="line"><span class="comment">//   name: string</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// ä¼šæŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Config2 = &#123;</span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Config2</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><p>interface å’Œ type å¾ˆåƒï¼Œå¾ˆå¤šåœºæ™¯ï¼Œä¸¤è€…éƒ½èƒ½ä½¿ç”¨ã€‚ä½†ä¹Ÿæœ‰ç»†å¾®çš„å·®åˆ«ï¼š</p><ul><li>ç±»å‹ï¼šå¯¹è±¡ã€å‡½æ•°ä¸¤è€…éƒ½é€‚ç”¨ï¼Œä½†æ˜¯ type å¯ä»¥ç”¨äºåŸºç¡€ç±»å‹ã€è”åˆç±»å‹ã€å…ƒç¥–ã€‚</li><li>åŒååˆå¹¶ï¼šinterface æ”¯æŒï¼Œtype ä¸æ”¯æŒã€‚</li><li>è®¡ç®—å±æ€§ï¼štype æ”¯æŒ, interface ä¸æ”¯æŒã€‚</li></ul><h3 id="å£°æ˜æ–‡ä»¶"><a href="#å£°æ˜æ–‡ä»¶" class="headerlink" title="å£°æ˜æ–‡ä»¶"></a>å£°æ˜æ–‡ä»¶</h3><p><code>å£°æ˜è¯­å¥æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¦‚(index.d.ts)ä¸­ï¼Œè¿™å°±æ˜¯å£°æ˜æ–‡ä»¶ï¼Œå£°æ˜æ–‡ä»¶å¿…éœ€ä»¥ .d.ts ä¸ºåç¼€ã€‚</code></p><p>å‡å¦‚æ— æ³•è§£æindex.d.tsï¼Œé‚£ä¹ˆå¯ä»¥æ£€æŸ¥ä¸‹ tsconfig.json ä¸­çš„ filesã€include å’Œ exclude é…ç½®ï¼Œç¡®ä¿å…¶åŒ…å«äº† index.d.ts æ–‡ä»¶</p><h4 id="Reactçš„å£°æ˜æ–‡ä»¶"><a href="#Reactçš„å£°æ˜æ–‡ä»¶" class="headerlink" title="Reactçš„å£°æ˜æ–‡ä»¶"></a>Reactçš„å£°æ˜æ–‡ä»¶</h4><figure class="highlight typescript"><figcaption><span>jsx&#123;1,7&#125;</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; History,Location &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"><span class="keyword">interface</span> IProps &#123;</span><br><span class="line">   location: Location;</span><br><span class="line">   history: History;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; AnyAction, Dispatch &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">interface</span> IProps &#123;</span><br><span class="line">  dispatch: Dispatch&lt;AnyAction&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»§æ‰¿React"><a href="#ç»§æ‰¿React" class="headerlink" title="ç»§æ‰¿React"></a>ç»§æ‰¿React</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; FormComponentProps &#125; <span class="keyword">from</span> <span class="string">'antd/lib/form'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; match &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Dispatch &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºç¡€å±æ€§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IProps <span class="keyword">extends</span> React.HTMLAttributes&lt;HTMLDivElement&gt; &#123;</span><br><span class="line">  dispatch?: Dispatch&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">  match?: match;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Component&lt;P = &#123;&#125;, S = &#123;&#125;&gt; <span class="keyword">extends</span> React.Component&lt;P &amp; IProps, S&gt; &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> PureComponent&lt;P = &#123;&#125;, S = &#123;&#125;&gt; <span class="keyword">extends</span> React.PureComponent&lt;P &amp; IProps, S&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¡¨å•å±æ€§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> FormProps <span class="keyword">extends</span> IProps, FormComponentProps &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> FormComponent&lt;P = &#123;&#125;, S = &#123;&#125;&gt; <span class="keyword">extends</span> React.PureComponent&lt;P &amp; FormProps, S&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="Typescripté”™è¯¯å¿½ç•¥"><a href="#Typescripté”™è¯¯å¿½ç•¥" class="headerlink" title="Typescripté”™è¯¯å¿½ç•¥"></a>Typescripté”™è¯¯å¿½ç•¥</h3><p><strong>å•è¡Œå¿½ç•¥</strong><br><code>// @ts-ignore</code></p><p><strong>å¿½ç•¥å…¨æ–‡</strong><br><code>// @ts-nocheck</code></p><p><strong>å–æ¶ˆå¿½ç•¥å…¨æ–‡</strong><br><code>// @ts-check</code></p>]]></content>
      
      
      <categories>
          
          <category> TypeScript </category>
          
          <category> TypeScriptåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mongodbå®‰è£…</title>
      <link href="/2019/05/10/workspace/Server/sql/mongodb/"/>
      <url>/2019/05/10/workspace/Server/sql/mongodb/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Mongodbå®‰è£…</strong></p><p>[[toc]]</p><h3 id="æœ¬åœ°å®‰è£…mongodb"><a href="#æœ¬åœ°å®‰è£…mongodb" class="headerlink" title="æœ¬åœ°å®‰è£…mongodb"></a>æœ¬åœ°å®‰è£…mongodb</h3><p><a href="https://www.mongodb.com/download-center/community" target="_blank" rel="noopener">å®‰è£…åœ°å€</a></p><p>æ‰“å¼€å®‰è£…çš„ç›®å½•ï¼Œé»˜è®¤æ²¡æœ‰data,etc ,log æ–‡ä»¶çš„</p><p>sudo mkdir -p /data/db</p><p>sudo chown -R zhf /data</p><p>./mongod å°±å¯ä»¥å¯åŠ¨äº†ï¼Œä½†æ˜¯å…¨å±€ä¸èƒ½ä½¿ç”¨ï¼Œéœ€è¦é…ç½®ä¸‹</p><p>è®¾ç½®å…¨å±€è·¯å¾„ ï¼š echo â€˜export PATH=/Users/zhenfeng/mongodb/bin:$PATHâ€™&gt;&gt;~/.bash_profile </p><p>åœ¨æ ¹è·¯å¾„source .bash_profileå°±ç”Ÿæ•ˆäº†ï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸ</p><p>$PATH/ /æ˜¯å¦æœ‰å½“å‰db çš„ç›®å½•</p><p>which mongod  //æ˜¯å¦è·¯å¾„</p><p>é—®é¢˜ï¼šæ•´å¥½ä¹‹åå‘ç°é…ç½®çš„ç¯å¢ƒå˜é‡ï¼ˆmongodï¼‰ä¸èµ·ä½œç”¨äº†ï¼Œæ‰§è¡Œsource .bash_profileåï¼Œmongodå¯ä»¥ç”¨äº†ï¼Œä½†æ˜¯ç»ˆç«¯å…¨éƒ¨å…³é—­åï¼Œå†è¾“å…¥mongodï¼Œå°±ä¸èµ·ä½œç”¨äº†ã€‚</p><p><strong>è§£å†³æ–¹æ³•</strong></p><p>æ‰§è¡Œvi ~/.zshrcæ‰“å¼€.zshrc,å°† source .bash_profile ç²˜è´´åˆ°æœ€ä¸‹é¢ï¼Œä¿å­˜å³å¯ã€‚æˆ–è€…ç›´æ¥open .bash_profileæŠŠé‡Œé¢çš„å†…å®¹ç²˜è´´åˆ°.zshrcé‡Œé¢,ä¿å­˜é‡å¯å³å¯ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯å¯åŠ¨mongodbäº†,cmd+T æ–°å»ºå‘½ä»¤çª—å£ï¼Œä½¿ç”¨å‘½ä»¤ <code>mongod</code> å¯åŠ¨mongoDB serverï¼Œå¯åŠ¨æˆåŠŸåæœ€åä¸€è¡Œåº”è¯¥æ˜¯ç«¯å£å·27017</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://user-gold-cdn.xitu.io/2019/5/24/16ae8fe807c8c514?w=636&h=266&f=png&s=111571" alt=""></p><p>mongodb å¯åŠ¨æˆåŠŸï¼Œæ­£ç­‰å¾…ç€è¢«è¿æ¥ã€‚</p><p>cmd+T æ–°å»ºå‘½ä»¤çª—å£ï¼Œæ‰§è¡Œ <code>mongo</code>ï¼Œè¿›å…¥ mongodb å‘½ä»¤è¡Œæ¨¡å¼ï¼š</p><h3 id="é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰è£…mongodb"><a href="#é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰è£…mongodb" class="headerlink" title="é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰è£…mongodb"></a>é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰è£…mongodb</h3><p>1.ä¸‹è½½mongodb</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¼å®¹æ€§å¥½</span></span><br><span class="line"><span class="attribute">curl</span> -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.2.9.tgz</span><br><span class="line"></span><br><span class="line">curl -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-4.0.13.tgz</span><br></pre></td></tr></table></figure><p>2.è§£å‹</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> zxvf mongodb-linux-x86_64-<span class="number">3</span>.<span class="number">2</span>.<span class="number">9</span>.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># copyåˆ°usrç›®å½•ä¸‹ã€ä½¿ç”¨è§„èŒƒã€‘</span></span><br><span class="line">cp -r mongodb-macos-x86_64-<span class="number">4</span>.<span class="number">0</span>.<span class="number">13</span>   /usr/mongodb</span><br></pre></td></tr></table></figure><p>3.åˆ›å»ºæ•°æ®æ–‡ä»¶å¤¹å’Œæ—¥å¿—æ–‡ä»¶ç­‰</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mkdir</span> -p  /usr/local/mongodb/data</span><br><span class="line">touch /usr/local/mongodb/mongodb.log</span><br><span class="line">touch /usr/local/mongodb/mongodb.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># mongodb.confé…ç½®æ–‡ä»¶å¦‚ä¸‹</span></span><br><span class="line">dbpath=/usr/local/mongodb/data</span><br><span class="line">logpath=/usr/local/mongodb/mongodb.log</span><br><span class="line">logappend = <span class="literal">true</span> </span><br><span class="line">port = <span class="number">27017</span> </span><br><span class="line">fork = <span class="literal">true</span> </span><br><span class="line">auth = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>4.å¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è®¾ç½®å…¨å±€å˜é‡</span><br><span class="line">export PATH&#x3D;$(pwd)&#x2F;bin:$PATH</span><br><span class="line"></span><br><span class="line"># è·³è½¬åˆ°</span><br><span class="line">&#x2F;usr&#x2F;mongodb&#x2F;bin&#x2F;</span><br><span class="line"></span><br><span class="line"># å¼€å¯æ•°æ®åº“</span><br><span class="line">.&#x2F;mongod --config &#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;mongodb.conf</span><br><span class="line">.&#x2F;mongod --dbpath&#x3D;&#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;data --logpath&#x3D;&#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;mongodb.log --logappend  --port&#x3D;27017 --fork</span><br><span class="line"></span><br><span class="line"># å…³é—­æ•°æ®åº“</span><br><span class="line">.&#x2F;mongod -shutdown -dbpath&#x3D;&#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;data</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ˜¯å¦å¼€å¯</span><br><span class="line">netstat -lanp | grep &quot;27017&quot;</span><br><span class="line">ps -ef|grep mongod</span><br><span class="line"></span><br><span class="line"># ä¸èƒ½ä½¿ç”¨kill -9 æ€æ­»mongo</span><br><span class="line"></span><br><span class="line"># è¡¥æ•‘</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;data&#x2F;</span><br><span class="line">rm -rf *.lock</span><br><span class="line">.&#x2F;mongod  --repair</span><br><span class="line"></span><br><span class="line"># ä»0~65535å…¨éƒ¨æ˜¯æ ‡å‡†ç«¯å£ï¼Œä½†æ˜¯ä»0~1024å·ç«¯å£æ˜¯ç³»ç»Ÿç«¯å£ï¼Œç”¨æˆ·æ— æ³•ä¿®æ”¹</span><br><span class="line"># ä»1025~65534ç«¯å£æ˜¯ç³»ç»Ÿä¸ºç”¨æˆ·é¢„ç•™çš„ç«¯å£ï¼Œè€Œ65535å·ç«¯å£ä¸ºç³»ç»Ÿä¿ç•™</span><br></pre></td></tr></table></figure><p>5.åˆ›å»ºå®Œæˆåéœ€è¦åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®é˜²ç«å¢™æ‰èƒ½è¿æ¥</p><h3 id="æ•°æ®åº“çš„æ“ä½œ"><a href="#æ•°æ®åº“çš„æ“ä½œ" class="headerlink" title="æ•°æ®åº“çš„æ“ä½œ"></a>æ•°æ®åº“çš„æ“ä½œ</h3><ul><li><p>å¯¼å‡ºæ•°æ®åº“<br>./mongoexport â€“port [port] â€“db test â€“collection users â€“out export.json</p></li><li><p>å¯¼å…¥æ•°æ®åº“<br>./mongoimport -h 120.79.229.197:27-17 -d test -c scenics â€“file=./export.json</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> Mongodb </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å®ç°JSå¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿</title>
      <link href="/2019/03/19/workspace/Project/copy/"/>
      <url>/2019/03/19/workspace/Project/copy/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>å®ç°JSå¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿</strong></p><p>[[toc]]</p><p><strong>å®ç°JSå¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿</strong></p><p>(1):<a href="https://github.com/zenorocha/clipboard.js" target="_blank" rel="noopener">ç¬¬ä¸‰æ–¹åº“ï¼šclipboard.js</a></p><p>(2):<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand" target="_blank" rel="noopener">åŸç”Ÿæ–¹æ³•ï¼šdocument.execCommand()</a></p><ul><li>execCommand()å…è®¸è¿è¡Œå‘½ä»¤æ¥æ“ä½œå¯ç¼–è¾‘åŒºåŸŸçš„å†…å®¹ï¼Œæ³¨æ„æ˜¯<code>å¯ç¼–è¾‘åŒºåŸŸ</code></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">bool = <span class="built_in">document</span>.execCommand(aCommandName, aShowDefaultUI, aValueArgument)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•è¿”å›ä¸€ä¸ª Boolean å€¼ï¼Œè¡¨ç¤ºæ“ä½œæ˜¯å¦æˆåŠŸã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//aCommandName ï¼šè¡¨ç¤ºå‘½ä»¤åç§°ï¼Œæ¯”å¦‚ï¼š copy, cut ç­‰</span></span><br><span class="line"><span class="comment">//aShowDefaultUIï¼šæ˜¯å¦å±•ç¤ºç”¨æˆ·ç•Œé¢ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ falseï¼›</span></span><br><span class="line"><span class="comment">//aValueArgumentï¼šæœ‰äº›å‘½ä»¤éœ€è¦é¢å¤–çš„å‚æ•°ï¼Œä¸€èˆ¬ç”¨ä¸åˆ°ï¼›</span></span><br></pre></td></tr></table></figure><p>execCommand()æ–¹æ³•çš„å®šä¹‰ä¸­æåˆ°ï¼Œå®ƒåªèƒ½æ“ä½œå¯ç¼–è¾‘åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯æ„å‘³ç€é™¤äº† <code>&lt;input&gt;ã€&lt;textarea&gt;</code>è¿™æ ·çš„è¾“å…¥åŸŸä»¥å¤–ï¼Œæ˜¯æ— æ³•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„ã€‚</p><p><code>æ›²çº¿æ•‘å›½</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">clipboard = <span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> copyText = <span class="built_in">document</span>.createElement(<span class="string">'input'</span>);</span><br><span class="line"> copyText.setAttribute(<span class="string">'readonly'</span>, <span class="string">'readonly'</span>);<span class="comment">//é˜²æ­¢åœ¨ç§»åŠ¨ç«¯é»˜è®¤è·å–ç„¦ç‚¹ï¼Œä½¿é”®ç›˜å¼¹èµ·</span></span><br><span class="line"> copyText.setAttribute(<span class="string">'value'</span>, text);</span><br><span class="line"> <span class="built_in">document</span>.body.appendChild(copyText);</span><br><span class="line"> copyText.select();</span><br><span class="line"> <span class="keyword">if</span> (<span class="built_in">document</span>.execCommand(<span class="string">'copy'</span>)) &#123;</span><br><span class="line">     <span class="built_in">document</span>.execCommand(<span class="string">'copy'</span>);</span><br><span class="line">     alert(<span class="string">'å¤åˆ¶æˆåŠŸ'</span>);</span><br><span class="line"> &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     alert(<span class="string">'è¯·æ‰‹åŠ¨å¤åˆ¶'</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="built_in">document</span>.body.removeChild(copyText);<span class="comment">//åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>seamless-immutable</title>
      <link href="/2019/03/19/workspace/Project/immutable/"/>
      <url>/2019/03/19/workspace/Project/immutable/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>seamless-immutable</strong></p><p>[[toc]]</p><p>Reactåœ¨å‡å°‘é‡å¤æ¸²æŸ“æ–¹é¢ç¡®å®æ˜¯æœ‰ä¸€å¥—ç‹¬ç‰¹çš„å¤„ç†åŠæ³•ï¼Œé‚£å°±æ˜¯è™šæ‹ŸDOMï¼Œä½†æ˜¾ç„¶åœ¨é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™Reactç»æ— å¯èƒ½è¶…è¶ŠåŸç”Ÿçš„é€Ÿåº¦ï¼Œæˆ–è€…ä¸€å®šèƒ½å°†å…¶å®ƒçš„æ¡†æ¶æ¯”ä¸‹å»ã€‚<br>ä½†æ˜¯æ¯æ¬¡æ•°æ®å˜åŠ¨éƒ½ä¼šæ‰§è¡Œrenderï¼Œå¤§å¤§å½±å“äº†æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨ç«¯ã€‚</p><p>JavaScript ä¸­çš„å¯¹è±¡ä¸€èˆ¬æ˜¯å¯å˜çš„ï¼ˆMutableï¼‰ï¼Œå› ä¸ºä½¿ç”¨äº†å¼•ç”¨èµ‹å€¼ï¼Œæ–°çš„å¯¹è±¡ç®€å•çš„å¼•ç”¨äº†åŸå§‹å¯¹è±¡ï¼Œæ”¹å˜æ–°çš„å¯¹è±¡å°†å½±å“åˆ°åŸå§‹å¯¹è±¡ã€‚å¦‚ foo={a: 1}; bar=foo; bar.a=2 ä½ ä¼šå‘ç°æ­¤æ—¶ foo.a ä¹Ÿè¢«æ”¹æˆäº† 2ã€‚è™½ç„¶è¿™æ ·åšå¯ä»¥èŠ‚çº¦å†…å­˜ï¼Œä½†å½“åº”ç”¨å¤æ‚åï¼Œè¿™å°±é€ æˆäº†éå¸¸å¤§çš„éšæ‚£ï¼ŒMutable å¸¦æ¥çš„ä¼˜ç‚¹å˜å¾—å¾—ä¸å¿å¤±ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ä½¿ç”¨ shallowCopyï¼ˆæµ…æ‹·è´ï¼‰æˆ– deepCopyï¼ˆæ·±æ‹·è´ï¼‰æ¥é¿å…è¢«ä¿®æ”¹ï¼Œä½†è¿™æ ·åšé€ æˆäº† CPU å’Œå†…å­˜çš„æµªè´¹ã€‚</p><p>seamless-immutable ä¸immutableåŠŸèƒ½ç±»ä¼¼ï¼Œé€šè¿‡å…±äº«ç°æœ‰åµŒå¥—å¯¹è±¡æ¥æé«˜æ·±åº¦å¤åˆ¶å¤§å‹åµŒå¥—å¯¹è±¡æ—¶çš„é€Ÿåº¦ã€‚seamless-immutableä¸­é€šè¿‡Object.freezeé˜²æ­¢å¯¹è±¡è¢«ä¿®æ”¹ï¼Œå¹¶å®šä¹‰äº†ä¸€ç³»åˆ—APIæ¥å®ç°å¯¹ä¸å¯å˜æ•°æ®ç»“æ„çš„æ“ä½œã€‚(ä»…é™äºæ•°ç»„å’Œå¯¹è±¡)</p><p>ä¸ Immutable.js å­¦é™¢æ´¾çš„é£æ ¼ä¸åŒï¼Œseamless-immutable å¹¶æ²¡æœ‰å®ç°å®Œæ•´çš„ Persistent Data Structureï¼Œ<br>è€Œæ˜¯ä½¿ç”¨ Object.definePropertyï¼ˆå› æ­¤åªèƒ½åœ¨ IE9 åŠä»¥ä¸Šä½¿ç”¨ï¼‰æ‰©å±•äº† JavaScript çš„ Array å’Œ Object å¯¹è±¡æ¥å®ç°ï¼Œ<br>åªæ”¯æŒ Array å’Œ Object ä¸¤ç§æ•°æ®ç±»å‹ï¼ŒAPI åŸºäºä¸ Array å’Œ Object æ“æŒä¸å˜ã€‚ä»£ç åº“éå¸¸å°ï¼Œ<strong>å‹ç¼©åä¸‹è½½åªæœ‰ 2Kã€‚è€Œ Immutable.js å‹ç¼©åä¸‹è½½æœ‰ 16K</strong>ã€‚</p><p>Object.freeze() æ–¹æ³•å¯ä»¥å†»ç»“ä¸€ä¸ªå¯¹è±¡ï¼Œå†»ç»“çš„å¯¹è±¡ä¸èƒ½æ·»åŠ æ–°çš„å±æ€§ï¼Œä¸èƒ½ä¿®æ”¹å…¶å·²æœ‰å±æ€§çš„å€¼ï¼Œä¸èƒ½åˆ é™¤å·²æœ‰å±æ€§ï¼Œä»¥åŠä¸èƒ½ä¿®æ”¹è¯¥å¯¹è±¡å·²æœ‰å±æ€§çš„å¯æšä¸¾æ€§ã€å¯é…ç½®æ€§ã€å¯å†™æ€§ã€‚å°è¯•ä¿®æ”¹ä¼šé™é»˜å¤±è´¥æˆ–æŠ›å‡ºTypeErrorç±»å‹çš„é”™è¯¯ã€‚ç›¸å…³å‡½æ•°è¿˜åŒ…æ‹¬ï¼š<br>Object.isExtensible()<br>Object.seal()<br>Object.freezeå’ŒObject.definePropertyå‡ä¸ºES5ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå› æ­¤ä½¿ç”¨seamless-immutableéœ€ä¿è¯æµè§ˆå™¨ä¸­è¿™äº›æ–¹æ³•å­˜åœ¨</p><p>ä¸ Object.freezeã€const åŒºåˆ«</p><p>Object.freeze å’Œ ES6 ä¸­æ–°åŠ å…¥çš„ const éƒ½å¯ä»¥è¾¾åˆ°é˜²æ­¢å¯¹è±¡è¢«ç¯¡æ”¹çš„åŠŸèƒ½ï¼Œä½†å®ƒä»¬æ˜¯ shallowCopy çš„ã€‚å¯¹è±¡å±‚çº§ä¸€æ·±å°±è¦ç‰¹æ®Šå¤„ç†äº†ã€‚</p><hr><ul><li><strong>å¼€å§‹ä½¿ç”¨</strong></li><li>yarn add seamless-immutable</li><li>import Immutable from â€œseamless-immutableâ€</li></ul><h1 id="Immutable-Array"><a href="#Immutable-Array" class="headerlink" title="Immutable Array"></a>Immutable Array</h1><hr><h3 id="from-type"><a href="#from-type" class="headerlink" title="from(type)"></a>from(type)</h3><ul><li>typeï¼šarray | object</li><li>è®¾ç½®æˆ Immutable å¯¹è±¡</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> code1 = Immutable.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"> <span class="keyword">let</span> code2 = Immutable([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])); <span class="comment">//åŒ from()</span></span><br><span class="line"> <span class="built_in">console</span>.log(code1);<span class="comment">//Immutable([1, 2, 3])</span></span><br><span class="line"> <span class="built_in">console</span>.log(code2);<span class="comment">//Immutable([1, 2, 3])</span></span><br></pre></td></tr></table></figure><h3 id="flatMap-obj-fun"><a href="#flatMap-obj-fun" class="headerlink" title="flatMap(obj,fun)"></a>flatMap(obj,fun)</h3><ul><li>objï¼š immutable</li><li>fun : function</li><li>å¾ªç¯ immutable å¯¹è±¡ï¼Œ è¿”å› ä¸€ä¸ªæ–°çš„ immutable å¯¹è±¡</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> array = Immutable([<span class="string">'AA'</span>, <span class="string">'BB'</span>, <span class="string">'CC'</span>]);</span><br><span class="line"><span class="keyword">let</span> newarr = Immutable.flatMap(array, str =&gt; <span class="string">'hello '</span> + str);</span><br><span class="line"><span class="built_in">console</span>.log(newarr); <span class="comment">//Immutable(["hello AA", "hello BB", "hello CC"])</span></span><br></pre></td></tr></table></figure><h3 id="isImmutable-type"><a href="#isImmutable-type" class="headerlink" title="isImmutable(type)"></a>isImmutable(type)</h3><ul><li><p>typeï¼šarray | object | immutable</p></li><li><p>åˆ¤æ–­æ˜¯å¦æ˜¯ Immutable å¯¹è±¡</p></li><li><p>æ³¨ï¼šå‚æ•°å¦‚æœæ˜¯ int string bool,undefined,null è¿”å› true</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> code1=Immutable.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">let</span> code2= &#123;<span class="attr">a</span>: <span class="number">12</span>&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(Immutable.isImmutable(code1)); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(Immutable.isImmutable(code2)); <span class="comment">//false</span></span><br></pre></td></tr></table></figure><h1 id="Immutable-Object-Array"><a href="#Immutable-Object-Array" class="headerlink" title="Immutable Object || Array"></a>Immutable Object || Array</h1></li></ul><hr><h3 id="asMutable-obj-type"><a href="#asMutable-obj-type" class="headerlink" title="asMutable(obj,type)"></a>asMutable(obj,type)</h3><ul><li>objï¼š immutable</li><li>typeï¼šé»˜è®¤æ˜¯{deep:false}</li><li>è¿”å›æ•°ç»„çš„å¯å˜å‰¯æœ¬,å¯¹äºæ·±åº¦å¯å˜çš„å‰¯æœ¬éœ€è®¾ç½® {deep:true}</li><li><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> mutableArray = immutable.asMutable(banner,&#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">    mutableArray.map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> item.victory=<span class="string">'victory'</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(mutableArray,banner);<span class="comment">//å¯æ”¹å˜</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="Immutable-Object"><a href="#Immutable-Object" class="headerlink" title="Immutable Object"></a>Immutable Object</h1><hr><h3 id="merge-obj1-obj2-type"><a href="#merge-obj1-obj2-type" class="headerlink" title="merge (obj1,obj2,type)"></a>merge (obj1,obj2,type)</h3><ul><li>obj1 immutable</li><li>obj2 : object| array</li><li>type: object é»˜è®¤æ˜¯{deep:false}</li><li></li><li>è¿”å›åˆå¹¶åçš„ Immutable,å¯¹äºæ·±åº¦å¯å˜çš„å‰¯æœ¬éœ€è®¾ç½® {deep:true}</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//code1:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'AA'</span>, <span class="attr">b</span>: <span class="string">'BB'</span>, <span class="attr">c</span>: <span class="string">'CC'</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> newobj = Immutable.merge(obj, &#123;<span class="attr">c</span>: <span class="string">'CC'</span>, <span class="attr">d</span>: <span class="string">'DD'</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(newobj); <span class="comment">// Immutable(&#123;a: "AA", b: "BB", c: "CC", d: "DD"&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//code2:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">status</span>: <span class="string">'ok'</span>, <span class="attr">data</span>: &#123;<span class="attr">a</span>: <span class="string">'AA'</span>, <span class="attr">b</span>: <span class="string">'BB'</span>&#125;&#125;);</span><br><span class="line"><span class="keyword">let</span> newsobj = Immutable.merge(obj, [&#123;<span class="attr">status</span>: <span class="string">'error'</span>, <span class="attr">data</span>: &#123;<span class="attr">c</span>: <span class="string">'CC'</span>&#125;&#125;, &#123;<span class="attr">data</span>: &#123;<span class="attr">a</span>: <span class="string">'AAAA'</span>&#125;&#125;], &#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(newsobj); <span class="comment">//Immutable(&#123;status: "error", &#123;a: "AAAA", b: "BB", c: "CC"&#125;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//code3:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> code1 = Immutable([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">//Arrayæ— æ•ˆ</span></span><br><span class="line"><span class="keyword">let</span> code2 = Immutable.merge(code1, [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(code2); <span class="comment">//Immutable([1,2,3])</span></span><br></pre></td></tr></table></figure><h3 id="replace-obj1-obj2-type"><a href="#replace-obj1-obj2-type" class="headerlink" title="replace(obj1,obj2,type)"></a>replace(obj1,obj2,type)</h3><ul><li><p>obj1 immutable</p></li><li><p>obj2 : object</p></li><li><p>type: object é»˜è®¤æ˜¯{deep:false}</p></li><li><p>è¿”å›æ›¿æ¢åçš„ Immutable,å¯¹äºæ·±åº¦å¯å˜çš„å‰¯æœ¬éœ€è®¾ç½® {deep:true}</p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = Immutable(&#123;<span class="attr">a</span>: &#123;<span class="attr">b</span>: <span class="string">'test'</span>&#125;, <span class="attr">c</span>: <span class="string">'test'</span>&#125;);</span><br><span class="line"><span class="keyword">var</span> obj2 = Immutable.replace(obj1, &#123;<span class="attr">a</span>: &#123;<span class="attr">b</span>: <span class="string">'test'</span>&#125;, <span class="attr">d</span>: <span class="string">'ok'</span>&#125;, &#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(obj2);<span class="comment">//Immutable(&#123;a: &#123;b: 'test'&#125;, d: 'ok'&#125;)</span></span><br><span class="line"><span class="built_in">console</span>.log(obj1 === obj2); <span class="comment">//  false</span></span><br><span class="line"><span class="built_in">console</span>.log(obj1.a === obj2.a); <span class="comment">//  trueã€‚</span></span><br></pre></td></tr></table></figure><h3 id="set-obj-key-value-type"><a href="#set-obj-key-value-type" class="headerlink" title="set(obj,key,value,type)"></a>set(obj,key,value,type)</h3><ul><li>obj1 immutable</li><li>key : string</li><li>value : any</li><li>type: object é»˜è®¤æ˜¯{deep:false}</li><li>è®¾ç½® immutable å¯¹è±¡åˆ¶å®šçš„å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'AA'</span>, <span class="attr">b</span>: <span class="string">'BB'</span>, <span class="attr">c</span>: &#123;<span class="attr">d</span>: <span class="string">'DD'</span>&#125;&#125;);</span><br><span class="line"><span class="keyword">let</span> newobj = Immutable.set(obj, <span class="string">'b'</span>, <span class="string">'BBB'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj); <span class="comment">// Immutable(&#123;a: 'AA', b: 'BB', c: &#123;d: 'DD'&#125;&#125;)</span></span><br><span class="line"><span class="built_in">console</span>.log(newobj); <span class="comment">// Immutable(&#123;a: 'AA', b: 'BBB', c: &#123;d: 'DD'&#125;&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="setIn-obj-key-value-type"><a href="#setIn-obj-key-value-type" class="headerlink" title="setIn (obj,key,value,type)"></a>setIn (obj,key,value,type)</h3><ul><li>obj1 immutable</li><li>key : string</li><li>value : any</li><li>type: object é»˜è®¤æ˜¯{deep:false}</li><li>æ·±åº¦è®¾ç½® immutable å¯¹è±¡åˆ¶å®šçš„å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'AA'</span>, <span class="attr">b</span>: <span class="string">'BB'</span>, <span class="attr">c</span>: &#123;<span class="attr">d</span>: <span class="string">'DD'</span>&#125;&#125;);</span><br><span class="line"><span class="keyword">let</span> newobj = Immutable.setIn(obj, [<span class="string">'c'</span>, <span class="string">'d'</span>], <span class="string">'DDDD'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj);<span class="comment">//Immutable(&#123;a: 'AA', b: 'BB', c: &#123;d: 'DD'&#125;)</span></span><br><span class="line"><span class="built_in">console</span>.log(newobj); <span class="comment">//Immutable(&#123;a: 'AA', b: 'BB', c: &#123;d: 'DDDD'&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="getIn-ob-arr-default"><a href="#getIn-ob-arr-default" class="headerlink" title="getIn(ob,arr,default)"></a>getIn(ob,arr,default)</h3><ul><li>objï¼š immutable</li><li>key : array</li><li>default : å¦‚æœè¿”å›å€¼ä¸ºç©ºåˆ™è¿”å›é»˜è®¤å€¼</li><li>è·å– immutable å¯¹è±¡æŒ‡å®šçš„å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: &#123;<span class="attr">b</span>: <span class="string">'BB'</span>, <span class="attr">c</span>: <span class="string">'CC'</span>&#125;, <span class="attr">d</span>: <span class="string">'DD'</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> code1 = Immutable.getIn(obj, [<span class="string">'a'</span>, <span class="string">'b'</span>]);</span><br><span class="line"><span class="keyword">let</span> code2 = Immutable.getIn(obj, [<span class="string">'a'</span>, <span class="string">'c'</span>], <span class="string">'EE'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(code1); <span class="comment">//BB</span></span><br><span class="line"><span class="built_in">console</span>.log(code2); <span class="comment">//CC</span></span><br></pre></td></tr></table></figure><h3 id="update-obj-key-fun-parmas"><a href="#update-obj-key-fun-parmas" class="headerlink" title="update(obj,key,fun,parmas)"></a>update(obj,key,fun,parmas)</h3><ul><li>objï¼š immutable</li><li>key : string</li><li>fun : function</li><li>parmasï¼šanyï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°</li><li>ä¿®æ”¹ immutable å¯¹è±¡çš„å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//code1:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="params">x</span> =&gt;</span> x + x;</span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'AA'</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> newobj = Immutable.update(obj, <span class="string">'a'</span>, fun);</span><br><span class="line"><span class="built_in">console</span>.log(obj); <span class="comment">//Immutable(&#123;a: 'AA'&#125;)</span></span><br><span class="line"><span class="built_in">console</span>.log(newobj); <span class="comment">// Immutable(&#123;a: 'AAAA'&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//code 2 :</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + <span class="string">' '</span> + y;</span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'hello'</span>&#125;);</span><br><span class="line"><span class="keyword">var</span> newobj = Immutable.update(obj, <span class="string">'a'</span>, add, <span class="string">'world'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj); <span class="comment">//Immutable(&#123;a: 'hello'&#125;)</span></span><br><span class="line"><span class="built_in">console</span>.log(newobj); <span class="comment">//Immutable(&#123;a: 'hello world'&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="updateIn-obj-key-fun-parmas"><a href="#updateIn-obj-key-fun-parmas" class="headerlink" title="updateIn(obj,key,fun,parmas)"></a>updateIn(obj,key,fun,parmas)</h3><ul><li>objï¼š immutable</li><li>key : array</li><li>fun : function</li><li>parmasï¼šanyï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°</li><li>æ·±åº¦ä¿®æ”¹ immutable å¯¹è±¡çš„å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y;</span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: &#123;<span class="attr">b</span>: <span class="number">1</span>&#125;&#125;);</span><br><span class="line"><span class="keyword">let</span> newobj = Immutable.updateIn(obj, [<span class="string">'a'</span>, <span class="string">'b'</span>], add, <span class="number">10</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj);workspace</span><br><span class="line"><span class="built_in">console</span>.log(newobj); workspace</span><br></pre></td></tr></table></figure><h3 id="without-obj-key"><a href="#without-obj-key" class="headerlink" title="without(obj,key)"></a>without(obj,key)</h3><ul><li>objï¼š immutable</li><li>key : array | string |function</li><li>åˆ é™¤ immutable å¯¹è±¡çš„å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//code 1:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'AA'</span>, <span class="attr">b</span>: <span class="string">'BB'</span>, <span class="attr">c</span>: <span class="string">'CC'</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> obj1 = Immutable.without(obj, <span class="string">'b'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj1); <span class="comment">// Immutable(&#123;a: 'AA', c: 'CC'&#125;)</span></span><br><span class="line"></span><br><span class="line">code <span class="number">2</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'AA'</span>, <span class="attr">b</span>: <span class="string">'BB'</span>, <span class="attr">c</span>: <span class="string">'CC'</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> obj2 = Immutable.without(obj, [<span class="string">'a'</span>, <span class="string">'b'</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(obj2); <span class="comment">// Immutable(&#123; c: 'CC'&#125;)</span></span><br><span class="line"></span><br><span class="line">code <span class="number">3</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'AA'</span>, <span class="attr">b</span>: <span class="string">'BB'</span>, <span class="attr">c</span>: <span class="string">'CC'</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> obj3 = Immutable.without(obj, <span class="string">'a'</span>, <span class="string">'b'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj3); <span class="comment">// Immutable(&#123; c: 'CC'&#125;)</span></span><br><span class="line"></span><br><span class="line">code <span class="number">4</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = Immutable(&#123;<span class="attr">a</span>: <span class="string">'AA'</span>, <span class="attr">b</span>: <span class="string">'BB'</span>, <span class="attr">c</span>: <span class="string">'CC'</span>&#125;);</span><br><span class="line"><span class="keyword">let</span> obj4 = Immutable.without(obj, (value, key) =&gt; key === <span class="string">'a'</span> || value === <span class="string">'BB'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj4); <span class="comment">// Immutable(&#123; c: 'CC'&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="asObject-obj-fun"><a href="#asObject-obj-fun" class="headerlink" title="asObject(obj,fun)"></a>asObject(obj,fun)</h3><ul><li>objï¼š immutable</li><li>fun : function</li><li>è¿­ä»£å™¨å‡½æ•°å°†è¿”å›ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ - ç¬¬ä¸€ä¸ªè¡¨ç¤ºé”®ï¼Œå¦ä¸€ä¸ªè¡¨ç¤ºå€¼ã€‚ç„¶åè¿”- å›ç”±è¿™äº›é”®å’Œå€¼æ„æˆçš„ä¸å¯å˜å¯¹è±¡ã€‚</li></ul><pre><code class="javascript"><span class="comment">//code1</span> <span class="keyword">var</span> array = immutable([<span class="string">"hey"</span>, <span class="string">"you"</span>]);    <span class="keyword">var</span> tempAry = immutable.asObject(array, <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>{      <span class="keyword">return</span> [str,str]    });  <span class="built_in">console</span>.log(tempAry);   <span class="comment">//{hey: "hey", you: "you"}</span><span class="comment">//code2</span>,<span class="keyword">var</span> array = Immutable([<span class="string">'aa'</span>, <span class="string">'bb'</span>]);<span class="keyword">let</span> newobj = Immutable.asObject(array, str =&gt; {    <span class="keyword">return</span> [str, str.toUpperCase()];});<span class="built_in">console</span>.log(newobj); <span class="comment">//Immutable({aa: "AA", bb: "BB"})</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>leetCode</title>
      <link href="/2019/03/19/workspace/Project/leetcode/"/>
      <url>/2019/03/19/workspace/Project/leetcode/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>leetCode</strong></p><p>[[toc]]</p><h3 id="ä¸¤æ•°ä¹‹å’Œ"><a href="#ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="ä¸¤æ•°ä¹‹å’Œ"></a>ä¸¤æ•°ä¹‹å’Œ</h3><p><strong>ç¤ºä¾‹ï¼š</strong></p><pre><code>ç»™å®š nums = [2, 7, 11, 15], target = 9å› ä¸º nums[0] + nums[1] = 2 + 7 = 9æ‰€ä»¥è¿”å› [0, 1]</code></pre><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number[]&#125;</span> <span class="variable">nums</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">target</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number[]&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> twoSum = <span class="function"><span class="keyword">function</span>(<span class="params">nums, target</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> obj=&#123;&#125;;</span><br><span class="line">   <span class="keyword">const</span> len=nums.length;</span><br><span class="line">   <span class="keyword">if</span>(len&lt;<span class="number">2</span>)<span class="keyword">return</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">      <span class="keyword">let</span> otherNum=target-nums[i]</span><br><span class="line">      <span class="keyword">if</span>(otherNum <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        <span class="keyword">return</span> [obj[otherNum],i]</span><br><span class="line">      &#125;</span><br><span class="line">      obj[nums[i]]=i</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> twoSum = <span class="function"><span class="keyword">function</span>(<span class="params">nums, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> diff = target - nums[i]</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; nums.length; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nums[j] === diff) &#123;</span><br><span class="line">        <span class="keyword">return</span> [i, j]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="1-2-3-5-8â€¦æ±‚ç¬¬ä¸€ç™¾ä¸ªæ•°"><a href="#1-2-3-5-8â€¦æ±‚ç¬¬ä¸€ç™¾ä¸ªæ•°" class="headerlink" title="1,2,3,5,8â€¦æ±‚ç¬¬ä¸€ç™¾ä¸ªæ•°"></a>1,2,3,5,8â€¦æ±‚ç¬¬ä¸€ç™¾ä¸ªæ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findIndexNum</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> ary = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>]</span><br><span class="line">    <span class="keyword">if</span>(ary.length&gt;=n)&#123;</span><br><span class="line">     <span class="keyword">return</span> ary[n<span class="number">-1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Array</span>.from(<span class="built_in">Array</span>(n<span class="number">-4</span>), (key, index) =&gt; index).forEach(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">let</span> len =ary.length;</span><br><span class="line">      <span class="keyword">let</span> sum = ary[len<span class="number">-2</span>]+ary[len<span class="number">-1</span>]</span><br><span class="line">      ary.push(sum)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> ary[n<span class="number">-1</span>]    </span><br><span class="line">&#125;</span><br><span class="line">findIndexNum(<span class="number">100</span>)</span><br></pre></td></tr></table></figure><h3 id="æ±‚æ•°ç»„ä¸­è¿ç»­æ•°æœ€å¤§ä¸ªæ•°"><a href="#æ±‚æ•°ç»„ä¸­è¿ç»­æ•°æœ€å¤§ä¸ªæ•°" class="headerlink" title="æ±‚æ•°ç»„ä¸­è¿ç»­æ•°æœ€å¤§ä¸ªæ•°"></a>æ±‚æ•°ç»„ä¸­è¿ç»­æ•°æœ€å¤§ä¸ªæ•°</h3><pre><code>ç»™å®šä¸€ä¸ªæ•°ç»„, é‡Œé¢çš„å…ƒç´ å…¨éƒ¨ç”±0å’Œ1ç»„æˆ, è®¡ç®—å…¶ä¸­æœ€å¤§è¿ç»­1çš„ä¸ªæ•°è¾“å…¥: [1,1,0,1,1,1]è¾“å‡º: 3è§£é‡Š: å¼€å¤´çš„ä¸¤ä½å’Œæœ€åçš„ä¸‰ä½éƒ½æ˜¯è¿ç»­1, æ‰€ä»¥æœ€å¤§è¿ç»­1çš„ä¸ªæ•°æ˜¯3</code></pre><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isBiggest</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">let</span> arg = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[i] !== arr[i + <span class="number">1</span>]) &#123;</span><br><span class="line">      count++;</span><br><span class="line">      arg.push(count);</span><br><span class="line">      count = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      count++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.max(...arg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¼šç”¨åˆ°çš„æ’ä»¶</title>
      <link href="/2019/03/19/workspace/Project/more/"/>
      <url>/2019/03/19/workspace/Project/more/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ä¼šç”¨åˆ°çš„æ’ä»¶</strong></p><ul><li><p><a href="https://github.com/daneden/animate.css" target="_blank" rel="noopener">animate.css</a></p></li><li><p><a href="https://github.com/buildo/react-placeholder" target="_blank" rel="noopener">éª¨æ¶å±</a></p></li><li><p><a href="https://github.com/dwqs/blog/issues/72" target="_blank" rel="noopener">react-virtualized</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2018/07/indexeddb.html" target="_blank" rel="noopener">indexedDB</a></p></li><li><p><a href="http://graphql.cn/learn/" target="_blank" rel="noopener">GraphQL</a></p></li><li><p>ç§»åŠ¨ç«¯æ»šåŠ¨</p><ul><li><a href="https://github.com/ustbhuangyi/better-scroll" target="_blank" rel="noopener">better-scroll</a>å¼ºå¤§</li><li><a href="https://github.com/yiminghe/zscroller" target="_blank" rel="noopener">zscroller</a> antmå†…ç½®çš„</li><li><a href="https://zynga.github.io/scroller" target="_blank" rel="noopener">scroller</a> zscrollerå°±æ˜¯åŸºäºè¿™ä¸ª</li></ul></li><li><p><a href="https://tylermcginnis.com/react-higher-order-components/" target="_blank" rel="noopener">é«˜é˜¶å‡½æ•°</a></p></li><li><p><a href="https://juejin.im/post/5c1a506d5188253ff1477d6f?utm_source=gold_browser_extension" target="_blank" rel="noopener">webpack</a></p></li><li><p><a href="http://www.typescriptlang.org/play/index.html" target="_blank" rel="noopener">typescript</a></p></li><li><p><a href="https://github.com/Tencent/vConsole/blob/dev/README_CN.md" target="_blank" rel="noopener">vConsole</a> å®ƒæ˜¯å¾®ä¿¡å›¢é˜Ÿå¼€æºçš„ä¸€ä¸ªè½»é‡ã€å¯æ‹“å±•ã€é’ˆå¯¹æ‰‹æœºç½‘é¡µçš„å‰ç«¯å¼€å‘è€…è°ƒè¯•é¢æ¿ï¼Œ</p><ul><li>ä¸»è¦æ“ä½œå¯ä»¥æŸ¥çœ‹å®˜æ–¹<a href="https://github.com/Tencent/vConsole" target="_blank" rel="noopener">æ–‡æ¡£</a>,å®ƒæœ‰ä¸€ä¸‹ç‰¹æ€§ï¼š</li><li>æŸ¥çœ‹consoleæ—¥å¿—</li><li>æŸ¥çœ‹ç½‘ç»œè¯·æ±‚</li><li>æŸ¥çœ‹elementç»“æ„</li><li>æŸ¥çœ‹Cookieså’ŒlocalStorage</li><li>æ‰‹åŠ¨æ‰§è¡ŒJSå‘½ä»¤è¡Œ</li><li>è‡ªå®šä¹‰æ’ä»¶</li></ul></li><li><p><a href="https://github.com/dimsemenov/PhotoSwipe" target="_blank" rel="noopener">ç§»åŠ¨ç«¯æŸ¥çœ‹å¤§å›¾</a></p></li><li><p><a href="http://fengyuanchen.github.io/cropper/" target="_blank" rel="noopener">cropperç»„ä»¶ï¼Œç”¨äºå›¾ç‰‡ä¸Šä¼ è£å‰ª</a></p></li><li><p><a href="https://github.com/jamiebuilds/react-loadable?utm_source=gold_browser_extension" target="_blank" rel="noopener">react-loadable</a>-ä¸»è¦å®ç°å¼‚æ­¥åŠ è½½ï¼ˆä¹Ÿå¯ä»¥é¢„åŠ è½½ï¼‰</p></li><li><p><a href="https://www.cnblogs.com/alan2kat/p/7754846.html" target="_blank" rel="noopener">React-Router4 æŒ‰éœ€åŠ è½½çš„4ç§å®ç°</a></p></li><li><p><a href="https://eggjs.org/zh-cn/tutorials/typescript.html" target="_blank" rel="noopener">eggåå°åº”ç”¨æ¡†æ¶</a></p></li><li><p><a href="https://koa.bootcss.com/" target="_blank" rel="noopener">koa</a></p></li><li><p><a href="http://mongoosejs.net/docs/schematypes.html" target="_blank" rel="noopener">mongoosejs</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å…¨å±å®ç°æ–¹æ¡ˆ</title>
      <link href="/2019/03/19/workspace/Project/screenfull/"/>
      <url>/2019/03/19/workspace/Project/screenfull/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>å…¨å±å®ç°æ–¹æ¡ˆ</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">        &lt;title&gt;&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;button onclick=<span class="string">"fullScreen()"</span>&gt;ç°ä»£æµè§ˆå™¨å…¨å±&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        &lt;button onclick="exitScreen()"&gt;ç°ä»£æµè§ˆå™¨é€€å‡º&lt;/</span>button&gt;</span><br><span class="line"></span><br><span class="line">        &lt;button onclick=<span class="string">"iefull()"</span>&gt;ä½ç‰ˆæœ¬ieå…¨å±&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>body&gt;</span><br><span class="line">    &lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">        <span class="comment">//å…¨å±</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">fullScreen</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> el = <span class="built_in">document</span>.documentElement;</span><br><span class="line">            <span class="keyword">var</span> rfs = el.requestFullScreen || el.webkitRequestFullScreen || el.mozRequestFullScreen || el.msRequestFullscreen;      </span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">typeof</span> rfs != <span class="string">"undefined"</span> &amp;&amp; rfs) &#123;</span><br><span class="line">                    rfs.call(el);</span><br><span class="line">                &#125;;</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€€å‡ºå…¨å±</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">exitScreen</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">document</span>.exitFullscreen) &#123;  </span><br><span class="line">                <span class="built_in">document</span>.exitFullscreen();  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.mozCancelFullScreen) &#123;  </span><br><span class="line">                <span class="built_in">document</span>.mozCancelFullScreen();  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.webkitCancelFullScreen) &#123;  </span><br><span class="line">                <span class="built_in">document</span>.webkitCancelFullScreen();  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.msExitFullscreen) &#123;  </span><br><span class="line">                <span class="built_in">document</span>.msExitFullscreen();  </span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">typeof</span> cfs != <span class="string">"undefined"</span> &amp;&amp; cfs) &#123;</span><br><span class="line">                cfs.call(el);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ieä½ç‰ˆæœ¬çš„å…¨å±ï¼Œé€€å‡ºå…¨å±éƒ½è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">iefull</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> el = <span class="built_in">document</span>.documentElement;</span><br><span class="line">            <span class="keyword">var</span> rfs =  el.msRequestFullScreen;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="built_in">window</span>.ActiveXObject != <span class="string">"undefined"</span>) &#123;</span><br><span class="line">                <span class="comment">//è¿™çš„æ–¹æ³• æ¨¡æ‹Ÿf11é”®ï¼Œä½¿æµè§ˆå™¨å…¨å±</span></span><br><span class="line">                <span class="keyword">var</span> wscript = <span class="keyword">new</span> ActiveXObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line">                <span class="keyword">if</span>(wscript != <span class="literal">null</span>) &#123;</span><br><span class="line">                    wscript.SendKeys(<span class="string">"&#123;F11&#125;"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ³¨ï¼šieè°ƒç”¨ActiveXæ§ä»¶ï¼Œéœ€è¦åœ¨ieæµè§ˆå™¨å®‰å…¨è®¾ç½®é‡Œé¢æŠŠ â€˜æœªæ ‡è®°ä¸ºå¯å®‰å…¨æ‰§è¡Œè„šæœ¬çš„ActiveXæ§ä»¶åˆå§‹åŒ–å¹¶æ‰§è¡Œè„šæœ¬â€™ è®¾ç½®ä¸ºå¯ç”¨</span></span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨åˆ°çš„æ–¹æ³•</title>
      <link href="/2019/03/19/workspace/Project/method/"/>
      <url>/2019/03/19/workspace/Project/method/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ç”¨åˆ°çš„æ–¹æ³•</strong></p><p>[[toc]]</p><h3 id="è·å–ç»™å®šèŒƒå›´çš„éšæœºæ•°"><a href="#è·å–ç»™å®šèŒƒå›´çš„éšæœºæ•°" class="headerlink" title="è·å–ç»™å®šèŒƒå›´çš„éšæœºæ•°"></a>è·å–ç»™å®šèŒƒå›´çš„éšæœºæ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span>  getRand= <span class="function">(<span class="params">min, max</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> range = max - min + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * range + min);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¸é¡¶"><a href="#å¸é¡¶" class="headerlink" title="å¸é¡¶"></a>å¸é¡¶</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//titleFixedæ˜¯classNameçš„åå­—</span></span><br><span class="line"><span class="keyword">let</span> offsetTop =[dom].getBoundingClientRect().top;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (offsetTop &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.titleFixed = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.titleFixed = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ”¹æˆä¸‰å…ƒ</span></span><br><span class="line">(offsetTop &lt; <span class="number">0</span>) ? <span class="keyword">this</span>. titleFixed = <span class="literal">true</span> : <span class="keyword">this</span>. titleFixed = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//æˆ‘ä»¬å‘ç°æ¡ä»¶å—é‡Œé¢çš„èµ‹å€¼æƒ…å†µæ˜¯å¸ƒå°”å€¼ï¼Œæ‰€ä»¥å¯ä»¥æ›´ç®€å•</span></span><br><span class="line"><span class="keyword">this</span>. titleFixed = offsetTop &lt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŸç”Ÿjsè·å–åˆ°é¡¶éƒ¨-å·¦ä¾§çš„è·ç¦»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getOffset</span>(<span class="params">obj, direction</span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> offsetL = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> offsetT = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>( obj !== <span class="built_in">window</span>. document.body &amp;&amp; obj !== <span class="literal">null</span> )&#123;</span><br><span class="line">offsetL += obj.offsetLeft;</span><br><span class="line">offsetT += obj.offsetTop;</span><br><span class="line">obj = obj.offsetParent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(direction === <span class="string">'left'</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> offsetL;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> offsetT</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²å»ç©º"><a href="#å­—ç¬¦ä¸²å»ç©º" class="headerlink" title="å­—ç¬¦ä¸²å»ç©º"></a>å­—ç¬¦ä¸²å»ç©º</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å»ç©º é»˜è®¤æ˜¯ä¸¤è¾¹çš„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str éœ€è¦è¿›è¡Œå»ç©ºæ ¼çš„å†…å®¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>is_global æ˜¯å¦å…¨éƒ¨å»é™¤ç©ºæ ¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> trim = <span class="function">(<span class="params">str, is_global</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result;</span><br><span class="line">    result = str.replace(<span class="regexp">/(^\s+)|(\s+$)/g</span>, <span class="string">""</span>);</span><br><span class="line">    <span class="keyword">if</span> (is_global.toLowerCase() === <span class="string">"g"</span>) &#123;</span><br><span class="line">        result = result.replace(<span class="regexp">/\s/g</span>, <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ç»å¸¸ç”¨åˆ°çš„ä¸€äº›å°æ­£åˆ™"><a href="#ç»å¸¸ç”¨åˆ°çš„ä¸€äº›å°æ­£åˆ™" class="headerlink" title="ç»å¸¸ç”¨åˆ°çš„ä¸€äº›å°æ­£åˆ™"></a>ç»å¸¸ç”¨åˆ°çš„ä¸€äº›å°æ­£åˆ™</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒ¹é…8-16ä½æ•°å­—å’Œå­—æ¯å¯†ç çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]&#123;8,16&#125;$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…èº«ä»½è¯å·ç </span></span><br><span class="line"><span class="keyword">let</span> reg=<span class="regexp">/(^\d&#123;15&#125;$)|(^\d&#123;18&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…ä¸­æ–‡</span></span><br><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/^[\u4e00-\u9fa5]*$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒ¹é…æ‰‹æœºå·</span></span><br><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/^1\d&#123;10&#125;$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒ¹é…æ‹¬å·é‡Œé¢çš„æ–‡å­— </span></span><br><span class="line"><span class="keyword">let</span> reg =<span class="regexp">/\(([^)]*)\)/g</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒ¹é…åƒåˆ†ä½</span></span><br><span class="line"><span class="keyword">let</span> reg =<span class="regexp">/^(-)?\d&#123;1,3&#125;(,\d&#123;3&#125;)*(.\d+)?$/</span></span><br></pre></td></tr></table></figure><h3 id="å•å‡»å’ŒåŒå‡»åŒæ—¶å­˜åœ¨"><a href="#å•å‡»å’ŒåŒå‡»åŒæ—¶å­˜åœ¨" class="headerlink" title="å•å‡»å’ŒåŒå‡»åŒæ—¶å­˜åœ¨"></a>å•å‡»å’ŒåŒå‡»åŒæ—¶å­˜åœ¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> dbJumpHome = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.clickTimer) &#123;</span><br><span class="line">        <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.clickTimer);</span><br><span class="line">        <span class="keyword">this</span>.clickTimer = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ‰§è¡Œä»£ç </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">jumpTo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.clickTimer) &#123;</span><br><span class="line">        <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.clickTimer);</span><br><span class="line">        <span class="keyword">this</span>.clickTimer = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.clickTimer = <span class="built_in">window</span>.setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œä»£ç </span></span><br><span class="line">    &#125;, <span class="number">200</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="åŒæ—¶è°ƒå–å¤šä¸ªæ¥å£"><a href="#åŒæ—¶è°ƒå–å¤šä¸ªæ¥å£" class="headerlink" title="åŒæ—¶è°ƒå–å¤šä¸ªæ¥å£"></a>åŒæ—¶è°ƒå–å¤šä¸ªæ¥å£</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Promise è¯·æ±‚å¤šä¸ªæ¥å£</span></span><br><span class="line"><span class="keyword">const</span> createSource = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([queryWxapps(scenicid()[<span class="string">'id'</span>]), queryWxapps(scenicid()[<span class="string">'id'</span>]), queryWxapps(scenicid()[<span class="string">'id'</span>])])</span><br><span class="line"><span class="built_in">console</span>.log(createSource);<span class="comment">//[&#123;&#125;,&#123;&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//axiosè¯·æ±‚å¤šä¸ªæ¥å£</span></span><br><span class="line">axios.all([queryWxapps(scenicid()[<span class="string">'id'</span>]), queryWxapps(scenicid()[<span class="string">'id'</span>]), queryWxapps(scenicid()[<span class="string">'id'</span>]).then(axios.spread(<span class="function">(<span class="params">user, aside</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(user);</span><br><span class="line">  <span class="built_in">console</span>.log(aside);</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h3 id="ç§»åŠ¨ç«¯å…¼å®¹æ€§é—®é¢˜"><a href="#ç§»åŠ¨ç«¯å…¼å®¹æ€§é—®é¢˜" class="headerlink" title="ç§»åŠ¨ç«¯å…¼å®¹æ€§é—®é¢˜"></a>ç§»åŠ¨ç«¯å…¼å®¹æ€§é—®é¢˜</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è§£å†³iosé”®ç›˜å¼¹èµ·å–æ¶ˆåç•™ç©ºç™½çš„ç°è±¡</span></span><br><span class="line">;<span class="function">(<span class="params"><span class="regexp">/iphone|ipod|ipad/i</span>.test(navigator.appVersion</span>)) &amp;&amp; <span class="params">document</span>.<span class="params">addEventListener</span>(<span class="params"><span class="string">'blur'</span>, (e</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// è¿™é‡ŒåŠ äº†ä¸ªç±»å‹åˆ¤æ–­ï¼Œå› ä¸ºaç­‰å…ƒç´ ä¹Ÿä¼šè§¦å‘bluräº‹ä»¶</span></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  [<span class="string">'input'</span>, <span class="string">'textarea'</span>].includes(e.target.localName)</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="comment">// document.body.scrollIntoViewIfNeeded();</span></span><br><span class="line">  <span class="comment">// document.activeElement.scrollIntoViewIfNeeded();</span></span><br><span class="line">  <span class="built_in">document</span>.body.scrollIntoView(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><h3 id="è·å–æ»šåŠ¨æ¡çš„é«˜åº¦"><a href="#è·å–æ»šåŠ¨æ¡çš„é«˜åº¦" class="headerlink" title="è·å–æ»šåŠ¨æ¡çš„é«˜åº¦"></a>è·å–æ»šåŠ¨æ¡çš„é«˜åº¦</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ScollPostion</span>(<span class="params"></span>) </span>&#123;<span class="comment">//æ»šåŠ¨æ¡ä½ç½®</span></span><br><span class="line"><span class="keyword">let</span> t, l, w, h;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.documentElement &amp;&amp; <span class="built_in">document</span>.documentElement.scrollTop) &#123;</span><br><span class="line">        t = <span class="built_in">document</span>.documentElement.scrollTop;</span><br><span class="line">        l = <span class="built_in">document</span>.documentElement.scrollLeft;</span><br><span class="line">        w = <span class="built_in">document</span>.documentElement.scrollWidth;</span><br><span class="line">        h = <span class="built_in">document</span>.documentElement.scrollHeight;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.body) &#123;</span><br><span class="line">        t = <span class="built_in">document</span>.body.scrollTop;</span><br><span class="line">        l = <span class="built_in">document</span>.body.scrollLeft;</span><br><span class="line">        w = <span class="built_in">document</span>.body.scrollWidth;</span><br><span class="line">        h = <span class="built_in">document</span>.body.scrollHeight;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="keyword">return</span> &#123; <span class="attr">top</span>: t, <span class="attr">left</span>: l, <span class="attr">width</span>: w, <span class="attr">height</span>: h &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.pageYOffset == <span class="built_in">window</span>.scrollY; <span class="comment">// æ€»æ˜¯è¿”å› true</span></span><br><span class="line"><span class="keyword">var</span> supportPageOffset = <span class="built_in">window</span>.pageXOffset !== <span class="literal">undefined</span>;</span><br><span class="line"><span class="comment">// document.compatMode;ã€€ã€€//å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦å£°æ˜äº†DTD; å€¼ä¸º"BackCompat"ï¼šæœªå£°æ˜DTD;    å€¼ä¸º"CSS1Compat"ï¼šå·²å£°æ˜DTD;</span></span><br><span class="line"><span class="keyword">var</span> isCSS1Compat = ((<span class="built_in">document</span>.compatMode || <span class="string">""</span>) === <span class="string">"CSS1Compat"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = supportPageOffset ? <span class="built_in">window</span>.pageXOffset : isCSS1Compat ? <span class="built_in">document</span>.documentElement.scrollLeft : <span class="built_in">document</span>.body.scrollLeft;</span><br><span class="line"><span class="keyword">var</span> y = supportPageOffset ? <span class="built_in">window</span>.pageYOffset : isCSS1Compat ? <span class="built_in">document</span>.documentElement.scrollTop : <span class="built_in">document</span>.body.scrollTop;</span><br></pre></td></tr></table></figure><h3 id="URLçš„ç¼–ç è§£ç "><a href="#URLçš„ç¼–ç è§£ç " class="headerlink" title="URLçš„ç¼–ç è§£ç "></a>URLçš„ç¼–ç è§£ç </h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¼–ç </span></span><br><span class="line"><span class="comment">//;/?:@&amp;=+$,# è¿™äº›ç”¨äºåˆ†éš” URI ç»„ä»¶çš„æ ‡ç‚¹ç¬¦å·,ä¼šè¢«åå…­è¿›åˆ¶çš„è½¬ä¹‰åºåˆ—æ›¿æ¢</span></span><br><span class="line"><span class="built_in">encodeURIComponent</span>(URIstring)</span><br><span class="line"><span class="built_in">encodeURIComponent</span>(<span class="string">",/?:@&amp;=+$#"</span>)<span class="comment">//%2C%2F%3F%3A%40%26%3D%2B%24%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£ç </span></span><br><span class="line"><span class="built_in">decodeURIComponent</span>(URIstring)</span><br><span class="line"><span class="built_in">decodeURIComponent</span>(<span class="string">"%2C%2F%3F%3A%40%26%3D%2B%24%23"</span>)<span class="comment">//,/?:@&amp;=+$#</span></span><br></pre></td></tr></table></figure><h3 id="è·å–å›¾ç‰‡çš„åŸå§‹å°ºå¯¸"><a href="#è·å–å›¾ç‰‡çš„åŸå§‹å°ºå¯¸" class="headerlink" title="è·å–å›¾ç‰‡çš„åŸå§‹å°ºå¯¸"></a>è·å–å›¾ç‰‡çš„åŸå§‹å°ºå¯¸</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getImgNaturalDimensions</span>(<span class="params">oImg, callback</span>) </span>&#123;</span><br><span class="line">ã€€ã€€<span class="keyword">var</span> nWidth, nHeight;</span><br><span class="line">ã€€ã€€<span class="keyword">if</span> (!oImg.naturalWidth) &#123; <span class="comment">// ç°ä»£æµè§ˆå™¨</span></span><br><span class="line"></span><br><span class="line">ã€€ã€€ã€€ã€€nWidth = oImg.naturalWidth;</span><br><span class="line">ã€€ã€€ã€€ã€€nHeight = oImg.naturalHeight;</span><br><span class="line">ã€€ã€€ã€€ã€€callback(&#123;<span class="attr">w</span>: nWidth, <span class="attr">h</span>:nHeight&#125;);</span><br><span class="line"></span><br><span class="line">ã€€ã€€&#125; <span class="keyword">else</span> &#123; <span class="comment">// IE6/7/8</span></span><br><span class="line">ã€€ã€€ã€€ã€€<span class="keyword">var</span> nImg = <span class="keyword">new</span> Image();</span><br><span class="line"></span><br><span class="line">        nImg.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">             <span class="keyword">var</span> nWidth = nImg.width,</span><br><span class="line">                 nHeight = nImg.height;</span><br><span class="line">           callback(&#123;<span class="attr">w</span>: nWidth, <span class="attr">h</span>:nHeight&#125;);</span><br><span class="line">ã€€ã€€ã€€ã€€&#125;</span><br><span class="line">ã€€ã€€ã€€ã€€nImg.src = oImg.src;</span><br><span class="line">ã€€ã€€&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.getElementById(<span class="string">"oImg"</span>);</span><br><span class="line">getImgNaturalDimensions(img, <span class="function"><span class="keyword">function</span>(<span class="params">dimensions</span>)</span>&#123;</span><br><span class="line">ã€€ã€€<span class="built_in">console</span>.log(dimensions.w);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
          <category> Methods </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>base64ä¸Šä¼ ä¸ƒäº‘è·å–key</title>
      <link href="/2019/03/19/workspace/Project/qiyunniu/"/>
      <url>/2019/03/19/workspace/Project/qiyunniu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>base64ä¸Šä¼ ä¸ƒäº‘è·å–key</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸Šä¼ åˆ°ä¸ƒäº‘ç‰› base64 è½¬åŒ–ä¸º key(åŸç”Ÿçš„ajax)</span></span><br><span class="line"> putb64 = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/*picUrlç”¨æ¥å­˜å‚¨è¿”å›æ¥çš„url*/</span></span><br><span class="line">        <span class="keyword">let</span> picBase = base64å›¾ç‰‡;</span><br><span class="line">        <span class="comment">/*æŠŠå¤´éƒ¨çš„data:image/png;base64,å»æ‰ã€‚ï¼ˆæ³¨æ„ï¼šbase64åé¢çš„é€—å·ä¹Ÿå»æ‰ï¼‰*/</span></span><br><span class="line">        picBase = picBase.substring(<span class="number">23</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*é€šè¿‡base64ç¼–ç å­—ç¬¦æµè®¡ç®—æ–‡ä»¶æµå¤§å°å‡½æ•°*/</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">fileSize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> fileSize,</span><br><span class="line">                indexOf = str.indexOf(<span class="string">'='</span>);</span><br><span class="line">            <span class="keyword">if</span> (indexOf &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                str = str.substring(<span class="number">0</span>, indexOf);<span class="comment">//æŠŠæœ«å°¾çš„â€™=â€˜å·å»æ‰</span></span><br><span class="line">            &#125;</span><br><span class="line">            fileSize = <span class="built_in">parseInt</span>(str.length - (str.length / <span class="number">8</span>) * <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">return</span> fileSize;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//https://upload-z2.qiniu.com/putb64/ åªé€‚ç”¨äºä¸ƒç‰›äº‘åå—ç©ºé—´</span></span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`https://upload-z2.qiniup.com/putb64/<span class="subst">$&#123;fileSize(picBase)&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> keyText = xhr.responseText;</span><br><span class="line">                <span class="built_in">console</span>.log(keyText);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.open(<span class="string">"POST"</span>, url, <span class="literal">true</span>);</span><br><span class="line">        xhr.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">        xhr.setRequestHeader(<span class="string">"Authorization"</span>, <span class="string">`UpToken <span class="subst">$&#123;<span class="keyword">this</span>.state.uptoken&#125;</span>`</span>);</span><br><span class="line">        xhr.send(picBase);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>shell &amp; ssh</title>
      <link href="/2019/03/19/workspace/Project/linux/"/>
      <url>/2019/03/19/workspace/Project/linux/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>shell &amp; ssh</strong></p><p>[[toc]]</p><h3 id="æ—¥å¸¸ç”¨åˆ°çš„Shellå‘½ä»¤"><a href="#æ—¥å¸¸ç”¨åˆ°çš„Shellå‘½ä»¤" class="headerlink" title="æ—¥å¸¸ç”¨åˆ°çš„Shellå‘½ä»¤"></a>æ—¥å¸¸ç”¨åˆ°çš„Shellå‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤å</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td>clear</td><td>æ¸…é™¤å±å¹•æˆ–çª—å£å†…å®¹</td></tr><tr><td>env</td><td>æ˜¾ç¤ºå½“å‰æ‰€æœ‰è®¾ç½®è¿‡çš„ç¯å¢ƒå˜é‡</td></tr><tr><td>date</td><td>æ˜¾ç¤ºç³»ç»Ÿçš„å½“å‰æ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td>cal</td><td>æ˜¾ç¤ºæ—¥å†</td></tr><tr><td>vi ä¿®æ”¹æ–‡ä»¶</td><td>ddåˆ é™¤ä¸€è¡Œ Aç¼–è¾‘é€‰ä¸­çš„æœ€åä¸€è¡Œä»£ç  ï¼Œ</td></tr><tr><td>:set nu</td><td>åŠ ç´¢å¼•</td></tr><tr><td>touch</td><td>åˆ›å»ºæ–‡ä»¶</td></tr><tr><td>mkdir</td><td>åˆ›å»ºæ–‡ä»¶å¤¹</td></tr><tr><td>du -ha [æ–‡ä»¶åç§°]</td><td>æŸ¥çœ‹ç›®å½•/æ–‡ä»¶å ç”¨ç©ºé—´å¤§å°</td></tr><tr><td>ls -lh</td><td>çœ‹æ–‡ä»¶å¤§å°</td></tr><tr><td>ll</td><td>ç­‰ä»· ls -al</td></tr><tr><td>netstat -nltp</td><td>grep 443</td></tr><tr><td>mv</td><td>ä¿®æ”¹æ–‡ä»¶å ç§»åŠ¨æ–‡ä»¶ mv  index.html  .bash_profile</td></tr><tr><td>cat</td><td>æŸ¥çœ‹å†…å®¹</td></tr><tr><td>sudo vim /etc/hosts</td><td>wsç ´è§£</td></tr><tr><td>ssh -p 2289 <a href="mailto:root@182.92.117.162">root@182.92.117.162</a></td><td>ç™»å½•ssh</td></tr><tr><td>chattr +i .user.ini</td><td>é‡æ–°æ¢å¤æ–‡ä»¶ä¸å¯æ›´åŠ¨å±æ€§</td></tr><tr><td>chmod -R 777 pet_07</td><td>èµ‹æƒé™</td></tr><tr><td>rï¼šå¯è¯»<br/>wï¼šå¯å†™<br/>xï¼šå¯æ‰§è¡Œ<br/><br/>-rwâ€”â€”- (600) â€“ åªæœ‰å±ä¸»æœ‰è¯»å†™æƒé™ã€‚<br/>-rw-râ€“râ€“ (644) â€“ åªæœ‰å±ä¸»æœ‰è¯»å†™æƒé™ï¼›è€Œå±ç»„ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·åªæœ‰è¯»æƒé™ã€‚<br/>-rwxâ€”â€” (700) â€“ åªæœ‰å±ä¸»æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚<br/><strong>-rwxr-xr-x (755) â€“ å±ä¸»æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ï¼›åˆ«çš„ç”¨æˆ·ç»„åªæœ‰è¯»ã€æ‰§è¡Œæƒé™ã€‚</strong><br/>-rwxâ€“xâ€“x (711) â€“ å±ä¸»æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ï¼›è€Œå±ç»„ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·åªæœ‰æ‰§è¡Œæƒé™ã€‚<br/>-rw-rw-rw- (666) â€“ æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰æ–‡ä»¶è¯»ã€å†™æƒé™ã€‚è¿™ç§åšæ³•ä¸å¯å–ã€‚<br/>-rwxrwxrwx (777) â€“ æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚æ›´ä¸å¯å–çš„åšæ³•ã€‚<br/></td><td>å‚æ•°è§£é‡Š</td></tr><tr><td>sudo chown -R $(whoami) orã€ä½ çš„ç”¨æˆ·åã€‘  /Users/hzf/Desktop/projectSvelte</td><td>æ›´æ”¹æŸä¸ªç›®å½•æˆ–æ–‡ä»¶çš„ç”¨æˆ·åå’Œç”¨æˆ·ç»„</td></tr><tr><td>yarn version â€“new-version 1.0.0</td><td>æ›´æ”¹ç‰ˆæœ¬å·</td></tr><tr><td>curl <a href="http://www.jing999.cn:8000/banner" target="_blank" rel="noopener">http://www.jing999.cn:8000/banner</a></td><td>httpå‘½ä»¤è¡Œå·¥å…·</td></tr><tr><td>ping <a href="http://www.jing999.cn" target="_blank" rel="noopener">www.jing999.cn</a></td><td>ping</td></tr><tr><td>kill -9 PID</td><td>æ€æ­»è¿™ä¸ªè¿›ç¨‹</td></tr><tr><td>npx browser-sync start -s . -f .</td><td>é™æ€é¡µé¢åŠ¨æ€åˆ·æ–°</td></tr><tr><td>browser-sync start â€“server â€“files .</td><td>é™æ€é¡µé¢åŠ¨æ€åˆ·æ–°</td></tr><tr><td>rm -rf node_modules/.cache/babel-loader</td><td>umiçš„bug</td></tr><tr><td>nginx -s reload</td><td>é‡å¯nginx</td></tr><tr><td>tar -czvf dist.tar.gz dist</td><td>dist å‹ç¼©</td></tr><tr><td>tar -xzvf dist.tar.gz</td><td>è§£å‹</td></tr><tr><td>-c: å»ºç«‹å‹ç¼©æ¡£æ¡ˆ<br/>-xï¼šè§£å‹<br/>-zï¼šæœ‰gzipå±æ€§çš„<br/>-vï¼šæ˜¾ç¤ºæ‰€æœ‰è¿‡ç¨‹<br/>-rï¼šå‘å‹ç¼©å½’æ¡£æ–‡ä»¶æœ«å°¾è¿½åŠ æ–‡ä»¶<br/>-f: ä½¿ç”¨æ¡£æ¡ˆåå­—ï¼Œåˆ‡è®°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œåé¢åªèƒ½æ¥æ¡£æ¡ˆåã€‚<br/></td><td>å‚æ•°è§£é‡Š</td></tr><tr><td>find / -name jenkins</td><td>æŸ¥çœ‹å®‰è£…ç›®å½•</td></tr><tr><td>find . â€œ(â€œ -name â€œ<em>.mâ€ -or -name â€œ</em>.mmâ€ <br/> -or -name â€œ<em>.jsxâ€ -or -name â€œ</em>.tsxâ€ <br/> -or -name â€œ<em>.cssâ€ -or -name â€œ</em>.lessâ€ <br/> -or -name â€œ<em>.scssâ€ -or -name â€œ</em>.jsâ€ <br/> -or -name â€œ<em>.tsâ€ -or -name â€œ</em>.rssâ€ â€œ)â€ -print | xargs wc -l</td><td>çœ‹ä¸€å…±å†™äº†å¤šå°‘è¡Œçš„ä»£ç </td></tr><tr><td>sed -i â€˜â€™ â€œs/666/777/gâ€ config</td><td>ä¿®æ”¹æ–‡å­— 666æ¢æˆ777</td></tr></tbody></table><h3 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h3><ul><li>ä¸´æ—¶æœ‰æ•ˆ<ul><li>export PATH=$(pwd)/bin:$PATH</li></ul></li><li>è½¯è¿æ¥  /usr/local/bin/å°±æ˜¯ç¯å¢ƒå˜é‡ç›®å½•<ul><li>ln -s /usr/local/nginx/sbin/nginx /usr/local/bin/</li></ul></li><li>ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.bashrc æˆ–.profileæ–‡ä»¶ï¼ˆæ¨èï¼‰<ul><li>export PATH=/Users/hzf/mongodb/bin:$PATH<ul><li>æ‰§è¡Œsource ~/.bashrc, ç«‹å³ç”Ÿæ•ˆ</li></ul></li></ul></li></ul><h3 id="VIM"><a href="#VIM" class="headerlink" title="VIM"></a>VIM</h3><p><strong>æ‰¹é‡æ³¨é‡Š</strong></p><p>ä»éœ€è¦è¢«æ³¨é‡Šçš„ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œå°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–ï¼Œ</p><p>æŒ‰ä¸‹  <code>Ctrl + v</code></p><p>æ¥ç€æŒ‰ä¸‹<code>æ–¹å‘é”®</code>ä¸‹ï¼Œä¸€ç›´ç§»åŠ¨åˆ°éœ€è¦è¢«æ³¨é‡Šçš„æœ€åä¸€è¡Œï¼Œ</p><p>è¿™æ—¶å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›éœ€è¦è¢«æ³¨é‡Šçš„è¡Œçš„è¡Œé¦–ç¬¬ä¸€ä¸ªå­—ç¬¦å·²ç»å…¨éƒ¨è¢«é€‰ä¸­</p><p>ç„¶åæŒ‰ä¸‹  <code>Shift + i</code>ï¼Œæ‰¹é‡æ’å…¥ï¼Œ</p><p>è¿™æ—¶å…‰æ ‡ä¼šè·³åˆ°ç¬¬ä¸€è¡Œçš„è¡Œé¦–ï¼Œä¸ç”¨ç®¡ï¼Œç»§ç»­æŒ‰ä¸‹<code>Shift + 3</code>ï¼Œä¹Ÿå°±æ˜¯  <code>#</code>é”®</p><p>æœ€åæŒ‰ä¸‹  <code>Esc</code> é”®ï¼Œå°±å¯ä»¥çœ‹åˆ°åˆšæ‰è¢«é€‰ä¸­çš„è¡Œçš„è¡Œé¦–éƒ½ä¼šåŠ å¤šä¸€ä¸ª<code>#</code>å·</p><p>æ‰¹é‡æ³¨é‡Šå®Œæ¯•</p><p><strong>å»æ³¨é‡Š</strong></p><p>å¯¹äºä¸€å¤§æ®µè¢«æ³¨é‡Šçš„ä»£ç ï¼Œéœ€è¦å»æ‰æ³¨é‡Šçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§æ“ä½œå®Œ</p><p>ä¸ç”¨ä¸€ä¸ªä¸€ä¸ªå»åˆ ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>å…‰æ ‡ç§»åˆ°éœ€è¦å»é™¤æ³¨é‡Šçš„ç¬¬ä¸€è¡Œçš„è¡Œé¦–ï¼Œè·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œ</p><p>æŒ‰ä¸‹ Â·<code>Ctrl + v</code></p><p>æ¥ç€æŒ‰ä¸‹<code>æ–¹å‘é”®</code>ä¸‹ï¼Œä¸€ç›´ç§»åŠ¨åˆ°éœ€è¦è¢«æ³¨é‡Šçš„æœ€åä¸€è¡Œï¼Œ</p><p>è¿™æ—¶å€™å¯ä»¥çœ‹åˆ°ï¼Œè¡Œé¦–çš„ç¬¬ä¸€ä¸ªå­—ç¬¦<code>#</code>å·²ç»è¢«é€‰ä¸­äº†ï¼Œ</p><p>ç„¶åæŒ‰ä¸‹<code>d</code>é”®å°±å¯ä»¥å…¨éƒ¨åˆ æ‰è¡Œé¦–çš„<code>#</code>å­—ç¬¦äº†ã€‚</p><h3 id="Shellç¼–ç¨‹"><a href="#Shellç¼–ç¨‹" class="headerlink" title="Shellç¼–ç¨‹"></a>Shellç¼–ç¨‹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># run: sh depoly.sh 123 123</span></span><br><span class="line"><span class="comment"># å˜é‡å®šä¹‰</span></span><br><span class="line">str=<span class="string">'test'</span> <span class="comment"># æ³¨æ„èµ‹å€¼ä¸éœ€è¦ç©ºæ ¼</span></span><br><span class="line">str2=<span class="string">"this is <span class="variable">$str</span>"</span> <span class="comment"># åŒå¼•å·å¯ä»¥ç›´æ¥å†™å…¥å˜é‡</span></span><br><span class="line">str3=<span class="string">"this is <span class="variable">$&#123;str&#125;</span>"</span></span><br><span class="line">arr=(<span class="string">'1'</span> <span class="string">'2'</span>) <span class="comment"># æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echoæ‰“å°</span></span><br><span class="line"><span class="built_in">echo</span> this is <span class="built_in">test</span> <span class="comment"># this is test # è¢«é»˜è®¤ä¸ºå­—ç¬¦ä¸²ï¼Œä¸ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str</span> <span class="comment"># test # å˜é‡å¼•ç”¨éœ€è¦å®¶$ç¬¦å·</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str2</span> <span class="comment"># this is test</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str3</span> <span class="comment"># this is test</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr[1]&#125;</span> <span class="comment"># 2 # æ•°ç»„åˆ‡å‰²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ifåˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$str</span> == <span class="string">"test"</span> ] <span class="comment"># ifæ¡ä»¶éœ€è¦åœ¨æ–¹æ‹¬å·ä¸­ï¼Œå¹¶ä¸”æ³¨æ„éœ€è¦ç©ºæ ¼</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'successed'</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">a=<span class="string">'10'</span></span><br><span class="line">b=<span class="string">'20'</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> != <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"a ä¸ç­‰äº b"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å‚æ•°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span> <span class="comment"># 123 #ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$#</span> <span class="comment"># 2 # å‚æ•°ä¸ªæ•°</span></span><br><span class="line"><span class="built_in">echo</span> $* <span class="comment"># 123 123 æ‰€æœ‰å‚æ•°</span></span><br></pre></td></tr></table></figure><h3 id="é’ˆå¯¹jenkinsæ€»ç»“çš„"><a href="#é’ˆå¯¹jenkinsæ€»ç»“çš„" class="headerlink" title="é’ˆå¯¹jenkinsæ€»ç»“çš„"></a>é’ˆå¯¹jenkinsæ€»ç»“çš„</h3><p><code>å¯åŠ¨jenkins</code><br/><br>java -jar jenkins.war â€“httpPort=8081</p><p><code>å¦‚æœæƒ³è¦åœ¨linuxåå°ä¸€ç›´è¿è¡Œï¼Œåˆ™è¦å¼€å§‹åŠ nohupï¼Œåœ¨æœ«å°¾åŠ &amp;å·</code><br/><br>nohup java -jar jenkins.war â€“httpPort=8081 &amp;</p><p>å¯åŠ¨å ä¼šç”Ÿæˆä¸€ä¸ªnohup.outè¾“å‡ºï¼Œéœ€è¦çš„è¯ï¼Œå¯ä»¥tail -f nohup.outå®æ—¶æŸ¥çœ‹æ—¥å¿—</p><p><code>åˆ—å‡ºjenkinsçš„æ‰€æœ‰è¿›ç¨‹</code><br/><br>ps -aux|grep jenkins</p><p><code>æ€æ­»è¿™ä¸ªè¿›ç¨‹</code><br/><br>kill -9 [PID]</p><p><code>å¯åŠ¨jenkinsçš„å¦å¤–æ–¹å¼</code><br/><br>service jenkins start/stop/restart/status</p><p>systemctl start jenkins.service</p><p><code>æŸ¥çœ‹è¿è¡Œçš„åå°è¿›ç¨‹</code><br/><br>jobs -l<br/><br>jobså‘½ä»¤åªçœ‹å½“å‰ç»ˆç«¯ç”Ÿæ•ˆçš„ï¼Œå…³é—­ç»ˆç«¯åï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯jobså·²ç»æ— æ³•çœ‹åˆ°åå°è·‘å¾—ç¨‹åºäº†ï¼Œæ­¤æ—¶åˆ©ç”¨psï¼ˆè¿›ç¨‹æŸ¥çœ‹å‘½ä»¤ï¼‰<br/><br>ps -ef<br/><br>ps -aux|grep jenkins</p><p><strong>æŸ¥çœ‹ä½¿ç”¨æŸç«¯å£çš„è¿›ç¨‹</strong><br/><br><code>lsof -i:3000</code> <br/><br>kill -9  [pid]</p><h3 id="ssh-ä¸èƒ½ç™»å½•æœåŠ¡å™¨"><a href="#ssh-ä¸èƒ½ç™»å½•æœåŠ¡å™¨" class="headerlink" title="ssh ä¸èƒ½ç™»å½•æœåŠ¡å™¨"></a>ssh ä¸èƒ½ç™»å½•æœåŠ¡å™¨</h3><p>æç¤ºè­¦å‘Šä¿¡æ¯å¦‚ä¸‹ï¼š</p><p>arnold@WSN:~$ ssh 120.79.229.197</p><p>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>@ WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED! @<br>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!<br>Someone could be eavesdropping on you right now (man-in-the-middle attack)!<br>It is also possible that the RSA host key has just been changed.<br>The fingerprint for the RSA key sent by the remote host is<br>08:98:a9:cc:f8:37:20:6b:b4:b1:6c:3a:15:b9:a9:92.<br>Please contact your system administrator.<br>Add correct host key in /home/arnold/.ssh/known_hosts to get rid of this message.<br>Offending key in /home/arnold/.ssh/known_hosts:2<br>RSA host key for 10.18.46.111 has changed and you have requested strict checking.<br>Host key verification failed.</p><p>åŸå› åˆ†æï¼š</p><p>It is also possible that a host key has just been changed.</p><p>æˆ‘ä¹‹å‰å¯¹sshæœåŠ¡å™¨é‡è£…äº†ç³»ç»Ÿï¼Œå¯¼è‡´æ‰€æœ‰ä¸åŸç³»ç»Ÿå»ºç«‹è¿‡sshè¿æ¥çš„ç³»ç»Ÿéƒ½æ— æ³•å†å»ºç«‹è¿æ¥ï¼Œå› ä¸ºåœ¨äºåŸç³»ç»Ÿå»ºç«‹é¦–æ¬¡è¿æ¥æ—¶ï¼ŒåŒæ–¹ç›¸äº’è®°å½•äº†å¯¹æ–¹çš„å…¬é’¥ï¼ˆsshåŸºäºéå¯¹ç§°å¯†é’¥æŠ€æœ¯ï¼‰ï¼Œåœ¨sshæœåŠ¡ä¸»æœºé‡è£…ç³»ç»Ÿåï¼Œå…¬é’¥æ”¹å˜äº†ï¼Œä»»ä»¥æ—§ç‰ˆæœ¬å…¬é’¥çš„ä¸»æœºè‡ªç„¶æ˜¯æ— æ³•ä¸æ–°ç³»ç»Ÿè¿æ¥çš„ã€‚</p><p>ç½‘ä¸Šè¿˜æœ‰åˆ†æä¸ºsshä¸»æœºè¢«äººé»‘äº†ï¼Œå¹¶åœ¨æ¶ˆé™¤å…¥ä¾µè®°å½•æ—¶å¯¹known_hostsæ–‡ä»¶åšäº†æ”¹åŠ¨ã€‚å½“ç„¶ä¹Ÿä¸æ’é™¤è¿™ç§å¯èƒ½ï¼Œä½†æˆ‘ä¼°è®¡æˆ‘æ˜¯æ²¡é‚£ä¸ªç¦æ°”äº†ï¼šï¼‰</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>åˆ é™¤ <code>~/.ssh/known_hosts</code>æ–‡ä»¶ï¼Œæˆ–è€…<code>å¦‚æœä½ å¯ä»¥åˆ¤æ–­å‡ºknown_hostsä¸­åŸsshæœåŠ¡å™¨çš„å…¬é’¥ï¼Œåˆ å»é‚£éƒ¨åˆ†</code>ï¼Œ</p><p>ç„¶ååå†æ¬¡å»ºç«‹æ–°çš„è¿æ¥ï¼Œå³å¯è·å¾—æ–°çš„å…¬é’¥ã€‚</p><h3 id="å…³äºsshpassä½¿ç”¨ä¸¾ä¾‹"><a href="#å…³äºsshpassä½¿ç”¨ä¸¾ä¾‹" class="headerlink" title="å…³äºsshpassä½¿ç”¨ä¸¾ä¾‹"></a>å…³äºsshpassä½¿ç”¨ä¸¾ä¾‹</h3><p><code>ä½¿ç”¨-på‚æ•°æŒ‡å®šç™»å½•å¯†ç </code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å…å¯†ç ç™»å½•</span><br><span class="line">$ sshpass -p password ssh username@host</span><br><span class="line"></span><br><span class="line"># è¿œç¨‹æ‰§è¡Œå‘½ä»¤</span><br><span class="line">$ sshpass -p password ssh username@host &lt;cmd&gt;</span><br><span class="line"></span><br><span class="line"># é€šè¿‡scpä¸Šä¼ æ–‡ä»¶</span><br><span class="line">$ sshpass -p password scp local_file root@host:remote_file </span><br><span class="line"></span><br><span class="line"># é€šè¿‡scpä¸‹è½½æ–‡ä»¶</span><br><span class="line">$ sshpass -p password scp root@host:remote_file local_file</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#æŠŠæœ¬åœ°çš„source.txtæ–‡ä»¶æ‹·è´åˆ°192.168.0.10æœºå™¨ä¸Šçš„&#x2F;home&#x2F;workç›®å½•ä¸‹</span><br><span class="line">scp &#x2F;home&#x2F;work&#x2F;source.txt root@192.168.0.10:&#x2F;home&#x2F;work&#x2F; </span><br><span class="line"></span><br><span class="line">#æŠŠ120.79.229.197æœºå™¨ä¸Šçš„hzf.gifæ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°çš„&#x2F;Users&#x2F;zhenfeng&#x2F;tempData&#x2F;ç›®å½•ä¸‹</span><br><span class="line">scp root@120.79.229.197:&#x2F;tmp&#x2F;hzf.gif &#x2F;Users&#x2F;zhenfeng&#x2F;tempData&#x2F;  </span><br><span class="line"></span><br><span class="line">#æŠŠ192.168.0.10æœºå™¨ä¸Šçš„source.txtæ–‡ä»¶æ‹·è´åˆ°192.168.0.11æœºå™¨çš„&#x2F;home&#x2F;workç›®å½•ä¸‹</span><br><span class="line">scp root@192.168.0.10:&#x2F;home&#x2F;work&#x2F;source.txt root@192.168.0.11:&#x2F;home&#x2F;work&#x2F; </span><br><span class="line"></span><br><span class="line">#æ‹·è´æ–‡ä»¶å¤¹ï¼ŒåŠ -rå‚æ•°</span><br><span class="line">scp -r &#x2F;home&#x2F;work&#x2F;sourcedir root@192.168.0.10:&#x2F;home&#x2F;work&#x2F;</span><br></pre></td></tr></table></figure><h3 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env bash</span><br><span class="line">tar -czvf &#39;$1&#39; | sshpass -p password ssh root@host &#39;cd &#x2F;home -rf;tar -xzvf -&#39;</span><br></pre></td></tr></table></figure><p><code>è„šæœ¬ç”¨envå¯åŠ¨çš„åŸå› ï¼Œæ˜¯å› ä¸ºè„šæœ¬è§£é‡Šå™¨åœ¨linuxä¸­å¯èƒ½è¢«å®‰è£…äºä¸åŒçš„ç›®å½•ï¼Œenvå¯ä»¥åœ¨ç³»ç»Ÿçš„PATHç›®å½•ä¸­æŸ¥æ‰¾ã€‚åŒæ—¶ï¼Œenvè¿˜è§„å®šä¸€äº›ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚</code></p>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>toFixedæ–¹æ³•çš„bug</title>
      <link href="/2019/03/19/workspace/Project/toFixed/"/>
      <url>/2019/03/19/workspace/Project/toFixed/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>toFixedæ–¹æ³•çš„bug</strong></p><p>æœ€è¿‘åœ¨å·¥ä½œè¿‡ç¨‹ä¸­ç¢°åˆ°ä¸€ä¸ªéšè—çš„bugï¼Œç»è°ƒè¯•å‘ç°ç«Ÿç„¶æ˜¯toFixedå‡½æ•°ä¸å¯é çš„ç»“æœå¼•èµ·çš„ã€‚åœ¨å¤„ç†ä»·æ ¼æ¯”è¾ƒçš„æ—¶å€™ï¼Œç”¨foFixedè¿›è¡Œä»·æ ¼çš„å››èˆäº”å…¥ä¹‹åï¼Œç«Ÿç„¶å‘ç°æ¯”è¾ƒçš„ç»“æœæœ‰é—®é¢˜ï¼›<br>å¤§å®¶éƒ½çŸ¥é“ï¼ŒNumberç±»å‹çš„å˜é‡æœ‰ä¸ªtoFixedæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†Numberå››èˆäº”å…¥ä¸ºæŒ‡å®šå°æ•°ä½æ•°çš„æ•°å­—ï¼Œä»¥<code>å­—ç¬¦ä¸²</code>è¿”å›ã€‚</p><p><strong>IE</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">0.6</span> .toFixed(<span class="number">0</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="number">1.6</span> .toFixed(<span class="number">0</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">( <span class="number">0.035</span> ).toFixed( <span class="number">2</span> ); <span class="comment">// 0.04</span></span><br><span class="line">( <span class="number">0.045</span> ).toFixed( <span class="number">2</span> ); <span class="comment">// 0.05</span></span><br></pre></td></tr></table></figure><p><strong>Chrome</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">0.6</span> .toFixed(<span class="number">0</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="number">1.6</span> .toFixed(<span class="number">0</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">( <span class="number">0.035</span> ).toFixed( <span class="number">2</span> ); <span class="comment">// 0.04</span></span><br><span class="line">( <span class="number">0.045</span> ).toFixed( <span class="number">2</span> ); <span class="comment">// 0.04</span></span><br></pre></td></tr></table></figure><p>ç»“è®º ï¼š<strong>toFixed()å‡½æ•°é ä¸ä½ï¼Œå¦‚æœæœ‰éœ€è¦ç²¾ç¡®æ§åˆ¶çš„æƒ…å†µï¼Œç‰¹åˆ«æ˜¯<code>é‡‘é’±</code>çš„è®¡ç®—æ—¶ï¼Œè¿˜æ˜¯è‡ªå·±å†™ä¸ªæ–¹æ³•æ¯”è¾ƒå¥½ã€‚</strong> æ¯”å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿ç•™ä¸¤ä½å°æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>val éœ€è¦è¿›è¡Œæ“ä½œçš„æ•°å­—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> returnFloat = <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="built_in">Math</span>.round(<span class="built_in">parseFloat</span>(val) * <span class="number">100</span>) / <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">let</span> xsd = value.toString().split(<span class="string">"."</span>);</span><br><span class="line">    <span class="keyword">if</span> (xsd.length === <span class="number">1</span>) &#123;</span><br><span class="line">        value = value.toString() + <span class="string">".00"</span>;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (xsd.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (xsd[<span class="number">1</span>].length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            value = value.toString() + <span class="string">"0"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>yarn &amp; npm</title>
      <link href="/2019/03/19/workspace/Project/yarn/"/>
      <url>/2019/03/19/workspace/Project/yarn/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>yarn &amp; npm</strong></p><p>[[toc]]</p><h3 id="nodeå‡çº§"><a href="#nodeå‡çº§" class="headerlink" title="nodeå‡çº§"></a>nodeå‡çº§</h3><pre><code>1ã€windowç³»ç»Ÿå‡çº§nodeå°±åªæœ‰åˆ°nodeå®˜ç½‘ä¸‹è½½windowå®‰è£…åŒ…æ¥è¦†ç›–ä¹‹å‰çš„node2ã€macå‡çº§nodeç‰ˆæœ¬   npm i -g n    n 12.9.1 //æŒ‡å®šç‰ˆæœ¬å‡çº§   n latest //å®‰è£…æœ€æ–°ç‰ˆæœ¬   n stable //å®‰è£…æœ€ç¨³å®šçš„ç‰ˆæœ¬</code></pre><h3 id="å‡çº§åŒ…"><a href="#å‡çº§åŒ…" class="headerlink" title="å‡çº§åŒ…"></a>å‡çº§åŒ…</h3><p><code>1</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm install -g npm-check    <span class="comment">//å®‰è£…å…¨å±€çš„åŒ…</span></span><br><span class="line">npm update &lt;name&gt; -g        <span class="comment">//å…¨éƒ¨å®‰è£…ä¸å»ºè®®ç”¨</span></span><br><span class="line">npm update &lt;name&gt;           <span class="comment">//å•ä¸ªå®‰è£…</span></span><br></pre></td></tr></table></figure><p><code>2</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yarn global add npm-check-updates  <span class="comment">//å®‰è£…å…¨å±€çš„åŒ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ncu  æŸ¥çœ‹æ‰€æœ‰å¯ä»¥å®‰è£…çš„åŒ…</span></span><br><span class="line">sudo ncu -u &lt;name&gt;  <span class="comment">//è¿™ä¸ªåªæ˜¯æ”¹å˜packageé‡Œé¢çš„ç‰ˆæœ¬ ä¸ä¼šæ›´æ–°åŒ…</span></span><br><span class="line"><span class="comment">//æ‰€ä»¥è¦sudo ncu -u &lt;name&gt; &amp;&amp; sudo yarn</span></span><br></pre></td></tr></table></figure><p><code>3æ¨è</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yarn upgrade-interactive --latest <span class="comment">//éœ€è¦æ‰‹åŠ¨é€‰æ‹©å‡çº§çš„ä¾èµ–åŒ…ï¼ŒæŒ‰ç©ºæ ¼é”®é€‰æ‹©ï¼Œa é”®åˆ‡æ¢æ‰€æœ‰ï¼Œi é”®åé€‰é€‰æ‹©</span></span><br></pre></td></tr></table></figure><p><code>4</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yarn upgrade react --latest <span class="comment">//yarn upgrade æ›´æ–°ä¾èµ–åŒ…æ—¶yarn.lockæ›´æ–°ä½†package.jsonä¸åŒæ­¥æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯,ç½‘ä¸Šè¯´ä¼šåŒæ­¥æ›´æ–°ï¼Œæˆ‘è¯•äº†ä¸‹ï¼Œæœªæ›´æ–°ï¼Œå…·ä½“çœ‹ä½ ä»¬</span></span><br></pre></td></tr></table></figure><h3 id="yarn-åˆ‡æ¢æº"><a href="#yarn-åˆ‡æ¢æº" class="headerlink" title="yarn åˆ‡æ¢æº"></a>yarn åˆ‡æ¢æº</h3><pre><code>1ã€`æŸ¥çœ‹ä¸€ä¸‹å½“å‰æº`yarn config get registry2ã€`åˆ‡æ¢ä¸ºæ·˜å®æº`yarn config set registry https://registry.npm.taobao.org3ã€`æˆ–è€…åˆ‡æ¢ä¸ºè‡ªå¸¦çš„`yarn config set registry https://registry.yarnpkg.com</code></pre><h3 id="npm-åˆ‡æ¢æº"><a href="#npm-åˆ‡æ¢æº" class="headerlink" title="npm åˆ‡æ¢æº"></a>npm åˆ‡æ¢æº</h3><pre><code>1ã€`å…¨å±€é…ç½®åˆ‡æ¢åˆ°æ·˜å®æº` npm config set registry https://registry.npm.taobao.org  2ã€`æ£€æµ‹æ˜¯å¦åˆ‡æ¢åˆ°äº†æ·˜å®æº` npm info underscore</code></pre><h3 id="ä½ å¿…é¡»çŸ¥é“çš„yarn"><a href="#ä½ å¿…é¡»çŸ¥é“çš„yarn" class="headerlink" title="ä½ å¿…é¡»çŸ¥é“çš„yarn"></a>ä½ å¿…é¡»çŸ¥é“çš„yarn</h3><p><a href="https://code.fb.com/web/yarn-a-new-package-manager-for-javascript/" target="_blank" rel="noopener">yarnçš„èµ·æº</a>å·²ç»è§£é‡Šäº†ä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸€ä¸ªæ–°çš„javascriptåŒ…ç®¡ç†å™¨ï¼Œè¿™é‡Œç¬”è€…ä¹Ÿæ¨èå¤§å®¶ä»npmåˆ‡æ¢ä¸ºyarnã€‚npm4å°±ä¸è¯´äº†ï¼Œé€Ÿåº¦å¤ªæ…¢äº†ï¼Œnpm5å€Ÿé‰´äº†å¾ˆå¤šyarnçš„æœºåˆ¶ï¼Œæ¯”å¦‚ç®€å•çš„ç‰ˆæœ¬é”ã€é‡å†™cacheæ¨¡å—ç­‰ï¼Œå‡å°‘äº†ä¸yarnçš„å·®è·ã€‚ä½†ä¾ç„¶æœ‰äº›åœ°æ–¹åšçš„ä¸å¦‚yarn,<a href="https://jobs.stratsys.com/blog/posts/9244-npm5-vs-yarn-which-one-is-better" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>è®°å½•äº†npm5å’Œyarnçš„å®éªŒå¯¹æ¯”ï¼Œç»“è®ºæ˜¯ï¼šåœ¨æ²¡æœ‰ç¼“å­˜æ—¶ï¼Œyarnå’Œnpm5é€Ÿåº¦å·®ä¸å¤šï¼›åœ¨æœ‰ç¼“å­˜æ—¶ï¼Œyarnæ¯”npm5å¿«2å€ã€‚</p><h4 id="yarnä¼˜åŠ¿"><a href="#yarnä¼˜åŠ¿" class="headerlink" title="yarnä¼˜åŠ¿"></a>yarnä¼˜åŠ¿</h4><p>ä»¥ä¸‹é’ˆå¯¹npm5å‰:</p><ul><li><code>yarn ç¦»çº¿å®‰è£…ã€‚</code><br>ä¸‹è½½çš„æ—¶å€™ Yarn ç¼“å­˜äº†æ‰€æœ‰çš„åŒ…ä»¥è‡³äºä¸éœ€è¦å†æ¬¡ä»ç½‘ç»œä¸‹è½½</li><li><code>yarnå¹¶è¡Œä¸‹è½½ï¼Œä½¿å¾—æ—¶é—´æ›´å¿«ã€‚</code><br>é€šè¿‡å¹¶è¡Œæ“ä½œæœ€å¤§é™åº¦åœ°æé«˜èµ„æºåˆ©ç”¨ç‡ï¼Œä»¥è‡³äºå†æ¬¡ä¸‹è½½çš„æ—¶å€™å®‰è£…æ—¶é—´æ¯”ä¹‹å‰æ›´å¿«ã€‚npm5ä¹‹å‰æ˜¯ç­‰ä¸Šä¸€ä¸ªå®‰è£…å®Œåå†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œä¸²è¡Œä¸‹è½½ã€‚</li><li><code>yarné”åŒ…yarn-lockï¼Œä¿è¯å¼•ç”¨åŒ…æ­£ç¡®ã€‚</code><br>yarn.lock æ–‡ä»¶å‡†ç¡®çš„é”å®šäº†æ‰€æœ‰è¢«ä¸‹è½½å’Œé¡¹ç›®ä¾èµ–çš„åŒ…ç‰ˆæœ¬ã€‚é€šè¿‡è¿™ä¸ªæ–‡ä»¶ï¼Œä½ èƒ½ç¡®å®šä½ çš„å·¥ç¨‹å¸ˆå›¢é˜Ÿçš„æ¯ä¸€ä½æˆå‘˜éƒ½èƒ½å®‰è£…å‡†ç¡®çš„åŒ…ï¼Œå¹¶ä¸”å¯ä»¥æ›´å®¹æ˜“çš„éƒ¨ç½²ï¼Œè€Œæ²¡æœ‰æ„å¤– bugå‡ºç°ã€‚</li></ul><h4 id="yarnæŒ‡ä»¤"><a href="#yarnæŒ‡ä»¤" class="headerlink" title="yarnæŒ‡ä»¤"></a>yarnæŒ‡ä»¤</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">* <span class="string">`yarn bin`</span>, æ‰“å°å‡ºæ‰§è¡Œè„šæœ¬çš„ä½ç½®ï¼Œå¯ä»¥è¢«yarn runæ‰§è¡Œã€‚ç›¸å½“äºnpm bin</span><br><span class="line">* <span class="string">`yarn login/yarn publish`</span> npmç™»å½•å’Œå‘å¸ƒã€‚ç›¸å½“äºnpm login/npm publish</span><br><span class="line">* <span class="string">`yarn cache clean`</span>ï¼Œæ¸…é™¤ç¼“å­˜ï¼Œç›¸å½“äºnpm cache cleanã€‚</span><br><span class="line">* <span class="string">`yarn list`</span> åˆ—å‡ºå½“å‰æ‰€æœ‰ä¾èµ–çš„åŒ…</span><br><span class="line">* <span class="string">`yarn config list`</span> æ˜¾ç¤ºæ‰€æœ‰é…ç½®è®¾ç½®</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://auth0.com/blog/five-things-you-can-do-with-yarn/" target="_blank" rel="noopener">5 things you can do with Yarn</a></li><li><a href="https://yarnpkg.com/en/docs/cli/" target="_blank" rel="noopener">Yarn - CLI Introduction</a></li><li><a href="https://mp.weixin.qq.com/s/XdOPPay8fpNBiH2ExW_EyQ" target="_blank" rel="noopener">Node.js ä¸­çš„ä¾èµ–ç®¡ç†</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
          <category> Yarn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Reactå°è£…çš„ç»„ä»¶</title>
      <link href="/2019/03/17/workspace/Frame/react/reactComponent/"/>
      <url>/2019/03/17/workspace/Frame/react/reactComponent/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Reactå°è£…çš„ç»„ä»¶</strong></p><p>[[toc]]</p><h3 id="é«˜é˜¶å‡½æ•°-ï¼Œå°è£…context"><a href="#é«˜é˜¶å‡½æ•°-ï¼Œå°è£…context" class="headerlink" title="é«˜é˜¶å‡½æ•° ï¼Œå°è£…context"></a>é«˜é˜¶å‡½æ•° ï¼Œå°è£…context</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component,createContext &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Context = createContext();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ContextProvider = <span class="function">(<span class="params">&#123; context, children &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Context.Provider value=&#123;context&#125;&gt;</span><br><span class="line">            &#123;children&#125;</span><br><span class="line">        &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export const getChildrenContext = (contexts) =&gt; RealComponent =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return class extends Component &#123;</span></span><br><span class="line"><span class="regexp">        render() &#123;</span></span><br><span class="line"><span class="regexp">            return (</span></span><br><span class="line"><span class="regexp">                &lt;Context.Consumer&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;context =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                        /</span><span class="regexp">/ å°†é¡¶å±‚çš„contextåˆ†å‘åˆ°å„å±‚</span></span><br><span class="line"><span class="regexp">                        let mapContext = &#123;&#125;;</span></span><br><span class="line"><span class="regexp">                        if (Array.isArray(contexts)) &#123;</span></span><br><span class="line"><span class="regexp">                            contexts.map(item =&gt; mapContext[item] = context[item]);</span></span><br><span class="line"><span class="regexp">                        &#125; else &#123;</span></span><br><span class="line"><span class="regexp">                            mapContext = context;</span></span><br><span class="line"><span class="regexp">                        &#125;</span></span><br><span class="line"><span class="regexp">                        return (</span></span><br><span class="line"><span class="regexp">                            &lt;RealComponent &#123;...mapContext&#125; &#123;...this.props&#125; /</span>&gt;</span><br><span class="line">                        )</span><br><span class="line">                    &#125;&#125;</span><br><span class="line">                &lt;<span class="regexp">/Context.Consumer&gt;</span></span><br><span class="line"><span class="regexp">            );</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure><h3 id="å°è£…çš„è£å‰ªåŠŸèƒ½-å¸¦å‹ç¼©ä¸‹è½½"><a href="#å°è£…çš„è£å‰ªåŠŸèƒ½-å¸¦å‹ç¼©ä¸‹è½½" class="headerlink" title="å°è£…çš„è£å‰ªåŠŸèƒ½ å¸¦å‹ç¼©ä¸‹è½½"></a>å°è£…çš„è£å‰ªåŠŸèƒ½ å¸¦å‹ç¼©ä¸‹è½½</h3><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123;Component, Fragment&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> lrz <span class="keyword">from</span> <span class="string">'lrz'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Upload, message, Button, Icon, Modal&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Cropper <span class="keyword">from</span> <span class="string">'react-cropper'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'cropperjs/dist/cropper.css'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./index.less"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cropper</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        srcCropper: <span class="string">''</span>, <span class="comment">//cropperçš„å›¾ç‰‡è·¯å¾„</span></span><br><span class="line">        selectImgName: <span class="string">''</span>, <span class="comment">//æ–‡ä»¶åç§°</span></span><br><span class="line">        selectImgSize: <span class="string">''</span>, <span class="comment">//æ–‡ä»¶å¤§å°</span></span><br><span class="line">        selectImgSuffix: <span class="string">''</span>, <span class="comment">//æ–‡ä»¶ç±»å‹</span></span><br><span class="line">        editImageModalVisible: <span class="literal">false</span>, <span class="comment">//æ‰“å¼€æ§åˆ¶è£å‰ªå¼¹çª—çš„å˜é‡ï¼Œä¸ºtrueå³å¼¹çª—</span></span><br><span class="line">        imgData: [],</span><br><span class="line">        loading: <span class="literal">false</span>,</span><br><span class="line">        download: <span class="string">""</span></span><br><span class="line">    &#125;;</span><br><span class="line">    downLoadImg = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// this.refs.cropper.getCroppedCanvas(&#123;maxWidth: 4096, maxHeight: 4096&#125;);</span></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            download: <span class="keyword">this</span>.refs.cropper.getCroppedCanvas(&#123;</span><br><span class="line">                maxWidth: <span class="number">4096</span>,</span><br><span class="line">                maxHeight: <span class="number">4096</span></span><br><span class="line">            &#125;).toDataURL()</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    saveImg = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;loading&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="keyword">if</span> (loading) <span class="keyword">return</span>;<span class="comment">//é˜²æ­¢é‡å¤æäº¤</span></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            loading: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// lrzå‹ç¼©</span></span><br><span class="line">        <span class="comment">// this.refs.cropper.getCroppedCanvas().toDataURL() ä¸ºè£å‰ªæ¡†çš„base64çš„å€¼</span></span><br><span class="line">        <span class="keyword">const</span> &#123;base64, base64Len&#125; = <span class="keyword">await</span> lrz(<span class="keyword">this</span>.refs.cropper.getCroppedCanvas().toDataURL(), &#123;<span class="attr">quality</span>: <span class="number">.6</span>&#125;);</span><br><span class="line">        <span class="keyword">const</span> &#123;imgData&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        imgData.push(base64);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            imgData,</span><br><span class="line">            loading: <span class="literal">false</span></span><br><span class="line">        &#125;, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.handleCancel()</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// console.log(base64, base64Len / 1024);</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    beforeUpload = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isLt10M = file.size / <span class="number">1024</span> / <span class="number">1024</span> &gt;= <span class="number">10</span>;</span><br><span class="line">        <span class="comment">// console.log(file.size / 1024 / 1024);</span></span><br><span class="line">        <span class="keyword">if</span> (isLt10M) &#123; <span class="comment">//æ·»åŠ æ–‡ä»¶é™åˆ¶</span></span><br><span class="line">            message.error(&#123;<span class="attr">content</span>: <span class="string">'æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10M'</span>&#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">        reader.readAsDataURL(file); <span class="comment">//å¼€å§‹è¯»å–æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">// å› ä¸ºè¯»å–æ–‡ä»¶éœ€è¦æ—¶é—´,æ‰€ä»¥è¦åœ¨å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨è¯»å–çš„ç»“æœ</span></span><br><span class="line">        reader.onload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                srcCropper: e.target.result,</span><br><span class="line">                selectImgName: file.name,</span><br><span class="line">                selectImgSize: (file.size / <span class="number">1024</span> / <span class="number">1024</span>),</span><br><span class="line">                selectImgSuffix: file.type.split(<span class="string">"/"</span>)[<span class="number">1</span>],</span><br><span class="line">                editImageModalVisible: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        reader.onerror = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'å›¾ç‰‡åŠ è½½å¤±è´¥'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    handleCancel = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            editImageModalVisible: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;ratio, title&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">        <span class="keyword">const</span> &#123;srcCropper, editImageModalVisible, imgData, loading, download&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="keyword">const</span> props = &#123;</span><br><span class="line">            name: <span class="string">'file'</span>,</span><br><span class="line">            accept: <span class="string">"image/*"</span>,<span class="comment">//æ–‡ä»¶ç±»å‹</span></span><br><span class="line">            showUploadList: <span class="literal">false</span>, <span class="comment">//ä¸ä»¥é»˜è®¤çš„åˆ—è¡¨æ˜¾ç¤º</span></span><br><span class="line">            beforeUpload: <span class="keyword">this</span>.beforeUpload, <span class="comment">//é˜»æ­¢è‡ªåŠ¨ä¸Šä¼ </span></span><br><span class="line">            onCancel: <span class="keyword">this</span>.handleCancel</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Fragment&gt;</span><br><span class="line">                &lt;Upload &#123;...props&#125;&gt;</span><br><span class="line">                    &lt;Button htmlType=&#123;<span class="string">'button'</span>&#125; type=<span class="string">"dashed"</span>&gt;</span><br><span class="line">                        &lt;Icon type=<span class="string">"upload"</span>/&gt;&#123;title&#125;</span><br><span class="line">                    &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>Upload&gt;</span><br><span class="line"></span><br><span class="line">                &lt;Modal</span><br><span class="line">                    title=<span class="string">"è£å‰ª"</span></span><br><span class="line">                    visible=&#123;editImageModalVisible&#125;</span><br><span class="line">                    loading=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">                    closable=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">                    footer=&#123;[</span><br><span class="line">                        &lt;Button key=&#123;<span class="string">'å–æ¶ˆ'</span>&#125;</span><br><span class="line">                                icon=&#123;<span class="string">'redo'</span>&#125;</span><br><span class="line">                                htmlType=&#123;<span class="string">'button'</span>&#125;</span><br><span class="line">                                onClick=&#123;<span class="keyword">this</span>.handleCancel&#125;&gt;</span><br><span class="line">                            å–æ¶ˆ</span><br><span class="line">                        &lt;<span class="regexp">/Button&gt;,</span></span><br><span class="line"><span class="regexp">                        &lt;Button key=&#123;'ä¿å­˜'&#125;</span></span><br><span class="line"><span class="regexp">                                icon=&#123;'save'&#125;</span></span><br><span class="line"><span class="regexp">                                htmlType=&#123;'button'&#125;</span></span><br><span class="line"><span class="regexp">                                type="primary"</span></span><br><span class="line"><span class="regexp">                                onClick=&#123;this.saveImg&#125;</span></span><br><span class="line"><span class="regexp">                                loading=&#123;loading&#125;&gt;</span></span><br><span class="line"><span class="regexp">                            ä¿å­˜</span></span><br><span class="line"><span class="regexp">                        &lt;/</span>Button&gt;,</span><br><span class="line">                        &lt;Button key=&#123;<span class="string">'ä¸‹è½½'</span>&#125;</span><br><span class="line">                                htmlType=&#123;<span class="string">'button'</span>&#125;</span><br><span class="line">                                icon=<span class="string">"download"</span></span><br><span class="line">                                type=<span class="string">"primary"</span></span><br><span class="line">                                onClick=&#123;<span class="keyword">this</span>.downLoadImg&#125;&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;a href=&#123;download&#125;</span><br><span class="line">                               style=&#123;&#123;<span class="attr">color</span>: <span class="string">'#fff'</span>, <span class="attr">marginLeft</span>: <span class="number">5</span>&#125;&#125;</span><br><span class="line">                               download=<span class="string">"cropped.jpg"</span>&gt;ä¸‹è½½&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;/</span>Button&gt;</span><br><span class="line">                    ]&#125;</span><br><span class="line">                &gt;</span><br><span class="line"></span><br><span class="line">                    &lt;Cropper</span><br><span class="line">                        key=&#123;<span class="string">'cropper'</span>&#125;</span><br><span class="line">                        ref=<span class="string">'cropper'</span></span><br><span class="line">                        src=&#123;srcCropper&#125;</span><br><span class="line">                        style=&#123;&#123;<span class="attr">height</span>: <span class="number">300</span>, <span class="attr">width</span>: <span class="string">'100%'</span>&#125;&#125;</span><br><span class="line">                        viewMode=&#123;<span class="number">1</span>&#125; <span class="comment">//å®šä¹‰cropperçš„è§†å›¾æ¨¡å¼</span></span><br><span class="line">                        zoomable=&#123;<span class="literal">true</span>&#125; <span class="comment">//æ˜¯å¦å…è®¸æ”¾å¤§å›¾åƒ</span></span><br><span class="line">                        aspectRatio=&#123;ratio&#125; <span class="comment">//imageçš„çºµæ¨ªæ¯”</span></span><br><span class="line">                        guides=&#123;<span class="literal">true</span>&#125; <span class="comment">//æ˜¾ç¤ºåœ¨è£å‰ªæ¡†ä¸Šæ–¹çš„è™šçº¿</span></span><br><span class="line">                        background=&#123;<span class="literal">false</span>&#125; <span class="comment">//æ˜¯å¦æ˜¾ç¤ºèƒŒæ™¯çš„é©¬èµ›å…‹</span></span><br><span class="line">                        rotatable=&#123;<span class="literal">false</span>&#125; <span class="comment">//æ˜¯å¦æ—‹è½¬</span></span><br><span class="line">                    /&gt;</span><br><span class="line"></span><br><span class="line">                &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className=&#123;'imgBox'&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;</span></span><br><span class="line"><span class="regexp">                        imgData.map((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                            return (&lt;img</span></span><br><span class="line"><span class="regexp">                                    src=&#123;item&#125;</span></span><br><span class="line"><span class="regexp">                                    alt=&#123;item&#125;</span></span><br><span class="line"><span class="regexp">                                    key=&#123;index&#125;/</span>&gt;</span><br><span class="line">                            )</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">            &lt;/</span>Fragment&gt;</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> cropper;</span><br><span class="line">cropper.defaultProps = &#123;</span><br><span class="line">    ratio: <span class="number">1</span>,</span><br><span class="line">    src: <span class="string">'https://fengyuanchen.github.io/cropperjs/images/picture.jpg'</span>,</span><br><span class="line">    quality: <span class="number">0.6</span>,</span><br><span class="line">    title: <span class="string">'ä¸Šä¼ å›¾ç‰‡'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘å·¥å…·</title>
      <link href="/2019/03/16/tools/store/"/>
      <url>/2019/03/16/tools/store/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>å¼€å‘å·¥å…·</strong></p><p>[[toc]]</p><h3 id="æ¨èåº“"><a href="#æ¨èåº“" class="headerlink" title="æ¨èåº“"></a>æ¨èåº“</h3><p><strong>å¤ªå¸¸ç”¨çš„ä¸€äº›åº“ï¼Œæ¯”å¦‚ <code>lodash</code>ã€<code>axios</code>ã€<code>echarts</code>ã€<code>normalize.css</code>ç­‰å°±ä¸å†ä¸‹é¢æ¨èäº†ã€‚è¿™é‡Œä¸»è¦æ¨èä¸€ä¸‹è‡ªå·±å¹³æ—¶å¸¸ç”¨ï¼Œæé«˜æ•ˆç‡çš„ï¼Œä½†å¤§å®¶å¯èƒ½åˆä¸çŸ¥é“çš„ä¸€äº›åº“ã€‚</strong></p><h3 id="å‰ç«¯å¸¸ç”¨"><a href="#å‰ç«¯å¸¸ç”¨" class="headerlink" title="å‰ç«¯å¸¸ç”¨"></a>å‰ç«¯å¸¸ç”¨</h3><ul><li><a href="https://github.com/sweetalert2/sweetalert2" target="_blank" rel="noopener">sweetalert2</a> ä¸€ä¸ªè‡ªé€‚åº”ï¼Œä¸”è‡ªå®šä¹‰æ€§å¼ºçš„å¼¹å‡ºæ¡†ï¼ˆé›¶ä¾èµ–ï¼‰</li><li><a href="https://github.com/atomiks/tippyjs" target="_blank" rel="noopener">tippy.js </a> æœ€è‘—åçš„ tooltip/popover library</li><li><a href="https://github.com/text-mask/text-mask" target="_blank" rel="noopener">text-mask</a> å¯ä»¥è®© input æŒ‰ç…§è§„åˆ™è¾“å…¥(å¦‚ç”µè¯,email,æ—¥æœŸ,ä¿¡ç”¨å¡ç­‰)ï¼Œç‰¹æ®Šæ ¼å¼ input</li><li><a href="https://github.com/sarahdayan/dinero.js" target="_blank" rel="noopener">dinero.js</a> ç”¨æ¥åˆ›å»ºã€è®¡ç®—å’Œæ ¼å¼åŒ–è´§å¸ä»·å€¼çš„ä¸å¯å˜çš„æ¡†æ¶ï¼Œæ”¯æŒå›½é™…åŒ–</li><li><a href="https://github.com/lerna/lerna" target="_blank" rel="noopener">lerna</a> å¤§é¡¹ç›®ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œé¡¹ç›®ä¸­å¯ä»¥æœ‰å¤šä¸ª package.json æ–‡ä»¶</li><li><a href="https://github.com/RevillWeb/img-2" target="_blank" rel="noopener">img-2</a> ä¸€ä¸ªæé«˜å›¾ç‰‡åŠ è½½æ€§èƒ½å’Œä½“éªŒçš„åº“ï¼Œæ‡’åŠ è½½ä½¿ç”¨ web worker æ¨¡ç³Šé¢„è§ˆ</li><li><a href="https://github.com/Valve/fingerprintjs2" target="_blank" rel="noopener">fingerprintjs</a> æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„æµè§ˆå™¨æŒ‡çº¹åº“ï¼Œé€šæµè§ˆç¯å¢ƒçš„ä¸€ç³»åˆ—é…ç½®ç”Ÿæˆ id</li><li><a href="https://github.com/epoberezkin/ajv" target="_blank" rel="noopener">ajv</a> ä¸€ä¸ª json schema éªŒè¯çš„åº“</li><li><a href="https://github.com/xx45/dayjs" target="_blank" rel="noopener">dayjs</a> ä¸€ä¸ªè½»é‡çº§ç±» moment.js API æ—¶é—´åº“</li><li><a href="https://github.com/PrismJS/prism" target="_blank" rel="noopener">primjs</a> è®©é¡µé¢æ”¯æŒä»£ç é«˜äº®</li><li><a href="https://github.com/RelaxedJS/ReLaXed" target="_blank" rel="noopener">ReLaXed</a> ä¸€ä¸ªå°† document html è½¬æˆ PDF çš„å·¥å…·</li><li><a href="https://github.com/transloadit/uppy" target="_blank" rel="noopener">uppy</a> ä¸€ä¸ªå¾ˆå¥½çœ‹çš„ä¹Ÿå¾ˆå¥½ç”¨çš„ å‰ç«¯ä¸Šä¼ åº“</li><li><a href="https://github.com/pqina/filepond" target="_blank" rel="noopener">Filepond</a> ä¸€ä¸ªå°å·§çš„æ–‡ä»¶ä¸Šä¼ åº“</li><li><a href="http://ui.toast.com/tui-calendar/" target="_blank" rel="noopener">tui-calendar</a> åŠŸèƒ½å…¨é¢çš„æ—¥ç¨‹å®‰æ’æ—¥å†æ§ä»¶ï¼Œè¿˜æ”¯æŒæ‹–æ‹½</li><li><a href="https://github.com/nhnent/tui.editor" target="_blank" rel="noopener">tui.editor</a> markdown æ‰€è§å³æ‰€å¾—ç¼–è¾‘å™¨</li><li><a href="https://github.com/tabler/tabler" target="_blank" rel="noopener">tabler</a> - åŸºäº Bootstrap 4 çš„ Dashboard UI Kit å’Œç¾è§‚ é«˜é¢œå€¼ ui æ¨¡æ¿</li><li><a href="https://github.com/BoxFactura/pulltorefresh.js" target="_blank" rel="noopener">pulltorefresh.js</a> - ä¸‹ä¸ªä¸‹æ‹‰åˆ·æ–°æ’ä»¶</li><li><a href="https://github.com/yued-fe/lulu" target="_blank" rel="noopener">lulu</a> - è…¾è®¯é˜…æ–‡åŸºäº jQueryï¼Œé’ˆå¯¹ PC ç½‘ç«™ IE8+ï¼ˆpeak ä¸»é¢˜ï¼‰çš„å‰ç«¯ UI æ¡†æ¶</li><li><a href="https://github.com/chancejs/chancejs" target="_blank" rel="noopener">chancejs</a> - ç”Ÿæˆéšæœºæ•°æ®çš„åº“</li><li><a href="https://github.com/spritejs/spritejs" target="_blank" rel="noopener">spritejs</a> - 360 å¥‡èˆå›¢å‡ºçš„è·¨å¹³å°ç»˜å›¾å¯¹è±¡æ¨¡å‹</li><li><a href="https://github.com/googlechrome/workbox" target="_blank" rel="noopener">workbox</a> - è®©ä½ çš„ç½‘ç«™æ›´æ–¹ä¾¿çš„å˜æˆ pwa</li><li><a href="https://github.com/nhnent/tui.image-editor" target="_blank" rel="noopener">tui.image-editor</a> - ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„åœ¨çº¿å›¾ç‰‡ç¼–è¾‘ï¼ŒåŸºäº canvas</li><li><a href="https://github.com/ai/nanoid" target="_blank" rel="noopener">nanoid</a> - å‰ç«¯è½»é‡ unique string ID ç”Ÿæˆåº“</li><li><a href="https://github.com/pubkey/rxdb" target="_blank" rel="noopener">rxdb</a> - ä¸€æ¬¾å¼€æºçš„å¿«é€Ÿã€çµæ´»çš„å®¢æˆ·ç«¯æ•°æ®åº“ï¼Œæ”¯æŒå„ç§æµè§ˆå™¨ä»¥åŠ NodeJSï¼ŒElectronã€React ç­‰ç­‰ï¼Œæ˜¯ PouthDB ä¹‹ä¸Šçš„ä¸€ä¸ªå°è£…åº“</li><li><a href="https://github.com/danburzo/percollate" target="_blank" rel="noopener">percollate</a> - å‘½ä»¤è¡Œå·¥å…· èƒ½å°†ç½‘é¡µè½¬æ¢æˆ pdf</li><li><a href="https://github.com/sokra/rawact" target="_blank" rel="noopener">rawact</a> - ä¸€ä¸ª babel æ’ä»¶ï¼ŒæŠŠ react ç»„ä»¶è½¬ä¸ºåŸç”Ÿ dom</li><li><a href="https://github.com/gruns/irondb" target="_blank" rel="noopener">irondb</a> - æ˜¯ä¸€ä¸ªæµè§ˆå™¨ key-value å‚¨å­˜çš„å°è£…åº“ï¼ŒæŠŠ Cookiesã€IndexedDBã€LocalStorageã€SessionStorage ç»Ÿä¸€æˆä¸€ä¸ªæ¥å£ã€‚å®ƒçš„æœ€å¤§ç‰¹è‰²å°±æ˜¯æ•°æ®å†—ä½™æœºåˆ¶ï¼Œå³ä½¿æŸç§åº•å±‚å‚¨å­˜æœºåˆ¶å¤±æ•ˆï¼Œå®ƒå¯ä»¥ä»å…¶ä»–æœºåˆ¶æ¢å¤æ•°æ®ã€‚</li><li><a href="https://github.com/MikeMcl/big.js" target="_blank" rel="noopener">big.js</a> è§£å†³ js æµ®ç‚¹æ•°é—®é¢˜ã€‚ ä¸»è¦å°±æ˜¯ Big Number æˆ–è€…å°æ•°ç‚¹æ¸©æŸ”</li><li><a href="https://github.com/MikeMcl/bignumber.js" target="_blank" rel="noopener">bignumber.js</a> - åŒä¸Š</li><li><a href="https://github.com/dollarshaveclub/stickybits" target="_blank" rel="noopener">stickybits</a> - CSS çš„ position: sticky æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„è®¾ç½®ï¼Œä½†æ˜¯è€çš„æµè§ˆå™¨ä¸æ”¯æŒã€‚è¿™ä¸ª JS åº“æ˜¯è¯¥åŠŸèƒ½çš„å«ç‰‡åº“ã€‚</li><li><a href="https://github.com/mozilla-services/react-jsonschema-form" target="_blank" rel="noopener">react-jsonschema-form</a> - Mozilla service å¼€æºäº†ä¸€ä¸ªé€šè¿‡ JSON ç›´æ¥ç”Ÿæˆè¡¨å•çš„ React ç»„ä»¶</li><li><a href="https://github.com/nosir/cleave.js" target="_blank" rel="noopener">cleave.js</a> - ç”¨äºåœ¨è¾“å…¥æ—¶æ ¼å¼åŒ–è¾“å…¥å†…å®¹ï¼ˆä¿¡ç”¨å¡æ ¼å¼ã€æ—¥æœŸç­‰ï¼‰</li><li><a href="https://github.com/rikschennink/shiny" target="_blank" rel="noopener">shiny</a> - åœ¨æ‰‹æœºè®¾å¤‡ä¸Šæ¨¡æ‹Ÿå…‰çš„åå°„æ•ˆæœã€‚ æ”¯æŒ DeviceMotion äº‹ä»¶</li><li><a href="https://github.com/cloudfetch/cloudquery" target="_blank" rel="noopener">cloudquery</a> - Turn any website to serverless API</li><li><a href="https://github.com/yujiangshui/A-Programmers-Guide-to-English" target="_blank" rel="noopener">A-Programmers-Guide-to-English</a> - ä¸“ä¸ºç¨‹åºå‘˜ç¼–å†™çš„è‹±è¯­å­¦ä¹ æŒ‡å—ã€‚</li><li><a href="https://github.com/rrweb-io/rrweb" target="_blank" rel="noopener">rrweb</a> - ä¸€ä¸ªå¯ä»¥è®°å½•ä½ é¡µé¢ä¸­æ‰€æœ‰æ“ä½œçš„åº“</li><li><a href="https://github.com/ksky521/nodeppt" target="_blank" rel="noopener">nodeppt</a> - markdown å†™ ppt</li><li><a href="https://github.com/nextapps-de/flexsearch" target="_blank" rel="noopener">flexsearch</a> - èƒ½è®©ä½ æ›´åŠ é«˜æ•ˆå’Œå¿«é€Ÿçš„æ£€ç´¢æ–‡æœ¬å†…å®¹</li><li><a href="https://github.com/toddmotto/public-apis" target="_blank" rel="noopener">public-apis</a> - æ±‡é›†äº†å¸‚é¢ä¸Šä¸€äº›å¯¹å¤–å…è´¹å¼€æ”¾çš„ apiï¼Œåšä¸€äº›è‡ªå·±ç»ƒæ‰‹ app çš„æ—¶å€™å¾ˆå¥½ç”¨ã€‚</li><li><a href="https://github.com/appleple/scroll-hint" target="_blank" rel="noopener">scroll-hint</a> ç”¨äºæç¤ºç”¨æˆ·é¡µé¢å¯ä»¥å·¦å³æ»‘åŠ¨çš„ä¸€ä¸ªæç¤ºåº“</li><li><a href="https://github.com/krisk/fuse" target="_blank" rel="noopener">fuse.js</a> è½»é‡çº§å‰ç«¯æ¨¡ç³ŠæŸ¥è¯¢åº“ éå¸¸çš„å¥½ç”¨</li><li><a href="https://github.com/eligrey/FileSaver.js" target="_blank" rel="noopener">FileSaver.js</a> æ–‡ä»¶ä¸‹è½½æ’ä»¶ å¾ˆå¤šæ—¶å€™ä¸‹è½½ä¼šæœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œå®ƒèƒ½å¸®ä½ è§£å†³è¿™äº›é—®é¢˜</li><li><a href="https://github.com/instantpage/instant.page" target="_blank" rel="noopener">instant.page</a> ä¸€ä¸ªåˆ¤æ–­ç”¨æˆ·è¡Œä¸º é¢„æµ‹æå‰åŠ è½½é¡µé¢çš„åº“</li><li><a href="https://github.com/sindresorhus/screenfull.js" target="_blank" rel="noopener">screenfull.js</a> æµè§ˆå™¨å…¨å±æ’ä»¶ è§£å†³äº†ä¸å°‘å…¼å®¹æ€§é—®é¢˜</li><li><a href="https://github.com/vuejs/vuepress" target="_blank" rel="noopener">VuePress</a> æœ¬ç½‘ç«™å°±æ˜¯åŸºäºå®ƒå®ç°çš„ï¼Œç®€å•æ–¹ä¾¿çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨</li><li><a href="https://github.com/Simonwep/selection" target="_blank" rel="noopener">selection</a> å¯è§†åŒ–é€‰æ‹©é¡µé¢å…ƒç´ çš„åº“</li><li><a href="https://github.com/scroll-out/scroll-out" target="_blank" rel="noopener">scroll-out</a> æ»šåŠ¨æ•ˆæœï¼ˆæ»šåŠ¨è§†å·®ï¼‰çš„æ¡†æ¶ï¼Œæ¡†æ¶å¤§å°ä¸åˆ° 1KB,ä½¿ç”¨å›è°ƒçš„æ–¹å¼å°†ç›¸å…³åŠ¨ç”»å…ƒç´ çš„å±æ€§è¿›è¡Œå®æ—¶åˆ†é…</li><li><a href="https://github.com/gpujs/gpu.js" target="_blank" rel="noopener">gpu.js</a> é€šè¿‡å°† js è½¬ä¸ºç‰¹å®šçš„ languageï¼Œåˆ©ç”¨ GPU æ¥æ‰§è¡Œï¼Œå¤§å¤§æé«˜äº†æ‰§è¡Œæ€§èƒ½å’Œé€Ÿåº¦</li><li><a href="https://github.com/stuyam/pressure" target="_blank" rel="noopener">pressure</a> å‰ç«¯å®ç° 3D Touch</li><li><a href="https://github.com/hammerjs/hammer.js" target="_blank" rel="noopener">hammer</a> ç§»åŠ¨ç«¯æ‰‹åŠ¿åº“</li><li><a href="https://github.com/AlloyTeam/AlloyFinger" target="_blank" rel="noopener">AlloyFinger</a> è…¾è®¯å‡ºçš„æ‰‹åŠ¿åº“</li><li><a href="https://github.com/typicode/lowdb" target="_blank" rel="noopener">lowdb</a> LowDB æ˜¯ä¸€ä¸ªæœ¬åœ° JSON æ•°æ®åº“ï¼ŒåŸºäº Lodash å¼€å‘çš„</li><li><a href="https://github.com/typicode/json-server" target="_blank" rel="noopener">JSON-server</a> å¯ä»¥é…åˆ LowDB ä½¿ç”¨ å¿«é€Ÿæ­å»ºä¸€ä¸ª REST API</li><li><a href="https://github.com/olivernn/lunr.js" target="_blank" rel="noopener">lunr.js</a> æ˜¯ä¸ªç”¨äºæµè§ˆå™¨çš„è½»é‡çº§ JavaScript å…¨æ–‡æœç´¢å¼•æ“,å¯¹äºä¸€äº›å°å‹çš„åšå®¢ã€å¼€å‘è€…æ–‡æ¡£æˆ– Wiki ç½‘ç«™æ¥è¯´,å®Œå…¨å¯ä»¥é€šè¿‡å®ƒå®ç°ç«™å†…ç¦»çº¿æœç´¢</li><li><a href="https://github.com/mathiasbynens/he" target="_blank" rel="noopener">he</a> ä¸€ä¸ªå‰ç«¯ encoder/decoder åº“</li><li><a href="https://github.com/benhowdle89/grade" target="_blank" rel="noopener">grade</a> ä¸€ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ å›¾ç‰‡ è°ƒæ•´åº•è‰²çš„æ’ä»¶</li><li><a href="https://github.com/sindresorhus/pretty-bytes" target="_blank" rel="noopener">pretty-bytes</a> å°†å­—èŠ‚è½¬æ¢æˆå¯ä»¥è¯»çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ 1337 ä¸ªå­—èŠ‚ï¼Œä¼šæ˜¾ç¤ºæˆ 1.34 KB</li></ul><h3 id="å…¨æ™¯å›¾"><a href="#å…¨æ™¯å›¾" class="headerlink" title="å…¨æ™¯å›¾"></a>å…¨æ™¯å›¾</h3><p><a href="https://www.jianshu.com/p/b227912b1d71" target="_blank" rel="noopener">krpanoå…¨æ™¯å›¾</a><br><a href="https://krpano.milly.me/" target="_blank" rel="noopener">krpanoæ–‡æ¡£</a></p><h3 id="Css-amp-åŠ¨ç”»"><a href="#Css-amp-åŠ¨ç”»" class="headerlink" title="Css &amp; åŠ¨ç”»"></a>Css &amp; åŠ¨ç”»</h3><ul><li><a href="https://github.com/daneden/animate.css" target="_blank" rel="noopener">animate.css</a> æœ€æœ‰åçš„åŠ¨ç”»æ•ˆæœåº“</li><li><a href="https://github.com/miniMAC/magic" target="_blank" rel="noopener">magic.css</a> css åŠ¨ç”»æ•ˆæœåº“ ç±»ä¼¼ animate.css</li><li><a href="https://github.com/Popmotion/popmotion" target="_blank" rel="noopener">popmotion</a> ä¸€ä¸ªå‡½æ•°å¼å£°æ˜å‰ç«¯åŠ¨ç”»åº“</li><li><a href="https://github.com/BcRikko/NES.css" target="_blank" rel="noopener">NES.css</a> ä»»å¤©å ‚ä¸»é¢˜é£æ ¼ css åº“</li><li><a href="https://github.com/VincentGarreau/particles.js" target="_blank" rel="noopener">particles.js</a> å‰ç«¯å®ç°é¢—ç²’ç²’å­çš„åŠ¨ç”»æ•ˆæœåº“ï¼Œæ¯”è¾ƒç‚«é…·ï¼Œä½†ç›¸å¯¹çš„ä¹Ÿæ¯”è¾ƒåƒæ€§èƒ½</li><li><a href="https://www.getpapercss.com/docs/" target="_blank" rel="noopener">PaperCSS</a> æ‰‹ç»˜é£æ ¼æ„Ÿè§‰ css åº“</li><li><a href="https://github.com/pshihn/rough" target="_blank" rel="noopener">rough</a> åŸºäº Canvas çš„æ‰‹ç»˜é£æ ¼å›¾å½¢åº“</li><li><a href="https://github.com/wiredjs/wired-elements" target="_blank" rel="noopener">wired-elements</a> åŸºäº rough.js åˆ†è£… button input radio ç­‰ç»„ä»¶ã€‚å®ƒçš„åº•å±‚æ˜¯ Web components</li><li><a href="https://github.com/liabru/matter-js" target="_blank" rel="noopener">matter-js</a> web ç‰©ç†å¼•æ“</li><li><a href="https://github.com/webkul/micron" target="_blank" rel="noopener">micron</a> é€šè¿‡åœ¨å…ƒç´ ä¸Šç»‘å®šå±æ€§ä»è€Œå®ç°åŠ¨ç”»æ•ˆæœçš„åº“</li><li><a href="https://github.com/NigelOToole/direction-reveal" target="_blank" rel="noopener">direction-reveal</a> æ ¹æ®é¼ æ ‡è¿›å…¥ä½ç½®ï¼Œå±•ç°ä»ä¸åŒæ–¹å‘ å±•ç° hover æ•ˆæœ</li><li><a href="https://github.com/alexfoxy/laxxx" target="_blank" rel="noopener">laxxx</a> æ»šåŠ¨ç‰¹æ•ˆåº“ è½»é‡çº§ å‹ç¼©å®Œ 2kb</li><li><a href="https://cssfx.dev/" target="_blank" rel="noopener">cssfx</a> ä¼˜é›…çš„ CSS åŠ¨ç”»æ•ˆæœï¼Œå¼€ç®±å³ç”¨</li><li><a href="https://github.com/metafizzy/zdog" target="_blank" rel="noopener">zdog</a> 3D engine å¼•æ“</li></ul><h3 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h3><ul><li><a href="https://github.com/shentao/vue-multiselect" target="_blank" rel="noopener">vue-multiselect</a> select ç»„ä»¶ ç›®å‰ vue é‡Œé¢ç”¨è¿‡æœ€å¥½ç”¨çš„</li><li><a href="https://github.com/SortableJS/Vue.Draggable" target="_blank" rel="noopener">Vue.Draggable</a> DnD æ‹–æ‹½ç»„ä»¶ åŸºäº Sortable.js çš„ vue ç‰ˆæœ¬</li><li><a href="https://github.com/Botre/vue-sauce" target="_blank" rel="noopener">vue-sauce</a> ä¸€ä¸ªå¯ä»¥å±•ç¤º vue æºç çš„æŒ‡ä»¤</li><li><a href="https://github.com/kutlugsahin/vue-smooth-dnd" target="_blank" rel="noopener">vue-smooth-dnd</a> Vue wrappers components for smooth-dnd</li><li><a href="https://github.com/vuegg/vuegg" target="_blank" rel="noopener">vuegg</a> ä¸€ä¸ª vue å¯è§†åŒ–æ‹–æ‹½ç•Œé¢ç”Ÿæˆå™¨</li><li><a href="https://github.com/baianat/vee-validate" target="_blank" rel="noopener">vee-validate</a> åŸºäº vue çš„éªŒè¯ï¼Œèƒ½éªŒè¯çš„å†…å®¹æ¯”è¾ƒå…¨</li><li><a href="https://github.com/lusaxweb/vuesax" target="_blank" rel="noopener">vuesax</a> ä¸€ä¸ªå¾ˆæ¼‚äº®çš„åŸºäº vue çš„ ui æ¡†æ¶</li><li><a href="https://github.com/MatteoGabriele/vue-analytics" target="_blank" rel="noopener">vue-analytics</a> åŸºäº vue çš„ è°·æ­Œç»Ÿè®¡å°è£…</li><li><a href="https://github.com/Akryum/vue-virtual-scroller" target="_blank" rel="noopener">vue-virtual-scroller</a> åŸºäº vue çš„è™šæ‹Ÿåˆ—è¡¨æ— é™æ»šåŠ¨</li><li><a href="https://github.com/michalsnik/vue-content-placeholders" target="_blank" rel="noopener">vue-content-placeholders</a> é¡µé¢é¾™éª¨ skeleton</li></ul><h3 id="å®è·µåº“"><a href="#å®è·µåº“" class="headerlink" title="å®è·µåº“"></a>å®è·µåº“</h3><ul><li><a href="https://github.com/Jasonette/JASONETTE-iOS" target="_blank" rel="noopener">Jasonette</a> ä¸€ä¸ªç”¨ json æ¥æ„å»º hybrid App çš„æ¡†æ¶</li><li><a href="https://github.com/atulmy/crate" target="_blank" rel="noopener">crate</a> ä¸€ä¸ª react å…¨æ ˆç»ƒä¹ (pc,mobile,rn,api) demoï¼Œé€‚åˆå…¥é—¨æ‹¿æ¥ç»ƒæ‰‹</li><li><a href="https://github.com/krasimir/react-in-patterns" target="_blank" rel="noopener">react-in-patterns</a> ä¸€æœ¬å¼€æºæ•™ä½ å¦‚ä½•å†™ react çš„ä¹¦</li><li><a href="https://github.com/deepsweet/hocs" target="_blank" rel="noopener">hocs</a> react ç›¸å…³ hoc æ”¶é›†åº“</li></ul><h3 id="å·¥å…·åº“"><a href="#å·¥å…·åº“" class="headerlink" title="å·¥å…·åº“"></a>å·¥å…·åº“</h3><ul><li><a href="https://github.com/tapio/live-server" target="_blank" rel="noopener">live-server</a> å¯ä»¥å¿«é€Ÿå¯ä¸€ä¸ªæœ¬åœ° dev æœåŠ¡ å¹¶ä¸”æ”¯æŒè‡ªåŠ¨åˆ·æ–°çš„ http server</li><li><a href="https://github.com/zeit/serve" target="_blank" rel="noopener">serve</a> - å¿«é€Ÿèµ·æœ¬åœ°é™æ€æœåŠ¡</li><li><a href="https://github.com/tehnokv/picojs" target="_blank" rel="noopener">picojs</a> js äººè„¸è¯†åˆ«åº“</li><li><a href="https://github.com/ruanyf/es-checker" target="_blank" rel="noopener">es-checker</a> æ£€æŸ¥å½“å‰ç¯å¢ƒå¯¹ ES6 æ”¯æŒçš„æƒ…å†µã€‚æ”¯æŒæµè§ˆå™¨å’Œ node.js</li><li><a href="https://github.com/lukechilds/merge-images" target="_blank" rel="noopener">merge-images</a> å›¾ç‰‡åˆæˆï¼Œåˆ©ç”¨<code>canvas</code>èƒ½å°†å‡ å¼ å›¾ç‰‡åˆæˆä¸€å¼ </li><li><a href="https://github.com/fabricjs/fabric.js" target="_blank" rel="noopener">fabric.js</a> åŸºäº canvas åˆ›å»ºäº¤äº’å¼çš„å›¾ç‰‡ç¼–è¾‘ç•Œé¢éå¸¸é€‚åˆç”¨æ¥åšå›¾ç‰‡åˆæˆç±»å·¥ä½œã€‚</li><li><a href="https://github.com/photonstorm/phaser" target="_blank" rel="noopener">phaser</a> è¿™æ˜¯ä¸€ä¸ªä¸ºæ¡Œé¢å’Œç§»åŠ¨æµè§ˆå™¨å¼€å‘ HTML5 æ¸¸æˆçš„å¿«é€Ÿå¼€æºæ¡†æ¶ã€‚<br>ä½ å¯ä»¥ä¸º iOSã€ Android å’Œä¸åŒçš„æœ¬åœ°åº”ç”¨ç¨‹åºåˆ›å»ºæ¸¸æˆã€‚</li><li><a href="https://github.com/purifycss/purifycss" target="_blank" rel="noopener">purifycss</a> ç§»é™¤æ²¡ä½¿ç”¨åˆ°çš„ css</li><li><a href="https://github.com/leeoniya/dropcss" target="_blank" rel="noopener">dropcss</a> åŒä¸Š</li><li><a href="https://github.com/sindresorhus/fast-cli" target="_blank" rel="noopener">fast-cli</a> å‘½ä»¤è¡Œæµ‹è¯•ä¸‹è½½ä¸Šä¼ é€Ÿåº¦</li><li><a href="https://github.com/pikapkg/web" target="_blank" rel="noopener">@pika/web</a> è®©ä½ ä¸éœ€è¦åœ¨æœ¬åœ° webpack ä¸­ importï¼Œç›´æ¥åœ¨æ¸¸è§ˆå™¨é‡Œé¢è¿è¡Œ npm åŒ…</li><li><a href="https://github.com/hotoo/pinyin" target="_blank" rel="noopener">pinyin</a> æ±‰å­—æ‹¼éŸ³è½¬æ¢å·¥å…·</li><li><a href="https://obfuscator.io/" target="_blank" rel="noopener">JavaScript Obfuscator Tool</a> js ä»£ç æ··æ·†å·¥å…·</li><li><a href="https://github.com/naptha/tesseract.js" target="_blank" rel="noopener">tesseract</a> å›¾åƒè¯†åˆ«ï¼Œå®ƒèƒ½è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ï¼Œæ”¯æŒä¸­æ–‡</li><li><a href="https://github.com/gkajs/gka" target="_blank" rel="noopener">gka</a> ä¸€æ¬¾é«˜æ•ˆã€é«˜æ€§èƒ½çš„å¸§åŠ¨ç”»ç”Ÿæˆå·¥å…·ã€‚åªéœ€ä¸€è¡Œå‘½ä»¤ï¼Œå¿«é€Ÿå›¾ç‰‡ä¼˜åŒ–ã€ç”ŸæˆåŠ¨ç”»æ–‡ä»¶ï¼Œæ”¯æŒæ•ˆæœé¢„è§ˆã€‚</li><li><a href="https://github.com/benjamn/recast" target="_blank" rel="noopener">recast</a> å‰ç«¯ ast åº“</li><li><a href="https://github.com/facebook/jscodeshift" target="_blank" rel="noopener">jscodeshift</a> å°† js å†…å®¹è§£ææˆ AST è¯­æ³•æ ‘ï¼Œç„¶åæä¾›ä¸€äº›ä¾¿åˆ©çš„æ“ä½œæ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹å„ä¸ªèŠ‚ç‚¹è¿›è¡Œæ›´æ”¹</li><li><a href="https://github.com/mrdoob/stats.js/" target="_blank" rel="noopener">stats.js</a> å‰ç«¯æ€§èƒ½ç›‘æ§ å¦‚ FPSã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰</li><li><a href="https://github.com/mholt/PapaParse" target="_blank" rel="noopener">PapaParse</a> è§£æ csv excel</li></ul><h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><ul><li><a href="https://github.com/nuxt/consola" target="_blank" rel="noopener">consola</a> ä¼˜é›…çš„å‘½ä»¤è¡Œ console <code>vuepress</code> ä¹Ÿä½¿ç”¨äº†å®ƒ</li><li><a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="noopener">cheerio</a> - ç”¨ç±» jQuery è¯­æ³•å¤„ç† HTML</li><li><a href="https://github.com/paulmillr/chokidar" target="_blank" rel="noopener">chokidar</a> - node ç›‘å¬æ–‡ä»¶å˜åŒ–çš„åº“</li><li><a href="https://github.com/jprichardson/node-fs-extra" target="_blank" rel="noopener">fs-extra</a> - fs-extra æ¨¡å—æ˜¯ç³»ç»Ÿ fs æ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº† fs æ¨¡å—çš„ API</li><li><a href="https://github.com/isaacs/rimraf" target="_blank" rel="noopener">rimraf</a> - åˆ é™¤æ–‡ä»¶</li><li><a href="https://github.com/sindresorhus/globby" target="_blank" rel="noopener">globby</a> - ç”¨äºæ¨¡å¼åŒ¹é…ç›®å½•æ–‡ä»¶</li><li><a href="https://github.com/isaacs/node-glob" target="_blank" rel="noopener">glob</a> - æ–‡ä»¶æŸ¥æ‰¾</li><li><a href="https://github.com/terkelg/tiny-glob" target="_blank" rel="noopener">tiny-glob</a> - æ–‡ä»¶æŸ¥æ‰¾</li><li><a href="https://github.com/npm/node-semver" target="_blank" rel="noopener">node-semver</a> - node ç‰ˆæœ¬éªŒè¯åº“</li><li><a href="https://github.com/mysticatea/npm-run-all/blob/master/docs/node-api.md" target="_blank" rel="noopener">npm-run-all</a> - ä¸€ä¸ª CLI å·¥å…·å¯ä»¥å¹¶è¡Œæˆ–è€…ä¸²è¡Œæ‰§è¡Œ script</li><li><a href="https://github.com/tapio/live-server" target="_blank" rel="noopener">live-server</a> - ä¸€ä¸ªç®€å•çš„ http server å¸¦æœ‰ reload åŠŸèƒ½</li><li><a href="https://github.com/indexzero/node-portfinder" target="_blank" rel="noopener">node-portfinder</a> - ä¸€ä¸ªç«¯å£å—…æ¢å·¥å…·</li><li><a href="https://github.com/yeoman/update-notifier" target="_blank" rel="noopener">update-notifier</a> - Update notifications for your CLI app. cli å‡çº§æé†’å·¥å…·</li><li><a href="https://github.com/yargs/y18n" target="_blank" rel="noopener">y18n</a> - yargs åŸºäº i18n çš„ä¸€ä¸ªåŒ…</li><li><a href="https://github.com/klauscfhq/signale" target="_blank" rel="noopener">signale</a> - Hackable console logger ä¸€ä¸ª Node çš„æ—¥å¿—æ ¼å¼åº“ï¼Œè‡ªå¸¦ 16 ä¸ªçº§åˆ«ï¼Œå¯ä»¥å®šåˆ¶é¢œè‰²å’Œ Emoji</li><li><a href="https://github.com/sindresorhus/execa" target="_blank" rel="noopener">execa</a> - A better <code>child_process</code></li><li><a href="https://github.com/SamVerschueren/listr" target="_blank" rel="noopener">listr</a> - Terminal task</li><li><a href="https://github.com/tj/commander.js" target="_blank" rel="noopener">commander.js</a> - è‡ªåŠ¨çš„è§£æå‘½ä»¤å’Œå‚æ•°ï¼Œåˆå¹¶å¤šé€‰é¡¹ï¼Œå¤„ç†çŸ­å‚ï¼Œç­‰ç­‰ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä¸Šæ‰‹ç®€å•</li><li><a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener">Inquirer.js</a> - A collection of common interactive command line user interfaces. å‘½ä»¤è¡Œè¯¢é—®åº“</li><li><a href="https://github.com/nasa/openmct" target="_blank" rel="noopener">enquirer</a> - å‘½ä»¤è¡Œ prompt è¯¢é—®åº“ï¼Œå†™ cli çš„æ—¶å€™å¾ˆæœ‰ç”¨</li><li><a href="https://github.com/klaussinani/qoa" target="_blank" rel="noopener">Qoa</a> åŒä¸Š</li><li><a href="https://github.com/sindresorhus/ora" target="_blank" rel="noopener">ora</a> - Elegant terminal spinner å‘½ä»¤è¡Œ loading</li><li><a href="https://github.com/chalk/chalk" target="_blank" rel="noopener">chalk</a> - å‘½ä»¤è¡Œç€è‰²ç¾åŒ–åº“</li><li><a href="https://github.com/jondot/hygen" target="_blank" rel="noopener">hygen</a> - å¿«é€Ÿæ–¹ä¾¿çš„åˆ›å»ºä»£ç  å¯ä»¥å‘½ä»¤è¡Œåˆ›å»ºé¢„è®¾çš„ template</li><li><a href="https://github.com/GoogleChromeLabs/ndb" target="_blank" rel="noopener">ndb</a> - node è°ƒè¯•</li><li><a href="https://github.com/sindresorhus/got" target="_blank" rel="noopener">got</a> - http è¯·æ±‚åº“ å¦‚æœä½ è§‰å¾— request å¤ªå¤šçš„è¯ è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©</li><li><a href="https://github.com/zeeshanu/dumper.js" target="_blank" rel="noopener">dumper.js</a> - èƒ½è®©ä½ çš„ node console æ›´åŠ çš„è§„æ•´ï¼Œæ–¹ä¾¿è°ƒè¯•</li><li><a href="https://github.com/nswbmw/node-in-debugging" target="_blank" rel="noopener">node-in-debugging</a> - node.js è°ƒè¯•æŒ‡å—</li><li><a href="https://github.com/i0natan/nodebestpractices" target="_blank" rel="noopener">node-best-practices</a> - node æœ€ä½³å®è·µ</li><li><a href="https://github.com/pyloque/fastscan" target="_blank" rel="noopener">fastscan</a> - node æ•æ„Ÿè¯åº“</li><li><a href="https://github.com/antonmedv/fx" target="_blank" rel="noopener">fx</a> - å‘½ä»¤è¡Œä¼˜åŒ– JSON è¾“å‡º</li><li><a href="https://github.com/facebook/dataloader" target="_blank" rel="noopener">dataloader</a> - è§£å†³ Graphql ä¸­çš„ N+1 æŸ¥è¯¢é—®é¢˜</li><li><a href="https://github.com/bvaughn/progress-estimator" target="_blank" rel="noopener">progress-estimator</a> - å‘½ä»¤è¡Œ progress bar è¿›åº¦æ¡æ¨¡æ‹Ÿåº“</li><li><a href="https://github.com/i0natan/nodebestpractices/blob/master/README.chinese.md" target="_blank" rel="noopener">Node.js æœ€ä½³å®è·µ</a></li><li><a href="https://github.com/grpc/grpc-web" target="_blank" rel="noopener">grpc-web</a> - å‰ç«¯ç›´è¿ gRPC æœåŠ¡</li><li><a href="https://github.com/bitinn/node-fetch" target="_blank" rel="noopener">node-fetch</a> - node ç¯å¢ƒä¸‹è½»é‡çº§ fetch è¯·æ±‚åº“</li><li><a href="https://github.com/vadimdemedes/ink" target="_blank" rel="noopener">ink</a> æ˜¯ä¸€ä¸ª React çš„å‘½ä»¤è¡Œæ¸²æŸ“å™¨ï¼Œå‘½ä»¤è¡Œç•Œé¢å¯ä»¥åƒå†™é¡µé¢é‚£ä¹ˆå†™äº†</li><li><a href="https://github.com/strapi/strapi/" target="_blank" rel="noopener">strapi</a> å¼€æºçš„è§£å†³æ–¹æ¡ˆæ¥åˆ›å»ºã€éƒ¨ç½²å’Œç®¡ç†è‡ªå·±çš„ API</li><li><a href="https://github.com/SamVerschueren/listr" target="_blank" rel="noopener">listr</a> Terminal task list</li><li><a href="https://github.com/motdotla/dotenv" target="_blank" rel="noopener">dotenv</a> é€šè¿‡.env è®¾ç½®ç¯å¢ƒéƒ¨å˜é‡ vue-cli ä¹Ÿä¾èµ–å®ƒ</li></ul><h3 id="GraphQL"><a href="#GraphQL" class="headerlink" title="GraphQL"></a>GraphQL</h3><ul><li><a href="https://www.prisma.io/docs/" target="_blank" rel="noopener">prisma</a> - è®©å‰ç«¯ä¹Ÿèƒ½å¿«é€Ÿçš„å†™å‡º</li><li><a href="https://www.apollographql.com/" target="_blank" rel="noopener">Apollo GraphQL</a> - æ˜¯åŸºäº GraphQL çš„å…¨æ ˆè§£å†³æ–¹æ¡ˆé›†åˆã€‚ä»åç«¯åˆ°å‰ç«¯æä¾›äº†å¯¹åº”çš„ lib ä½¿å¾—å¼€å‘ä½¿ç”¨ GraphQL æ›´åŠ çš„æ–¹ä¾¿</li></ul><h3 id="æœ‰è¶£"><a href="#æœ‰è¶£" class="headerlink" title="æœ‰è¶£"></a>æœ‰è¶£</h3><ul><li><a href="https://github.com/hendricius/the-bread-code" target="_blank" rel="noopener">the-bread-code</a> - ä½¿ç”¨ç¨‹åºå‘˜çš„æ€ç»´åˆ¶ä½œé¢åŒ… ï¼Œæ¯”å¦‚åˆ¶ä½œä¸­ä½¿ç”¨ A/B test,<br>æ¥æ¯”è¾ƒé‚£ç§åšæ³•æ›´å¥½ã€‚</li><li><a href="https://github.com/danistefanovic/build-your-own-x" target="_blank" rel="noopener">build-your-own-x</a> - æ•™ä½ ç”¨å„ç§è¯­è¨€å®ç° Bot Database Neural Network</li><li><a href="https://github.com/trekhleb/javascript-algorithms" target="_blank" rel="noopener">javascript-algorithms </a> - æ•™ä½ ç”¨å‰ç«¯çŸ¥è¯†è®¤è¯†å„ç§ç®—æ³•</li><li><a href="https://github.com/kleampa/not-paid" target="_blank" rel="noopener">not-paid</a> - å¦‚æœä½ ç»™äººåšç½‘ç«™ï¼Œäº¤è¿‡å»ä»¥åå¯¹æ–¹æ²¡æœ‰ä»˜æ¬¾ï¼Œé‚£ä¹ˆè¿™ä¸ª JS ä¼šæŠŠç½‘ç«™çš„é€æ˜åº¦ä¸€å¤©è°ƒä½ä¸€ç‚¹ï¼Œç›´åˆ°çœ‹ä¸è§</li><li><a href="https://github.com/infinitered/nsfwjs" target="_blank" rel="noopener">nsfwjs</a> - å‰ç«¯å›¾ç‰‡é‰´é»„ï¼ŒåŸºäº Tensorflow</li><li><a href="https://github.com/tholman/elevator.js" target="_blank" rel="noopener">elevator.js</a> æˆ‘å¾ˆå–œæ¬¢çš„ä¸€ä¸ªåº“ï¼Œè®©ä¸€ä¸ª back-to-top çš„æ•ˆæœæœ‰äº†ä¸€ç§åå¤å¤ç”µæ¢¯çš„æ„Ÿè§‰</li><li><a href="https://github.com/florinpop17/app-ideas" target="_blank" rel="noopener">app-ideas</a> å¾ˆå¤šå¹´è½»äººè‹¦äºç¼ºå°‘ç»ƒæ‰‹çš„é¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®æ”¶é›†äº†ä¸å°‘ç‚¹å­ï¼Œæ¯ä¸ªç‚¹å­éƒ½æœ‰æ˜ç¡®çš„ç›®æ ‡å’Œå¤æ‚èµ„æºã€‚</li><li><a href="https://github.com/PavelDoGreat/WebGL-Fluid-Simulation" target="_blank" rel="noopener">WebGL-Fluid-Simulation</a> å¾ˆé…·çš„ WebGL äº¤äº’</li></ul><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><ul><li><a href="https://github.com/high-speed-downloader/high-speed-downloader" target="_blank" rel="noopener">high-speed-downloader</a> - ç™¾åº¦ç½‘ç›˜ä¸é™é€Ÿä¸‹è½½ æ”¯æŒ Windows å’Œ Mac</li><li><a href="https://github.com/zeit/hyper" target="_blank" rel="noopener">hyper</a> - å‰ç«¯å‘½ä»¤è¡Œ</li><li><a href="https://github.com/ymfe/yapi" target="_blank" rel="noopener">yapi</a> - æ˜¯ä¸€ä¸ªå¯æœ¬åœ°éƒ¨ç½²çš„ã€æ‰“é€šå‰åç«¯åŠ QA çš„ã€å¯è§†åŒ–çš„æ¥å£ç®¡ç†å¹³å°</li><li><a href="https://sway.com/" target="_blank" rel="noopener">sway</a> - ä¸€ä¸ªå¾®è½¯è‡ªå·±å‡ºçš„åœ¨çº¿ ppt å¾ˆå¼ºå¤§</li><li><a href="http://bigjpg.com/" target="_blank" rel="noopener">bigjpg</a> - æ”¾å¤§å›¾ç‰‡çš„ç¥å™¨ é€šè¿‡ç¥ç»ç½‘ç»œå¯ä»¥æ”¾å¤§å›¾ç‰‡å¹¶èƒ½é™å™ª</li><li><a href="https://asciiartgen.now.sh" target="_blank" rel="noopener">Ascii Art Generator</a> - åœ¨çº¿ç”Ÿæˆ Ascii å›¾æ¡ˆ</li><li><a href="https://github.com/GetStream/Winds" target="_blank" rel="noopener">Winds</a> - å¼€æº RSS</li><li><a href="https://github.com/kitze/JSUI" target="_blank" rel="noopener">JSUI</a> - ä¸€ä¸ªç”¨æ¥æ§åˆ¶ç®¡ç†å‰ç«¯é¡¹ç›®çš„å®¢æˆ·ç«¯</li><li><a href="https://github.com/pedronauck/docz" target="_blank" rel="noopener">docz</a> - è®©ä½ èƒ½å¿«é€Ÿå†™æ–‡æ¡£çš„ä¸€ä¸ªåº“</li><li><a href="https://github.com/pod4g/hiper" target="_blank" rel="noopener">hiper</a> - æ€§èƒ½ç»Ÿè®¡åˆ†æå·¥å…·</li><li><a href="https://github.com/verdaccio/verdaccio" target="_blank" rel="noopener">verdaccio</a> - ç§æœ‰ npm</li><li><a href="http://rogerdudler.github.io/git-guide/index.zh.html" target="_blank" rel="noopener">git-guide</a> - git å…¥é—¨æŒ‡å—</li><li><a href="https://github.com/521xueweihan/git-tips" target="_blank" rel="noopener">git-tips</a> - git è¿›é˜¶</li><li><a href="https://github.com/teambit/bit" target="_blank" rel="noopener">bit</a> - å®ç°äº†é¡¹ç›®ä¹‹é—´çš„ä»£ç å…±äº« å¯ä»¥è‡ªå»ºç§æœ‰</li><li><a href="https://github.com/Kenshin/simpread" target="_blank" rel="noopener">simpread</a> - ç®€æ‚¦ ( SimpRead ) è®©ä½ ç¬é—´è¿›å…¥æ²‰æµ¸å¼é˜…è¯»çš„æ‰©å±•</li><li><a href="https://github.com/FiloSottile/mkcert" target="_blank" rel="noopener">mkcert</a> - ä¸€é”®å‘½ä»¤ è®©æœ¬åœ°ä¹Ÿæ”¯æŒ https</li><li><a href="https://github.com/nbedos/termtosvg" target="_blank" rel="noopener">termtosvg</a> - å½•åˆ¶ å‘½ä»¤æ“ä½œè½¬æˆ svg åŸºäº python</li><li><a href="https://github.com/apex/gh-polls" target="_blank" rel="noopener">gh-polls</a> - å¯ä»¥åœ¨ github issue ä¸­æ·»åŠ æŠ•ç¥¨</li><li><a href="https://github.com/liriliri/eruda" target="_blank" rel="noopener">eruda</a> - ç§»åŠ¨ç«¯è°ƒè¯•å·¥å…·</li><li><a href="https://github.com/Tencent/vConsole" target="_blank" rel="noopener">vConsole</a> - ä¹Ÿæ˜¯ä¸€ä¸ªç§»åŠ¨ç«¯è°ƒè¯•å·¥å…· è…¾è®¯å‡ºå“</li><li><a href="https://github.com/faressoft/terminalizer" target="_blank" rel="noopener">terminalizer</a> - å‘½ä»¤è¡Œå½•åˆ¶å·¥å…· åŸºäº node</li><li><a href="https://github.com/amio/badgen-service" target="_blank" rel="noopener">badgen</a> - å¿«é€Ÿæ„å»ºå’Œ shields ä¸€æ ·çš„ svg badge ä½†é€Ÿåº¦æ›´å¿«</li><li><a href="https://github.com/luin/readability" target="_blank" rel="noopener">readability</a> - ç§»é™¤é¡µé¢éæ­£æ–‡éƒ¨åˆ† åŸºäº jsdom</li><li><a href="https://github.com/TKkk-iOSer/WeChatPlugin-MacOS" target="_blank" rel="noopener">WeChatPlugin-MacOS</a> - ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ macOS ç‰ˆå¾®ä¿¡å°åŠ©æ‰‹</li><li><a href="https://github.com/checkly/puppeteer-recorder" target="_blank" rel="noopener">puppeteer-recorder</a> - ä¸€ä¸ª chrome æ’ä»¶ èƒ½å¤Ÿæ ¹æ®ä½ çš„æ“ä½œ è‡ªåŠ¨ç”Ÿæˆ puppeteer ç›¸å…³ä»£ç </li><li><a href="https://github.com/jxnblk/mdx-deck" target="_blank" rel="noopener">mdx-deck</a> - ç”¨ markdown ç¼–å†™æ¼”ç¤ºæ–‡ç¨¿</li><li><a href="https://github.com/pomber/code-surfer" target="_blank" rel="noopener">code-surfer</a> - åŸºäº mdx-deck çš„ä¸€ä¸ªæ’ä»¶<br>è®©ä½ æ›´å¥½çš„åœ¨æ–‡ç¨¿ä¸­å±•ç¤º code</li><li><a href="https://progressivetooling.com/" target="_blank" rel="noopener">Progressive Tooling</a> - å‰ç«¯æ€§èƒ½ä¼˜åŒ–å·¥å…·é›†åˆ</li><li><a href="https://github.com/artf/grapesjs" target="_blank" rel="noopener">https://github.com/artf/grapesjs</a> - å¯è§†åŒ–å»ºç«™å·¥å…· ä¸éœ€è¦å†™ä»£ç å°±èƒ½å†™ä¸€ä¸ªé¡µé¢ï¼Œå‰ç«¯å†æ¬¡å†æ¬¡è¦ä¸‹å²—äº†</li><li><a href="https://www.image-charts.com/" target="_blank" rel="noopener">image-charts</a> - è¯¥æœåŠ¡é€šè¿‡ URL æ¥å—å‚æ•°ï¼Œç„¶åç”Ÿæˆå›¾è¡¨ï¼Œä»¥å›¾ç‰‡å½¢å¼è¿”å›</li><li><a href="https://github.com/Zulko/eagle.js" target="_blank" rel="noopener">eagle.js</a> - ä¸€ä¸ªç”¨ vue æ¥åˆ¶ä½œ PPT çš„åº“</li><li><a href="https://www.optimizely.com/" target="_blank" rel="noopener">Optimizely</a> - A/B Test</li><li><a href="http://www.appadhoc.com/" target="_blank" rel="noopener">appadhoc</a> - ä¸€ä¸ªå›½å†…çš„ A/B Test æœåŠ¡</li><li><a href="https://github.com/glorious-codes/glorious-demo" target="_blank" rel="noopener">glorious-demo</a> - é€šè¿‡ç¼–å†™ä»£ç çš„æ–¹å¼æ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œçš„æ¼”ç¤ºä¾‹å­</li><li><a href="https://github.com/valentinxxx/nginxconfig.io/" target="_blank" rel="noopener">nginxconfig</a> - å¯è§†åŒ–é…ç½® nginx æä¾›äº†å¤šä¸ªåŸºç¡€æ¨¡æ¿</li><li><a href="https://bundlephobia.com/" target="_blank" rel="noopener">bundlephobia</a> - ä¸€ä¸ªå¯ä»¥æŸ¥çœ‹æŸä¸ªåº“çš„å¤§å°ï¼Œå¹¶ä¸”åˆ†æå®ƒçš„ä¾èµ–</li><li><a href="https://jsperf.com/popular" target="_blank" rel="noopener">jsperf</a> - ä¸€ä¸ªæä¾›åœ¨çº¿ test case çš„ç½‘ç«™ï¼Œä¸»è¦ç”¨æ¥æ¯”è¾ƒæ€§èƒ½ã€‚å¯ä»¥æ¯”è¾ƒå¦‚ï¼š forEach vs for çš„æ€§èƒ½</li><li><a href="https://github.com/lukejacksonn/perflink" target="_blank" rel="noopener">perflink</a> ä¸ jsperf ç±»ä¼¼çš„ä¸€ä¸ªæ¯”è¾ƒ js æ€§èƒ½çš„ç½‘ç«™</li><li><a href="https://github.com/algorithm-visualizer/algorithm-visualizer" target="_blank" rel="noopener">algorithm-visualizer</a> - ç®—æ³•ä»£ç å¯è§†åŒ–</li><li><a href="https://github.com/yujiangshui/An-English-Guide-for-Programmers" target="_blank" rel="noopener">An-English-Guide-for-Programmers</a> - ä¸“ä¸ºç¨‹åºå‘˜ç¼–å†™çš„è‹±è¯­å­¦ä¹ æŒ‡å—</li><li><a href="https://webhint.io/" target="_blank" rel="noopener">Webhint</a> - ç”¨äºæ£€æŸ¥ä»£ç çš„å¯è®¿é—®æ€§ã€æ€§èƒ½å’Œå®‰å…¨çš„å¼€æºæ£€æŸ¥ï¼ˆLintingï¼‰å·¥å…·</li><li><a href="https://github.com/airtap/airtap" target="_blank" rel="noopener">airtap</a> - æµ‹è¯•æµè§ˆå™¨å…¼å®¹æ€§ï¼Œå¯è¦†ç›– 800 å¤šç§æµè§ˆå™¨</li><li><a href="https://github.com/bluzi/jsonstore" target="_blank" rel="noopener">jsonstore</a> - ä¾›å…è´¹ï¼Œå®‰å…¨ä¸”åŸºäº JSON çš„äº‘æ•°æ®å­˜å‚¨ï¼Œè‡ªå·±ç©çš„å°é¡¹ç›®ç¥å™¨</li><li><a href="https://github.com/pomber/git-history" target="_blank" rel="noopener">git-history</a> - å¯è§†åŒ–æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„å†å²å˜åŒ–</li><li><a href="https://github.com/myliang/x-spreadsheet" target="_blank" rel="noopener">x-spreadsheet</a> ä¸€ä¸ªåŸºäº Canvas çš„ JS ç”µå­è¡¨æ ¼åº“ excel</li><li><a href="https://imgcook.taobao.org/" target="_blank" rel="noopener">imgcook</a> é˜¿é‡Œå‡ºå“ï¼Œä¸€é”®é€šè¿‡è®¾è®¡ç¨¿ç”Ÿæˆä»£ç </li><li><a href="https://github.com/Raathigesh/majestic" target="_blank" rel="noopener">majestic</a> jest å¯è§†åŒ–</li><li><a href="https://github.com/leon-ai/leon" target="_blank" rel="noopener">leon</a> ä½ å¼€æºé¡¹ç›®çš„ ai ä¸ªäººåŠ©æ‰‹</li><li><a href="https://github.com/Bogdan-Lyashenko/js-code-to-svg-flowchart" target="_blank" rel="noopener">js-code-to-svg-flowchart</a> å°†ä»£ç é€»è¾‘ç”¨æµç¨‹å›¾çš„æ–¹å¼å±•ç°å‡ºæ¥</li><li><a href="https://github.com/xtermjs/xterm.js" target="_blank" rel="noopener">xterm.js</a> ä¸€ä¸ª web terminal</li><li><a href="https://github.com/mapbox/pixelmatch" target="_blank" rel="noopener">pixelmatch</a> diff ä¸¤å¼ å›¾ç‰‡ä¸ä¸€æ ·çš„åœ°æ–¹</li><li><a href="https://github.com/kefranabg/readme-md-generator" target="_blank" rel="noopener">readme-md-generator</a> ä¸€ä¸ªå‘½ä»¤è¡Œè„šæœ¬å¸®ä½ å¿«é€Ÿçš„åˆ›å»ºä¸€ä¸ª README</li></ul><h3 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h3><ul><li><a href="https://github.com/nuxt/webpackbar" target="_blank" rel="noopener">webpackbar</a> webpack æ‰“åŒ…è¿›åº¦å¯è§†åŒ–</li><li><a href="https://github.com/zouhir/jarvis" target="_blank" rel="noopener">jarvis</a> webpack dashboard</li><li><a href="https://github.com/neutrinojs/webpack-chain" target="_blank" rel="noopener">webpack-chain</a> é€šè¿‡ chain é£æ ¼ api çš„æ–¹å¼ä¿®æ”¹ webpack é…ç½®</li><li><a href="https://github.com/stephencookdev/speed-measure-webpack-plugin" target="_blank" rel="noopener">speed-measure-webpack-plugin</a> æ¢æµ‹ webpack å„é˜¶æ®µçš„è€—æ—¶</li><li><a href="https://github.com/ElemeFE/obsolete-webpack-plugin" target="_blank" rel="noopener">obsolete-webpack-plugin</a> åŸºäº browserslist åšæµè§ˆå™¨å‡çº§æç¤º</li><li><a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a> æå– CSS ä¸ºå•ç‹¬æ–‡ä»¶</li><li><a href="https://github.com/webpack-contrib/copy-webpack-plugin" target="_blank" rel="noopener">copy-webpack-plugin</a> å¤åˆ¶é¢å¤–çš„æ–‡ä»¶åˆ°è¾“å‡ºç›®å½•</li><li><a href="https://github.com/darrenscerri/duplicate-package-checker-webpack-plugin" target="_blank" rel="noopener">duplicate-package-checker-webpack-plugin</a> æ£€æŸ¥æ˜¯å¦å­˜åœ¨é‡å¤ä¾èµ–</li></ul><h3 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h3><ul><li><a href="https://itunes.apple.com/cn/app/get-plain-text/" target="_blank" rel="noopener">get-plain-text</a> - èƒ½æ¸…é™¤å‰ªè´´æ¿é‡Œçš„æ ¼å¼ å¾ˆå®ç”¨</li><li><a href="https://github.com/lhc70000/iina" target="_blank" rel="noopener">IINA</a> - mac å¹³å°æ„Ÿè§‰å…è´¹æœ€å¥½çš„æ’­æ”¾å™¨ å¼ºæ¨</li><li><a href="https://itunes.apple.com/cn/app/magnet/id441258766?mt=12&ign-mpt=uo%3D4" target="_blank" rel="noopener">magnet</a> - åˆ†å±ç®¡ç†</li><li><a href="https://zh.xnipapp.com/" target="_blank" rel="noopener">Xnip</a> - æ–¹ä¾¿å¥½ç”¨çš„æˆªå›¾å·¥å…·-æ”¯æŒæˆªé•¿å›¾</li><li><a href="https://www.spectacleapp.com/" target="_blank" rel="noopener">Spectacle</a> - çª—å£ç®¡ç†å·¥å…·</li><li><a href="https://matthewpalmer.net/vanilla/" target="_blank" rel="noopener">vanilla</a> - é¡¶æ å›¾æ ‡ç®¡ç†å·¥å…·</li><li><a href="https://github.com/Mortennn/Dozer" target="_blank" rel="noopener">Dozer</a> - ä¸€ä¸ªå¼€æºçš„é¡¶æ ç®¡ç†</li><li><a href="https://mac.guanjia.qq.com/index_o.html" target="_blank" rel="noopener">è…¾è®¯ç”µè„‘ç®¡å®¶</a> - åæ­£æˆ‘ç”¨ä¸‹æ¥å¥½è§‰å¾—è›®å¥½ç”¨çš„</li><li><a href="https://mos.caldis.me/" target="_blank" rel="noopener">mos</a> - é¼ æ ‡å¹³æ»‘æ»šåŠ¨è½¯ä»¶ï¼Œå¾ˆå¥½ç”¨ã€‚å…è´¹å¼€æº</li><li><a href="https://www.sequelpro.com/" target="_blank" rel="noopener">sequel pro</a> - mysql å®¢æˆ·ç«¯ å¥½ç”¨</li><li><a href="https://itunes.apple.com/us/app/microsoft-remote-desktop/id715768417?mt=12#" target="_blank" rel="noopener">Microsoft Remote Desktop Beta</a> - Mac è¿œç¨‹ç™»å½• Windows è°ƒè¯•ç¥å™¨</li><li><a href="http://paper.meiyuan.in/" target="_blank" rel="noopener">pap.er</a> - ä¸“ä¸º Mac è®¾è®¡çš„å£çº¸åº”ç”¨</li><li><a href="https://theunarchiver.com/" target="_blank" rel="noopener">The Unarchive</a> - Mac ç›®å‰æ„Ÿè§‰æœ€å¥½ç”¨çš„å…è´¹è§£å‹è½¯ä»¶</li><li><a href="https://github.com/yingDev/Tickeys" target="_blank" rel="noopener">Tickeys</a> - è®©ä½ ç”¨ Mac é”®ç›˜ä¹Ÿèƒ½æ‰“å‡ºæœºæ¢°é”®ç›˜çš„æ„Ÿè§‰</li><li><a href="https://github.com/beakerbrowser/beaker" target="_blank" rel="noopener">Beaker Browser</a> - P2P å¼€æºæµè§ˆå™¨ æ”¯æŒç‚¹å¯¹ç‚¹å‘å¸ƒæ–‡ä»¶ï¼Œæˆä¸ºäº†æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œæ”¯æŒ DAT å¯¹ç­‰åè®®</li><li><a href="https://github.com/sindresorhus/gifski-app" target="_blank" rel="noopener">Gifski</a> - è§†é¢‘è½¬ gif å·¥å…·</li><li><a href="https://github.com/serhii-londar/open-source-mac-os-apps" target="_blank" rel="noopener">more</a> - æ›´å¤šä¼˜ç§€çš„ mac app ä»‹ç»</li><li><a href="https://github.com/agalwood/Motrix" target="_blank" rel="noopener">Motrix</a> - æ”¯æŒ HTTPã€FTPã€BTã€ç£åŠ›é“¾ã€ç™¾åº¦ç½‘ç›˜çš„ä¸‹è½½å·¥å…·</li></ul><h3 id="Chrome-æ‹“å±•"><a href="#Chrome-æ‹“å±•" class="headerlink" title="Chrome æ‹“å±•"></a>Chrome æ‹“å±•</h3><ul><li><a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" target="_blank" rel="noopener">Tampermonkey</a> æ²¹çŒ´ ç¥å™¨</li><li><a href="https://chrome.google.com/webstore/detail/extension-manager/gjldcdngmdknpinoemndlidpcabkggco/related?utm_source=chrome-ntp-icon" target="_blank" rel="noopener">æ‰©å±•ç®¡ç†å™¨</a> è½»æ¾ç®¡ç†æ‰©å±•ï¼Œå°±ä¸ç”¨æ‹…å¿ƒå®‰è£…å¤ªå¤šæ‰©å±•äº†</li><li><a href="https://github.com/GoogleChromeLabs/ProjectVisBug" target="_blank" rel="noopener">visbug</a> å®ƒå¯ä»¥å¸®åŠ©ä½ æ”¹å˜ cssï¼Œç§»åŠ¨å…ƒç´ ç­‰ç­‰ä¸€ç³»ç±»å¼ºå¤§çš„åŠŸèƒ½,é¡µé¢è°ƒè¯•ç¥å™¨ã€‚å½“ç„¶æœ‰äº›æ—¶å€™è¿˜æ˜¯ DevTools æ›´å¥½ç”¨</li><li><a href="https://github.com/sindresorhus/refined-github" target="_blank" rel="noopener">refined-github</a> ä¼˜åŒ– github é»˜è®¤åŠŸèƒ½å’Œæ ·å¼çš„ chrome æ’ä»¶</li><li><a href="https://chrome.google.com/webstore/detail/adb/dpngiggdglpdnjdoaefidgiigpemgage" target="_blank" rel="noopener">ADB</a> chrome çœŸæœºè°ƒè¯•å®‰å“ç¥å™¨</li><li><a href="https://chrome.google.com/webstore/detail/adblock-plus-free-ad-bloc/cfhdojbkjhnklbpkdaibdccddilifddb" target="_blank" rel="noopener">Adblock Plus</a><br>å…è´¹å¹¿å‘Šæ‹¦æˆªç¨‹åº è¿™ä¸ªåº”è¯¥ä¸ç”¨è¯´äº†ï¼Œè£…æœºå¿…å¤‡</li><li><a href="https://chrome.google.com/webstore/detail/axure-rp-extension-for-ch/dogkpdfcklifaemcdfbildhcofnopogp" target="_blank" rel="noopener">Axure RP Extension</a> çœ‹åŸå‹å¿…å¤‡</li><li><a href="https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa" target="_blank" rel="noopener">JSON Formatter</a> JSON æ ¼å¼åŒ– ç¨‹åºå‘˜å¿…å¤‡</li><li><a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk" target="_blank" rel="noopener">Lighthouse</a> è°·æ­Œå‡ºå“ï¼Œæ£€æŸ¥ç½‘é¡µç»¼åˆæ€§èƒ½è¯„åˆ†ï¼Œåˆ†æä¸è¶³</li><li><a href="https://chrome.google.com/webstore/detail/%E4%BA%8C%E7%BB%B4%E7%A0%81qr%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8qr-code-generato/pflgjjogbmmcmfhfcnlohagkablhbpmg" target="_blank" rel="noopener">äºŒç»´ç (QR ç )ç”Ÿæˆå™¨</a> æ‰‹æœºæ‰«ç ç¥å™¨</li><li><a href="https://chrome.google.com/webstore/detail/octotree/bkhaagjahfmjljalopjnoealnfndnagc" target="_blank" rel="noopener">Octotree</a> github ä¸Šçœ‹ä»£ç å¿…å¤‡ç¥å™¨</li><li><a href="https://chrome.google.com/webstore/detail/octolinker/jlmafbaeoofdegohdhinkhilhclaklkp" target="_blank" rel="noopener">OctoLinker</a> èƒ½åœ¨ github ä¸Šçœ‹ä»£ç çš„æ—¶å€™ å¿«é€Ÿé“¾æ¥è·³è½¬åˆ°ä¾èµ–çš„åº“</li><li><a href="https://chrome.google.com/webstore/detail/the-great-suspender/klbibkeccnjlkjkiokjodocebajanakg" target="_blank" rel="noopener">The Great Suspender</a> chrome å¤ªåƒå†…å­˜äº†ï¼Œå½“é¡µé¢å¼€çš„å¾ˆå¤šæ—¶å€™ä¼šå¾ˆå¡ï¼Œå®ƒå°±å®Œç¾çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒå°†å‡ åˆ†é’Ÿæ²¡æµè§ˆè¿‡çš„é¡µé¢éƒ½æŒ‚è½½äº†ï¼Œå½“ä½ æƒ³çœ‹æ˜¯å†é‡æ–°åŠ è½½</li><li><a href="https://chrome.google.com/webstore/detail/web%E5%89%8D%E7%AB%AF%E5%8A%A9%E6%89%8Bfehelper/pkgccpejnmalmdinmhkkfafefagiiiad" target="_blank" rel="noopener">WEB å‰ç«¯åŠ©æ‰‹</a> æ”¯æŒ JSON æ ¼å¼åŒ–ã€äºŒç»´ç ç”Ÿæˆä¸è§£ç ã€ä»£ç å‹ç¼©ã€Markdown ä¸ HTML äº’è½¬ã€ç½‘é¡µæ»šåŠ¨æˆªå±ã€æ­£åˆ™è¡¨è¾¾å¼ã€æ—¶é—´è½¬æ¢å·¥å…·ã€JSON æ¯”å¯¹å·¥å…·ç­‰</li><li><a href="https://chrome.google.com/webstore/detail/%E6%8E%98%E9%87%91/lecdifefmmfjnjjinhaennhdlmcaeeeb" target="_blank" rel="noopener">æ˜é‡‘</a> ç›®å‰æˆ‘é»˜è®¤æ–°å¼€ tab çš„é»˜è®¤é¡µï¼Œå¯ä»¥åˆ·åˆ·æ–°çš„æ–‡ç« æˆ–è€…é¡¹ç›®ï¼Œè¿˜ä¸é”™ã€‚</li><li><a href="https://chrome.google.com/webstore/detail/%E6%B2%99%E6%8B%89%E6%9F%A5%E8%AF%8D-%E8%81%9A%E5%90%88%E8%AF%8D%E5%85%B8%E5%88%92%E8%AF%8D%E7%BF%BB%E8%AF%91/cdonnmffkdaoajfknoeeecmchibpmkmg" target="_blank" rel="noopener">æ²™æ‹‰æŸ¥è¯</a> åˆ’è¯ç¿»è¯‘æ’ä»¶</li><li><a href="https://github.com/npmhub/npmhub" target="_blank" rel="noopener">npmhub</a>åœ¨ README ä¸‹æ–¹æ˜¾ç¤º npm ä¾èµ–ä¿¡æ¯</li></ul><h3 id="VS-Code"><a href="#VS-Code" class="headerlink" title="VS Code"></a>VS Code</h3><ul><li><a href="https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost" target="_blank" rel="noopener">Import Cost</a> æŸ¥çœ‹ä½ å¼•å…¥çš„ä¾èµ–æ¨¡å—å¤§å°</li><li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-close-tag" target="_blank" rel="noopener">Auto Close Tag</a> è‡ªåŠ¨è¡¥å…¨ html æ ‡ç­¾ï¼Œå¦‚è¾“å…¥<code>&lt;a&gt;</code>å°†è‡ªåŠ¨è¡¥å…¨<code>&lt;/a&gt;</code></li><li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-rename-tag" target="_blank" rel="noopener">Auto Rename Tag</a> è‡ªåŠ¨é‡å‘½å html æ ‡ç­¾ï¼Œå¦‚ä¿®æ”¹<code>&lt;a&gt;ä¸º&lt;b&gt;</code>ï¼Œå°†è‡ªåŠ¨ä¿®æ”¹ç»“å°¾æ ‡ç­¾<code>&lt;/a&gt;ä¸º&lt;/b&gt;</code></li><li><a href="https://github.com/octref/polacode" target="_blank" rel="noopener">polacode</a> ç”Ÿäº§ä»£ç å›¾ç‰‡å¿«ç…§æ’ä»¶</li><li><a href="https://github.com/jdneo/vscode-leetcode" target="_blank" rel="noopener">vscode-leetcode</a> - ä¸€ä¸ªèƒ½è®©ä½ åœ¨ vscode ä¸­åˆ· LeetCode çš„æ’ä»¶ ç®—ä¸€ä¸ªåˆ’æ°´ç¥å™¨å§</li><li><a href="https://marketplace.visualstudio.com/items?itemName=robertohuertasm.vscode-icons" target="_blank" rel="noopener">vscode-icons</a> VS Code å¿…å¤‡å§ï¼Œä¸ºæ–‡ä»¶æ·»åŠ ç‚«å›¾æ ‡</li></ul><h3 id="å·¥ç¨‹"><a href="#å·¥ç¨‹" class="headerlink" title="å·¥ç¨‹"></a>å·¥ç¨‹</h3><ul><li><a href="https://github.com/lerna/lerna" target="_blank" rel="noopener">lerna</a> - monorepo ç®¡ç†ã€‚</li><li><a href="https://github.com/lerna/lerna-changelog" target="_blank" rel="noopener">lerna-changelog</a> - ä¸º lerna é¡¹ç›®è‡ªåŠ¨ç”Ÿæˆ changelogã€‚</li><li><a href="https://github.com/eslint/eslint" target="_blank" rel="noopener">eslint</a> - JS é£æ ¼çº¦æŸã€‚</li><li><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">eslint-config-airbnb</a></li><li><a href="https://github.com/xojs/xo" target="_blank" rel="noopener">xo</a> - å°è£…è‡ª eslintã€‚</li><li><a href="https://github.com/prettier/prettier" target="_blank" rel="noopener">prettier</a> - æ›´ä¸»è§‚çš„é£æ ¼è‡ªåŠ¨ä¿®æ”¹ã€‚</li><li><a href="https://github.com/yeoman/generator" target="_blank" rel="noopener">yeoman-generator</a> - è„šæ‰‹æ¶å·¥å…·ã€‚</li><li><a href="https://github.com/zeit/serve" target="_blank" rel="noopener">serve</a> - æœ¬åœ°é™æ€æœåŠ¡å™¨ã€‚</li><li><a href="https://github.com/sindresorhus/np" target="_blank" rel="noopener">np</a> - npm publish è¾…åŠ©ï¼Œè‡ªåŠ¨ pushã€æ‰“ tagã€å‡ç‰ˆæœ¬ç­‰ã€‚</li><li><a href="https://github.com/okonet/lint-staged" target="_blank" rel="noopener">lint-staged</a> - eslint æé€Ÿï¼Œåª lint æäº¤çš„ä»£ç ã€‚</li><li><a href="https://github.com/marketplace/coveralls" target="_blank" rel="noopener">coveralls</a> - è¦†ç›–ç‡ã€‚</li><li><a href="https://github.com/typicode/husky" target="_blank" rel="noopener">husky</a> - æ·»åŠ  git hooksã€‚</li><li><a href="https://github.com/kentcdodds/cross-env" target="_blank" rel="noopener">cross-env</a> - è·¨å¹³å°çš„ç¯å¢ƒå˜é‡å£°æ˜ã€‚</li><li><a href="https://github.com/popomore/projj" target="_blank" rel="noopener">projj</a> - æœ¬åœ° git é¡¹ç›®ç®¡ç†ï¼Œæ”¯æŒ github å’Œ gitlabã€‚</li><li><a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">nvm</a> - ç®¡ç† node ç‰ˆæœ¬ã€‚</li><li><a href="https://github.com/kimmobrunfeldt/concurrently" target="_blank" rel="noopener">concurrently</a> -åœ¨ npm scripts é‡Œå¹¶è¡Œæ‰§è¡Œå‘½ä»¤ã€‚</li><li><a href="https://github.com/zeit/ncc" target="_blank" rel="noopener">@zeit/ncc</a> - æ‰“åŒ…ä¸º npm åŒ…ä¸ºä¸€ä¸ªæ–‡ä»¶ã€‚</li><li><a href="https://github.com/dylang/npm-check" target="_blank" rel="noopener">npm-check</a> - æ£€æµ‹ä¾èµ–å‡çº§æƒ…å†µï¼Œæˆ‘ä¼šå’Œ <code>yarn upgrade-interactive</code> é…åˆç€ç”¨ï¼Œä¸»è¦ç”¨æ¥æ£€æµ‹å†—ä½™ä¾èµ–ã€‚</li><li><a href="https://github.com/mysticatea/cpx" target="_blank" rel="noopener">cpx</a> - å¤åˆ¶ï¼Œæ”¯æŒ globï¼Œå¹¶ä¸”å¯ä»¥ watchã€‚</li><li><a href="https://github.com/Qard/onchange" target="_blank" rel="noopener">onchange</a> - ç›‘å¬æ–‡ä»¶å˜åŠ¨ç„¶ååšä¸€äº›äº‹ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®ç”¨åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç«™å¤§å…¨</title>
      <link href="/2019/03/16/tools/page/"/>
      <url>/2019/03/16/tools/page/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ç½‘ç«™å¤§å…¨</strong></p><p>[[toc]]</p><h3 id="ç½‘ç«™"><a href="#ç½‘ç«™" class="headerlink" title="ç½‘ç«™"></a>ç½‘ç«™</h3><h3 id="å¸¸çœ‹çš„ç½‘ç«™"><a href="#å¸¸çœ‹çš„ç½‘ç«™" class="headerlink" title="å¸¸çœ‹çš„ç½‘ç«™"></a>å¸¸çœ‹çš„ç½‘ç«™</h3><ul><li><a href="https://github.com/sorrycc/awesome-f2e-libs" target="_blank" rel="noopener">awesome-f2e-libs</a> sorrycc æ•´ç†çš„ä¸ªäººå…³æ³¨ä½¿ç”¨çš„å‰ç«¯åº“</li><li><a href="https://overreacted.io/" target="_blank" rel="noopener">overreacted</a> react Dan çš„ä¸ªäººåšå®¢ï¼Œæ›´æ–°é¢‘ç‡å¾ˆé«˜</li><li><a href="https://medium.com/dailyjs" target="_blank" rel="noopener">DailyJS</a></li><li><a href="https://codeburst.io/" target="_blank" rel="noopener">codeburst</a></li></ul><h3 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h3><ul><li><a href="https://git.io" target="_blank" rel="noopener">github çŸ­åŸŸåæœåŠ¡</a></li><li><a href="https://shields.io/" target="_blank" rel="noopener">shields</a> Github README é‡Œé¢çš„è£…é€¼å°å›¾æ ‡</li><li><a href="https://www.webpagefx.com/tools/emoji-cheat-sheet/" target="_blank" rel="noopener">Emoji</a> æ–¹ä¾¿å¹³æ—¶å†™æŸ¥æ‰¾ emoji</li><li><a href="http://emoji.muan.co/#" target="_blank" rel="noopener">emoji.muan</a> åŒä¸Š è€Œä¸”æ›´å…¨</li><li><a href="http://git-awards.com/users/search?login=panjiachen" target="_blank" rel="noopener">git-awards</a> github ranking æ²¡äº‹å¯ä»¥æŸ¥ç€ç©ç©</li><li><a href="http://githubrank.com/" target="_blank" rel="noopener">http://githubrank.com/</a> github æŒ‰ç…§ followers æ’å</li><li><a href="https://wangchujiang.com/github-rank/" target="_blank" rel="noopener">github-rank</a>åŒä¸Šï¼Œgithubrank åŸºæœ¬ç®—æŒ‚äº†å·²ç»ï¼Œåªèƒ½ç”¨è¿™ä¸ªæ–°çš„</li><li><a href="https://www.timqian.com/star-history/#PanJiaChen/vue-element-admin" target="_blank" rel="noopener">star-history</a> å±•ç¤ºä¸€ä¸ªé¡¹ç›® Stars å¢é•¿è§„çŸ©æ›²çº¿</li><li><a href="https://github.com/probot/probot" target="_blank" rel="noopener">probot</a> åŸºäº github åšä¸€ä¸ªå°æœºå™¨äººã€‚å¯ä»¥åšå¾ˆå¤š workflow çš„äº‹æƒ…</li></ul><h3 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h3><ul><li><a href="https://caniuse.com/" target="_blank" rel="noopener">can i use</a> å‰ç«¯å¸¸ç”¨ç½‘ç«™äº† æŸ¥çœ‹ä¸åŒå±æ€§å’Œæ–¹æ³•çš„å…¼å®¹æ€§</li><li><a href="https://squoosh.app/" target="_blank" rel="noopener">Squoosh</a> è°·æ­Œå‡ºå“åœ¨çº¿å…è´¹å›¾ç‰‡å‹ç¼©å·¥å…· ç¥å™¨</li><li><a href="https://github.com/CompuIves/codesandbox-client" target="_blank" rel="noopener">codesandbox-client</a> - åœ¨çº¿ web å¼€å‘å®¹å™¨</li><li><a href="https://github.com/fkling/astexplorer" target="_blank" rel="noopener">astexplorer</a> - ä¸€ä¸ªåœ¨çº¿ ast ç”Ÿæˆå™¨</li><li><a href="https://30secondsofcode.org/" target="_blank" rel="noopener">30 seconds of code</a> æ”¶é›†äº†è®¸å¤šæœ‰ç”¨çš„ä»£ç å°ç‰‡æ®µ</li><li><a href="https://app.zeplin.io/" target="_blank" rel="noopener">zeplin</a> å‰ç«¯å’Œè®¾è®¡å¸ˆç¥å™¨ï¼Œæœ‰æ ‡æ³¨ã€Style Guideã€ç‰ˆæœ¬ç®¡ç†ã€ç®€å•çš„å›¢é˜Ÿåä½œï¼Œé‡ç‚¹æ˜¯å‰ç«¯ä¸ç”¨å†™ css äº†ï¼Œå¤åˆ¶å°±å¯ä»¥äº†ã€‚</li><li><a href="http://www.iconfont.cn/" target="_blank" rel="noopener">iconfont</a> é˜¿é‡Œå‡ºçš„å›¾æ ‡åº“ï¼Œéå¸¸å®ç”¨ï¼Œæ”¯æŒ svgã€fontã€png å¤šç§æ ¼å¼ï¼ŒåŸºæœ¬ç°åœ¨æ‰€æœ‰å›¾æ ‡éƒ½åœ¨ä¸Šé¢æ‰¾ã€‚</li><li><a href="http://cssicon.space/#/" target="_blank" rel="noopener">cssicon</a> æ‰€æœ‰çš„ icon éƒ½æ˜¯çº¯ css ç”»çš„ ç¼ºç‚¹ï¼šicon ä¸å¤Ÿå¤š</li><li><a href="http://zhitu.isux.us/" target="_blank" rel="noopener">æ™ºå›¾</a> è…¾è®¯å‡ºå“ åœ¨çº¿å›¾ç‰‡å‹ç¼© æ”¯æŒè½¬æˆ webP å¤„ç†é™æ€å›¾ç‰‡æ—¶å€™å¾ˆå¥½ç”¨</li><li><a href="https://www.picdiet.com/zh-cn" target="_blank" rel="noopener">picdiet</a> å¦ä¸€ä¸ªå›¾ç‰‡å‹ç¼©ç½‘ç«™</li><li><a href="http://apps.eky.hk/css-triangle-generator/" target="_blank" rel="noopener">CSS triangle generator</a> å¸®ä½ å¿«é€Ÿç”¨ css åšå‡ºä¸‰è§’å½¢</li><li><a href="http://www.cssarrowplease.com/" target="_blank" rel="noopener">cssarrowplease</a> å¸®ä½ åšå¯¹è¯æ¡†ä¸‰è§’çš„</li><li><a href="http://bennettfeely.com/clippy/" target="_blank" rel="noopener">clippy</a> åœ¨çº¿å¸®ä½ ä½¿ç”¨ css clip-path åšå‡ºå„ç§å½¢çŠ¶çš„å›¾å½¢</li><li><a href="https://regex101.com/" target="_blank" rel="noopener">Regular Expressions</a> åœ¨çº¿æ­£åˆ™ç½‘ç«™</li><li><a href="https://jex.im/regulex/" target="_blank" rel="noopener">jex</a> æ­£åˆ™å¯è§†åŒ–ç½‘ç«™ï¼Œé…åˆä¸Šé¢çš„ Regular Expressionsï¼Œå†™æ­£åˆ™æ–¹ä¾¿å¾ˆå¤š</li><li><a href="https://jsfiddle.net/" target="_blank" rel="noopener">jsfiddle</a> åœ¨çº¿è¿è¡Œä»£ç ç½‘ç«™ å¾ˆä¸é”™ï¼Œå¯æƒœè¦ç¿»å¢™</li><li><a href="https://codepan.net/" target="_blank" rel="noopener">codepan</a> åœ¨çº¿è¿è¡Œä»£ç ç½‘ç«™ ä¸ç”¨ç¿»å¢™ï¼Œå¯ä»¥è‡ªå·±éƒ¨ç½²</li><li><a href="https://fiddle.md/" target="_blank" rel="noopener">fiddle.md</a> ä¸€ä¸ªæ–¹ä¾¿çš„åœ¨çº¿å…±äº« markdown åœ¨çº¿ç¬”è¯•é¢˜ä¸€èˆ¬éƒ½ç”¨è¿™ä¸ª</li><li><a href="https://www.jsdelivr.com/" target="_blank" rel="noopener">jsdelivr</a> cdn æœåŠ¡</li><li><a href="https://unpkg.com" target="_blank" rel="noopener">unpkg</a> cdn æœåŠ¡</li><li><a href="https://coderpad.io/" target="_blank" rel="noopener">coderpad</a> è¿œç¨‹é¢è¯•çš„ç¥å™¨ï¼Œå¯ä»¥è®©é¢è¯•è€…è¿œç¨‹å†™ä»£ç  ä¸è¿‡éœ€è¦ç¿»å¢™</li><li><a href="http://www.icode.live/" target="_blank" rel="noopener">icode</a> æœ‰èµå›¢é˜Ÿå‡ºå“çš„ coderpad å¯ä»¥äº’è¡¥ï¼Œå®ƒä¸éœ€è¦ç¿»å¢™</li><li><a href="https://www.codeadvice.io" target="_blank" rel="noopener">codeadvice</a> åˆä¸€ä¸ªè®©é¢è¯•è€…è¿œç¨‹å†™ä»£ç çš„ç½‘å€</li><li><a href="https://snipper.io" target="_blank" rel="noopener">snipper</a> ä¸€ä¸ªä»£ç ååŒçš„ç½‘ç«™ã€‚ä½ æ–°å»ºä¸€ä¸ªä»£ç ç‰‡æ®µï¼Œç„¶åæŠŠç½‘å€åˆ†äº«ç»™å…¶ä»–äººï¼Œå°±å¯ä»¥çœ‹åˆ°ä»–ä»¬çš„å®æ—¶ç¼–è¾‘ã€‚</li><li><a href="https://codesandbox.io/" target="_blank" rel="noopener">codesandbox</a> ä¸€ä¸ªå¯ä»¥åœ¨çº¿ç¼–è¾‘ä¸”æä¾›åœ¨çº¿ demo çš„ç½‘ç«™ æ”¯æŒ vue react angular å¤šç§æ¡†æ¶ ç¥å™¨</li><li><a href="https://tympanus.net/codrops/" target="_blank" rel="noopener">codrops</a> ä¸Šé¢çš„äº¤äº’éƒ½éå¸¸é…·ç‚«</li><li><a href="http://www.aigei.com/bgremover" target="_blank" rel="noopener">bgremover</a> åœ¨çº¿å›¾ç‰‡å»åº•å·¥å…·</li><li><a href="https://www.photopea.com/" target="_blank" rel="noopener">photopea</a> ä¸€ä¸ªç½‘é¡µç«¯ Photoshop å¾ˆå˜æ€</li><li><a href="https://bestofjs.org/" target="_blank" rel="noopener">bestofjs</a> æŸ¥çœ‹ä¸€ä¸ªé¡¹ç›®å¢é•¿ç»å†ï¼ŒStar æ•°å˜åŒ–çš„ç½‘ç«™ï¼Œè¾…åŠ©ä½ åˆ¤æ–­è¿™ä¸ªåº“çš„è´¨é‡</li><li><a href="https://stackblitz.com/" target="_blank" rel="noopener">stackblitz</a> ä¸€æ¬¾åœ¨çº¿ IDE,ä¸»è¦é¢å‘ Web å¼€å‘è€…,ç§»æ¤äº†å¾ˆå¤š VS Code çš„ç‰¹æ€§ä¸åŠŸèƒ½</li><li><a href="http://app.programmingfonts.org" target="_blank" rel="noopener">programmingfonts.org </a> ä¸€ä¸ªä¸“é—¨ä»‹ç»ç¼–ç¨‹å­—ä½“çš„ç½‘ç«™</li><li><a href="https://wubaiqing.github.io/zaobao/" target="_blank" rel="noopener">æ—©æŠ¥</a> ä¸€ä¸ªä¸ªäººå¼€å‘è€…çš„å‰ç«¯å¼€å‘çš„åˆ†äº«æ—¥æŠ¥</li><li><a href="https://emoji.muan.co/#" target="_blank" rel="noopener">emoji-search</a> å¸®ä½ å¿«é€Ÿæ‰¾åˆ°èƒ½è¡¨è¾¾ä½ æƒ…æ„Ÿçš„ emoji</li><li><a href="https://github.com/carloscuesta/gitmoji" target="_blank" rel="noopener">gitmoji</a> é€šè¿‡ emoji è¡¨è¾¾ git çš„æ“ä½œå†…å®¹</li><li><a href="https://starcharts.herokuapp.com/PanJiaChen/vue-element-admin" target="_blank" rel="noopener">starcharts</a> å¯ä»¥æŠŠä½ ä¸€ä¸ªé¡¹ç›®çš„ stars å¢é•¿è½¨è¿¹å½“åš svg æ”¾åœ¨ readme ä¸­</li><li><a href="https://www.mockapi.io/" target="_blank" rel="noopener">mockapi</a> ä¸€ä¸ªè¿˜ä¸é”™çš„åœ¨çº¿ mock æœåŠ¡ï¼ˆå¯åœ¨çº¿å¯è§†åŒ–ç¼–è¾‘ï¼‰ï¼Œå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†ç®€å•éœ€æ±‚äº†</li><li><a href="coder.com">coder</a> åœ¨çº¿ç‰ˆ VS Code</li><li><a href="https://www.browserstack.com/" target="_blank" rel="noopener">browserstack</a> è¿œç¨‹è°ƒæ•´å„ç§ç‰ˆæœ¬æµè§ˆå™¨ å…¼å®¹æ€§é—®é¢˜</li><li><a href="https://carbon.now.sh/" target="_blank" rel="noopener">carbon</a> æ ¹æ®æºç ç”Ÿæˆå›¾ç‰‡ ä¸»è¦ä½œç”¨æ˜¯è®©ä½ æ‰“ä»£è¡¨ç‰‡æ®µåˆ†äº«çš„æ—¶å€™æ›´å¥½çœ‹ä¸€ç‚¹</li><li><a href="https://euangoddard.github.io/clipboard2markdown/" target="_blank" rel="noopener">clipboard2markdown</a> å°†ä½ æ‰€æœ‰å¤åˆ¶è¿›å»çš„å†…å®¹éƒ½è½¬åŒ–ä¸º markdown</li><li><a href="https://www.grammarly.com/" target="_blank" rel="noopener">grammarly</a> è‹±è¯­å†™ä½œæ£€æŸ¥å·¥å…·</li><li><a href="https://quickchart.io/" target="_blank" rel="noopener">quickchart</a> é€šè¿‡ URL ç”Ÿæˆå›¾è¡¨çš„å¼€æºæœåŠ¡</li><li><a href="https://www.hipdf.cn/" target="_blank" rel="noopener">hipdf</a> ä¸€ç«™å¼åœ¨çº¿ PDF è§£å†³æ–¹æ¡ˆ</li><li><a href="https://whimsical.com" target="_blank" rel="noopener">whimsical</a> ç”»è·¯ç¨‹å›¾</li><li><a href="https://picsum.photos/" target="_blank" rel="noopener">Lorem Picsum</a> æä¾›å…è´¹çš„å ä½å›¾</li><li><a href="https://sm.ms/" target="_blank" rel="noopener">sm.ms</a> å…è´¹å›¾åºŠ</li></ul><h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><ul><li><a href="https://uimovement.com/" target="_blank" rel="noopener">uimovement</a> èƒ½ä»è¿™ä¸ªç½‘ç«™æ‰¾åˆ°ä¸å°‘åŠ¨ç”»äº¤äº’çš„çµæ„Ÿ</li><li><a href="https://www.awwwards.com/" target="_blank" rel="noopener">awwwards</a>æ˜¯ä¸€ä¸ªä¸€ä¸ªä¸“é—¨ä¸ºè®¾è®¡ç²¾ç¾çš„ç½‘ç«™ä»¥åŠå¯Œæœ‰åˆ›æ„çš„ç½‘ç«™é¢å¥–çš„ç½‘ç«™</li><li><a href="https://dribbble.com/" target="_blank" rel="noopener">dribbble</a> ç»å¸¸èƒ½åœ¨ä¸Šé¢æ‰¾åˆ°å¾ˆå¤šæœ‰åˆ›æ„å¥½çœ‹çš„ gif æˆ–è€…å›¾ç‰‡ï¼ŒåŸºæœ¬ä¸Šæˆ‘æ‰€æœ‰çš„å›¾éƒ½æ˜¯ä¸Šé¢æ‰¾çš„</li><li><a href="https://www.behance.net/" target="_blank" rel="noopener">BÄ“hance</a> dribbble æ˜¯è®¾è®¡å¸ˆçš„å¾®åšï¼ŒBÄ“hance æ˜¯è®¾è®¡å¸ˆçš„åšå®¢</li><li><a href="https://logojoy.com/" target="_blank" rel="noopener">Logojoy</a> ä½¿ç”¨ ai åš logo çš„ç½‘ç«™ï¼Œåšå‡ºæ¥çš„ logo è´¨é‡è¿˜ä¸é”™ã€‚</li><li><a href="http://brandmark.io/" target="_blank" rel="noopener">brandmark</a> å¦ä¸€ä¸ªåœ¨çº¿åˆ¶ä½œ logo ç½‘ç«™</li><li><a href="https://instantlogodesign.com/" target="_blank" rel="noopener">instant</a> åˆä¸€ä¸ª logo åˆ¶ä½œç½‘ç«™</li><li><a href="https://www.designevo.com/logo-maker/" target="_blank" rel="noopener">logo-maker</a> åˆä¸€ä¸ª logo åˆ¶ä½œç½‘ç«™ è¿™ä¸ªæ›´ç®€å•ç‚¹ å°±æ˜¯é€‰æ¨¡æ¿ä¹‹åå¾®è°ƒ</li><li><a href="https://coolors.co/" target="_blank" rel="noopener">coolors</a> å¸®ä½ åœ¨çº¿é…è‰²çš„ç½‘ç«™ ä½ èƒ½æ‰¾åˆ°ä¸å°‘é…è‰²çµæ„Ÿ</li><li><a href="http://colorhunt.co/" target="_blank" rel="noopener">colorhunt</a> å¦ä¸€ä¸ªé…è‰²ç½‘ç«™</li><li><a href="https://uigradients.com/#SummerDog" target="_blank" rel="noopener">uigradients</a> æ¸å˜è‰²ç½‘ç«™</li><li><a href="https://www.designcap.com" target="_blank" rel="noopener">designcap</a> åœ¨çº¿æµ·æŠ¥è®¾è®¡</li><li><a href="https://flatuicolors.com/" target="_blank" rel="noopener">Flat UI è‰²è¡¨</a> Flat UI è‰²è¡¨</li><li><a href="https://www.0to255.com/" target="_blank" rel="noopener">0to255</a> é¢œè‰²æ¢¯åº¦</li><li><a href="https://github.com/mikolajdobrucki/ikonate" target="_blank" rel="noopener">Ikonate</a> æä¾›å…è´¹çš„å›¾æ ‡ icons</li><li><a href="https://remixicon.com/" target="_blank" rel="noopener">remixicon</a> åˆä¸€ä¸ªæä¾›å…è´¹å›¾æ ‡ icons</li><li><a href="https://github.com/feathericons/feather" target="_blank" rel="noopener">feather</a> å…è´¹çš„ icons</li><li><a href="https://github.com/arcticicestudio/nord" target="_blank" rel="noopener">nord </a> åŒ—æ¬§æ€§å†·æ·¡é£ä¸»é¢˜é…è‰²</li><li><a href="https://unsplash.com/" target="_blank" rel="noopener">Unsplash</a> æä¾›å…è´¹çš„é«˜æ¸…å›¾ç‰‡</li><li><a href="https://colorkitty.com/" target="_blank" rel="noopener">colorkitty</a> ä»ä½ çš„å›¾ç‰‡ä¸­æå–é…è‰²</li></ul><h3 id="æœ‰è¶£"><a href="#æœ‰è¶£" class="headerlink" title="æœ‰è¶£"></a>æœ‰è¶£</h3><ul><li><a href="http://www.baidu-x.com/" target="_blank" rel="noopener">å¸®ä½ ç™¾åº¦ä¸€ä¸‹</a> å¯ä»¥ <a href="http://www.baidu-x.com/?q=%E5%92%8C%E8%B0%90%E6%9C%89%E7%88%B1%E5%AF%8C%E5%BC%BA" target="_blank" rel="noopener">ç‚¹æˆ‘æµ‹è¯•ä¸€ä¸‹</a>-</li><li><a href="http://lmgtfy.com/" target="_blank" rel="noopener">å›½é™…ç‰ˆ</a> åŒ<code>å¸®æˆ‘ç™¾åº¦ä¸€ä¸‹</code>-<a href="http://lmgtfy.com/?q=a" target="_blank" rel="noopener">ç‚¹æˆ‘æµ‹è¯•ä¸€ä¸‹</a>-</li><li><a href="https://alpha.wallhaven.cc/" target="_blank" rel="noopener">wallhaven</a> å£çº¸ç½‘ç«™-</li><li><a href="http://matthewrayfield.com/articles/animating-urls-with-javascript-and-emojis/#%F0%9F%8C%96" target="_blank" rel="noopener">URL åœ°å€æ’­æ”¾ Emojis åŠ¨ç”»</a> åœ¨åœ°å€æ é‡Œé¢æ’­æ”¾ emoji</li><li><a href="https://cantunsee.space/" target="_blank" rel="noopener">Canâ€™t Unsee</a> å¼ºçƒˆå»ºè®®å‰ç«¯ã€å®¢æˆ·ç«¯ã€UI å¼€å‘çš„åŒå­¦ç©ä¸‹ï¼Œæ£€æŸ¥ä¸€ä¸‹è‡ªå·±å¯¹è®¾è®¡ç¨¿çš„æ•æ„Ÿåº¦æ€ä¹ˆæ ·</li><li><a href="https://talk.swift.gg/" target="_blank" rel="noopener">ggtalk</a> å¹³æ—¶ä¸€ç›´åœ¨å¬çš„ä¸€ä¸ªæŠ€æœ¯åšå®¢</li><li><a href="https://github.com/Blankj/awesome-comment" target="_blank" rel="noopener">awesome-comment</a> é‡Œé¢æ”¶é›†äº†å¾ˆå¤šæœ‰è¶£çš„ä»£ç æ³¨é‡Š</li><li><a href="https://www.text-image.com/index.html" target="_blank" rel="noopener">text-img</a> éƒ½å°†å›¾ç‰‡è½¬åŒ–ä¸º ascii ç”¨æ¥å†™æ³¨é‡Š</li><li><a href="https://github.com/beizhedenglong/weird-fonts" target="_blank" rel="noopener">weird-fonts</a> å°†æ™®é€šå­—æ¯è½¬åŒ–ä¸º ç‰¹æ®Š unicode</li><li><a href="https://github.com/epidemian/snake" target="_blank" rel="noopener">snake</a> åœ¨åœ°å€æ é‡Œé¢ç©è´ªåƒè›‡</li></ul><h3 id="äº¤äº’"><a href="#äº¤äº’" class="headerlink" title="äº¤äº’"></a>äº¤äº’</h3><ul><li><a href="http://aliscued.lofter.com/" target="_blank" rel="noopener">å¾®äº¤äº’</a> é‡Œé¢æ”¶é›†äº†å¸‚é¢ä¸Šå¾ˆå¤šå¾ˆå¥½çš„å¾®äº¤äº’ä¾‹å­ å€¼å¾—å­¦ä¹ </li><li><a href="http://littlebigdetails.com/" target="_blank" rel="noopener">Little Big Details</a> åŒä¸Šï¼Œä¸€ä¸ªå›½å¤–å¾®äº¤äº’æ±‡é›†ç½‘ç«™</li><li><a href="https://cruip.com/" target="_blank" rel="noopener">cruip</a> ç™»å½•é¡µçš„å„ç§é¡µé¢è®¾è®¡ï¼Œå¯ä»¥å…è´¹ä¸‹è½½æ¨¡æ¿</li><li><a href="https://comixify.ii.pw.edu.pl/" target="_blank" rel="noopener">Comixify</a> ä¸€ä¸ªæ³¢å…°å›¢é˜Ÿåšäº†éå¸¸å¥½ç©çš„å·¥å…·ï¼Œå¯ä»¥æŠŠè§†é¢‘è‡ªåŠ¨è½¬æˆæ¼«ç”»ï¼Œä¸Šå›¾æ˜¯ä»–ä»¬æä¾›çš„ demoï¼Œæ•ˆæœå¾ˆæ£’ã€‚</li><li><a href="https://github.com/bui/taiko-web" target="_blank" rel="noopener">taiko-web</a> å¤ªé¼“è¾¾äººç½‘é¡µç‰ˆ åªèƒ½è¯´å¾ˆ 6</li></ul><h3 id="Css"><a href="#Css" class="headerlink" title="Css"></a>Css</h3><ul><li><a href="https://css-tricks.com/" target="_blank" rel="noopener">css-tricks</a> ä¸€ä¸ªå­¦ä¹  css ä¸é”™çš„ç½‘ç«™ æœ‰å¾ˆå¤šæœ‰æ„æ€çš„ demo</li></ul><h3 id="æ•™ç¨‹"><a href="#æ•™ç¨‹" class="headerlink" title="æ•™ç¨‹"></a>æ•™ç¨‹</h3><ul><li><p><a href="https://egghead.io/courses/execute-npm-package-binaries-with-the-npx-package-runner" target="_blank" rel="noopener">npx</a> æ•™ä½ æ€ä¹ˆåˆç†çš„ä½¿ç”¨ npx</p></li><li><p><a href="https://www.hacksplaining.com/lessons" target="_blank" rel="noopener">hacksplaining</a> ç½‘ç»œå®‰å…¨å­¦ä¹ ç½‘ç«™</p></li></ul><h3 id="äº§å“"><a href="#äº§å“" class="headerlink" title="äº§å“"></a>äº§å“</h3><ul><li><p><a href="http://www.pmdaniu.com/" target="_blank" rel="noopener">äº§å“å¤§ç‰›</a> ä»€ä¹ˆæœ‰å¾ˆå¤šå®Œæ•´çš„äº§å“åŸå‹å¯ä»¥å€Ÿé‰´</p></li><li><p><a href="https://modao.cc/pricing" target="_blank" rel="noopener">ç£¨åˆ€</a> å¿«é€Ÿå‡º ui åŸå‹</p></li></ul><h3 id="å®ç”¨"><a href="#å®ç”¨" class="headerlink" title="å®ç”¨"></a>å®ç”¨</h3><p><a href="https://admin.typeform.com/signup" target="_blank" rel="noopener">typeform</a> ä¸€ä¸ªå›½å¤–çš„åœ¨çº¿è°ƒæŸ¥é—®å·ç½‘ç«™</p><h3 id="Talk"><a href="#Talk" class="headerlink" title="Talk"></a>Talk</h3><p><a href="https://github.com/peerigon/talks" target="_blank" rel="noopener">peerigon-talks</a> æ”¶é›†äº†ä¸å°‘æœ‰æ„æ€çš„ talks</p><h3 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h3><p><a href="https://github.com/azl397985856/leetcode" target="_blank" rel="noopener">leetcode</a> ç”¨ js åˆ· leetcode</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®ç”¨ç½‘ç«™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeJsçš„åŸç”Ÿæ–¹æ³•</title>
      <link href="/2019/03/15/workspace/Server/node/base/"/>
      <url>/2019/03/15/workspace/Server/node/base/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>NodeJsçš„åŸç”Ÿæ–¹æ³•</strong></p><p>[[toc]]</p><h3 id="process-argv"><a href="#process-argv" class="headerlink" title="process.argv"></a>process.argv</h3><p>process å¯¹è±¡æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå®ƒæä¾›å½“å‰ Node.js è¿›ç¨‹çš„æœ‰å…³ä¿¡æ¯ï¼Œä»¥åŠæ§åˆ¶å½“å‰ Node.js è¿›ç¨‹ã€‚ å› ä¸ºæ˜¯å…¨å±€å˜é‡ï¼Œæ‰€ä»¥æ— éœ€ä½¿ç”¨ require()ã€‚</p><p>process.argv å±æ€§è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„åŒ…å«äº†å¯åŠ¨Node.jsè¿›ç¨‹æ—¶çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œ</p><p>å…¶ä¸­ï¼š</p><p>æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ process.argv[0]â€”â€”è¿”å›å¯åŠ¨Node.jsè¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç»å¯¹è·¯å¾„</p><p>ç¬¬äºŒä¸ªå…ƒç´ process.argv[1]â€”â€”ä¸ºå½“å‰æ‰§è¡Œçš„JavaScriptæ–‡ä»¶è·¯å¾„</p><p>å‰©ä½™çš„å…ƒç´ ä¸ºå…¶ä»–å‘½ä»¤è¡Œå‚æ•°</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¾“å…¥</span></span><br><span class="line">node config.js aaaa bbbb cccc</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line">[</span><br><span class="line">  <span class="string">'/usr/local/bin/node'</span>,</span><br><span class="line">  <span class="string">'/Users/hzf/workspace/zy-vue/babel.config.js'</span>,</span><br><span class="line">  <span class="string">'aaaa'</span>,</span><br><span class="line">  <span class="string">'bbbb'</span>,</span><br><span class="line">  <span class="string">'cccc'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> NodeJS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Reduxæºç è§£æ</title>
      <link href="/2019/02/17/workspace/Frame/react/react-redux/"/>
      <url>/2019/02/17/workspace/Frame/react/react-redux/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Reduxæºç è§£æ</strong></p><p>[[toc]]</p><h3 id="Reduxä¸‰å¤§åŸåˆ™"><a href="#Reduxä¸‰å¤§åŸåˆ™" class="headerlink" title="Reduxä¸‰å¤§åŸåˆ™"></a>Reduxä¸‰å¤§åŸåˆ™</h3><ul><li><strong>å”¯ä¸€æ•°æ®æº</strong><ul><li>æ•´ä¸ªåº”ç”¨çš„stateéƒ½è¢«å­˜å‚¨åˆ°ä¸€ä¸ªçŠ¶æ€æ ‘é‡Œé¢ï¼Œå¹¶ä¸”è¿™ä¸ªçŠ¶æ€æ ‘ï¼Œåªå­˜åœ¨äºå”¯ä¸€çš„storeä¸­</li></ul></li><li><strong>ä¿æŒåªè¯»çŠ¶æ€</strong><ul><li>stateæ˜¯åªè¯»çš„ï¼Œå”¯ä¸€æ”¹å˜stateçš„æ–¹æ³•å°±æ˜¯è§¦å‘actionï¼Œactionæ˜¯ä¸€ä¸ªç”¨äºæè¿°ä»¥å‘ç”Ÿæ—¶é—´çš„æ™®é€šå¯¹è±¡<ul><li>storeé‡Œé¢ä¿å­˜çš„éƒ½æ˜¯æ™®é€šObjectï¼Œå¯ç›´æ¥ä¿®æ”¹ä»–çš„å€¼ï¼Œå®˜æ–¹æ–‡æ¡£è¯´çš„â€œåªæœ‰é€šè¿‡actionæ‰èƒ½ä¿®æ”¹çŠ¶æ€â€æ›´å¤šçš„æ˜¯ä¸€ç§è§„åˆ™/çº¦æŸï¼Œç›®çš„æ˜¯ä½¿æ•°æ®çš„æµåŠ¨è¿‡ç¨‹å˜å¾—æ¸…æ™°ä¸”å¯é¢„æµ‹ï¼Œè€Œä¸æ˜¯è¯´é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆæ¯”å¦‚ç›´æ¥ä¿®æ”¹å¯¹è±¡å±æ€§ï¼‰ä¼šæŠ¥é”™ã€‚å½“ç„¶è¿™ç§æ–¹å¼æ˜¯ <strong>æ— æ³•è§¦å‘propsæ›´æ–°çš„</strong></li></ul></li></ul></li><li><strong>æ•°æ®æ”¹å˜åªèƒ½é€šè¿‡çº¯å‡½æ•°æ¥æ‰§è¡Œ</strong><ul><li>ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹ï¼Œä¸ºäº†æè¿°actionå¦‚ä½•æ”¹å˜stateçš„ï¼Œä½ éœ€è¦ç¼–å†™reducers</li></ul></li></ul><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H70eea0923b414f78a4a4d805e374147aX.gif" alt=""></p><h3 id="Action-amp-store-dispatch"><a href="#Action-amp-store-dispatch" class="headerlink" title="Action &amp; store.dispatch( )"></a>Action &amp; store.dispatch( )</h3><p><code>Action</code>æ˜¯æŠŠæ•°æ®ä»åº”ç”¨ä¼ åˆ°storeçš„æœ‰æ•ˆè½½è·ã€‚å®ƒæ˜¯storeæ•°æ®çš„å”¯ä¸€æ¥æºã€‚ä¸€èˆ¬æ¥è¯´ä½ ä¼šé€šè¿‡ store.dispatch() å°† action ä¼ åˆ° storeã€‚</p><ul><li>é¦–å…ˆç”¨æˆ·è¯·æ±‚æˆ–è€…é¡µé¢é»˜è®¤è¯·æ±‚æ‰§è¡Œä¸€ä¸ªå‡½æ•° ä¾‹ï¼šmyBoardList</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myBoardList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">dispatch,getState</span>)</span>&#123;<span class="comment">//è¿™é‡Œæ˜¯ä¸­é—´ä»¶ç©¿è¿›å»çš„</span></span><br><span class="line">    request.get(<span class="string">`<span class="subst">$&#123;route.myBoard&#125;</span><span class="subst">$&#123;getState().loginReducer.user_id&#125;</span>`</span>).then(<span class="function">(<span class="params">&#123;data&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> my_list = data; <span class="comment">//è¿™é‡Œä¸€æ•´ç†æ•°æ®æ ¼å¼</span></span><br><span class="line">        <span class="comment">//Action æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚å…¶ä¸­çš„typeå±æ€§æ˜¯å¿…é¡»çš„ï¼Œè¡¨ç¤º Action çš„åç§°ã€‚å…¶ä»–å±æ€§å¯ä»¥è‡ªç”±è®¾ç½®</span></span><br><span class="line">        <span class="keyword">const</span> action =&#123;</span><br><span class="line">              type:TYPES.BOARD_MY,</span><br><span class="line">              payload:&#123;</span><br><span class="line">                 my_list</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//store.dispatch()æ˜¯é¡µé¢å‘å‡ºActionçš„å”¯ä¸€æ–¹æ³•ã€‚</span></span><br><span class="line">        dispatch(action)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é¡µé¢ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">this</span>.props.dispatch(myBoardList())</span><br></pre></td></tr></table></figure><h3 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h3><p><code>Reducers</code>æŒ‡å®šäº†åº”ç”¨çŠ¶æ€çš„å˜åŒ–<code>å¦‚ä½•å“åº”</code>actionså¹¶å‘é€åˆ°storeçš„ï¼Œactionsåªæ˜¯æè¿°äº†æœ‰äº‹æƒ…å‘ç”Ÿäº†è¿™ä¸€äº‹å®ï¼Œå¹¶æ²¡æœ‰æè¿°åº”ç”¨å¦‚ä½•æ›´æ–°stateã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> TYPES <span class="keyword">from</span> <span class="string">'actionTypes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  my_list:[]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> tabBarReducer = <span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">     <span class="keyword">case</span> TYPES.BOARD_MY :</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, action.payload)</span><br><span class="line">    <span class="keyword">default</span>: </span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> tabBarReducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer = combineReducers(&#123; <span class="comment">//åˆå¹¶æ‰€æœ‰çš„reducerå¯¼å‡ºï¼Œç„¶åå½“åšcreateStoreçš„å‚æ•°</span></span><br><span class="line">   tabBarReducer,</span><br><span class="line">   ....</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h3><p><code>store</code>å°±æ˜¯reduxé‡Œé¢çš„ä¸€ä¸ªå®¹å™¨ï¼Œstoreæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªçŠ¶æ€æ ‘ï¼Œä¿å­˜äº†æ‰€æœ‰å¯¹è±¡çš„çŠ¶æ€ã€‚ä»»ä½•UIç»„ä»¶éƒ½å¯ä»¥ç›´æ¥ä»storeè®¿é—®ç‰¹å®šå¯¹è±¡çš„çŠ¶æ€ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> reduxThunk <span class="keyword">from</span> <span class="string">"redux-thunk"</span></span><br><span class="line"><span class="keyword">import</span> reduxPromise <span class="keyword">from</span> <span class="string">"redux-promise"</span></span><br><span class="line"><span class="keyword">import</span> &#123;createStore, applyMiddleware&#125; <span class="keyword">from</span> <span class="string">"redux"</span></span><br><span class="line"><span class="keyword">import</span> &#123; composeWithDevTools &#125; <span class="keyword">from</span> <span class="string">'redux-devtools-extension'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducer"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = composeWithDevTools(createStore(reducer,applyMiddleware(reduxThunk, reduxPromise)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure><h3 id="Reduxæºç "><a href="#Reduxæºç " class="headerlink" title="Reduxæºç  *"></a>Reduxæºç  *</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let combineReducers&#x3D;(renducers)&#x3D;&gt;&#123;</span><br><span class="line">    &#x2F;&#x2F;ä¼ å…¥ä¸€ä¸ªrenducersç®¡ç†ç»„ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªrenducer</span><br><span class="line">    return function(state&#x3D;&#123;&#125;,action&#x3D;&#123;&#125;)&#123;</span><br><span class="line">        let newState&#x3D;&#123;&#125;;</span><br><span class="line">        for(var attr in renducers)&#123;</span><br><span class="line">            newState[attr]&#x3D;renducers[attr](state[attr],action)</span><br><span class="line">        &#125;</span><br><span class="line">        return newState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let createStore &#x3D; (reducer) &#x3D;&gt; &#123;</span><br><span class="line">    let state;</span><br><span class="line">    &#x2F;&#x2F;è·å–çŠ¶æ€å¯¹è±¡</span><br><span class="line">    &#x2F;&#x2F;å­˜æ”¾æ‰€æœ‰çš„ç›‘å¬å‡½æ•°</span><br><span class="line">    let listeners &#x3D; [];</span><br><span class="line">    let getState &#x3D; () &#x3D;&gt; state;</span><br><span class="line">    &#x2F;&#x2F;æä¾›ä¸€ä¸ªæ–¹æ³•ä¾›å¤–éƒ¨è°ƒç”¨æ´¾å‘action</span><br><span class="line">    let dispath &#x3D; (action) &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F;è°ƒç”¨ç®¡ç†å‘˜reducerå¾—åˆ°æ–°çš„state</span><br><span class="line">        state &#x3D; reducer(state, action);</span><br><span class="line">        &#x2F;&#x2F;æ‰§è¡Œæ‰€æœ‰çš„ç›‘å¬å‡½æ•°ï¼Œç›¸å½“äºå‘å¸ƒ</span><br><span class="line">        listeners.forEach((l) &#x3D;&gt; l())</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;è®¢é˜…çŠ¶æ€å˜åŒ–äº‹ä»¶ï¼Œå½“çŠ¶æ€æ”¹å˜å‘ç”Ÿä¹‹åæ‰§è¡Œç›‘å¬å‡½æ•°</span><br><span class="line">    let subscribe &#x3D; (listener) &#x3D;&gt; &#123;</span><br><span class="line">        listeners.push(listener);</span><br><span class="line">       &#x2F;&#x2F;store.subscribeæ–¹æ³•è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥è§£é™¤ç›‘å¬ã€‚</span><br><span class="line">        return function unsubscribe() &#123;</span><br><span class="line">             const index &#x3D; listeners.indexOf(listener)</span><br><span class="line">             listeners.splice(index, 1)</span><br><span class="line">           &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dispath();</span><br><span class="line">    return &#123;</span><br><span class="line">        getState,  &#x2F;&#x2F;è·å–å½“å‰çš„å®¹å™¨çš„çŠ¶æ€</span><br><span class="line">        subscribe, &#x2F;&#x2F;å½“ä½ å¯¹æ•°æ®åº“å‘å‡ºä¸€ä¸ªæŒ‡ä»¤ï¼Œè€Œä¸”æ•°æ®åº“æ ¹æ®è¿™ä¸ªæŒ‡ä»¤å·²ç»è®¡ç®—å¾—åˆ°æ–°çš„çŠ¶æ€ä»¥åéœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°</span><br><span class="line">        dispath,   &#x2F;&#x2F;å‘å‡ºä¸€ä¸ªActionï¼Œå‘Šè¯‰æ•°æ®åº“ä½ è¦å¹²å˜›ã€‚æ•°æ®åº“ä¼šæ ¹æ®å½“å‰çš„çŠ¶æ€ä»¥åŠä½ çš„å‘½ä»¤ç±»å‹è®¡ç®—å¾—åˆ°æ–°çš„çŠ¶æ€ã€‚è®¡ç®—å®Œæˆä»¥åï¼Œæˆ‘ä»¬è¦æ‰§è¡Œsubscribeæ·»åŠ çš„æ‰€æœ‰çš„å›è°ƒå‡½æ•°.</span><br><span class="line">        replaceReducer &#x2F;&#x2F;ç”¨ä¸€ä¸ªæ–°çš„storeæ›¿æ¢æ‰æˆ‘ä»¬å½“å‰çš„storeç”¨æ¥è®¡ç®—æˆ‘ä»¬çš„æ–°çš„stateã€‚</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const store &#x3D; createStore(reducer);</span><br><span class="line">store.getState(); &#x2F;&#x2F; è·å–æ•°æ®</span><br><span class="line">store.dispatch(&#123;type: &#39;ADD_TODO&#39;&#125;); &#x2F;&#x2F; æ›´æ–°æ•°æ®</span><br><span class="line">store.subscribe(() &#x3D;&gt;  document.querySelector(&#39;#counter&#39;).innerHTML &#x3D; store.getState()); &#x2F;&#x2F; æ³¨å†Œè®¢é˜…å‡½æ•°</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œåˆ›å»ºä¸€ä¸ª<code>window.store = createStore(reducer)</code>ï¼Œ<br>ç„¶ååœ¨éœ€è¦çš„åœ°æ–¹é€šè¿‡<code>store.getState()å»è·å–æ•°æ®</code>ï¼Œ<br>é€šè¿‡<code>store.dispatchå»æ›´æ–°æ•°æ®</code>ï¼Œ<br>é€šè¿‡<code>store.subscribeå»è®¢é˜…æ•°æ®å˜åŒ–ç„¶åè¿›è¡ŒsetState</code>â€¦å¦‚æœå¾ˆå¤šåœ°æ–¹éƒ½è¿™æ ·åšä¸€éï¼Œå®åœ¨æ˜¯ä¸å ªå…¶é‡ï¼Œè€Œä¸”ï¼Œè¿˜æ˜¯æ²¡æœ‰é¿å…æ‰å…¨å±€å˜é‡çš„ä¸ä¼˜é›…ã€‚æ‰€ä»¥å°±éœ€è¦<strong>react-redux</strong>äº†</p><h3 id="React-Redux"><a href="#React-Redux" class="headerlink" title="React-Redux"></a>React-Redux</h3><h4 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h4><p>ç”±äºå…¨å±€å˜é‡æœ‰è¯¸å¤šçš„ç¼ºç‚¹ï¼Œæ‰€æœ‰å°±éœ€è¦ç”¨åˆ°Providerä¼˜åŒ–</p><p><code>Provider</code>å…¶å®å°±åªæ˜¯ä¸€ä¸ªå¤–å±‚å®¹å™¨ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡é…åˆ<code>connect</code>æ¥è¾¾åˆ°è·¨å±‚çº§ä¼ é€’æ•°æ®ã€‚ä½¿ç”¨æ—¶åªéœ€å°†Providerå®šä¹‰ä¸ºæ•´ä¸ªé¡¹ç›®æœ€å¤–å±‚çš„ç»„ä»¶ï¼Œå¹¶è®¾ç½®å¥½storeã€‚<br>é‚£ä¹ˆæ•´ä¸ªé¡¹ç›®éƒ½å¯ä»¥ç›´æ¥è·å–è¿™ä¸ªstoreã€‚å®ƒçš„åŸç†å…¶å®æ˜¯é€šè¿‡Reactä¸­çš„Contextæ¥å®ç°çš„ã€‚å®ƒçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span></span><br><span class="line"><span class="keyword">import</span> &#123;ReactReduxContext&#125; <span class="keyword">from</span> <span class="string">'./Context'</span>   <span class="comment">//å°±æ˜¯åˆ©ç”¨ä¸Šä¸‹æ–‡æ¥è¾¾åˆ°è·¨å±‚çº§ä¼ é€’æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="keyword">const</span> &#123;store&#125; = props</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            storeState: store.getState(),</span><br><span class="line">            store</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>._isMounted = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">this</span>.subscribe()</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.unsubscribe) <span class="keyword">this</span>.unsubscribe()  <span class="comment">//å–æ¶ˆè®¢é˜…</span></span><br><span class="line">        <span class="keyword">this</span>._isMounted = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    componentDidUpdate(prevProps) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.props.store !== prevProps.store) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.unsubscribe) <span class="keyword">this</span>.unsubscribe()</span><br><span class="line">            <span class="keyword">this</span>.subscribe()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    subscribe() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;store&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">        <span class="comment">//store.subscribeè¿”å›çš„æ˜¯å–æ¶ˆè®¢é˜…çš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">//Store å…è®¸ä½¿ç”¨store.subscribeæ–¹æ³•è®¾ç½®ç›‘å¬å‡½æ•°ï¼Œæ¯æ¬¡dispatchåï¼Œæ‰§è¡Œå®Œreduceræ”¹å˜æ–°çš„storeåï¼Œéƒ½ä¼šé‡æ–°å‘å¸ƒè¿™ä¸ªå«å‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> newStoreState = store.getState()</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>._isMounted) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.setState(<span class="function"><span class="params">providerState</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå€¼ç›¸åŒï¼Œåˆ™è·³è¿‡ä¸å¿…è¦çš„çŠ¶æ€æ›´æ–°</span></span><br><span class="line">                <span class="keyword">if</span> (providerState.storeState === newStoreState) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="attr">storeState</span>: newStoreState&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// å¯èƒ½åœ¨å‘ˆç°å’Œè£…è½½ä¹‹é—´è°ƒåº¦äº†æ“ä½œ-å¤„ç†é‚£äº›</span></span><br><span class="line">        <span class="keyword">const</span> postMountStoreState = store.getState()</span><br><span class="line">        <span class="keyword">if</span> (postMountStoreState !== <span class="keyword">this</span>.state.storeState) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">storeState</span>: postMountStoreState&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> Context = <span class="keyword">this</span>.props.context || ReactReduxContext</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Context.Provider value=&#123;<span class="keyword">this</span>.state&#125;&gt;</span><br><span class="line">                &#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">            &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">Provider.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">    store: PropTypes.shape(&#123;</span></span><br><span class="line"><span class="regexp">        subscribe: PropTypes.func.isRequired,</span></span><br><span class="line"><span class="regexp">        dispatch: PropTypes.func.isRequired,</span></span><br><span class="line"><span class="regexp">        getState: PropTypes.func.isRequired</span></span><br><span class="line"><span class="regexp">    &#125;),</span></span><br><span class="line"><span class="regexp">    context: PropTypes.object,</span></span><br><span class="line"><span class="regexp">    children: PropTypes.any</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Provider</span></span><br></pre></td></tr></table></figure><h4 id="Connect"><a href="#Connect" class="headerlink" title="Connect"></a>Connect</h4><p><code>connect</code>çš„ä½œç”¨æ˜¯è¿æ¥Reactç»„ä»¶ä¸Storeï¼Œå®ƒåŒ…åœ¨æˆ‘ä»¬çš„å®¹å™¨ç»„ä»¶çš„å¤–ä¸€å±‚ï¼Œå®ƒæ¥æ”¶ä¸Šé¢Provideræä¾›çš„storeé‡Œé¢çš„<code>state</code>å’Œ<code>dispatch</code>ï¼Œä¼ ç»™ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥å±æ€§å½¢å¼ä¼ ç»™æˆ‘ä»¬çš„å®¹å™¨ç»„ä»¶ã€‚</p><p>å®ƒå…±æœ‰å››ä¸ªå‚æ•° <strong>mapStateToProps, mapDispatchToProps, mergePropsä»¥åŠoptions</strong>ã€‚</p><p><code>mapStateToProps</code> çš„ä½œç”¨æ˜¯å°†storeé‡Œçš„stateï¼ˆæ•°æ®æºï¼‰ç»‘å®šåˆ°æŒ‡å®šç»„ä»¶çš„propsä¸­</p><p><code>mapDispatchToProps</code> çš„ä½œç”¨æ˜¯å°†storeé‡Œçš„actionï¼ˆæ“ä½œæ•°æ®çš„æ–¹æ³•ï¼‰ç»‘å®šåˆ°æŒ‡å®šç»„ä»¶çš„propsä¸­</p><p>å…¶å®å°±æ˜¯åˆ©ç”¨ä¸Šä¸‹æ–‡è·å–æ‰€æœ‰çš„store,ç„¶åæ‰§è¡Œstore.getState()ä¿è¯èƒ½è·å–æœ€æ–°çš„æ•°æ®ï¼Œç„¶ååœ¨åˆ©ç”¨mapStateToPropsï¼ŒmapDispatchToProps æŠŠéœ€è¦ç”¨åˆ°çš„è§£æ„å‡ºæ¥</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mapStateToProps = <span class="function">(<span class="params">&#123;loginReducer,loading&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    userInfo: &#123;...loginReducer, ...loading&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> mapDispatchToProps =  <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> actions = bindActionCreators(&#123;...globalActions&#125;, dispatch);</span><br><span class="line">   <span class="keyword">return</span> &#123;...actions&#125;;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(Index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡propsè·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">this</span>.props.userInfo</span><br></pre></td></tr></table></figure><p>connectéƒ¨åˆ†æºç </p><p>æ–°ç‰ˆçš„å¤ªå¤æ‚ï¼Œçœ‹ä¸‹è€ç‰ˆæœ¬çš„ï¼Œä¾¿äºç†è§£</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="function">(<span class="params">mapStateToProps, mapDispatchToProps</span>) =&gt;</span> <span class="function">(<span class="params">WrappedComponent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Connect</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">      store: PropTypes.object</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span> () &#123;</span><br><span class="line">      <span class="keyword">super</span>()</span><br><span class="line">      <span class="keyword">this</span>.state = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount () &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context</span><br><span class="line">      <span class="comment">//ä½¿ç”¨subscribeï¼Œä¼šå®æ—¶æ£€æµ‹storeçš„å˜åŒ–</span></span><br><span class="line">      <span class="keyword">this</span>.unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.setProps())</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnMount () &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setProps () &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context</span><br><span class="line">      <span class="keyword">let</span> stateProps = mapStateToProps</span><br><span class="line">        ? mapStateToProps(store.storeState(), <span class="keyword">this</span>.props)</span><br><span class="line">        : &#123;&#125;; <span class="comment">// ä¸ä¼ ä¸ºç©º</span></span><br><span class="line">        </span><br><span class="line">      <span class="keyword">let</span> dispatchProps = mapDispatchToProps</span><br><span class="line">        ? mapDispatchToProps(store.dispatch,<span class="keyword">this</span>.props)</span><br><span class="line">        : mapDispatchToProps(<span class="function"><span class="params">dispatch</span> =&gt;</span> (&#123; dispatch &#125;)); <span class="comment">// é»˜è®¤ä¼ è¿›å»dispatch</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//mapDispatchToPropsé‡Œé¢è¿˜å¯èƒ½ä¼šæœ‰bindActionCreatorsè¿™ä¸ªæ–¹æ³•ï¼›bindActionCreatorsçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªæˆ–å¤šä¸ªactionå’Œdispatchç»„åˆèµ·æ¥ç”Ÿæˆ</span></span><br><span class="line">        <span class="comment">//é€šè¿‡dispatchå°†actionåŒ…è£¹èµ·æ¥ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡bindActionCreatorsåˆ›å»ºçš„æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨dispatch(action)(éšå¼è°ƒç”¨ï¼‰ï¼Œç›¸å½“äºç›´æ¥ç»„åˆæˆ</span></span><br><span class="line">        <span class="comment">//dispatch(&#123;type:type.ADD_ITEM, text&#125;) </span></span><br><span class="line">        <span class="comment">//export function whenMapDispatchToPropsIsObject(mapDispatchToProps) &#123;</span></span><br><span class="line">        <span class="comment">//    return wrapMapToPropsConstant(dispatch =&gt;</span></span><br><span class="line">        <span class="comment">//        bindActionCreators(mapDispatchToProps, dispatch)</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          ...stateProps,</span><br><span class="line">          ...dispatchProps,</span><br><span class="line">          ...this.props</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.state</span>&#125; /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Connect</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼‚æ­¥å¤„ç†"><a href="#å¼‚æ­¥å¤„ç†" class="headerlink" title="å¼‚æ­¥å¤„ç†"></a>å¼‚æ­¥å¤„ç†</h3><h4 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h4><p><strong>æºç </strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createThunkMiddleware</span>(<span class="params">extraArgument</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">&#123; dispatch, getState &#125;</span>) =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;  <span class="comment">//åˆ¤åˆ«actionçš„ç±»å‹ï¼Œå¦‚æœactionæ˜¯å‡½æ•°ï¼Œå°±è°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">        <span class="comment">//å‘ç°å®å‚ä¸ºdispatchå’ŒgetStateï¼Œå› æ­¤æˆ‘ä»¬åœ¨å®šä¹‰actionä¸ºthunkå‡½æ•°æ˜¯ï¼Œä¸€èˆ¬å½¢å‚ä¸ºdispatchå’ŒgetStateã€‚</span></span><br><span class="line">      <span class="keyword">return</span> action(dispatch, getState, extraArgument);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> next(action);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> thunk = createThunkMiddleware();</span><br><span class="line">thunk.withExtraArgument = createThunkMiddleware;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> thunk;</span><br></pre></td></tr></table></figure><p> ä¸Šé¢çš„dispatchå…¶å®æ˜¯ä¸­é—´ä»¶æ‰§è¡Œä¹‹åé€šè¿‡å…¶ä»–æ–¹æ³•æŠŠstoreè‡ªå¸¦çš„dispatchè¦†ç›–ï¼Œ<br> æ‰€ä»¥æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„store.dispatch(action)å…¶å®å°±æ˜¯ä¸­é—´ä»¶æ‰§è¡Œä¹‹åçš„dispatch,<br> è€Œè¿™é‡Œçš„nextå…¶å®æ˜¯storeè‡ªå¸¦çš„dispatchï¼Œ<strong>è™½ç„¶æœ€ç»ˆè¿˜æ˜¯é€šè¿‡storeè‡ªå¸¦çš„dispatchå®ç°çš„ï¼Œ</strong><br> ä½†æ˜¯è°ƒç”¨çš„ç¡®æ˜¯ä¸­é—´ä»¶çš„æ–¹æ³•ï¼Œè™½ç„¶éƒ½å«åšdispatchã€‚</p><p><strong>ä½¿ç”¨æ–¹å¼</strong></p><p>å¯ä»¥ä¼ å…¥å¯¹è±¡æˆ–è€…å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myBoardList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">dispatch,getState</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">const</span> action =&#123;</span><br><span class="line">            type:TYPES.BOARD_MY,</span><br><span class="line">            payload:&#123;</span><br><span class="line">               my_list</span><br><span class="line">            &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     dispatch(action)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¼ºç‚¹</strong></p><p>thunkçš„ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œthunk<code>ä»…ä»…åšäº†æ‰§è¡Œ</code>è¿™ä¸ªå‡½æ•°ï¼Œ<code>å¹¶ä¸åœ¨ä¹å‡½æ•°ä¸»ä½“å†…æ˜¯ä»€ä¹ˆ</code><br/><br>thunkä½¿å¾—reduxå¯ä»¥æ¥å—å‡½æ•°ä½œä¸ºaction,è¿™å°±ä¼šä½¿å¾—å¼‚æ­¥æ“ä½œ<code>å¤ªä¸ºåˆ†æ•£</code>ã€å¾€å¾€éœ€è¦promiseæˆ–è€…async/waitçš„æ”¯æŒæ‰å¯ä»¥ã€‘</p><p>actionçš„å½¢å¼ä¸ç»Ÿä¸€</p><h4 id="redux-saga"><a href="#redux-saga" class="headerlink" title="redux-saga"></a>redux-saga</h4><p><strong>æµç¨‹:</strong></p><p>å¼‚æ­¥æ“ä½œâ€”â€”&gt;Effectå‡½æ•°â€”â€”&gt;çº¯æ–‡æœ¬å¯¹è±¡â€”â€”&gt;saga-middlewareâ€”â€”&gt;æ‰§è¡Œå¼‚æ­¥æ“ä½œ</p><p><strong>é…ç½®sage</strong></p><p><strong>effect.js</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>  * <span class="keyword">as</span> Api <span class="keyword">from</span> <span class="string">"../services"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; call, put, takeEvery &#125; <span class="keyword">from</span> <span class="string">'redux-saga/effects'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‰¯ä½œç”¨å¤„ç† effectsï¼š</span></span><br><span class="line"><span class="comment"> *  ç”¨äºå¼‚æ­¥å¤„ç†è¯·æ±‚</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> effects = &#123;</span><br><span class="line">  <span class="comment">// è·å–è¯é¢˜åˆ—è¡¨</span></span><br><span class="line">  *fetchTopics(&#123; payload &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">yield</span> call(Api.topics, payload);</span><br><span class="line">    <span class="keyword">if</span> (res.success) &#123;</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'topics'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          topics: res.data,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  å¼‚æ­¥ action ç›‘å¬ï¼š æ‰€æœ‰çš„effectæ•´åˆåˆ°äº†ä¸€å—</span></span><br><span class="line"><span class="comment"> *  dispatch å¯¹åº”çš„actionæ—¶ï¼Œè°ƒç”¨å¯¹åº”çš„å¼‚æ­¥å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">watcher</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> takeEvery(<span class="string">'fetchTopics'</span>, effects.fetchTopics);</span><br><span class="line">  <span class="keyword">yield</span> takeEvery(<span class="string">'aaa'</span>, effects.aaa);</span><br><span class="line">  <span class="keyword">yield</span> takeEvery(<span class="string">'bbb'</span>, effects.bbb);</span><br><span class="line">  <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>reducers.js</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤šä¸ªreducer éœ€è¦ç”¨åˆ°combineReducersåˆå¹¶</span></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–State</span></span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">  topics: [],</span><br><span class="line">  topic: &#123;&#125;,</span><br><span class="line">  collected: [],</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¯å‡½æ•° reducerï¼š</span></span><br><span class="line"><span class="comment"> * ä¼ å…¥æ—§ state å’Œ actionï¼Œä»è€Œè¿”å›ä¸€ä¸ªä¿¡æ¯state</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reducers = <span class="function">(<span class="params">state = initState, &#123; type, payload &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'topics'</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        topics: payload.topics,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">    <span class="keyword">default</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„å†™æ³•å’Œredux-thunkä¸­reducerså†™æ³•ä¸€æ ·</p><p><strong>index.js</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç»Ÿä¸€å¯¼å‡ºreducerså’Œeffects</span></span><br><span class="line"><span class="keyword">import</span> &#123; reducers &#125; <span class="keyword">from</span> <span class="string">'./reducers'</span>; </span><br><span class="line"><span class="keyword">import</span> &#123; watcher &#125; <span class="keyword">from</span> <span class="string">"./effects"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  reducers,</span><br><span class="line">  watcher,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>main.js</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React from &#39;react&#39;;</span><br><span class="line">import ReactDOM from &#39;react-dom&#39;;</span><br><span class="line">import &#123; Provider &#125; from &#39;react-redux&#39;;</span><br><span class="line">import &#123; createStore, applyMiddleware &#125; from &#39;redux&#39;;</span><br><span class="line">import createSagaMiddleware from &#39;redux-saga&#39;;</span><br><span class="line">import &#123;reducers,watcher&#125; from &#39;.&#x2F;redux&#39;;</span><br><span class="line"></span><br><span class="line">const sagaMiddleware &#x3D; createSagaMiddleware();</span><br><span class="line">const store &#x3D; createStore(</span><br><span class="line">    reducers,  &#x2F;&#x2F;è¿™é‡Œæ˜¯æ‰€æœ‰çš„reducer</span><br><span class="line">  applyMiddleware(sagaMiddleware), &#x2F;&#x2F;æ‰§è¡Œsagaçš„ä¸­é—´ä»¶</span><br><span class="line">);</span><br><span class="line">sagaMiddleware.run(watcher); </span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store&#x3D;&#123;store&#125;&gt;</span><br><span class="line">  &lt;&#x2F;Provider&gt;,</span><br><span class="line">  document.getElementById(&#39;app&#39;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„sagaMiddleware.run() æ–¹æ³•ï¼Œä¸»è¦æ˜¯å¯åŠ¨sagaï¼Œ<strong>ç”¨äºç›‘å¬actionsè¯·æ±‚</strong>ï¼Œå¾…åŒ¹é…åˆ°å®šä¹‰çš„effects typeæ—¶ï¼Œè½¬å‘è°ƒç”¨effectsæ–¹æ³•ï¼Œä»è€Œå¤„ç†å¼‚æ­¥è¯·æ±‚ï¼Œç„¶åå†è°ƒç”¨reduxä¸­çš„dispatchæ¥è§¦å‘æ–°çš„actionï¼Œæ¥æ›´æ–°storeï¼</p><p><strong>é¡µé¢ä½¿ç”¨</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">@connect(<span class="function">(<span class="params">&#123; topics, loading &#125;</span>) =&gt;</span> (&#123;  <span class="comment">//typeçš„å€¼</span></span><br><span class="line">  topics,</span><br><span class="line">  loading,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">this</span>.props.dispatch(&#123;</span><br><span class="line">    type: <span class="string">'fetchTopics'</span>, <span class="comment">//effectçš„å‡½æ•°</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤„ç†æ­¥éª¤ï¼š</strong></p><ol><li><p>ç”¨æˆ·dispatchæ‰§è¡Œä¸€ä¸ªå¼‚æ­¥å‡½æ•°</p></li><li><p>è°ƒç”¨redux-saga/effectsä¸­çš„æ–¹æ³• callï¼Œè®¿é—®æ¥å£è·å–æ•°æ®ï¼›</p></li><li><p>æ¥å£è®¿é—®æˆåŠŸï¼Œä½¿ç”¨redux-saga/effectsä¸­çš„æ–¹æ³•putï¼Œå‘èµ·actionï¼Œè¿™é‡Œçš„putæ–¹æ³•å’Œdispatchä¸€æ ·ï¼Œéƒ½æ˜¯ç”¨äºå‘èµ·actionï¼›</p></li><li><p>putå‘èµ·actionåï¼Œreduxçš„reducersä¼šæ”¶åˆ°actionï¼Œä»è€Œæ›´æ–°stateã€‚</p></li></ol><p>é›†ä¸­å¤„ç†äº†æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œï¼Œå¼‚æ­¥æ¥å£éƒ¨åˆ†ä¸€ç›®äº†ç„¶</p><p>å¼‚æ­¥æ“ä½œçš„æµç¨‹æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œå¯ä»¥éšæ—¶å–æ¶ˆç›¸åº”çš„å¼‚æ­¥æ“ä½œã€‚</p><h3 id="redux-middleware-æºç åˆ†æ"><a href="#redux-middleware-æºç åˆ†æ" class="headerlink" title="redux middleware æºç åˆ†æ"></a>redux middleware æºç åˆ†æ</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»¥ redux-thunkã€logger ä¸­é—´ä»¶ä¸ºä¾‹ä»‹ç»ä¸­é—´ä»¶çš„ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> enhancer = applyMiddleware(thunk, logger),  </span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer, enhancer)</span><br></pre></td></tr></table></figure><p><strong>applyMiddleware è°ƒç”¨å…¥å£</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  &#x2F;&#x2F; é€šè¿‡ä¸‹é¢ä»£ç å¯ä»¥å‘ç°ï¼Œå¦‚æœ createStore ä¼ å…¥ 2 ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ç›¸å½“äºå°±æ˜¯ enhancer</span><br><span class="line">  if (typeof preloadedState &#x3D;&#x3D;&#x3D; &#39;function&#39; &amp;&amp; typeof enhancer &#x3D;&#x3D;&#x3D; &#39;undefined&#39;) &#123;</span><br><span class="line">    enhancer &#x3D; preloadedState</span><br><span class="line">    preloadedState &#x3D; undefined</span><br><span class="line">  &#125;</span><br><span class="line">  if (typeof enhancer !&#x3D;&#x3D; &#39;undefined&#39;) &#123;</span><br><span class="line">    return enhancer(createStore)(reducer, preloadedState)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šè¿° createStore æºç å‘ç°ï¼ŒapplyMiddleware ä¼šè¿›è¡Œ <code>applyMiddleware(thunk, logger)(createStore)(reducer, preloadedState)</code> çš„è°ƒç”¨ã€‚</p><p><strong>applyMiddleware æºç å¦‚ä¸‹</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export default function applyMiddleware(...middlewares) &#123;</span><br><span class="line">    &#x2F;&#x2F; æŸ¯ç†åŒ–  ()&#x3D;&gt;()&#x3D;&gt;&#123;&#125;</span><br><span class="line">  return createStore &#x3D;&gt; (...args) &#x3D;&gt; &#123;</span><br><span class="line">    const store &#x3D; createStore(...args)  &#x2F;&#x2F;store  &#x3D;  &#123;getState,dispatch.....&#125;</span><br><span class="line">    let dispatch &#x3D; store.dispatch</span><br><span class="line">    let chain &#x3D; []</span><br><span class="line"></span><br><span class="line">    const middlewareAPI &#x3D; &#123;</span><br><span class="line">      getState: store.getState,                &#x2F;&#x2F; è°ƒç”¨ redux åŸç”Ÿæ–¹æ³•ï¼Œè·å–çŠ¶æ€</span><br><span class="line">      dispatch: (...args) &#x3D;&gt; dispatch(...args) &#x2F;&#x2F; è°ƒç”¨ redux åŸç”Ÿ dispatch æ–¹æ³•</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; ä¸²è¡Œ middleware</span><br><span class="line">    chain &#x3D; middlewares.map(middleware &#x3D;&gt; middleware(middlewareAPI)) &#x2F;&#x2F; thunkçš„å‚æ•°å‚æ•°æ­£æ˜¯ (&#123; dispatch, getState &#125;)</span><br><span class="line">    dispatch &#x3D; compose(...chain)(store.dispatch)</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      ...store,</span><br><span class="line">      dispatch &#x2F;&#x2F; è¿”å›åŠ å·¥è¿‡çš„ dispatch</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  &#x2F;&#x2F;ç„¶å &lt;Provider store&#x3D;&#123;store&#125; &#x2F;&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>dispatch æ˜¯å¦‚ä½•è¢«åŠ å·¥çš„</strong></p><p>compose çš„æºç </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...funcs</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> a(b(...args)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (&#123; dispatch, getState &#125;) =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// ç» compose æºç åˆ†æï¼Œæ­¤å¤„ next ä¸º Store.dispatch</span></span><br><span class="line">   <span class="comment">// action  ä¸º this.props.dispatch(`action`)</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> action(dispatch)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> next(action)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ middleware çš„å†…éƒ¨ä¸²è¡Œè°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼Œä»è€Œå®Œæˆäº† dispatch åŠŸèƒ½çš„å¢å¼º(æ”¯æŒå¦‚ this.props.dispatch(action) çš„è°ƒç”¨ä»¥åŠæ—¥å¿—åŠŸèƒ½)</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">action =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> action(dispatch)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> store.dispatch(action)</span><br><span class="line">  &#125;)(action)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>applyMiddlewareçš„æ ¸å¿ƒå°±æ˜¯ æ‰§è¡Œçš„createStore,åœ¨dispatché‡Œé¢æ·»åŠ ä¸€äº›æ–¹æ³•,æœ€åè¿”å›åŠ å·¥è¿‡çš„ dispatch,è¿™ä¸ªdispatch æœ‰ä¸­é—´ä»·çš„ä¸€äº›å¤„ç†</p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Koa2</title>
      <link href="/2019/02/15/workspace/Server/node/node-1/"/>
      <url>/2019/02/15/workspace/Server/node/node-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Koa2</strong></p><p>[[toc]]</p><h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><h4 id="path"><a href="#path" class="headerlink" title="path"></a>path</h4><p><strong>__filename</strong> å…¨å±€å€¼ï¼Œå½“å‰æ–‡ä»¶ç»å¯¹è·¯å¾„ module.filename === <strong>filename ç­‰ä»· <br/><br>**</strong>dirname** å…¨å±€å€¼ï¼Œå½“å‰æ–‡ä»¶å¤¹ç»å¯¹è·¯å¾„ã€‚ç­‰æ•ˆäºpath.resolve(__filename, â€˜..â€™)<br/><br><strong>path.join([â€¦paths])</strong> ç›¸å½“äºæŠŠæ‰€ä¼ å…¥çš„ä»»æ„å¤šçš„å‚æ•° æŒ‰ç…§é¡ºåº è¿›è¡Œå‘½ä»¤è¡Œèˆ¬çš„æ¨è¿›<br/><br><strong>path.resolve([â€¦paths])</strong> ä»¥å½“å‰æ–‡ä»¶çš„è·¯å¾„ä¸ºèµ·ç‚¹ï¼Œè¿”å›ç»å¯¹è·¯å¾„ã€‚å¯ä»¥ç†è§£ä¸ºæ¯æ¬¡éƒ½æ˜¯æ–°å»ºcdå‘½ä»¤<br/><br><strong>path.dirname(path)</strong> è¿”å›æŒ‡å®šè·¯å¾„æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„<br/><br><strong>path.basename(path)</strong> è¿”å›æŒ‡å®šPathè·¯å¾„æ‰€åœ¨æ–‡ä»¶çš„åå­—<br/><br><strong>path.extname(path)</strong> è·å–æŒ‡å®šå­—ç¬¦ä¸²æˆ–è€…æ–‡ä»¶è·¯å¾„åå­—çš„åç¼€åï¼Œå¸¦.æ¯”å¦‚.txt<br/><br><strong>path.isAbsolute(path)</strong> æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„,è¿”å›booleanå€¼<br/><br><strong>process.cwd()</strong>   è¿”å›è¿è¡Œå½“å‰è„šæœ¬çš„å·¥ä½œç›®å½•çš„è·¯å¾„ <br/><br><strong>process.chdir()</strong> æ”¹å˜å·¥ä½œç›®å½•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">path.join(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'../c/lolo'</span>) <span class="comment">// a/c/lolo</span></span><br><span class="line"></span><br><span class="line">path.resolve(<span class="string">'/a'</span>, <span class="string">'/b'</span>) <span class="comment">// '/b'</span></span><br><span class="line">path.resolve(<span class="string">'./a'</span>, <span class="string">'./b'</span>) <span class="comment">// '/User/../a/b'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> filePath = <span class="string">'./bar/baz/asdf/quux.html'</span></span><br><span class="line">path.basename(filePath) <span class="comment">// quux.html</span></span><br><span class="line">path.dirname(filePath) <span class="comment">// ./bar/baz/asdf</span></span><br><span class="line">path.extname(filePath) <span class="comment">// .html</span></span><br><span class="line">path.isAbsolute(filePath) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼Œæ–‡ä»¶è·¯å¾„æœ‰å¦‚ä¸‹ç»“æ„ï¼š</p><p>newapp &gt; demo &gt; hello.js</p><p>åœ¨hello.jsæ–‡ä»¶ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(__dirname);</span><br><span class="line"><span class="built_in">console</span>.log(__filename);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.filename===__filename);</span><br><span class="line"><span class="built_in">console</span>.log(process.cwd());</span><br><span class="line">process.chdir(<span class="string">'/Users/jerry'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(process.cwd());</span><br></pre></td></tr></table></figure><p>ç„¶åå®šä½åœ¨newappç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ node demo/hello.jsï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">/Users/jerry/<span class="number">51</span>talk/newapp/demo</span><br><span class="line">/Users/jerry/<span class="number">51</span>talk/newapp/demo/hello.js</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">/Users/jerry/<span class="number">51</span>talk/newapp</span><br><span class="line">/Users/jerry</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨HTTPæœåŠ¡"><a href="#å¯åŠ¨HTTPæœåŠ¡" class="headerlink" title="å¯åŠ¨HTTPæœåŠ¡"></a>å¯åŠ¨HTTPæœåŠ¡</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">app.listen(...)  <span class="comment">//æ–¹æ³•æ˜¯å¦‚ä¸‹çš„ä¸€ä¸ªè¯­æ³•ç³–ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const http = require('http')</span></span><br><span class="line"><span class="comment">// http.createServer(app.callback()).listen(3000)</span></span><br></pre></td></tr></table></figure><h4 id="å¼€å¯import"><a href="#å¼€å¯import" class="headerlink" title="å¼€å¯import"></a>å¼€å¯import</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'@babel/register'</span>)(&#123;</span><br><span class="line">    babelrc: <span class="literal">false</span>,</span><br><span class="line">    presets: [<span class="string">'@babel/preset-env'</span>],</span><br><span class="line">    plugins: [<span class="string">"@babel/plugin-transform-runtime"</span>]</span><br><span class="line">&#125;);</span><br><span class="line"> <span class="comment">//package.json</span></span><br><span class="line">devDependencies: &#123;</span><br><span class="line">    <span class="string">"@babel/core"</span>: <span class="string">"^7.4.5"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-transform-runtime"</span>: <span class="string">"^7.4.4"</span>,</span><br><span class="line">    <span class="string">"@babel/preset-env"</span>: <span class="string">"^7.4.5"</span>,</span><br><span class="line">    <span class="string">"@babel/register"</span>: <span class="string">"^7.4.4"</span>,</span><br><span class="line">    <span class="string">"@babel/runtime"</span>: <span class="string">"^7.4.5"</span>,</span><br><span class="line">    <span class="string">"nodemon"</span>: <span class="string">"^1.19.1"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Contextå¯¹è±¡"><a href="#Contextå¯¹è±¡" class="headerlink" title="Contextå¯¹è±¡"></a>Contextå¯¹è±¡</h4><p>Koa æä¾›ä¸€ä¸ª Context å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€æ¬¡å¯¹è¯çš„ä¸Šä¸‹æ–‡ï¼ˆåŒ…æ‹¬ HTTP è¯·æ±‚å’Œ HTTP å›å¤ï¼‰ã€‚é€šè¿‡åŠ å·¥è¿™ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥æ§åˆ¶è¿”å›ç»™ç”¨æˆ·çš„å†…å®¹</p><p><code>Context.response.body</code>å±æ€§å°±æ˜¯å‘é€ç»™ç”¨æˆ·çš„å†…å®¹</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="params">ctx</span> =&gt;</span> &#123; <span class="comment">//å¤„ç†è¯·æ±‚çš„ä¸­é—´ä»¶</span></span><br><span class="line">    ctx.response.body = <span class="string">"hello world"</span>;</span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p><code>ctx.response</code>ä»£è¡¨ <code>HTTP Response</code>ã€‚åŒæ ·åœ°ï¼Œ<code>ctx.request</code>ä»£è¡¨ <code>HTTP Request</code></p><h4 id="HTTP-Response-çš„ç±»å‹"><a href="#HTTP-Response-çš„ç±»å‹" class="headerlink" title="HTTP Response çš„ç±»å‹"></a>HTTP Response çš„ç±»å‹</h4><p>Koa é»˜è®¤çš„è¿”å›ç±»å‹æ˜¯<code>text/plain</code>ï¼Œå¦‚æœæƒ³è¿”å›å…¶ä»–ç±»å‹çš„å†…å®¹ï¼Œå¯ä»¥å…ˆç”¨<code>ctx.request.accepts</code>åˆ¤æ–­ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯å¸Œæœ›æ¥å—ä»€ä¹ˆæ•°æ®ï¼Œç„¶åä½¿ç”¨<code>ctx.response.type</code>æŒ‡å®šè¿”å›ç±»å‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&quot;koa&quot;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line"></span><br><span class="line">app.use(ctx &#x3D;&gt; &#123;</span><br><span class="line">    if (ctx.request.accepts(&#39;xml&#39;)) &#123;</span><br><span class="line">        ctx.response.type &#x3D; &#39;xml&#39;;</span><br><span class="line">        ctx.response.body &#x3D; &#39;&lt;data&gt;Hello World&lt;&#x2F;data&gt;&#39;;</span><br><span class="line">    &#125; else if (ctx.request.accepts(&#39;json&#39;)) &#123;</span><br><span class="line">        ctx.response.type &#x3D; &#39;json&#39;;</span><br><span class="line">        ctx.response.body &#x3D; &#123; data: &#39;Hello World&#39; &#125;;</span><br><span class="line">    &#125; else if (ctx.request.accepts(&#39;html&#39;)) &#123;</span><br><span class="line">        ctx.response.type &#x3D; &#39;html&#39;;</span><br><span class="line">        ctx.response.body &#x3D; &#39;&lt;p&gt;Hello World&lt;&#x2F;p&gt;&#39;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        ctx.response.type &#x3D; &#39;text&#39;;</span><br><span class="line">        ctx.response.body &#x3D; &#39;Hello World&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(3000);</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®å“åº”å¤´å’Œè¯·æ±‚å¤´"><a href="#è®¾ç½®å“åº”å¤´å’Œè¯·æ±‚å¤´" class="headerlink" title="è®¾ç½®å“åº”å¤´å’Œè¯·æ±‚å¤´"></a>è®¾ç½®å“åº”å¤´å’Œè¯·æ±‚å¤´</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®å“åº”å¤´</span></span><br><span class="line">ctx.set(<span class="string">'Content-Type'</span>, <span class="string">'application/zip'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ è¯·æ±‚å¤´</span></span><br><span class="line">ctx.append(<span class="string">'userName'</span>,<span class="string">'hzf'</span>);</span><br></pre></td></tr></table></figure><h4 id="ç½‘é¡µæ¨¡æ¿"><a href="#ç½‘é¡µæ¨¡æ¿" class="headerlink" title="ç½‘é¡µæ¨¡æ¿"></a>ç½‘é¡µæ¨¡æ¿</h4><p>å®é™…å¼€å‘ä¸­ï¼Œè¿”å›ç»™ç”¨æˆ·çš„ç½‘é¡µå¾€å¾€éƒ½å†™æˆæ¨¡æ¿æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥è®© Koa å…ˆè¯»å–æ¨¡æ¿æ–‡ä»¶ï¼Œç„¶åå°†è¿™ä¸ªæ¨¡æ¿è¿”å›ç»™ç”¨æˆ·</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&quot;koa&quot;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line">const fs &#x3D; require(&#39;fs&#39;);</span><br><span class="line"></span><br><span class="line">app.use(ctx &#x3D;&gt; &#123;</span><br><span class="line">    ctx.response.type &#x3D; &#39;html&#39;;</span><br><span class="line">    ctx.response.body &#x3D; fs.createReadStream(&#39;.&#x2F;public&#x2F;template.html&#39;);</span><br><span class="line">&#125;).listen(3000);</span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h3><p>ç½‘ç«™ä¸€èˆ¬éƒ½æœ‰å¤šä¸ªé¡µé¢ã€‚é€šè¿‡<code>ctx.request.path</code>å¯ä»¥è·å–ç”¨æˆ·è¯·æ±‚çš„è·¯å¾„ï¼Œç”±æ­¤å®ç°ç®€å•çš„è·¯ç”±</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&quot;koa&quot;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line">const fs &#x3D; require(&#39;fs&#39;);</span><br><span class="line"></span><br><span class="line">app.use(ctx &#x3D;&gt; &#123;</span><br><span class="line">    if (ctx.request.path !&#x3D;&#x3D; &#39;&#x2F;&#39;) &#123;</span><br><span class="line">        ctx.response.type &#x3D; &#39;html&#39;;</span><br><span class="line">        ctx.response.body &#x3D; &#39;&lt;a href&#x3D;&quot;&#x2F;&quot;&gt;Index Page1&lt;&#x2F;a&gt;&#39;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        ctx.response.body &#x3D; &#39;Hello World&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(3000);</span><br></pre></td></tr></table></figure><h4 id="koa-router-æ¨¡å—"><a href="#koa-router-æ¨¡å—" class="headerlink" title="koa-router æ¨¡å—"></a>koa-router æ¨¡å—</h4><p>åŸç”Ÿè·¯ç”±ç”¨èµ·æ¥ä¸å¤ªæ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å°è£…å¥½çš„<code>koa-router</code>æ¨¡å—</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&quot;koa&quot;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line">const fs &#x3D; require(&#39;fs&#39;);</span><br><span class="line">const route &#x3D; require(&#39;koa-router&#39;)();</span><br><span class="line"></span><br><span class="line">route.get(&quot;&#x2F;&quot;, ctx &#x3D;&gt; &#123;</span><br><span class="line">    ctx.response.type &#x3D; &#39;html&#39;;</span><br><span class="line">    ctx.response.body &#x3D; &#39;&lt;a href&#x3D;&quot;&#x2F;&quot;&gt;Index Page1&lt;&#x2F;a&gt;&#39;;</span><br><span class="line">&#125;)</span><br><span class="line">route.get(&quot;&#x2F;about&quot;, ctx &#x3D;&gt; &#123;</span><br><span class="line">    ctx.response.body &#x3D; &#39;Hello World&#39;;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()); &#x2F;&#x2F;ä½œç”¨ï¼šå¯åŠ¨è·¯ç”±</span><br><span class="line">app.use(router.allowedMethods());</span><br><span class="line">&#x2F;* ä½œç”¨ï¼š è¿™æ˜¯å®˜æ–¹æ–‡æ¡£çš„æ¨èç”¨æ³•,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°router.allowedMethods()ç”¨åœ¨äº†è·¯ç”±åŒ¹é…</span><br><span class="line">router.routes()ä¹‹å,ç›®çš„åœ¨äºï¼šæ ¹æ®ctx.status è®¾ç½®response å“åº”å¤´</span><br><span class="line">*&#x2F;</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><h4 id="è·¯ç”±ä¼ å€¼"><a href="#è·¯ç”±ä¼ å€¼" class="headerlink" title="è·¯ç”±ä¼ å€¼"></a>è·¯ç”±ä¼ å€¼</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://localhost:3000/api/1?type=123</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.query) <span class="comment">// &#123; type: '123' &#125;</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.path) <span class="comment">// /api/1</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.params) <span class="comment">// åŠ¨æ€è·¯ç”± -&gt;ç±»ä¼¼äº '/api/:_id'</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.body) <span class="comment">// é€šå¸¸æ˜¯ post method</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.cookies) <span class="comment">// need  cookie-parser middleware</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// extend http.IncomingMessage</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.url) <span class="comment">// /api/1?type=123</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.headers) <span class="comment">// header object</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.method) <span class="comment">// GET</span></span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="é™æ€èµ„æº"><a href="#é™æ€èµ„æº" class="headerlink" title="é™æ€èµ„æº"></a>é™æ€èµ„æº</h4><p>å¦‚æœç½‘ç«™æä¾›é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€å­—ä½“ã€æ ·å¼è¡¨ã€è„šæœ¬â€¦â€¦ï¼‰ï¼Œä¸ºå®ƒä»¬ä¸€ä¸ªä¸ªå†™è·¯ç”±å°±å¾ˆéº»çƒ¦ï¼Œä¹Ÿæ²¡å¿…è¦ã€‚koa-staticæ¨¡å—å°è£…äº†è¿™éƒ¨åˆ†çš„è¯·æ±‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; è®¿é—® http:&#x2F;&#x2F;localhost:3000&#x2F;index.html</span><br><span class="line">const Koa &#x3D; require(&quot;koa&quot;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">const serve &#x3D; require(&#39;koa-static&#39;);</span><br><span class="line"></span><br><span class="line">app.use(serve(process.cwd() + &#39;&#x2F;public&#39;));</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><h4 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h4><p>æœ‰äº›åœºåˆï¼ŒæœåŠ¡å™¨éœ€è¦é‡å®šå‘ï¼ˆ<code>redirect</code>ï¼‰è®¿é—®è¯·æ±‚ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·ç™»é™†ä»¥åï¼Œå°†ä»–é‡å®šå‘åˆ°ç™»é™†å‰çš„é¡µé¢ã€‚<code>ctx.response.redirect()</code>æ–¹æ³•å¯ä»¥å‘å‡ºä¸€ä¸ª<code>302</code>è·³è½¬(ä¸´æ—¶æ€§é‡å®šå‘)ï¼Œå°†ç”¨æˆ·å¯¼å‘å¦ä¸€ä¸ªè·¯ç”±</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&quot;koa&quot;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line">const route &#x3D; require(&quot;koa-router&quot;)();</span><br><span class="line"></span><br><span class="line">route.get(&quot;&#x2F;orderList&quot;, ctx &#x3D;&gt; &#123;</span><br><span class="line">    ctx.response.redirect(&#39;&#x2F;&#39;);</span><br><span class="line">    ctx.response.body &#x3D; &#39;&lt;a href&#x3D;&quot;&#x2F;&quot;&gt;Index Page&lt;&#x2F;a&gt;&#39;;</span><br><span class="line">&#125;)</span><br><span class="line">route.get(&quot;&#x2F;&quot;, ctx &#x3D;&gt; &#123;</span><br><span class="line">    ctx.response.body &#x3D; &quot;hello world&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(router.routes());</span><br><span class="line">app.use(router.allowedMethods());</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><h3 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h3><h4 id="ä¸­é—´ä»¶çš„æ¦‚å¿µ"><a href="#ä¸­é—´ä»¶çš„æ¦‚å¿µ" class="headerlink" title="ä¸­é—´ä»¶çš„æ¦‚å¿µ"></a>ä¸­é—´ä»¶çš„æ¦‚å¿µ</h4><p>Koa çš„æœ€å¤§ç‰¹è‰²ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ä¸ªè®¾è®¡ï¼Œå°±æ˜¯<code>ä¸­é—´ä»¶</code>ï¼ˆmiddlewareï¼‰</p><ul><li>åŸºæœ¬ä¸Šï¼ŒKoa æ‰€æœ‰çš„åŠŸèƒ½éƒ½æ˜¯é€šè¿‡ä¸­é—´ä»¶å®ç°çš„ï¼Œå‰é¢ä¾‹å­é‡Œé¢çš„routes()ä¹Ÿæ˜¯ä¸­é—´ä»¶</li><li>æ¯ä¸ªä¸­é—´ä»¶é»˜è®¤æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œ<code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Context å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯nextå‡½æ•°</code>ã€‚åªè¦è°ƒç”¨nextå‡½æ•°ï¼Œå°±å¯ä»¥æŠŠæ‰§è¡Œæƒè½¬äº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¦‚æœä¸­é—´ä»¶å†…éƒ¨æ²¡æœ‰è°ƒç”¨nextå‡½æ•°ï¼Œé‚£ä¹ˆæ‰§è¡Œæƒå°±ä¸ä¼šä¼ é€’ä¸‹å»</li></ul><p>å¤šä¸ªä¸­é—´ä»¶ä¼šå½¢æˆä¸€ä¸ª<code>æ ˆç»“æ„ï¼ˆmiddle stack</code>ï¼‰ï¼Œä»¥<code>â€å…ˆè¿›åå‡ºâ€ï¼ˆfirst-in-last-outï¼‰</code>çš„é¡ºåºæ‰§è¡Œ,çœ‹ä¸‹é¢çš„æ´‹è‘±æ¨¡å‹</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H4242d98115564b91a0f007f2c15125e24.jpg" alt=""></p><ul><li>æœ€å¤–å±‚çš„ä¸­é—´ä»¶é¦–å…ˆæ‰§è¡Œã€‚</li><li>è°ƒç”¨nextå‡½æ•°ï¼ŒæŠŠæ‰§è¡Œæƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</li><li>â€¦</li><li>æœ€å†…å±‚çš„ä¸­é—´ä»¶æœ€åæ‰§è¡Œã€‚</li><li>æ‰§è¡Œç»“æŸåï¼ŒæŠŠæ‰§è¡Œæƒäº¤å›ä¸Šä¸€å±‚çš„ä¸­é—´ä»¶ã€‚</li><li>â€¦</li><li>æœ€å¤–å±‚çš„ä¸­é—´ä»¶æ”¶å›æ‰§è¡Œæƒä¹‹åï¼Œæ‰§è¡Œnextå‡½æ•°åé¢çš„ä»£ç </li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> (ctx,next)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"1"</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"3"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.use(<span class="keyword">async</span> (ctx,next)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"2"</span>);</span><br><span class="line">  <span class="keyword">await</span> next()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"4"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœæ˜¯ï¼š1,2,4,3</span></span><br></pre></td></tr></table></figure><h4 id="å¼‚æ­¥ä¸­é—´ä»¶"><a href="#å¼‚æ­¥ä¸­é—´ä»¶" class="headerlink" title="å¼‚æ­¥ä¸­é—´ä»¶"></a>å¼‚æ­¥ä¸­é—´ä»¶</h4><p>å¦‚æœæœ‰å¼‚æ­¥æ“ä½œï¼ˆæ¯”å¦‚è¯»å–æ•°æ®åº“ï¼‰ï¼Œä¸­é—´ä»¶å°±å¿…é¡»å†™æˆ <strong>async</strong> å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> response = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">&#123;data, msg, status, code = <span class="number">200</span>,...option&#125;</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status || <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">this</span>.set(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>);</span><br><span class="line">        <span class="keyword">this</span>.body = &#123;</span><br><span class="line">            code: code,</span><br><span class="line">            msg,</span><br><span class="line">            data,</span><br><span class="line">            is_login: <span class="keyword">this</span>[<span class="string">'is_login'</span>],</span><br><span class="line">            ...option</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        ctx.send = render.bind(ctx);</span><br><span class="line">        <span class="keyword">await</span> next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> response</span><br></pre></td></tr></table></figure><h4 id="ä¸­é—´ä»¶çš„åˆæˆ"><a href="#ä¸­é—´ä»¶çš„åˆæˆ" class="headerlink" title="ä¸­é—´ä»¶çš„åˆæˆ"></a>ä¸­é—´ä»¶çš„åˆæˆ</h4><p>koa-composeæ¨¡å—å¯ä»¥å°†å¤šä¸ªä¸­é—´ä»¶åˆæˆä¸ºä¸€ä¸ª</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&#39;koa&#39;);</span><br><span class="line">const compose &#x3D; require(&#39;koa-compose&#39;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line"></span><br><span class="line">const logger &#x3D; (ctx, next) &#x3D;&gt; &#123;</span><br><span class="line">  console.log(&#96;$&#123;Date.now()&#125; $&#123;ctx.request.method&#125; $&#123;ctx.request.url&#125;&#96;);</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const main &#x3D; ctx &#x3D;&gt; &#123;</span><br><span class="line">  ctx.response.body &#x3D; &#39;Hello World&#39;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const middlewares &#x3D; compose([logger, main]);</span><br><span class="line"></span><br><span class="line">app.use(middlewares);</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h3><h4 id="500-é”™è¯¯"><a href="#500-é”™è¯¯" class="headerlink" title="500 é”™è¯¯"></a>500 é”™è¯¯</h4><p>å¦‚æœä»£ç è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé”™è¯¯ä¿¡æ¯è¿”å›ç»™ç”¨æˆ·ã€‚HTTP åå®šçº¦å®šè¿™æ—¶è¦è¿”å›500çŠ¶æ€ç </p><p>Koaæä¾›äº†<code>ctx.throw()</code>æ–¹æ³•ï¼Œç”¨æ¥æŠ›å‡ºé”™è¯¯ï¼Œ<code>ctx.throw(500)</code>å°±æ˜¯æŠ›å‡º500é”™è¯¯</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&#39;koa&#39;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line"></span><br><span class="line">const main &#x3D; ctx &#x3D;&gt; &#123;</span><br><span class="line">  ctx.throw(500);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.use(main);</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><p><code>ctx.response.status</code>è®¾ç½®æˆ404ï¼Œå°±ç›¸å½“äº<code>ctx.throw(404)</code>ï¼Œè¿”å›404é”™è¯¯</p><h4 id="å¤„ç†é”™è¯¯çš„ä¸­é—´ä»¶"><a href="#å¤„ç†é”™è¯¯çš„ä¸­é—´ä»¶" class="headerlink" title="å¤„ç†é”™è¯¯çš„ä¸­é—´ä»¶"></a>å¤„ç†é”™è¯¯çš„ä¸­é—´ä»¶</h4><p>ä¸ºäº†æ–¹ä¾¿å¤„ç†é”™è¯¯ï¼Œæœ€å¥½ä½¿ç”¨<code>try...catch</code>å°†å…¶æ•è·ã€‚ä½†æ˜¯ï¼Œä¸ºæ¯ä¸ªä¸­é—´ä»¶éƒ½å†™<code>try...catch</code>å¤ªéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥è®©æœ€å¤–å±‚çš„ä¸­é—´ä»¶ï¼Œè´Ÿè´£æ‰€æœ‰ä¸­é—´ä»¶çš„é”™è¯¯å¤„ç†</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const catchErr &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    return async (ctx, next) &#x3D;&gt; &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            await next();</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            ctx.status &#x3D; err.statusCode || err.status || 500;</span><br><span class="line">            ctx.body &#x3D; &#123;</span><br><span class="line">                msg: &quot;æœåŠ¡å™¨é”™è¯¯&quot;,</span><br><span class="line">                code: -1,</span><br><span class="line">                data:[]</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default catchErr</span><br><span class="line">app.use(catchErr);</span><br></pre></td></tr></table></figure><h4 id="error-äº‹ä»¶çš„ç›‘å¬"><a href="#error-äº‹ä»¶çš„ç›‘å¬" class="headerlink" title="error äº‹ä»¶çš„ç›‘å¬"></a>error äº‹ä»¶çš„ç›‘å¬</h4><p>è¿è¡Œè¿‡ç¨‹ä¸­ä¸€æ—¦å‡ºé”™ï¼ŒKoa ä¼šè§¦å‘ä¸€ä¸ªerroräº‹ä»¶ã€‚ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥å¤„ç†é”™è¯¯</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&#39;koa&#39;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line"></span><br><span class="line">const main &#x3D; ctx &#x3D;&gt; &#123;</span><br><span class="line">  ctx.throw(500);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.on(&#39;error&#39;, (err, ctx) &#x3D;&gt; &#123;</span><br><span class="line">  console.error(&#39;server error&#39;, err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(main);</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><h3 id="Web-çš„åŠŸèƒ½"><a href="#Web-çš„åŠŸèƒ½" class="headerlink" title="Web çš„åŠŸèƒ½"></a>Web çš„åŠŸèƒ½</h3><h4 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h4><p>ctx.cookiesç”¨æ¥è¯»å†™ Cookie</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ctx.cookies.set(name, value, [options])</span><br></pre></td></tr></table></figure><p>è®¿é—® <a href="http://127.0.0.1:3000" target="_blank" rel="noopener">http://127.0.0.1:3000</a> ï¼Œä½ ä¼šçœ‹åˆ°1 viewsã€‚åˆ·æ–°ä¸€æ¬¡é¡µé¢ï¼Œå°±å˜æˆäº†2 viewsã€‚å†åˆ·æ–°ï¼Œæ¯æ¬¡éƒ½ä¼šè®¡æ•°å¢åŠ 1</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&#39;koa&#39;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line"></span><br><span class="line">const main &#x3D; function(ctx) &#123;</span><br><span class="line">    const n &#x3D; Number(ctx.cookies.get(&#39;view&#39;) || 0) + 1;</span><br><span class="line">    ctx.cookies.set(&#39;view&#39;, n);</span><br><span class="line">    ctx.response.body &#x3D; n + &#39; views&#39;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(main);</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hc7a6ea6122f941e6875c29f19ed65996F.png" alt=""></p><h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><p><code>session</code> æ˜¯å¦ä¸€ç§è®°å½•å®¢æˆ·çŠ¶æ€çš„æœºåˆ¶ï¼Œä¸åŒçš„æ˜¯ <code>Cookie</code> ä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ï¼Œè€Œ <code>session</code> ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Š</p><p><strong>Session çš„å·¥ä½œæµç¨‹</strong></p><p>å½“æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨å¹¶å‘é€ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šåˆ›å»ºä¸€ä¸ª <code>session</code> å¯¹è±¡ï¼Œç”Ÿ æˆä¸€ä¸ªç±»ä¼¼äº <code>key,value</code> çš„é”®å€¼å¯¹ï¼Œ ç„¶åå°†<code>key(cookie)</code>è¿”å›åˆ°æµè§ˆå™¨(å®¢æˆ·)ç«¯ï¼Œæµè§ˆ å™¨ä¸‹æ¬¡å†è®¿é—®æ—¶ï¼Œæºå¸¦ <code>key(cookie)</code>ï¼Œæ‰¾åˆ°å¯¹åº”çš„ <code>session(value)</code>.</p><p><strong>koa-session çš„ä½¿ç”¨</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'koa-session'</span>);</span><br><span class="line"><span class="comment">// é€šè¿‡ä»»æ„å­—ç¬¦ä¸²ä¸ºåŸºå‡†è¿›è¡ŒåŠ å¯†ç®—æ³•çš„å­—ç¬¦ä¸²  base64</span></span><br><span class="line"><span class="comment">// keys ä½œç”¨åœ¨cookie çš„valueå€¼æ—¶åŠ å¯†åçš„å†…å®¹ </span></span><br><span class="line">app.keys = [<span class="string">'some secret hurr'</span>];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">  key: <span class="string">'koa:sess'</span>,  <span class="comment">// è®¾ç½® sessionçš„åå­— ä¹Ÿæ˜¯cookieä¸­key</span></span><br><span class="line">  maxAge: <span class="number">86400000</span>,</span><br><span class="line">  autoCommit: <span class="literal">true</span>,</span><br><span class="line">  overwrite: <span class="literal">true</span>, </span><br><span class="line">  httpOnly: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦å…è®¸å®¢æˆ·ç«¯æ“ä½œcookies true:ä¸å…è®¸ false å…è®¸</span></span><br><span class="line">  signed: <span class="literal">true</span>, <span class="comment">// æ•°å­—ç­¾åï¼Œä¿è¯æ•°æ®ä¸è¢«ä¿®æ”¹</span></span><br><span class="line">  rolling: <span class="literal">false</span>, <span class="comment">// è¿‡æœŸæ—¶é—´è®¿é—®é¡ºå»¶ï¼ŒæŒ‡çš„æ˜¯æ•°æ®å­˜å‚¨è¿‡æœŸåï¼›æ—¶å€™å¦ç»§ç»­åŠ æ—¶é—´ false ä¸é¡ºå»¶  true é¡ºå»¶</span></span><br><span class="line">  renew: <span class="literal">false</span>, </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.use(session(CONFIG, app));</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®å€¼ </span></span><br><span class="line">ctx.session.username = <span class="string">"å¼ ä¸‰"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å€¼ </span></span><br><span class="line">ctx.session.username</span><br></pre></td></tr></table></figure><p><strong>Cookie å’Œ Session å…³ç³»</strong></p><p>coolies çš„value ä¸ºsession å­˜çš„å†…å®¹ï¼Œè¿‡ç¨‹ç»è¿‡äº†è¯·æ±‚ä¸å“åº”<br>é€šè¿‡cookies ä¸sessionå­˜å‚¨æ•°æ®ï¼›å¯ä»¥çŸ¥é“å½“å‰ç™»å½•çš„æ˜¯å“ªä¸ªç”¨æˆ·</p><p><strong>Cookie å’Œ Session åŒºåˆ«</strong></p><ul><li>cookie æ•°æ®å­˜æ”¾åœ¨å®¢æˆ·çš„æµè§ˆå™¨ä¸Šï¼Œsession æ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Š</li><li>cookie ä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„ COOKIE å¹¶è¿›è¡Œ COOKIE æ¬ºéª— è€ƒè™‘åˆ°å®‰å…¨åº”å½“ä½¿ç”¨ session</li><li>sessionä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—®å¢å¤šï¼Œä¼šæ¯”è¾ƒå ç”¨ä½ æœåŠ¡å™¨çš„æ€§èƒ½ è€ƒè™‘åˆ°å‡è½»æœåŠ¡å™¨æ€§èƒ½æ–¹é¢ï¼Œåº”å½“ä½¿ç”¨ COOKIE</li><li>å•ä¸ª cookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4Kï¼Œå¾ˆå¤šæµè§ˆå™¨éƒ½é™åˆ¶ä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜ 20 ä¸ª cookie</li></ul><h4 id="JWT-Json-Web-Token"><a href="#JWT-Json-Web-Token" class="headerlink" title="JWT(Json Web Token)"></a>JWT(Json Web Token)</h4><p><a href="https://www.npmjs.com/package/jsonwebtoken" target="_blank" rel="noopener">JWT</a> æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç”¨äºç®€æ´ï¼Œè‡ªåŒ…å«çš„ç”¨äºé€šä¿¡åŒæ–¹ä¹‹é—´ä»¥ JSON å¯¹è±¡çš„å½¢å¼å®‰å…¨ä¼ é€’ä¿¡æ¯çš„æ–¹æ³•ã€‚JWT å¯ä»¥ä½¿ç”¨ HMAC ç®—æ³•æˆ–è€…æ˜¯ RSA çš„å…¬é’¥å¯†é’¥å¯¹è¿›è¡Œç­¾åã€‚å®ƒå…·å¤‡ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>ç®€æ´(Compact)å¯ä»¥é€šè¿‡URL, POST å‚æ•°æˆ–è€…åœ¨ HTTP header å‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦å¿«</li><li>è‡ªåŒ…å«(Self-contained) è´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“</li><li>JWTçš„ä¸»è¦ä½œç”¨åœ¨äº<ul><li>å¯é™„å¸¦ç”¨æˆ·ä¿¡æ¯ï¼Œåç«¯ç›´æ¥é€šè¿‡JWTè·å–ç›¸å…³ä¿¡æ¯ã€‚</li><li>ä½¿ç”¨æœ¬åœ°ä¿å­˜ï¼Œé€šè¿‡HTTP Headerä¸­çš„<code>Authorization</code>ä½æäº¤éªŒè¯ã€‚</li></ul></li></ul><p><strong>koa-jwtçš„å·¥ä½œæµç¨‹</strong></p><ul><li>ç”¨æˆ·é€šè¿‡ç™»å½•Apiè·å–å½“å‰ç”¨æˆ·åœ¨æœ‰æ•ˆæœŸå†…çš„token</li><li>éœ€è¦èº«ä»½éªŒè¯çš„APIåˆ™éƒ½éœ€è¦æºå¸¦æ­¤å‰è®¤è¯è¿‡çš„tokenå‘é€è‡³æœåŠ¡ç«¯</li><li><code>koa2</code>ä¼šåˆ©ç”¨<code>koa-jwt</code>ä¸­é—´ä»¶çš„é»˜è®¤éªŒè¯æ–¹å¼è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸­é—´ä»¶ä¼šè¿›è¡ŒéªŒè¯æˆåŠŸå’ŒéªŒè¯å¤±è´¥çš„åˆ†æµã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// koa-jwtçš„é»˜è®¤éªŒè¯æ–¹å¼: </span></span><br><span class="line">&#123;<span class="string">'authorization'</span>: <span class="string">"Bearer "</span> + token&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨</strong></p><ol><li>å®‰è£…ä¾èµ–</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add jsonwebtoken koa-jwt</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¸­é—´ä»¶ è¯·æ±‚éªŒè¯token<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸­é—´ä»¶å¯¹tokenè¿›è¡ŒéªŒè¯</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ä¸ç”¨</span></span><br><span class="line">    <span class="comment">// let token = ctx.header.authorization;  // è§£å¯†æ“ä½œ</span></span><br><span class="line">    <span class="comment">// let payload = await jwt.verify(token, customConfig.passportJwt);</span></span><br><span class="line">    <span class="keyword">return</span> next().catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err.status === <span class="number">401</span>) &#123;</span><br><span class="line">            ctx.status = <span class="number">401</span>;</span><br><span class="line">            ctx.body = &#123;</span><br><span class="line">                code: <span class="number">401</span>,</span><br><span class="line">                msg: err.message</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li>æ’é™¤ä¸éªŒè¯çš„è¯·æ±‚<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.use(koajwt(&#123; <span class="attr">secret</span>: SECRET &#125;).unless(&#123;</span><br><span class="line">    path: [<span class="regexp">/^\/api\/login/</span>,/^\/api\/register/]   <span class="comment">// ç™»å½•æ³¨å†Œæ¥å£ä¸éœ€è¦éªŒè¯</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></li><li>ç™»é™†ç­¾å‘token</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> customConfig = &#123;</span><br><span class="line">    passportJwt: <span class="string">'xxxxxxxxxx'</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> token = jwt.sign(&#123;</span><br><span class="line">         username:<span class="string">'xx'</span>,</span><br><span class="line">         password:<span class="string">'xx'</span>,</span><br><span class="line">         admin: <span class="literal">true</span>,</span><br><span class="line">         exp: <span class="built_in">Math</span>.floor(<span class="built_in">Date</span>.now() / <span class="number">1000</span>) + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>), <span class="comment">// è¿‡æœŸæ—¶é—´ç§’,</span></span><br><span class="line">    &#125;,</span><br><span class="line">    customConfig.passportJwt, <span class="comment">// åŠ å¯†</span></span><br><span class="line">    <span class="comment">// &#123;expiresIn: '1h'&#125;  ä¹Ÿå¯ä»¥è¿™ä¹ˆè®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">ctx.body = &#123;</span><br><span class="line">    code: <span class="number">200</span>,</span><br><span class="line">    msg: <span class="string">'ç™»å½•æˆåŠŸ'</span>,</span><br><span class="line">    token: token</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¡¨å•-POST"><a href="#è¡¨å•-POST" class="headerlink" title="è¡¨å• (POST)"></a>è¡¨å• (POST)</h4><p>Webåº”ç”¨ç¦»ä¸å¼€å¤„ç†è¡¨å•ã€‚æœ¬è´¨ä¸Šï¼Œè¡¨å•å°±æ˜¯<code>POST</code>æ–¹æ³•å‘é€åˆ°æœåŠ¡å™¨çš„é”®å€¼å¯¹ã€‚<code>koa-bodyparser</code>æ¨¡å—å¯ä»¥ç”¨æ¥ä» POST è¯·æ±‚çš„æ•°æ®ä½“é‡Œé¢æå–é”®å€¼å¯¹</p><p><strong>åŸç”Ÿ Nodejs è·å– post æäº¤æ•°æ®</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function parsePostData(ctx)&#123;</span><br><span class="line">    return new Promise((resolve,reject)&#x3D;&gt;&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            let postdata&#x3D;&quot;&quot;;</span><br><span class="line">            ctx.req.on(&#39;data&#39;,(data)&#x3D;&gt;&#123;</span><br><span class="line">                postdata +&#x3D; data</span><br><span class="line">            &#125;)</span><br><span class="line">            ctx.req.on(&quot;end&quot;,function()&#123;</span><br><span class="line">                resolve(postdata);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;catch(error)&#123;</span><br><span class="line">            reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Koa ä¸­ koa-bodyparser ä¸­é—´ä»¶çš„ä½¿ç”¨</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Koa &#x3D; require(&#39;koa&#39;);</span><br><span class="line">import bodyParser from &quot;koa-bodyparser&quot;;</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line"></span><br><span class="line">const main &#x3D; async function(ctx) &#123;</span><br><span class="line">  const body &#x3D; ctx.request.body;</span><br><span class="line">  if (!body.name) ctx.throw(400, &#39;.name required&#39;);</span><br><span class="line">  ctx.body &#x3D; &#123; name: body.name &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.use(bodyParser(&#123;</span><br><span class="line">    enableTypes: [&#39;json&#39;, &#39;form&#39;, &#39;text&#39;]</span><br><span class="line">&#125;));</span><br><span class="line">app.use(main);</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><p>æ‰“å¼€å‘½ä»¤è¡Œçª—å£ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X POST --data &quot;name&#x3D;Jack&quot; 127.0.0.1:3000</span><br><span class="line">&#123;&quot;name&quot;:&quot;Jack&quot;&#125;</span><br><span class="line"></span><br><span class="line">$ curl -X POST --data &quot;name&quot; 127.0.0.1:3000</span><br><span class="line">name required</span><br></pre></td></tr></table></figure><p><strong>Koa-bodyæ¨¡å—</strong></p><p>Koa2ä¸­åˆ©ç”¨<code>Koa-body</code>ä»£æ›¿<code>koa-bodyparser</code>å’Œ<code>koa-multer</code>ã€‚åŸæ¥é€šè¿‡<code>koa-bodyparser</code>æ¥æ‰“åŒ…<code>Post</code>è¯·æ±‚çš„æ•°æ®ï¼Œé€šè¿‡<code>koa-multe</code>ræ¥å¤„ç†<code>multipar</code>tçš„æ–‡ä»¶;ä½¿ç”¨<code>koa-body</code>åï¼Œ<code>ctx.request.files</code>è·å¾—Postä¸­çš„æ–‡ä»¶ä¿¡æ¯ã€‚<code>ctx.request.body</code>è·å¾—Postä¸Šä¼ çš„è¡¨å•ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; æ·»åŠ koaBodyä¸­é—´ä»¶</span><br><span class="line">app.use(</span><br><span class="line">  koaBody(&#123;</span><br><span class="line">    &#x2F;&#x2F; å¦‚æœéœ€è¦ä¸Šä¼ æ–‡ä»¶,multipart: true</span><br><span class="line">    &#x2F;&#x2F;ã€€ä¸è®¾ç½®æ— æ³•ä¼ é€’æ–‡ä»¶</span><br><span class="line">    multipart: true,</span><br><span class="line">    formidable: &#123;</span><br><span class="line">      maxFileSize: 10 * 1024 * 1024  &#x2F;&#x2F; è®¾ç½®ä¸Šä¼ æ–‡ä»¶å¤§å°æœ€å¤§é™åˆ¶ï¼Œé»˜è®¤2M</span><br><span class="line">    &#125;,</span><br><span class="line">    patchKoa: true</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h4><p>å®ç°æ–‡ä»¶ä¸Šä¼ çš„ä¸­é—´ä»¶æœ‰3ä¸ª</p><ul><li>koa-body </li><li>busboy </li><li>koa-multer </li></ul><p>å› ä¸ºä¸Šé¢POSTç”¨äº† <code>koa-body</code> ï¼Œè¿™é‡Œè¿˜ç»§ç»­ç”¨<code>koa-body</code>ï¼Œä½¿ç”¨æ–¹å¼è·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸åœ¨å†™äº†</p><p>ä½¿ç”¨koa-bodyä¸­é—´ä»¶åï¼Œå³å¯é€šè¿‡<code>ctx.request.files</code>è·å–ä¸Šä¼ çš„æ–‡ä»¶</p><p><strong>æé†’ï¼š</strong> <br/><br>æ–°ç‰ˆæœ¬çš„koa-bodyé€šè¿‡ctx.request.filesè·å–ä¸Šä¼ çš„æ–‡ä»¶ <br/><br>æ—§ç‰ˆæœ¬çš„koa-bodyé€šè¿‡ctx.request.body.filesè·å–ä¸Šä¼ çš„æ–‡ä»¶ <br/></p><p><strong>ä¸Šä¼ å•ä¸ªæ–‡ä»¶</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">'/uploadfile'</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = ctx.request.files.file; <span class="comment">// è·å–ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">   <span class="comment">// è·å–ä¸Šä¼ æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">  <span class="keyword">let</span> filePath = path.join(__dirname, <span class="string">'public/upload/'</span>) + <span class="string">`/<span class="subst">$&#123;file.name&#125;</span>`</span>;</span><br><span class="line">  <span class="comment">// åˆ›å»ºå¯è¯»æµ</span></span><br><span class="line">  <span class="keyword">const</span> reader = fs.createReadStream(file.path);</span><br><span class="line">  <span class="comment">// åˆ›å»ºå¯å†™æµ</span></span><br><span class="line">  <span class="keyword">const</span> upStream = fs.createWriteStream(filePath);</span><br><span class="line">  <span class="comment">// å¯è¯»æµé€šè¿‡ç®¡é“å†™å…¥å¯å†™æµ</span></span><br><span class="line">  reader.pipe(upStream);</span><br><span class="line">  <span class="keyword">return</span> ctx.body = <span class="string">"ä¸Šä¼ æˆåŠŸï¼"</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">'/uploadfiles'</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> filePaths = [];</span><br><span class="line">  <span class="comment">// ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> files = ctx.request.files.file; <span class="comment">// è·å–ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">    <span class="comment">// è·å–ä¸Šä¼ æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">    <span class="keyword">let</span> filePath = path.join(__dirname, <span class="string">'public/upload/'</span>) + <span class="string">`/<span class="subst">$&#123;file.name&#125;</span>`</span>;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¯è¯»æµ</span></span><br><span class="line">    <span class="keyword">const</span> reader = fs.createReadStream(file.path);</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¯å†™æµ</span></span><br><span class="line">    <span class="keyword">const</span> upStream = fs.createWriteStream(filePath);</span><br><span class="line">    <span class="comment">// å¯è¯»æµé€šè¿‡ç®¡é“å†™å…¥å¯å†™æµ</span></span><br><span class="line">    reader.pipe(upStream);</span><br><span class="line">    filePaths.push(filePath);</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="keyword">return</span> ctx.body = filePaths</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="nodemailer"><a href="#nodemailer" class="headerlink" title="nodemailer"></a>nodemailer</h4><p><strong>å‘é€é‚®ä»¶</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> transporter = nodemailer.createTransport(&#123;</span><br><span class="line">    host: <span class="string">'smtp.163.com'</span>,</span><br><span class="line">    service: <span class="string">'smtp.163.com'</span>, <span class="comment">// ä½¿ç”¨äº†å†…ç½®ä¼ è¾“å‘é€é‚®ä»¶ æŸ¥çœ‹æ”¯æŒåˆ—è¡¨ï¼šhttps://nodemailer.com/smtp/well-known/</span></span><br><span class="line">    port: <span class="number">465</span>, <span class="comment">// SMTP ç«¯å£</span></span><br><span class="line">    secureConnection: <span class="literal">true</span>, <span class="comment">// ä½¿ç”¨äº† SSL</span></span><br><span class="line">    auth: &#123; <span class="comment">//ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        user: <span class="string">'xxxxxx@163.com'</span>,</span><br><span class="line">        pass: <span class="string">'xxxxxx'</span>, <span class="comment">// smtpæˆæƒç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> title = <span class="string">'æ ‡é¢˜'</span>;</span><br><span class="line"><span class="keyword">let</span> mailOptions = &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">`&lt;feng960106@163.com&gt;`</span>,</span><br><span class="line">    to: <span class="string">`feng960106@163.com`</span>, <span class="comment">// `1 | 2 | 3` å¤šä¸ªé‚®ç®±</span></span><br><span class="line">    subject: title || <span class="string">'è‡ªåŠ¨å‘é‚®ä»¶'</span>,</span><br><span class="line">    text: <span class="built_in">JSON</span>.stringify(params),</span><br><span class="line">    html: <span class="string">'htmlæ¨¡æ¿'</span>,</span><br><span class="line">    <span class="comment">//é™„ä»¶ä¿¡æ¯</span></span><br><span class="line">    attachments:[</span><br><span class="line">      &#123;</span><br><span class="line">        filename:<span class="string">''</span>,</span><br><span class="line">        path:<span class="string">''</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    transporter.sendMail(mailOptions, (error, info) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (error) <span class="keyword">return</span> reject(error);</span><br><span class="line">        resolve(info)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ctx.send(&#123;</span><br><span class="line">        msg: info,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ctx.send(&#123;</span><br><span class="line">        msg: err,</span><br><span class="line">        code: <span class="number">-1</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="koa-compress"><a href="#koa-compress" class="headerlink" title="koa-compress"></a>koa-compress</h4><p><strong>å‹ç¼©æ•°æ®</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> compress = <span class="built_in">require</span>(<span class="string">'koa-compress'</span>);</span><br><span class="line"> </span><br><span class="line">app.use(compress(&#123;</span><br><span class="line">    <span class="comment">//åªæœ‰åœ¨è¯·æ±‚çš„content-typeä¸­æœ‰gzipç±»å‹ï¼Œæˆ‘ä»¬æ‰ä¼šè€ƒè™‘å‹ç¼©</span></span><br><span class="line">    filter: <span class="function"><span class="keyword">function</span> (<span class="params">content_type</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="regexp">/text/i</span>.test(content_type);</span><br><span class="line">    &#125;,</span><br><span class="line">    threshold: <span class="number">1024</span>*<span class="number">2</span>, <span class="comment">//é˜€å€¼ï¼Œå½“æ•°æ®è¶…è¿‡2kbçš„æ—¶å€™ï¼Œå¯ä»¥å‹ç¼©</span></span><br><span class="line">    flush: <span class="built_in">require</span>(<span class="string">'zlib'</span>).Z_SYNC_FLUSH</span><br><span class="line">&#125;));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä½¿ç”¨</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    ctx.compress = <span class="literal">true</span>; <span class="comment">//æ˜¯å¦å‹ç¼©æ•°æ®</span></span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h3><h4 id="async-awaitåctx-bodyå¤±æ•ˆ"><a href="#async-awaitåctx-bodyå¤±æ•ˆ" class="headerlink" title="async/awaitåctx.bodyå¤±æ•ˆ"></a>async/awaitåctx.bodyå¤±æ•ˆ</h4><p><strong>äº‹ç”±</strong></p><p>åœ¨åšssrçš„æ—¶å€™ï¼Œåœ¨Promise.all()é‡Œé¢è¿”å›çš„ctx.bodyæ²¡æœ‰å€¼ï¼Œä½†æ˜¯èƒ½æ‰“å°å‡ºæ¥</p><p><strong>åŸå› </strong></p><p>ä¸­é—´ä»¶åœ¨è°ƒç”¨next()çš„æ—¶å€™ å¹¶æ²¡æœ‰æŠŠnextå½“ä½œä¸€ä¸ªå¼‚æ­¥å‡½æ•°ä½¿ç”¨ã€‚å› æ­¤ä½ åœ¨promiseä¸­å¼‚æ­¥èµ‹å€¼äº†ctx.bodyï¼Œä½†æ˜¯ç”±äºnextå‡½æ•°æ²¡æœ‰ç­‰ä½ ï¼Œåœ¨ä½ èµ‹å€¼ä¹‹å‰è¿™ä¸€ç½‘ç»œè¯·æ±‚å°±å·²ç»å®Œæˆäº†ã€‚</p><p><strong>è§£å†³åŠæ³•</strong></p><ol><li>ä½¿ç”¨å¼‚æ­¥çš„ä¸­é—´ä»¶<code>async/awaitå’Œpromise</code></li><li>æ£€æŸ¥ä½ çš„ä¸­é—´ä»¶çš„nextå‡½æ•°æ˜¯å¦ç­‰å¾…äº†ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Server </category>
          
          <category> NodeJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Koa2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitæ¢å¤ä¸Šä¸€æ¬¡çš„ä¿®æ”¹</title>
      <link href="/2019/02/11/workspace/Git/git-cherry/"/>
      <url>/2019/02/11/workspace/Git/git-cherry/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Gitæ¢å¤ä¸Šä¸€æ¬¡çš„ä¿®æ”¹</strong></p><p>[[toc]]</p><h3 id="æŸ¥çœ‹è°ä¿®æ”¹çš„ä»£ç "><a href="#æŸ¥çœ‹è°ä¿®æ”¹çš„ä»£ç " class="headerlink" title="æŸ¥çœ‹è°ä¿®æ”¹çš„ä»£ç "></a>æŸ¥çœ‹è°ä¿®æ”¹çš„ä»£ç </h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git blame</span><br><span class="line">æ¯”å¦‚å¤šäººåä½œçš„æƒ…å†µä¸‹çº¿ä¸Šå‡ºé—®é¢˜äº†ï¼Œå¯ä»¥é€šè¿‡git blameæ¸…æ¥šçš„çŸ¥é“æ˜¯è°å¯¹æ–‡ä»¶è¿›è¡Œäº†ä¿®æ”¹äº†ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­:</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;(1)ç¬¬ä¸€æ­¥è¿›å…¥åˆ°æˆ‘ä»¬çš„æœ¬åœ°gitä»“åº“</span><br><span class="line">git branch -a</span><br><span class="line">&#x2F;&#x2F;(2)å‡å¦‚æˆ‘ä»¬æ˜¯è¦æŸ¥çœ‹è¿œç¨‹çš„daily&#x2F;1.1.68åˆ†æ”¯çš„ä¿®æ”¹æƒ…å†µï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</span><br><span class="line">git checkout  remotes&#x2F;origin&#x2F;daily&#x2F;1.1.68</span><br><span class="line">&#x2F;&#x2F;(3)æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯src&#x2F;pages&#x2F;item&#x2F;ItemTable&#x2F;ItemTable.jsæ–‡ä»¶çš„ä¿®æ”¹</span><br><span class="line">git blame src&#x2F;pages&#x2F;item&#x2F;ItemTable&#x2F;ItemTable.js</span><br><span class="line">&#x2F;&#x2F;(4)æ­¤æ—¶ä¼šæ˜¾ç¤ºæ¯ä¸€è¡Œä»£ç çš„ä¿®æ”¹è€…</span><br></pre></td></tr></table></figure><h3 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git log</span><br><span class="line"></span><br><span class="line">ä¸‹é¢åªæ˜¯ç»™å‡ºå‡ ç§æ˜¾ç¤ºlogçš„æ–¹å¼ï¼š</span><br><span class="line">&#x2F;&#x2F;å‹ç¼©æ¨¡å¼ï¼Œåœ¨æ¯ä¸ªæäº¤çš„æ—è¾¹æ˜¾ç¤ºç»è¿‡ç²¾ç®€çš„æäº¤å“ˆå¸Œç å’Œæäº¤ä¿¡æ¯ï¼Œä»¥ä¸€è¡Œæ˜¾ç¤º</span><br><span class="line">git log --oneline</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å›¾å½¢æ¨¡å¼ï¼Œä½¿ç”¨è¯¥é€‰é¡¹ä¼šåœ¨è¾“å‡ºçš„å·¦è¾¹ç»˜åˆ¶ä¸€å¼ åŸºäºæ–‡æœ¬æ ¼å¼çš„å†å²ä¿¡æ¯è¡¨ç¤ºå›¾ã€‚å¦‚æœä½ æŸ¥çœ‹çš„æ˜¯å•ä¸ªåˆ†æ”¯çš„å†å²è®°å½•çš„è¯ï¼Œè¯¥é€‰é¡¹æ— æ•ˆ</span><br><span class="line">git log --graph</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; æ˜¾ç¤ºæ‰€æœ‰åˆ†æ”¯çš„å†å²è®°å½•</span><br><span class="line">git log --all</span><br></pre></td></tr></table></figure><h3 id="git-reset-amp-æ’¤å›å›é€€çš„ä»£ç "><a href="#git-reset-amp-æ’¤å›å›é€€çš„ä»£ç " class="headerlink" title="git reset &amp; æ’¤å›å›é€€çš„ä»£ç "></a>git reset &amp; æ’¤å›å›é€€çš„ä»£ç </h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">git reflog + git cherry-pick</span><br><span class="line"></span><br><span class="line">åœºæ™¯: ä½ æäº¤äº†å‡ ä¸ªcommitï¼Œç„¶åç”¨ git reset --hard æ’¤é”€äº†è¿™äº›ä¿®æ”¹ï¼Œæ¥ç€ä½ åˆæ„è¯†åˆ°ï¼šä½     å¸Œ  æœ›è¿˜åŸè¿™äº›ä¿®æ”¹ï¼</span><br><span class="line">    åŸç†: git reflog å¯¹äºæ¢å¤é¡¹ç›®å†å²æ˜¯ä¸€ä¸ªè¶…æ£’çš„èµ„æºã€‚ä½ å¯ä»¥æ¢å¤å‡ ä¹ä»»ä½•ä¸œè¥¿ â€” ä»»ä½•ä½ commit è¿‡çš„ä¸œè¥¿ â€” åªè¦é€šè¿‡ reflogã€‚</span><br><span class="line"></span><br><span class="line">ä½ å¯èƒ½å·²ç»ç†Ÿæ‚‰äº† git log å‘½ä»¤ï¼Œå®ƒ*ä¼šæ˜¾ç¤ºcommitçš„åˆ—è¡¨*ã€‚ git reflog ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡å®ƒæ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ª*HEADå‘ç”Ÿæ”¹å˜çš„æ—¶é—´åˆ—è¡¨*ã€‚</span><br><span class="line"></span><br><span class="line">ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span>)å®ƒæ¶‰åŠçš„åªæ˜¯*HEADçš„æ”¹å˜*ã€‚åœ¨ä½ åˆ‡æ¢åˆ†æ”¯ã€ç”¨git commitè¿›è¡Œæäº¤ã€ä»¥åŠç”¨ git resetæ’¤é”€ commitæ—¶ï¼ŒHEADä¼šæ”¹å˜ï¼Œä½†å½“ä½ ç”¨ git checkout -- æ’¤é”€æ—¶(åªæ˜¯æ›¿æ¢æ–‡ä»¶ï¼Œåˆ†æ”¯ä¸å˜)ï¼ŒHEAD å¹¶ä¸ä¼šæ”¹å˜ â€” å¦‚å‰æ‰€è¿°ï¼Œè¿™äº›ä¿®æ”¹ä»æ¥æ²¡æœ‰è¢«æäº¤è¿‡ï¼Œå› æ­¤reflog ä¹Ÿæ— æ³•å¸®åŠ©æˆ‘ä»¬æ¢å¤å®ƒä»¬ã€‚</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)git reflogä¸ä¼šæ°¸è¿œä¿æŒã€‚Git ä¼šå®šæœŸæ¸…ç†é‚£äº› â€œç”¨ä¸åˆ°çš„â€ å¯¹è±¡ã€‚ä¸è¦æŒ‡æœ›å‡ ä¸ªæœˆå‰çš„æäº¤è¿˜ä¸€ç›´èººåœ¨é‚£é‡Œã€‚</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)ä½ çš„reflogå°±æ˜¯ä½ çš„ï¼Œåªæ˜¯ä½ çš„ã€‚ä½ ä¸èƒ½ç”¨ git reflog æ¥æ¢å¤å¦ä¸€ä¸ªå¼€å‘è€…æ²¡æœ‰ push è¿‡çš„ commitã€‚</span><br><span class="line"></span><br><span class="line">ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸ªä¾‹å­:</span><br><span class="line"></span><br><span class="line"><span class="comment">//(1)ç¬¬ä¸€æ¬¡ä¿®æ”¹å¹¶æäº¤</span></span><br><span class="line">git add -A</span><br><span class="line">git commit -m <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//(2)ç¬¬äºŒæ¬¡ä¿®æ”¹å’Œæäº¤</span></span><br><span class="line">git add -A</span><br><span class="line">git commit -m <span class="string">"2"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//(3)ç¬¬ä¸‰æ¬¡ä¿®æ”¹å’Œæäº¤</span></span><br><span class="line">git add -A</span><br><span class="line">git commit -m <span class="string">"3"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//(4)å–æ¶ˆç¬¬ä¸‰æ¬¡æäº¤</span></span><br><span class="line">git reset --hard HEAD~<span class="number">1</span></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼šæ­¤æ—¶è¿è¡Œgit logä¼šæ²¡æœ‰ç¬¬ä¸‰æ¬¡æäº¤çš„logä¿¡æ¯ï¼Œä½†æ˜¯reflogå´å¯ä»¥çœ‹åˆ°HEADæŒ‡é’ˆçš„ç§»åŠ¨å†å²</span></span><br><span class="line">ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹git reflogçš„HEADçš„æ”¹å˜å†å²:</span><br><span class="line"></span><br><span class="line">å¦‚æœæˆ‘ä»¬è¦æ¢å¤ä¸Šä¸€æ¬¡çš„ä¿®æ”¹åªè¦æ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤å°±å¯ä»¥äº†:</span><br><span class="line"></span><br><span class="line">git cherry-pick <span class="number">52e3</span>fa6</span><br><span class="line"><span class="comment">//52e3fa6è¡¨ç¤ºç¬¬ä¸‰æ¬¡çš„ä¿®æ”¹çš„hash</span></span><br><span class="line">æ­¤æ—¶è¿è¡Œäº†git cherry-pickä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡git logå¯ä»¥çœ‹åˆ°ç¬¬ä¸‰æ¬¡çš„æäº¤ä¿¡æ¯äº†ã€‚</span><br></pre></td></tr></table></figure><h3 id="Tagå›é€€ä»£ç "><a href="#Tagå›é€€ä»£ç " class="headerlink" title="Tagå›é€€ä»£ç "></a>Tagå›é€€ä»£ç </h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git commit -m&#39;1.0.0&#39;</span><br><span class="line"></span><br><span class="line">git tag v1.0.0 &#x2F;&#x2F;æ‰“tag</span><br><span class="line"></span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line">git push origin --tags  or git push origin v1.0.0 &#x2F;&#x2F;æœ¬åœ°tagæ¨é€åˆ°çº¿ä¸Š</span><br><span class="line"></span><br><span class="line">git tag  &#x2F;&#x2F;æŸ¥çœ‹æ‰€æœ‰çš„tag</span><br><span class="line"></span><br><span class="line">git tag -d v1.0.0 &#x2F;&#x2F;æœ¬åœ°åˆ é™¤tag</span><br><span class="line"></span><br><span class="line">git push origin :refs&#x2F;tags&#x2F;v1.0.0  &#x2F;&#x2F;æœ¬åœ°tagåˆ é™¤äº†ï¼Œå†æ‰§è¡Œè¯¥å¥ï¼Œåˆ é™¤çº¿ä¸Štag</span><br><span class="line"></span><br><span class="line">git checkout v1.0.0 &#x2F;&#x2F;åˆ‡æ¢tag,å®Œæˆä»£ç å›é€€</span><br><span class="line"></span><br><span class="line">git show 1.0.0  or git show v1.0.0^&#123;tree&#125;&#x2F;&#x2F;æŸ¥çœ‹ç›¸å…³ä¿¡æ¯</span><br></pre></td></tr></table></figure><p>::: danger ç‰¹åˆ«æ³¨æ„<br> é€šè¿‡æ ‡ç­¾å›é€€ç‰ˆæœ¬åï¼Œå°½é‡ä¸è¦æ”¹åŠ¨ä»£ç ï¼Œå¦‚æœä¸€å®šè¦ä¿®æ”¹ä»£ç <code>å¿…é¡»é©¬ä¸Šæ‹‰ä¸€ä¸ªåˆ†æ”¯</code>ï¼Œç„¶åå½“å‰çš„ä¸»å¹²çš„åˆ†æ”¯ç«‹å³å›åˆ°åŸæ¥çš„ä½ç½®ï¼Œå¦åˆ™æ­£åœ¨å¼€å‘çš„åˆ†æ”¯å¯èƒ½ç™½å¹²äº†ï¼Œå¹¶ä¸”ä¸èƒ½æŠŠæ”¹åŠ¨çš„ä»£ç åˆå¹¶åˆ°ä¸»å¹²ï¼Œæ¥ç€åœ¨åˆšæ‹‰çš„åˆ†æ”¯ä¸Šæ”¹bug,ä¿®æ”¹å®Œæ¯•ååˆå¹¶åœ¨ä¸»å¹²ä¸Š<br>:::</p><p><code>å¦‚æœä½ é€šè¿‡æ ‡ç­¾å›é€€ç‰ˆæœ¬åï¼Œç«‹é©¬æ”¹äº†å½“å‰çš„åˆ†æ”¯ï¼Œå¾ˆä¸å¹¸ä½ å°±æˆåŠŸçš„pushä¸åˆ°Gitä¸Šäº†ï¼Œçœ‹æç¤ºçš„é”™è¯¯ï¼š</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hint: Updates were rejected because the remote contains work that you do</span><br><span class="line">hint: not have locally. This is usually caused by another repository pushing</span><br><span class="line">hint: to the same ref. You may want to first integrate the remote changes</span><br><span class="line">hint: (e.g., &#39;git pull ...&#39;) before pushing again.</span><br><span class="line">hint: See the &#39;Note about fast-forwards&#39; in &#39;git push --help&#39; for details.</span><br><span class="line">&#x2F;&#x2F;æ›´æ–°è¢«æ‹’ç»ï¼Œå› ä¸ºè¿œç¨‹åŒ…å«æ‚¨æ‰€åšçš„å·¥ä½œ,å¤§è‡´æ„æ€å°±æ˜¯ä½ ä¹‹å‰çš„æäº¤çš„é‚£ä¸ªåº“æŒ‡å‘åŒä¸€å¼•ç”¨ï¼Œä¸”ä½äºä¸€ä¸ªç‰ˆæœ¬ï¼Œè¦ä½ é›†æˆè¿œç¨‹æ›´æ”¹</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰å¦‚ä¸‹å‡ ç§è§£å†³æ–¹æ³•ï¼š</p></blockquote><p><strong>1ï¼šä½¿ç”¨å¼ºåˆ¶pushçš„æ–¹æ³•ï¼š</strong></p><p>git push -u origin [name] -f </p><p>å¤ªæš´åŠ›ï¼Œå³°å“¥ä¸å–œæ¬¢ ï¼Œè¿™æ ·ä¼šä½¿è¿œç¨‹ä¿®æ”¹ä¸¢å¤±ï¼Œä¸€èˆ¬æ˜¯ä¸å¯å–çš„ï¼Œå°¤å…¶æ˜¯å¤šäººåä½œå¼€å‘çš„æ—¶å€™ã€‚</p><p><strong>2ï¼špushå‰å…ˆå°†è¿œç¨‹repositoryä¿®æ”¹pullä¸‹æ¥</strong></p><p>git pull origin [name]</p><p>ä¸€èˆ¬ä¼šè®©ä½ è§£å†³å†²çªï¼Œç„¶åè¿˜è¦mergeä¸€å †ç ´äº‹,ä¸è¿‡è¿™ä¸ªå†²çªæ€»æ˜¯è¦è§£å†³çš„ï¼Œä½ å°±çœ‹çœ‹æ˜¯ä½ è§£å†³è¿˜æ˜¯ç­‰äººæ¥è§£å†³ã€‚</p><p><strong>3ï¼šè‹¥ä¸æƒ³mergeè¿œç¨‹å’Œæœ¬åœ°ä¿®æ”¹ï¼Œå¯ä»¥å…ˆåˆ›å»ºæ–°çš„åˆ†æ”¯ï¼š</strong></p><p>git checkout -b  [name]</p><p>ç„¶ågit push -u origin [name]  ä¸‡äº‹å¤§å‰ï¼Œå®åœ¨ä¸è¡ŒåæœŸä½ ç›´æ¥ git push origin â€“delete [name]ä¸ç•™ç—•è¿¹</p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cssçš„ä¸¤ç§ç›’æ¨¡å‹</title>
      <link href="/2019/01/21/workspace/Css/box-sizing/"/>
      <url>/2019/01/21/workspace/Css/box-sizing/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>[[toc]]</p><h3 id="cssçš„ä¸¤ç§ç›’æ¨¡å‹"><a href="#cssçš„ä¸¤ç§ç›’æ¨¡å‹" class="headerlink" title="cssçš„ä¸¤ç§ç›’æ¨¡å‹"></a>cssçš„ä¸¤ç§ç›’æ¨¡å‹</h3><h4 id="W3Cçš„æ ‡å‡†ç›’æ¨¡å‹"><a href="#W3Cçš„æ ‡å‡†ç›’æ¨¡å‹" class="headerlink" title="W3Cçš„æ ‡å‡†ç›’æ¨¡å‹"></a>W3Cçš„æ ‡å‡†ç›’æ¨¡å‹</h4><p>é»˜è®¤æ˜¯w3cæ ‡å‡†çš„</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H8a671283100a4512ba5ae28cdfe70b3b6.jpg" alt="ä»”ç»†çœ‹å›¾"></p><blockquote><p>åœ¨æ ‡å‡†çš„ç›’å­æ¨¡å‹ä¸­ï¼ŒwidthæŒ‡contentéƒ¨åˆ†çš„å®½åº¦</p></blockquote><h4 id="IEçš„ç›’æ¨¡å‹"><a href="#IEçš„ç›’æ¨¡å‹" class="headerlink" title="IEçš„ç›’æ¨¡å‹"></a>IEçš„ç›’æ¨¡å‹</h4><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H113065c568374278958356d8834155a1x.jpg" alt="ä»”ç»†çœ‹å›¾"></p><blockquote><p>åœ¨IEç›’å­æ¨¡å‹ä¸­ï¼Œwidthè¡¨ç¤ºcontent+padding+borderè¿™ä¸‰ä¸ªéƒ¨åˆ†çš„å®½åº¦</p></blockquote><h4 id="box-sizingçš„ä½¿ç”¨"><a href="#box-sizingçš„ä½¿ç”¨" class="headerlink" title="box-sizingçš„ä½¿ç”¨"></a>box-sizingçš„ä½¿ç”¨</h4><p>å¦‚æœæƒ³è¦åˆ‡æ¢ç›’æ¨¡å‹ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œéœ€è¦å€ŸåŠ©css3çš„box-sizingå±æ€§</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">box-sizing: content-box  <span class="comment">//æ˜¯W3Cç›’å­æ¨¡å‹</span></span><br><span class="line">box-sizing: border-box <span class="comment">//æ˜¯IEç›’å­æ¨¡å‹</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>cssç›’æ¨¡å‹<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.content</span> &#123;</span></span><br><span class="line">width: 300px;</span><br><span class="line">height: 400px;</span><br><span class="line"><span class="css"><span class="selector-tag">border</span>: 5<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#242424</span>;</span></span><br><span class="line">padding: 20px;</span><br><span class="line"><span class="css"><span class="selector-tag">background-color</span>: <span class="selector-id">#898989</span>;</span></span><br><span class="line"><span class="css">   <span class="comment">/*box-sizing: border-box;*/</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Immer</title>
      <link href="/2019/01/17/workspace/Frame/react/immer/"/>
      <url>/2019/01/17/workspace/Frame/react/immer/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Immer</strong></p><p>[[toc]]</p><h3 id="Reactä¸­æµ…å±‚æ¬¡æ‹·è´çš„é—®é¢˜"><a href="#Reactä¸­æµ…å±‚æ¬¡æ‹·è´çš„é—®é¢˜" class="headerlink" title="Reactä¸­æµ…å±‚æ¬¡æ‹·è´çš„é—®é¢˜"></a>Reactä¸­æµ…å±‚æ¬¡æ‹·è´çš„é—®é¢˜</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> detail = &#123;<span class="attr">name</span>:<span class="string">'å’ŒæŒ¯å³°'</span>,<span class="attr">school</span>:&#123;<span class="attr">loc</span>:<span class="string">'shijaizhuang'</span>&#125;&#125;</span><br><span class="line"><span class="keyword">const</span> copy = <span class="built_in">Object</span>.assign(&#123;&#125;,detail);</span><br><span class="line">copy.school.loc =<span class="string">"åŒ—äº¬"</span>;</span><br><span class="line"><span class="comment">//æ­¤æ—¶ä½ ä¼šå‘ç°æˆ‘ä»¬çš„detail.school.locä¹Ÿå˜æˆäº†"åŒ—äº¬"äº†</span></span><br><span class="line">copy.school === detail.school</span><br><span class="line"><span class="comment">//æ­¤æ—¶copy.schoolå’Œdetail.schoolæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¼•ç”¨ç›¸åŒï¼Œä¸€ä¸ªå€¼è¢«ä¿®æ”¹é‚£ä¹ˆå¦ä¸€ä¸ªåŒæ ·è¢«ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>è¦è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œä¸€å®šè¦æ·±å…‹éš†ï¼Œè€Œä¸æ˜¯æµ…å±‚æ¬¡çš„æ‹·è´</p><h3 id="Reactä¸­å¼•ç”¨ç±»å‹å¯¼è‡´ç»„ä»¶ä¸æ›´æ–°"><a href="#Reactä¸­å¼•ç”¨ç±»å‹å¯¼è‡´ç»„ä»¶ä¸æ›´æ–°" class="headerlink" title="Reactä¸­å¼•ç”¨ç±»å‹å¯¼è‡´ç»„ä»¶ä¸æ›´æ–°"></a>Reactä¸­å¼•ç”¨ç±»å‹å¯¼è‡´ç»„ä»¶ä¸æ›´æ–°</h3><p><strong>æ —å­</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        ff: &#123;</span><br><span class="line">            a: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">school</span>: &#123;</span><br><span class="line">                location: <span class="string">"jing999.cn"</span>,</span><br><span class="line">                name: <span class="string">"å’ŒæŒ¯å³°"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    add = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;ff&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="comment">// ff.school.name = 11;  //[1]</span></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            ff: &#123;</span><br><span class="line">                ...ff,</span><br><span class="line">                school: &#123;</span><br><span class="line">                    location: <span class="string">"jing999.cn"</span>,</span><br><span class="line">                    name: <span class="number">11</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;); <span class="comment">//[2]</span></span><br><span class="line">        <span class="comment">// let data = produce(ff, draft =&gt; &#123;</span></span><br><span class="line">        <span class="comment">//     draft.school.name = 11;</span></span><br><span class="line">        <span class="comment">// &#125;); //[3]</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    shouldComponentUpdate(nextProps, nextState, nextContext) &#123;</span><br><span class="line">        <span class="comment">//[1]è¿™é‡Œæ°¸è¿œæ˜¯true ,å› ä¸ºå†…å­˜åœ°å€æ˜¯å®Œå…¨ä¸€æ ·çš„</span></span><br><span class="line">        <span class="comment">//[2]è¿™é‡Œæ°¸è¿œæ˜¯false ,å› ä¸ºå…‹éš†ååœ°å€ä¸€ç›´åœ¨å˜</span></span><br><span class="line">        <span class="comment">//[3]åªæœ‰ç¬¬ä¸€æ¬¡æ˜¯false,åé¢ä¸ä¼šå˜ï¼Œå€¼å˜åŒ–åè·Ÿä¹‹å‰çš„ä¸€æ ·ï¼Œæ€§èƒ½æœ€é«˜</span></span><br><span class="line">        <span class="built_in">console</span>.log(nextState.ff === <span class="keyword">this</span>.state.ff);</span><br><span class="line">        <span class="keyword">if</span> (nextState.ff === <span class="keyword">this</span>.state.ff) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.add&#125;&gt;ç‚¹å‡»&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &#123;this.state.ff.school.name&#125;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index</span><br></pre></td></tr></table></figure><h3 id="ç®€ä»‹ä¸å¯å˜æ•°æ®"><a href="#ç®€ä»‹ä¸å¯å˜æ•°æ®" class="headerlink" title="ç®€ä»‹ä¸å¯å˜æ•°æ®"></a>ç®€ä»‹ä¸å¯å˜æ•°æ®</h3><p>Reactåœ¨å‡å°‘é‡å¤æ¸²æŸ“æ–¹é¢ç¡®å®æ˜¯æœ‰ä¸€å¥—ç‹¬ç‰¹çš„å¤„ç†åŠæ³•ï¼Œé‚£å°±æ˜¯è™šæ‹ŸDOMï¼Œä½†æ˜¾ç„¶åœ¨é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™Reactç»æ— å¯èƒ½è¶…è¶ŠåŸç”Ÿçš„é€Ÿåº¦ï¼Œæˆ–è€…ä¸€å®šèƒ½å°†å…¶å®ƒçš„æ¡†æ¶æ¯”ä¸‹å»ã€‚<br>ä½†æ˜¯æ¯æ¬¡æ•°æ®å˜åŠ¨éƒ½ä¼šæ‰§è¡Œrenderï¼Œå¤§å¤§å½±å“äº†æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨ç«¯ã€‚</p><p>JavaScript ä¸­çš„å¯¹è±¡ä¸€èˆ¬æ˜¯å¯å˜çš„ï¼ˆMutableï¼‰ï¼Œå› ä¸ºä½¿ç”¨äº†å¼•ç”¨èµ‹å€¼ï¼Œæ–°çš„å¯¹è±¡ç®€å•çš„å¼•ç”¨äº†åŸå§‹å¯¹è±¡ï¼Œæ”¹å˜æ–°çš„å¯¹è±¡å°†å½±å“åˆ°åŸå§‹å¯¹è±¡ã€‚å¦‚ foo={a: 1}; bar=foo; bar.a=2 ä½ ä¼šå‘ç°æ­¤æ—¶ foo.a ä¹Ÿè¢«æ”¹æˆäº† 2ã€‚è™½ç„¶è¿™æ ·åšå¯ä»¥èŠ‚çº¦å†…å­˜ï¼Œä½†å½“åº”ç”¨å¤æ‚åï¼Œè¿™å°±é€ æˆäº†éå¸¸å¤§çš„éšæ‚£ï¼ŒMutable å¸¦æ¥çš„ä¼˜ç‚¹å˜å¾—å¾—ä¸å¿å¤±ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ä½¿ç”¨ shallowCopyï¼ˆæµ…æ‹·è´ï¼‰æˆ– deepCopyï¼ˆæ·±æ‹·è´ï¼‰æ¥é¿å…è¢«ä¿®æ”¹ï¼Œä½†è¿™æ ·åšé€ æˆäº† CPU å’Œå†…å­˜çš„æµªè´¹ã€‚</p><p>ä¸å¯å˜æ•°æ®å°±æ˜¯ä¸€æ—¦åˆ›å»ºï¼Œå°±ä¸èƒ½å†è¢«ç›´æ¥æ›´æ”¹çš„æ•°æ®ã€‚å¯¹Immutable å¯¹è±¡çš„ä»»ä½•ä¿®æ”¹æˆ–æ·»åŠ åˆ é™¤æ“ä½œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„Immutableå¯¹è±¡ã€‚<br>Immutable å®ç°çš„åŸç†æ˜¯ Persistent Data Structureï¼ˆæŒä¹…åŒ–æ•°æ®ç»“æ„ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨æ—§æ•°æ®åˆ›å»ºæ–°æ•°æ®æ—¶ï¼Œè¦ä¿è¯æ—§æ•°æ®åŒæ—¶å¯ç”¨ä¸”ä¸å˜ã€‚åŒæ—¶ä¸ºäº†é¿å… deepCopy æŠŠæ‰€æœ‰èŠ‚ç‚¹éƒ½å¤åˆ¶ä¸€éå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œ<br>Immutable ä½¿ç”¨äº†Structural Sharingï¼ˆç»“æ„å…±äº«ï¼‰ï¼Œå³å¦‚æœå¯¹è±¡æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåªä¿®æ”¹è¿™ä¸ªèŠ‚ç‚¹å’Œå—å®ƒå½±å“çš„çˆ¶èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹åˆ™è¿›è¡Œå…±äº«ã€‚</p><p><code>Object.freeze()</code> æ–¹æ³•å¯ä»¥å†»ç»“ä¸€ä¸ªå¯¹è±¡ï¼Œå†»ç»“çš„å¯¹è±¡ä¸èƒ½æ·»åŠ æ–°çš„å±æ€§ï¼Œä¸èƒ½ä¿®æ”¹å…¶å·²æœ‰å±æ€§çš„å€¼ï¼Œä¸èƒ½åˆ é™¤å·²æœ‰å±æ€§ï¼Œä»¥åŠä¸èƒ½ä¿®æ”¹è¯¥å¯¹è±¡å·²æœ‰å±æ€§çš„å¯æšä¸¾æ€§ã€å¯é…ç½®æ€§ã€å¯å†™æ€§ã€‚å°è¯•ä¿®æ”¹ä¼šé™é»˜å¤±è´¥æˆ–æŠ›å‡ºTypeErrorç±»å‹çš„é”™è¯¯ã€‚ç›¸å…³å‡½æ•°è¿˜åŒ…æ‹¬ï¼š<br><code>Object.isExtensible()</code><br><code>Object.seal()</code> å’Œ<code>Object.defineProperty()</code>å‡ä¸ºES5ä¸­å®šä¹‰çš„æ–¹æ³•</p><h3 id="immerJS"><a href="#immerJS" class="headerlink" title="immerJS"></a>immerJS</h3><p>Immeræ˜¯mobxçš„ä½œè€…å†™çš„ä¸€ä¸ªimmutableåº“ï¼Œæ ¸å¿ƒå®ç°æ˜¯åˆ©ç”¨ ES6 çš„ <code>proxy</code>ï¼Œå‡ ä¹ä»¥æœ€å°çš„æˆæœ¬å®ç°äº†jsçš„ä¸å¯å˜æ•°æ®ç»“æ„</p><h4 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">"immer"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> baseState = [</span><br><span class="line">    &#123;</span><br><span class="line">        todo: <span class="string">"Learn typescript"</span>,</span><br><span class="line">        done: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        todo: <span class="string">"Try immer"</span>,</span><br><span class="line">        done: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nextState = produce(baseState, draftState =&gt; &#123;</span><br><span class="line">    draftState.push(&#123;<span class="attr">todo</span>: <span class="string">"Tweet about it"</span>&#125;)</span><br><span class="line">    draftState[<span class="number">1</span>].done = <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¸¦æ·±åº¦åˆå¹¶çš„ç»å…¸React.setState</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">onBirthDayClick1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">        user: &#123;</span><br><span class="line">            ...prevState.user,</span><br><span class="line">            age: prevState.user.age + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ...ä½†æ˜¯ï¼Œç”±äºsetStateæ¥å—å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"> * ä¸Šé¢ç›¸å½“äºæ‰€æœ‰çš„ä¸œè¥¿éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼Œç”¨immerjsä¼˜åŒ–å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">onBirthDayClick2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(</span><br><span class="line">        produce(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œåªæœ‰ageå‘ç”Ÿçš„å˜åŒ–ï¼Œstateé‡Œé¢çš„å€¼ï¼Œä»–ä»¬çš„å¼•ç”¨ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¸ä¼šå¼•èµ·ä¸å¿…è¦çš„æ›´æ–°</span></span><br><span class="line">            draft.user.age += <span class="number">1</span> </span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å›¾è§£"><a href="#å›¾è§£" class="headerlink" title="å›¾è§£"></a>å›¾è§£</h4><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H7060e5bd80e044aea4ccda0edcf06f8e7.png" alt=""></p><p>ä¸Šå›¾å¯ä»¥ï¼šimmer.jsçš„æ–¹æ³•ä¿®æ”¹äº†å¯¹è±¡çš„æŸä¸€ä¸ªå±æ€§çš„æ—¶å€™ï¼Œè¯¥å±æ€§çš„æ‰€æœ‰çš„çˆ¶çº§å±æ€§çš„å¼•ç”¨éƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè€Œå…¶ä»–å±æ€§çš„å¼•ç”¨éƒ½æ˜¯å…±äº«</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">nextState = produce(currentState, draftState =&gt; &#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>ä¸»è¦æ€æƒ³å°±æ˜¯å…ˆåœ¨currentStateåŸºç¡€ä¸Šç”Ÿæˆä¸€ä¸ªä»£ç†draftStateï¼Œä¹‹åçš„æ‰€æœ‰ä¿®æ”¹éƒ½ä¼šåœ¨draftStateä¸Šè¿›è¡Œï¼Œé¿å…ç›´æ¥ä¿®æ”¹currentStateï¼Œè€Œå½“ä¿®æ”¹ç»“æŸåï¼Œå†ä»draftStateåŸºç¡€ä¸Šç”ŸæˆnextStateã€‚</strong></p><p>Immerå†…éƒ¨ä½¿ç”¨Object.freeze()æ–¹æ³•,åªå†»ç»“nextStateè·ŸcurrentState<code>ç›¸æ¯”ä¿®æ”¹</code>çš„éƒ¨åˆ†</p><ul><li>ä¼˜ç‚¹:<ul><li>é™ä½äº† Mutable å¸¦æ¥çš„å¤æ‚åº¦</li><li>èŠ‚çœå†…å­˜</li><li>Undo/Redo (å› ä¸ºæ¯æ¬¡æ•°æ®éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œåªè¦æŠŠè¿™äº›æ•°æ®æ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œå‚¨å­˜èµ·æ¥ï¼Œæƒ³å›é€€åˆ°å“ªé‡Œå°±æ‹¿å‡ºå¯¹åº”æ•°æ®å³å¯ï¼Œå¾ˆå®¹æ˜“å¼€å‘å‡ºæ’¤é”€é‡åšè¿™ç§åŠŸèƒ½ã€‚)</li><li>æ‹¥æŠ±å‡½æ•°å¼ç¼–ç¨‹ (çº¯å‡½æ•°å¼ç¼–ç¨‹æ¯”é¢å‘å¯¹è±¡æ›´é€‚ç”¨äºå‰ç«¯å¼€å‘ã€‚å› ä¸ºåªè¦è¾“å…¥ä¸€è‡´ï¼Œè¾“å‡ºå¿…ç„¶ä¸€è‡´ï¼Œè¿™æ ·å¼€å‘çš„ç»„ä»¶æ›´æ˜“äºè°ƒè¯•å’Œç»„è£…ã€‚)</li></ul></li></ul><ul><li>å¯¹æ¯”ImmutableJS<ul><li>å¢åŠ äº†èµ„æºæ–‡ä»¶å¤§å°(å‹ç¼©åä»£ç å¤§å°16Kï¼Œimmeræ˜¯4k)</li><li>éœ€è¦ä½¿ç”¨è€…å­¦ä¹ å®ƒçš„æ•°æ®ç»“æ„æ“ä½œæ–¹å¼ï¼Œæ²¡æœ‰ Immer æä¾›çš„ä½¿ç”¨<code>åŸç”Ÿå¯¹è±¡</code>çš„æ“ä½œæ–¹å¼ç®€å•ã€æ˜“ç”¨ï¼›</li><li>å®ƒçš„æ“ä½œç»“æœéœ€è¦é€šè¿‡toJSæ–¹æ³•æ‰èƒ½å¾—åˆ°åŸç”Ÿå¯¹è±¡ï¼Œè¿™ä½¿å¾—åœ¨æ“ä½œä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæ—¶åˆ»è¦ä¸»è¦æ“ä½œçš„æ˜¯åŸç”Ÿå¯¹è±¡è¿˜æ˜¯ ImmutableJS çš„è¿”å›ç»“æœï¼Œç¨ä¸æ³¨æ„ï¼Œå°±ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„ bugã€‚</li></ul></li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="immutable-js"><a href="#immutable-js" class="headerlink" title="immutable.js"></a>immutable.js</h4><p>çœ‹çœ‹Immutableæ€ä¹ˆä½¿ç”¨çš„ï¼Œè°èƒ½ä¿è¯ä»¥åä¸€å®šä¸ç”¨è¿™ä¸ª</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Immutable <span class="keyword">from</span> <span class="string">"immutable"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>,<span class="attr">school</span>:&#123;</span><br><span class="line">    location:<span class="string">"shijiazhuang"</span>,</span><br><span class="line">    name :<span class="string">"å’ŒæŒ¯å³°"</span></span><br><span class="line"> &#125;&#125;);</span><br><span class="line"><span class="keyword">let</span> map2 = map1.set(<span class="string">'b'</span>, <span class="number">50</span>);<span class="comment">//æˆ‘è¿™é‡Œä»…ä»…è®¾ç½®äº†bçš„å€¼ï¼Œé‚£ä¹ˆå…¶ä»–çš„å€¼éƒ½ä¼šå…±äº«</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(map1) <span class="comment">//è¿”å›çš„æ˜¯ä¸€ä¸ªMapçš„å¯¹è±¡ï¼Œä¸èƒ½ç›´æ¥åœ¨åŸæ•°æ®æ›´æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'å¼•ç”¨ç›¸ç­‰'</span>,map1===map2); <span class="comment">//immutable.jsä¸­æ¯æ¬¡è¿”å›çš„å¼•ç”¨éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ­¤å¤„è¿”å›false</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'schoolçš„å¼•ç”¨æ²¡æœ‰å˜åŒ–'</span>,map2.school===map1.school);<span class="comment">//immutable.jsä¸­æ²¡æœ‰å˜åŒ–çš„å¯¹è±¡å°†ä¼šå…±äº«ï¼Œæ‰€ä»¥æ­¤å¤„è¿”å›true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> map3 = &#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>,<span class="attr">c</span>:<span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">let</span> map4 = map3; <span class="comment">//map4æ‹¿åˆ°çš„æ˜¯map3çš„æŒ‡é’ˆï¼Œæ‰€ä»¥ä¸€ä¸ªå˜åŒ–åå¦å¤–ä¸€ä¸ªä¹Ÿä¼šå˜åŒ–ï¼Œä½†æ˜¯å˜åŒ–çš„æ˜¯å€¼ï¼Œå¼•ç”¨æœ¬èº«æ˜¯ä¸å˜åŒ–çš„ï¼Œæ‰€ä»¥map3===map4è¿”å›true</span></span><br><span class="line">map4.c =<span class="number">4</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'map3===map4'</span>,map3===map4);</span><br></pre></td></tr></table></figure><h4 id="Immer-js"><a href="#Immer-js" class="headerlink" title="Immer.js"></a>Immer.js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">"immer"</span></span><br><span class="line"><span class="keyword">let</span> map1 = &#123;</span><br><span class="line">    a: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">school</span>: &#123;</span><br><span class="line">        location: <span class="string">"shijiazhuang"</span>,</span><br><span class="line">        name: <span class="string">"å’ŒæŒ¯å³°"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> map2 = produce(map1, draft =&gt; &#123;</span><br><span class="line">    draft.b = <span class="number">50</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(map2);  <span class="comment">//è·ŸæºåŸå¯¹è±¡ä¸€æ ·çš„ç±»å‹</span></span><br><span class="line"><span class="comment">// console.log(map2.a = 100); // Cannot assign to `read only` property 'a' of object  è¦ä¿æŒè·Ÿæºå¯¹è±¡ä¸€è‡´ï¼Œå€¼ç±»å‹ä¸èƒ½è¢«ä¿®æ”¹</span></span><br><span class="line"><span class="built_in">console</span>.log(map1 === map2);  <span class="comment">//false  æ­¤å¤„è·Ÿimmutableä¸€è‡´ï¼Œæ¯æ¬¡è¿”å›çš„å¼•ç”¨éƒ½æ˜¯ä¸ä¸€æ ·çš„</span></span><br><span class="line"><span class="built_in">console</span>.log(map1.school === map2.school);  <span class="comment">//æ²¡æœ‰å˜åŒ–çš„å¯¹è±¡å°†ä¼šå…±äº«</span></span><br><span class="line"><span class="built_in">console</span>.log(map2.school.name = <span class="number">1</span>);  <span class="comment">//schoolçš„å¼•ç”¨åœ°å€æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå¯ä»¥ä¿®æ”¹,åŒæ–¹å‘ç”Ÿå˜åŒ–  ä¸å»ºè®®ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ä¸ºä»€ä¹ˆä½ è¦åœ¨React.jsä¸­ä½¿ç”¨Immutable Dataç†Ÿæ‚‰React.jsçš„éƒ½åº”è¯¥çŸ¥é“ï¼ŒReact.jsæ˜¯ä¸€ä¸ªUI = f(states)çš„æ¡†æ¶ï¼Œä¸ºäº†è§£å†³æ›´æ–°çš„é—®é¢˜ï¼ŒReact.jsä½¿ç”¨äº†virtual domï¼Œvirtual domé€šè¿‡diffä¿®æ”¹domï¼Œæ¥å®ç°é«˜æ•ˆçš„domæ›´æ–°ã€‚å¬èµ·æ¥å¾ˆå®Œç¾å§ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ã€‚<br>å½“stateæ›´æ–°æ—¶ï¼Œå¦‚æœå­ç»„ä»¶æ•°æ®æ²¡å˜ï¼Œä½ ä¹Ÿä¼šå»åšvirtual domçš„diffï¼Œè¿™å°±äº§ç”Ÿäº†æµªè´¹ã€‚</p><ol><li>ä¸ React æ­é…ä½¿ç”¨ï¼ŒPure Render<br>ç†Ÿæ‚‰ React çš„éƒ½çŸ¥é“ï¼ŒReact åšæ€§èƒ½ä¼˜åŒ–æ—¶æœ‰ä¸€ä¸ªé¿å…é‡å¤æ¸²æŸ“çš„å¤§æ‹›ï¼Œå°±æ˜¯ä½¿ç”¨ <code>shouldComponentUpdate()</code>ï¼Œä½†å®ƒé»˜è®¤è¿”å› <code>true</code>ï¼Œå³å§‹ç»ˆä¼šæ‰§è¡Œ <code>render()</code> æ–¹æ³•ï¼Œç„¶ååš Virtual DOM æ¯”è¾ƒï¼Œå¹¶å¾—å‡ºæ˜¯å¦éœ€è¦åšçœŸå® DOM æ›´æ–°ï¼Œè¿™é‡Œå¾€å¾€ä¼šå¸¦æ¥å¾ˆå¤šæ— å¿…è¦çš„æ¸²æŸ“å¹¶æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</li></ol><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ <code>shouldComponentUpdate()</code> ä¸­ä½¿ç”¨ä½¿ç”¨ deepCopy å’Œ deepCompare æ¥é¿å…æ— å¿…è¦çš„ <code>render()</code>ï¼Œä½† <strong>deepCopy å’Œ deepCompare ä¸€èˆ¬éƒ½æ˜¯éå¸¸è€—æ€§èƒ½çš„</strong>ã€‚</p><ol start="2"><li>React å»ºè®®æŠŠ <code>this.state</code> å½“ä½œ Immutable çš„ï¼Œå› ä¸ºä¹‹å‰ä¿®æ”¹å‰éœ€è¦åšä¸€ä¸ª deepCopyï¼Œæ˜¾å¾—éº»çƒ¦</li><li>ä¸ Redux æ­é…ä½¿ç”¨</li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://immerjs.github.io/immer/docs/introduction" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://github.com/camsong/blog/issues/3" target="_blank" rel="noopener">Immutable è¯¦è§£åŠ React ä¸­å®è·µ</a></p><p><a href="http://file.jing999.cn/workspace/Project/immutable.html">seamless-immutable</a></p><p><a href="https://segmentfault.com/a/1190000015426465" target="_blank" rel="noopener">Immer.jsç®€æ</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é—®é¢˜éªŒè¯è§£æ</title>
      <link href="/2019/01/17/workspace/Frame/react/problem/"/>
      <url>/2019/01/17/workspace/Frame/react/problem/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>é—®é¢˜éªŒè¯è§£æ</strong></p><p>[[toc]]</p><h3 id="setStateä¸ºä»€ä¹ˆæ˜¯å¼‚æ­¥çš„ã€ä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼Ÿ"><a href="#setStateä¸ºä»€ä¹ˆæ˜¯å¼‚æ­¥çš„ã€ä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼Ÿ" class="headerlink" title="setStateä¸ºä»€ä¹ˆæ˜¯å¼‚æ­¥çš„ã€ä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼Ÿ"></a>setStateä¸ºä»€ä¹ˆæ˜¯å¼‚æ­¥çš„ã€ä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼Ÿ</h3><p>setStateæœ¬èº«çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯å› ä¸ºåœ¨reactçš„<strong>åˆæˆäº‹ä»¶</strong>ä¸é’©å­å‡½æ•°ä¸­æ‰§è¡Œé¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢æˆäº†æ‰€è°“çš„å¼‚æ­¥ï¼›</p><p>åœ¨åŸç”Ÿäº‹ä»¶ä¸setTimeoutä¸­æ˜¯åŒæ­¥çš„</p><p><strong>éªŒè¯ç»“æœ</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        num: <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.clickFunc();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŸç”Ÿç‚¹å‡»äº‹ä»¶çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">    clickFunc() &#123;</span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">'#btn'</span>).addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">num</span>: <span class="keyword">this</span>.state.num + <span class="number">1</span>&#125;);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.num);</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">num</span>: <span class="keyword">this</span>.state.num + <span class="number">1</span>&#125;);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.num,<span class="string">'æ‰“å°çš„æ˜¯å½“å‰å€¼'</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//setTimeout</span></span><br><span class="line">    addNumSet = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">num</span>: <span class="keyword">this</span>.state.num + <span class="number">1</span>&#125;);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.num);</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">num</span>: <span class="keyword">this</span>.state.num + <span class="number">1</span>&#125;);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.num, <span class="string">'æ‰“å°çš„æ˜¯å½“å‰å€¼'</span>);</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//åˆæˆäº‹ä»¶ã€é’©å­å‡½æ•°å†…è¿›è¡Œäº†æ‰¹é‡æ›´æ–°ä¼˜åŒ–</span></span><br><span class="line">    addNum = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">num</span>: <span class="keyword">this</span>.state.num + <span class="number">1</span>&#125;);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">num</span>: <span class="keyword">this</span>.state.num + <span class="number">1</span>&#125;);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.num, <span class="string">'æ‰“å°çš„æ˜¯ä¸Šä¸€æ¬¡çš„å€¼'</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;&gt;</span><br><span class="line">                &lt;h1&gt;&#123;<span class="keyword">this</span>.state.num&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* reactçš„åˆæˆäº‹ä»¶ *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;this.addNum&#125;&gt;Reactåˆæˆäº‹ä»¶çš„æŒ‰é’®&lt;/</span>button&gt;</span><br><span class="line">                &#123;<span class="comment">/* åŸç”ŸDOMäº‹ä»¶ */</span>&#125;</span><br><span class="line">                &lt;button id=<span class="string">'btn'</span>&gt;ç»‘å®šåŸç”ŸDOMäº‹ä»¶çš„æŒ‰é’®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* å®šæ—¶å™¨ *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;this.addNumSet&#125;&gt;å®šæ—¶å™¨&lt;/</span>button&gt;</span><br><span class="line">            &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Index;</span></span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hbb3d522c7afa45d894e583388f1615f4p.jpg" alt=""></p><h3 id="setStateä¹‹åéƒ½å‘ç”Ÿäº†ä»€ä¹ˆ"><a href="#setStateä¹‹åéƒ½å‘ç”Ÿäº†ä»€ä¹ˆ" class="headerlink" title="setStateä¹‹åéƒ½å‘ç”Ÿäº†ä»€ä¹ˆ"></a>setStateä¹‹åéƒ½å‘ç”Ÿäº†ä»€ä¹ˆ</h3><ul><li>åˆå¹¶ state</li><li>æ›´æ–° state</li><li>ç„¶åçœ‹ä¸šåŠ¡ä»£ç ä¸­æ˜¯å¦å®ç°ç”Ÿå‘½å‘¨æœŸæ–¹æ³• shouldComponentUpdate æœ‰åˆ™è°ƒç”¨ï¼Œå¦‚æœè¿”å›å€¼ä¸º false åˆ™åœæ­¢å¾€ä¸‹æ‰§è¡Œ</li><li>ç„¶åæ˜¯ç”Ÿå‘½å‘¨æœŸæ–¹æ³• componentWillUpdate</li><li>ç„¶åé€šè¿‡æ‹¿åˆ°æ–° state çš„ instance è°ƒç”¨ render æ–¹æ³•æ‹¿åˆ°æ–°çš„ element å’Œä¹‹æ—§çš„ element çš„èŠ‚ç‚¹å·®å¼‚ï¼Œç„¶åæ ¹æ®å·®å¼‚å¯¹ç•Œé¢è¿›è¡Œæœ€å°åŒ–é‡æ¸²æŸ“</li><li>åœ¨å·®å¼‚è®¡ç®—ç®—æ³•ä¸­ï¼ŒReact èƒ½å¤Ÿç›¸å¯¹ç²¾ç¡®åœ°çŸ¥é“å“ªäº›ä½ç½®å‘ç”Ÿäº†æ”¹å˜ä»¥åŠåº”è¯¥å¦‚ä½•æ”¹å˜ï¼Œè¿™å°±ä¿è¯äº†æŒ‰éœ€æ›´æ–°ï¼Œè€Œä¸æ˜¯å…¨éƒ¨é‡æ–°æ¸²æŸ“ã€‚</li></ul><h3 id="ä¼ å…¥-setState-å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¼ å…¥-setState-å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¼ å…¥ setState å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¼ å…¥ setState å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>è¯¥å‡½æ•°ä¼šåœ¨setStateå‡½æ•°è°ƒç”¨å®Œæˆå¹¶ä¸”<code>ç»„ä»¶å¼€å§‹é‡æ¸²æŸ“</code>çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥ç›‘å¬è¯¥å‡½æ•°æ˜¯å¦æ¸²æŸ“å®Œæˆï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(</span><br><span class="line">  &#123; <span class="attr">username</span>: <span class="string">'xxxx'</span> &#125;,</span><br><span class="line">  () =&gt; <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°å®Œæˆ'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="shouldComponentUpdate-çš„ä½œç”¨"><a href="#shouldComponentUpdate-çš„ä½œç”¨" class="headerlink" title="shouldComponentUpdate çš„ä½œç”¨"></a>shouldComponentUpdate çš„ä½œç”¨</h3><p>shouldComponentUpdate å…è®¸æˆ‘ä»¬æ‰‹åŠ¨åœ°åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œç»„ä»¶æ›´æ–°ï¼Œæ ¹æ®ç»„ä»¶çš„åº”ç”¨åœºæ™¯è®¾ç½®å‡½æ•°çš„åˆç†è¿”å›å€¼èƒ½å¤Ÿå¸®æˆ‘ä»¬<code>é¿å…ä¸å¿…è¦çš„æ›´æ–°</code>,å‡å°‘å‘ä¸‹diffçš„è§„æ¨¡ï¼Œå‡å°‘diffçš„æˆæœ¬</p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RouteråŸç†</title>
      <link href="/2019/01/17/workspace/Frame/react/react-router/"/>
      <url>/2019/01/17/workspace/Frame/react/react-router/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>RouteråŸç†</strong></p><p>[[toc]]</p><h3 id="react-router-å’Œ-react-router-dom"><a href="#react-router-å’Œ-react-router-dom" class="headerlink" title="react-router å’Œ react-router-dom"></a>react-router å’Œ react-router-dom</h3><ul><li>react-routeræ˜¯æµè§ˆå™¨å’ŒåŸç”Ÿåº”ç”¨çš„é€šç”¨éƒ¨åˆ†ã€‚</li><li>react-router-domæ˜¯ç”¨äºæµè§ˆå™¨çš„ã€‚</li><li>react-router-nativeæ˜¯ç”¨äºåŸç”Ÿåº”ç”¨çš„ã€‚</li><li>react-router-config æ˜¯ä¸€äº›é…ç½®ç›¸å…³</li></ul><h3 id="react-routerçš„åŸºæœ¬åŸç†"><a href="#react-routerçš„åŸºæœ¬åŸç†" class="headerlink" title="react-routerçš„åŸºæœ¬åŸç†"></a>react-routerçš„åŸºæœ¬åŸç†</h3><p>å®ç°<code>URL</code>ä¸<code>UI</code>ç•Œé¢çš„åŒæ­¥ã€‚å…¶ä¸­åœ¨<code>react-router</code>ä¸­ï¼Œ<code>URL</code>å¯¹åº”<code>Location</code>å¯¹è±¡ï¼Œè€Œ<code>UI</code>æ˜¯ç”±<code>react components</code>æ¥å†³å®šçš„ï¼Œè¿™æ ·å°±è½¬å˜æˆ<code>locationä¸components</code>ä¹‹é—´çš„åŒæ­¥é—®é¢˜</p><p>react-router è¿˜ç”¨åˆ°äº† <code>history</code> åº“ï¼Œè¿™ä¸ªåº“ä¸»è¦æ˜¯å¯¹ <code>hash</code> è·¯ç”±ã€<code>history</code> è·¯ç”±ã€<code>memory</code>è·¯ç”±çš„å°è£…</p><p><strong>çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> App=<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> [UI, setUI] = useState(<span class="string">'Login'</span>);</span><br><span class="line">  <span class="keyword">let</span> onClickLogin = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setUI(<span class="string">'Login'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> onClickRegister = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setUI(<span class="string">'Register'</span>) </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> showUI = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span>(UI) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'Login'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Login</span>/&gt;</span></span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'Register'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Register</span>/&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickLogin&#125;&gt;Login&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onClickRegister&#125;&gt;Register&lt;/</span>button&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">          &#123;showUI()&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå…¶å®å°±æ˜¯è·¯ç”±çš„é›å½¢äº†ï¼Œæ¯ä¸ªé¡µé¢å¯¹åº”ç€ä¸€ä¸ªç»„ä»¶ï¼Œç„¶ååœ¨ä¸åŒçŠ¶æ€ä¸‹å»åˆ‡æ¢ ã€‚</p><h3 id="ä½¿ç”¨-hash-æ¥åˆ‡æ¢"><a href="#ä½¿ç”¨-hash-æ¥åˆ‡æ¢" class="headerlink" title="ä½¿ç”¨ hash æ¥åˆ‡æ¢"></a>ä½¿ç”¨ hash æ¥åˆ‡æ¢</h3><p>å½“ç„¶æˆ‘ä»¬æ›´å¸Œæœ›çœ‹åˆ°çš„æ˜¯,<code>ä¸åŒ url -&gt; ä¸åŒé¡µé¢ -&gt; ä¸åŒç»„ä»¶</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> App=<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿›å…¥é¡µé¢æ—¶ï¼Œå…ˆåˆå§‹åŒ–å½“å‰ url å¯¹åº”çš„ç»„ä»¶å</span></span><br><span class="line">  <span class="keyword">let</span> hash = <span class="built_in">window</span>.location.hash</span><br><span class="line">  <span class="keyword">let</span> initUI = hash === <span class="string">'#login'</span> ? <span class="string">'login'</span> : <span class="string">'register'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> [UI, setUI] = useState(initUI);</span><br><span class="line">  <span class="keyword">let</span> onClickLogin = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setUI(<span class="string">'login'</span>)</span><br><span class="line">    <span class="built_in">window</span>.location.hash = <span class="string">'login'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> onClickRegister = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setUI(<span class="string">'register'</span>) </span><br><span class="line">    <span class="built_in">window</span>.location.hash = <span class="string">'register'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> showUI = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span>(UI) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'login'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Login</span>/&gt;</span></span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'register'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Register</span>/&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickLogin&#125;&gt;Login&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onClickRegister&#125;&gt;Register&lt;/</span>button&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">          &#123;showUI()&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å…¶å®å·²ç»æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚äº†ï¼Œå¦‚æœæˆ‘åœ¨åœ°å€æ é‡Œè¾“å…¥ <code>localhost:8080/#login</code>ï¼Œå°±ä¼šæ˜¾ç¤º<code>&lt;Login/&gt;</code>ã€‚ä½†æ˜¯è¿™ä¸ª â€œ#â€ ç¬¦å·ä¸å¤ªå¥½çœ‹ï¼Œå¦‚æœè¾“å…¥ <code>localhost:8080/login</code> å°±å®Œç¾äº†ã€‚</p><h3 id="ä½¿ç”¨-history-åˆ‡æ¢"><a href="#ä½¿ç”¨-history-åˆ‡æ¢" class="headerlink" title="ä½¿ç”¨ history åˆ‡æ¢"></a>ä½¿ç”¨ history åˆ‡æ¢</h3><p>å¹¸è¿çš„æ˜¯ <code>H5</code> æä¾›äº†ä¸€ä¸ªå¥½ç”¨çš„ <code>history API</code>ï¼Œä½¿ç”¨ <code>window.history.pushState()</code> ä½¿å¾—æˆ‘ä»¬å³å¯ä»¥ä¿®æ”¹ <code>url</code> ä¹Ÿå¯ä»¥ä¸åˆ·æ–°é¡µé¢ï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯è°ƒç”¨<code>history.pushState()</code>æˆ–<code>history.replaceState()</code>ä¸ä¼šè§¦å‘<strong>popstate</strong>äº‹ä»¶ã€‚åªæœ‰åœ¨åšå‡ºæµè§ˆå™¨åŠ¨ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œå¦‚ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨çš„å›é€€æŒ‰é’®ï¼ˆæˆ–è€…åœ¨Javascriptä»£ç ä¸­è°ƒç”¨history.back()æˆ–è€…history.forward()æ–¹æ³•ï¼‰</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> App=<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿›å…¥é¡µé¢æ—¶ï¼Œå…ˆåˆå§‹åŒ–å½“å‰ url å¯¹åº”çš„ç»„ä»¶å</span></span><br><span class="line">  <span class="keyword">let</span> pathname = <span class="built_in">window</span>.location.pathname</span><br><span class="line">  <span class="keyword">let</span> initUI = pathname === <span class="string">'/login'</span> ? <span class="string">'login'</span> : <span class="string">'register'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> [UI, setUI] = useState(initUI);</span><br><span class="line">  <span class="keyword">let</span> onClickLogin = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setUI(<span class="string">'login'</span>)</span><br><span class="line">    <span class="built_in">window</span>.history.pushState(<span class="literal">null</span>, <span class="string">''</span>, <span class="string">'/login'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> onClickRegister = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setUI(<span class="string">'register'</span>) </span><br><span class="line">    <span class="built_in">window</span>.history.pushState(<span class="literal">null</span>, <span class="string">''</span>, <span class="string">'/register'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> showUI = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span>(UI) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'login'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Login</span>/&gt;</span></span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'register'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Register</span>/&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickLogin&#125;&gt;Login&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onClickRegister&#125;&gt;Register&lt;/</span>button&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">          &#123;showUI()&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œä¸€ä¸ª <code>Router</code> å°±å·²ç»è¢«æˆ‘ä»¬å®ç°äº†ã€‚å½“ç„¶è¿™ä¸ª <code>Router</code> åŠŸèƒ½ä¸å¤šï¼Œä¸è¿‡è¿™å°±æ˜¯ <code>Vue Router</code> å’Œ <code>React Router</code> çš„æ€æƒ³ï¼Œä»–ä»¬æ˜¯åŸºäºæ­¤æ¥å¼€å‘æ›´å¤šçš„åŠŸèƒ½è€Œå·²ã€‚</p><h3 id="react-routerä½¿ç”¨"><a href="#react-routerä½¿ç”¨" class="headerlink" title="react-routerä½¿ç”¨"></a>react-routerä½¿ç”¨</h3><ul><li><p><code>BrowserRouter</code> è¿™æ˜¯å¯¹Routeræ¥å£çš„å®ç°ã€‚ä½¿å¾—é¡µé¢å’Œæµè§ˆå™¨çš„historyä¿æŒä¸€è‡´ã€‚å¦‚ï¼šwindow.locationã€‚</p></li><li><p><code>HashRouter</code> å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œåªæ˜¯ä½¿ç”¨çš„æ˜¯urlçš„hashéƒ¨åˆ†ï¼Œæ¯”å¦‚ï¼šwindow.location.hashã€‚</p></li><li><p><code>MemoryRouter</code>ï¼Œ å°±æ˜¯æ²¡æœ‰URLçš„æƒ…å†µ,åœ¨æŸäº›ç¯å¢ƒï¼ˆæ¯”å¦‚React Nativeï¼‰ä¸‹ï¼Œæ ¹æœ¬æ²¡æœ‰URLï¼Œåªèƒ½é Memoryé»˜é»˜è®°ä½å°±å¥½ã€‚</p></li><li><p><code>StaticRouter</code> åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ–¹æ¡ˆä¸­å¾ˆæœ‰ç”¨ï¼Œå› æ­¤ä½ç½®æ°¸è¿œä¸ä¼šå‘ç”Ÿå®é™…å˜åŒ–</p><p><strong>BrowserRouter</strong></p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">let</span> <span class="keyword">set</span>; // ä¿å­˜setUrlï¼Œå› ä¸ºç›‘å¬äº‹ä»¶å’±ä»¬å€¼åŠ å…¥ä¸€æ¬¡ï¼Œæ‰€ä»¥æ”¾å¤–é¢</span><br><span class="line">function popstate(e) &#123;</span><br><span class="line">  <span class="keyword">set</span>(window.location.pathname);</span><br><span class="line">&#125;</span><br><span class="line">// åˆ›å»ºcontext</span><br><span class="line">export const RouterContext = React.createContext(window.location.pathname);</span><br><span class="line"></span><br><span class="line">export default function(&#123; children &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> [url, setUrl] = useState(<span class="built_in">window</span>.location.pathname);</span><br><span class="line">  <span class="keyword">set</span> = setUrl;</span><br><span class="line"></span><br><span class="line">  window.addEventListener("popstate", popstate);</span><br><span class="line"></span><br><span class="line">  const router = &#123;</span><br><span class="line">    history: &#123;</span><br><span class="line">      push: <span class="function"><span class="keyword">function</span>(<span class="params">url, state, title</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">window</span>.history.pushState(state, title, url);</span><br><span class="line">        setUrl(url);</span><br><span class="line">      &#125;,</span><br><span class="line">      replace: <span class="function"><span class="keyword">function</span>(<span class="params">url, state, title</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">window</span>.history.replaceState(state, title, url);</span><br><span class="line">        setUrl(url);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// ä¸‹é¢ä¹Ÿéœ€è¦åµŒå…¥setUrlï¼Œæš‚ä¸å¤„ç†</span></span><br><span class="line">      go: <span class="built_in">window</span>.history.go,</span><br><span class="line">      goBack: <span class="built_in">window</span>.history.back,</span><br><span class="line">      goForward: <span class="built_in">window</span>.history.forward,</span><br><span class="line">      length: <span class="built_in">window</span>.history.length</span><br><span class="line">    &#125;,</span><br><span class="line">    url: url</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;RouterContext.Provider value=&#123;router&#125;&gt;&#123;children&#125;&lt;<span class="regexp">/RouterContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="Route"><a href="#Route" class="headerlink" title="Route"></a>Route</h4><ul><li><code>path</code>å±æ€§ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå®ƒçš„å€¼å°±æ˜¯ç”¨æ¥åŒ¹é…urlçš„ã€‚</li><li><code>component</code>å±æ€§ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªç»„ä»¶ã€‚åœ¨pathåŒ¹é…æˆåŠŸä¹‹åä¼šç»˜åˆ¶è¿™ä¸ªç»„ä»¶ã€‚</li><li><code>exact</code>å±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨æ¥æŒ‡æ˜è¿™ä¸ªè·¯ç”±æ˜¯ä¸æ˜¯æ’ä»–çš„åŒ¹é…ã€‚</li><li><code>render</code>å±æ€§ï¼Œä¸€ä¸ªè¿”å›Reactç»„ä»¶çš„æ–¹æ³•ã€‚ä¼ è¯´ä¸­çš„rencer-propå°±æ˜¯ä»è¿™é‡Œæ¥çš„ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouterContext &#125; <span class="keyword">from</span> <span class="string">"./BrowserRouter"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Route</span>(<span class="params">&#123; component, path &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–context</span></span><br><span class="line">  <span class="keyword">const</span> &#123; history, url &#125; = useContext(RouterContext);</span><br><span class="line">  <span class="keyword">const</span> match = &#123;</span><br><span class="line">    path,</span><br><span class="line">    url</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> Component = component;</span><br><span class="line">  <span class="keyword">return</span> url === path &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Component</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span> <span class="attr">match</span>=<span class="string">&#123;match&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Route;</span><br></pre></td></tr></table></figure><h4 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h4><p>é‡å®šå‘è·¯ç”±ï¼šfrom æ˜¯ä»å“ªä¸ªç»„ä»¶æ¥ï¼Œto è¡¨ç¤ºè¦å®šå‘åˆ°å“ªé‡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;Redirect <span class="keyword">from</span>=&#123;<span class="string">'/'</span>&#125; exact to=&#123;<span class="string">'/home/index'</span>&#125;/&gt;;</span><br><span class="line">&lt;Redirect <span class="keyword">from</span>=&#123;<span class="string">'/*'</span>&#125; exact to=&#123;<span class="string">'/404'</span>&#125;/&gt;;</span><br></pre></td></tr></table></figure><h4 id="exact"><a href="#exact" class="headerlink" title="exact"></a>exact</h4><p>1.exactæ˜¯Routeä¸‹çš„ä¸€ä¸ªå±æ€§ï¼Œreactè·¯ç”±ä¼šåŒ¹é…åˆ°æ‰€æœ‰èƒ½åŒ¹é…åˆ°çš„è·¯ç”±ç»„ä»¶ï¼Œexactèƒ½å¤Ÿä½¿å¾—è·¯ç”±çš„åŒ¹é…æ›´ä¸¥æ ¼ä¸€äº›ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/'</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">&lt;Route path=<span class="string">'/page'</span> component=&#123;Page&#125;&gt;</span><br><span class="line"><span class="comment">//è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåŒ¹é…è·¯ç”±path='/page'ï¼Œé‚£ä¹ˆä¼šæŠŠHomeä¹Ÿä¼šå±•ç¤ºå‡ºæ¥ã€‚</span></span><br><span class="line"><span class="comment">//æ—¢è·¯ç”±path='/page'ä¼šåŒ¹é…è·¯ç”±path='/'å’Œè·¯ç”±path='/page'</span></span><br></pre></td></tr></table></figure><h4 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h4><p>2.Switch åªä¼šæ¸²æŸ“ç¬¬ä¸€æ¬¡åŒ¹é…çš„è·¯ç”±ï¼Œä¸ºäº†é˜²æ­¢ä¹¦å†™é¡ºåºè¦é…åˆexactä¸€å—ä½¿ç”¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Switch, Route &#125; <span class="keyword">from</span> <span class="string">'react-router'</span></span><br><span class="line"></span><br><span class="line">&lt;Switch&gt;  <span class="comment">//åŒ¹é…åˆ°ä¸€ä¸ªè·¯ç”±åï¼Œåé¢çš„å°±ä¸è¦å†åŒ¹é…äº†</span></span><br><span class="line">  &lt;Route exact path=<span class="string">"/"</span> component=&#123;Home&#125;/&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/:aa"</span> render=&#123;() =&gt; <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;/&gt;</span><br><span class="line">&lt;<span class="regexp">/Switch&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Linkç»„ä»¶åè·¯ç”±ç³»ç»Ÿä¸­åˆ°åº•å‘ç”Ÿäº†å“ªäº›å˜åŒ–"><a href="#Linkç»„ä»¶åè·¯ç”±ç³»ç»Ÿä¸­åˆ°åº•å‘ç”Ÿäº†å“ªäº›å˜åŒ–" class="headerlink" title="Linkç»„ä»¶åè·¯ç”±ç³»ç»Ÿä¸­åˆ°åº•å‘ç”Ÿäº†å“ªäº›å˜åŒ–"></a>Linkç»„ä»¶åè·¯ç”±ç³»ç»Ÿä¸­åˆ°åº•å‘ç”Ÿäº†å“ªäº›å˜åŒ–</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;Link to=&#123;&#123;</span><br><span class="line">  pathname: <span class="string">'/me'</span>,</span><br><span class="line">  search: <span class="string">'?sort=asc'</span>,</span><br><span class="line">  hash: <span class="string">'#hash'</span>,</span><br><span class="line">  state: &#123; <span class="attr">fromHome</span>: <span class="literal">true</span> &#125;</span><br><span class="line">&#125;&#125; /&gt;</span><br></pre></td></tr></table></figure><p><code>Link</code> ç»„ä»¶æœ€ç»ˆä¼šæ¸²æŸ“ä¸º <code>HTML</code> æ ‡ç­¾ <code>&lt;a&gt;</code>ï¼Œå®ƒçš„ <code>toã€queryã€hash</code>å±æ€§ä¼šè¢«ç»„åˆåœ¨ä¸€èµ·å¹¶æ¸²æŸ“ä¸º <code>href</code> å±æ€§ã€‚è™½ç„¶ <code>Link</code> è¢«æ¸²æŸ“ä¸ºè¶…é“¾æ¥ï¼Œä½†åœ¨å†…éƒ¨å®ç°ä¸Šä½¿ç”¨è„šæœ¬<code>æ‹¦æˆªäº†æµè§ˆå™¨çš„é»˜è®¤è¡Œä¸º</code>ï¼Œç„¶åè°ƒç”¨äº†<code>history.pushState</code>æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouterContext &#125; <span class="keyword">from</span> <span class="string">"./BrowserRouter"</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> A = styled.a<span class="string">`</span></span><br><span class="line"><span class="string">  text-decoration: none;</span></span><br><span class="line"><span class="string">  padding: 5px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Link</span>(<span class="params">&#123; children, to &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; history &#125; = useContext(RouterContext);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    history.push(to);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;A href=&#123;to&#125; onClick=&#123;onClick&#125;&gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;<span class="regexp">/A&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Link;</span></span><br></pre></td></tr></table></figure><h3 id="hashæ¨¡å¼å’Œhistoryæ¨¡å¼çš„åŒºåˆ«"><a href="#hashæ¨¡å¼å’Œhistoryæ¨¡å¼çš„åŒºåˆ«" class="headerlink" title="hashæ¨¡å¼å’Œhistoryæ¨¡å¼çš„åŒºåˆ«"></a>hashæ¨¡å¼å’Œhistoryæ¨¡å¼çš„åŒºåˆ«</h3><ul><li>hashè™½ç„¶å‡ºç°åœ¨URLä¸­ï¼Œä½†<code>ä¸ä¼šè¢«åŒ…æ‹¬åœ¨HTTPè¯·æ±‚ä¸­</code>ï¼Œå¯¹åç«¯å®Œå…¨æ²¡æœ‰å½±å“ï¼Œå› æ­¤æ”¹å˜hashä¸ä¼šé‡æ–°åŠ è½½é¡µé¢;historyä¼š</li><li>pushStateè®¾ç½®çš„æ–°URLå¯ä»¥æ˜¯ä¸å½“å‰URLåŒæºçš„ä»»æ„URLï¼›è€Œhashåªå¯ä¿®æ”¹#åé¢çš„éƒ¨åˆ†ï¼Œæ•…åªå¯è®¾ç½®ä¸å½“å‰åŒæ–‡æ¡£çš„URL</li><li>pushStateè®¾ç½®çš„æ–°URLå¯ä»¥ä¸å½“å‰URLä¸€æ¨¡ä¸€æ ·ï¼Œè¿™æ ·ä¹Ÿä¼šæŠŠè®°å½•æ·»åŠ åˆ°æ ˆä¸­ï¼›è€Œhashè®¾ç½®çš„æ–°å€¼å¿…é¡»ä¸åŸæ¥ä¸ä¸€æ ·æ‰ä¼šè§¦å‘è®°å½•æ·»åŠ åˆ°æ ˆä¸­</li><li>historyæ¨¡å¼éœ€è¦åç«¯é…åˆå°†æ‰€æœ‰è®¿é—®éƒ½é‡å®šå‘åˆ°index.htmlï¼Œå¦åˆ™ç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œä¼šå¯¼è‡´404é”™è¯¯</li></ul><p><strong>åŸç”ŸåŸºäºå‘å¸ƒè®¢é˜…å®ç°</strong></p><p><strong>HASH</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.routers = []  <span class="comment">//å­˜æ”¾æˆ‘ä»¬çš„è·¯ç”±é…ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line">    add(route,callback)&#123;</span><br><span class="line">        <span class="keyword">this</span>.routers.push(&#123;</span><br><span class="line">            path:route,</span><br><span class="line">            render:callback</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    listen(callback)&#123;</span><br><span class="line">        <span class="built_in">window</span>.onhashchange = <span class="keyword">this</span>.hashChange(callback);   <span class="comment">//ç›‘å¬onhashchangeæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">this</span>.hashChange(callback)()  <span class="comment">//é¦–æ¬¡è¿›å…¥é¡µé¢çš„æ—¶å€™æ²¡æœ‰è§¦å‘hashchangeï¼Œå¿…é¡»è¦å°±å•ç‹¬è°ƒç”¨ä¸€ä¸‹</span></span><br><span class="line">    &#125;</span><br><span class="line">    hashChange(callback)&#123;</span><br><span class="line">        <span class="keyword">let</span> self = <span class="keyword">this</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> hash = location.hash</span><br><span class="line">            <span class="built_in">console</span>.log(hash)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;self.routers.length;i++)&#123;</span><br><span class="line">                <span class="keyword">let</span> route = self.routers[i]</span><br><span class="line">                <span class="keyword">if</span>(hash===route.path)&#123;</span><br><span class="line">                    callback(route.render())</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">let</span> router = <span class="keyword">new</span> Router()</span><br><span class="line">router.add(<span class="string">'#index'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h1&gt;è¿™æ˜¯é¦–é¡µå†…å®¹&lt;/h1&gt;'</span></span><br><span class="line">&#125;)</span><br><span class="line">router.add(<span class="string">'#news'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="string">'&lt;h1&gt;è¿™æ˜¯æ–°é—»å†…å®¹&lt;/h1&gt;'</span></span><br><span class="line">&#125;)</span><br><span class="line">router.listen(<span class="function">(<span class="params">renderHtml</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> app = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</span><br><span class="line">    app.innerHTML = renderHtml</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>HISTORY</strong></p><p>è·Ÿä¸Šé¢åŒç†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">renderHtml(path)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="keyword">this</span>.routers.length;i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> route = <span class="keyword">this</span>.routers[i]</span><br><span class="line">        <span class="keyword">if</span>(path===route.path)&#123;</span><br><span class="line">            callback(route.render())</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onpopstate = <span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125; <span class="comment">//æ£€æµ‹å‰è¿›åé€€</span></span><br><span class="line"><span class="comment">//ç‚¹å‡»è·³è½¬ï¼Œåœ¨reactæ‰¾é‚£ä¸ªç”¨çš„åˆæˆçš„æ–¹æ³•ï¼Œæ¯æ¬¡æ‰§è¡Œthis.props.history.push(ï¼‰ç­‰ï¼Œéƒ½ä¼šæ‰§è¡ŒpushStateçš„æ–¹æ³•</span></span><br><span class="line">pushState(path,data=&#123;&#125;)&#123;</span><br><span class="line">    <span class="built_in">window</span>.history.pushState(data,<span class="string">''</span>,path)</span><br><span class="line">    <span class="keyword">this</span>.renderHtml(path)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://reacttraining.com/react-router/web/guides/quick-start" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a><br/><br><a href="https://github.com/hankzhuo/Blog/issues/11" target="_blank" rel="noopener">https://github.com/hankzhuo/Blog/issues/11</a><br/><br><a href="http://m.shanhuxueyuan.com/news/detail/137.html" target="_blank" rel="noopener">http://m.shanhuxueyuan.com/news/detail/137.html</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
          <category> Router </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>React16 Fiber</title>
      <link href="/2019/01/17/workspace/Frame/react/fiber/"/>
      <url>/2019/01/17/workspace/Frame/react/fiber/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>React16 Fiber</strong></p><p>[[toc]]</p><p>Reactæ—©æœŸçš„ä¼˜åŒ–éƒ½æ˜¯<code>åœç•™äºJSå±‚é¢</code>ï¼ˆvdomçš„ create/diffï¼‰ï¼Œè¯¸å¦‚å‡å°‘ç»„ä»¶çš„å¤æ‚åº¦ï¼ˆStatelessï¼‰ï¼Œ<br>å‡å°‘å‘ä¸‹diffçš„è§„æ¨¡(SCU)ï¼Œå‡å°‘diffçš„æˆæœ¬(immutable.js)ï¼Œå½“ç„¶ï¼Œä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚é’ˆå¯¹è€å¼çš„IEçš„LazyDOMTreeã€‚<br>åˆ°React16ï¼Œåˆ™<code>å‡çº§åˆ°æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶å±‚é¢</code>, åœ¨patchä¸Šå–å¾—äº†çªç ´ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œæµè§ˆå™¨æ˜¯å•çº¿ç¨‹ã€‚<br>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹è¦å¯¹è¿™èŠ‚ç‚¹è¿›è¡Œç§»é™¤ï¼Œä¸€ä¸ªè¦å¯¹å®ƒè¿›è¡Œæ ·å¼æ“ä½œã€‚<br>çº¿ç¨‹æ˜¯å¹¶å‘çš„ï¼Œæ— æ³•å†³å®šé¡ºåºï¼Œè¿™æ ·é¡µé¢çš„æ•ˆæœæ˜¯ä¸å¯æ§çš„ã€‚æ¢å•çº¿ç¨‹åˆ™ç®€å•å¯æ§ï¼Œ<br>ä½†JSæ‰§è¡Œä¸è§†å›¾æ¸²æŸ“ä¸èµ„åŸåŠ è½½ä¸äº‹ä»¶å›è°ƒæ˜¯å¦‚ä½•è°ƒåº¦å‘¢ï¼Œäºæ˜¯æœ‰äº†EventLoopè¿™ç§ä¸œè¥¿ã€‚</p><h3 id="React16ä¹‹å‰çš„ç—›ç‚¹"><a href="#React16ä¹‹å‰çš„ç—›ç‚¹" class="headerlink" title="React16ä¹‹å‰çš„ç—›ç‚¹"></a>React16ä¹‹å‰çš„ç—›ç‚¹</h3><ul><li>ç»„ä»¶ä¸èƒ½è¿”å›æ•°ç»„</li><li>å¼¹çª—é—®é¢˜</li><li>å¼‚å¸¸å¤„ç†</li><li>HOCæ²¡æœ‰è€ƒè™‘åˆ°refä¸contextçš„å‘ä¸‹ä¼ é€’ã€‚</li><li>ç»„ä»¶çš„æ€§èƒ½ä¼˜åŒ–å…¨å‡­äººè‚‰ï¼Œå¹¶ä¸”ä¸»è¦é›†ä¸­åœ¨SCUï¼Œå¸Œæœ›æ¡†æ¶èƒ½å¹²äº›äº‹æƒ…ï¼Œå³ä½¿ä¸ç”¨SCUï¼Œæ€§èƒ½ä¹Ÿèƒ½ä¸Šå»ã€‚</li></ul><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/He5cb4e937aaa4ecfbb32c6f106bd1b98O.jpg" alt=""></p><h3 id="è§£å†³è¿›åº¦"><a href="#è§£å†³è¿›åº¦" class="headerlink" title="è§£å†³è¿›åº¦"></a>è§£å†³è¿›åº¦</h3><p>16ç‰ˆæœ¬å¤§æ›´æ–°ï¼ŒFiberé¡ºæ‰‹è§£å†³äº†è¿™äº›ç—›ç‚¹</p><ul><li>16.0 è®©ç»„ä»¶æ”¯æŒè¿”å›ä»»ä½•æ•°ç»„ç±»å‹ï¼Œä»è€Œè§£å†³æ•°ç»„é—®é¢˜; æ¨å‡ºcreatePortal API ,è§£å†³å¼¹çª—é—®é¢˜; æ¨å‡ºcomponentDidCatchæ–°é’©å­ï¼Œ åˆ’åˆ†å‡ºé”™è¯¯ç»„ä»¶ä¸è¾¹ç•Œç»„ä»¶ï¼Œ æ¯ä¸ªè¾¹ç•Œç»„ä»¶èƒ½ä¿®å¤ä¸‹æ–¹ç»„ä»¶é”™è¯¯ä¸€æ¬¡ï¼Œ å†æ¬¡å‡ºé”™ï¼Œè½¬äº¤æ›´ä¸Šå±‚çš„è¾¹ç•Œç»„ä»¶æ¥å¤„ç†ï¼Œè§£å†³å¼‚å¸¸å¤„ç†é—®é¢˜ã€‚</li><li>16.2 æ¨å‡ºFragmentç»„ä»¶ï¼Œå¯ä»¥çœ‹ä½œæ˜¯æ•°ç»„çš„ä¸€ç§è¯­æ³•ç³–ã€‚</li><li>16.3 æ¨å‡ºcreateRefä¸forwardRefè§£å†³Refåœ¨HOCä¸­çš„ä¼ é€’é—®é¢˜ï¼Œæ¨å‡ºnew Context APIï¼Œè§£å†³HOCçš„contextä¼ é€’é—®é¢˜</li><li>è€Œæ€§èƒ½é—®é¢˜ï¼Œä»16.0å¼€å§‹ä¸€ç›´ç”±ä¸€äº›å†…éƒ¨æœºåˆ¶æ¥ä¿è¯ï¼Œæ¶‰åŠåˆ°æ‰¹é‡æ›´æ–°åŠåŸºäºæ—¶é—´åˆ†ç‰‡çš„é™é‡æ›´æ–°ã€‚</li></ul><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H0c7d42dd77864b7484ada4c2d7ea9316J.jpg" alt=""></p><h3 id="Fiberæ˜¯ä»€ä¹ˆ"><a href="#Fiberæ˜¯ä»€ä¹ˆ" class="headerlink" title="Fiberæ˜¯ä»€ä¹ˆ"></a>Fiberæ˜¯ä»€ä¹ˆ</h3><p><code>React Fiber</code>æ˜¯å¯¹æ ¸å¿ƒç®—æ³•çš„ä¸€æ¬¡é‡æ–°å®ç°ã€‚<code>React Fiber</code>æŠŠæ›´æ–°è¿‡ç¨‹ç¢ç‰‡åŒ–ï¼ŒæŠŠä¸€ä¸ªè€—æ—¶é•¿çš„ä»»åŠ¡åˆ†æˆå¾ˆå¤šå°ç‰‡ï¼Œæ¯ä¸€ä¸ªå°ç‰‡çš„è¿è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œè™½ç„¶æ€»æ—¶é—´ä¾ç„¶å¾ˆé•¿ï¼Œä½†æ˜¯åœ¨æ¯ä¸ªå°ç‰‡æ‰§è¡Œå®Œä¹‹åï¼Œéƒ½ç»™å…¶ä»–ä»»åŠ¡ä¸€ä¸ªæ‰§è¡Œçš„æœºä¼šï¼Œè¿™æ ·å”¯ä¸€çš„çº¿ç¨‹å°±ä¸ä¼šè¢«ç‹¬å ï¼Œå…¶ä»–ä»»åŠ¡ä¾ç„¶æœ‰è¿è¡Œçš„æœºä¼š</p><ul><li>åœ¨<code>React Fiber</code>ä¸­ï¼Œä¸€æ¬¡æ›´æ–°è¿‡ç¨‹ä¼šåˆ†æˆå¤šä¸ªåˆ†ç‰‡å®Œæˆï¼Œæ‰€ä»¥å®Œå…¨æœ‰å¯èƒ½ä¸€ä¸ªæ›´æ–°ä»»åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œå°±è¢«å¦ä¸€ä¸ªæ›´é«˜ä¼˜å…ˆçº§çš„æ›´æ–°è¿‡ç¨‹æ‰“æ–­ï¼Œè¿™æ—¶å€™ï¼Œä¼˜å…ˆçº§é«˜çš„æ›´æ–°ä»»åŠ¡ä¼šä¼˜å…ˆå¤„ç†å®Œï¼Œè€Œä½ä¼˜å…ˆçº§æ›´æ–°ä»»åŠ¡æ‰€åšçš„å·¥ä½œåˆ™ä¼šå®Œå…¨ä½œåºŸï¼Œç„¶åç­‰å¾…æœºä¼šé‡å¤´å†æ¥</li><li>å› ä¸ºä¸€ä¸ªæ›´æ–°è¿‡ç¨‹å¯èƒ½è¢«æ‰“æ–­ï¼Œæ‰€ä»¥<code>React Fiber</code>ä¸€ä¸ªæ›´æ–°è¿‡ç¨‹è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ(Phase)ï¼šç¬¬ä¸€ä¸ªé˜¶æ®µ<code>Reconciliation Phase</code>(è°ƒåº¦é˜¶æ®µ)å’Œç¬¬äºŒé˜¶æ®µ<code>Commit Phase</code>(æ¸²æŸ“é˜¶æ®µ)</li><li>åœ¨ç¬¬ä¸€é˜¶æ®µ<code>Reconciliation Phase</code>ï¼ŒReact Fiberä¼šæ‰¾å‡ºéœ€è¦æ›´æ–°å“ªäº›DOMï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯<code>å¯ä»¥è¢«æ‰“æ–­</code>çš„ï¼›ä½†æ˜¯åˆ°äº†ç¬¬äºŒé˜¶æ®µ<code>Commit Phase</code>ï¼Œé‚£å°±ä¸€é¼“-ä½œæ°”æŠŠDOMæ›´æ–°å®Œï¼Œ<code>ç»ä¸ä¼šè¢«æ‰“æ–­</code></li><li>è¿™ä¸¤ä¸ªé˜¶æ®µå¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯React Fiberåšï¼Œå’Œæˆ‘ä»¬ç›¸å…³çš„ä¹Ÿå°±æ˜¯ä¿®æ”¹äº†éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸå‡½æ•°</li></ul><p>React Fiberæ”¹å˜äº†ä¹‹å‰reactçš„ç»„ä»¶æ¸²æŸ“æœºåˆ¶ï¼Œæ–°çš„æ¶æ„ä½¿åŸæ¥åŒæ­¥æ¸²æŸ“çš„ç»„ä»¶ç°åœ¨å¯ä»¥å¼‚æ­¥åŒ–ï¼Œå¯ä¸­é€”ä¸­æ–­æ¸²æŸ“ï¼Œæ‰§è¡Œæ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚é‡Šæ”¾æµè§ˆå™¨ä¸»çº¿ç¨‹,è§£å†³æ‰å¸§çš„é—®é¢˜</p><h3 id="å…³é”®ç‰¹æ€§"><a href="#å…³é”®ç‰¹æ€§" class="headerlink" title="å…³é”®ç‰¹æ€§"></a>å…³é”®ç‰¹æ€§</h3><ul><li>æ—¶é—´åˆ†ç‰‡ï¼ˆæŠŠæ¸²æŸ“ä»»åŠ¡æ‹†åˆ†æˆå—ï¼ŒåŒ€åˆ°å¤šå¸§ï¼‰</li><li>æ›´æ–°æ—¶èƒ½å¤Ÿæš‚åœï¼Œç»ˆæ­¢ï¼Œå¤ç”¨æ¸²æŸ“ä»»åŠ¡ï¼ˆé“¾è¡¨ï¼‰</li><li>ç»™ä¸åŒç±»å‹çš„æ›´æ–°èµ‹äºˆä¼˜å…ˆçº§</li><li>å¹¶å‘æ–¹é¢æ–°çš„åŸºç¡€èƒ½åŠ›</li></ul><h3 id="ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥æ¸²æŸ“"><a href="#ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥æ¸²æŸ“" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥æ¸²æŸ“"></a>ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥æ¸²æŸ“</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨react16ä¹‹å‰ï¼Œreactå¯¹virtual dom çš„æ¸²æŸ“æ˜¯åŒæ­¥çš„ï¼Œå³æ¯æ¬¡å°†æ‰€æœ‰æ“ä½œç´¯åŠ èµ·æ¥ï¼Œç»Ÿè®¡å¯¹æ¯”å‡ºæ‰€æœ‰çš„å˜åŒ–åï¼Œç»Ÿä¸€æ›´æ–°ä¸€æ¬¡DOMæ ‘ï¼ˆ<a href="https://github.com/livoras/blog/issues/13" target="_blank" rel="noopener">äº†è§£è™šæ‹Ÿdomç®—æ³•</a>ï¼‰ï¼Œéšç€ç»„ä»¶å±‚çº§çš„æ·±å…¥ï¼Œç”±äºæ¸²æŸ“æ›´æ–°<strong>ä¸€æ—¦å¼€å§‹å°±æ— æ³•åœæ­¢</strong>ï¼Œå¯¼è‡´ä¸»çº¿ç¨‹é•¿æ—¶é—´è¢«å ç”¨ï¼Œè¿™ä¹Ÿæ˜¯reactåœ¨åŠ¨ç”»ï¼Œå¸ƒå±€å’Œæ‰‹åŠ¿ç­‰åŒºåŸŸä¼šæœ‰é€ æˆæ‰å¸§ã€å»¶è¿Ÿå“åº”ï¼ˆç”šè‡³æ— å“åº”ï¼‰ç­‰ä¸ä½³ä½“éªŒã€‚</p><p>å‡å¦‚æ›´æ–°ä¸€ä¸ªç»„ä»¶éœ€è¦1æ¯«ç§’ï¼Œå¦‚æœæœ‰200ä¸ªç»„ä»¶è¦æ›´æ–°ï¼Œé‚£å°±éœ€è¦200æ¯«ç§’ï¼Œåœ¨è¿™200æ¯«ç§’çš„æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨é‚£ä¸ªå”¯ä¸€çš„ä¸»çº¿ç¨‹éƒ½åœ¨ä¸“å¿ƒè¿è¡Œæ›´æ–°æ“ä½œï¼Œæ— æš‡å»åšä»»ä½•å…¶ä»–çš„äº‹æƒ…ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨è¿™200æ¯«ç§’å†…ï¼Œç”¨æˆ·å¾€ä¸€ä¸ªinputå…ƒç´ ä¸­è¾“å…¥ç‚¹ä»€ä¹ˆï¼Œæ•²å‡»é”®ç›˜ä¹Ÿä¸ä¼šè·å¾—å“åº”ï¼Œå› ä¸ºæ¸²æŸ“è¾“å…¥æŒ‰é”®ç»“æœä¹Ÿæ˜¯æµè§ˆå™¨ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œä½†æ˜¯æµè§ˆå™¨ä¸»çº¿ç¨‹è¢«Reactå ç€å‘¢ï¼ŒæŠ½ä¸å‡ºç©ºï¼Œæœ€åçš„ç»“æœå°±æ˜¯ç”¨æˆ·æ•²äº†æŒ‰é”®çœ‹ä¸åˆ°ååº”ï¼Œç­‰Reactæ›´æ–°è¿‡ç¨‹ç»“æŸä¹‹åï¼Œå’”å’”å’”é‚£äº›æŒ‰é”®ä¸€ä¸‹å­å‡ºç°åœ¨inputå…ƒç´ é‡Œäº†ã€‚</p><h3 id="Fiberçš„ç»“æ„"><a href="#Fiberçš„ç»“æ„" class="headerlink" title="Fiberçš„ç»“æ„"></a>Fiberçš„ç»“æ„</h3><p>React ç›®å‰çš„åšæ³•æ˜¯ä½¿ç”¨<code>é“¾è¡¨</code>, æ¯ä¸ª VirtualDOM èŠ‚ç‚¹å†…éƒ¨ç°åœ¨ä½¿ç”¨ Fiberè¡¨ç¤º, å®ƒçš„ç»“æ„å¤§æ¦‚å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> type Fiber = &#123;</span><br><span class="line">  <span class="comment">// Fiber ç±»å‹ä¿¡æ¯</span></span><br><span class="line">  type: any,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// âš›ï¸ é“¾è¡¨ç»“æ„</span></span><br><span class="line">  <span class="comment">// æŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼Œæˆ–è€…renderè¯¥èŠ‚ç‚¹çš„ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">return</span>: Fiber | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// æŒ‡å‘ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">  child: Fiber | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹</span></span><br><span class="line">  sibling: Fiber | <span class="literal">null</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Fiberä¸­æœ€ä¸ºé‡è¦çš„æ˜¯returnã€childã€siblingæŒ‡é’ˆï¼Œè¿æ¥çˆ¶å­å…„å¼ŸèŠ‚ç‚¹ä»¥æ„æˆä¸€é¢—å•é“¾è¡¨Fiberæ ‘ï¼Œå…¶æ‰å¹³åŒ–çš„å•é“¾è¡¨ç»“æ„çš„ç‰¹ç‚¹<code>å°†ä»¥å¾€é€’å½’éå†æ”¹ä¸ºäº†å¾ªç¯éå†</code>ï¼Œå®ç°æ·±åº¦ä¼˜å…ˆéå†ä¸ç”¨æ¯æ¬¡éƒ½è¿›å…¥é€’å½’å‡½æ•°ï¼Œé‡æ–°ç”Ÿæˆä»€ä¹ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå˜é‡å¯¹è±¡ï¼Œæ¿€æ´»å¯¹è±¡ï¼Œæ€§èƒ½å½“ç„¶æ¯”é€’å½’å¥½ã€‚</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hf4b7a27bd4e1433e87216f879a2b9b78B.jpg" alt=""></p><h3 id="Fiber-treeä¸workInProgress-tree"><a href="#Fiber-treeä¸workInProgress-tree" class="headerlink" title="Fiber treeä¸workInProgress tree*"></a>Fiber treeä¸workInProgress tree*</h3><p><strong>currentæ ‘ï¼š</strong> React åœ¨ render ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œä¼šé€šè¿‡ React.createElement åˆ›å»ºä¸€é¢— Element æ ‘ï¼Œå¯ä»¥ç§°ä¹‹ä¸º<code>Virtual DOM Tree</code>ï¼Œç”±äºè¦<code>è®°å½•ä¸Šä¸‹æ–‡ä¿¡æ¯</code>ï¼ŒåŠ å…¥äº† Fiberï¼Œæ¯ä¸€ä¸ª Element ä¼šå¯¹åº”ä¸€ä¸ª <code>Fiber Node</code>ï¼Œå°† <code>Fiber Node</code> é“¾æ¥èµ·æ¥çš„ç»“æ„æˆä¸º <code>Fiber Tree</code>ã€‚å®ƒåæ˜ äº†ç”¨äºæ¸²æŸ“ UI çš„åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚è¿™æ£µæ ‘é€šå¸¸è¢«ç§°ä¸º <code>current æ ‘</code>ï¼ˆå½“å‰æ ‘ï¼Œè®°å½•å½“å‰é¡µé¢çš„çŠ¶æ€ï¼‰ã€‚</p><p>åœ¨åç»­çš„æ›´æ–°è¿‡ç¨‹ä¸­ï¼ˆsetStateï¼‰ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½ä¼š<code>é‡æ–°åˆ›å»º Element</code>, ä½†æ˜¯ Fiber ä¸ä¼šï¼ŒFiber åªä¼šä½¿ç”¨å¯¹åº”çš„ Element ä¸­çš„æ•°æ®æ¥æ›´æ–°è‡ªå·±å¿…è¦çš„å±æ€§ï¼Œ</p><p>Fiber Tree ä¸€ä¸ªé‡è¦çš„ç‰¹ç‚¹æ˜¯é“¾è¡¨ç»“æ„ï¼Œå°†é€’å½’éå†ç¼–ç¨‹å¾ªç¯éå†ï¼Œç„¶åé…åˆ requestIdleCallback API, å®ç°ä»»åŠ¡æ‹†åˆ†ã€ä¸­æ–­ä¸æ¢å¤ã€‚</p><p><strong>å½“ render çš„æ—¶å€™æœ‰äº†è¿™ä¹ˆä¸€æ¡å•é“¾è¡¨ï¼Œå½“è°ƒç”¨ setState çš„æ—¶å€™åˆæ˜¯å¦‚ä½• Diff å¾—åˆ° change çš„å‘¢ï¼Ÿ</strong></p><p>é‡‡ç”¨çš„æ˜¯ä¸€ç§å«åŒç¼“å†²æŠ€æœ¯ï¼ˆdouble bufferingï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¦å¤–ä¸€é¢—æ ‘ï¼šWorkInProgress Treeï¼Œå®ƒåæ˜ äº†è¦åˆ·æ–°åˆ°å±å¹•çš„æœªæ¥çŠ¶æ€ã€‚</p><p><strong>workInProgressæ ‘ï¼š</strong> å½“Reactç»è¿‡<code>currentå½“å‰æ ‘</code>æ—¶ï¼Œå¯¹äºæ¯ä¸€ä¸ªå…ˆå­˜åœ¨çš„FiberèŠ‚ç‚¹ï¼Œå®ƒéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ›¿ä»£ï¼ˆalternateï¼‰èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ç»„æˆäº†workInProgressæ ‘ã€‚è¿™ä¸ªèŠ‚ç‚¹æ˜¯ä½¿ç”¨renderæ–¹æ³•è¿”å›çš„Reactå…ƒç´ çš„æ•°æ®åˆ›å»ºçš„ã€‚ä¸€æ—¦æ›´æ–°å¤„ç†å®Œä»¥åŠæ‰€æœ‰ç›¸å…³å·¥ä½œå®Œæˆï¼ŒReactå°±æœ‰ä¸€é¢—æ›¿ä»£æ ‘æ¥å‡†å¤‡åˆ·æ–°å±å¹•ã€‚ä¸€æ—¦è¿™é¢—workInProgressæ ‘æ¸²æŸ“ï¼ˆrenderï¼‰åœ¨å±å¹•ä¸Šï¼Œå®ƒä¾¿æˆäº†å½“å‰æ ‘ã€‚ä¸‹æ¬¡è¿›æ¥ä¼šæŠŠcurrentçŠ¶æ€å¤åˆ¶åˆ°WIPä¸Šï¼Œè¿›è¡Œäº¤äº’å¤ç”¨ï¼Œè€Œä¸ç”¨æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ¶ˆè€—æ€§èƒ½</p><p>WorkInProgress Tree æ„é€ å®Œæ¯•ï¼Œå¾—åˆ°çš„å°±æ˜¯æ–°çš„ Fiber Treeï¼Œç„¶åå–œæ–°åŒæ—§ï¼ˆæŠŠ current æŒ‡é’ˆæŒ‡å‘WorkInProgress Treeï¼Œä¸¢æ‰æ—§çš„ Fiber Treeï¼‰å°±å¥½äº†ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„ï¼š</p><ul><li>èƒ½å¤Ÿå¤ç”¨å†…éƒ¨å¯¹è±¡ï¼ˆFiberï¼‰</li><li>èŠ‚çœå†…å­˜åˆ†é…ã€GCçš„æ—¶é—´å¼€é”€</li><li>å°±ç®—è¿è¡Œä¸­æœ‰é”™è¯¯ï¼Œä¹Ÿä¸ä¼šå½±å“ View ä¸Šçš„æ•°æ®</li></ul><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H036ba6384df544979539d0c3f63096c4d.jpg" alt=""></p><p><strong>alternate</strong> å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªFiberç‰ˆæœ¬æ± ï¼Œç”¨äºäº¤æ›¿è®°å½•ç»„ä»¶æ›´æ–°ï¼ˆåˆ‡åˆ†ä»»åŠ¡åå˜æˆå¤šé˜¶æ®µæ›´æ–°ï¼‰è¿‡ç¨‹ä¸­Fiberçš„æ›´æ–°ï¼Œå› ä¸ºåœ¨ç»„ä»¶æ›´æ–°çš„å„é˜¶æ®µï¼Œæ›´æ–°å‰åŠæ›´æ–°è¿‡ç¨‹ä¸­FiberçŠ¶æ€å¹¶ä¸ä¸€è‡´ï¼Œåœ¨éœ€è¦æ¢å¤æ—¶ï¼ˆå¦‚å‘ç”Ÿå†²çªï¼‰ï¼Œå³å¯ä½¿ç”¨å¦ä¸€è€…ç›´æ¥å›é€€è‡³ä¸Šä¸€ç‰ˆæœ¬Fiberã€‚</p><h3 id="Fiber-Reconciliation-æ›´æ–°è¿‡ç¨‹"><a href="#Fiber-Reconciliation-æ›´æ–°è¿‡ç¨‹" class="headerlink" title="Fiber Reconciliation(æ›´æ–°è¿‡ç¨‹)*"></a>Fiber Reconciliation(æ›´æ–°è¿‡ç¨‹)*</h3><p>reactæ¸²æŸ“å¤§æŠµå¯ä»¥åˆ†ä¸º<strong>reconcilerï¼ˆè°ƒåº¦é˜¶æ®µï¼‰å’Œ commitï¼ˆæ¸²æŸ“é˜¶æ®µï¼‰</strong>ï¼Œå‰è€…ç”¨äºå¯¹æ¯”ï¼Œåè€…ç”¨äºæ“ä½œdomï¼Œ<code>reconciler</code>é˜¶æ®µå¯ä»¥ç®—æ˜¯ä¸€ä¸ªä»é¡¶å‘ä¸‹çš„é€’å½’ç®—æ³•ï¼Œä¸»è¦å·¥ä½œæ˜¯å¯¹<code>current tree å’Œ new tree</code>åšè®¡ç®—ï¼Œæ‰¾å‡ºå˜åŒ–éƒ¨åˆ†ã€‚<code>commit</code>é˜¶æ®µæ˜¯å¯¹åœ¨reconcileré˜¶æ®µè·å–åˆ°çš„å˜åŒ–éƒ¨åˆ†åº”ç”¨åˆ°çœŸå®çš„DOMæ ‘ä¸­,åœ¨ç»å¤§éƒ¨åˆ†è¿ç”¨åœºæ™¯ä¸­ï¼Œreconcileré˜¶æ®µçš„æ—¶é—´è¿œè¿œè¶…è¿‡commitï¼Œå› æ­¤Fiberé€‰æ‹©å°†reconcileré˜¶æ®µè¿›è¡Œåˆ†å‰²ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¬¬1é˜¶æ®µ render/reconciliation</span></span><br><span class="line"><span class="comment">//ï¼ˆå¯ä¸­æ–­ï¼‰render/reconciliation é€šè¿‡æ„é€ workInProgress treeå¾—å‡ºchange</span></span><br><span class="line"><span class="keyword">constructor</span></span><br><span class="line">componentWillMount //åºŸå¼ƒ</span><br><span class="line">componentWillReceiveProps //åºŸå¼ƒ</span><br><span class="line">static getDerivedStateFromProps</span><br><span class="line">shouldComponentUpdate</span><br><span class="line">componentWillUpdate //åºŸå¼ƒ</span><br><span class="line">render</span><br><span class="line"></span><br><span class="line">// ç¬¬2é˜¶æ®µ commit</span><br><span class="line">//ï¼ˆä¸å¯ä¸­æ–­ï¼‰commit åº”ç”¨è¿™äº›DOM change</span><br><span class="line">getSnapshotBeforeUpdate()  //ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸ªæ˜¯åœ¨è¿›å…¥ commit é˜¶æ®µå‰è°ƒç”¨</span><br><span class="line">componentDidMount</span><br><span class="line">componentDidUpdate</span><br><span class="line">componentWillUnmount</span><br></pre></td></tr></table></figure><h4 id="diff-render-reconciliation"><a href="#diff-render-reconciliation" class="headerlink" title="diff ~ render/reconciliation"></a>diff ~ render/reconciliation</h4><p>diffçš„å®é™…å·¥ä½œæ˜¯å¯¹æ¯”prevInstanceå’ŒnextInstanceçš„çŠ¶æ€ï¼Œæ‰¾å‡ºå·®å¼‚åŠå…¶å¯¹åº”çš„DOM changeã€‚diffæœ¬è´¨ä¸Šæ˜¯ä¸€äº›è®¡ç®—ï¼ˆéå†ã€æ¯”è¾ƒï¼‰ï¼Œæ˜¯å¯æ‹†åˆ†çš„ï¼ˆç®—ä¸€åŠå¾…ä¼šå„¿æ¥ç€ç®—ï¼‰</p><p>ä»¥Fiber treeä¸ºè“æœ¬ï¼ŒæŠŠæ¯ä¸ªFiberä½œä¸ºä¸€ä¸ªå·¥ä½œå•å…ƒï¼Œè‡ªé¡¶å‘ä¸‹é€èŠ‚ç‚¹æ„é€ workInProgress treeï¼ˆæ„å»ºä¸­çš„æ–°Fiber treeï¼‰</p><p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼ˆä»¥ç»„ä»¶èŠ‚ç‚¹ä¸ºä¾‹ï¼‰ï¼š</p><ol><li>å¦‚æœå½“å‰èŠ‚ç‚¹ä¸éœ€è¦æ›´æ–°ï¼Œç›´æ¥æŠŠå­èŠ‚ç‚¹cloneè¿‡æ¥ï¼Œè·³åˆ°5ï¼›è¦æ›´æ–°çš„è¯æ‰“ä¸ªtag</li><li>æ›´æ–°å½“å‰èŠ‚ç‚¹çŠ¶æ€ï¼ˆprops, state, contextç­‰ï¼‰</li><li>è°ƒç”¨shouldComponentUpdate()ï¼Œfalseçš„è¯ï¼Œè·³åˆ°5</li><li>è°ƒç”¨render()è·å¾—æ–°çš„å­èŠ‚ç‚¹ï¼Œå¹¶ä¸ºå­èŠ‚ç‚¹<code>åˆ›å»ºFiber</code>ï¼ˆåˆ›å»ºè¿‡ç¨‹ä¼šå°½é‡å¤ç”¨ç°æœ‰Fiberï¼Œå­èŠ‚ç‚¹å¢åˆ ä¹Ÿå‘ç”Ÿåœ¨è¿™é‡Œï¼‰</li><li>å¦‚æœæ²¡æœ‰äº§ç”Ÿchild Fiberï¼Œè¯¥å·¥ä½œå•å…ƒç»“æŸï¼ŒæŠŠeffect listå½’å¹¶åˆ°returnï¼Œå¹¶æŠŠå½“å‰èŠ‚ç‚¹çš„siblingä½œä¸ºä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒï¼›å¦åˆ™æŠŠchildä½œä¸ºä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ</li><li>å¦‚æœæ²¡æœ‰å‰©ä½™å¯ç”¨æ—¶é—´äº†ï¼Œç­‰åˆ°ä¸‹ä¸€æ¬¡ä¸»çº¿ç¨‹ç©ºé—²æ—¶æ‰å¼€å§‹ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒï¼›å¦åˆ™ï¼Œç«‹å³å¼€å§‹åš</li><li>å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒäº†ï¼ˆå›åˆ°äº†workInProgress treeçš„æ ¹èŠ‚ç‚¹ï¼‰ï¼Œç¬¬1é˜¶æ®µç»“æŸï¼Œè¿›å…¥pendingCommitçŠ¶æ€</li></ol><p>å®é™…ä¸Šæ˜¯1-6çš„å·¥ä½œå¾ªç¯ï¼Œ7æ˜¯å‡ºå£ï¼Œå·¥ä½œå¾ªç¯æ¯æ¬¡åªåšä¸€ä»¶äº‹ï¼Œåšå®Œçœ‹è¦ä¸è¦å–˜å£æ°”ã€‚å·¥ä½œå¾ªç¯ç»“æŸæ—¶ï¼ŒworkInProgress treeçš„æ ¹èŠ‚ç‚¹èº«ä¸Šçš„effect listå°±æ˜¯æ”¶é›†åˆ°çš„æ‰€æœ‰side effectï¼ˆå› ä¸ºæ¯åšå®Œä¸€ä¸ªéƒ½å‘ä¸Šå½’å¹¶ï¼‰</p><p>æ‰€ä»¥ï¼Œ<strong>æ„å»ºworkInProgress treeçš„è¿‡ç¨‹å°±æ˜¯<code>diff</code>çš„è¿‡ç¨‹</strong>ï¼Œé€šè¿‡requestIdleCallbackæ¥è°ƒåº¦æ‰§è¡Œä¸€ç»„ä»»åŠ¡ï¼Œæ¯å®Œæˆä¸€ä¸ªä»»åŠ¡åå›æ¥çœ‹çœ‹æœ‰æ²¡æœ‰æ’é˜Ÿçš„ï¼ˆæ›´ç´§æ€¥çš„ï¼‰ï¼Œæ¯å®Œæˆä¸€ç»„ä»»åŠ¡ï¼ŒæŠŠæ—¶é—´æ§åˆ¶æƒäº¤è¿˜ç»™ä¸»çº¿ç¨‹ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡requestIdleCallbackå›è°ƒå†ç»§ç»­æ„å»ºworkInProgress tree,è¿™éƒ¨åˆ†çš„æ ¸å¿ƒæ˜¯<code>beginWork</code>å‡½æ•°ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">beginWork</span>(<span class="params">fiber: Fiber</span>): <span class="title">Fiber</span> | <span class="title">undefined</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (fiber.tag === WorkTag.HostComponent) &#123;</span><br><span class="line">    <span class="comment">// å®¿ä¸»èŠ‚ç‚¹diff</span></span><br><span class="line">    diffHostComponent(fiber)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fiber.tag === WorkTag.ClassComponent) &#123;</span><br><span class="line">    <span class="comment">// ç±»ç»„ä»¶èŠ‚ç‚¹diff</span></span><br><span class="line">    diffClassComponent(fiber)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fiber.tag === WorkTag.FunctionComponent) &#123;</span><br><span class="line">    <span class="comment">// å‡½æ•°ç»„ä»¶èŠ‚ç‚¹diff</span></span><br><span class="line">    diffFunctionalComponent(fiber)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ... å…¶ä»–ç±»å‹èŠ‚ç‚¹ï¼Œçœç•¥</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="patch-commit"><a href="#patch-commit" class="headerlink" title="patch ~ commit"></a>patch ~ commit</h4><p>ç¬¬2é˜¶æ®µç›´æ¥ä¸€å£æ°”åšå®Œï¼š</p><ol><li><p>å¤„ç†effect listï¼ˆæ›´æ–°DOMæ ‘ã€è°ƒç”¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä»¥ æ›´æ–°refã€å¼‚å¸¸å¤„ç†ç­‰å†…éƒ¨çŠ¶æ€ï¼‰</p></li><li><p>å‡ºå¯¹ç»“æŸï¼Œç¬¬2é˜¶æ®µç»“æŸï¼Œæ‰€æœ‰æ›´æ–°éƒ½commitåˆ°DOMæ ‘ä¸Šäº†</p></li></ol><p>æ³¨æ„ï¼ŒçœŸçš„æ˜¯<code>ä¸€å£æ°”åšå®Œ</code>ï¼ˆåŒæ­¥æ‰§è¡Œï¼Œä¸èƒ½å–Šåœï¼‰çš„ï¼Œè¿™ä¸ªé˜¶æ®µçš„å®é™…å·¥ä½œé‡æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ‰€ä»¥å°½é‡ä¸è¦åœ¨å3ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°é‡Œå¹²é‡æ´»å„¿</p><p>patché˜¶æ®µæŠŠæœ¬æ¬¡æ›´æ–°ä¸­çš„æ‰€æœ‰DOM changeåº”ç”¨åˆ°DOMæ ‘ï¼Œæ˜¯ä¸€è¿ä¸²çš„DOMæ“ä½œã€‚è¿™äº›DOMæ“ä½œè™½ç„¶çœ‹èµ·æ¥ä¹Ÿå¯ä»¥æ‹†åˆ†ï¼ˆæŒ‰ç…§change listä¸€æ®µä¸€æ®µåšï¼‰ï¼Œä½†è¿™æ ·åšä¸€æ–¹é¢å¯èƒ½é€ æˆDOMå®é™…çŠ¶æ€ä¸ç»´æŠ¤çš„å†…éƒ¨çŠ¶æ€ä¸ä¸€è‡´ï¼Œå¦å¤–è¿˜ä¼šå½±å“ä½“éªŒã€‚è€Œä¸”ï¼Œä¸€èˆ¬åœºæ™¯ä¸‹ï¼ŒDOMæ›´æ–°çš„è€—æ—¶æ¯”èµ·diffåŠç”Ÿå‘½å‘¨æœŸå‡½æ•°è€—æ—¶ä¸ç®—ä»€ä¹ˆï¼Œæ‹†åˆ†çš„æ„ä¹‰ä¸å¾ˆå¤§</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦æ–°çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ–°çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ–°çš„ç”Ÿå‘½å‘¨æœŸ"></a>ä¸ºä»€ä¹ˆéœ€è¦æ–°çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>v16ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸ<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=184887708,229247596&fm=26&gp=0.jpg" alt=""></p><ol><li>v16ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œç»„ä»¶åœ¨<code>æŒ‚è½½</code>è¿‡ç¨‹ä¸­ä¼šè°ƒ3æ¬¡é’©å­/æ–¹æ³•<code>ï¼ˆconstructor, componentWillMount, renderï¼‰</code>ï¼Œ ç»„ä»¶åœ¨<code>æ›´æ–°</code>è¿‡ç¨‹ä¸­ä¼šè°ƒ4æ¬¡é’©å­ <code>ï¼ˆcomponentWillReceiveProps, shouldUpdate, componentWillUpdate,renderï¼‰</code>, updateViewåœ¨checkçš„æ—¶å€™å¾ˆå®³æ€•å‡ºé”™çš„ï¼Œæ€»ä¸èƒ½æ¯ä¸ªæ–¹æ³•éƒ½ç”¨try catchåŒ…èµ·æ¥ï¼Œè¿™æ ·ä¼šæ€§èƒ½å¾ˆå·®ã€‚è€Œconstructor, renderæ˜¯ä¸å¯é¿å…çš„ï¼Œäºæ˜¯å¯¹ä¸‰ä¸ªwillXXXåŠ¨åˆ€äº†ã€‚</li><li>åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>componentWillMountä¸componentWillReceivePropsä¼š</code>åšå†…éƒ¨ä¼˜åŒ–ï¼Œæ‰§è¡Œå¤šæ¬¡setStateéƒ½ä¼šå»¶ååˆ°renderæ—¶è¿›è¡Œåˆå¹¶å¤„ç†ã€‚å› æ­¤ç”¨æˆ·å°±è‚†æ„setStateäº†ã€‚è¿™äº›willXXXè¿˜å¯ä»¥è®©ç”¨æˆ·ä»»æ„æ“ä½œDOMã€‚ æ“ä½œDOMä¼šå¯èƒ½reflowï¼Œè¿™æ˜¯å®˜æ–¹ä¸æ„¿æ„çœ‹åˆ°çš„ã€‚äºæ˜¯å®˜æ–¹æ¨å‡ºäº†<code>getDerivedStateFromProps</code>ï¼Œè®©ä½ åœ¨renderè®¾ç½®æ–°stateï¼Œä½ ä¸»è¦è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå®ƒå°±ä¸»åŠ¨å¸®ä½ setStateã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä½ ä¸èƒ½æ“ä½œinstanceï¼Œè¿™å°±<code>é˜»æ­¢äº†ä½ å¤šæ¬¡æ“ä½œsetState</code>ã€‚</li><li>ç”Ÿå‘½å‘¨æœŸåœ¨React v16æ¨å‡ºçš„Fiberä¹‹åå°±ä¸åˆé€‚äº†ï¼Œåœ¨renderå‡½æ•°ä¹‹å‰çš„æ‰€æœ‰å‡½æ•°ï¼Œéƒ½æœ‰å¯èƒ½è¢«æ‰§è¡Œå¤šæ¬¡ã€‚<br>å› ä¸ºæ–°çš„reactå¼•å…¥äº†å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯ï¼Œåœ¨æ¸²æŸ“å®Œæˆå‰ï¼Œå¯ä»¥ä¸­æ–­ä»»åŠ¡ï¼Œä¸­æ–­ä¹‹åä¸ä¼šç»§ç»­æ‰§è¡Œç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ˜¯é‡å¤´å¼€å§‹æ‰§è¡Œç”Ÿå‘½å‘¨æœŸã€‚è¿™å¯¼è‡´ä¸Šè¿°çš„<code>componentWillMountï¼ŒcomponentWillReceivePropsï¼ŒcomponentWillUpdate</code>å¯èƒ½ä¼šè¢«ä¸­æ–­ï¼Œå¯¼è‡´æ‰§è¡Œå¤šæ¬¡ï¼Œå¸¦æ¥æ„æƒ³ä¸åˆ°çš„æƒ…å†µã€‚<code>å¦‚æœrenderå‰æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åšAJAXè¯·æ±‚çš„è¯ï¼Œé‚£AJAXå°†è¢«æ— è°“åœ°å¤šæ¬¡è°ƒç”¨</code></li></ol><p><code>reconciler</code>é˜¶æ®µçš„é’©å­éƒ½ä¸åº”è¯¥æ“ä½œDOMï¼Œæœ€å¥½ä¹Ÿä¸è¦setStateï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<code>è½»é‡é’©å­</code>ã€‚<code>commit</code>é˜¶æ®µçš„é’©å­åˆ™å¯¹åº”ç§°ä¹‹ä¸º<code>é‡é‡é’©å­</code>ã€‚</p><h3 id="Fiberæµç¨‹å›¾"><a href="#Fiberæµç¨‹å›¾" class="headerlink" title="Fiberæµç¨‹å›¾"></a>Fiberæµç¨‹å›¾</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H42a99254c6d8425ab9b8bf782554349aG.jpg" alt=""></p><h3 id="ä¼˜å…ˆçº§ç­–ç•¥"><a href="#ä¼˜å…ˆçº§ç­–ç•¥" class="headerlink" title="ä¼˜å…ˆçº§ç­–ç•¥"></a>ä¼˜å…ˆçº§ç­–ç•¥</h3><p>æ¯ä¸ªå·¥ä½œå•å…ƒè¿è¡Œæ—¶æœ‰6ç§ä¼˜å…ˆçº§ï¼š</p><ul><li>synchronous ä¸ä¹‹å‰çš„Stack reconcileræ“ä½œä¸€æ ·ï¼ŒåŒæ­¥æ‰§è¡Œ</li><li>task åœ¨next tickä¹‹å‰æ‰§è¡Œ</li><li>animation ä¸‹ä¸€å¸§ä¹‹å‰æ‰§è¡Œ</li><li>high åœ¨ä¸ä¹…çš„å°†æ¥ç«‹å³æ‰§è¡Œ</li><li>low ç¨å¾®å»¶è¿Ÿï¼ˆ100-200msï¼‰æ‰§è¡Œä¹Ÿæ²¡å…³ç³»</li><li>offscreen ä¸‹ä¸€æ¬¡renderæ—¶æˆ–scrollæ—¶æ‰æ‰§è¡Œ</li></ul><p><code>synchronous</code>é¦–å±ï¼ˆé¦–æ¬¡æ¸²æŸ“ï¼‰ç”¨ï¼Œè¦æ±‚å°½é‡å¿«ï¼Œä¸ç®¡ä¼šä¸ä¼šé˜»å¡UIçº¿ç¨‹ã€‚<code>animation</code>é€šè¿‡requestAnimationFrameæ¥è°ƒåº¦ï¼Œè¿™æ ·åœ¨ä¸‹ä¸€å¸§å°±èƒ½ç«‹å³å¼€å§‹åŠ¨ç”»è¿‡ç¨‹ï¼›<code>å3ä¸ª</code>éƒ½æ˜¯ç”±requestIdleCallbackå›è°ƒæ‰§è¡Œçš„ï¼›offscreenæŒ‡çš„æ˜¯å½“å‰éšè—çš„ã€å±å¹•å¤–çš„ï¼ˆçœ‹ä¸è§çš„ï¼‰å…ƒç´ </p><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://zhuanlan.zhihu.com/p/37095662" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/37095662</a></p><p><a href="http://www.ayqy.net/blog/dive-into-react-fiber/#articleHeader1" target="_blank" rel="noopener">http://www.ayqy.net/blog/dive-into-react-fiber/#articleHeader1</a></p><p><a href="https://juejin.im/post/5dadc6045188255a270a0f85" target="_blank" rel="noopener">https://juejin.im/post/5dadc6045188255a270a0f85</a></p><p><a href="https://juejin.im/post/5df21c895188251260743972" target="_blank" rel="noopener">https://juejin.im/post/5df21c895188251260743972</a></p>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
          <category> Fiber </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MACæ•´ç†</title>
      <link href="/2019/01/16/tools/mac/"/>
      <url>/2019/01/16/tools/mac/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>MACæ•´ç†</strong></p><p>[[toc]]</p><h3 id="MACæ•´ç†"><a href="#MACæ•´ç†" class="headerlink" title="MACæ•´ç†"></a>MACæ•´ç†</h3><h3 id="é…ç½®sudoå…å¯†ç "><a href="#é…ç½®sudoå…å¯†ç " class="headerlink" title="é…ç½®sudoå…å¯†ç "></a>é…ç½®sudoå…å¯†ç </h3><p><a href="https://blog.csdn.net/u011046452/article/details/90140936" target="_blank" rel="noopener">åˆ›å»ºrootè´¦æˆ·</a></p><p><code>1.</code> éœ€è¦åœ¨/etc/sudoersä¸­é…ç½®ã€‚<br><br/><br>è¿™ä¸ªæ–‡ä»¶çš„æƒé™æ˜¯åªè¯»ï¼Œé…ç½®ä¹‹å‰éœ€è¦åŠ å†™æƒé™ã€‚<br><br/><br><code>sudo chmod u+w /etc/sudoers</code></p><p><code>2.</code> æ‰“å¼€å‘½ä»¤çª—å£<br><code>sudo visudo æˆ–è€… sudo vi /etc/sudoers</code></p><p>æŒ‰i(insert)å¼€å¯æ’å…¥ç¼–è¾‘æ¨¡å¼</p><p><code>å°† #%admin ALL=(ALL) ALLæ›¿æ¢ä¸º %admin ALL=(ALL) NOPASSWD: ALL</code></p><p>ä¿®æ”¹åæŒ‰escé”®ï¼Œé€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œæœ€åæŒ‰ä½Shift+ ZZ ä¿å­˜é€€å‡º</p><p><code>3.</code> æ—¢ç„¶åŸæ¥æƒé™æ˜¯r/r/åªè¯»çš„,ä¿®æ”¹ä¹‹åæœ€å¥½ä¹Ÿæ”¹å›æ¥ã€‚</p><p><code>sudo chmod u-w /etc/sudoers</code></p><h3 id="sudoæŠ¥é”™ä¿¡æ¯-etc-sudoers-is-world-writable"><a href="#sudoæŠ¥é”™ä¿¡æ¯-etc-sudoers-is-world-writable" class="headerlink" title="sudoæŠ¥é”™ä¿¡æ¯ /etc/sudoers is world writable"></a>sudoæŠ¥é”™ä¿¡æ¯ /etc/sudoers is world writable</h3><p>::: danger é”™è¯¯ä¿¡æ¯</p><p>sudo: /etc/sudoers is world writable<br><br/><br>sudo: no valid sudoers sources found, quitting<br><br/><br>sudo: unable to initialize policy plugin</p><p>:::</p><p>ä»Šå¤©è¯¯æ“ä½œä¿®æ”¹äº†/etc/sudoersçš„æƒé™ï¼Œå°†å®ƒçš„æƒé™æ”¹æˆäº†777ï¼Œç»“æœå°±å¯¼è‡´æ‰§è¡Œæ‰€æœ‰sudoçš„å‘½ä»¤éƒ½æŠ¥é”™ã€‚<br><br/><br><code>sudo: /etc/sudoers is world writablesudo: no valid sudoers sources found, quitting</code><br><br/><br>æƒ³é‡æ–°æŠŠå®ƒçš„æƒé™ä¿®æ”¹å›å»ï¼Œä½†æ˜¯æ‰§è¡Œ<code>chmod 440 /etc/sudoers</code>åå´å‘ç°æŠ¥é”™ä¸ºï¼š<br><br/><br><code>chmod: Unable to change file mode on /etc/sudoers: Operation not permitted</code><br><br/><br>è¿™å°±å°´å°¬äº†ï¼Œæ”¹ä¸å›å»ã€‚<br><br/><br>æœ€åé€šè¿‡ç–¯ç‹‚çš„ç™¾åº¦è°·æ­Œï¼Œæ‰¾åˆ°äº†ä¸€äº›è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯æœ‰äº›æ–¹æ³•è¯´çš„å¤ªç®€å•äº†ï¼Œè¿˜æ˜¯èµ°äº†å¥½å¤šå†¤æ‰è·¯ï¼Œç°æ€»ç»“å¦‚ä¸‹ï¼š<br><br/><br><code>1.</code> åœ¨Macä¸­å¯åŠ¨rootè´¦æˆ· <a href="https://jingyan.baidu.com/article/49711c619e7620fa441b7ca8.html" target="_blank" rel="noopener">å¯åŠ¨root</a><br><br/><br><code>2.</code> åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œä¿®æ”¹ /etc/sudoersçš„æƒé™<br><br/></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ— æ³•ä½¿ç”¨chmodä¿®æ”¹æƒé™</span><br><span class="line">ls -la &#x2F;etc&#x2F;sudoers</span><br><span class="line">-rwxrwxrwx  1 root  wheel  1371  8  9 11:28 &#x2F;etc&#x2F;sudoers</span><br><span class="line">chmod 440 &#x2F;etc&#x2F;sudoers</span><br><span class="line">chmod: Unable to change file mode on &#x2F;etc&#x2F;sudoers: Operation not permitted</span><br><span class="line"></span><br><span class="line"># åˆ‡æ¢åˆ°rootç”¨æˆ·</span><br><span class="line"> su</span><br><span class="line">Password:ä½ è‡ªå·±è®¾ç½®çš„å¯†ç </span><br><span class="line">sh-3.2# ls -l &#x2F;etc&#x2F;sudoers</span><br><span class="line">-rwxrwxrwx  1 root  wheel  1371  8  9 11:28 &#x2F;etc&#x2F;sudoers</span><br><span class="line">sh-3.2# chmod 0440 &#x2F;etc&#x2F;sudoers</span><br><span class="line">sh-3.2# ls -l &#x2F;etc&#x2F;sudoers</span><br><span class="line">-r--r-----  1 root  wheel  1371  8  9 11:28 &#x2F;etc&#x2F;sudoers</span><br><span class="line">sh-3.2# exit</span><br></pre></td></tr></table></figure><h3 id="macä¸‹å®‰è£…Homebrew"><a href="#macä¸‹å®‰è£…Homebrew" class="headerlink" title="macä¸‹å®‰è£…Homebrew"></a>macä¸‹å®‰è£…Homebrew</h3><p>å®‰è£… <a href="https://brew.sh/index_zh-cn" target="_blank" rel="noopener">Homebrew</a></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä½¿ç”¨æ–¹å¼</span><br><span class="line"># å®‰è£… wget  </span><br><span class="line">brew install wget</span><br><span class="line"># å®‰è£… yum   </span><br><span class="line">brew install yum</span><br></pre></td></tr></table></figure><h3 id="macå®‰è£…autojump"><a href="#macå®‰è£…autojump" class="headerlink" title="macå®‰è£…autojump"></a>macå®‰è£…autojump</h3><p>è¦çŸ¥é“autojumpæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¾—å…ˆæ¥äº†è§£ä¸€ä¸‹shellï¼Œbashå’Œzshã€‚<br><br/></p><p><strong>shell</strong>å°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„shellå‘½ä»¤ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªcè¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œç”¨æˆ·åœ¨å‘½ä»¤è¡Œé”®å…¥å‘½ä»¤ï¼Œç»è¿‡shellè§£é‡Šåä¼ é€ç»™æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰æ‰§è¡Œã€‚</p><p><strong>1. bash</strong></p><p>bash (Bourne-Again Shell) æ˜¯å¤§å¤šæ•°Linuxç³»ç»Ÿä»¥åŠMac OS Xé»˜è®¤çš„shellï¼Œæ¢å¥è¯è¯´ï¼Œbashæ˜¯shellçš„å®ä¾‹ã€‚</p><p><strong>2. zsh</strong></p><p>è™½ç„¶Linuxå’ŒMac OS Xé»˜è®¤ä½¿ç”¨çš„å‡ ä¹éƒ½æ˜¯bashï¼Œä½†çœŸæ­£å¼ºå¤§çš„shellå…¶å®æ˜¯æ·±è—ä¸éœ²çš„zshï¼Œä¿—ç§°ç»ˆæshellã€‚å®ƒå…¼å®¹äº†bashï¼Œè¿˜æœ‰å„ç§å¼ºå¤§çš„åŠŸèƒ½</p><p><strong>autojump</strong></p><p>autojumpæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå¯ä»¥ä½¿ç”¨å¿«æ·å‘½ä»¤ï¼Œç›´æ¥è·³è½¬åˆ°é…ç½®å¥½çš„ç›®å½•ï¼Œè€Œä¸ç”¨ç®¡ç°åœ¨èº«åœ¨ä½•å¤„ï¼Œä¾èµ–zshã€‚</p><p><code>echo $SHELL</code>å¯ä»¥æŸ¥çœ‹ç”¨çš„å“ªä¸ªshellï¼ˆbash or zshï¼‰</p><p>æŸ¥çœ‹ç³»ç»Ÿå®‰è£…çš„æ‰€æœ‰shellæœ‰å“ªäº› <code>cat /etc/shells</code></p><p>å°†zshè®¾ç½®æˆé»˜è®¤çš„shellï¼š<code>chsh -s /bin/zsh</code> (é‡å¯shell)</p><p>å®‰è£…autojumpï¼š<code>brew install autojump</code>ï¼ˆç¡®ä¿æœ‰brewï¼‰</p><p>ä½¿ç”¨<code>vim .zshrc</code>æ‰“å¼€.zshrcï¼ˆæœ‰äº›äººä¼šæ‰¾ä¸åˆ°.zshrcè¿™ä¸ªæ–‡ä»¶ï¼Œå…¶å®å®‰è£…äº†zshæ‰ä¼šæœ‰.zshrc ï¼Œåœ¨é»˜è®¤æ‰“å¼€çš„ç»ˆç«¯ç›®å½•ä¸‹ã€‚å¯ä»¥æ‰“å¼€ç»ˆç«¯å¹¶ä¸”ls -aæŸ¥çœ‹ï¼‰ã€‚</p><p>a. æ‰¾åˆ° plugins=ï¼Œåœ¨åé¢æ·»åŠ autojumpï¼š<code>plugins=(git autojump)</code></p><p>b. æ–°å¼€ä¸€è¡Œï¼Œæ·»åŠ ï¼š<code>[[ -s $(brew --prefix)/etc/profile.d/autojump.sh ]] &amp;&amp; . $(brew --prefix)/etc/profile.d/autojump.sh</code></p><p>c. :wqä¿å­˜é€€å‡ºï¼Œé‡å¯ç»ˆç«¯ã€‚</p><h3 id="Mac-ç»ˆç«¯-oh-my-zsh-é…ç½®"><a href="#Mac-ç»ˆç«¯-oh-my-zsh-é…ç½®" class="headerlink" title="Mac ç»ˆç«¯ oh-my-zsh é…ç½®"></a>Mac ç»ˆç«¯ oh-my-zsh é…ç½®</h3><p>Mac ç»ˆç«¯é»˜è®¤ shell ä¸º <code>bash</code>ã€‚</p><p>ä¸»è¦ä»‹ç»ä½¿ç”¨ zsh ä»¥åŠ oh-my-zsh çš„é…ç½®ã€‚</p><p><strong>ä½¿ç”¨ zsh</strong></p><p>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ shell</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">echo</span> <span class="variable">$SHELL</span></span><br><span class="line"><span class="comment"># /bin/bash</span></span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ brew æ›´æ–° zsh</strong></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">brew</span> install zsh</span><br></pre></td></tr></table></figure><p><strong>åˆ‡æ¢ä¸º zsh</strong></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chsh</span> -s /bin/zsh <span class="comment"># é‡å¯shell</span></span><br></pre></td></tr></table></figure><p>é‡å¯ç»ˆç«¯å³å¯ä½¿ç”¨ <code>zsh</code></p><p><strong>1.å®‰è£…</strong></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sh</span> -c <span class="string">"$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</span></span><br></pre></td></tr></table></figure><p><strong>2.ä¸»é¢˜</strong></p><p><code>vim ~/.zshrc</code></p><p>é…ç½®é¡¹ <code>ZSH_THEME</code> å³ä¸º oh-my-zsh çš„ä¸»é¢˜é…ç½®ï¼Œoh-my-zsh çš„ GitHub Wiki é¡µé¢æä¾›äº† <a href="https://github.com/robbyrussell/oh-my-zsh/wiki/themes" target="_blank" rel="noopener">ä¸»é¢˜åˆ—è¡¨</a></p><p>æ›´æ–°é…ç½®<code>source ~/.zshrc</code></p><p><strong>3.è‡ªåŠ¨è¡¥å…¨æ’ä»¶</strong></p><p><a href="http://mimosa-pudica.net/src/incr-0.2.zsh" target="_blank" rel="noopener">ä¸‹è½½ incr è‡ªåŠ¨è¡¥å…¨æ’ä»¶</a></p><p>å°†æ’ä»¶æ”¾åœ¨ oh-my-zsh è‡ªå®šä¹‰æ’ä»¶ç›®å½•ä¸­ <code>~/.oh-my-zsh/custom/plugins</code></p><p>åœ¨é…ç½®æ–‡ä»¶ç»“æŸæ·»åŠ ï¼š</p><p><code>source $ZSH/custom/plugins/incr/incr*.zsh</code></p><p>æ›´æ–°é…ç½®<code>source ~/.zshrc</code></p><p><strong>4.è‡ªåŠ¨æç¤ºåŠŸèƒ½æ’ä»¶</strong></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git</span> clone git://github.com/zsh-users/zsh-autosuggestions <span class="variable">$ZSH_CUSTOM</span>/plugins/zsh-autosuggestions</span><br><span class="line">vi ~/.zshrc</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">plugins=(</span><br><span class="line">  <span class="attribute">git</span> </span><br><span class="line">  zsh-autosuggestions</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æ›´æ–°é…ç½®<code>source ~/.zshrc</code></p><p><strong>5.å®‰è£…zsh-syntax-highlightingè¯­æ³•é«˜äº®æ’ä»¶</strong></p><p><a href="https://github.com/zsh-users/zsh-syntax-highlighting" target="_blank" rel="noopener">å®˜ç½‘</a></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git</span> clone https://github.com/zsh-users/zsh-syntax-highlighting.git </span><br><span class="line">echo <span class="string">"source <span class="variable">$&#123;(q-)PWD&#125;</span>/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"</span> &gt;&gt; <span class="variable">$&#123;ZDOTDIR:-$HOME&#125;</span>/.zshrc</span><br></pre></td></tr></table></figure><p>æ›´æ–°é…ç½®<code>source ~/.zshrc</code></p><p><strong>åœ¨ç¼–è¾‘å™¨å†…é…ç½®</strong></p><p>åœ¨ç»ˆç«¯é…ç½®å¥½åï¼Œæ‰“å¼€ç¼–è¾‘å™¨å‘ç°ä»æ˜¯bashï¼Œ</p><p>åœ¨æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ‚¨çš„bashrcæ–‡ä»¶</p><p><code>sudo vim  ~/.bash_profile</code></p><p>ç„¶åæ·»åŠ æ–‡ä»¶é¡¶éƒ¨æ·»åŠ </p><p><code>exec zsh</code></p><p>æ¯æ¬¡åŠ è½½ç»ˆç«¯å¹¶è¿è¡Œzsh shellæ—¶ï¼Œå®ƒéƒ½ä¼šæ‰§è¡Œå‘½ä»¤ã€‚</p><h3 id="macä¸‹sshpass-ä¸èƒ½ä½¿ç”¨"><a href="#macä¸‹sshpass-ä¸èƒ½ä½¿ç”¨" class="headerlink" title="macä¸‹sshpass ä¸èƒ½ä½¿ç”¨"></a>macä¸‹sshpass ä¸èƒ½ä½¿ç”¨</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨å®˜ç½‘ä¸‹è½½æºç åŒ…ï¼ˆæœ€æ–°çš„æ˜¯1.06)</span></span><br><span class="line"><span class="attribute">wget</span> https://sourceforge.net/projects/sshpass/files/sshpass/1.06/sshpass-1.06.tar.gz/download</span><br><span class="line"># è§£å‹</span><br><span class="line">tar xvzf sshpass-<span class="number">1</span>.<span class="number">05</span>.tar.gz</span><br><span class="line"><span class="comment"># ç¼–è¯‘å®‰è£…</span></span><br><span class="line">./configure</span><br><span class="line"><span class="comment"># å¦‚æœæ­¤å¤„å¤±è´¥å®‰è£… **xcode-select â€“install**</span></span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h3 id="macè®¾ç½®gitçš„åˆ†æ”¯è®°å½•"><a href="#macè®¾ç½®gitçš„åˆ†æ”¯è®°å½•" class="headerlink" title="macè®¾ç½®gitçš„åˆ†æ”¯è®°å½•"></a>macè®¾ç½®gitçš„åˆ†æ”¯è®°å½•</h3><p><code>åŸºäºbash,zshä¸‹ä¸èƒ½ä½¿ç”¨</code></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.è¿›å…¥ä½ çš„homeç›®å½•</span></span><br><span class="line"><span class="attribute">cd</span> ~</span><br><span class="line"><span class="comment"># 2.ç¼–è¾‘.bash_profile</span></span><br><span class="line">vi .bash_profile</span><br><span class="line"><span class="comment"># 3.å°†ä¸‹é¢çš„ä»£ç åŠ å…¥åˆ°æ–‡ä»¶çš„æœ€åå¤„</span></span><br><span class="line"></span><br><span class="line">find_git_branch () &#123;</span><br><span class="line">    <span class="attribute">local</span> dir=. head</span><br><span class="line">    until [ "$dir" -ef / ]; do</span><br><span class="line">        if [ -f "$dir/.git/HEAD" ]; then</span><br><span class="line">            head=$(&lt; "$dir/.git/HEAD")</span><br><span class="line">            if [[ $head = ref:\ refs/heads/* ]]; then</span><br><span class="line">                git_branch=" â†’ $&#123;head#*/*/&#125;"</span><br><span class="line">            elif [[ $head != '' ]]; then</span><br><span class="line">                git_branch=" â†’ (detached)"</span><br><span class="line">            else</span><br><span class="line">                git_branch=" â†’ (unknow)"</span><br><span class="line">            fi</span><br><span class="line">            return</span><br><span class="line">        fi</span><br><span class="line">        dir="../$dir"</span><br><span class="line">    done</span><br><span class="line">    git_branch=''</span><br><span class="line">&#125;</span><br><span class="line">PROMPT_COMMAND="find_git_branch; $PROMPT_COMMAND"</span><br><span class="line">black=$'\[\e[1;30m\]'</span><br><span class="line">red=$'\[\e[1;31m\]'</span><br><span class="line">green=$'\[\e[1;32m\]'</span><br><span class="line">yellow=$'\[\e[1;33m\]'</span><br><span class="line">blue=$'\[\e[1;34m\]'</span><br><span class="line">magenta=$'\[\e[1;35m\]'</span><br><span class="line">cyan=$'\[\e[1;36m\]'</span><br><span class="line">white=$'\[\e[1;37m\]'</span><br><span class="line">normal=$'\[\e[m\]'</span><br><span class="line"></span><br><span class="line">PS1="$white[$magenta\u$white@$green\h$white:$cyan\w$yellow\$git_branch$white]\$ $normal"</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ä¿å­˜é€€å‡º</span></span><br><span class="line"><span class="comment"># 5.æ‰§è¡ŒåŠ è½½å‘½ä»¤</span></span><br><span class="line"><span class="attribute">source</span> .bash_profile</span><br><span class="line"><span class="comment"># 6.å®Œæˆ</span></span><br></pre></td></tr></table></figure><h3 id="å…è®¸å®‰è£…æœªçŸ¥æ¥æº"><a href="#å…è®¸å®‰è£…æœªçŸ¥æ¥æº" class="headerlink" title="å…è®¸å®‰è£…æœªçŸ¥æ¥æº"></a>å…è®¸å®‰è£…æœªçŸ¥æ¥æº</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> spctl --master-disable</span><br></pre></td></tr></table></figure><h3 id="å¾®ä¿¡åŠ©æ‰‹"><a href="#å¾®ä¿¡åŠ©æ‰‹" class="headerlink" title="å¾®ä¿¡åŠ©æ‰‹"></a>å¾®ä¿¡åŠ©æ‰‹</h3><p>è·³è½¬è¿™ä¸ªé“¾æ¥ï¼Œæœ‰æ•™ç¨‹ï¼Œ<a href="https://github.com/lmk123/oh-my-wechat#oh-my-wechat" target="_blank" rel="noopener">https://github.com/lmk123/oh-my-wechat#oh-my-wechat</a></p><h3 id="æ·»åŠ WebStromçš„ä¸»é¢˜"><a href="#æ·»åŠ WebStromçš„ä¸»é¢˜" class="headerlink" title="æ·»åŠ WebStromçš„ä¸»é¢˜"></a>æ·»åŠ WebStromçš„ä¸»é¢˜</h3><p>å…ˆåˆ°è¿™é‡Œä¸‹è½½å–œæ¬¢çš„ä¸»é¢˜<a href="http://color-themes.com/?view=index" target="_blank" rel="noopener">http://color-themes.com/?view=index</a></p><p>ç„¶åæ‰“å¼€ws,å·¦ä¸Šè§’æ‰“å¼€<code>File-&gt; Import Settings-&gt;é€‰æ‹©jaræ–‡ä»¶</code></p><h3 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h3><p><strong>æ·»åŠ <code>code+æ–‡ä»¶</code>æ‰“å¼€VSCode</strong></p><p>å®‰è£…codeï¼šæ‰“å¼€VSCode â€“&gt; command+shift+p â€“&gt; è¾“å…¥shell command â€“&gt; ç‚¹å‡»æç¤ºShell Command: Install â€˜codeâ€™ command in PATHè¿è¡Œ</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
          <category> MACæ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitåŸºç¡€</title>
      <link href="/2019/01/16/workspace/Git/git/"/>
      <url>/2019/01/16/workspace/Git/git/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>GitåŸºç¡€</strong></p><p>[[toc]]</p><h3 id="git-emoji"><a href="#git-emoji" class="headerlink" title="git emoji"></a>git emoji</h3><p>æ‰§è¡Œ git commit æ—¶ä½¿ç”¨ emoji ä¸ºæœ¬æ¬¡æäº¤æ‰“ä¸Šä¸€ä¸ª â€œæ ‡ç­¾â€, ä½¿å¾—æ­¤æ¬¡ commit çš„ä¸»è¦å·¥ä½œå¾—ä»¥å‡¸ç°ï¼Œä¹Ÿèƒ½å¤Ÿä½¿å¾—å…¶åœ¨æ•´ä¸ªæäº¤å†å²ä¸­æ˜“äºåŒºåˆ†ä¸æŸ¥æ‰¾ã€‚</p><table><thead><tr><th align="left">emoji</th><th align="left">emoji ä»£ç </th><th align="left">commit è¯´æ˜</th></tr></thead><tbody><tr><td align="left">:tada: (åº†ç¥)</td><td align="left"><code>:tada:</code></td><td align="left">åˆæ¬¡æäº¤</td></tr><tr><td align="left">:sparkles: (ç«èŠ±)</td><td align="left"><code>:sparkles:</code></td><td align="left">å¼•å…¥æ–°åŠŸèƒ½</td></tr><tr><td align="left">:bookmark: (ä¹¦ç­¾)</td><td align="left"><code>:bookmark:</code></td><td align="left">å‘è¡Œ/ç‰ˆæœ¬æ ‡ç­¾</td></tr><tr><td align="left">:bug: (bug)</td><td align="left"><code>:bug:</code></td><td align="left">ä¿®å¤ bug</td></tr><tr><td align="left">:ambulance: (æ€¥æ•‘è½¦)</td><td align="left"><code>:ambulance:</code></td><td align="left">é‡è¦è¡¥ä¸</td></tr><tr><td align="left">:globe_with_meridians: (åœ°çƒ)</td><td align="left"><code>:globe_with_meridians:</code></td><td align="left">å›½é™…åŒ–ä¸æœ¬åœ°åŒ–</td></tr><tr><td align="left">:lipstick: (å£çº¢)</td><td align="left"><code>:lipstick:</code></td><td align="left">æ›´æ–° UI å’Œæ ·å¼æ–‡ä»¶</td></tr><tr><td align="left">:clapper: (åœºè®°æ¿)</td><td align="left"><code>:clapper:</code></td><td align="left">æ›´æ–°æ¼”ç¤º/ç¤ºä¾‹</td></tr><tr><td align="left">:rotating_light: (è­¦è½¦ç¯)</td><td align="left"><code>:rotating_light:</code></td><td align="left">ç§»é™¤ linter è­¦å‘Š</td></tr><tr><td align="left">:wrench: (æ‰³æ‰‹)</td><td align="left"><code>:wrench:</code></td><td align="left">ä¿®æ”¹é…ç½®æ–‡ä»¶</td></tr><tr><td align="left">:heavy_plus_sign: (åŠ å·)</td><td align="left"><code>:heavy_plus_sign:</code></td><td align="left">å¢åŠ ä¸€ä¸ªä¾èµ–</td></tr><tr><td align="left">:heavy_minus_sign: (å‡å·)</td><td align="left"><code>:heavy_minus_sign:</code></td><td align="left">å‡å°‘ä¸€ä¸ªä¾èµ–</td></tr><tr><td align="left">:arrow_up: (ä¸Šå‡ç®­å¤´)</td><td align="left"><code>:arrow_up:</code></td><td align="left">å‡çº§ä¾èµ–</td></tr><tr><td align="left">:arrow_down: (ä¸‹é™ç®­å¤´)</td><td align="left"><code>:arrow_down:</code></td><td align="left">é™çº§ä¾èµ–</td></tr><tr><td align="left">:zap: (é—ªç”µ)<br>:racehorse: (èµ›é©¬)</td><td align="left"><code>:zap:</code><br><code>:racehorse:</code></td><td align="left">æå‡æ€§èƒ½</td></tr><tr><td align="left">:chart_with_upwards_trend: (ä¸Šå‡è¶‹åŠ¿å›¾)</td><td align="left"><code>:chart_with_upwards_trend:</code></td><td align="left">æ·»åŠ åˆ†ææˆ–è·Ÿè¸ªä»£ç </td></tr><tr><td align="left">:rocket: (ç«ç®­)</td><td align="left"><code>:rocket:</code></td><td align="left">éƒ¨ç½²åŠŸèƒ½</td></tr><tr><td align="left">:white_check_mark: (ç™½è‰²å¤é€‰æ¡†)</td><td align="left"><code>:white_check_mark:</code></td><td align="left">å¢åŠ æµ‹è¯•</td></tr><tr><td align="left">:memo: (å¤‡å¿˜å½•)</td><td align="left"><code>:memo:</code></td><td align="left">æ’°å†™æ–‡æ¡£</td></tr><tr><td align="left">:hammer: (é”¤å­)</td><td align="left"><code>:hammer:</code></td><td align="left">é‡å¤§é‡æ„</td></tr><tr><td align="left">:art: (è°ƒè‰²æ¿)</td><td align="left"><code>:art:</code></td><td align="left">æ”¹è¿›ä»£ç ç»“æ„/ä»£ç æ ¼å¼</td></tr><tr><td align="left">:fire: (ç«ç„°)</td><td align="left"><code>:fire:</code></td><td align="left">ç§»é™¤ä»£ç æˆ–æ–‡ä»¶</td></tr><tr><td align="left">:pencil2: (é“…ç¬”)</td><td align="left"><code>:pencil2:</code></td><td align="left">ä¿®å¤ typo</td></tr><tr><td align="left">:construction: (æ–½å·¥)</td><td align="left"><code>:construction:</code></td><td align="left">å·¥ä½œè¿›è¡Œä¸­</td></tr><tr><td align="left">:construction_worker: (å·¥äºº)</td><td align="left"><code>:construction_worker:</code></td><td align="left">æ·»åŠ  CI æ„å»ºç³»ç»Ÿ</td></tr><tr><td align="left">:green_heart: (ç»¿å¿ƒ)</td><td align="left"><code>:green_heart:</code></td><td align="left">ä¿®å¤ CI æ„å»ºé—®é¢˜</td></tr><tr><td align="left">:lock: (é”)</td><td align="left"><code>:lock:</code></td><td align="left">ä¿®å¤å®‰å…¨é—®é¢˜</td></tr><tr><td align="left">:whale: (é²¸é±¼)</td><td align="left"><code>:whale:</code></td><td align="left">Docker ç›¸å…³å·¥ä½œ</td></tr><tr><td align="left">:apple: (è‹¹æœ)</td><td align="left"><code>:apple:</code></td><td align="left">ä¿®å¤ macOS ä¸‹çš„é—®é¢˜</td></tr><tr><td align="left">:penguin: (ä¼é¹…)</td><td align="left"><code>:penguin:</code></td><td align="left">ä¿®å¤ Linux ä¸‹çš„é—®é¢˜</td></tr><tr><td align="left">:checkered_flag: (æ——å¸œ)</td><td align="left"><code>:checked_flag:</code></td><td align="left">ä¿®å¤ Windows ä¸‹çš„é—®é¢˜</td></tr></tbody></table><h3 id="gitå®ç”¨å‘½ä»¤"><a href="#gitå®ç”¨å‘½ä»¤" class="headerlink" title="gitå®ç”¨å‘½ä»¤"></a>gitå®ç”¨å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git rebase -i HEAD~4 åˆå¹¶commit çš„è®°å½•</span><br><span class="line">git clone --depth&#x3D;1</span><br><span class="line">git log</span><br><span class="line">git reflog</span><br><span class="line">git remote -v :æŸ¥çœ‹ä»“åº“æº</span><br><span class="line">git checkout -b [name]:åˆ›å»ºå¹¶åˆ‡æ¢</span><br><span class="line">git reset -â€“hard</span><br><span class="line">git merge [name] :åˆå¹¶åˆ†æ”¯</span><br><span class="line">git branch -l :æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</span><br><span class="line">git branch -r :æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</span><br><span class="line">git branch -a :æŸ¥çœ‹å…¨éƒ¨åˆ†æ”¯ï¼ˆè¿œç¨‹çš„å’Œæœ¬åœ°çš„ï¼‰</span><br><span class="line">git branch -m dev develop   :æ¢æœ¬åœ°åˆ†æ”¯åå­—ï¼Œç„¶ååˆ é™¤è¿œç¨‹çš„ï¼Œæäº¤ä¸‹å°±å¯ä»¥åŒæ­¥æ›´æ–°</span><br><span class="line">git branch -d ï¼ˆåˆ†æ”¯åç§°ï¼‰ :å¯ä»¥åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆåœ¨ä¸»åˆ†æ”¯ä¸­ï¼‰</span><br><span class="line">git push origin --delete [name] :åˆ é™¤çº¿ä¸Šçš„åˆ†æ”¯</span><br><span class="line">git checkout -- file  :ä¸¢å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹</span><br><span class="line">git reset HEAD file  :å½“ä½ ä¸ä½†æ”¹ä¹±äº†å·¥ä½œåŒºæŸä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œè¿˜æ·»åŠ åˆ°äº†æš‚å­˜æ—¶ï¼Œæƒ³ä¸¢å¼ƒä¿®æ”¹</span><br><span class="line">git commit --amend -m&#39;æ–°æäº¤æ¶ˆæ¯&#39;  :æäº¤ä¿¡æ¯å‡ºé”™&#96;</span><br><span class="line">git stash  :å‚¨è—</span><br><span class="line">git stash pop  :åˆ é™¤å½“å‰å‚¨è—</span><br><span class="line">git  config --global  user.name &#39;hezhenfeng&#39;  :ä¿®æ”¹gitçš„ç”¨æˆ·å </span><br><span class="line">git  config --global  user.email &#39;feng960106@163.com&#39;  :ä¿®æ”¹gitçš„é‚®ç®±</span><br><span class="line">git config â€“-list   ï¼šæŸ¥çœ‹ä¿¡æ¯</span><br><span class="line">git config --global credential.helper cache  :è®¾ç½®è®°ä½å¯†ç ï¼ˆé»˜è®¤15åˆ†é’Ÿï¼‰</span><br><span class="line">git config credential.helper &#39;cache --timeout&#x3D;3600&#39;  :è®¾ç½®è®°ä½å¯†ç ï¼ˆ1hï¼‰</span><br><span class="line">git config --global credential.helper store :æ°¸ä¹…</span><br></pre></td></tr></table></figure><h3 id="git-revert-å’Œ-git-reset-çš„åŒºåˆ«"><a href="#git-revert-å’Œ-git-reset-çš„åŒºåˆ«" class="headerlink" title="git revert å’Œ git reset çš„åŒºåˆ«"></a>git revert å’Œ git reset çš„åŒºåˆ«</h3><ul><li><p><code>git revert</code>æ˜¯ç”¨ä¸€æ¬¡æ–°çš„commitæ¥å›æ»šä¹‹å‰çš„commitï¼Œ<code>git reset</code>æ˜¯ç›´æ¥åˆ é™¤æŒ‡å®šçš„commitã€‚</p></li><li><p>åœ¨å›æ»šè¿™ä¸€æ“ä½œä¸Šçœ‹ï¼Œæ•ˆæœå·®ä¸å¤šã€‚ä½†æ˜¯åœ¨æ—¥åç»§ç»­mergeä»¥å‰çš„è€ç‰ˆæœ¬æ—¶æœ‰åŒºåˆ«ã€‚å› ä¸º<code>git revert</code>æ˜¯ç”¨ä¸€æ¬¡é€†å‘çš„commitâ€œä¸­å’Œâ€ä¹‹å‰çš„æäº¤<br>ï¼Œå› æ­¤æ—¥ååˆå¹¶è€çš„branchæ—¶ï¼Œå¯¼è‡´è¿™éƒ¨åˆ†æ”¹å˜ä¸ä¼šå†æ¬¡å‡ºç°ï¼Œä½†æ˜¯<code>git reset</code>æ˜¯ä¹‹é—´æŠŠæŸäº›commitåœ¨æŸä¸ªbranchä¸Šåˆ é™¤ï¼Œ<br>å› è€Œå’Œè€çš„branchå†æ¬¡mergeæ—¶ï¼Œè¿™äº›è¢«å›æ»šçš„commitåº”è¯¥è¿˜ä¼šè¢«å¼•å…¥ã€‚</p></li><li><p><code>git reset</code> æ˜¯æŠŠHEADå‘åç§»åŠ¨äº†ä¸€ä¸‹ï¼Œè€Œ<code>git revert</code>æ˜¯HEADç»§ç»­å‰è¿›ï¼Œåªæ˜¯æ–°çš„commitçš„å†…å®¹å’Œè¦revertçš„å†…å®¹æ­£å¥½ç›¸åï¼Œèƒ½å¤ŸæŠµæ¶ˆè¦è¢«revertçš„å†…å®¹ã€‚</p></li></ul><h3 id="æ‹‰å–ä»£ç -git-pull-â€“rebase"><a href="#æ‹‰å–ä»£ç -git-pull-â€“rebase" class="headerlink" title="æ‹‰å–ä»£ç  git pull â€“rebase"></a>æ‹‰å–ä»£ç  git pull â€“rebase</h3><p>å‡è®¾æäº¤çº¿å›¾åœ¨æ‰§è¡Œ pull å‰æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A---B---C  remotes&#x2F;origin&#x2F;master</span><br><span class="line">             &#x2F;</span><br><span class="line">        D---E---F---G  master</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ‰§è¡Œ git pull åï¼Œæäº¤çº¿å›¾ä¼šå˜æˆè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A---B---C remotes&#x2F;origin&#x2F;master</span><br><span class="line">               &#x2F;         \</span><br><span class="line">          D---E---F---G---H master</span><br></pre></td></tr></table></figure><p>ç»“æœå¤šå‡ºäº† H è¿™ä¸ªæ²¡å¿…è¦çš„æäº¤è®°å½•ã€‚å¦‚æœæ˜¯æ‰§è¡Œ git pull â€“rebase çš„è¯ï¼Œæäº¤çº¿å›¾å°±ä¼šå˜æˆè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">remotes&#x2F;origin&#x2F;master</span><br><span class="line">                         |</span><br><span class="line">         D---E---A---B---C---F&#39;---G&#39;  master</span><br></pre></td></tr></table></figure><p>F G ä¸¤ä¸ªæäº¤é€šè¿‡ rebase æ–¹å¼é‡æ–°æ‹¼æ¥åœ¨ C ä¹‹åï¼Œå¤šä½™çš„åˆ†å‰å»æ‰äº†ï¼Œç›®çš„è¾¾åˆ°</p><p>::: danger æ³¨æ„ï¼š</p><p>git pull = git fetch + git merge</p><p>git pull â€“rebase = git fetch + git rebase</p><p>:::</p><h3 id="rebaseåˆå¹¶åˆ†æ”¯"><a href="#rebaseåˆå¹¶åˆ†æ”¯" class="headerlink" title="rebaseåˆå¹¶åˆ†æ”¯"></a>rebaseåˆå¹¶åˆ†æ”¯</h3><p>masteråˆ†æ”¯,èŠ‚ç‚¹é“¾è¡¨æŒ‡å‘ä¸º: c1&lt;â€“C3&lt;â€“c4</p><p>devåˆ†æ”¯ï¼ŒèŠ‚ç‚¹é“¾è¡¨æŒ‡å‘ä¸º: c1&lt;â€“C2&lt;â€“c5</p><p>masteråˆ†æ”¯å’Œdevåˆ†æ”¯ç¥–å…ˆä¸ºc1,å‡å®šåœ¨masteråˆ†æ”¯ä¸Šåšgit merge devåˆå¹¶ï¼Œå¾—åˆ°çš„æäº¤å†å²ä¸º:</p><p>c1&lt;â€“c2&lt;â€“c3&lt;â€“c4&lt;â€“c5&lt;â€“C6 (c1ã€ c4ã€ c5åšäº†-æ¬¡ä¸‰æ–¹åˆå¹¶å‘ç°å†²çª,æ‰‹å·¥å¤„ç†å®Œæ¯•ågit add/commitå¢åŠ äº†æäº¤èŠ‚ç‚¹c6)</p><p>é‡‡ç”¨git merge devå¤„ç†æäº¤logæ˜¯æŒ‰ç…§æ—¶é—´æˆ³å…ˆåé¡ºåºçš„ã€‚</p><p>å‡å®šé‡‡ç”¨çš„æ˜¯git rebaseå¤„ç†è¿‡ç¨‹ä¸º:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">git checkout dev</span><br><span class="line">git rebase master <span class="comment">//å°†devä¸Šçš„c2ã€ c5åœ¨masteråˆ†æ”¯ ä¸Šåšæ¬¡è¡åˆå¤„ç†,å¹¶ä¸”ä¿è¯åœ¨devæ–°å¢çš„commit ä¼šæ’åœ¨ log çš„æœ€å</span></span><br><span class="line"><span class="comment">//gitæç¤ºå‡ºç°äº†ä»£ç å†²çªï¼Œæ­¤å¤„ä¸ºä¹‹å‰åŸ‹ä¸‹çš„å†²çªç‚¹ï¼Œå¤„ç†å®Œæ¯•å</span></span><br><span class="line">git add . <span class="comment">//æ·»åŠ å†²çªå¤„ç†åçš„æ–‡ä»¶</span></span><br><span class="line">git rebase --<span class="keyword">continue</span>  <span class="comment">//å•åŠ ä¸Š--continueå‚æ•°è®©rebaseç»§ç»­å¤„ç† ï¼Œæ— éœ€æ‰§è¡Œ git-commit </span></span><br><span class="line"><span class="comment">//å¼€å‘å®Œæˆ, åœ¨ master ä¸Šç”¨ mergin åˆå¹¶dev,ä¸ä¼šè‡ªåŠ¨äº§ç”Ÿåˆå¹¶åˆ†æ”¯çš„ 'commit'</span></span><br></pre></td></tr></table></figure><p><a href="https://imgssl.luxiaoquan.com/FtjtK3w9rjUXEip-hxjzSQhRSCSC?imageView2/2/w/640/interlace/1" target="_blank" rel="noopener"></a></p><h3 id="gitåˆ†æ”¯å‘½å"><a href="#gitåˆ†æ”¯å‘½å" class="headerlink" title="gitåˆ†æ”¯å‘½å"></a>gitåˆ†æ”¯å‘½å</h3><p>masterï¼šä¸»åˆ†æ”¯ï¼Œè´Ÿè´£è®°å½•ä¸Šçº¿ç‰ˆæœ¬çš„è¿­ä»£ï¼Œè¯¥åˆ†æ”¯ä»£ç ä¸çº¿ä¸Šä»£ç æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p><p>developï¼šå¼€å‘åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯è®°å½•ç›¸å¯¹ç¨³å®šçš„ç‰ˆæœ¬ï¼Œæ‰€æœ‰çš„featureåˆ†æ”¯å’Œbugfixåˆ†æ”¯éƒ½ä»è¯¥åˆ†æ”¯åˆ›å»ºã€‚å…¶å®ƒåˆ†æ”¯ä¸ºçŸ­æœŸåˆ†æ”¯ï¼Œå…¶å®ŒæˆåŠŸèƒ½å¼€å‘ä¹‹åéœ€è¦åˆ é™¤</p><p>feature/*ï¼šç‰¹æ€§ï¼ˆåŠŸèƒ½ï¼‰åˆ†æ”¯ï¼Œç”¨äºå¼€å‘æ–°çš„åŠŸèƒ½ï¼Œä¸åŒçš„åŠŸèƒ½åˆ›å»ºä¸åŒçš„åŠŸèƒ½åˆ†æ”¯ï¼ŒåŠŸèƒ½åˆ†æ”¯å¼€å‘å®Œæˆå¹¶è‡ªæµ‹é€šè¿‡ä¹‹åï¼Œéœ€è¦åˆå¹¶åˆ° develop åˆ†æ”¯ï¼Œä¹‹ååˆ é™¤è¯¥åˆ†æ”¯ã€‚</p><p>bugfix/*ï¼šbugä¿®å¤åˆ†æ”¯ï¼Œç”¨äºä¿®å¤ä¸ç´§æ€¥çš„bugï¼Œæ™®é€šbugå‡éœ€è¦åˆ›å»ºbugfixåˆ†æ”¯å¼€å‘ï¼Œå¼€å‘å®Œæˆè‡ªæµ‹æ²¡é—®é¢˜ååˆå¹¶åˆ° develop åˆ†æ”¯åï¼Œåˆ é™¤è¯¥åˆ†æ”¯ã€‚</p><p>release/*ï¼šå‘å¸ƒåˆ†æ”¯ï¼Œç”¨äºä»£ç ä¸Šçº¿å‡†å¤‡ï¼Œè¯¥åˆ†æ”¯ä»developåˆ†æ”¯åˆ›å»ºï¼Œåˆ›å»ºä¹‹åç”±æµ‹è¯•åŒå­¦å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒè¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°bugéœ€è¦å¼€å‘äººå‘˜åœ¨è¯¥releaseåˆ†æ”¯ä¸Šè¿›è¡Œbugä¿®å¤ï¼Œæ‰€æœ‰bugä¿®å¤å®Œåï¼Œåœ¨ä¸Šçº¿ä¹‹å‰ï¼Œéœ€è¦åˆå¹¶è¯¥releaseåˆ†æ”¯åˆ°masteråˆ†æ”¯å’Œdevelopåˆ†æ”¯ã€‚</p><p>hotfix/*ï¼šç´§æ€¥bugä¿®å¤åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯åªæœ‰åœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä»masteråˆ†æ”¯åˆ›å»ºï¼Œç”¨äºç´§æ€¥ä¿®å¤çº¿ä¸Šbugï¼Œä¿®å¤å®Œæˆåï¼Œéœ€è¦åˆå¹¶è¯¥åˆ†æ”¯åˆ°masteråˆ†æ”¯ä»¥ä¾¿ä¸Šçº¿ï¼ŒåŒæ—¶éœ€è¦å†åˆå¹¶åˆ°developåˆ†æ”¯ã€‚</p><h3 id="gitlabçš„key"><a href="#gitlabçš„key" class="headerlink" title="gitlabçš„key"></a>gitlabçš„key</h3><p>ssh-keygen -t rsa -C â€œ<a href="mailto:feng960106@163.com">feng960106@163.com</a>â€œ</p><p>cat ~/.ssh/id_rsa.pub</p><h3 id="è¿ç§»-github"><a href="#è¿ç§»-github" class="headerlink" title="è¿ç§» github"></a>è¿ç§» github</h3><p>sed -i â€˜â€™ â€œs/115.28.166.109/123.57.86.216/gâ€ .git/config</p><h3 id="git-æ— æ³•æ·»åŠ æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶"><a href="#git-æ— æ³•æ·»åŠ æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶" class="headerlink" title="git æ— æ³•æ·»åŠ æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶"></a>git æ— æ³•æ·»åŠ æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶</h3><p>æœ€è¿‘åšé¡¹ç›®æ—¶ï¼Œå‘ç°æ— æ³•æäº¤æŸä¸ªå­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ã€‚</p><p>googleåå‘ç°å¯èƒ½æ˜¯è¯¥å­æ–‡ä»¶å¤¹ä¸‹æœ‰.gitæ–‡ä»¶å¤¹å¯¼è‡´æ— æ³•ä¸Šä¼ ã€‚</p><p>åˆ é™¤å­æ–‡ä»¶å¤¹ä¸‹.gitåï¼Œä¾ç„¶æ— æ³•æäº¤å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ã€‚</p><p>ç»§ç»­googleï¼Œ</p><p>å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š</p><p> git rm â€“cached directory<br> git add directory</p><p><strong>æ³¨ï¼š</strong> directoryä¸ºå­æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚</p><p>ä½†æ˜¯æ‰§è¡Œgit rm â€“cached directoryæ—¶ï¼Œæç¤º</p><blockquote><p>fatal: Unable to create â€˜xx/.git/index.lockâ€™: File exists.</p></blockquote><p>æ‰§è¡Œrm -f xx/.git/index.lockåè§£å†³</p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
          <category> GitåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6-æ–°å¢ç‰¹æ€§ä¸€è§ˆ</title>
      <link href="/2019/01/16/workspace/Js/es6/"/>
      <url>/2019/01/16/workspace/Js/es6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ES6-æ–°å¢ç‰¹æ€§ä¸€è§ˆ</strong></p><p>[[toc]]</p><h3 id="1-let-constå–ä»£var"><a href="#1-let-constå–ä»£var" class="headerlink" title="1. let/constå–ä»£var"></a>1. let/constå–ä»£var</h3><h3 id="2-å­—ç¬¦ä¸²æ¨¡æ¿"><a href="#2-å­—ç¬¦ä¸²æ¨¡æ¿" class="headerlink" title="2. å­—ç¬¦ä¸²æ¨¡æ¿"></a>2. å­—ç¬¦ä¸²æ¨¡æ¿</h3><h3 id="3-å¯¹è±¡è§£æ„"><a href="#3-å¯¹è±¡è§£æ„" class="headerlink" title="3. å¯¹è±¡è§£æ„"></a>3. å¯¹è±¡è§£æ„</h3><h3 id="4-æ–°æ•°æ®ç±»å‹-Symbol"><a href="#4-æ–°æ•°æ®ç±»å‹-Symbol" class="headerlink" title="4. æ–°æ•°æ®ç±»å‹ Symbol"></a>4. æ–°æ•°æ®ç±»å‹ Symbol</h3><h3 id="5-æ–°æ•°æ®ç»“æ„Map-Set-WeakMap-WeakSet"><a href="#5-æ–°æ•°æ®ç»“æ„Map-Set-WeakMap-WeakSet" class="headerlink" title="5. æ–°æ•°æ®ç»“æ„Map/Set/WeakMap/WeakSet"></a>5. æ–°æ•°æ®ç»“æ„<a href="https://github.com/lukehoban/es6features#map--set--weakmap--weakset" target="_blank" rel="noopener">Map/Set/WeakMap/WeakSet</a></h3><h3 id="6-Proxyã€Reflect"><a href="#6-Proxyã€Reflect" class="headerlink" title="6. Proxyã€Reflect"></a>6. <a href="https://github.com/lukehoban/es6features#proxies" target="_blank" rel="noopener">Proxy</a>ã€<a href="https://www.cnblogs.com/zczhangcui/p/6486582.html" target="_blank" rel="noopener">Reflect</a></h3><h3 id="7-æ‰©å±•"><a href="#7-æ‰©å±•" class="headerlink" title="7. æ‰©å±•"></a>7. æ‰©å±•</h3><ul><li><p>å­—ç¬¦ä¸²å¡«å……ï¼ˆpadStart å’Œ padEndï¼‰</p></li><li><p>Array</p><ul><li>Array.from()</li><li>Array.of()</li><li>Array.copyWithin()</li><li>Array.find()</li><li>Array.findIndex()</li><li>Array.fill()</li><li>Array.includes()<sup><code>ES7</code></sup></li></ul></li><li><p>Object</p><ul><li>Object.keys()</li><li>Object.values()<sup><code>ES8</code></sup></li><li>Object.entries()<sup><code>ES8</code></sup></li><li>Object.assign()</li><li>Object. is()</li></ul></li></ul><h3 id="8-å¼‚æ­¥"><a href="#8-å¼‚æ­¥" class="headerlink" title="8. å¼‚æ­¥"></a>8. å¼‚æ­¥</h3><ul><li><a href="https://github.com/lukehoban/es6features#promises" target="_blank" rel="noopener">Promise</a><ul><li>Promise.prototype.then</li><li>Promise.prototype.catch</li><li>Promise.prototype.finally<sup><code>ES9</code></sup></li><li>Promise.all()</li><li>Promise.rece()</li></ul></li><li><a href="https://github.com/lukehoban/es6features#iterators--forof" target="_blank" rel="noopener">Iterator</a><ul><li>Iteratoræ¥å£</li><li>for of</li></ul></li><li><a href="https://github.com/lukehoban/es6features#generators" target="_blank" rel="noopener">Generator</a><ul><li>yield*</li></ul></li><li>async/await<sup><code>ES8</code></sup></li></ul><h3 id="9-Classç±»"><a href="#9-Classç±»" class="headerlink" title="9. Classç±»"></a>9. Classç±»</h3><ul><li>class</li><li>extends</li><li>decorator<sup><code>ES7</code></sup></li></ul><h3 id="10-Module"><a href="#10-Module" class="headerlink" title="10. Module"></a>10. Module</h3><ul><li>import</li><li>export</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// export default æ–¹å¼</span></span><br><span class="line"><span class="keyword">import</span> defaultName <span class="keyword">from</span> <span class="string">'modules.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export type æ–¹å¼</span></span><br><span class="line"><span class="keyword">import</span> &#123; export1, export2 &#125; <span class="keyword">from</span> <span class="string">'modules'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; export1 <span class="keyword">as</span> ex1, export2 <span class="keyword">as</span> ex2 &#125; <span class="keyword">from</span> <span class="string">'moduls.js'</span>; <span class="comment">// as å…³é”®å­—</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> moduleName <span class="keyword">from</span> <span class="string">'modules.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒæ—¶å¼•å…¥export default å’Œexport type</span></span><br><span class="line"><span class="keyword">import</span> defaultName, &#123; expoprt1, export2 &#125; <span class="keyword">from</span> <span class="string">'modules'</span>;</span><br><span class="line"><span class="keyword">import</span> defaultNameï¼Œ * <span class="keyword">as</span> moduleName <span class="keyword">from</span> <span class="string">'modules'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æ— è¾“å‡ºæ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'modules'</span>;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><ul><li><p><a href="https://zhuanlan.zhihu.com/p/87699079" target="_blank" rel="noopener">å¸å¾’æ­£ç¾</a></p></li><li><p><a href="https://github.com/lukehoban/es6features" target="_blank" rel="noopener">es6features</a></p></li><li><p><a href="https://github.com/tc39/proposals/blob/master/finished-proposals.md" target="_blank" rel="noopener">Finished Proposals</a></p></li><li><p><a href="http://es6.ruanyifeng.com/#docs/reference" target="_blank" rel="noopener">ryf es6 reference</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Babel-polyfill</title>
      <link href="/2019/01/16/workspace/Webpack/babel_polyfill/"/>
      <url>/2019/01/16/workspace/Webpack/babel_polyfill/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Babel-polyfill</strong></p><p>[[toc]]</p><h3 id="babel-preset-env-babel-polyfillå’Œ-babel-plugin-transform-runtime"><a href="#babel-preset-env-babel-polyfillå’Œ-babel-plugin-transform-runtime" class="headerlink" title="@babel/preset-env, @babel/polyfillå’Œ@babel/plugin-transform-runtime"></a>@babel/preset-env, @babel/polyfillå’Œ@babel/plugin-transform-runtime</h3><p>è¿™å¯ä»¥è¯´æ˜¯babelå®˜æ–¹çš„å¾—æ„ä¹‹ä½œï¼Œæœ€æ—©çš„æ—¶å€™æ²¡æœ‰è¿™ä¸ªåŒ…ï¼Œæœ‰çš„æ˜¯babel-preset-es2015è¿™æ ·çš„åŒ…ï¼Œåæ¥æ¯æ¬¡æ–°æ ‡å‡†å‘å¸ƒä¹‹åï¼Œå°±è¦æ–°åŠ ä¸€ä¸ªåŒ…ã€‚<br/><br>babelé¡ºåº”æ°‘æ„ï¼Œå‘å¸ƒäº†babel-preset-envè¿™ä¸ªåŒ…ï¼Œå®ƒä¸€æ¬¡æ€§å›Šæ‹¬äº†å·²å‘å¸ƒçš„æ‰€æœ‰æ ‡å‡†åŒ…ã€‚<br/><br>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸€ä¸‹ï¼Œpreset-envçš„é¦–è¦ä½œç”¨ï¼Œä¸æ˜¯å¸®æˆ‘ä»¬æŠŠES6+ä»£ç è½¬æˆES5.å®ƒçš„é¦–è¦ä½œç”¨æ˜¯è®¤è¯»ES6+ä»£ç ã€‚<br/><br>åœ¨ä½¿ç”¨preset-envä¹‹å‰ï¼Œbabelæ˜¯æ— æ³•è®¤è¯†ES6+ä»£ç çš„ï¼Œè¿è¡Œæ—¶ä¼šæŠ¥Tokené”™è¯¯ã€‚åœ¨ä½¿ç”¨preset-envä¹‹åï¼Œbabelæ‰èƒ½è®¤è¯†è¿™äº›ä»£ç è¯­æ³•ï¼Œå¹¶å°†å®ƒä»¬æŠ½è±¡å‡ºASTæ ‘ã€‚<br/><br>preset-envæœ¬èº«åŒ…å«äº†ä¸€å¤§å †pluginï¼Œå¹¶é€šè¿‡é…ç½®æ¥æ§åˆ¶æ’ä»¶ï¼Œä»è€Œæ§åˆ¶è½¬ç æ•ˆæœ<br/></p><p><strong><code>@babel/preset-env</code></strong></p><p><strong>targets</strong><br>æ§åˆ¶ç›®æ ‡æµè§ˆå™¨çš„ç‰ˆæœ¬</p><p><strong>modules</strong><br>é»˜è®¤ä¸ºcommonjsï¼Œè®¾ç½®ä¸ºfalseæ—¶ï¼Œä¸ä¼šè½¬ç æ¨¡å—åŠ è½½ï¼Œimport from è¯­æ³•ä¸ä¼šè½¬ç </p><p><strong>useBuiltIns</strong><br>æ˜¯å¦è‡ªåŠ¨åŠ è½½polyfillã€‚å®ƒæœ‰ä¸‰ä¸ªå€¼å¯é€‰ï¼šfalseï¼ˆé»˜è®¤ï¼‰, entry, usageã€‚</p><p><strong>corejs</strong><br>æ‰¿æ¥useBuiltInsï¼Œå½“useBuiltInså€¼ä¸ºentryæˆ–usageæ—¶ï¼Œæœ‰æ•ˆã€‚å®ƒå¯ä»¥è®¾ç½®ä¸ºï¼š2ï¼Œ3ï¼Œ{ version:2, proposals:true }</p><p><strong><code>@babel/polyfill</code></strong><br>è¿™ä¸ªåŒ…æ˜¯ä¸€ä¸ªçº¯è¿è¡Œæ—¶çš„åŒ…ï¼Œä¸æ˜¯babelæ’ä»¶ã€‚å®ƒçš„ä½œç”¨æ˜¯ç›´æ¥æ”¹å†™å…¨å±€å˜é‡ï¼Œä»è€Œè®©è¿è¡Œç¯å¢ƒæ”¯æŒç»è¿‡present-envè½¬ç åçš„ä»£ç </p><p><strong><code>@babel/plugin-transform-runtime</code></strong></p><ul><li>å®ƒæœ‰ä¸¤ä¸ªä½œç”¨ï¼š<ul><li>å°†preset-envæ‰€äº§ç”Ÿçš„helperså‡½æ•°æå‡ºåˆ°ä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶ä¸­ï¼Œä»è€Œå‡å°‘ä»£ç é‡</li><li>å»ºç«‹è¿è¡Œæ—¶æ²™ç›’ï¼Œé¿å…å…¨å±€æ±¡æŸ“</li></ul></li></ul><p><strong>corejs</strong></p><p><strong>helpers</strong><br>æ˜¯å¦è¦å°†æ‰€æœ‰helperå‡½æ•°æç‚¼åˆ°å¦å¤–ä¸€ä¸ªå…¬å…±æ–‡ä»¶ä¸­ã€‚é»˜è®¤ä¸ºtrueã€‚</p><p>å½“ä½¿ç”¨@babel/plugin-trasnform-runtimeä¹‹åï¼ŒåŸæœ¬babelä¼šç›´æ¥åœ¨æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªhelperå‡½æ•°ï¼Œç°åœ¨ä¼šé‡‡ç”¨requireçš„æ–¹å¼ï¼Œä»@babel/runtimeä¸­å¼•å…¥è¿™äº›å‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ä»£ç é‡</p><h3 id="polyfilläº†è§£ä¸‹"><a href="#polyfilläº†è§£ä¸‹" class="headerlink" title="polyfilläº†è§£ä¸‹"></a>polyfilläº†è§£ä¸‹</h3><p>babel ç¼–è¯‘æ—¶åªè½¬æ¢è¯­æ³•ï¼Œå‡ ä¹å¯ä»¥ç¼–è¯‘æ‰€æœ‰æ—¶æ–°çš„ JavaScript è¯­æ³•ï¼Œä½†å¹¶ä¸ä¼šè½¬åŒ–BOMé‡Œé¢ä¸å…¼å®¹çš„API<br/><br>æ¯”å¦‚ <strong>Promise,Set,Symbol,Array.from,Array.is,async</strong> ç­‰ç­‰çš„ä¸€äº›API<br/><br>è¿™æ—¶å€™å°±éœ€è¦ polyfill æ¥è½¬è½¬åŒ–è¿™äº›API<br/><br>babel è½¬è¯‘è¯­æ³•éœ€è¦ä¸€äº›plugin<br/><br>å¦‚<strong>babel-preset-es2015,stage-0,stage-1</strong>ç­‰ç­‰<br/><br>å…¶ä¸­çš„ es2015 è¡¨ç¤º babelä¼šåŠ è½½ es6 ç›¸å…³çš„ç¼–è¯‘æ¨¡å—ï¼Œç„¶å stage-0 è¡¨ç¤ºçš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br/><br>stage ç³»åˆ—é›†åˆäº†ä¸€äº›å¯¹ es7 çš„è‰æ¡ˆæ”¯æŒçš„æ’ä»¶ï¼Œç”±äºæ˜¯è‰æ¡ˆï¼Œæ‰€ä»¥ä½œä¸ºæ’ä»¶çš„å½¢å¼æä¾›ã€‚<br/></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">stage<span class="number">-0</span> - Strawman: just an idea, possible Babel plugin.</span><br><span class="line">stage<span class="number">-1</span> - Proposal: <span class="keyword">this</span> is worth working on.</span><br><span class="line">stage<span class="number">-2</span> - Draft: initial spec.</span><br><span class="line">stage<span class="number">-3</span> - Candidate: complete spec and initial browser implementations.</span><br><span class="line">stage<span class="number">-4</span> - Finished: will be added to the next yearly release.</span><br></pre></td></tr></table></figure><p>stage æ˜¯å‘ä¸‹å…¼å®¹  0&gt;1&gt;2&gt;3&gt;4 æ‰€åŒ…å«çš„æ’ä»¶æ•°é‡ä¾æ¬¡å‡å°‘</p><p>polyfill æœ‰ä¸‰ç§ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">babel-runtime</span><br><span class="line">babel-plugin-transform-runtime(æ¨è-é»˜è®¤ä¾èµ–äºbabel-runtime)</span><br><span class="line">babel-polyfill</span><br><span class="line">&#96;</span><br></pre></td></tr></table></figure><p>åœ¨webpackä¸­ï¼Œ<strong>babel-plugin-transform-runtime å®é™…ä¸Šæ˜¯ä¾èµ–babel-runtime</strong> <br/><br>å› ä¸ºbabelç¼–è¯‘es6åˆ°es5çš„è¿‡ç¨‹ä¸­ï¼Œbabel-plugin-transform-runtimeè¿™ä¸ªæ’ä»¶ä¼šè‡ªåŠ¨polyfill es5ä¸æ”¯æŒçš„ç‰¹æ€§ï¼Œ<br/><br>è¿™äº›polyfillåŒ…å°±æ˜¯åœ¨babel-runtimeè¿™ä¸ªåŒ…é‡Œ core-js ã€regeneratorç­‰  polyfillã€‚<br/><br>babel-runtimeå’Œ babel-plugin-transform-runtimeçš„åŒºåˆ«æ˜¯ï¼Œç›¸å½“ä¸€å‰è€…æ˜¯æ‰‹åŠ¨æŒ¡è€Œåè€…æ˜¯è‡ªåŠ¨æŒ¡ï¼Œæ¯å½“è¦è½¬è¯‘ä¸€ä¸ªapiæ—¶éƒ½è¦æ‰‹åŠ¨åŠ ä¸Šrequire(â€˜babel-runtimeâ€™)ï¼Œ<br/><br>è€Œbabel-plugin-transform-runtimeä¼šç”±å·¥å…·è‡ªåŠ¨æ·»åŠ ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯ä¸ºapiæä¾›æ²™ç®±çš„å«ç‰‡æ–¹æ¡ˆï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€çš„apiï¼Œå› æ­¤é€‚åˆç”¨åœ¨ç¬¬ä¸‰æ–¹çš„å¼€å‘äº§å“ä¸­ã€‚<br/></p><h3 id="babel7ä¸­-corejs-å’Œ-corejs2-çš„åŒºåˆ«"><a href="#babel7ä¸­-corejs-å’Œ-corejs2-çš„åŒºåˆ«" class="headerlink" title="babel7ä¸­ corejs å’Œ corejs2 çš„åŒºåˆ«"></a>babel7ä¸­ corejs å’Œ corejs2 çš„åŒºåˆ«</h3><p>æœ€è¿‘åœ¨ç»™é¡¹ç›®å‡çº§babel7ï¼Œæœ‰ä¸€äº›æ”¹å˜ä½†æ˜¯å˜åŒ–ä¸å¤§,åœ¨å‡çº§ä¸­å‘ç° babel7 å˜åŒ–æŒºå¤§çš„ï¼ŒåŒ…æ‹¬æ’ä»¶å’ŒåŒ…ã€‚<br>å…¶ä¸­ä¸€é¡¹åŠŸèƒ½ç‰¹åˆ«èµï¼Œå°±æ˜¯  @babel/preset-env  ä¸­çš„  useBuiltIns  é€‰é¡¹ï¼Œå¦‚æœä½ è®¾ç½®äº†  usage ï¼Œbabel ç¼–ç»çš„æ—¶å€™å°±ä¸ç”¨æ•´ä¸ª polyfills , åªåŠ è½½ä½ ä½¿ç”¨ polyfillsï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘åŒ…çš„å¤§å°ã€‚<br>åœ¨ä½¿ç”¨ babel ä¸­è¿˜æƒ³å‡å°‘ä»£ç ï¼Œå°±éœ€è¦å¼•å…¥ babel çš„è¿è¡Œæ—¶ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">yarn add @babel/plugin-transform-runtime -D</span><br><span class="line">yarn add @babel/runtime</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ol><li>ä¸¤ä¸ªåŒ…å¼•å…¥çš„èŒƒå›´ä¸ä¸€æ ·ï¼šä¸€ä¸ªåœ¨å¼€å‘æ—¶å¼•å…¥ï¼Œä¸€ä¸ªåœ¨è¿è¡Œæ—¶å¼•å…¥ã€‚</li><li>plugin-transform-runtime å·²ç»é»˜è®¤åŒ…æ‹¬äº† @babel/polyfillï¼Œå› æ­¤ä¸ç”¨åœ¨ç‹¬ç«‹å¼•å…¥ã€‚</li></ol><p>åœ¨ plugin-transform-runtime ä¸­æœ‰ä¸€ä¸ª corejs å¾ˆå¥‡æ€ªï¼Œå¯ä»¥è®¾ç½®æˆ false æˆ–è€… 2ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆè¿™æ ·ï¼Ÿ<br/><br>å¤§å®¶çŸ¥é“ corejs æ˜¯ä¸€ä¸ªç»™ä½ç‰ˆæœ¬çš„æµè§ˆå™¨æä¾›æ¥å£çš„åº“ï¼Œå¦‚ Promise, map, set ç­‰ã€‚<br/><br>åœ¨ babel ä¸­ä½ è®¾ç½®æˆ false æˆ–è€…ä¸è®¾ç½®ï¼Œå°±æ˜¯å¼•å…¥çš„æ˜¯ corejs ä¸­çš„åº“ï¼Œè€Œä¸”åœ¨å…¨å±€ä¸­å¼•å…¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¾µå…¥äº†å…¨å±€çš„å˜é‡ã€‚å¯ä»¥è§‚å¯Ÿä»¥ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™æ˜¯ä½ å†™çš„ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;, ms)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// babel ç¼–ç»æˆçš„ä»£ç </span></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"core-js/modules/es6.promise"</span>);  <span class="comment">// è¿™é‡Œå¯ä»¥çœ‹å‡ºæ˜¯å…¨å±€å¼•å…¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, ms);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çš„å…¨å±€æœ‰ä¸€ä¸ªå¼•å…¥ï¼Œé˜²æ­¢å¼•å…¥çš„åº“å½±å“å…¨å±€ï¼Œé‚£ä½ å°±éœ€è¦å¼•æŠŠ corejs è®¾ç½®æˆ2ã€‚ä¸‹é¢å°±æ˜¯è®¾çœŸç½®æˆ2ï¼Œç¼–ç»æˆçš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> _interopRequireDefault = <span class="built_in">require</span>(<span class="string">"@babel/runtime-corejs2/helpers/interopRequireDefault"</span>);</span><br><span class="line"><span class="keyword">var</span> _promise = _interopRequireDefault(<span class="built_in">require</span>(<span class="string">"@babel/runtime-corejs2/core-js/promise"</span>)); <span class="comment">// ç‹¬ç«‹å˜é‡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> _promise.default(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, ms);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»ç¼–ç»å‡ºçš„ä»£ç çœ‹åˆ°ï¼ŒPromise ä»£ç å˜æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„å˜é‡ _promiseï¼Œä¸ä¼šå½±å“å…¨å±€çš„ Promiseã€‚<br/><br>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå¼•å…¥çš„åº“è€…è‡ªå·±å¼•å…¥äº†ä¸€ä¸ªå˜é‡ï¼Œè¿™æ ·å¦‚æœä½ å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ä¼šå¯¹ Promise è¿›è¡Œä¸€äº›è‡ªå®šä¹‰æ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ç¬¬ä¸‰æ–¹åº“æŠ¥é”™ã€‚<br/><br>è¿˜è¦æ³¨æ„ä¸€ç‚¹æ˜¯ï¼š å¦‚æœä½ è®¾ç½®äº† corejs2ï¼Œé‚£ä½ å°±éœ€è¦åŠ å…¥ä¸‹é¢çš„åº“:</p><p><span style='display: block;text-align: left;'> corejsé€‰é¡¹</span>|<span style='display: block;text-align: left;'> å®‰è£…å‘½ä»¤</span>|<span style='display: block;text-align: left;'>é‡Œé¢åŒ…å«çš„æ–‡ä»¶</span><br>â€“|:â€“:|:â€“:|â€“|<br>false |    yarn add @babel/runtime |  helpersã€regenerator<br><strong>2</strong> |    <strong>yarn add  @babel/runtime-corejs2</strong> |  core-jsã€helpersã€regenerator<br>3  | yarn add  @babel/runtime-corejs3 | è¿˜æ”¯æŒå®ä¾‹å±æ€§ï¼ˆä¾‹å¦‚[].includes)</p><p>å‚è€ƒæ–‡æ¡£ï¼š<br/><br><a href="https://babeljs.io/docs/en/babel-preset-env/" target="_blank" rel="noopener">babel-preset-env</a></p><p><a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime" target="_blank" rel="noopener">babel-plugin-transform-runtime</a></p><p>runtimeè½¬æ¢å™¨æ’ä»¶ä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">å½“ä½ ä½¿ç”¨generators/<span class="keyword">async</span>æ–¹æ³•ã€å‡½æ•°æ—¶è‡ªåŠ¨è°ƒç”¨babel-runtime/regenerator</span><br><span class="line">å½“ä½ ä½¿ç”¨ES6 çš„<span class="built_in">Map</span>æˆ–è€…å†…ç½®çš„ä¸œè¥¿æ—¶è‡ªåŠ¨è°ƒç”¨babel-runtime/core-js</span><br><span class="line">ç§»é™¤å†…è”babel helperså¹¶æ›¿æ¢ä½¿ç”¨babel-runtime/helpersæ¥æ›¿æ¢</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">transform-runtimeä¼˜ç‚¹</span><br><span class="line">    ä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡</span><br><span class="line">    å¤šæ¬¡ä½¿ç”¨åªä¼šæ‰“åŒ…ä¸€æ¬¡</span><br><span class="line">    ä¾èµ–ç»Ÿä¸€æŒ‰éœ€å¼•å…¥,æ— é‡å¤å¼•å…¥,æ— å¤šä½™å¼•å…¥</span><br><span class="line"></span><br><span class="line">transform-runtimeç¼ºç‚¹</span><br><span class="line">   ä¸æ”¯æŒå®ä¾‹åŒ–çš„æ–¹æ³•<span class="built_in">Array</span>.includes(x) å°±ä¸èƒ½è½¬åŒ–</span><br><span class="line">   å¦‚æœä½¿ç”¨çš„APIç”¨çš„æ¬¡æ•°ä¸æ˜¯å¾ˆå¤šï¼Œé‚£ä¹ˆtransform-runtime å¼•å…¥polyfillçš„åŒ…ä¼šæ¯”ä¸æ˜¯transform-runtimeæ—¶å¤§</span><br><span class="line"></span><br><span class="line">babel-polyfillåˆ™æ˜¯é€šè¿‡æ”¹å†™å…¨å±€prototypeçš„æ–¹å¼å®ç°ï¼Œæ¯”è¾ƒé€‚åˆå•ç‹¬è¿è¡Œçš„é¡¹ç›®ã€‚</span><br><span class="line">    å¼€å¯babel-polyfillçš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­<span class="built_in">require</span>ï¼Œæˆ–è€…åœ¨webpackçš„entryä¸­æ·»åŠ ï¼Œä¹Ÿå¯ä»¥åœ¨babelçš„envä¸­è®¾ç½®useBuildinsä¸º<span class="literal">true</span>æ¥å¼€å¯ã€‚</span><br><span class="line">    ä½†æ˜¯babel-polyfillä¼šæœ‰è¿‘<span class="number">100</span>Kï¼Œ</span><br><span class="line">    æ‰“åŒ…åä»£ç å†—ä½™é‡æ¯”è¾ƒå¤§ï¼Œ</span><br><span class="line">    å¯¹äºç°ä»£çš„æµè§ˆå™¨,æœ‰äº›ä¸éœ€è¦polyfillï¼Œé€ æˆæµé‡æµªè´¹</span><br><span class="line">    æ±¡æŸ“äº†å…¨å±€å¯¹è±¡</span><br><span class="line"></span><br><span class="line">@babel/runtime-corejs2åŒ…å«ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼š</span><br><span class="line">    core-js  å¼•ç”¨core-jsè¿™ä¸ªnpmåŒ…</span><br><span class="line">    helpers  å®šä¹‰äº†ä¸€äº›å¤„ç†æ–°çš„è¯­æ³•å…³é”®å­—çš„å¸®åŠ©å‡½æ•°</span><br><span class="line">    regenerator  ä»…ä»…æ˜¯å¼•ç”¨regenerator-runtimeè¿™ä¸ªnpmåŒ…</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Webpack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Webpackçš„ä½¿ç”¨</title>
      <link href="/2019/01/14/workspace/Webpack/use/"/>
      <url>/2019/01/14/workspace/Webpack/use/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Webpackçš„ä½¿ç”¨</strong></p><p>[[toc]]</p><h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>å¼‚æ­¥åŠ è½½æ¨¡å—</span><br><span class="line"><span class="number">2.</span>æå–ç¬¬ä¸‰åº“</span><br><span class="line"><span class="number">3.</span>ä»£ç å‹ç¼©</span><br><span class="line"><span class="number">4.</span>å»é™¤ä¸å¿…è¦çš„æ’ä»¶</span><br><span class="line"><span class="number">5.</span>å›¾ç‰‡base64</span><br><span class="line"><span class="number">6.</span>æŒ‰éœ€åŠ è½½</span><br><span class="line"><span class="number">7.</span>å¼€å¯Gzipå‹ç¼©</span><br></pre></td></tr></table></figure><h3 id="splitChunksæ‹†åŒ…"><a href="#splitChunksæ‹†åŒ…" class="headerlink" title="splitChunksæ‹†åŒ…"></a>splitChunksæ‹†åŒ…</h3><ul><li>Webpack4ä¹‹SplitChunksPlugin</li><li>Webpack3çš„CommonsChunkPluginï¼ˆå·²åºŸå¼ƒï¼‰</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå·±é¡¹ç›®çš„é…ç½®</span></span><br><span class="line">&#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: <span class="string">'all'</span>,</span><br><span class="line">      minSize: <span class="number">30000</span>,<span class="comment">//åˆ†ç¦»åçš„æœ€å°å—æ–‡ä»¶å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚</span></span><br><span class="line">      maxSize: <span class="number">0</span>,</span><br><span class="line">      minChunks: <span class="number">1</span>,<span class="comment">//åˆ†ç¦»å‰ï¼Œè¯¥å—è¢«å¼•å…¥çš„æ¬¡æ•°ï¼ˆä¹Ÿå°±æ˜¯æŸä¸ªjsæ–‡ä»¶é€šè¿‡importæˆ–requireå¼•å…¥çš„æ¬¡æ•°ï¼‰</span></span><br><span class="line">      maxAsyncRequests: <span class="number">5</span>,<span class="comment">//å†…å±‚æ–‡ä»¶ï¼ˆç¬¬äºŒå±‚ï¼‰æŒ‰éœ€åŠ è½½æ—¶æœ€å¤§çš„å¹¶è¡ŒåŠ è½½æ•°é‡</span></span><br><span class="line">      maxInitialRequests: <span class="number">3</span>,<span class="comment">//ä¸€ä¸ªå…¥å£æ–‡ä»¶å¯ä»¥å¹¶è¡ŒåŠ è½½çš„æœ€å¤§æ–‡ä»¶æ•°é‡</span></span><br><span class="line">      automaticNameDelimiter: <span class="string">'~'</span>,<span class="comment">//ä¿®æ”¹ä¸Šæ–‡ä¸­çš„ â€œ~â€ ,  è‹¥æ”¹ä¸ºï¼š â€œ-â€ åˆ™åˆ†ç¦»åçš„jsé»˜è®¤å‘½åè§„åˆ™ä¸º [æ¥æº]-[å…¥å£çš„keyå€¼].js</span></span><br><span class="line">      name: <span class="literal">true</span>,<span class="comment">//ç”¨ä»¥æ§åˆ¶åˆ†ç¦»åä»£ç å—çš„å‘½åï¼Œå½“å­˜åœ¨åŒ¹é…çš„ç¼“å­˜ç»„ï¼ˆåé¢ä¼šè¯´åˆ°ï¼‰æ—¶ï¼Œå‘½åä½¿ç”¨ç¼“å­˜ç»„ä¸­çš„nameå€¼ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¸º  [æ¥æº]~[å…¥å£çš„keyå€¼].js  çš„æ ¼å¼</span></span><br><span class="line">      cacheGroups: &#123;<span class="comment">//åå­—å«åšç¼“å­˜ç»„ï¼Œå…¶å®å°±æ˜¯å­˜æ”¾åˆ†ç¦»ä»£ç å—çš„è§„åˆ™çš„å¯¹è±¡ï¼Œå«åšcacheGroupçš„åŸå› æ˜¯webpackä¼šå°†è§„åˆ™æ”¾ç½®åœ¨cacheæµä¸­ï¼Œä¸ºå¯¹åº”çš„å—æ–‡ä»¶åŒ¹é…å¯¹åº”çš„æµï¼Œä»è€Œç”Ÿæˆåˆ†ç¦»åçš„å—ã€‚</span></span><br><span class="line">      <span class="comment">// æŠ½å–æ‰€æœ‰CSSä¸ºä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">      <span class="comment">// https://webpack.js.org/plugins/mini-css-extract-plugin/#extracting-all-css-in-a-single-file</span></span><br><span class="line">      styles: &#123; <span class="attr">name</span>: <span class="string">'styles'</span>, <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">chunks</span>: <span class="string">'all'</span>, <span class="attr">enforce</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// ç¬¬ä¸‰æ–¹ç»„ä»¶</span></span><br><span class="line">      common: &#123;</span><br><span class="line">        name: <span class="string">'common'</span>,</span><br><span class="line">        chunks: <span class="string">'all'</span>,<span class="comment">//chunks :åŒ¹é…çš„å—çš„ç±»å‹ï¼šinitialï¼ˆåˆå§‹å—ï¼‰ï¼Œasyncï¼ˆæŒ‰éœ€åŠ è½½çš„å¼‚æ­¥å—ï¼‰ï¼Œallï¼ˆæ‰€æœ‰å—ï¼‰</span></span><br><span class="line">        test: <span class="regexp">/[\\/]node_modules[\\/](react|react-dom|react-router|react-router-dom)[\\/]/</span>,</span><br><span class="line">        priority: <span class="number">10</span>,</span><br><span class="line">        enforce: <span class="literal">true</span>,</span><br><span class="line">        reuseExistingChunk: <span class="literal">true</span> <span class="comment">// å¯è®¾ç½®æ˜¯å¦é‡ç”¨è¯¥chunk</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// æŒ‡å®šç»„ä»¶</span></span><br><span class="line">      antd: &#123;</span><br><span class="line">        name: <span class="string">'antd'</span>,</span><br><span class="line">        chunks: <span class="string">'all'</span>,</span><br><span class="line">        test: <span class="regexp">/[\\/]node_modules[\\/](@ant-design|antd)[\\/]/</span>,</span><br><span class="line">        priority: <span class="number">-10</span>,</span><br><span class="line">        enforce: <span class="literal">true</span>,</span><br><span class="line">        reuseExistingChunk: <span class="literal">true</span> <span class="comment">// å¯è®¾ç½®æ˜¯å¦é‡ç”¨è¯¥chunk</span></span><br><span class="line">      &#125;,</span><br><span class="line">      excel: &#123;</span><br><span class="line">        name: <span class="string">'excel'</span>,</span><br><span class="line">        chunks: <span class="string">'all'</span>,</span><br><span class="line">        test: <span class="regexp">/[\\/]node_modules[\\/](js-export-excel)[\\/]/</span>,</span><br><span class="line">        priority: <span class="number">-20</span>,</span><br><span class="line">        enforce: <span class="literal">true</span>,</span><br><span class="line">        reuseExistingChunk: <span class="literal">true</span> <span class="comment">// å¯è®¾ç½®æ˜¯å¦é‡ç”¨è¯¥chunk</span></span><br><span class="line">      &#125;,</span><br><span class="line">       echarts: &#123;</span><br><span class="line">          name: <span class="string">'echarts'</span>,</span><br><span class="line">          chunks: <span class="string">'async'</span>,  <span class="comment">//è®¾ç½®å¼‚æ­¥å¯¼å…¥ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆæ—¶å€™å¯¼å…¥</span></span><br><span class="line">          test: <span class="regexp">/[\\/]node_modules[\\/](echarts|echarts-for-react)[\\/]/</span>,</span><br><span class="line">          priority: <span class="number">80</span>,</span><br><span class="line">          enforce: <span class="literal">true</span>,</span><br><span class="line">          reuseExistingChunk: <span class="literal">true</span> <span class="comment">// å¯è®¾ç½®æ˜¯å¦é‡ç”¨è¯¥chunk</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    runtimeChunk: &#123;</span><br><span class="line">        name: <span class="string">"manifest"</span>  <span class="comment">//ç”¨äºç®¡ç†è¢«åˆ†å‡ºæ¥çš„åŒ…ï¼Œä¼˜åŒ–æŒä¹…åŒ–ç¼“å­˜çš„,å¦‚æœä¸è®¾ç½®è¿™ä¸ªçš„è¯ï¼Œä¸€æ—¦ä»£ç æœ‰å˜åŠ¨çš„è¯ï¼Œmain.jsçš„hashå°±ä¼šå‘ç”Ÿå˜åŒ–,</span></span><br><span class="line">        <span class="comment">// optimization.runtimeChunk å°±æ˜¯å‘Šè¯‰ webpack æ˜¯å¦è¦æŠŠè¿™å˜åŒ–çš„éƒ¨åˆ†å•ç‹¬æ‰“åŒ…å‡ºæ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰å…¨å±€å˜é‡-DefinePlugin"><a href="#å®šä¹‰å…¨å±€å˜é‡-DefinePlugin" class="headerlink" title="å®šä¹‰å…¨å±€å˜é‡(DefinePlugin)"></a>å®šä¹‰å…¨å±€å˜é‡(DefinePlugin)</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//eslint è®¾ç½®é€šè¿‡</span></span><br><span class="line"> <span class="string">"globals"</span>: &#123;</span><br><span class="line">     <span class="string">"ENV"</span>: <span class="literal">true</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">     <span class="comment">//å¿…é¡» JSON.stringify()ï¼Œç„¶ååœ¨eslinté‡Œé¢ï¼Œglobal()é€šè¿‡ä¸€ä¸‹</span></span><br><span class="line">    ENV: <span class="built_in">JSON</span>.stringify(process.env.ENV), <span class="comment">// æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><h3 id="webpackä»£ç†"><a href="#webpackä»£ç†" class="headerlink" title="webpackä»£ç†"></a>webpackä»£ç†</h3><ul><li>webpack-dev-server<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åœ¨é…ç½®æ–‡ä»¶webpackDevServer.config.jsæ·»åŠ ï¼Œ</span></span><br><span class="line"><span class="comment">//æ–°ç‰ˆæœ¬ç›´æ¥åœ¨package.json é‡Œé¢æ·»åŠ ï¼Œä½†æ˜¯åªèƒ½æ·»åŠ ä¸€ä¸ªå¹¶ä¸”æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯åœ¨srcä¸‹æ·»åŠ setupProxy.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">'http-proxy-middleware'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">app</span>) </span>&#123;</span><br><span class="line">    app.use(</span><br><span class="line">        proxy(<span class="string">"/pic"</span>, &#123;</span><br><span class="line">            <span class="string">"target"</span>: <span class="string">"http://120.79.229.197:9000"</span>,</span><br><span class="line">            <span class="string">"changeOrigin"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"secure"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"pathRewrite"</span>: &#123;<span class="string">"^/pic"</span>: <span class="string">""</span>&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">    app.use(</span><br><span class="line">        proxy(<span class="string">"/self"</span>, &#123;</span><br><span class="line">            <span class="string">"target"</span>: <span class="string">"http://localhost:9999"</span>,</span><br><span class="line">            <span class="string">"changeOrigin"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"secure"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"pathRewrite"</span>: &#123;<span class="string">"^/self"</span>: <span class="string">""</span>&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h3 id="babelrc"><a href="#babelrc" class="headerlink" title=".babelrc"></a>.babelrc</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–°çš„ç‰ˆæœ¬å·²ç»æ”¯æŒåœ¨package.jsoné‡Œé¢ç›´æ¥ä¿®æ”¹</span></span><br><span class="line">&#123;&#123;</span><br><span class="line">   <span class="string">"presets"</span>: [</span><br><span class="line">     [</span><br><span class="line">     <span class="string">"@babel/preset-env"</span>, &#123;</span><br><span class="line">       <span class="string">"targets"</span>: &#123;</span><br><span class="line">         <span class="string">"chrome"</span>: <span class="number">58</span>,</span><br><span class="line">         <span class="string">"ie"</span>: <span class="number">11</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   ], <span class="string">"react-app"</span>],</span><br><span class="line">   <span class="string">"plugins"</span>: [</span><br><span class="line">     [<span class="string">"import"</span>, &#123;</span><br><span class="line">         <span class="string">"libraryName"</span>: <span class="string">"antd"</span>,</span><br><span class="line">         <span class="string">"libraryDirectory"</span>: <span class="string">"es"</span>,</span><br><span class="line">         <span class="string">"style"</span>: <span class="string">"css"</span></span><br><span class="line">       &#125;</span><br><span class="line">     ],</span><br><span class="line">     [<span class="string">"@babel/plugin-proposal-decorators"</span>, &#123; <span class="string">"legacy"</span>: <span class="literal">true</span> &#125;],  <span class="comment">//ç”¨äºè½¬æ¢è£…é¥°å™¨ä»£ç çš„æ’ä»¶ã€‚</span></span><br><span class="line">     [</span><br><span class="line">       <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="string">"absoluteRuntime"</span>: <span class="literal">false</span>,</span><br><span class="line">         <span class="string">"corejs"</span>: <span class="number">2</span>,</span><br><span class="line">         <span class="string">"helpers"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"regenerator"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"useESModules"</span>: <span class="literal">false</span></span><br><span class="line">       &#125;</span><br><span class="line">     ]</span><br><span class="line">   ],</span><br><span class="line">   <span class="string">"env"</span>: &#123;</span><br><span class="line">     <span class="string">"production"</span>: &#123;</span><br><span class="line">       <span class="string">"plugins"</span>:  [<span class="string">"transform-remove-console"</span>]</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="env"><a href="#env" class="headerlink" title=".env"></a>.env</h3><p>å®šä¹‰ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥é€šè¿‡process.env.[name]æ‹¿å–å‡ºæ¥</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">GENERATE_SOURCEMAP=<span class="literal">false</span>  <span class="comment">//ç¦æ­¢è¾“å‡º.mapæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–è¾“å‡ºçš„æ–‡ä»¶"><a href="#ä¼˜åŒ–è¾“å‡ºçš„æ–‡ä»¶" class="headerlink" title="ä¼˜åŒ–è¾“å‡ºçš„æ–‡ä»¶"></a>ä¼˜åŒ–è¾“å‡ºçš„æ–‡ä»¶</h3><p><code>taroä¸ºä¾‹</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* hash:hashæ˜¯è·Ÿæ•´ä¸ªé¡¹ç›®çš„æ„å»ºç›¸å…³ï¼Œåªè¦é¡¹ç›®é‡Œæœ‰æ–‡ä»¶æ›´æ”¹ï¼Œæ•´ä¸ªé¡¹ç›®æ„å»ºçš„hashå€¼éƒ½ä¼šæ›´æ”¹</span></span><br><span class="line"><span class="comment">* é‡‡ç”¨hashè®¡ç®—çš„è¯ï¼Œæ¯ä¸€æ¬¡æ„å»ºåç”Ÿæˆçš„å“ˆå¸Œå€¼éƒ½ä¸ä¸€æ ·ï¼Œå³ä½¿æ–‡ä»¶å†…å®¹å‹æ ¹æ²¡æœ‰æ”¹å˜ã€‚è¿™æ ·å­æ˜¯æ²¡åŠæ³•å®ç°ç¼“å­˜æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦æ¢å¦ä¸€ç§å“ˆå¸Œå€¼è®¡ç®—æ–¹å¼ï¼Œå³chunkhashã€‚</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* chunkhash:æ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶(Entry)è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æã€æ„å»ºå¯¹åº”çš„chunkï¼Œç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚</span></span><br><span class="line"><span class="comment">* æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒé‡ŒæŠŠä¸€äº›å…¬å…±åº“å’Œç¨‹åºå…¥å£æ–‡ä»¶åŒºåˆ†å¼€ï¼Œå•ç‹¬æ‰“åŒ…æ„å»ºï¼Œæ¥ç€æˆ‘ä»¬é‡‡ç”¨chunkhashçš„æ–¹å¼ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œé‚£ä¹ˆåªè¦æˆ‘ä»¬ä¸æ”¹åŠ¨å…¬å…±åº“çš„ä»£ç ï¼Œå°±å¯ä»¥ä¿è¯å…¶å“ˆå¸Œå€¼ä¸ä¼šå—å½±å“ã€‚</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* filename:å†³å®šäº†entryå…¥å£æ–‡ä»¶è¾“å‡ºæ–‡ä»¶çš„åç§°ã€‚ (main.js)</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* chunkFilename:å†³å®šäº†éå…¥å£(non-entry) chunk æ–‡ä»¶çš„åç§°,æ¯”å¦‚æŒ‰éœ€åŠ è½½ï¼ˆå¼‚æ­¥ï¼‰æ¨¡å—çš„æ—¶å€™ (ç»„ä»¶æ‰“åŒ…çš„js)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//jsæ–‡ä»¶çš„è¾“å‡º</span></span><br><span class="line">output: &#123;</span><br><span class="line">    filename: <span class="string">'js/[name].[hash:8].js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'js/[name].[chunkhash:8].js'</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//cssæ–‡ä»¶çš„è¾“å‡º</span></span><br><span class="line">miniCssExtractPluginOption: &#123;</span><br><span class="line">    filename: <span class="string">'css/[name].[hash:8].css'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'css/[name].[chunkhash:8].css'</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//imgæ–‡ä»¶çš„è¾“å‡º</span></span><br><span class="line">imageUrlLoaderOption: &#123;</span><br><span class="line">    limit: <span class="number">1024</span>*<span class="number">50</span>,</span><br><span class="line">    name: <span class="string">'static/images/[name].[hash:8].[ext]'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="webpackå¯¹å›¾ç‰‡åšäº†ä»€äº†ï¼Ÿï¼ˆé¢è¯•é¢˜ï¼‰"><a href="#webpackå¯¹å›¾ç‰‡åšäº†ä»€äº†ï¼Ÿï¼ˆé¢è¯•é¢˜ï¼‰" class="headerlink" title="webpackå¯¹å›¾ç‰‡åšäº†ä»€äº†ï¼Ÿï¼ˆé¢è¯•é¢˜ï¼‰"></a>webpackå¯¹å›¾ç‰‡åšäº†ä»€äº†ï¼Ÿï¼ˆé¢è¯•é¢˜ï¼‰</h3><p><strong>url-loaderï¼š</strong> å¦‚æœå›¾ç‰‡è¾ƒå¤šï¼Œä¼šå‘å¾ˆå¤šhttpè¯·æ±‚ï¼Œä¼šé™ä½é¡µé¢æ€§èƒ½ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡url-loaderè§£å†³ã€‚url-loaderä¼šå°†å¼•å…¥çš„å›¾ç‰‡ç¼–ç ï¼Œç”ŸæˆdataURl(base64)ã€‚ç›¸å½“äºæŠŠå›¾ç‰‡æ•°æ®ç¿»è¯‘æˆä¸€ä¸²å­—ç¬¦ã€‚å†æŠŠè¿™ä¸²å­—ç¬¦æ‰“åŒ…åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆåªéœ€è¦å¼•å…¥è¿™ä¸ªæ–‡ä»¶å°±èƒ½è®¿é—®å›¾ç‰‡äº†ã€‚å½“ç„¶ï¼Œå¦‚æœå›¾ç‰‡è¾ƒå¤§ï¼Œç¼–ç ä¼šæ¶ˆè€—æ€§èƒ½ã€‚å› æ­¤url-loaderæä¾›äº†ä¸€ä¸ªlimitå‚æ•°ï¼Œå°äºlimitå­—èŠ‚çš„æ–‡ä»¶ä¼šè¢«è½¬ä¸ºDataURlï¼Œå¤§äºlimitçš„è¿˜ä¼šä½¿ç”¨file-loaderè¿›è¡Œcopy</p><p><strong>file-loaderï¼š</strong>  è§£å†³å¼•ç”¨è·¯å¾„çš„é—®é¢˜ï¼Œæ‹¿backgroundæ ·å¼ç”¨urlå¼•å…¥èƒŒæ™¯å›¾æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œwebpackæœ€ç»ˆä¼šå°†å„ä¸ªæ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬æ ·å¼ä¸­çš„urlè·¯å¾„æ˜¯ç›¸å¯¹å…¥å£htmlé¡µé¢çš„ï¼Œè€Œä¸æ˜¯ç›¸å¯¹äºåŸå§‹cssæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„çš„ã€‚è¿™å°±ä¼šå¯¼è‡´å›¾ç‰‡å¼•å…¥å¤±è´¥ã€‚è¿™ä¸ªé—®é¢˜æ˜¯ç”¨file-loaderè§£å†³çš„ï¼Œfile-loaderå¯ä»¥è§£æé¡¹ç›®ä¸­çš„urlå¼•å…¥ï¼ˆä¸ä»…é™äºcssï¼‰ï¼Œæ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œå°†å›¾ç‰‡æ‹·è´åˆ°ç›¸åº”çš„è·¯å¾„ï¼Œå†æ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œä¿®æ”¹æ‰“åŒ…åæ–‡ä»¶å¼•ç”¨è·¯å¾„ï¼Œä½¿ä¹‹æŒ‡å‘æ­£ç¡®çš„æ–‡ä»¶ã€‚</p><p><strong>image-webpack-loaderï¼š</strong>  å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©å’Œä¼˜åŒ–</p><p><a href="https://github.com/tcoopman/image-webpack-loader" target="_blank" rel="noopener">image-webpack-loader</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">test: [<span class="regexp">/\.bmp$/</span>, /\.gif$/, /\.jpe?g$/, /\.png$/],</span><br><span class="line"></span><br><span class="line"><span class="comment">// options: &#123;</span></span><br><span class="line"><span class="comment">//     limit: 10000,</span></span><br><span class="line"><span class="comment">//     name: 'static/media/[name].[hash:8].[ext]',</span></span><br><span class="line"><span class="comment">// &#125;,</span></span><br><span class="line">use: [</span><br><span class="line">    &#123;</span><br><span class="line">        loader: <span class="built_in">require</span>.resolve(<span class="string">'url-loader'</span>),</span><br><span class="line">        options:</span><br><span class="line">            &#123; <span class="comment">// è¿™é‡Œçš„optionsé€‰é¡¹å‚æ•°å¯ä»¥å®šä¹‰å¤šå¤§çš„å›¾ç‰‡è½¬æ¢ä¸ºbase64</span></span><br><span class="line">                name: <span class="string">'static/images/[name].[hash:8].[ext]'</span>,</span><br><span class="line">                limit: <span class="number">1024</span> * <span class="number">50</span>, <span class="comment">// è¡¨ç¤ºå°äº50kbçš„å›¾ç‰‡è½¬ä¸ºbase64,å¤§äº50kbçš„æ˜¯è·¯å¾„</span></span><br><span class="line">                <span class="comment">// outputPath: 'images' //å®šä¹‰è¾“å‡ºçš„å›¾ç‰‡æ–‡ä»¶å¤¹</span></span><br><span class="line">            &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// &#123;    //å‹ç¼©å›¾ç‰‡è¦åœ¨file-loaderä¹‹åä½¿ç”¨</span></span><br><span class="line">    <span class="comment">//     loader: require.resolve('image-webpack-loader'),</span></span><br><span class="line">    <span class="comment">//     options:</span></span><br><span class="line">    <span class="comment">//         &#123;</span></span><br><span class="line">    <span class="comment">//             bypassOnDebug: true</span></span><br><span class="line">    <span class="comment">//         &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="webpackç”¨åˆ°çš„æ’ä»¶"><a href="#webpackç”¨åˆ°çš„æ’ä»¶" class="headerlink" title="webpackç”¨åˆ°çš„æ’ä»¶"></a>webpackç”¨åˆ°çš„æ’ä»¶</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">webpack-dev-server  <span class="comment">//çƒ­æ›´æ–°</span></span><br><span class="line">clean-webpack-plugin   <span class="comment">//åœ¨æ‰“åŒ…è¾“å‡ºå‰æ¸…ç©ºæ–‡ä»¶å¤¹</span></span><br><span class="line">mini-css-extract-plugin <span class="comment">//æ‹†åˆ†css</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">new MiniCssExtractPlugin(&#123;</span></span><br><span class="line"><span class="comment"> filename: 'static/css/[name].[contenthash:8].css',</span></span><br><span class="line"><span class="comment"> chunkFilename: 'static/css/[name].[contenthash:8].chunk.css',</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">extract-text-webpack-plugin@next <span class="comment">//æ‹†åˆ†å¤šä¸ªcss</span></span><br><span class="line">terser-webpack-plugin/uglifyjs-webpack-plugin  <span class="comment">//å‹ç¼©js è§£å†³uglifyjsä¸æ”¯æŒes6è¯­æ³•é—®é¢˜</span></span><br><span class="line">optimize-css-assets-webpack-plugin <span class="comment">//æœ€å¤§åŒ–å‹ç¼©css</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">image-webpack-loader  <span class="comment">//å›¾ç‰‡å‹ç¼©</span></span><br><span class="line">webpackbar  <span class="comment">//è¿›åº¦æ¡</span></span><br><span class="line">@babel/plugin-proposal-decorators(transform-decorators-legacy åŸºäºbabel6)   <span class="comment">//è£…é¥°å™¨</span></span><br><span class="line">redux-devtools-extension  <span class="comment">//é…ç½®reduxå·¥å…·</span></span><br><span class="line">babel-plugin-transform-remove-<span class="built_in">console</span>  <span class="comment">//ç”Ÿäº§ç¯å¢ƒæ¸…é™¤æ§åˆ¶å°çš„å†…å®¹</span></span><br><span class="line">webpack-bundle-analyzer  <span class="comment">//æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–</span></span><br><span class="line">happyPack <span class="comment">//å¤šè¿›ç¨‹æ‰“åŒ…ï¼ŒåŠ å¿«æ‰“åŒ…é€Ÿåº¦ã€‚</span></span><br><span class="line">postcss-loader  <span class="comment">//cssç¼–è¯‘çš„å·¥å…·</span></span><br><span class="line">postcss-preset-env <span class="comment">//å°†ç°ä»£CSSè½¬æ¢æˆæµè§ˆå™¨èƒ½ç†è§£çš„ä¸œè¥¿,æ— éœ€å†å®‰è£…autoprefixer</span></span><br><span class="line">postcss-flexbugs-fixes <span class="comment">//ä¿®å¤Flexbugs</span></span><br><span class="line">postcss-px-to-viewport <span class="comment">//æŠŠpxè½¬æ¢æˆviewportå•ä½</span></span><br><span class="line">postcss-pxtorem <span class="comment">//æŠŠpxè½¬æ¢æˆrem</span></span><br></pre></td></tr></table></figure><h3 id="require-contextæ˜¯ä»€ä¹ˆ"><a href="#require-contextæ˜¯ä»€ä¹ˆ" class="headerlink" title="require.contextæ˜¯ä»€ä¹ˆ"></a>require.contextæ˜¯ä»€ä¹ˆ</h3><p>ä¸€ä¸ªwebpackçš„api,é€šè¿‡æ‰§è¡Œ<code>require.context</code>å‡½æ•°è·å–ä¸€ä¸ªç‰¹å®šçš„ä¸Šä¸‹æ–‡,ä¸»è¦ç”¨æ¥å®ç°è‡ªåŠ¨åŒ–å¯¼å…¥æ¨¡å—,åœ¨å‰ç«¯å·¥ç¨‹ä¸­,å¦‚æœé‡åˆ°ä»ä¸€ä¸ªæ–‡ä»¶å¤¹å¼•å…¥å¾ˆå¤šæ¨¡å—çš„æƒ…å†µ,å¯ä»¥ä½¿ç”¨è¿™ä¸ªapi,å®ƒä¼šéå†æ–‡ä»¶å¤¹ä¸­çš„æŒ‡å®šæ–‡ä»¶,ç„¶åè‡ªåŠ¨å¯¼å…¥,ä½¿å¾—ä¸éœ€è¦æ¯æ¬¡æ˜¾å¼çš„è°ƒç”¨importå¯¼å…¥æ¨¡å—</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">'./getters'</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> files = <span class="built_in">require</span>.context(<span class="string">'./modules'</span>, <span class="literal">false</span>, /\.js$/)</span><br><span class="line"><span class="comment">// files.keys() è·å–æ‰€æœ‰çš„æ–‡ä»¶ç›®å½•ï¼Œä¸å¸¦åç¼€</span></span><br><span class="line"><span class="keyword">let</span> modules = &#123;&#125;</span><br><span class="line">files.keys().forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name = path.basename(key, <span class="string">'.js'</span>)</span><br><span class="line">    modules[name] = files(key).default || files(key) <span class="comment">// è·å–æ‰€æœ‰çš„å†…å®¹</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    modules,</span><br><span class="line">    getters</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Webpack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Event-Loop</title>
      <link href="/2019/01/11/workspace/Js/eventloop/"/>
      <url>/2019/01/11/workspace/Js/eventloop/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Event-Loop</strong></p><p>[[toc]]</p><h3 id="åŒæ­¥-amp-å¼‚æ­¥-amp-å¤šçº¿ç¨‹"><a href="#åŒæ­¥-amp-å¼‚æ­¥-amp-å¤šçº¿ç¨‹" class="headerlink" title="åŒæ­¥ &amp; å¼‚æ­¥ &amp; å¤šçº¿ç¨‹"></a>åŒæ­¥ &amp; å¼‚æ­¥ &amp; å¤šçº¿ç¨‹</h3><p><strong>åŒæ­¥ä¸å¼‚æ­¥çš„åŒºåˆ«</strong></p><p>åŒæ­¥ï¼ˆSynchronousï¼‰ï¼šåœ¨æ‰§è¡ŒæŸä¸ªæ“ä½œæ—¶ï¼Œåº”ç”¨ç¨‹åº<code>å¿…é¡»ç­‰å¾…è¯¥æ“ä½œæ‰§è¡Œå®Œæˆå</code>æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚<br/><br>å¼‚æ­¥ï¼ˆAsynchronousï¼‰ï¼šåœ¨æ‰§è¡ŒæŸä¸ªæ“ä½œæ—¶ï¼Œåº”ç”¨ç¨‹åºå¯åœ¨å¼‚æ­¥æ“ä½œæ‰§è¡Œæ—¶ç»§ç»­æ‰§è¡Œã€‚å®è´¨ï¼šå¼‚æ­¥æ“ä½œï¼Œå¯åŠ¨äº†æ–°çš„ï¼Œçº¿ç¨‹ä¸»çº¿ç¨‹ä¸æ–¹æ³•çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚<code>å¼‚æ­¥ä»»åŠ¡æ˜¯ä¸ä¼šè¿›å…¥ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯ä¼šå…ˆè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—</code><br/></p><p><strong>å¼‚æ­¥å’Œå¤šçº¿ç¨‹çš„åŒºåˆ«</strong></p><p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ å¼‚æ­¥å’Œå¤šçº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ä¸ªåŒç­‰å…³ç³»,<code>å¼‚æ­¥æ˜¯æœ€ç»ˆç›®çš„</code>,<code>å¤šçº¿ç¨‹åªæ˜¯æˆ‘ä»¬å®ç°å¼‚æ­¥çš„ä¸€ç§æ‰‹æ®µ</code>ã€‚<br>å¼‚æ­¥æ˜¯å½“ä¸€ä¸ªè°ƒç”¨è¯·æ±‚å‘é€ç»™è¢«è°ƒç”¨è€…,è€Œè°ƒç”¨è€…ä¸ç”¨ç­‰å¾…å…¶ç»“æœçš„è¿”å›è€Œå¯ä»¥åšå…¶å®ƒçš„äº‹æƒ…ã€‚å®ç°å¼‚æ­¥å¯ä»¥é‡‡ç”¨å¤šçº¿ç¨‹æŠ€æœ¯æˆ–åˆ™äº¤ç»™å¦å¤–çš„è¿›ç¨‹æ¥å¤„ç†ã€‚</p><p>ç®€å•çš„è¯´å°±æ˜¯ï¼šå¼‚æ­¥çº¿ç¨‹æ˜¯ç”±<code>çº¿ç¨‹æ± </code>è´Ÿè´£ç®¡ç†ï¼Œè€Œå¤šçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥<code>è‡ªå·±æ§åˆ¶</code>ï¼Œå½“ç„¶åœ¨å¤šçº¿ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± ã€‚</p><p><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener">è¿è¡Œæœºåˆ¶è¯¦è§£</a></p><h3 id="JSä¸­çš„å¼‚æ­¥æ“ä½œ"><a href="#JSä¸­çš„å¼‚æ­¥æ“ä½œ" class="headerlink" title="JSä¸­çš„å¼‚æ­¥æ“ä½œ"></a>JSä¸­çš„å¼‚æ­¥æ“ä½œ</h3><ul><li>å®šæ—¶å‡½æ•°ï¼Œå¦‚setTimeout setInterval requestAnimationFrame setImmediate(nodeJS) </li><li>IO æ“ä½œï¼Œå¦‚readFile readdir</li><li>ç½‘ç»œè¯·æ±‚ï¼Œå¦‚ajax http.getï¼ˆä¹Ÿå¯ä»¥åŒæ­¥ï¼Œä½†æ˜¯ç­‰å¾…ajaxè¯·æ±‚å“åº”ä¹‹å‰ï¼Œé¡µé¢ä¼šå¡ä½ï¼Œç”¨æˆ·ä»€ä¹ˆéƒ½åšä¸äº†,ä½“éªŒå·®ï¼‰</li></ul><p>è¿™ä¸¤ä¸ªçœ‹ä½ æ€ä¹ˆè¯´äº†</p><ul><li>äº‹ä»¶ç»‘å®šéƒ½æ˜¯å¼‚æ­¥æ“ä½œ <br/><br>é™¤äº†IOè®¾å¤‡çš„äº‹ä»¶ä»¥å¤–ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›ç”¨æˆ·äº§ç”Ÿçš„äº‹ä»¶ï¼ˆæ¯”å¦‚é¼ æ ‡ç‚¹å‡»ã€é¡µé¢æ»šåŠ¨ç­‰ç­‰ï¼‰åªè¦æŒ‡å®šè¿‡å›è°ƒå‡½æ•°ï¼Œè¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶å°±ä¼šè¿›å…¥â€ä»»åŠ¡é˜Ÿåˆ—â€ï¼Œç­‰å¾…ä¸»çº¿ç¨‹è¯»å–ã€‚</li><li>å›è°ƒå‡½æ•°å¯ä»¥ç†è§£ä¸ºå¼‚æ­¥ï¼ˆä¸æ˜¯ä¸¥è°¨çš„å¼‚æ­¥æ“ä½œï¼ŒåŒæ­¥å›è°ƒï¼Œå¼‚æ­¥å›è°ƒï¼‰<br/><br>æ‰€è°“â€å›è°ƒå‡½æ•°â€ï¼ˆcallbackï¼‰ï¼Œå°±æ˜¯é‚£äº›ä¼šè¢«ä¸»çº¿ç¨‹æŒ‚èµ·æ¥çš„ä»£ç ã€‚å¼‚æ­¥ä»»åŠ¡å¿…é¡»æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œå½“ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå°±æ˜¯æ‰§è¡Œå¯¹åº”çš„å›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="event-loopï¼ˆäº‹ä»¶è½®è¯¢ï¼‰"><a href="#event-loopï¼ˆäº‹ä»¶è½®è¯¢ï¼‰" class="headerlink" title="event-loopï¼ˆäº‹ä»¶è½®è¯¢ï¼‰"></a>event-loopï¼ˆäº‹ä»¶è½®è¯¢ï¼‰</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hc9dd012443fb4f35bcd41ef829e72834k.jpg" alt=""></p><p>ä¸»çº¿ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œäº§ç”Ÿå †ï¼ˆheapï¼‰å’Œæ ˆï¼ˆstackï¼‰ï¼Œæ ˆä¸­çš„ä»£ç è°ƒç”¨å„ç§å¤–éƒ¨APIï¼Œ<br>å®ƒä»¬åœ¨â€ä»»åŠ¡é˜Ÿåˆ—â€ä¸­åŠ å…¥å„ç§äº‹ä»¶ï¼ˆclickï¼Œloadï¼Œdoneï¼‰ã€‚åªè¦æ ˆä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹å°±ä¼šå»è¯»å–â€<strong>ä»»åŠ¡é˜Ÿåˆ—ï¼ˆtask queueï¼‰</strong>â€œï¼Œä¾æ¬¡æ‰§è¡Œé‚£äº›äº‹ä»¶æ‰€å¯¹åº”çš„å›è°ƒå‡½æ•°</p><h3 id="å®ä»»åŠ¡-amp-å¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡-amp-å¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡ &amp; å¾®ä»»åŠ¡"></a>å®ä»»åŠ¡ &amp; å¾®ä»»åŠ¡</h3><ul><li><p><strong>æµè§ˆï¨¸çš„ä»»åŠ¡é˜Ÿï¦œ:</strong><br> -ä¸»ä»»åŠ¡é˜Ÿï¦œ:å­˜å‚¨çš„éƒ½æ˜¯åŒæ­¥ä»»åŠ¡</p><ul><li>ç­‰å¾…ä»»åŠ¡é˜Ÿï¦œ:å­˜å‚¨çš„éƒ½æ˜¯å¼‚æ­¥ä»»åŠ¡</li></ul></li><li><p><strong>å¾®ä»»åŠ¡:</strong></p><ul><li>Promiseçš„thenå›è°ƒå‡½æ•°</li><li>asyncå‡½æ•°ä¸­awaitä¸‹é¢çš„ä»£ç </li><li>process.nextTickï¼ˆnodeJSï¼‰</li><li>MutationObserver</li></ul></li><li><p><strong>å®ä»»åŠ¡:</strong></p><ul><li>å®šæ—¶ï¨¸(setInterval/setTimeout)</li><li>requestAnimationFrame</li><li>setImmediate(nodeJS)</li></ul></li></ul><p><strong>å¾®ä»»åŠ¡çš„ä¼˜å…ˆçº§â½å®ä»»åŠ¡çš„ä¼˜å…ˆçº§è¦é«˜</strong></p><h3 id="async-await-å’Œ-promise-çš„æ‰§è¡Œé¡ºåº"><a href="#async-await-å’Œ-promise-çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="async/await å’Œ promise çš„æ‰§è¡Œé¡ºåº"></a>async/await å’Œ promise çš„æ‰§è¡Œé¡ºåº</h3><h4 id="async"><a href="#async" class="headerlink" title="async"></a>async</h4><p><strong>å¸¦ async å…³é”®å­—çš„å‡½æ•°ï¼Œå®ƒä½¿å¾—ä½ çš„å‡½æ•°çš„è¿”å›å€¼å¿…å®šæ˜¯ promise å¯¹è±¡</strong>,async å‡½æ•°ä¹Ÿæ²¡å•¥äº†ä¸èµ·çš„ï¼Œä½ å°±æƒ³å®ƒæ— éå°±æ˜¯æŠŠreturnå€¼åŒ…è£…äº†ä¸€ä¸‹ï¼Œå…¶ä»–å°±è·Ÿæ™®é€šå‡½æ•°ä¸€æ ·,é‡ç‚¹æ˜¯é‡Œé¢çš„awaitã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fn1())</span><br><span class="line"><span class="built_in">console</span>.log(fn2())</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Promise &#123;&lt;resolved&gt;: 123&#125;</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="await"><a href="#await" class="headerlink" title="await"></a>await</h4><p>awaitç­‰å¾…çš„æ˜¯å³ä¾§ã€Œè¡¨è¾¾å¼ã€çš„ç»“æœ</p><p>å¯¹äºawaitæ¥è¯´ï¼Œåˆ†2ä¸ªæƒ…å†µ</p><ul><li>ä¸æ˜¯promiseå¯¹è±¡</li><li>æ˜¯promiseå¯¹è±¡</li></ul><p><strong>å¦‚æœä¸æ˜¯ promiseï¼ˆä¼šè¢«è½¬æˆä¸€ä¸ªç«‹å³resolveçš„ Promise å¯¹è±¡ï¼‰ , awaitä¼šé˜»å¡åé¢ï¼ˆå¹¶éawaitåé¢é‚£ä¸ªå‡½æ•°ï¼‰çš„ä»£ç ï¼Œå…ˆæ‰§è¡Œasyncå‡½æ•°<code>å¤–é¢</code>çš„åŒæ­¥ä»£ç ï¼ŒåŒæ­¥ä»£ç æ‰§è¡Œå®Œï¼Œå†å›åˆ°asyncå†…éƒ¨ï¼Œæ®éœ€æ‰§è¡Œä¸‹é¢çš„æ–¹æ³•</strong></p><p><strong>å¦‚æœå®ƒç­‰åˆ°çš„æ˜¯ä¸€ä¸ª promise å¯¹è±¡ï¼Œawait ä¹Ÿä¼šæš‚åœasyncåé¢çš„ä»£ç ï¼Œå…ˆæ‰§è¡Œasyncå‡½æ•°<code>å¤–é¢</code>çš„åŒæ­¥ä»£ç ï¼Œç­‰ç€ Promise å¯¹è±¡ fulfilledï¼Œç„¶åæŠŠ resolve çš„å‚æ•°ä½œä¸º await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœï¼Œç„¶ååœ¨ç»§ç»­å‘ä¸‹æ‰§è¡Œå‰©ä½™çš„ä»£ç </strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ff = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>); <span class="comment">//ã€1ã€‘</span></span><br><span class="line">    <span class="keyword">await</span> async2();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async1 end'</span>)<span class="comment">//ã€2ã€‘</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">11</span>);<span class="comment">//ã€3ã€‘</span></span><br><span class="line">            resolve(<span class="number">22</span>)</span><br><span class="line">        &#125;).then(</span><br><span class="line">            (data) =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data);<span class="comment">//ã€4ã€‘</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å¤–é¢'</span>)<span class="comment">//ã€5ã€‘</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è§£æï¼šasyncå‡½æ•°ä¸‹çš„æ–¹æ³•ï¼Œå°±æƒ³æˆè·Ÿæ™®é€šçš„å‡½æ•°ä¸€æ ·çš„å°±è¡Œï¼Œå‡½æ•°å…ˆæ‰§è¡Œã€1ã€‘ç„¶åæ‰§è¡Œåˆ°awaitæ‰§è¡Œçš„async2ï¼ŒPromiseå†…éƒ¨ç›¸å½“äºåŒæ­¥å‡½æ•°ï¼Œç„¶åæ‰§è¡Œã€3ã€‘ï¼Œ</span></span><br><span class="line"><span class="comment">ç„¶åæ‰§è¡Œasyncå¤–é¢çš„æ–¹æ³•ï¼Œå‘ç°æ²¡æœ‰ï¼Œç„¶ååˆå›åˆ°ffå‡½æ•°å†…éƒ¨ï¼Œæ‰§è¡Œresolveé‡Œé¢çš„å‡½æ•°ã€4ã€‘,æœ€åå°±è¯¥è½®åˆ°ã€2ã€‘å’Œã€4ã€‘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* async1 start</span></span><br><span class="line"><span class="comment">* 11</span></span><br><span class="line"><span class="comment">* 22</span></span><br><span class="line"><span class="comment">* async1 end</span></span><br><span class="line"><span class="comment">* å¤–é¢</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">const</span> ff = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>);</span><br><span class="line">        <span class="keyword">await</span> async2();</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'async1 end'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">11</span>);</span><br><span class="line">            a(<span class="number">22</span>)</span><br><span class="line">        &#125;).then(</span><br><span class="line">            (data) =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data);</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    async1();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å¤–é¢'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è§£æï¼šè·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œå°±æ˜¯åœ¨ffé‡æ–°å£°æ˜ä¸€ä¸ªasync1å‡½æ•°ï¼Œè¿™ç§æ¯”ä¸Šé¢é‚£ç§æ›´åŠ å®ç”¨ï¼Œä¸ä¼šå µå¡async1å¤–é¢çš„åŒæ­¥ä»£ç </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* async1 start</span></span><br><span class="line"><span class="comment">* 11</span></span><br><span class="line"><span class="comment">* å¤–é¢</span></span><br><span class="line"><span class="comment">* 22</span></span><br><span class="line"><span class="comment">* async1 end</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>é¢è¯•é¢˜</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ff = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>)</span><br><span class="line">        <span class="keyword">await</span> async2()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'async1 end'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'async2'</span>);</span><br><span class="line">            a(<span class="string">'async222'</span>)</span><br><span class="line">        &#125;).then(</span><br><span class="line">            (data) =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data);</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'script start'</span>)</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>)</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">    async1();</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'promise2'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'script end'</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><a href="https://segmentfault.com/a/1190000017224799" target="_blank" rel="noopener">å‚è€ƒæ–‡æ¡£</a></p><p><a href="https://www.cnblogs.com/jiasm/p/9482443.html" target="_blank" rel="noopener">https://www.cnblogs.com/jiasm/p/9482443.html</a></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Webpack4 é…ç½®è¯¦è§£</title>
      <link href="/2019/01/10/workspace/Webpack/webpack/"/>
      <url>/2019/01/10/workspace/Webpack/webpack/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Webpack4 é…ç½®è¯¦è§£</strong></p><p>[[toc]]</p><p>Webpack4ååŒ…æ‹†æˆwebpackå’Œwebpack-cliä¸¤ä¸ªåŒ…ï¼š</p> <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®‰è£…webpack</span></span><br><span class="line">npm install --save-dev webpack webpack-cli</span><br></pre></td></tr></table></figure><p> ä¸»è¦æœ‰ä»¥ä¸‹è¿™äº›ä¸€çº§é…ç½®ï¼š</p> <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'development'</span>, <span class="comment">// æ¨¡å¼é…ç½®,webpack4.0æ–°å¢</span></span><br><span class="line">    entry: <span class="string">''</span>, <span class="comment">// å…¥å£æ–‡ä»¶</span></span><br><span class="line">    output: &#123;&#125;, <span class="comment">// å‡ºå£æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [<span class="comment">/*loader setting*/</span>]</span><br><span class="line">    &#125;, <span class="comment">// é…ç½®modulesï¼ŒåŒ…æ‹¬loader</span></span><br><span class="line">    plugins: [], <span class="comment">// å¯¹åº”çš„æ’ä»¶</span></span><br><span class="line">    devServer: &#123;&#125;, <span class="comment">// å¼€å‘æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">    optimization: &#123;&#125;, <span class="comment">// æœ€ä½³å®è·µ</span></span><br><span class="line">    devtool: <span class="string">''</span>,</span><br><span class="line">    resolve: &#123; <span class="attr">alias</span>: &#123;&#125;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-mode"><a href="#1-mode" class="headerlink" title="1. mode"></a>1. mode</h3><p> Webpack 4 å¼•å…¥äº† mode è¿™ä¸ªé€‰é¡¹ã€‚è¿™ä¸ªé€‰é¡¹çš„å€¼å¯ä»¥æ˜¯ development æˆ–è€… productionã€‚</p><p> è®¾ç½®äº† mode ä¹‹åä¼šæŠŠ process.env.NODE_ENV ä¹Ÿè®¾ç½®ä¸º development æˆ–è€… productionã€‚ç„¶ååœ¨ production æ¨¡å¼ä¸‹ï¼Œä¼šé»˜è®¤å¼€å¯ UglifyJsPlugin ç­‰ä¸€å †æ’ä»¶ã€‚</p><ul><li><p>webpack4æ”¯æŒES6çš„æ–¹å¼å¯¼å…¥JSONæ–‡ä»¶ï¼Œå¹¶ä¸”æ”¯æŒTree-shaking (é€šè¿‡å·¥å…·â€æ‘‡â€æˆ‘ä»¬çš„JSæ–‡ä»¶ï¼Œå°†å…¶ä¸­ç”¨ä¸åˆ°çš„ä»£ç â€æ‘‡â€æ‰ï¼Œæ˜¯ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–çš„èŒƒç•´)</p><h3 id="2-entry-amp-output"><a href="#2-entry-amp-output" class="headerlink" title="2. entry &amp; output"></a>2. entry &amp; output</h3></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let path &#x3D; require(&#39;path&#39;);</span><br><span class="line">let HtmlWebpackPlugin &#x3D; require(&#39;html-webpack-plugin&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F; 1.å†™æˆæ•°ç»„çš„æ–¹å¼å°±å¯ä»¥æ‰“å‡ºå¤šå…¥å£æ–‡ä»¶ï¼Œä¸è¿‡è¿™é‡Œæ‰“åŒ…åçš„æ–‡ä»¶éƒ½åˆæˆäº†ä¸€ä¸ª</span><br><span class="line">    &#x2F;&#x2F; entry: [&#39;.&#x2F;src&#x2F;index.js&#39;, &#39;.&#x2F;src&#x2F;login.js&#39;],</span><br><span class="line">    &#x2F;&#x2F; 2.çœŸæ­£å®ç°å¤šå…¥å£å’Œå¤šå‡ºå£éœ€è¦å†™æˆå¯¹è±¡çš„æ–¹å¼</span><br><span class="line">    entry: &#123;</span><br><span class="line">        index: path.resolve(__dirname,&#39;.&#x2F;src&#x2F;index.js&#39;),</span><br><span class="line">        login: path.resolve(__dirname,&#39;.&#x2F;src&#x2F;login.js&#39;)</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        &#x2F;&#x2F; 1. filename: &#39;bundle.js&#39;, &#39;bundle.[hash:4].js&#39;,   </span><br><span class="line">        &#x2F;&#x2F; 2. [name]å°±å¯ä»¥å°†å‡ºå£æ–‡ä»¶åå’Œå…¥å£æ–‡ä»¶åä¸€ä¸€å¯¹åº”</span><br><span class="line">        filename: &#39;[name].[hash:8].js&#39;,      &#x2F;&#x2F; æ‰“åŒ…åä¼šç”Ÿæˆindex.313eerrd.jså’Œlogin.dsfcersx.jsæ–‡ä»¶</span><br><span class="line">        path: path.resolve(__dirname,&#39;..&#x2F;dist&#39;)   &#x2F;&#x2F;æ‰“åŒ…åçš„ç›®å½•</span><br><span class="line">    &#125;,</span><br><span class="line">     plugins: [</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname,&#39;.&#x2F;public&#x2F;index.html&#39;),   &#x2F;&#x2F; ç”¨å“ªä¸ªhtmlä½œä¸ºæ¨¡æ¿ , reactä¸€èˆ¬åœ¨åœ¨srcç›®å½•ä¸‹publicé‡Œåˆ›å»ºä¸€ä¸ªindex.htmlé¡µé¢å½“åšæ¨¡æ¿æ¥ç”¨</span><br><span class="line">            filename: &#39;index.html&#39;, &#x2F;&#x2F;  è¦æ‰“åŒ…è¾“å‡ºçš„æ–‡ä»¶å</span><br><span class="line">            chunks: [&#39;manifest&#39;,&#39;index&#39;]   &#x2F;&#x2F; å¯¹åº”å…³ç³»,index.jså¯¹åº”çš„æ˜¯index.html</span><br><span class="line">        &#125;),</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname,&#39;.&#x2F;public&#x2F;login.html&#39;),</span><br><span class="line">            filename: &#39;login.html&#39;, </span><br><span class="line">            chunks: [&#39;manifest&#39;,&#39;login&#39;]   &#x2F;&#x2F; å¯¹åº”å…³ç³»,login.jså¯¹åº”çš„æ˜¯login.html</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-mudule-rules-é…ç½®"><a href="#3-mudule-rules-é…ç½®" class="headerlink" title="3. mudule - rules é…ç½®"></a>3. mudule - rules é…ç½®</h3><p> webpack4ä¸­ç§»é™¤loadersé…ç½®ï¼Œå¿…é¡»ä½¿ç”¨rulesã€‚rules é…ç½®æ¨¡å—çš„è¯»å–å’Œè§£æè§„åˆ™ï¼Œ é€šå¸¸ç”¨æ¥é…ç½®loaderï¼Œ å…¶ç±»å‹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ æ•°ç»„é‡Œæ¯ä¸€é¡¹éƒ½æè¿°äº†å¦‚ä½•å»å¤„ç†éƒ¨åˆ†æ–‡ä»¶ã€‚</p><p> é…ç½®ä¸€é¡¹ruleså¤§è‡´é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š</p><ol><li><p>æ¡ä»¶åŒ¹é…ï¼š é€šè¿‡testã€includeã€excludeä¸‰ä¸ªé…ç½®æ¥å‘½ä¸­Loaderè¦åº”ç”¨çš„è§„åˆ™æ–‡ä»¶ã€‚(ä¸‰ä¸ªé…ç½®éƒ½å¯ä»¥æ˜¯æ­£åˆ™ï¼Œä¹Ÿæ”¯æŒæ•°ç»„)</p></li><li><p>åº”ç”¨è§„åˆ™ï¼š å¯¹é€‰ä¸­åçš„æ–‡ä»¶é€šè¿‡useé…ç½®é¡¹æ¥åº”ç”¨loaderï¼Œå¯ä»¥åº”ç”¨ä¸€ä¸ªloaderæˆ–è€…æŒ‰ç…§ä»åå¾€å‰çš„é¡ºåºåº”ç”¨ä¸€ç»„loaderã€‚åŒæ—¶è¿˜å¯ä»¥åˆ†åˆ«ç»™loaderä¼ å…¥å‚æ•°ã€‚</p></li><li><p>é‡ç½®é¡ºåºï¼š ä¸€ç»„loaderçš„æ‰§è¡Œé¡ºåºé»˜è®¤æ˜¯ä»å³åˆ°å·¦æ‰§è¡Œï¼Œé€šè¿‡exforceé€‰é¡¹å¯ä»¥è®©å…¶ä¸­ä¸€ä¸ªloaderçš„æ‰§è¡Œé¡ºåºæ”¾åˆ°æœ€å‰æˆ–è€…æ˜¯æœ€åã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,     <span class="comment">// è§£æcss</span></span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>] <span class="comment">// ä»å³å‘å·¦è§£æ</span></span><br><span class="line">                <span class="comment">/* </span></span><br><span class="line"><span class="comment">                    ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼Œè¿™ç§æ–¹å¼æ–¹ä¾¿å†™ä¸€äº›é…ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">                    use: [</span></span><br><span class="line"><span class="comment">                        &#123;loader: 'style-loader'&#125;,</span></span><br><span class="line"><span class="comment">                        &#123;</span></span><br><span class="line"><span class="comment">                            loader: require.resolve('postcss-loader'),   //è¿™é‡Œæ˜¯åŠ ä¸Šæµè§ˆå™¨çš„å‰ç¼€</span></span><br><span class="line"><span class="comment">                            options: &#123;</span></span><br><span class="line"><span class="comment">                                ident: 'postcss',</span></span><br><span class="line"><span class="comment">                                plugins: () =&gt; [</span></span><br><span class="line"><span class="comment">                                    require('postcss-flexbugs-fixes'), //ä¿®å¤Flexbugs</span></span><br><span class="line"><span class="comment">                                    require('postcss-preset-env')(&#123; //postcss-preset-envåŒ…æ‹¬autoprefixer</span></span><br><span class="line"><span class="comment">                                        autoprefixer: &#123;</span></span><br><span class="line"><span class="comment">                                            flexbox: 'no-2009',</span></span><br><span class="line"><span class="comment">                                        &#125;,</span></span><br><span class="line"><span class="comment">                                        stage: 3,</span></span><br><span class="line"><span class="comment">                                    &#125;),</span></span><br><span class="line"><span class="comment">                                ]</span></span><br><span class="line"><span class="comment">                            &#125;,</span></span><br><span class="line"><span class="comment">                       &#125;</span></span><br><span class="line"><span class="comment">                    ]</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-optimization"><a href="#4-optimization" class="headerlink" title="4. optimization"></a>4. optimization</h3><p>åœ¨Webpack4ä¸­å¼•å…¥ï¼Œæ ¹æ®modeï¼ˆproduction/developmentï¼‰çš„ä¸åŒï¼Œé…ç½®é¡¹é»˜è®¤å€¼ä¸åŒï¼Œå…·ä½“æœ‰ä»¥ä¸‹ï¼š</p></li><li><p><strong>optimization.minimize</strong>ï¼š æ˜¯å¦è‡ªåŠ¨å‹ç¼©æ‰“åŒ…åçš„ä»£ç ã€‚mode = productionæ—¶ï¼Œä¸ºtrueã€‚<br>å‹ç¼©é»˜è®¤ä½¿ç”¨<code>terser-webpack-plugin</code>æ’ä»¶(æ›´åŠ å…¼å®¹ES6)ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨åˆ«çš„å‹ç¼©æ’ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>optimization.minimizer</code>è®¾ç½®ã€‚</p></li><li><p><strong>optimization.splitChunks</strong>: æ ¹æ®ä¸åŒçš„ç­–ç•¥æ¥åˆ†å‰²æ‰“åŒ…å‡ºæ¥çš„bundleã€‚é…ç½®åŸºäº<a href="https://webpack.js.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener">SplitChunksPlugin</a>,å‰”é™¤äº†è€çš„<code>CommonsChunkPlugin</code>ï¼ˆwebpack4ç§»é™¤ï¼‰ã€‚</p></li><li><p>é›¶é…ç½®</p><ul><li><strong>optimization.nodeEnv</strong>: å‘Šè¯‰webpack process.env.NODE_ENVçš„å€¼ï¼Œå€¼æ¥è‡ªäºmodeçš„å–å€¼ã€‚ä»£æ›¿<a href="https://webpack.js.org/plugins/define-plugin/" target="_blank" rel="noopener">webpack.DefinePlugin</a></li><li><strong>optimization.namedModules</strong>: ä»£æ›¿webpack.NamedModulesPluginï¼ˆwebpack4ç§»é™¤ï¼‰  <code>ç»™æ¨¡å—æœ‰æ„ä¹‰çš„åç§°ä»£æ›¿ids</code></li><li><strong>optimization.noEmitOnErrors</strong>: ä»£æ›¿webpack.NoEmitOnErrorsPluginï¼ˆwebpack4ç§»é™¤ï¼‰ <code>ç¼–è¯‘é”™è¯¯æ—¶ä¸å†™å…¥åˆ°è¾“å‡º</code></li><li><strong>optimization.concatenateModules</strong>: ä»£æ›¿webpack.optimize.ModuleConcatenationPluginï¼ˆwebpack4ç§»é™¤ï¼‰ <code>å°è¯•æŸ¥æ‰¾æ¨¡å—å›¾ä¸­å¯ä»¥å®‰å…¨è¿æ¥åˆ°å•ä¸ªæ¨¡å—ä¸­çš„æ®µã€‚- -</code></li></ul></li></ol><p><a href="https://segmentfault.com/a/1190000013712229?utm_source=index-hottest" target="_blank" rel="noopener">é»˜è®¤é…ç½®</a></p><h3 id="5-plugins"><a href="#5-plugins" class="headerlink" title="5. plugins"></a>5. plugins</h3><ul><li>å¸¸ç”¨æ’ä»¶<ol><li><code>HtmlWebpackPlugin</code> è‡ªåŠ¨åœ¨htmlä¸­åŠ è½½æ‰“åŒ…åçš„jsæ–‡ä»¶</li><li><code>DLLPlugin/DllReferencePlugin</code> æé«˜æ‰“åŒ…é€Ÿåº¦<ul><li>DLLPluginï¼šåˆ›å»ºä¸€ä¸ªåªæœ‰dllçš„bundle</li><li>DllReferencePluginï¼š æ‰“åŒ…ç”Ÿæˆçš„dllæ–‡ä»¶å¼•ç”¨åˆ°éœ€è¦çš„é¢„ç¼–è¯‘ä¾èµ–ä¸Šæ¥</li></ul></li><li>happyPack å¤šè¿›ç¨‹æ‰“åŒ…ï¼ŒåŠ å¿«æ‰“åŒ…é€Ÿåº¦ã€‚</li><li><code>webpack.DefinePlugin</code> webpack4è®¾ç½®modeä¼šè‡ªåŠ¨ä½¿ç”¨</li><li><code>uglifyjs-webpack-plugin</code> webpack4 mode = productioné»˜è®¤ä½¿ç”¨</li><li>WebpackBar</li><li>webpack-bundle-analyzer</li><li>clean-webpack-plugin  æ¸…é™¤distæ–‡ä»¶å¤¹é‡Œä¼šæ®‹ç•™ä¸Šæ¬¡æ‰“åŒ…çš„æ–‡ä»¶</li></ol></li><li>åºŸå¼ƒæ’ä»¶<br>ExtractTextWebpackPlugin æ‹†åˆ†cssæ ·å¼çš„æ’ä»¶(webapck4å·²åºŸå¼ƒ)ã€‚ç”±äºwebpack4ä»¥åå¯¹cssæ¨¡å—æ”¯æŒçš„é€æ­¥å®Œå–„å’Œcommonchunkæ’ä»¶çš„ç§»é™¤ï¼Œ<br>åœ¨å¤„ç†cssæ–‡ä»¶æå–çš„è®¡ç®—æ–¹å¼ä¸Šä¹Ÿåšäº†äº›è°ƒæ•´ï¼Œä¹‹å‰æˆ‘ä»¬é¦–é€‰ä½¿ç”¨çš„extract-text-webpack-pluginä¹Ÿå®Œæˆäº†å…¶å†å²ä½¿å‘½ï¼Œ<br>å°†è®©ä½äº<a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a>ã€‚</li></ul><h3 id="6-devServer"><a href="#6-devServer" class="headerlink" title="6. devServer"></a>6. devServer</h3><p> webpackçš„devServeré…ç½®åŸºäºwebpack-dev-serveré›†æˆçš„æ’ä»¶ã€‚è¯¥æ’ä»¶æä¾›äº†proxyä»£ç†é…ç½®ï¼ŒåŸºäºexpressä¸­é—´ä»¶ http-proxy-middlewareå®ç°ï¼Œè¯¥ä¸­é—´ä»¶åˆåŸºäºnode http-proxy,</p> <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    <span class="comment">// æä¾›é™æ€æ–‡ä»¶ç›®å½•åœ°å€</span></span><br><span class="line">    <span class="comment">// åŸºäºexpress.staticå®ç°</span></span><br><span class="line">    contentBase: path.join(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    <span class="comment">// ä»»æ„çš„ 404 å“åº”éƒ½è¢«æ›¿ä»£ä¸º index.html</span></span><br><span class="line">    <span class="comment">// åŸºäºnode connect-history-api-fallbackåŒ…å®ç°</span></span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// æ˜¯å¦ä¸€åˆ‡æœåŠ¡éƒ½å¯ç”¨ gzip å‹ç¼©</span></span><br><span class="line">    <span class="comment">// åŸºäºnode compressionåŒ…å®ç°</span></span><br><span class="line">    compress: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// æ˜¯å¦éšè—bundleä¿¡æ¯</span></span><br><span class="line">    noInfo: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// å‘ç”Ÿé”™è¯¯æ˜¯å¦è¦†ç›–åœ¨é¡µé¢ä¸Š</span></span><br><span class="line">    overlay: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// æ˜¯å¦å¼€å¯çƒ­åŠ è½½</span></span><br><span class="line">    <span class="comment">// å¿…é¡»æ­é…webpack.HotModuleReplacementPlugin æ‰èƒ½å®Œå…¨å¯ç”¨ HMRã€‚</span></span><br><span class="line">    <span class="comment">// å¦‚æœ webpack æˆ– webpack-dev-server æ˜¯é€šè¿‡ --hot é€‰é¡¹å¯åŠ¨çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’ä»¶ä¼šè¢«è‡ªåŠ¨æ·»åŠ </span></span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// çƒ­åŠ è½½æ¨¡å¼</span></span><br><span class="line">    <span class="comment">// trueä»£è¡¨inlineæ¨¡å¼ï¼Œfalseä»£è¡¨iframeæ¨¡å¼</span></span><br><span class="line">    inline: <span class="literal">true</span>, <span class="comment">// é»˜è®¤æ˜¯true</span></span><br><span class="line">    <span class="comment">// æ˜¯å¦è‡ªåŠ¨æ‰“å¼€</span></span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// è®¾ç½®æœ¬åœ°urlå’Œç«¯å£å·</span></span><br><span class="line">    host: <span class="string">'localhost'</span>,</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    <span class="comment">// ä»£ç†</span></span><br><span class="line">    <span class="comment">// åŸºäºnode http-proxy-middlewareåŒ…å®ç°</span></span><br><span class="line">    proxy: &#123;</span><br><span class="line">        <span class="comment">// åŒ¹é…apiå‰ç¼€æ—¶ï¼Œåˆ™ä»£ç†åˆ°3001ç«¯å£</span></span><br><span class="line">        <span class="comment">// å³http://localhost:8080/api/123 = http://localhost:3001/api/123</span></span><br><span class="line">        <span class="comment">// æ³¨æ„:è¿™é‡Œæ˜¯æŠŠå½“å‰server8080ä»£ç†åˆ°3001ï¼Œè€Œä¸æ˜¯ä»»æ„ç«¯å£çš„apiä»£ç†åˆ°3001</span></span><br><span class="line">        <span class="string">'/api'</span>: <span class="string">'http://localhost:3001'</span>,</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºtrue, æœ¬åœ°å°±ä¼šè™šæ‹Ÿä¸€ä¸ªæœåŠ¡å™¨æ¥æ”¶ä½ çš„è¯·æ±‚å¹¶ä»£ä½ å‘é€è¯¥è¯·æ±‚</span></span><br><span class="line">        <span class="comment">// ä¸»è¦è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// é’ˆå¯¹ä»£ç†https</span></span><br><span class="line">        secure: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// è¦†å†™è·¯å¾„ï¼šhttp://localhost:8080/api/123 = http://localhost:3001/123</span></span><br><span class="line">        pathRewrite: &#123;<span class="string">'^/api'</span> : <span class="string">''</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> ä¸¾ä¸ªå®Œæ•´ä¾‹å­ï¼š</p> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">const webpack &#x3D; require(&#39;webpack&#39;);</span><br><span class="line">&#x2F;&#x2F; æ’ä»¶éƒ½æ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å‘½åçš„æ—¶å€™å°½é‡ç”¨å¤§å†™å¼€å¤´</span><br><span class="line">const HtmlWebpackPlugin &#x3D; require(&#39;html-webpack-plugin&#39;); &#x2F;&#x2F;æ‰“åŒ…html</span><br><span class="line">const MiniCssExtractPlugin &#x3D; require(&quot;mini-css-extract-plugin&quot;); &#x2F;&#x2F; æå–å‡ºæ¥css</span><br><span class="line">const UglifyJsPlugin &#x3D; require(&#39;uglifyjs-webpack-plugin&#39;); &#x2F;&#x2F; å‹ç¼©æ‰“åŒ…åçš„js </span><br><span class="line">const HappyPack &#x3D; require(&#39;happypack&#39;); &#x2F;&#x2F; å¤šçº¿ç¨‹æ„å»º</span><br><span class="line">const happyThreadPool &#x3D; HappyPack.ThreadPool(&#123; size: 5 &#125;);  &#x2F;&#x2F; æ„é€ å‡ºå…±äº«è¿›ç¨‹æ± ï¼Œè¿›ç¨‹æ± ä¸­åŒ…å«5ä¸ªå­è¿›ç¨‹</span><br><span class="line">const OptimizeCssAssetsPlugin &#x3D; require(&#39;optimize-css-assets-webpack-plugin&#39;)&#x2F;&#x2F; æœ€å¤§åŒ–å‹ç¼©css</span><br><span class="line"></span><br><span class="line">console.log(&#39;process.env.NODE_ENV-------&gt;&#39;,  process.env.NODE_ENV)</span><br><span class="line">&#x2F;&#x2F; è§£å†³css åˆ†ç¦»åå›¾ç‰‡å¼•å…¥è·¯å¾„ä¸æ­£ç¡®é—®é¢˜</span><br><span class="line">if (process.env.type &#x3D;&#x3D; &#39;build&#39;) &#123; &#x2F;&#x2F; åˆ¤æ–­package.jsoné‡Œé¢æ˜¯buildè¿˜æ˜¯devå‘½ä»¤</span><br><span class="line">    &#x2F;&#x2F; å¼€å‘</span><br><span class="line">    var website &#x3D;&#123;</span><br><span class="line">        publicPath:&quot;&#x2F;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    &#x2F;&#x2F; ç”Ÿäº§</span><br><span class="line">    var website &#x3D;&#123;</span><br><span class="line">        publicPath:&quot;&#x2F;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F; devtool:&#39;eval-source-map&#39;,</span><br><span class="line">    mode: &#39;development&#39;, &#x2F;&#x2F; æ¨¡å¼é…ç½®</span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: &#39;.&#x2F;src&#x2F;index.js&#39;,</span><br><span class="line">    &#125;,             </span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#39;bundle.[chunkhash:6].js&#39;,</span><br><span class="line">        path: path.resolve(__dirname, &#39;dist&#39;),</span><br><span class="line">        publicPath: website.publicPath, &#x2F;&#x2F; è§£å†³css åˆ†ç¦»åå›¾ç‰‡å¼•å…¥è·¯å¾„ä¸æ­£ç¡®é—®é¢˜</span><br><span class="line">    &#125;,             </span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.css&#x2F;,</span><br><span class="line">                exclude: &#x2F;node_modules&#x2F;,</span><br><span class="line">                use: [&#39;style-loader&#39;, MiniCssExtractPlugin.loader,&#x2F;&#x2F;æ‹†åˆ†css [å¯¹åº”109-112è¡Œ]</span><br><span class="line">                &#123;</span><br><span class="line">                      loader: require.resolve(&#39;postcss-loader&#39;),   &#x2F;&#x2F;è¿™é‡Œæ˜¯åŠ ä¸Šæµè§ˆå™¨çš„å‰ç¼€</span><br><span class="line">                      options: &#123;</span><br><span class="line">                          ident: &#39;postcss&#39;,</span><br><span class="line">                          plugins: () &#x3D;&gt; [</span><br><span class="line">                              require(&#39;postcss-flexbugs-fixes&#39;), &#x2F;&#x2F;ä¿®å¤Flexbugs</span><br><span class="line">                              require(&#39;postcss-preset-env&#39;)(&#123; &#x2F;&#x2F;postcss-preset-envåŒ…æ‹¬autoprefixer</span><br><span class="line">                                  autoprefixer: &#123;</span><br><span class="line">                                      flexbox: &#39;no-2009&#39;,</span><br><span class="line">                                  &#125;,</span><br><span class="line">                                  stage: 3,</span><br><span class="line">                              &#125;),</span><br><span class="line">                          ]</span><br><span class="line">                      &#125;,</span><br><span class="line">                 &#125;, </span><br><span class="line">                 &#39;css-loader&#39;],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.less$&#x2F;,</span><br><span class="line">                exclude: &#x2F;node_modules&#x2F;,</span><br><span class="line">                use: [&#39;style-loader&#39;, MiniCssExtractPlugin.loader, &#39;css-loader&#39;, &#39;less-loader&#39;],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.(png|jpe?g|gif|svg)$&#x2F;,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: &#39;url-loader&#39;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: 10000,</span><br><span class="line">                            name: &#39;[name]_[hash:7].[ext]&#39;, </span><br><span class="line">                            outputPath:&#39;static&#x2F;images&#x2F;&#39;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.(htm|html)$&#x2F;,</span><br><span class="line">                use: &#39;html-withimg-loader&#39;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F; babel è§£æes7 es6 jsx</span><br><span class="line">            &#123;</span><br><span class="line">                test:&#x2F;\.(jsx|js)$&#x2F;,</span><br><span class="line">                include: [ </span><br><span class="line">                    path.resolve(__dirname, &#39;src&#39;),</span><br><span class="line">                ],</span><br><span class="line">                use:[&#39;babel-loader&#39;],</span><br><span class="line">                &#x2F;*</span><br><span class="line">                    å¦‚æœå¼€å¯å¤šçº¿ç¨‹è¿›è¡Œæ„å»º</span><br><span class="line">                    use:[&#39;happypack&#x2F;loader?id&#x3D;js&#39;], </span><br><span class="line">                    loaderè¿™æ ·å†™ åŒ¹é…ä¸‹é¢æ³¨é‡Šçš„æ’ä»¶</span><br><span class="line">                *&#x2F;</span><br><span class="line">                exclude:&#x2F;node_modules&#x2F;</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,              </span><br><span class="line">    plugins: [</span><br><span class="line">        &#x2F;&#x2F; æ‰“åŒ…html</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &#39;.&#x2F;src&#x2F;index.html&#39;,</span><br><span class="line">            hash: true,</span><br><span class="line">            minify: &#123;</span><br><span class="line">                minifyCSS: true,</span><br><span class="line">                minifyJS: true, </span><br><span class="line">                removeAttributeQuotes: true</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">        new MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: &quot;static&#x2F;css&#x2F;[name].[chunkhash:8].css&quot;,</span><br><span class="line">            chunkFilename: &quot;[id].css&quot;</span><br><span class="line">        &#125;),</span><br><span class="line">        new UglifyJsPlugin(&#123;</span><br><span class="line">            parallel: true, </span><br><span class="line">        &#125;),</span><br><span class="line">        new webpack.DefinePlugin(&#123;</span><br><span class="line">            NODE_ENV: JSON.stringify(&#39;DEV&#39;)</span><br><span class="line">        &#125;),</span><br><span class="line">        &#x2F;&#x2F; å¤šçº¿ç¨‹æ„å»º åŒ¹é…ä¸Šé¢çš„loader</span><br><span class="line">        &#x2F;&#x2F; new HappyPack(&#123;</span><br><span class="line">        &#x2F;&#x2F;     id: &#39;js&#39;,</span><br><span class="line">        &#x2F;&#x2F;     &#x2F;&#x2F;threads: 4,</span><br><span class="line">        &#x2F;&#x2F;     loaders: [&#39;babel-loader&#39;],</span><br><span class="line">        &#x2F;&#x2F;     threadPool: happyThreadPool, &#x2F;&#x2F; ä½¿ç”¨å…±äº«è¿›ç¨‹æ± ä¸­çš„å­è¿›ç¨‹å»å¤„ç†ä»»åŠ¡</span><br><span class="line">        &#x2F;&#x2F; &#125;),</span><br><span class="line">        &#39;postcss-px-to-viewport&#39;: &#123;</span><br><span class="line">           viewportWidth: 750,   &#x2F;&#x2F; è§†çª—çš„å®½åº¦ï¼Œå¯¹åº”çš„æ˜¯æˆ‘ä»¬è®¾è®¡ç¨¿çš„å®½åº¦ï¼Œä¸€èˆ¬æ˜¯750</span><br><span class="line">           viewportHeight: 1334, &#x2F;&#x2F; è§†çª—çš„é«˜åº¦ï¼Œæ ¹æ®750è®¾å¤‡çš„å®½åº¦æ¥æŒ‡å®šï¼Œä¸€èˆ¬æŒ‡å®š1334ï¼Œä¹Ÿå¯ä»¥ä¸é…ç½®</span><br><span class="line">           unitPrecision: 3,     &#x2F;&#x2F; æŒ‡å®š&#96;px&#96;è½¬æ¢ä¸ºè§†çª—å•ä½å€¼çš„å°æ•°ä½æ•°</span><br><span class="line">           viewportUnit: &quot;vw&quot;,   &#x2F;&#x2F;æŒ‡å®šéœ€è¦è½¬æ¢æˆçš„è§†çª—å•ä½ï¼Œå»ºè®®ä½¿ç”¨vw</span><br><span class="line">           selectorBlackList: [&#39;.ignore&#39;],&#x2F;&#x2F; æŒ‡å®šä¸è½¬æ¢ä¸ºè§†çª—å•ä½çš„ç±»ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œå¯ä»¥æ— é™æ·»åŠ ,å»ºè®®å®šä¹‰ä¸€è‡³ä¸¤ä¸ªé€šç”¨çš„ç±»å</span><br><span class="line">           minPixelValue: 1,     &#x2F;&#x2F; å°äºæˆ–ç­‰äº&#96;1px&#96;ä¸è½¬æ¢ä¸ºè§†çª—å•ä½ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºä½ æƒ³è¦çš„å€¼</span><br><span class="line">           mediaQuery: false     &#x2F;&#x2F; å…è®¸åœ¨åª’ä½“æŸ¥è¯¢ä¸­è½¬æ¢&#96;px&#96;</span><br><span class="line">        &#125;   </span><br><span class="line">    ],   </span><br><span class="line">    &#x2F;&#x2F; æå–å…¬å…±ä»£ç </span><br><span class="line">    optimization: &#123;</span><br><span class="line">        minimizer: [</span><br><span class="line">           &#x2F;&#x2F; è‡ªå®šä¹‰jsä¼˜åŒ–é…ç½®ï¼Œå°†ä¼šè¦†ç›–é»˜è®¤é…ç½® æœ€å¤§åŒ–å‹ç¼©æˆjs</span><br><span class="line">            new UglifyJsPlugin(&#123;</span><br><span class="line">                exclude: &#x2F;\.min\.js$&#x2F;, &#x2F;&#x2F; è¿‡æ»¤æ‰ä»¥&quot;.min.js&quot;ç»“å°¾çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªåç¼€æœ¬èº«å°±æ˜¯å·²ç»å‹ç¼©å¥½çš„ä»£ç ï¼Œæ²¡å¿…è¦è¿›è¡ŒäºŒæ¬¡å‹ç¼©</span><br><span class="line">                cache: true,</span><br><span class="line">                parallel: true, &#x2F;&#x2F; å¼€å¯å¹¶è¡Œå‹ç¼©ï¼Œå……åˆ†åˆ©ç”¨cpu</span><br><span class="line">                sourceMap: false,</span><br><span class="line">                extractComments: false, &#x2F;&#x2F; ç§»é™¤æ³¨é‡Š</span><br><span class="line">                uglifyOptions: &#123;</span><br><span class="line">                  compress: &#123;</span><br><span class="line">                    unused: true,</span><br><span class="line">                    warnings: false,</span><br><span class="line">                    drop_debugger: true</span><br><span class="line">                  &#125;,</span><br><span class="line">                  output: &#123;</span><br><span class="line">                    comments: false</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;),</span><br><span class="line">            &#x2F;&#x2F; ç”¨äºä¼˜åŒ–cssæ–‡ä»¶ æœ€å¤§åŒ–å‹ç¼©æˆcss å¹¶ä¸”å»æ‰æ³¨é‡Šæ‰çš„css</span><br><span class="line">            new OptimizeCssAssetsPlugin(&#123;</span><br><span class="line">                assetNameRegExp: &#x2F;\.css$&#x2F;g,</span><br><span class="line">                cssProcessorOptions: &#123;</span><br><span class="line">                  safe: true,</span><br><span class="line">                  autoprefixer: &#123; disable: true &#125;,</span><br><span class="line">                  mergeLonghand: false,</span><br><span class="line">                  discardComments: &#123;</span><br><span class="line">                    removeAll: true &#x2F;&#x2F; ç§»é™¤æ³¨é‡Š</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                canPrint: true</span><br><span class="line">            &#125;)</span><br><span class="line">           ],</span><br><span class="line">            splitChunks: &#123;</span><br><span class="line">                cacheGroups: &#123;</span><br><span class="line">                vendor: &#123;   &#x2F;&#x2F; æŠ½ç¦»ç¬¬ä¸‰æ–¹æ’ä»¶</span><br><span class="line">                    test: &#x2F;node_modules&#x2F;,   &#x2F;&#x2F; æŒ‡å®šæ˜¯node_modulesä¸‹çš„ç¬¬ä¸‰æ–¹åŒ…</span><br><span class="line">                    chunks: &#39;initial&#39;,</span><br><span class="line">                    name: &#39;vendor&#39;,  &#x2F;&#x2F; æ‰“åŒ…åçš„æ–‡ä»¶åï¼Œä»»æ„å‘½å    </span><br><span class="line">                    &#x2F;&#x2F; è®¾ç½®ä¼˜å…ˆçº§ï¼Œé˜²æ­¢å’Œè‡ªå®šä¹‰çš„å…¬å…±ä»£ç æå–æ—¶è¢«è¦†ç›–ï¼Œä¸è¿›è¡Œæ‰“åŒ…</span><br><span class="line">                    priority: 10    </span><br><span class="line">                &#125;,</span><br><span class="line">                &#x2F;&#x2F; utils: &#123; &#x2F;&#x2F; æŠ½ç¦»è‡ªå·±å†™çš„å…¬å…±ä»£ç ï¼Œutilsè¿™ä¸ªåå­—å¯ä»¥éšæ„èµ· (css&#x2F;jså…¬ç”¨çš„éƒ½ä¼šå•ç‹¬æŠ½ç¦»å‡ºæ¥ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶)</span><br><span class="line">                &#x2F;&#x2F;     chunks: &#39;initial&#39;,</span><br><span class="line">                &#x2F;&#x2F;     name: &#39;utils&#39;,  &#x2F;&#x2F; ä»»æ„å‘½å</span><br><span class="line">                &#x2F;&#x2F;     minSize: 0    &#x2F;&#x2F; åªè¦è¶…å‡º0å­—èŠ‚å°±ç”Ÿæˆä¸€ä¸ªæ–°åŒ…</span><br><span class="line">                &#x2F;&#x2F; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,        </span><br><span class="line">    devServer: &#123;</span><br><span class="line">        historyApiFallback: true,</span><br><span class="line">        inline: true</span><br><span class="line">    &#125;,   </span><br><span class="line">    &#x2F;&#x2F; externals: &#123;</span><br><span class="line">    &#x2F;&#x2F;     jquery: &quot;jQuery&quot;,</span><br><span class="line">    &#x2F;&#x2F; &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        &#x2F;&#x2F; alias åˆ«åé…ç½®ï¼Œå®ƒèƒ½å¤Ÿå°†å¯¼å…¥è¯­å¥é‡Œçš„å…³é”®å­—æ›¿æ¢æˆä½ éœ€è¦çš„è·¯å¾„</span><br><span class="line">        alias: &#123;</span><br><span class="line">            &#x2F;&#x2F; æ¯”å¦‚æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å†™ import Nav from &#39;@&#x2F;Nav&#39;</span><br><span class="line">            &#39;@&#39;: &#39;.&#x2F;app&#x2F;component&#39;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F; çœç•¥åç¼€</span><br><span class="line">        extensions: [&#39;.js&#39;, &#39;.jsx&#39;, &#39;.less&#39;, &#39;.json&#39;, &#39;.css&#39;],</span><br><span class="line">    &#125;,     </span><br><span class="line">    performance: &#123;</span><br><span class="line">        hints: false &#x2F;&#x2F; é€‰é¡¹å¯ä»¥æ§åˆ¶ webpack å¦‚ä½•é€šçŸ¥ã€Œèµ„æº(asset)å’Œå…¥å£èµ·ç‚¹è¶…è¿‡æŒ‡å®šæ–‡ä»¶é™åˆ¶ã€</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><p><a href="https://juejin.im/post/5de87444518825124c50cd36?utm_source=gold_browser_extension" target="_blank" rel="noopener">å®æˆ˜</a></p></li><li><p><a href="https://webpack.js.org/configuration/optimization/" target="_blank" rel="noopener">webpack optimization</a></p></li><li><p><a href="https://dev.to/flexdinesh/upgrade-to-webpack-4---5bc5" target="_blank" rel="noopener">Upgrade to Webpack 4</a></p></li><li><p><a href="https://juejin.im/post/5b3e22e3f265da0f4b7a72df" target="_blank" rel="noopener">webpackç¼–è¯‘é€Ÿåº¦æå‡ä¹‹DllPlugin</a></p></li><li><p><a href="https://juejin.im/post/5abbc2ca5188257ddb0fae9b" target="_blank" rel="noopener">webpack4.0æ‰“åŒ…ä¼˜åŒ–ç­–ç•¥ç³»åˆ—</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webpack </category>
          
          <category> Webpack4 é…ç½®è¯¦è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BFC</title>
      <link href="/2018/01/20/workspace/Css/bfc/"/>
      <url>/2018/01/20/workspace/Css/bfc/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>BFC</strong></p><p><strong>å¦‚ä½•åˆ›å»ºBFC</strong></p><ul><li>floatçš„å€¼ä¸æ˜¯noneã€‚</li><li>positionçš„å€¼ä¸æ˜¯staticæˆ–è€…relativeã€‚</li><li>displayçš„å€¼æ˜¯inline-blockã€table-cellã€flexã€table-captionæˆ–è€…inline-flex</li><li>overflowçš„å€¼ä¸æ˜¯visible</li></ul><p><strong>BFCçš„ä½œç”¨</strong></p><ul><li>åˆ©ç”¨BFCé¿å…marginé‡å ã€‚</li><li>è‡ªé€‚åº”ä¸¤æ å¸ƒå±€</li><li>æ¸…é™¤æµ®åŠ¨</li></ul><p><strong>å®ç°ä¸€ä¸ªä¸‰æ å¸ƒå±€</strong></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    *&#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        position: relative;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="css">    <span class="selector-class">.left</span> &#123;</span></span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 150px;</span><br><span class="line">        float: left;</span><br><span class="line">        background: rgb(139, 214, 78);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.right</span> &#123;</span></span><br><span class="line">        float: right;</span><br><span class="line">        height: 300px;</span><br><span class="line">        background: rgb(170, 54, 236);  </span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.center</span>&#123;</span></span><br><span class="line">        overflow: hidden;</span><br><span class="line">        background: red;  </span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/sinat_36422236/article/details/88763187" target="_blank" rel="noopener">https://blog.csdn.net/sinat_36422236/article/details/88763187</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cssçš„æ¨¡å—åŒ–</title>
      <link href="/2018/01/20/workspace/Css/cssModules/"/>
      <url>/2018/01/20/workspace/Css/cssModules/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>cssçš„æ¨¡å—åŒ–</strong></p><p><code>1</code>. å…³äºlessä½¿ç”¨å»ºè®®</p><pre><code>1ã€è¿‡æ¸¡çš„åµŒå¥—ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜å‘ç”Ÿï¼Œä½¿ä»£ç å˜å¾—æ›´å¤æ‚ï¼Œè€Œä¸”å¤ªè¿‡ä¾èµ–äºHTMLç»“æ„ï¼Œè¿™æ ·åé¢è¦è¦†ç›–æ ·å¼éœ€è¦ä¾èµ–äº&quot;!important&quot;ï¼Œè€Œè¿™ç§æ–¹å¼åˆæ˜¯æˆ‘ä»¬å°½é‡é¿å…ä½¿ç”¨çš„ä¸€ç§2ã€åµŒå¥—å±‚çº§ä¸åº”è¯¥è¶…è¿‡ä¸‰å±‚3ã€åµŒå¥—å±‚çº§ç¼–è¯‘å‡ºæ¥çš„CSSï¼Œè¦ç¡®ä¿å…¶ç®€æ´ï¼Œå¯é‡ç”¨4ã€ä½¿ç”¨åµŒå¥—å¾ˆæœ‰æ„ä¹‰ï¼Œä½†å¹¶ä¸æ„å‘³ç€æ— é™çº§çš„åµŒå¥—</code></pre><p><code>2</code>.è¿™ç©æ„çš„å¥½å¤„</p><pre><code>è§£å†³CSSä¸­çš„å…¨å±€ä½œç”¨åŸŸé—®é¢˜ã€‚è¯´ç™½äº†å°±æ˜¯è§£å†³ä¸åŒé¡µé¢æ ·å¼å†²çªçš„é—®é¢˜ä¿ç•™äº†å¾ˆå¥½çš„ç»„ä»¶å¤ç”¨æ€§ ï¼ˆcomposesï¼‰å¾ˆæ–¹ä¾¿çš„æŒ‰éœ€åŠ è½½</code></pre><p><code>3</code>.å¯ç”¨css modules åªéœ€åœ¨webpackä¸­ä½¿ç”¨css-loaderï¼Œä¸‹é¢ä¸ºlessä¸­ä½¿ç”¨</p><pre><code>`ä½¿ç”¨cssmodulesåæ”¹å˜css,æµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ·æ–°,å› ä¸ºä»–æ˜¯åŸºäºå¯¹è±¡çš„ï¼Œä¹‹å‰ç›´æ¥å†™lessçš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨çš„`</code></pre><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//@Lynn è¿™é‡Œæˆ‘å¼€å¯è‡ªå·±ç¼–å†™çš„lessæ–‡ä»¶çš„css modulesåŠŸèƒ½ é™¤äº†node_modulesåº“ä¸­çš„less</span></span><br><span class="line"><span class="comment">//ä¹Ÿå°±æ˜¯å¯ä»¥è¿‡æ»¤æ‰antdåº“ä¸­çš„æ ·å¼</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">  exclude: [<span class="regexp">/node_modules/</span>],</span><br><span class="line">  use: [</span><br><span class="line">      <span class="built_in">require</span>.resolve(<span class="string">'style-loader'</span>),</span><br><span class="line">      &#123;</span><br><span class="line">          loader: <span class="built_in">require</span>.resolve(<span class="string">'css-loader'</span>),</span><br><span class="line">          options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIndexName:<span class="string">"[name]__[local]___[hash:base64:5]"</span></span><br><span class="line">          &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">          loader: <span class="built_in">require</span>.resolve(<span class="string">'less-loader'</span>), <span class="comment">// compiles Less to CSS</span></span><br><span class="line">      &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>4</code>.    åœ¨æ™ºæ…§ç¤¾åŒºé‡Œé¢ä½¿ç”¨ï¼š<br>    1. å¯¹äºå±€éƒ¨css   é‡‡ç”¨[name]. module.[less | css]ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//è¿™ä¸ªæ˜¯åœ¨config/webpack.config.dev.jsé‡Œé¢å®šä¹‰äº†</span></span><br><span class="line">&#123;</span><br><span class="line">test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">use: [</span><br><span class="line">  <span class="built_in">require</span>.resolve(<span class="string">'style-loader'</span>),</span><br><span class="line">  (&#123;resource&#125;) =&gt; (&#123;</span><br><span class="line">    loader: <span class="string">'css-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      importLoaders: <span class="number">1</span>,</span><br><span class="line">      modules: <span class="regexp">/\.module\.less/</span>.test(resource),</span><br><span class="line">      localIdentName: <span class="string">'[name]__[local]___[hash:base64:5]'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">  &#123;</span><br><span class="line">    loader: <span class="built_in">require</span>.resolve(<span class="string">'postcss-loader'</span>),</span><br><span class="line">    options: &#123;</span><br><span class="line">      ident: <span class="string">'postcss'</span>, <span class="comment">// https://webpack.js.org/guides/migrating/#complex-options</span></span><br><span class="line">      plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'postcss-flexbugs-fixes'</span>),</span><br><span class="line">        autoprefixer(&#123;</span><br><span class="line">          browsers: [</span><br><span class="line">            <span class="string">'&gt;1%'</span>,</span><br><span class="line">            <span class="string">'last 4 versions'</span>,</span><br><span class="line">            <span class="string">'Firefox ESR'</span>,</span><br><span class="line">            <span class="string">'not ie &lt; 9'</span>, <span class="comment">// React doesn't support IE8 anyway</span></span><br><span class="line">          ],</span><br><span class="line">          flexbox: <span class="string">'no-2009'</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    loader: <span class="built_in">require</span>.resolve(<span class="string">'less-loader'</span>),</span><br><span class="line">    options: &#123;</span><br><span class="line">      modifyVars: theme,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>2. å®šä¹‰å…¨å±€æ ·å¼ï¼Œç›´æ¥åœ¨css|lessæ–‡ä»¶åŠ å…¥:globalï¼š</code></pre><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* å®šä¹‰å¤šä¸ªå…¨å±€æ ·å¼ */</span></span><br><span class="line"><span class="selector-pseudo">:global</span> &#123;</span><br><span class="line">  .link &#123;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-tag">green</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: yellow;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>3. å¯¹äºç»„ä»¶çš„å¼•å…¥</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* components&#x2F;Button.css *&#x2F;</span><br><span class="line">.base &#123; &#x2F;* æ‰€æœ‰é€šç”¨çš„æ ·å¼ *&#x2F; &#125;</span><br><span class="line"></span><br><span class="line">.normal &#123;</span><br><span class="line">  composes: base;</span><br><span class="line">  &#x2F;* normal å…¶å®ƒæ ·å¼ *&#x2F;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.disabled &#123;</span><br><span class="line">  composes: base;</span><br><span class="line">  &#x2F;* disabled å…¶å®ƒæ ·å¼ *&#x2F;</span><br><span class="line">&#125;</span><br><span class="line">import styles from &#39;.&#x2F;Button.css&#39;;</span><br><span class="line"></span><br><span class="line">buttonElem.outerHTML &#x3D; &#96;&lt;button class&#x3D;$&#123;styles.normal&#125;&gt;Submit&lt;&#x2F;button&gt;&#96;</span><br></pre></td></tr></table></figure><pre><code>4.css modulesçš„å±€é™ï¼š1.classåå¿…é¡»æ˜¯é©¼å³°å½¢å¼ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸åœ¨jsé‡Œä½¿ç”¨ styles.table æ¥å¼•ç”¨ å¯¹æ­¤çš„è§£å†³æ–¹æ³•</code></pre><figure class="highlight"><table><tr><td class="code"><pre><span class="line">className=&#123;styles['tree-component-header']</span><br></pre></td></tr></table></figure><pre><code>2.ç”±äºcssæ¨¡å—åŒ–æ˜¯é»˜è®¤ï¼Œå½“ä½ å¸Œæœ›ä½¿ç”¨æ­£å¸¸çš„å…¨å±€cssæ—¶ï¼Œéœ€è¦é€šè¿‡:local å’Œ :global åˆ‡æ¢ï¼Œä¸æ–¹ä¾¿3.æ‰€æœ‰çš„ className éƒ½å¿…é¡»ä½¿ç”¨ {style.className} çš„å½¢å¼5.composes å…³é”®è¯</code></pre><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//css</span></span><br><span class="line">  .serif-font &#123;</span><br><span class="line">      font-family: Georgia,serif;</span><br><span class="line">  &#125;</span><br><span class="line">  .display &#123;</span><br><span class="line">     composes: serif-font;</span><br><span class="line">      font-size: <span class="number">30</span>px;</span><br><span class="line">      line-height: <span class="number">35</span>px;</span><br><span class="line">  &#125;&#125;</span><br><span class="line"> <span class="comment">//ç»„ä»¶</span></span><br><span class="line"> <span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">"./type.css"</span>;</span><br><span class="line"> element.innerHTML = </span><br><span class="line"> <span class="string">`</span></span><br><span class="line"><span class="string">     &lt;h1 class=&#123;styles.display&#125;&gt;</span></span><br><span class="line"><span class="string">         This is a heading</span></span><br><span class="line"><span class="string">     &lt;/h1&gt;`</span></span><br><span class="line">     </span><br><span class="line"> <span class="comment">//æµè§ˆå™¨</span></span><br><span class="line"> &lt;h1 <span class="class"><span class="keyword">class</span></span>=<span class="string">"_type__display_0980340 _type_serif_404840"</span>&gt;</span><br><span class="line">     This is a heading</span><br><span class="line"> &lt;<span class="regexp">/h1&gt;</span></span><br></pre></td></tr></table></figure><p><code>æœ€åé…ä¸Šæˆ‘è‡ªå·±è®¾ç½®çš„cssModules</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"> test: lessRegex,</span><br><span class="line"> exclude: lessModuleRegex,</span><br><span class="line"> use: getStyleLoaders(</span><br><span class="line">     &#123;</span><br><span class="line">       importLoaders: <span class="number">2</span>,</span><br><span class="line">       modules: <span class="literal">true</span>,</span><br><span class="line">         localIdentName: <span class="string">'[path][name]-[local]-[hash:base64:5]'</span>,</span><br><span class="line">       sourceMap: isEnvProduction &amp;&amp; shouldUseSourceMap,</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">'less-loader'</span></span><br><span class="line"> ),</span><br><span class="line"> sideEffects: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¦æƒ…çœ‹ï¼š</p><p><code>1</code>. <a href="https://www.jianshu.com/p/51ff1c8be301" target="_blank" rel="noopener">å¦‚ä½•åœ¨reactä¸­ä½¿ç”¨antd+less+css modules</a><br/><br><code>2</code>. <a href="https://zhuanlan.zhihu.com/p/20495964" target="_blank" rel="noopener">å…·ä½“ä½¿ç”¨ ç»“åˆclassnames</a><br/><br><code>3</code>. <a href="https://zhuanlan.zhihu.com/p/20495964" target="_blank" rel="noopener">CSS Modules è¯¦è§£åŠ React ä¸­å®è·µ</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸…é™¤æµ®åŠ¨çš„æœ€å¸¸ç”¨çš„å‡ ç§æ–¹æ³•</title>
      <link href="/2018/01/20/workspace/Css/clearfix/"/>
      <url>/2018/01/20/workspace/Css/clearfix/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>æ¸…é™¤æµ®åŠ¨çš„æœ€å¸¸ç”¨çš„å‡ ç§æ–¹æ³•</strong></p><p>[[toc]]</p><p><strong>ä¸ºä»€ä¹ˆè¦æ¸…é™¤æµ®åŠ¨ï¼Ÿ</strong></p><p>æ¸…é™¤æµ®åŠ¨ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ï¼Œçˆ¶å…ƒç´ å› ä¸ºå­çº§å…ƒç´ æµ®åŠ¨å¼•èµ·çš„å†…éƒ¨é«˜åº¦ä¸º0çš„é—®é¢˜</p><h3 id="é¢å¤–æ ‡ç­¾æ³•"><a href="#é¢å¤–æ ‡ç­¾æ³•" class="headerlink" title="é¢å¤–æ ‡ç­¾æ³•"></a>é¢å¤–æ ‡ç­¾æ³•</h3><p>åœ¨æœ€åä¸€ä¸ªæµ®åŠ¨æ ‡ç­¾åï¼Œæ–°åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œç»™å…¶è®¾ç½®clearï¼šbothï¼›ï¼ˆä¸æ¨èï¼‰</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">.clear&#123;</span><br><span class="line">    clear:both;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clear"</span>&gt;</span>é¢å¤–æ ‡ç­¾æ³•<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="çˆ¶çº§æ·»åŠ overflowå±æ€§"><a href="#çˆ¶çº§æ·»åŠ overflowå±æ€§" class="headerlink" title="çˆ¶çº§æ·»åŠ overflowå±æ€§"></a>çˆ¶çº§æ·»åŠ overflowå±æ€§</h3><p>é€šè¿‡è§¦å‘BFCçš„æ–¹å¼ï¼Œå®ç°æ¸…æ¥šæµ®åŠ¨æ•ˆæœã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">   overflow: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¼ºç‚¹</strong>ï¼šå†…å®¹å¢å¤šçš„æ—¶å€™å®¹æ˜“é€ æˆä¸ä¼šè‡ªåŠ¨æ¢è¡Œå¯¼è‡´å†…å®¹è¢«éšè—æ‰ï¼Œæ— æ³•æ˜¾ç¤ºè¦æº¢å‡ºçš„å…ƒç´ ,å±€é™æ€§å¤ªå¤§</p><h3 id="ä½¿ç”¨afterä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨"><a href="#ä½¿ç”¨afterä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨" class="headerlink" title="ä½¿ç”¨afterä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨ **"></a>ä½¿ç”¨afterä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨ **</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span>&#123;<span class="comment">/*ä¼ªå…ƒç´ æ˜¯è¡Œå†…å…ƒç´  æ­£å¸¸æµè§ˆå™¨æ¸…é™¤æµ®åŠ¨æ–¹æ³•*/</span></span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">clear</span>:both;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span>&#123;</span><br><span class="line">    *zoom: 1;/*ie6æ¸…é™¤æµ®åŠ¨çš„æ–¹å¼ *å·åªæœ‰IE6-IE7æ‰§è¡Œï¼Œå…¶ä»–æµè§ˆå™¨ä¸æ‰§è¡Œ*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨beforeå’ŒafteråŒä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨"><a href="#ä½¿ç”¨beforeå’ŒafteråŒä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨" class="headerlink" title="ä½¿ç”¨beforeå’ŒafteråŒä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨ **"></a>ä½¿ç”¨beforeå’ŒafteråŒä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨ **</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span>,<span class="selector-class">.clearfix</span><span class="selector-pseudo">:before</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span>&#123;</span><br><span class="line">    *zoom: 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flexå¼¹æ€§å¸ƒå±€</title>
      <link href="/2018/01/20/workspace/Css/flex/"/>
      <url>/2018/01/20/workspace/Css/flex/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Flexå¼¹æ€§å¸ƒå±€</strong></p><p>[[toc]]</p><p><strong><code>å®¹å™¨çš„å±æ€§</code></strong></p><h4 id="flex-directionå±æ€§"><a href="#flex-directionå±æ€§" class="headerlink" title="flex-directionå±æ€§"></a>flex-directionå±æ€§</h4><p><code>flex-direction</code>å±æ€§å†³å®šä¸»è½´çš„æ–¹å‘ï¼ˆå³é¡¹ç›®çš„æ’åˆ—æ–¹å‘ï¼‰ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row | row-reverse | column | column-reverse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">row</span>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯ã€‚</span><br><span class="line"><span class="selector-tag">row-reverse</span>ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å³ç«¯ã€‚</span><br><span class="line"><span class="selector-tag">column</span>ï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸Šæ²¿ã€‚</span><br><span class="line"><span class="selector-tag">column-reverse</span>ï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸‹æ²¿ã€‚</span><br></pre></td></tr></table></figure><h4 id="flex-wrapå±æ€§"><a href="#flex-wrapå±æ€§" class="headerlink" title="flex-wrapå±æ€§"></a>flex-wrapå±æ€§</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®éƒ½æ’åœ¨ä¸€æ¡çº¿ï¼ˆåˆç§°â€è½´çº¿â€ï¼‰ä¸Šã€‚flex-wrapå±æ€§å®šä¹‰ï¼Œå¦‚æœä¸€æ¡è½´çº¿æ’ä¸ä¸‹ï¼Œå¦‚ä½•æ¢è¡Œã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: nowrap | wrap | wrap-reverse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">nowrap</span>ï¼ˆé»˜è®¤ï¼‰ï¼šä¸æ¢è¡Œã€‚</span><br><span class="line"><span class="selector-tag">wrap</span>ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸Šæ–¹ã€‚</span><br><span class="line"><span class="selector-tag">wrap-reverse</span>ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸‹æ–¹ã€‚</span><br></pre></td></tr></table></figure><h4 id="flex-flowå±æ€§"><a href="#flex-flowå±æ€§" class="headerlink" title="flex-flowå±æ€§"></a>flex-flowå±æ€§</h4><p><code>flex-flow</code>å±æ€§æ˜¯<code>flex-direction</code>å±æ€§å’Œ<code>flex-wrap</code>å±æ€§çš„ç®€å†™å½¢å¼ï¼Œé»˜è®¤å€¼ä¸º<code>row nowrap</code>ã€‚</p><h4 id="justify-contentå±æ€§"><a href="#justify-contentå±æ€§" class="headerlink" title="justify-contentå±æ€§"></a>justify-contentå±æ€§</h4><p><code>justify-content</code>å±æ€§å®šä¹‰äº†é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start | flex-end | center | space-between | space-around;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">flex-start</span>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå·¦å¯¹é½</span><br><span class="line"><span class="selector-tag">flex-end</span>ï¼šå³å¯¹é½</span><br><span class="line"><span class="selector-tag">center</span>ï¼š å±…ä¸­</span><br><span class="line"><span class="selector-tag">space-between</span>ï¼šä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰ã€‚</span><br><span class="line"><span class="selector-tag">space-around</span>ï¼šæ¯ä¸ªé¡¹ç›®ä¸¤ä¾§çš„é—´éš”ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</span><br></pre></td></tr></table></figure><h4 id="align-itemså±æ€§"><a href="#align-itemså±æ€§" class="headerlink" title="align-itemså±æ€§"></a>align-itemså±æ€§</h4><p><code>align-items</code>å±æ€§å®šä¹‰é¡¹ç›®åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">align-items</span>: flex-start | flex-end | center | baseline | stretch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">flex-start</span>ï¼šäº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</span><br><span class="line"><span class="selector-tag">flex-end</span>ï¼šäº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</span><br><span class="line"><span class="selector-tag">center</span>ï¼šäº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</span><br><span class="line"><span class="selector-tag">baseline</span>: é¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½ã€‚</span><br><span class="line"><span class="selector-tag">stretch</span>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸º<span class="selector-tag">auto</span>ï¼Œå°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚</span><br></pre></td></tr></table></figure><h4 id="align-contentå±æ€§"><a href="#align-contentå±æ€§" class="headerlink" title="align-contentå±æ€§"></a>align-contentå±æ€§</h4><p><code>align-content</code>å±æ€§å®šä¹‰äº†<code>å¤šæ ¹è½´çº¿</code>çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿ï¼Œè¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">align-content</span>: flex-start | flex-end | center | space-between | space-around | stretch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">flex-start</span>ï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</span><br><span class="line"><span class="selector-tag">flex-end</span>ï¼šä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</span><br><span class="line"><span class="selector-tag">center</span>ï¼šä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</span><br><span class="line"><span class="selector-tag">space-between</span>ï¼šä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒã€‚</span><br><span class="line"><span class="selector-tag">space-around</span>ï¼šæ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</span><br><span class="line"><span class="selector-tag">stretch</span>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šè½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´ã€‚</span><br></pre></td></tr></table></figure><p><strong>é€‚ç”¨äºå¼¹æ€§ç›’æ¨¡å‹å®¹å™¨å­å…ƒç´ </strong></p><h4 id="orderå±æ€§"><a href="#orderå±æ€§" class="headerlink" title="orderå±æ€§"></a>orderå±æ€§</h4><p><code>order</code>å±æ€§å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ï¼Œé»˜è®¤ä¸º0ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">order</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="flex-growå±æ€§"><a href="#flex-growå±æ€§" class="headerlink" title="flex-growå±æ€§"></a>flex-growå±æ€§</h4><p><code>flex-grow</code>å±æ€§å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º<code>0</code>ï¼Œå³å¦‚æœå­˜åœ¨<strong><code>å‰©ä½™ç©ºé—´</code></strong>ï¼Œä¹Ÿä¸æ”¾å¤§ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <br/><img style="border: .3em solid #e0dfcc;border-radius: 1em;widthï¼š98%"  src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H71fcbd2221b642a6bc7f52d3170378239.png"><p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„<code>flex-grow</code>å±æ€§éƒ½ä¸º1ï¼Œåˆ™å®ƒä»¬å°†ç­‰åˆ†å‰©ä½™ç©ºé—´ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„<code>flex-grow</code>å±æ€§ä¸º2ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™å‰è€…å æ®çš„å‰©ä½™ç©ºé—´å°†æ¯”å…¶ä»–é¡¹å¤šä¸€å€ã€‚</p><h4 id="flex-shrinkå±æ€§"><a href="#flex-shrinkå±æ€§" class="headerlink" title="flex-shrinkå±æ€§"></a>flex-shrinkå±æ€§</h4><p><code>flex-shrink</code>å±æ€§å®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br/><img style="border: .3em solid #e0dfcc;border-radius: 1em;widthï¼š98%"  src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H245bfecf53234ecba3042bd2f74545efo.jpg"><p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„<code>flex-shrink</code>å±æ€§éƒ½ä¸º1ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œéƒ½å°†ç­‰æ¯”ä¾‹ç¼©å°ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„<code>flex-shrink</code>å±æ€§ä¸º0ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™ç©ºé—´ä¸è¶³æ—¶ï¼Œå‰è€…ä¸ç¼©å°ã€‚è´Ÿå€¼å¯¹è¯¥å±æ€§æ— æ•ˆã€‚</p><h4 id="flex-basiså±æ€§"><a href="#flex-basiså±æ€§" class="headerlink" title="flex-basiså±æ€§"></a>flex-basiså±æ€§</h4><p>flex-basisè¡¨ç¤ºåœ¨flex items è¢«æ”¾å…¥flexå®¹å™¨ä¹‹å‰çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯itemsçš„ç†æƒ³æˆ–è€…å‡è®¾å¤§å°ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å…¶çœŸå®å¤§å°ï¼Œ<br>å…¶çœŸå®å¤§å°å–å†³äºflexå®¹å™¨çš„å®½åº¦ï¼Œflex itemsçš„min-width,max-widthç­‰å…¶ä»–æ ·å¼ï¼Œå…·ä½“åˆ†æçœ‹ä¸‹æ–‡</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">#main &#123;</span><br><span class="line">    width: 350px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    border: 1px solid #c3c3c3;</span><br><span class="line">    display: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#main div &#123;</span><br><span class="line">    flex-grow: 0;</span><br><span class="line">    flex-shrink: 0;</span><br><span class="line">    flex-basis: 40px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#main div:nth-of-type(2) &#123;</span><br><span class="line">    flex-basis: 80px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color:coral;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color:lightblue;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color:khaki;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color:pink;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color:lightgrey;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H8ca6768902df41ecb593aec7f900645ad.png" alt=""></p><h4 id="flexå±æ€§"><a href="#flexå±æ€§" class="headerlink" title="flexå±æ€§"></a>flexå±æ€§</h4><p><code>flex</code>å±æ€§æ˜¯<code>flex-grow</code>, <code>flex-shrink</code> å’Œ <code>flex-basis</code>çš„ç®€å†™ï¼Œé»˜è®¤å€¼ä¸º0 1 autoã€‚åä¸¤ä¸ªå±æ€§å¯é€‰ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: none | [ &lt;<span class="string">'flex-grow'</span>&gt; &lt;<span class="string">'flex-shrink'</span>&gt;? || &lt;<span class="string">'flex-basis'</span>&gt; ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å»ºè®®ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯å•ç‹¬å†™ä¸‰ä¸ªåˆ†ç¦»çš„å±æ€§ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šæ¨ç®—ç›¸å…³å€¼ã€‚</span><br></pre></td></tr></table></figure><h4 id="align-selfå±æ€§"><a href="#align-selfå±æ€§" class="headerlink" title="align-selfå±æ€§"></a>align-selfå±æ€§</h4><p><code>align-self</code>å±æ€§å…è®¸å•ä¸ªé¡¹ç›®æœ‰ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–align-itemså±æ€§ã€‚é»˜è®¤å€¼ä¸ºautoï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„align-itemså±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäºstretchã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">align-self</span>: auto | flex-start | flex-end | center | baseline | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br/><img style="border: .3em solid #e0dfcc;border-radius: 1emwidthï¼š98%;"  src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hedafd4f059f24e8cb9093252cad6f53an.png">]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSSä¹å®«æ ¼å¸ƒå±€å®ç°</title>
      <link href="/2018/01/20/workspace/Css/lattice/"/>
      <url>/2018/01/20/workspace/Css/lattice/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>CSSä¹å®«æ ¼å¸ƒå±€å®ç°</strong></p><p>[[toc]]</p><p><strong>åŸºæœ¬çš„å¸ƒå±€</strong></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,viewport-fit=cover"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background</span>: <span class="selector-id">#e4f7fd61</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 2<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#0786ada1</span>;</span></span><br><span class="line">            border-radius: 8px;</span><br><span class="line">        &#125;</span><br><span class="line">        ul &#123;</span><br><span class="line">            padding: 0;</span><br><span class="line">            margin: 0;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.box</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line">            list-style: none;</span><br><span class="line">            text-align: center;</span><br><span class="line">            line-height: 200px;</span><br><span class="line"><span class="css">            <span class="selector-tag">background</span>: <span class="selector-tag">rgba</span>(146, 203, 230, 0<span class="selector-class">.65</span>);</span></span><br><span class="line">            border-radius: 8px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>5<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>6<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>7<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>9<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="marginè´Ÿå€¼å®ç°"><a href="#marginè´Ÿå€¼å®ç°" class="headerlink" title="marginè´Ÿå€¼å®ç°"></a>marginè´Ÿå€¼å®ç°</h3><ul><li>æœ€å¤–å±‚çš„åŒ…è£¹å…ƒç´ ç­‰äºï¼šliå®½åº¦<em>3+liå³é—´è·</em>2</li><li>å­ç›’å­å·¦æµ®åŠ¨ï¼Œmargin-left margin-bottomé—´è·ä¸º20px</li><li>çˆ¶ç›’å­çš„margin-bottomå’Œmargin-topçš„çš„é—´è·ä¸º-20px,æ¶ˆé™¤å­ç›’å­ä»£ç†çš„ç§»åŠ¨</li><li>çˆ¶ç›’å­æ¶ˆé™¤æµ®åŠ¨</li></ul><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">940px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: -<span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: -<span class="number">20px</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nth-child"><a href="#nth-child" class="headerlink" title="nth-child"></a>nth-child</h3><p>è·Ÿä¸Šé¢çš„é‚£ç§æ–¹æ³•ç±»ä¼¼ï¼Œå°±æ˜¯æŠŠçˆ¶ç›’å­çš„ç§»åŠ¨æ¢æˆäº†æŒ‡å®šçš„å­ç›’å­ç§»åŠ¨</p><p>ä½†æ˜¯è¿™å›å‡ºç°ä¸€ä¸ªé—®é¢˜å°±æ˜¯æœ€ä¸‹çš„ä¸€å±‚ç›’å­ä¸ªæ•°ä¸ç¡®å®šæ‰€ä»¥margin-bottom,å°±æ²¡åŠæ³•æ­£ç¡®çš„è®¾ç½®<br>æ‰€ä»¥å°±ä¼šç”¨åˆ°cssçš„çº§è”ä½¿ç”¨ï¼Œæ–¹æ³•çœ‹å¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">...  // ä»£ç è·Ÿä¸Šé¢çš„ä¸€è‡´ï¼Œå»é™¤UIéƒ¨åˆ†</span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">li</span><span class="selector-pseudo">:nth-child(3n)</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">li</span><span class="selector-pseudo">:nth-child(3n+1)</span><span class="selector-pseudo">:nth-last-child(-n+3)</span>, <span class="selector-class">.box</span> <span class="selector-tag">li</span><span class="selector-pseudo">:nth-child(3n+1)</span><span class="selector-pseudo">:nth-last-child(-n+3)</span> ~ <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="gridå¸ƒå±€"><a href="#gridå¸ƒå±€" class="headerlink" title="gridå¸ƒå±€"></a>gridå¸ƒå±€</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"> <span class="selector-class">.grid</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-rows</span>: <span class="number">100px</span> <span class="number">100px</span> <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="number">100px</span> <span class="number">100px</span> <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.grid</span> &gt; <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">4px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#6a8bad</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.grid</span> &gt; <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: red;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">    <span class="comment">/*z-index:-2;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯ä¸è¦å†ç»™liå­é¡¹è®¾ç½®å®½åº¦å’Œé«˜åº¦ã€‚<br>è¯¥gridå¸ƒå±€ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨hoveræ—¶æ·»åŠ z-index:2;æ¥æé«˜å åŠ ç­‰çº§,ä¸ç„¶æ²¡åŠæ³•å±•ç¤ºå…¨éƒ¨</p><h3 id="flexå¸ƒå±€"><a href="#flexå¸ƒå±€" class="headerlink" title="flexå¸ƒå±€"></a>flexå¸ƒå±€</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.flex</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">312px</span>;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">margin</span>: -<span class="number">4px</span> <span class="number">0</span> <span class="number">0</span> -<span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.flex</span> &gt; <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">146</span>, <span class="number">203</span>, <span class="number">230</span>, <span class="number">0.65</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.flex</span> &gt; <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="comment">/*z-index:2;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arrayçš„æ–¹æ³•ç®€å•æ•´ç†</title>
      <link href="/2018/01/17/workspace/Js/array/"/>
      <url>/2018/01/17/workspace/Js/array/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Arrayçš„æ–¹æ³•ç®€å•æ•´ç†</strong></p><p>[[toc]]</p><h3 id="å¿«é€Ÿç”Ÿæˆä¸€ä¸ªæ•°ç»„"><a href="#å¿«é€Ÿç”Ÿæˆä¸€ä¸ªæ•°ç»„" class="headerlink" title="å¿«é€Ÿç”Ÿæˆä¸€ä¸ªæ•°ç»„"></a>å¿«é€Ÿç”Ÿæˆä¸€ä¸ªæ•°ç»„</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¿«é€Ÿç”Ÿæˆä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="built_in">Array</span>.from(<span class="built_in">Array</span>(<span class="number">100</span>), (key, index) =&gt; index);</span><br><span class="line"></span><br><span class="line">[...new <span class="built_in">Array</span>(<span class="number">100</span>).keys()]</span><br><span class="line"></span><br><span class="line"> <span class="built_in">Array</span>(<span class="number">3</span>).fill(<span class="string">''</span>); <span class="comment">//["", "", ""]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">10</span>).fill(&#123;&#125;).map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> &#123;</span><br><span class="line">    title:<span class="string">"æ˜é‡‘ä¼šå‘˜"</span>,</span><br><span class="line">    createtime:<span class="string">"2020-05-03"</span>,</span><br><span class="line">    state:<span class="number">1</span>,</span><br><span class="line">    price:<span class="number">19.8</span>,</span><br><span class="line">    timeNum:<span class="number">12</span>,</span><br><span class="line">    userName:<span class="string">"è™å…‹å°å“¥å“¥"</span>,</span><br><span class="line">    age:<span class="number">18</span>,</span><br><span class="line">    city:<span class="string">"ä¸Šæµ·"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€’å½’</span></span><br><span class="line"><span class="keyword">let</span> arr = [];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">dfs</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (i &lt; <span class="number">100</span>) &#123;</span><br><span class="line">    arr.push(i);</span><br><span class="line">    dfs(++i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>(<span class="number">100</span>).join(<span class="string">","</span>).split(<span class="string">","</span>).map(<span class="function">(<span class="params">key,index</span>)=&gt;</span> index)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.apply(<span class="literal">null</span>,<span class="built_in">Array</span>(<span class="number">100</span>)).map(<span class="function">(<span class="params">key,index</span>)=&gt;</span>index)</span><br></pre></td></tr></table></figure><h3 id="some-amp-every"><a href="#some-amp-every" class="headerlink" title="some() &amp; every()"></a>some() &amp; every()</h3><p>every()ä¸some()æ–¹æ³•éƒ½æ˜¯JSä¸­æ•°ç»„çš„è¿­ä»£æ–¹æ³•ã€‚</p><p><code>some()æ˜¯å¯¹æ•°ç»„ä¸­æ¯ä¸€é¡¹è¿è¡Œç»™å®šå‡½æ•°ï¼Œå¦‚æœè¯¥å‡½æ•°å¯¹ä»»ä¸€é¡¹è¿”å›trueï¼Œåˆ™è¿”å›true;someä¸€ç›´åœ¨æ‰¾ç¬¦åˆæ¡ä»¶çš„å€¼ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œåˆ™ä¸ä¼šç»§ç»­è¿­ä»£ä¸‹å»ã€‚</code></p><p><code>every()æ˜¯å¯¹æ•°ç»„ä¸­æ¯ä¸€é¡¹è¿è¡Œç»™å®šå‡½æ•°ï¼Œå¦‚æœè¯¥å‡½æ•°å¯¹æ¯ä¸€é¡¹è¿”å›true,åˆ™è¿”å›true;everyä»è¿­ä»£å¼€å§‹ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶ï¼Œåˆ™ä¸ä¼šç»§ç»­è¿­ä»£ä¸‹å»ã€‚</code></p><img style="border: .3em solid #e0dfcc;border-radius: 1em;widthï¼š98%"  src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H1f23b6d819f24380a396fd15d5ed914dA.png"><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a>reduce()</h3><ul><li><p>reducer å‡½æ•°æ¥æ”¶4ä¸ªå‚æ•°:</p><ul><li><p>Accumulator (acc) (ç´¯è®¡å™¨,æ²¡æœ‰è¿”å›å€¼ä¸ºundefined)</p></li><li><p>CurrentValue (cur) (å½“å‰å€¼)</p></li><li><p>CurrentIndex (idx) (å½“å‰ç´¢å¼•)</p></li><li><p>SourceArray (ary) (åŸæ•°ç»„)</p></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arr.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">Accumulator,CurrentValue,CurrentIndex,SourceArray</span>)</span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;, init);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ±‚æ•°ç»„é¡¹ä¹‹å’Œ</span></span><br><span class="line"><span class="keyword">var</span> sum = arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">prev, cur</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> prev + cur;</span><br><span class="line">&#125;,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ±‚æ•°ç»„é¡¹æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">var</span> max = arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">prev, cur</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.max(prev,cur);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.max(...arr);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ•°ç»„å»é‡</span></span><br><span class="line"><span class="keyword">var</span> newArr = arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">prev, cur</span>) </span>&#123;</span><br><span class="line">    prev.indexOf(cur) === <span class="number">-1</span> &amp;&amp; prev.push(cur);</span><br><span class="line">    <span class="keyword">return</span> prev;</span><br><span class="line">&#125;,[]);</span><br></pre></td></tr></table></figure><h3 id="isArray"><a href="#isArray" class="headerlink" title="isArray()"></a>isArray()</h3><p>Array.isArray() ç”¨äºç¡®å®šä¼ é€’çš„å€¼æ˜¯å¦æ˜¯ä¸€ä¸ª Arrayã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.isArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.isArray(&#123;<span class="attr">foo</span>: <span class="number">123</span>&#125;);  <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dom1 =  <span class="built_in">document</span>.getElementsByClassName(<span class="string">'token'</span>)</span><br><span class="line"><span class="built_in">Array</span>.isArray(dom1);  <span class="comment">//false</span></span><br><span class="line"><span class="built_in">Array</span>.isArray([...dom1]);  <span class="comment">//true</span></span><br><span class="line"><span class="built_in">Array</span>.isArray(<span class="built_in">Array</span>.from(dom1));  <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><code>Array.isArray å®ç°</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.myIsArray = <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">Object</span>(o)) === <span class="string">'[object Array]'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.myIsArray([])); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="slice"><a href="#slice" class="headerlink" title="slice()"></a>slice()</h3><p><strong>è¯·æ³¨æ„:</strong> è¯¥æ–¹æ³•å¹¶<code>ä¸ä¼šä¿®æ”¹æ•°ç»„</code>ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªå­æ•°ç»„ã€‚å¦‚æœæƒ³åˆ é™¤æ•°ç»„ä¸­çš„ä¸€æ®µå…ƒç´ ï¼Œåº”è¯¥ä½¿ç”¨æ–¹æ³• Array.splice()ã€‚</p><ul><li>arr.slice(begin ,end?)<ul><li>ï¼ˆåŒ…å« beginï¼Œä½†ä¸åŒ…å« endï¼‰ã€‚</li><li>slice(1,4) ä¼šæå–åŸæ•°ç»„ä¸­ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹ä¸€ç›´åˆ°ç¬¬å››ä¸ªå…ƒç´ çš„æ‰€æœ‰å…ƒç´  ï¼ˆç´¢å¼•ä¸º 1, 2, 3çš„å…ƒç´ ï¼‰ã€‚</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> animals = [<span class="string">'ant'</span>, <span class="string">'bison'</span>, <span class="string">'camel'</span>, <span class="string">'duck'</span>, <span class="string">'elephant'</span>];</span><br><span class="line"><span class="comment">//[].slice.call(animals,1,3)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(animals.slice(<span class="number">2</span>));</span><br><span class="line"><span class="comment">// expected output: Array ["camel", "duck", "elephant"]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(animals.slice(<span class="number">2</span>, <span class="number">4</span>));</span><br><span class="line"><span class="comment">// expected output: Array ["camel", "duck"]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(animals.slice(<span class="number">1</span>, <span class="number">5</span>));</span><br><span class="line"><span class="comment">// expected output: Array ["bison", "camel", "duck", "elephant"]</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//sliceçš„å†…éƒ¨å®ç°</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.slice = <span class="function"><span class="keyword">function</span>(<span class="params">start,end</span>)</span>&#123; </span><br><span class="line">      <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>(); </span><br><span class="line">      start = start || <span class="number">0</span>; </span><br><span class="line">      end = end || <span class="keyword">this</span>.length; <span class="comment">//thisæŒ‡å‘è°ƒç”¨çš„å¯¹è±¡ï¼Œå½“ç”¨äº†callåï¼Œèƒ½å¤Ÿæ”¹å˜thisçš„æŒ‡å‘ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘ä¼ è¿›æ¥çš„å¯¹è±¡ï¼Œè¿™æ˜¯å…³é”® </span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> i = start; i &lt; end; i++)&#123; </span><br><span class="line">           result.push(<span class="keyword">this</span>[i]); </span><br><span class="line">      &#125; </span><br><span class="line">      <span class="keyword">return</span> result; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="splice"><a href="#splice" class="headerlink" title="splice()"></a>splice()</h3><p><code>splice()</code> æ–¹æ³•é€šè¿‡åˆ é™¤æˆ–æ›¿æ¢ç°æœ‰å…ƒç´ æˆ–è€…åŸåœ°æ·»åŠ æ–°çš„å…ƒç´ æ¥ä¿®æ”¹æ•°ç»„,å¹¶ä»¥æ•°ç»„å½¢å¼è¿”å›è¢«ä¿®æ”¹çš„å†…å®¹ã€‚æ­¤æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ã€‚</p><p><strong>åˆ é™¤</strong></p><p>ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>åˆ é™¤çš„ä¸ªæ•°</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ary =[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"><span class="comment">//[].splice.call(ary,1,1)</span></span><br><span class="line">ary.splice(<span class="number">1</span>,<span class="number">1</span>);   <span class="comment">// è¿”å›åˆ é™¤çš„ä¸€é¡¹ [2]</span></span><br><span class="line">ary  <span class="comment">//[1, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure><p><strong>æ’å…¥</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ary =[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">ary.splice(<span class="number">2</span>, <span class="number">0</span>, <span class="string">"7"</span>);   <span class="comment">//[], æ²¡æœ‰å…ƒç´ è¢«åˆ é™¤</span></span><br><span class="line">ary  <span class="comment">//[1, 2, "7", 3, 4, 5, 6]</span></span><br><span class="line"></span><br><span class="line">ary.splice(<span class="number">2</span>, <span class="number">0</span>, <span class="string">"9"</span>,<span class="string">'10'</span>,<span class="number">11</span>,<span class="number">12</span>)</span><br><span class="line">ary  <span class="comment">//[1, 2, "9", "10", 11, 12, "7", 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤ &amp; æ’å…¥</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myFish = [<span class="string">'angel'</span>, <span class="string">'clown'</span>, <span class="string">'trumpet'</span>, <span class="string">'sturgeon'</span>];</span><br><span class="line">myFish.splice(<span class="number">0</span>, <span class="number">2</span>, <span class="string">'parrot'</span>, <span class="string">'anemone'</span>, <span class="string">'blue'</span>); <span class="comment">//["angel", "clown"]</span></span><br><span class="line">myFish  <span class="comment">//["parrot", "anemone", "blue", "trumpet", "sturgeon"]</span></span><br></pre></td></tr></table></figure><h3 id="filter-å®ç°"><a href="#filter-å®ç°" class="headerlink" title="filter() å®ç°"></a>filter() å®ç°</h3><p>filter() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ–°æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯é€šè¿‡æ£€æŸ¥æŒ‡å®šæ•°ç»„ä¸­ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰å…ƒç´ ã€‚</p><p>æ³¨æ„ï¼š filter() ä¸ä¼šå¯¹ç©ºæ•°ç»„è¿›è¡Œæ£€æµ‹ã€‚</p><p>æ³¨æ„ï¼š filter() ä¸ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚</p><p><strong>è¯­æ³•</strong></p><p>array.filter(function(currentValue,index,arr), thisValue)</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.selfFilter = <span class="function"><span class="keyword">function</span>(<span class="params">callback, context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸èƒ½æ˜¯nullè°ƒç”¨æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(</span><br><span class="line">      <span class="string">"Array.prototype.reduce"</span> + <span class="string">"called on null or undefined"</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»è¦ä¸ºfunction</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">"function"</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(callback + <span class="string">" is not a function"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è·å–æ•°ç»„</span></span><br><span class="line">  <span class="keyword">let</span> aArr = <span class="built_in">Array</span>.prototype.slice.call(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">let</span> _len = aArr.length;</span><br><span class="line">  <span class="keyword">let</span> aFArr = [];</span><br><span class="line">  <span class="comment">// å¾ªç¯è°ƒç”¨callback</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; _len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!aArr.hasOwnProperty(i)) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    callback.call(context, aArr[i], i, <span class="keyword">this</span>) &amp;&amp; aFArr.push(aArr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> aFArr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Map-Set-WeakMap-WeakSet"><a href="#Map-Set-WeakMap-WeakSet" class="headerlink" title="Map + Set + WeakMap + WeakSet"></a>Map + Set + WeakMap + WeakSet</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Sets</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">s.add(<span class="string">"hello"</span>).add(<span class="string">"goodbye"</span>).add(<span class="string">"hello"</span>);</span><br><span class="line">s.size === <span class="number">2</span>;</span><br><span class="line">s.has(<span class="string">"hello"</span>) === <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Weak Sets </span></span><br><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br><span class="line">ws.add(&#123; <span class="attr">data</span>: <span class="number">42</span> &#125;); <span class="comment">//åªèƒ½æ˜¯å¯¹è±¡ï¼ˆnullé™¤å¤–ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Maps</span></span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">m.set(<span class="string">"hello"</span>, <span class="number">42</span>);</span><br><span class="line">m.set(s, <span class="number">34</span>);</span><br><span class="line">m.get(s) == <span class="number">34</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Weak Maps</span></span><br><span class="line"><span class="keyword">var</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>(); </span><br><span class="line">wm.set(s, &#123; <span class="attr">extra</span>: <span class="number">42</span> &#125;);<span class="comment">//åªæ¥å—å¯¹è±¡ä½œä¸ºé”®åï¼ˆnullé™¤å¤–ï¼‰</span></span><br><span class="line">wm.size === <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><img style="border-radius: 4px;width:49%"  src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H98fdbfe7a328477cae2506f4f3346bd1G.png"><img style="border-radius: 4px;width:49%"  src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Ha1b8b3b1e2db46e6926de265813c5cd3Z.png"><h3 id="æ•°ç»„å»é‡"><a href="#æ•°ç»„å»é‡" class="headerlink" title="æ•°ç»„å»é‡"></a>æ•°ç»„å»é‡</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ•°ç»„å»é‡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(fn, []);</span><br><span class="line">&#125;</span><br><span class="line">unique([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">6</span>], <span class="function"><span class="keyword">function</span>(<span class="params">arr, item</span>) </span>&#123;</span><br><span class="line">  !arr.includes(item) &amp;&amp; arr.push(item);</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="forEachä¸­returnæœ‰æ•ˆæœå—ï¼Ÿå¦‚ä½•ä¸­æ–­forEachå¾ªç¯ï¼Ÿ"><a href="#forEachä¸­returnæœ‰æ•ˆæœå—ï¼Ÿå¦‚ä½•ä¸­æ–­forEachå¾ªç¯ï¼Ÿ" class="headerlink" title="forEachä¸­returnæœ‰æ•ˆæœå—ï¼Ÿå¦‚ä½•ä¸­æ–­forEachå¾ªç¯ï¼Ÿ"></a>forEachä¸­returnæœ‰æ•ˆæœå—ï¼Ÿå¦‚ä½•ä¸­æ–­forEachå¾ªç¯ï¼Ÿ</h3><p>åœ¨forEachä¸­ç”¨returnä¸ä¼šè¿”å›ï¼Œå‡½æ•°ä¼šç»§ç»­æ‰§è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">nums.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span>;<span class="comment">//æ— æ•ˆ</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ä¸­æ–­æ–¹æ³•ï¼š</strong></p><p>(1). ä½¿ç”¨tryç›‘è§†ä»£ç å—ï¼Œåœ¨éœ€è¦ä¸­æ–­çš„åœ°æ–¹æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>(2). å®˜æ–¹æ¨èæ–¹æ³•ï¼ˆæ›¿æ¢æ–¹æ³•ï¼‰ï¼šç”¨everyå’Œsomeæ›¿ä»£forEachå‡½æ•°ã€‚everyåœ¨ç¢°åˆ°return falseçš„æ—¶å€™ï¼Œä¸­æ­¢å¾ªç¯ã€‚someåœ¨ç¢°åˆ°return trueçš„æ—¶å€™ï¼Œä¸­æ­¢å¾ªç¯</p><h3 id="jså°†å¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„"><a href="#jså°†å¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„" class="headerlink" title="jså°†å¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„"></a>jså°†å¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, [<span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>]]]]</span><br><span class="line"><span class="built_in">console</span>.log(arr.join())   <span class="comment">// è¾“å‡ºä¸ºï¼š1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newArr = arr.join().split(<span class="string">','</span>)</span><br><span class="line"><span class="keyword">let</span> newArr = arr.toString().split(<span class="string">','</span>)</span><br><span class="line"><span class="keyword">let</span> newArr = (arr + <span class="string">''</span>).split(<span class="string">','</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(newArr) <span class="comment">// è¾“å‡ºä¸ºï¼š["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16"]</span></span><br></pre></td></tr></table></figure><p><strong>é€’å½’</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, [<span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>]]]]</span><br><span class="line"><span class="keyword">let</span> newArr = [] <span class="comment">// å­˜æ”¾è½¬åŒ–åçš„ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arrConversion</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(arr[i])) &#123;</span><br><span class="line">      arrConversion(arr[i])</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      newArr.push(arr[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">arrConversion(arr)</span><br><span class="line"><span class="built_in">console</span>.log(newArr)</span><br></pre></td></tr></table></figure><p><strong>flat</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span> ,[<span class="number">2</span>, <span class="number">3</span>]].flat()); <span class="comment">// [1, 2, 3]</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// æŒ‡å®šè½¬æ¢çš„åµŒå¥—å±‚æ•°</span></span><br><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>]]]].flat(<span class="number">2</span>)); <span class="comment">// [1, 2, 3, [4, 5]]</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// ä¸ç®¡åµŒå¥—å¤šå°‘å±‚</span></span><br><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>]]]].flat(<span class="literal">Infinity</span>)); <span class="comment">// [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure><p><strong>æ­£åˆ™</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> ary = [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>]]], <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> str = <span class="built_in">JSON</span>.stringify(ary);</span><br><span class="line"><span class="keyword">let</span> result = str.replace(<span class="regexp">/(\[|\])/g</span>, <span class="string">''</span>).split(<span class="string">','</span>);</span><br><span class="line"><span class="built_in">console</span>.log( result )</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„å¿«é€Ÿéšæœºæ’åº"><a href="#æ•°ç»„å¿«é€Ÿéšæœºæ’åº" class="headerlink" title="æ•°ç»„å¿«é€Ÿéšæœºæ’åº"></a>æ•°ç»„å¿«é€Ÿéšæœºæ’åº</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr =[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"><span class="comment">//æ–¹æ³•ä¸€</span></span><br><span class="line"><span class="keyword">let</span> t;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; arr.length; i++)&#123;</span><br><span class="line">  <span class="keyword">let</span> rand = <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random()*arr.length);</span><br><span class="line">     t = arr[rand];</span><br><span class="line">     arr[rand] =arr[i];</span><br><span class="line">     arr[i] = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ–¹æ³•äºŒ</span></span><br><span class="line">arr.sort(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.random() - <span class="number">0.5</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„æ’åº"><a href="#æ•°ç»„æ’åº" class="headerlink" title="æ•°ç»„æ’åº"></a>æ•°ç»„æ’åº</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selectSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = arr.length;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ;i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j = i ; j&lt;len; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[j] &lt; arr[i]) &#123;</span><br><span class="line">                [arr[i],arr[j]] = [arr[j],arr[i]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quickSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(arr.length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr;  <span class="comment">//é€’å½’å‡ºå£</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> left = [],</span><br><span class="line">        right = [],</span><br><span class="line">        current = arr.splice(<span class="number">0</span>,<span class="number">1</span>); </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i] &lt; current) &#123;</span><br><span class="line">            left.push(arr[i])  <span class="comment">//æ”¾åœ¨å·¦è¾¹</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right.push(arr[i]) <span class="comment">//æ”¾åœ¨å³è¾¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> quickSort(left).concat(current,quickSort(right));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦æœ‰é‡å¤å…ƒç´ "><a href="#åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦æœ‰é‡å¤å…ƒç´ " class="headerlink" title="åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦æœ‰é‡å¤å…ƒç´ "></a>åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦æœ‰é‡å¤å…ƒç´ </h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isRepeat</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] === arr[j]) &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> flag</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isRepeat</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">   obj[arr[i]] = arr[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.keys(obj).length !== arr.length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ±‚ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­æ²¡æœ‰ç¬¬äºŒä¸ªæ•°ç»„ä¸­éƒ¨åˆ†çš„å€¼"><a href="#æ±‚ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­æ²¡æœ‰ç¬¬äºŒä¸ªæ•°ç»„ä¸­éƒ¨åˆ†çš„å€¼" class="headerlink" title="æ±‚ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­æ²¡æœ‰ç¬¬äºŒä¸ªæ•°ç»„ä¸­éƒ¨åˆ†çš„å€¼"></a>æ±‚ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­æ²¡æœ‰ç¬¬äºŒä¸ªæ•°ç»„ä¸­éƒ¨åˆ†çš„å€¼</h3><p><strong>å·®é›†</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">differenceSecond</span>(<span class="params">ary1,ary2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = []</span><br><span class="line">    ary1.filter(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">      !ary2.includes(item)&amp;&amp;arr.push(item)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">differenceSecond</span>(<span class="params">m, n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = [...m, ...n];</span><br><span class="line">  <span class="keyword">let</span> b = n;</span><br><span class="line">  <span class="keyword">let</span> aHasNaN = m.some(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">isNaN</span>(v);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> bHasNaN = n.some(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">isNaN</span>(v);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> difference = a</span><br><span class="line">    .filter(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> b.indexOf(v) == <span class="number">-1</span> &amp;&amp; !<span class="built_in">isNaN</span>(v);</span><br><span class="line">    &#125;)</span><br><span class="line">    .concat(</span><br><span class="line">      b.filter(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.indexOf(v) == <span class="number">-1</span> &amp;&amp; !<span class="built_in">isNaN</span>(v);</span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">    .concat(aHasNaN ^ bHasNaN ? [<span class="literal">NaN</span>] : []);</span><br><span class="line">  <span class="keyword">return</span> difference;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="noopener">MDN ARRAY</a></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
          <category> Arrayçš„æ–¹æ³•ç®€å•æ•´ç† </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Stringçš„æ–¹æ³•ç®€å•æ•´ç†</title>
      <link href="/2018/01/17/workspace/Js/string/"/>
      <url>/2018/01/17/workspace/Js/string/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Stringçš„æ–¹æ³•ç®€å•æ•´ç†</strong></p><p>[[toc]]</p><h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><h4 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf()"></a><code>indexOf()</code></h4><ul><li>str.indexOf(searchValue, fromIndex?)<ul><li>æ–¹æ³•è¿”å›è°ƒç”¨å®ƒçš„ String å¯¹è±¡ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå€¼çš„ç´¢å¼•ï¼Œä» fromIndex å¤„è¿›è¡Œæœç´¢ã€‚å¦‚æœæœªæ‰¾åˆ°è¯¥å€¼ï¼Œåˆ™è¿”å› -1ã€‚</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;Blue&quot;);     &#x2F;&#x2F; è¿”å›  0</span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;Blute&quot;);    &#x2F;&#x2F; è¿”å› -1</span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;Whale&quot;, 0); &#x2F;&#x2F; è¿”å›  5</span><br><span class="line"></span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;Whale&quot;, 5); &#x2F;&#x2F; è¿”å›  5</span><br><span class="line"></span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;&quot;, -1);     &#x2F;&#x2F; è¿”å› 0</span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;&quot;, 9);      &#x2F;&#x2F; è¿”å›  9</span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;&quot;, 10);     &#x2F;&#x2F; è¿”å› 10</span><br><span class="line"></span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;&quot;, 11);     &#x2F;&#x2F; è¿”å› 10  </span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨</span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;Blue&quot;) !&#x3D;&#x3D; -1; &#x2F;&#x2F; true</span><br><span class="line">&quot;Blue Whale&quot;.indexOf(&quot;Bloe&quot;) !&#x3D;&#x3D; -1; &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure><h4 id="substring"><a href="#substring" class="headerlink" title="substring()"></a><code>substring()</code></h4><ul><li>è¿”å›è¢«æˆªå–çš„å­—ç¬¦ä¸²ï¼Œä¸æ”¹å˜åŸæ¥çš„ï¼Œä¼ å…¥å‚æ•°æ˜¯<strong>èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®</strong>ã€‚(ä¸åŒ…å«ç»“æŸä½ç½®)</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str=<span class="string">'hzf'</span>;</span><br><span class="line">str.substring(<span class="number">1</span>)<span class="comment">//zf</span></span><br></pre></td></tr></table></figure><h4 id="substr"><a href="#substr" class="headerlink" title="substr()"></a><code>substr()</code></h4><ul><li>è¿”å›è¢«æˆªå–çš„å­—ç¬¦ä¸²ï¼Œä¸æ”¹å˜åŸæ¥çš„ï¼Œï¼Œä¼ å…¥å‚æ•°æ˜¯<strong>èµ·å§‹ä½ç½®å’Œè¦æˆªå–çš„é•¿åº¦</strong></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str=<span class="string">'hzf'</span>;</span><br><span class="line">str.substring(<span class="number">1</span>,<span class="number">1</span>)<span class="comment">//z</span></span><br></pre></td></tr></table></figure><h4 id="slice"><a href="#slice" class="headerlink" title="slice()"></a><code>slice()</code></h4><ul><li>è·Ÿ <code>substring()</code>ç”¨æˆ·ç›¸åŒ</li><li>å½“ä¸ºè´Ÿå€¼çš„æ—¶å€™ä¸åŒï¼Œè¿˜æ˜¯çœ‹ä¾‹å­å§</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a =  <span class="string">'abcdefg'</span> </span><br><span class="line"></span><br><span class="line">a.slice(<span class="number">1</span>,<span class="number">-1</span>) <span class="comment">//"bcdef"  ç›¸å½“äº a.slice(1, a.length-1 )   æœ‰è´Ÿå€¼ç»Ÿä¸€ç”¨lengthå‡å»å½“å‰çš„è´Ÿå€¼æ¥æˆªå–</span></span><br><span class="line">a.substring(<span class="number">1</span>,<span class="number">-1</span>) <span class="comment">//a    ç›¸å½“äº a.substring(0,1) å‚æ•°æœ€å°ä¸º0ï¼Œå°äº0è‡ªåŠ¨é»˜è®¤ä¸º0ï¼Œå‚æ•°å°çš„ä¸ºç¬¬ä¸€ä¸ªå‚æ•°</span></span><br></pre></td></tr></table></figure><ul><li><code>toLowerCase()</code> å°†æ•´ä¸ªå­—ç¬¦ä¸²è½¬æˆå°å†™å­—æ¯ã€‚</li><li><code>toUpperCase()</code> å°†æ•´ä¸ªå­—ç¬¦ä¸²è½¬æˆå¤§å†™å­—æ¯ã€‚</li></ul><h3 id="Es6æ–°æ–¹æ³•"><a href="#Es6æ–°æ–¹æ³•" class="headerlink" title="Es6æ–°æ–¹æ³•"></a>Es6æ–°æ–¹æ³•</h3><h4 id="padStart"><a href="#padStart" class="headerlink" title="padStart()"></a>padStart()</h4><ul><li>ES2017 å¼•å…¥äº†å­—ç¬¦ä¸²è¡¥å…¨é•¿åº¦çš„åŠŸèƒ½ã€‚å¦‚æœæŸä¸ªå­—ç¬¦ä¸²ä¸å¤ŸæŒ‡å®šé•¿åº¦ï¼Œä¼šåœ¨å¤´éƒ¨æˆ–å°¾éƒ¨è¡¥å…¨ã€‚<ul><li><code>padStart()</code>ç”¨äºå¤´éƒ¨è¡¥å…¨ï¼Œ<code>padEnd()</code>ç”¨äºå°¾éƒ¨è¡¥å…¨ã€‚padStart()å’ŒpadStart()ä¸€å…±æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šå­—ç¬¦ä¸²çš„æœ€å°é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥è¡¥å…¨çš„å­—ç¬¦ä¸²ã€‚</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¿…é¡»æ˜¯å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="string">'abc'</span>.padStart(<span class="number">10</span>, <span class="string">'0123456789'</span>)  <span class="comment">//"0123456abc"</span></span><br></pre></td></tr></table></figure><h4 id="trim"><a href="#trim" class="headerlink" title="trim()"></a>trim()</h4><ul><li><code>trim()</code>æ˜¯ä¸¤è¾¹çš„ç©ºæ ¼ <code>trimStart()</code>æ¶ˆé™¤å­—ç¬¦ä¸²å¤´éƒ¨çš„ç©ºæ ¼ï¼Œ<code>trimEnd()</code>æ¶ˆé™¤å°¾éƒ¨çš„ç©ºæ ¼</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="string">'  abc  '</span>;</span><br><span class="line"></span><br><span class="line">s.trim() <span class="comment">// "abc"</span></span><br><span class="line">s.trimStart() <span class="comment">// "abc  "</span></span><br><span class="line">s.trimEnd() <span class="comment">// "  abc"</span></span><br></pre></td></tr></table></figure><h4 id="repeat"><a href="#repeat" class="headerlink" title="repeat()"></a>repeat()</h4><ul><li><code>repeat(n)</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†åŸå­—ç¬¦ä¸²é‡å¤næ¬¡ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">'x'</span>.repeat(<span class="number">3</span>) <span class="comment">// "xxx"</span></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="number">2.9</span>) <span class="comment">// "nana"</span></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="literal">Infinity</span>)<span class="comment">// RangeError</span></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="number">-0.9</span>) <span class="comment">// ""</span></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="literal">NaN</span>) <span class="comment">// ""</span></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="string">'3'</span>) <span class="comment">// "nanana"</span></span><br></pre></td></tr></table></figure><h4 id="includes"><a href="#includes" class="headerlink" title="includes()"></a>includes()</h4><ul><li><strong>includes(), startsWith(), endsWith()</strong><ul><li><code>includes()</code>ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°äº†å‚æ•°å­—ç¬¦ä¸²ã€‚</li><li><code>startsWith()</code>ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å¤´éƒ¨ã€‚</li><li><code>endsWith()</code>ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å°¾éƒ¨ã€‚</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">'Hello world!'</span>;</span><br><span class="line"></span><br><span class="line">s.startsWith(<span class="string">'Hello'</span>) <span class="comment">// true</span></span><br><span class="line">s.endsWith(<span class="string">'!'</span>) <span class="comment">// true</span></span><br><span class="line">s.includes(<span class="string">'o'</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener">MDN STRING</a></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
          <category> Stringçš„æ–¹æ³•ç®€å•æ•´ç† </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Dvaå°è£…</title>
      <link href="/2018/01/17/workspace/Frame/react/dva/"/>
      <url>/2018/01/17/workspace/Frame/react/dva/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Dvaå°è£…</strong></p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createStore,combineReducers,applyMiddleware&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Provider,connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">'redux-saga'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> effects <span class="keyword">from</span> <span class="string">'redux-saga/effects'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createHashHistory&#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">const</span> NAMESPACE_SEPERATOR = <span class="string">'/'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    connect</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> app = &#123;</span><br><span class="line">        model,</span><br><span class="line">        _models:[],</span><br><span class="line">        router,</span><br><span class="line">        _router:<span class="literal">null</span>,</span><br><span class="line">        start</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">model</span>(<span class="params">model</span>)</span>&#123;</span><br><span class="line">        app._models.push(model);<span class="comment">//æŠŠä¼ å…¥çš„modelå­˜æ”¾èµ·æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">router</span>(<span class="params">routeConfig</span>)</span>&#123;</span><br><span class="line">        app._router = routeConfig;<span class="comment">//æŠŠè·¯ç”±çš„é…ç½®æš‚å­˜èµ·æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params">root</span>)</span>&#123;<span class="comment">//å¯åŠ¨æ¸²æŸ“</span></span><br><span class="line">        <span class="keyword">let</span> reducers = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> model <span class="keyword">of</span> app._models)&#123;</span><br><span class="line">            reducers[model.namespace] = <span class="function"><span class="keyword">function</span>(<span class="params">state=model.state,action</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> actionType = action.type;<span class="comment">//è·å–åŠ¨ä½œç±»å‹ counter/add  ['counter','add']</span></span><br><span class="line">                <span class="keyword">let</span> values = actionType.split(NAMESPACE_SEPERATOR);</span><br><span class="line">                <span class="keyword">if</span>(values[<span class="number">0</span>] == model.namespace)&#123;<span class="comment">//å¦‚æœè¯´å‘½åç©ºé—´çš„åå­—å’ŒåŠ¨ä½œå‘½åç©ºé—´ä¸€æ ·çš„è¯</span></span><br><span class="line">                    <span class="keyword">let</span> reducer = model.reducers[values[<span class="number">1</span>]];<span class="comment">//è·å–è¦è¿›è¡Œè®¡ç®—çŠ¶æ€çš„reducer</span></span><br><span class="line">                    <span class="keyword">if</span>(reducer)</span><br><span class="line">                      <span class="keyword">return</span> reducer(state,action);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> reducer = combineReducers(reducers);<span class="comment">//åˆå¹¶reducers</span></span><br><span class="line">        <span class="keyword">let</span> sagaMiddleware = createSagaMiddleware();</span><br><span class="line">        <span class="function"><span class="keyword">function</span>* <span class="title">rootSaga</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">const</span> model <span class="keyword">of</span> app._models)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">in</span> model.effects)&#123;</span><br><span class="line">                    <span class="keyword">yield</span> effects.takeEvery(<span class="string">`<span class="subst">$&#123;model.namespace&#125;</span><span class="subst">$&#123;NAMESPACE_SEPERATOR&#125;</span><span class="subst">$&#123;key&#125;</span>`</span>,model.effects[key],effects);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> store = createStore(reducer,applyMiddleware(sagaMiddleware));<span class="comment">//åˆ›å»ºä»“åº“</span></span><br><span class="line">        sagaMiddleware.run(rootSaga);</span><br><span class="line">        <span class="keyword">const</span> history = createHashHistory();</span><br><span class="line">        <span class="keyword">let</span> App = app._router(&#123;app,history&#125;);<span class="comment">//è·å–è¦æ¸²æŸ“çš„ç»„ä»¶</span></span><br><span class="line">        ReactDOM.render(<span class="comment">//æ‰§è¡Œæ¸²æŸ“</span></span><br><span class="line">            &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">                &#123;App&#125;</span><br><span class="line">            &lt;<span class="regexp">/Provider&gt;,document.querySelector(root)</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    return app;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç®€å•ä½¿ç”¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;adminCharacters, adminCharactersDelete&#125; <span class="keyword">from</span> <span class="string">'src/api/admin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    namespace: <span class="string">'roleAdmin'</span>,</span><br><span class="line">    state: &#123;</span><br><span class="line">        dataSource: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    effects: &#123;</span><br><span class="line">        * fetchData (&#123;id&#125;, &#123;call, put, select&#125;) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;data&#125; = <span class="keyword">yield</span> call(adminCharacters);</span><br><span class="line">            <span class="keyword">yield</span> put(&#123;</span><br><span class="line">                type: <span class="string">'save'</span>,</span><br><span class="line">                payload: &#123;</span><br><span class="line">                    dataSource: data,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        * deleteData (&#123;id, cb&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;success&#125; = <span class="keyword">yield</span> call(adminCharactersDelete, id);</span><br><span class="line">            <span class="keyword">if</span> (success) &#123;</span><br><span class="line">                cb()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    reducers: &#123;</span><br><span class="line">        save(state, &#123;payload&#125;) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, ...payload&#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ReactåŸºæœ¬ç”¨æ³•</title>
      <link href="/2018/01/17/workspace/Frame/react/react/"/>
      <url>/2018/01/17/workspace/Frame/react/react/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ReactåŸºæœ¬ç”¨æ³•</strong></p><p>[[toc]]</p><h3 id="è·¯ç”±ä¼ é€’å‚æ•°"><a href="#è·¯ç”±ä¼ é€’å‚æ•°" class="headerlink" title="è·¯ç”±ä¼ é€’å‚æ•°"></a>è·¯ç”±ä¼ é€’å‚æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;Link to=&#123;&#123;</span><br><span class="line">        pathname:<span class="string">"/"</span>,</span><br><span class="line">        search:<span class="string">"?lx=1"</span>,</span><br><span class="line">        hash:<span class="string">"#AA"</span>,</span><br><span class="line">        state: &#123;<span class="attr">id</span>: id&#125; </span><br><span class="line">    &#125;&#125; exact &gt;</span><br><span class="line">     é¦–é¡µ</span><br><span class="line"> &lt;<span class="regexp">/Link&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>1.é—®å·ä¼ å‚  åŸºäºlocationæ¥å®Œæˆå¤„ç†  <strong>let {data, location: {<code>search</code>}} = this.props</strong> </p></li><li><p>2.åœ°å€æ ä¼ å‚åŸºäºmatchçš„paramsæ¥å®Œæˆå¤„ç† <strong>let {data, match: {<code>params</code>}} = this.prop</strong> </p></li><li><p>3.Linkä¼ å‚ å¾ªç¯è¿›æ¥çš„ï¼Œæ­¤å‚æ•°ä¼ å‚åœ¨æµè§ˆå™¨çœ‹ä¸è§  <strong>let {data, location: {<code>state</code>}} = this.props</strong> </p></li><li><p>å‚æ•°è§£æï¼ˆé—®å·ä¼ å‚ï¼‰</p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸¤ç§æ–¹å¼éƒ½è¡Œ</span></span><br><span class="line"><span class="keyword">const</span> utils = &#123;</span><br><span class="line">   queryURLParameter(url) &#123;</span><br><span class="line">        <span class="keyword">let</span> regParam = <span class="regexp">/([^?&amp;=#]+)=?([^?&amp;=#]+)?/ig</span>,</span><br><span class="line">            obj = &#123;&#125;;</span><br><span class="line">        url.replace(regParam, (...arg) =&gt; &#123;</span><br><span class="line">            obj[arg[<span class="number">1</span>]] = arg[<span class="number">2</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">   &#125;,</span><br><span class="line">   queryStringToJson(queryString) &#123;</span><br><span class="line">        <span class="keyword">if</span> (queryString.indexOf(<span class="string">'?'</span>) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">            queryString = queryString.split(<span class="string">'?'</span>)[<span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> pairs = queryString.split(<span class="string">'&amp;'</span>);</span><br><span class="line">        <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">        pairs.forEach(<span class="function"><span class="params">pair</span> =&gt;</span> &#123;</span><br><span class="line">            pair = pair.split(<span class="string">'='</span>);</span><br><span class="line">            result[pair[<span class="number">0</span>]] = <span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>] || <span class="string">''</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">   &#125;</span><br><span class="line">        </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> utils;</span><br></pre></td></tr></table></figure><h3 id="å‘èµ·-AJAX-è¯·æ±‚"><a href="#å‘èµ·-AJAX-è¯·æ±‚" class="headerlink" title="å‘èµ· AJAX è¯·æ±‚"></a>å‘èµ· AJAX è¯·æ±‚</h3><p>æˆ‘ä»¬åº”å½“å°†AJAX è¯·æ±‚æ”¾åˆ° <code>componentDidMount</code> å‡½æ•°ä¸­æ‰§è¡Œï¼Œä¸»è¦åŸå› æœ‰ä¸‹</p><ul><li><code>componentsDidMount</code>é‡Œé¢è¯·æ±‚æ•°æ®æ­¤æ—¶domå·²ç»æ¸²æŸ“ä¸Šå»ï¼Œä»ç”¨æˆ·å‹å¥½è§’åº¦æ¥è®²ï¼Œæˆ‘ä»¬æ›´æ„¿æ„è®©ç”¨æˆ·å…ˆçœ‹åˆ°ä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„æ–¹å¼ï¼Œå†é€šè¿‡ä¸€ä¸ªspinçš„åŠ¨ç”»ï¼Œæ¥åŠ è½½æ•°æ®;<code>componentsWillMount</code>é‡Œé¢è¯·æ±‚æ•°æ®ï¼Œæ‹¿åˆ°æ•°æ®ä¹‹åsetStateçš„æ—¶æœºæ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½æ˜¯renderä¹‹å‰ï¼Œä¹Ÿå¯èƒ½æ˜¯renderä¹‹åï¼Œå¹¶ä¸æ˜¯ä¸‹ä¸€ä¸ªæ—¶é—´æ®µï¼Œè¿™ä¾èµ–äºajaxçš„è¿”å›æ—¶é—´ï¼Œæ‰€ä»¥ä¸èƒ½å‡†æ—¶çš„å‡ºç°loadingå›¾ï¼Œæ‰€ä»¥è¯´ä¼šå‡ºç°è¾ƒé•¿ç™½å±çš„ç°è±¡.</li><li>è¿˜æœ‰åœ¨rnä¸­ï¼Œç”¨reactåšæœåŠ¡ç«¯çš„åŒæ„ï¼Œæˆ–è€…æ›´é«˜æŠ€æœ¯çš„æ—¶å€™ä¼šæœ‰ä¸€ç³»åˆ—çš„é—®é¢˜ã€componentWillMountæ—¶å‘ç”Ÿåœ¨æœåŠ¡ç«¯ componentDidMountåœ¨å®¢æˆ·ç«¯ï¼Œä¼šå†²çªã€‘ã€‚</li><li>React16 è°ƒå’Œç®—æ³•<code>Fiber</code>ä¼šé€šè¿‡å¼€å§‹æˆ–åœæ­¢æ¸²æŸ“çš„æ–¹å¼ä¼˜åŒ–åº”ç”¨æ€§èƒ½ï¼Œå…¶ä¼šå½±å“åˆ° <code>componentWillMount çš„è§¦å‘æ¬¡æ•°</code>ã€‚å¯¹äº componentWillMount è¿™ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ä¼šå˜å¾—ä¸ç¡®å®šï¼ŒReact å¯èƒ½ä¼šå¤šæ¬¡é¢‘ç¹è°ƒç”¨ componentWillMount</li></ul><h3 id="PropTypes"><a href="#PropTypes" class="headerlink" title="PropTypes"></a>PropTypes</h3><p><code>JavaScript æ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œæ‰€ä»¥è¯·å°½é‡å£°æ˜ propTypes å¯¹ props è¿›è¡Œæ ¡éªŒï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„é—®é¢˜ã€‚</code></p><p><strong><code>å†…ç½®çš„ prop type æœ‰ï¼š</code></strong></p><ul><li>PropTypes.array</li><li>PropTypes.bool</li><li>PropTypes.func</li><li>PropTypes.number</li><li>PropTypes.object</li><li>PropTypes.string</li><li>PropTypes.any</li><li>PropTypes.shape</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    a: <span class="number">0</span>,</span><br><span class="line">    b: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    a: PropTypes.number,</span><br><span class="line">    b: PropTypes.number,</span><br><span class="line">    store: PropTypes.shape(&#123;</span><br><span class="line">           subscribe: PropTypes.func.isRequired,</span><br><span class="line">           dispatch: PropTypes.func.isRequired,</span><br><span class="line">           getState: PropTypes.func.isRequired</span><br><span class="line">    &#125;),</span><br><span class="line">    data: PropTypes.array.isRequired<span class="comment">//å¿…é¡»æœ‰</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><a href="https://zh-hans.reactjs.org/docs/typechecking-with-proptypes.html" target="_blank" rel="noopener">æŸ¥çœ‹æ›´å¤š</a></p><h3 id="Hooksä¸ºä½•èƒ½ä½¿ç”¨const-åœ¨ä¸‹é¢å£°æ˜çš„å‡½æ•°"><a href="#Hooksä¸ºä½•èƒ½ä½¿ç”¨const-åœ¨ä¸‹é¢å£°æ˜çš„å‡½æ•°" class="headerlink" title="Hooksä¸ºä½•èƒ½ä½¿ç”¨const åœ¨ä¸‹é¢å£°æ˜çš„å‡½æ•°"></a>Hooksä¸ºä½•èƒ½ä½¿ç”¨const åœ¨ä¸‹é¢å£°æ˜çš„å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ€æƒ³</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> b();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶ä¼ é€’å‚æ•°"><a href="#ç»„ä»¶ä¼ é€’å‚æ•°" class="headerlink" title="ç»„ä»¶ä¼ é€’å‚æ•°"></a>ç»„ä»¶ä¼ é€’å‚æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//çˆ¶</span></span><br><span class="line">&lt;List onItem=&#123;(item) =&gt; <span class="keyword">this</span>.onItem(item)&#125;/&gt;</span><br><span class="line"><span class="comment">//å­</span></span><br><span class="line">&#123;list.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;styles.item&#125; key=&#123;index&#125;    </span><br><span class="line">     onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onItem(item)&#125;&gt;</span><br><span class="line">   )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//çˆ¶</span></span><br><span class="line">&lt;List onItem=&#123;<span class="keyword">this</span>.onItem&#125;/&gt;</span><br><span class="line"><span class="comment">//å­</span></span><br><span class="line">&#123;list.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;styles.item&#125; key=&#123;index&#125;    </span><br><span class="line">     onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onItem(item)&#125;&gt;</span><br><span class="line">   )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PureComponentåŸç†"><a href="#PureComponentåŸç†" class="headerlink" title="PureComponentåŸç†"></a>PureComponentåŸç†</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">shouldComponentUpdate: <span class="function">(<span class="params">nextProps = &#123;&#125;, nextState = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> thisProps = <span class="keyword">this</span>.props || &#123;&#125;, thisState = <span class="keyword">this</span>.state || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(thisProps).length !== <span class="built_in">Object</span>.keys(nextProps).length ||</span><br><span class="line">      <span class="built_in">Object</span>.keys(thisState).length !== <span class="built_in">Object</span>.keys(nextState).length) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Object</span>.is(thisProps[key], nextProps[key])) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> nextState) &#123;</span><br><span class="line">    <span class="keyword">if</span> (thisState[key] !== nextState[key] || !<span class="built_in">Object</span>.is(thisState[key], nextState[key])) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¼“å­˜è·¯ç”±"><a href="#ç¼“å­˜è·¯ç”±" class="headerlink" title="ç¼“å­˜è·¯ç”±"></a>ç¼“å­˜è·¯ç”±</h3><p><a href="https://juejin.im/post/5cef73a3e51d4510926a7aeb" target="_blank" rel="noopener">ç½‘å€</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;matchPath&#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Route&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouteCache</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    include: PropTypes.oneOfType([</span><br><span class="line">      PropTypes.bool,</span><br><span class="line">      PropTypes.array</span><br><span class="line">    ])</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  cache = &#123;&#125;; <span class="comment">//ç¼“å­˜å·²åŠ è½½è¿‡çš„ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;children, include = []&#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> React.Children.map(children, child =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (React.isValidElement(child)) &#123; <span class="comment">// éªŒè¯æ˜¯å¦ä¸ºæ˜¯react element</span></span><br><span class="line">        <span class="keyword">const</span> &#123;path&#125; = child.props;</span><br><span class="line">        <span class="keyword">const</span> match = matchPath(location.pathname, &#123;...child.props, path&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (match &amp;&amp; (include === <span class="literal">true</span> || include.includes(path))) &#123;</span><br><span class="line">          <span class="comment">//å¦‚æœåŒ¹é…ï¼Œåˆ™å°†å¯¹åº”pathçš„computedMatchå±æ€§åŠ å…¥cacheå¯¹è±¡é‡Œ</span></span><br><span class="line">          <span class="comment">//å½“includeä¸ºtrueæ—¶ï¼Œç¼“å­˜å…¨éƒ¨ç»„ä»¶ï¼Œå½“includeä¸ºæ•°ç»„æ—¶ç¼“å­˜å¯¹åº”ç»„ä»¶</span></span><br><span class="line">          <span class="keyword">this</span>.cache[path] = &#123;<span class="attr">computedMatch</span>: match&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯ä»¥åœ¨computedMatché‡Œè¿½åŠ å…¥ä¸€ä¸ªdisplayå±æ€§ï¼Œå¯ä»¥åœ¨è·¯ç”±ç»„ä»¶çš„props.matchæ‹¿åˆ°</span></span><br><span class="line">        <span class="keyword">const</span> cloneProps = <span class="keyword">this</span>.cache[path] &amp;&amp; <span class="built_in">Object</span>.assign(<span class="keyword">this</span>.cache[path].computedMatch, &#123;<span class="attr">display</span>: match ? <span class="string">'block'</span> : <span class="string">'none'</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;display:</span> <span class="attr">match</span> ? '<span class="attr">block</span>' <span class="attr">:</span> '<span class="attr">none</span>'&#125;&#125;&gt;</span>&#123;React.cloneElement(child, &#123;computedMatch: cloneProps&#125;)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">&lt;RouteCache include=&#123;[<span class="string">'/login'</span>, <span class="string">'/home'</span>]&#125;&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/login"</span> component=&#123;Login&#125; /&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/home"</span> component=&#123;App&#125; /&gt;</span><br><span class="line">&lt;<span class="regexp">/RouteCache&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è·å–å®é™…çš„DOM"><a href="#è·å–å®é™…çš„DOM" class="headerlink" title="è·å–å®é™…çš„DOM"></a>è·å–å®é™…çš„DOM</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ReactDOM.findDOMNode(<span class="keyword">this</span>.sildeWrapper).clientWidth;   <span class="comment">//åºŸå¼ƒ  æ”¹ç”¨ref</span></span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ DOM"><a href="#æ·»åŠ DOM" class="headerlink" title="æ·»åŠ DOM"></a>æ·»åŠ DOM</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div dangerouslySetInnerHTML=&#123;&#123;<span class="attr">__html</span>: <span class="string">'&lt;p&gt;123&lt;/p&gt;'</span>&#125;&#125; /&gt;</span><br></pre></td></tr></table></figure><h3 id="React-memo"><a href="#React-memo" class="headerlink" title="React.memo"></a>React.memo</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import PowerList from &quot;.&#x2F;components&#x2F;PowerList&quot;</span><br><span class="line">const MemoPowerList &#x3D; memo(PowerList, (prevProps, nextProps) &#x3D;&gt; prevProps.data &#x3D;&#x3D;&#x3D; nextProps.data);</span><br><span class="line"></span><br><span class="line"> render() &#123;</span><br><span class="line">     &lt;MemoPowerList&#x2F;&gt;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="React-createElement"><a href="#React-createElement" class="headerlink" title="React.createElement"></a>React.createElement</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">React.createElement(</span><br><span class="line">  type,</span><br><span class="line">  &#123;props&#125;,</span><br><span class="line">  [...children]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; jsx è¯­æ³•</span><br><span class="line">&lt;div id&#x3D;&#39;one&#39; class&#x3D;&#39;two&#39;&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;spanOne&quot;&gt;this is spanOne&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;h1 id&#x3D;&quot;spanTwo&quot;&gt;this is spanTwo&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; è½¬åŒ–ä¸º js</span><br><span class="line">React.createElement(</span><br><span class="line">    &quot;div&quot;, &#123;id: &quot;one&quot;, className: &quot;two&quot;&#125;,</span><br><span class="line">    React.createElement(&quot;div&quot;, &#123;id: &quot;spanOne&quot;&#125;, &quot;this is spanOne&quot;),</span><br><span class="line">    React.createElement(&quot;h1&quot;, &#123;id: &quot;spanTwo&quot;&#125;, &quot;this is spanTwo&quot;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="React-cloneElement"><a href="#React-cloneElement" class="headerlink" title="React.cloneElement"></a>React.cloneElement</h3><p>æ–°çš„å­å…ƒç´ å°†å–ä»£ç°æœ‰çš„å­å…ƒç´ ï¼Œ <code>key</code>å’Œ<code>ref</code>å°†è¢«ä¿ç•™</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">React.cloneElement(</span><br><span class="line">  element,</span><br><span class="line">  &#123;props&#125;,</span><br><span class="line">  [...children]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>é€‚ç”¨äº</strong> çˆ¶ç»„ä»¶æ˜¯<code>ç‹¬ç«‹</code>çš„ï¼Œå­ç»„ä»¶æ˜¯<code>ç‹¬ç«‹</code>çš„ï¼Œ çˆ¶ç»„ä»¶æ•°æ®æ”¹å˜ï¼Œæƒ³è¦é€šçŸ¥å­ç»„ä»¶ï¼Œæˆ–è€…å­ç»„ä»¶æƒ³è¦æ”¹çˆ¶ç»„ä»¶çš„æ•°æ®(ä¹Ÿæ˜¯é€šè¿‡å›è°ƒ)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;Fragment, Component, useState, useEffect&#125; from &#39;react&#39;;</span><br><span class="line">class MyContainer extends Component &#123;</span><br><span class="line">    state &#x3D; &#123;count: 1&#125;;</span><br><span class="line">    handleClick &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">        this.setState((&#123;count&#125;) &#x3D;&gt; &#123;</span><br><span class="line">            return &#123;count: count + 1&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        const &#123;count&#125; &#x3D; this.state;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Fragment&gt;</span><br><span class="line">                &#123;React.Children.map(this.props.children, (item, index) &#x3D;&gt; &#123;</span><br><span class="line">                    return React.cloneElement(item,</span><br><span class="line">                        &#123;</span><br><span class="line">                            parentState: count,</span><br><span class="line">                            handleClick: this.handleClick</span><br><span class="line">                        &#125;,</span><br><span class="line">                    )</span><br><span class="line">                &#125;)&#125;</span><br><span class="line">            &lt;&#x2F;Fragment&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">function MySub(props) &#123;</span><br><span class="line">    const &#123;subInfo, parentState, handleClick&#125; &#x3D; props;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div style&#x3D;&#123;&#123;margin: &quot;15px&quot;, border: &quot;1px solid red&quot;, padding: 10&#125;&#125;&gt;</span><br><span class="line">            å­å…ƒç´ :&#123;subInfo&#125;</span><br><span class="line">            &lt;br&#x2F;&gt;</span><br><span class="line">            çˆ¶ç»„ä»¶å±æ€§countå€¼: &#123;parentState&#125;</span><br><span class="line">            &lt;br&#x2F;&gt;</span><br><span class="line">            &lt;button onClick&#x3D;&#123;() &#x3D;&gt; handleClick()&#125;&gt;ç‚¹å‡»+1&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">function Index() &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            &lt;MyContainer&gt;</span><br><span class="line">                &lt;MySub subInfo&#x3D;&#123;&quot;ç¬¬ä¸€ä¸ª&quot;&#125;&#x2F;&gt;</span><br><span class="line">                &lt;MySub subInfo&#x3D;&#123;&quot;ç¬¬äºŒä¸ª&quot;&#125;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;MyContainer&gt;</span><br><span class="line">        &lt;&#x2F;Fragment&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">export default Index;</span><br></pre></td></tr></table></figure><h3 id="ReactDOM-createPortal"><a href="#ReactDOM-createPortal" class="headerlink" title="ReactDOM.createPortal"></a>ReactDOM.createPortal</h3><p>react ä¸­æ‰€æœ‰çš„ç»„ä»¶éƒ½ä¼šä½äº#appä¸‹ï¼Œè€Œä½¿ç”¨Portalsæä¾›äº†ä¸€ç§è„±ç¦»#appçš„ç»„ä»¶ã€‚</p><p>é€‚ç”¨ <code>æ¨¡æ€æ¡†ï¼Œé€šçŸ¥ï¼Œè­¦å‘Šï¼ŒgoTop</code> ç­‰</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import React, &#123;Fragment, useState, useEffect&#125; from &#39;react&#39;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;</span><br><span class="line"></span><br><span class="line">const modalRoot &#x3D; document.getElementById(&#39;modal&#39;);</span><br><span class="line"></span><br><span class="line">class Modal extends React.Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.el &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        modalRoot.appendChild(this.el);</span><br><span class="line">        console.log(document.getElementById(&#39;root&#39;).style.display &#x3D; &#39;none&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        modalRoot.removeChild(this.el);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return ReactDOM.createPortal(</span><br><span class="line">            this.props.children,</span><br><span class="line">            this.el,</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">function f() &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;Modal&gt;</span><br><span class="line">            å¦ˆçš„ DW</span><br><span class="line">        &lt;&#x2F;Modal&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">export default f;</span><br></pre></td></tr></table></figure><h3 id="Render-Props"><a href="#Render-Props" class="headerlink" title="Render Props"></a>Render Props</h3><p>å°±æ˜¯ç»™ç»„ä»¶æ·»åŠ ä¸€ä¸ª<code>å€¼ä¸ºå‡½æ•°</code>çš„å±æ€§ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨<code>ç»„ä»¶æ¸²æŸ“</code>çš„æ—¶å€™è°ƒç”¨</p><p><strong>é€‚ç”¨äº</strong> çˆ¶ç»„ä»¶æ˜¯ç‹¬ç«‹çš„ï¼Œå­ç»„ä»¶æ˜¯ç‹¬ç«‹çš„ï¼Œ çˆ¶ç»„ä»¶æ•°æ®æ”¹å˜ï¼Œæƒ³è¦é€šçŸ¥å­ç»„ä»¶ï¼Œæˆ–è€…å­ç»„ä»¶æƒ³è¦æ”¹çˆ¶ç»„ä»¶çš„æ•°æ®(ä¹Ÿæ˜¯é€šè¿‡å›è°ƒ)</p><p><strong>å®ç°ä¸€ä¸ªå›¾ç‰‡è·Ÿéšé¼ æ ‡çš„åŠŸèƒ½</strong></p><p>ä¸çŸ¥é“è¿™ä¸ªåŠŸèƒ½ä¹‹å‰å¯èƒ½è¿™æ ·å®ç°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> Cat = <span class="function">(<span class="params">&#123;mouse&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;img src=<span class="string">"https://ae01.alicdn.com/kf/H62563fe1dc6447aca248634b671b7a59W.png"</span></span><br><span class="line">             style=&#123;&#123;<span class="attr">position</span>: <span class="string">'absolute'</span>, <span class="attr">left</span>: mouse.x, <span class="attr">top</span>: mouse.y&#125;&#125; alt=&#123;<span class="string">''</span>&#125;/&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mouse</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;;</span><br><span class="line">    handleMouseMove = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            x: event.clientX,</span><br><span class="line">            y: event.clientY</span><br><span class="line">        &#125;, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.props.render(<span class="keyword">this</span>.state) <span class="comment">//åœ¨è¿™é‡Œä¼ ç»™çˆ¶ç»„ä»¶</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div style=&#123;&#123;<span class="attr">height</span>: <span class="string">'100vh'</span>&#125;&#125; onMouseMove=&#123;<span class="keyword">this</span>.handleMouseMove&#125;&gt;</span><br><span class="line">                &lt;h1&gt;ç§»åŠ¨é¼ æ ‡&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;å½“å‰çš„é¼ æ ‡å®šä½ (X:&#123;this.state.x&#125;, Y:&#123;this.state.y&#125;)&lt;/</span>p&gt;</span><br><span class="line">                &#123;<span class="comment">/*<span class="doctag">TODO:</span>ç»„ä»¶åœ¨é‡Œé¢æ¸²æŸ“*/</span>&#125;</span><br><span class="line">                &#123;<span class="keyword">this</span>.props.children&#125;  </span><br><span class="line">                </span><br><span class="line">                &#123;<span class="comment">/*<span class="doctag">TODO:</span>è¿™ç§æ–¹å¼ç®€å•*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*&#123;*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*    React.Children.map(this.props.children, (item, index) =&gt; &#123;*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*        return React.cloneElement(item,*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*            &#123;*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*                mouse: this.state*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*            &#125;,*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*        )*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*    &#125;)*/</span>&#125;</span><br><span class="line">                &#123;<span class="comment">/*&#125;*/</span>&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">class Index extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">    state = &#123; mouse: &#123;&#125; &#125;;  /</span><span class="regexp">/äº¤ç»™ä»–ä»¬çš„çˆ¶çº§æ¥å‡ºæ¥ï¼Œç„¶åé‡æ–°state,æŠŠå€¼ä¼ è¿›æ¥</span></span><br><span class="line"><span class="regexp">    render() &#123;</span></span><br><span class="line"><span class="regexp">        const &#123;mouse&#125; = this.state;</span></span><br><span class="line"><span class="regexp">        return (</span></span><br><span class="line"><span class="regexp">            &lt;Mouse render=&#123;(item) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                this.setState(&#123;mouse: item&#125;)</span></span><br><span class="line"><span class="regexp">            &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Cat mouse=&#123;mouse&#125;/</span>&gt;</span><br><span class="line">            &lt;<span class="regexp">/Mouse&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Index;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨å¯ä»¥è¿™ä¹ˆå®ç°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> Cat = <span class="function">(<span class="params">&#123;mouse&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;img src=<span class="string">"https://ae01.alicdn.com/kf/H62563fe1dc6447aca248634b671b7a59W.png"</span></span><br><span class="line">             style=&#123;&#123;<span class="attr">position</span>: <span class="string">'absolute'</span>, <span class="attr">left</span>: mouse.x, <span class="attr">top</span>: mouse.y&#125;&#125; alt=&#123;<span class="string">''</span>&#125;/&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mouse</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;;</span><br><span class="line">    handleMouseMove = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            x: event.clientX,</span><br><span class="line">            y: event.clientY</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div style=&#123;&#123;<span class="attr">height</span>: <span class="string">'100vh'</span>&#125;&#125; onMouseMove=&#123;<span class="keyword">this</span>.handleMouseMove&#125;&gt;</span><br><span class="line">                &lt;h1&gt;ç§»åŠ¨é¼ æ ‡&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;å½“å‰çš„é¼ æ ‡å®šä½ (X:&#123;this.state.x&#125;, Y:&#123;this.state.y&#125;)&lt;/</span>p&gt;</span><br><span class="line">                &#123;<span class="comment">/*<span class="doctag">TODO:</span>åœ¨renderé‡Œé¢æ‰§è¡Œçš„è¿™ä¸ªæ–¹æ³•ï¼Œä¸ä»…ä»…æ˜¯æ‰§è¡Œå½“å‰è¿™ä¸ªå‡½æ•°è¿˜æŠŠå‡½æ•°åœ¨è¿™é‡Œæ¸²æŸ“å‡ºæ¥äº†*/</span>&#125;</span><br><span class="line">                &#123;<span class="keyword">this</span>.props.render(<span class="keyword">this</span>.state)&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">const Index = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const catRender=(item)=&gt;&lt;Cat mouse=&#123;item&#125;/</span>&gt;;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">Mouse</span> <span class="attr">render</span>=<span class="string">&#123;catRender&#125;/</span>&gt;</span></span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index;</span><br></pre></td></tr></table></figure><h3 id="Error-Boundaries"><a href="#Error-Boundaries" class="headerlink" title="Error Boundaries"></a>Error Boundaries</h3><p><code>é”™è¯¯è¾¹ç•Œ</code>æ˜¯ä¸€ç§Reactç»„ä»¶ï¼Œè¿™ç§ç»„ä»¶<strong>å¯ä»¥æ•è·å¹¶æ‰“å°å‘ç”Ÿåœ¨å…¶å­ç»„ä»¶æ ‘ä»»ä½•ä½ç½®çš„ JavaScript é”™è¯¯ï¼Œå¹¶ä¸”ï¼Œå®ƒä¼šæ¸²æŸ“å‡ºå¤‡ç”¨ UI</strong>ï¼Œè€Œä¸æ˜¯æ¸²æŸ“é‚£äº›å´©æºƒäº†çš„å­ç»„ä»¶æ ‘ã€‚<br>é”™è¯¯è¾¹ç•Œåœ¨æ¸²æŸ“æœŸé—´ã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’Œæ•´ä¸ªç»„ä»¶æ ‘çš„æ„é€ å‡½æ•°ä¸­æ•è·é”™è¯¯ã€‚</p><p><strong>static getDerivedStateFromError(error)</strong></p><p>å½“åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶å°†æŠ›å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°ã€‚æ— è®ºè¿™ä¸ªæ–¹æ³•è¿”å›ä»€ä¹ˆå€¼ï¼Œéƒ½å°†ç”¨äºæ›´æ–°ç»„ä»¶çš„çŠ¶æ€ã€‚</p><p>åœ¨åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯ä¹‹åï¼Œä¹Ÿä¼šè°ƒç”¨<strong>componentDidCatch</strong>æ–¹æ³•é™¤äº†æŠ›å‡ºçš„é”™è¯¯ä¹‹å¤–ï¼Œè¿˜ä¼šæœ‰å¦ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°åŒ…å«äº†æœ‰å…³é”™è¯¯çš„æ›´å¤šä¿¡æ¯</p><ul><li>getDerivedStateFromErroræ˜¯åœ¨reconciliationé˜¶æ®µè§¦å‘ï¼Œæ‰€ä»¥getDerivedStateFromErrorè¿›è¡Œæ•è·é”™è¯¯åè¿›è¡Œç»„ä»¶çš„çŠ¶æ€å˜æ›´ï¼Œä¸å…è®¸å‡ºç°å‰¯ä½œç”¨ã€‚</li><li>componentDidCatchå› ä¸ºåœ¨commité˜¶æ®µï¼Œå› æ­¤å…è®¸æ‰§è¡Œå‰¯ä½œç”¨ã€‚ å®ƒåº”è¯¥ç”¨äºè®°å½•é”™è¯¯ä¹‹ç±»çš„æƒ…å†µ</li></ul><p>::: warning æ³¨æ„<br>é”™è¯¯è¾¹ç•Œæ— æ³•æ•è·ä»¥ä¸‹åœºæ™¯ä¸­äº§ç”Ÿçš„é”™è¯¯ï¼š</p><ul><li>äº‹ä»¶å¤„ç†ï¼ˆäº†è§£æ›´å¤šï¼‰</li><li>å¼‚æ­¥ä»£ç ï¼ˆä¾‹å¦‚ <code>setTimeout</code> æˆ– <code>requestAnimationFrame</code> å›è°ƒå‡½æ•°ï¼‰</li><li>æœåŠ¡ç«¯æ¸²æŸ“</li><li>å®ƒè‡ªèº«æŠ›å‡ºæ¥çš„é”™è¯¯ï¼ˆå¹¶éå®ƒçš„å­ç»„ä»¶ï¼‰</li></ul><p><strong>åªæœ‰ class ç»„ä»¶æ‰å¯ä»¥æˆä¸ºé”™è¯¯è¾¹ç•Œç»„ä»¶</strong></p><p>è‡ªReact16èµ·ï¼Œ<code>ä»»ä½•æœªè¢«é”™è¯¯è¾¹ç•Œæ•è·çš„é”™è¯¯</code>å°†ä¼šå¯¼è‡´æ•´ä¸ªReactç»„ä»¶æ ‘è¢«å¸è½½ã€‚</p><p><strong>é”™è¯¯è¾¹ç•Œçš„<code>ç²’åº¦</code>ç”±ä½ æ¥å†³å®šï¼Œå¯ä»¥å°†å…¶åŒ…è£…åœ¨<code>æœ€é¡¶å±‚çš„è·¯ç”±</code>ç»„ä»¶å¹¶ä¸ºç”¨æˆ·å±•ç¤ºä¸€ä¸ª â€œSomething went wrongâ€ çš„é”™è¯¯ä¿¡æ¯ï¼Œ<br>å°±åƒæœåŠ¡ç«¯æ¡†æ¶ç»å¸¸å¤„ç†å´©æºƒä¸€æ ·ã€‚<br>ä½ ä¹Ÿå¯ä»¥å°†<code>å•ç‹¬çš„éƒ¨ä»¶</code>åŒ…è£…åœ¨é”™è¯¯è¾¹ç•Œä»¥ä¿æŠ¤åº”ç”¨å…¶ä»–éƒ¨åˆ†ä¸å´©æºƒã€‚</strong><br>:::</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> getDerivedStateFromError(error) &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–° state ä½¿ä¸‹ä¸€æ¬¡æ¸²æŸ“èƒ½å¤Ÿæ˜¾ç¤ºé™çº§åçš„ UI</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidCatch(error, errorInfo) &#123;</span><br><span class="line">    <span class="comment">// ä½ åŒæ ·å¯ä»¥å°†é”™è¯¯æ—¥å¿—ä¸ŠæŠ¥ç»™æœåŠ¡å™¨</span></span><br><span class="line">    logErrorToMyService(error, errorInfo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.hasError) &#123;</span><br><span class="line">      <span class="comment">// ä½ å¯ä»¥è‡ªå®šä¹‰é™çº§åçš„ UI å¹¶æ¸²æŸ“</span></span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Something went wrong.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.children; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Code-Splitting"><a href="#Code-Splitting" class="headerlink" title="Code Splitting"></a>Code Splitting</h3><p><strong>import()</strong>  </p><p>é€‚ç”¨äºå‡½æ•°</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;add.js</span><br><span class="line">export const sum &#x3D; (a, b) &#x3D;&gt; a + b;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;index.js</span><br><span class="line">import React from &#39;react&#39;;</span><br><span class="line">function Index() &#123;</span><br><span class="line">    const handleClick &#x3D; async () &#x3D;&gt; &#123;</span><br><span class="line">        const &#123;sum&#125; &#x3D; await import(&#39;.&#x2F;add&#39;);</span><br><span class="line">        console.log(sum(1, 2));</span><br><span class="line">    &#125;;</span><br><span class="line">    return (</span><br><span class="line">        &lt;button onClick&#x3D;&#123;handleClick&#125;&gt;ç‚¹å‡»&lt;&#x2F;button&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">export default Index;</span><br></pre></td></tr></table></figure><p><strong>React.lazy</strong></p><p>é€‚ç”¨äºç»„ä»¶ ç›®å‰ä¸æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Foo &#x3D; React.lazy(() &#x3D;&gt; import(&#39;..&#x2F;components&#x2F;Foo&#39;));</span><br><span class="line">render() &#123;</span><br><span class="line">    return (</span><br><span class="line">            &lt;Suspense fallback&#x3D;&#123;&lt;div&gt;loading...&lt;&#x2F;div&gt;&#125;&gt;</span><br><span class="line">                &lt;Foo&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;Suspense&gt;</span><br><span class="line">        )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>React.lazy ç›®å‰åªæ”¯æŒé»˜è®¤å¯¼å‡ºï¼ˆdefault exports)</code> ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´æ¨¡å—ï¼Œæ¥é‡æ–°å¯¼å‡ºä¸ºé»˜è®¤æ¨¡å—</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//a.jsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> A = <span class="comment">/* ... */</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> B = <span class="comment">/* ... */</span>;</span><br><span class="line"><span class="comment">//middle.js</span></span><br><span class="line"><span class="keyword">export</span> &#123; A <span class="keyword">as</span> <span class="keyword">default</span> &#125; <span class="keyword">from</span> <span class="string">"./a"</span>;   <span class="comment">//Aå°±ç›¸å½“äºé»˜è®¤å¯¼å‡º</span></span><br><span class="line"><span class="comment">//index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; lazy &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> A = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./middle"</span>));</span><br><span class="line"></span><br><span class="line">&lt;Suspense fallback=&#123;&lt;div&gt;loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">    &lt;A/</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/Suspense&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ref-éå—æ§"><a href="#ref-éå—æ§" class="headerlink" title="ref(éå—æ§)"></a>ref(éå—æ§)</h3><p>Reactçš„refæœ‰4ç§ç”¨æ³•ï¼š</p><ul><li><p>å­—ç¬¦ä¸²(å·²åºŸå¼ƒ)</p></li><li><p>å›è°ƒå‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è·å–å­ç»„ä»¶çš„domèŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomTextInput</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;input ref=&#123;props.inputRef&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Parent(props) &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      My input: &lt;CustomTextInput inputRef=&#123;props.inputRef&#125; /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Grandparent extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;Parent</span></span><br><span class="line"><span class="regexp">        inputRef=&#123;el =&gt; this.inputElement = el&#125;</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>React.createRef()</strong> ï¼ˆReact16.3æä¾›,æ— çŠ¶æ€çš„ç»„ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼‰</p></li><li><p>Hooks <strong>useRef()</strong> ç”¨æ³•ç±»ä¼¼createRef()</p></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Example = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> inputRef = useRef(<span class="literal">null</span>);</span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        inputRef.current.focus();</span><br><span class="line">    &#125;, []);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> ref=&#123;inputRef&#125;/&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç±»ç»„ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.myRef=React.createRef();</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.myRef.current);</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;/</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ— çŠ¶æ€ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomTextInput</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// textInput must be declared here so the ref can refer to it</span></span><br><span class="line">  <span class="keyword">let</span> textInput = React.createRef();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    textInput.current.focus();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">"text"</span></span><br><span class="line">        ref=&#123;textInput&#125; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">"button"</span></span><br><span class="line">        value=<span class="string">"Focus the text input"</span></span><br><span class="line">        onClick=&#123;handleClick&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><ul><li><code>React.forwardRef()</code>  åŒæ ·æ˜¯React 16.3ç‰ˆæœ¬åæä¾›çš„ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºå­ç»„ä»¶ï¼Œä»¥ä¼ é€’refã€‚</li></ul><h3 id="Reactç”Ÿå‘½å‘¨æœŸ"><a href="#Reactç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Reactç”Ÿå‘½å‘¨æœŸ"></a>Reactç”Ÿå‘½å‘¨æœŸ</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hbb3d522c7afa45d894e583388f1615f4p.jpg" alt=""></p><h3 id="antd"><a href="#antd" class="headerlink" title="antd"></a>antd</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">'~antd/es/style/themes/default.less'</span>;</span><br><span class="line"></span><br><span class="line">@pro-header-hover-bg: rgba(0, 0, 0, 0.025);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è·å–fromé‡Œé¢çš„æ•°æ®é›†åˆ</span></span><br><span class="line"> <span class="keyword">this</span>.props.form.getFieldsValue()</span><br><span class="line"><span class="comment">//é‡ç½®fromè¾“å…¥çš„å†…å®¹ï¼Œï¼ˆå‚æ•°ä¸ä¼ é»˜è®¤æ˜¯æ‰€æœ‰çš„ï¼‰</span></span><br><span class="line"><span class="keyword">this</span>.props.form.resetFields(<span class="string">'search_product_name'</span>);</span><br><span class="line"><span class="comment">//æŠ›å‡ºé”™è¯¯</span></span><br><span class="line"><span class="keyword">this</span>.props.form.setFields(&#123;</span><br><span class="line">   name: &#123;</span><br><span class="line">      value: val,</span><br><span class="line">        errors: [<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'forbid ha'</span>)],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//è®¾ç½®fromçš„å€¼</span></span><br><span class="line"><span class="keyword">this</span>.props.form.setFieldsValue(&#123;</span><br><span class="line">   points: <span class="number">1212121</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* æäº¤æ•°æ®æ»šåŠ¨åˆ°è¯¥ä½ç½®</span></span><br><span class="line"><span class="comment">* å‚æ•°1 åªæ•æ‰è¯¥å­—æ®µçš„æ•°æ®</span></span><br><span class="line"><span class="comment">* å‚æ•°2 å®šä¹‰ validateFieldsAndScroll çš„æ»šåŠ¨è¡Œä¸º</span></span><br><span class="line"><span class="comment">* å‚æ•°3 è·å–æ•°æ®ï¼Œé”™è¯¯æ•è·</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">form.validateFieldsAndScroll( </span><br><span class="line">   [<span class="string">'user'</span>, <span class="string">'password'</span>],</span><br><span class="line">    &#123;</span><br><span class="line">      scroll: &#123;</span><br><span class="line">           offsetTop: <span class="number">60</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;,(err, fieldsValue) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;     </span><br><span class="line">)</span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰è¾“å…¥æ¡†é¢æ ¼å¼ </span></span><br><span class="line">&#123;getFieldDecorator(<span class="string">'user'</span>, &#123;</span><br><span class="line">    rules: [</span><br><span class="line">    &#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'å¿…å¡«'</span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        validator: <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">'ä¸ç¬¦åˆ'</span>) &#123;</span><br><span class="line">                callback(<span class="string">'ä¸ç¬¦åˆ'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            callback()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ],</span><br><span class="line">    initialValue: <span class="string">''</span></span><br><span class="line">&#125;)(<span class="xml"><span class="tag">&lt;<span class="name">Input</span>/&gt;</span></span>)&#125;</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰ç¯å¢ƒå˜é‡"><a href="#å®šä¹‰ç¯å¢ƒå˜é‡" class="headerlink" title="å®šä¹‰ç¯å¢ƒå˜é‡"></a>å®šä¹‰ç¯å¢ƒå˜é‡</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">cross-env ANALYZE=<span class="literal">true</span> <span class="comment">// è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">process.env.ANALYZE=<span class="literal">true</span>  <span class="comment">// è·å–ç¯å¢ƒå˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">    ENV: <span class="built_in">JSON</span>.stringify(process.env.ENV), <span class="comment">// å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡åœ¨é¡µé¢ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>react é»˜è®¤æµ‹è¯•ç¯å¢ƒ NODE_ENVä¸º<code>development</code>ï¼Œæ­£å¼ä¸º<code>production</code></p><h3 id="dva-amp-effects"><a href="#dva-amp-effects" class="headerlink" title="dva &amp; effects"></a>dva &amp; effects</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å…¨å±€æ‰§è¡Œmodel</span></span><br><span class="line"><span class="built_in">window</span>.g_app </span><br><span class="line"></span><br><span class="line"><span class="comment">//effectsåŸºæœ¬ç”¨æ³•</span></span><br><span class="line">*add(action,&#123;put,call,select&#125;)&#123;</span><br><span class="line">    <span class="keyword">yield</span> call(delay,<span class="number">1000</span>);<span class="comment">//yield è°ƒç”¨ä¸€ä¸ªdelayçš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªpromise,ä¼šç­‰å¾…åœ¨è¿™é‡Œã€‚ç­‰å¾…åˆ°promiseå˜æˆå®Œæˆæ€</span></span><br><span class="line">    <span class="keyword">yield</span> fork(delay,<span class="number">1000</span>);<span class="comment">//yield è°ƒç”¨ä¸€ä¸ªdelayçš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªpromise,ç›´æ¥æ‰§è¡Œä¸ä¼šå µå¡</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">yield</span> put(&#123;<span class="attr">type</span>:<span class="string">'counter/minus'</span>&#125;);<span class="comment">//putæ´¾å‘ä¸€ä¸ªåŠ¨ä½œ,ç›¸å½“äºdispatch;æ³¨æ„ï¼š put ä¹Ÿæ˜¯é˜»å¡ effect</span></span><br><span class="line">    <span class="keyword">let</span> state = <span class="keyword">yield</span> select(<span class="function"><span class="params">state</span>=&gt;</span>state.counter);  <span class="comment">//è·å–storeçš„æ•°æ®ç›¸å½“äº store.getState()</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> &#123;push&#125; = routerRedux;<span class="comment">//dvaå°è£…çš„router-reduxï¼Œdvaçš„æ ¸å¿ƒåº“æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="keyword">yield</span> put(push(action.to));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//effectsé‡Œé¢è°ƒå–å…¬å…±çš„æ–¹æ³•  ä¾‹ï¼š</span></span><br><span class="line"> effects: &#123;</span><br><span class="line">    * a(action, person) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">8888</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    * b(action, person) &#123;</span><br><span class="line">        <span class="keyword">yield</span> put(&#123;<span class="comment">//å°±æ˜¯dispatch</span></span><br><span class="line">            type: <span class="string">'a'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//dvaè¯·æ±‚å¤šä¸ªæ¥å£</span></span><br><span class="line"><span class="comment">//æ–¹æ³•ä¸€ ï¼šåˆ©ç”¨Promise.all</span></span><br><span class="line"><span class="keyword">const</span> [ary1,ary2] = <span class="keyword">yield</span> <span class="built_in">Promise</span>.all([queryWxapps(scenicid()[<span class="string">'id'</span>]), queryWxapps(scenicid()[<span class="string">'id'</span>]), queryWxapps(scenicid()[<span class="string">'id'</span>])])</span><br><span class="line"><span class="built_in">console</span>.log(ary1);<span class="comment">//[&#123;&#125;,&#123;&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•äºŒ ï¼šåˆ©ç”¨axios.all()</span></span><br><span class="line">axios.all([queryWxapps(scenicid()[<span class="string">'id'</span>]), queryWxapps(scenicid()[<span class="string">'id'</span>]), queryWxapps(scenicid()[<span class="string">'id'</span>]).then(axios.spread(<span class="function">(<span class="params">user, aside</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(user);</span><br><span class="line">  <span class="built_in">console</span>.log(aside);</span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">//æ–¹æ³•ä¸‰ ï¼šsageæä¾›çš„å°†ä¼šåŒæ­¥æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">const</span> [a,b,c] = <span class="keyword">yield</span> [</span><br><span class="line">    call(groupbuysList, shopid()[<span class="string">'id'</span>], action.params),</span><br><span class="line">    call(groupbuysList, shopid()[<span class="string">'id'</span>], action.params),</span><br><span class="line">    call(groupbuysList, shopid()[<span class="string">'id'</span>], action.params)</span><br><span class="line">];</span><br><span class="line"><span class="comment">//æ–¹æ³•å›› ï¼šsageæä¾›çš„yield all</span></span><br><span class="line"> <span class="keyword">const</span> [a,b,c]  = <span class="keyword">yield</span> all([</span><br><span class="line">    call(groupbuysList, shopid()[<span class="string">'id'</span>], action.params),</span><br><span class="line">    call(groupbuysList, shopid()[<span class="string">'id'</span>], action.params),</span><br><span class="line">    call(groupbuysList, shopid()[<span class="string">'id'</span>], action.params),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FEæ¡†æ¶ </category>
          
          <category> React </category>
          
          <category> ReactåŸºæœ¬ç”¨æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dateæ—¶é—´</title>
      <link href="/2018/01/16/workspace/Js/date/"/>
      <url>/2018/01/16/workspace/Js/date/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Dateæ—¶é—´</strong></p><p>[[toc]]</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ—¶é—´æˆ³</span></span><br><span class="line"><span class="built_in">Date</span>.now()</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>().valueOf()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">"2019-06-16 07:55:55"</span>); <span class="comment">// Sun Jun 16 2019 07:55:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¶é—´æ ¼å¼åŒ– </span></span><br><span class="line">date2 = <span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().slice(<span class="number">0</span>,<span class="number">10</span>);   <span class="comment">// 2019-06-16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> date2 <span class="comment">// 'object'</span></span><br></pre></td></tr></table></figure><h4 id="æ—¶é—´æ ¼å¼åŒ–"><a href="#æ—¶é—´æ ¼å¼åŒ–" class="headerlink" title="æ—¶é—´æ ¼å¼åŒ–"></a>æ—¶é—´æ ¼å¼åŒ–</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¡¥0</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fillZero</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num &gt;= <span class="number">10</span> ? num : <span class="string">"0"</span> + num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸€</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params">timestamp, formatStr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!timestamp) <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(timestamp)</span><br><span class="line">    <span class="keyword">let</span> year = date.getFullYear()</span><br><span class="line">    <span class="keyword">let</span> month = <span class="keyword">this</span>.fillZero(date.getMonth() + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">let</span> day = <span class="keyword">this</span>.fillZero(date.getDate())</span><br><span class="line">    <span class="keyword">let</span> hour = <span class="keyword">this</span>.fillZero(date.getHours())</span><br><span class="line">    <span class="keyword">let</span> minute = <span class="keyword">this</span>.fillZero(date.getMinutes())</span><br><span class="line">    <span class="keyword">let</span> second = <span class="keyword">this</span>.fillZero(date.getSeconds())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> formatStr</span><br><span class="line">            .replace(<span class="string">'YYYY'</span>, year)</span><br><span class="line">            .replace(<span class="string">'MM'</span>, month)</span><br><span class="line">            .replace(<span class="string">'DD'</span>, day)</span><br><span class="line">            .replace(<span class="string">'HH'</span>, hour)</span><br><span class="line">            .replace(<span class="string">'mm'</span>, minute)</span><br><span class="line">            .replace(<span class="string">'ss'</span>, second)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params">timeStamp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(timeStamp);</span><br><span class="line">    <span class="keyword">return</span> date.getFullYear() + <span class="string">"å¹´"</span></span><br><span class="line">        + (date.getMonth() + <span class="number">1</span>).toString().padStart(<span class="number">2</span>, <span class="number">0</span>) + <span class="string">"æœˆ"</span></span><br><span class="line">        + (date.getDate()).toString().padStart(<span class="number">2</span>, <span class="number">0</span>) + <span class="string">"æ—¥ "</span></span><br><span class="line">        + (date.getHours()).toString().padStart(<span class="number">2</span>, <span class="number">0</span>) + <span class="string">":"</span></span><br><span class="line">        + (date.getMinutes().toString().padStart(<span class="number">2</span>, <span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å€’è®¡æ—¶æ—¶é—´æ ¼å¼åŒ–"><a href="#å€’è®¡æ—¶æ—¶é—´æ ¼å¼åŒ–" class="headerlink" title="å€’è®¡æ—¶æ—¶é—´æ ¼å¼åŒ–"></a>å€’è®¡æ—¶æ—¶é—´æ ¼å¼åŒ–</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_time</span>(<span class="params">timeStamp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> day = <span class="built_in">Math</span>.floor(timeStamp / (<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>));</span><br><span class="line">    <span class="keyword">let</span> leave1 = timeStamp % (<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">let</span> hours = <span class="built_in">Math</span>.floor(leave1 / (<span class="number">3600</span> * <span class="number">1000</span>));</span><br><span class="line">    <span class="keyword">let</span> leave2 = leave1 % (<span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">let</span> minutes = <span class="built_in">Math</span>.floor(leave2 / (<span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line">    <span class="keyword">let</span> leave3 = leave2 % (<span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">let</span> seconds = <span class="built_in">Math</span>.floor(leave3 / <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span> (day) <span class="keyword">return</span> day + <span class="string">"å¤©"</span> + hours + <span class="string">"å°æ—¶"</span> + minutes + <span class="string">"åˆ†"</span>;</span><br><span class="line">    <span class="keyword">if</span> (hours) <span class="keyword">return</span> hours + <span class="string">"å°æ—¶"</span> + minutes + <span class="string">"åˆ†"</span> + seconds + <span class="string">"ç§’"</span>;</span><br><span class="line">    <span class="keyword">if</span> (minutes) <span class="keyword">return</span> minutes + <span class="string">"åˆ†"</span> + seconds + <span class="string">"ç§’"</span>;</span><br><span class="line">    <span class="keyword">if</span> (seconds) <span class="keyword">return</span> seconds + <span class="string">"ç§’"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"æ—¶é—´åˆ°ï¼"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è·ç¦»ç°åœ¨å¤šä¹…"><a href="#è·ç¦»ç°åœ¨å¤šä¹…" class="headerlink" title="è·ç¦»ç°åœ¨å¤šä¹…"></a>è·ç¦»ç°åœ¨å¤šä¹…</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> SECOND = <span class="number">1000</span></span><br><span class="line"><span class="keyword">const</span> MINUTE = SECOND * <span class="number">60</span></span><br><span class="line"><span class="keyword">const</span> HOUR = MINUTE * <span class="number">60</span></span><br><span class="line"><span class="keyword">const</span> DAY = HOUR * <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatToInterval</span>(<span class="params">timestamp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> now = <span class="built_in">Date</span>.now()</span><br><span class="line">    <span class="keyword">let</span> value = now - timestamp</span><br><span class="line">    value = value &lt; <span class="number">1</span> ? <span class="number">1</span> : value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value &lt; MINUTE) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Math</span>.floor(value / SECOND) + <span class="string">'ç§’å‰'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (value &lt; HOUR) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Math</span>.floor(value / MINUTE) + <span class="string">'åˆ†é’Ÿå‰'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (value &lt; DAY) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Math</span>.floor(value / HOUR) + <span class="string">'å°æ—¶å‰'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> format(timestamp, <span class="string">'MMæœˆDDæ—¥'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
          <category> Dateæ—¶é—´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JSè®¾è®¡æ¨¡å¼æ¢ç´¢</title>
      <link href="/2018/01/16/workspace/Js/design-pattern/"/>
      <url>/2018/01/16/workspace/Js/design-pattern/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>JSè®¾è®¡æ¨¡å¼æ¢ç´¢</strong></p><p>[[toc]]</p><h3 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> singleton = &#123;</span><br><span class="line"> name: <span class="string">'hzf'</span>,</span><br><span class="line"> age: <span class="number">24</span>,</span><br><span class="line"> walk: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="keyword">this</span>.age); <span class="comment">//24</span></span><br><span class="line"> &#125;,</span><br><span class="line"> eat: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="comment">//todo</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸è¶³ä¹‹å¤„:<br/><ul><li>(1)æ²¡æœ‰ä»€ä¹ˆå°è£…æ€§ï¼Œæ‰€æœ‰çš„å±æ€§æ–¹æ³•éƒ½æ˜¯æš´éœ²çš„ã€‚<br/></li><li>(2)å…¨å±€å˜é‡å¾ˆå®¹æ˜“é€ æˆå‘½åç©ºé—´æ±¡æŸ“ã€‚<br/></li><li>(3)å¯¹è±¡ä¸€å¼€å§‹å˜åˆ›å»ºï¼Œä¸‡ä¸€æˆ‘ä»¬ç”¨ä¸ä¸Šå°±æµªè´¹äº†ã€‚<br/></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="comment">// è¿™é‡Œå£°æ˜ç§æœ‰å˜é‡å’Œæ–¹æ³•ï¼›</span></span><br><span class="line">     <span class="keyword">const</span> privateVariable = <span class="string">'ç§æœ‰çš„å¤–é¢è·å–ä¸åˆ°'</span>;</span><br><span class="line">     </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">showPrivate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(privateVariable);</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//å…¬æœ‰çš„å˜é‡å’Œæ–¹æ³•(å¯ä»¥è®¿é—®ç§æœ‰å˜é‡å’Œæ–¹æ³•);</span></span><br><span class="line">     <span class="keyword">return</span> &#123;</span><br><span class="line">         publicMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">             showPrivate();</span><br><span class="line">         &#125;,</span><br><span class="line">         publicVar: <span class="string">'å…±æœ‰çš„å¤–é¢èƒ½ç›´æ¥è·å–'</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span>  single = person();</span><br><span class="line"></span><br><span class="line">single.publicMethod(); <span class="comment">// 'ç§æœ‰çš„å¤–é¢è·å–ä¸åˆ°'</span></span><br><span class="line"><span class="built_in">console</span>.log(single.publicVar); <span class="comment">// 'å…±æœ‰çš„å¤–é¢èƒ½ç›´æ¥è·å–'</span></span><br></pre></td></tr></table></figure><h3 id="å‘å¸ƒè®¢é˜…æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼+è§‚å¯Ÿè€…æ¨¡å¼"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼+è§‚å¯Ÿè€…æ¨¡å¼</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img style="width:50%" src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/Hd0dd34b5adf14ea1a3b9648fa8fa1507b.jpg"><h4 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h4><p>è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¸€èˆ¬æ˜¯<code>ç›´æ¥è”ç³»</code>çš„ï¼Œç›¸äº’çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚</p><p>è§‚å¯Ÿè€…ä¸€èˆ¬æ˜¯åŒæ­¥çš„ï¼Œè¢«è§‚å¯Ÿè€…ä¸€æ—¦æœ‰å˜åŒ–ï¼Œè§‚å¯Ÿè€…ä¼šç«‹å³å‘ç”Ÿååº”</p><p><code>Subject</code> - è¢«è§‚å¯Ÿè€…ï¼Œå‘å¸ƒè€…;</p><p><code>Observer</code> - è§‚å¯Ÿè€…ï¼Œè®¢é˜…è€…ï¼›</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¢«è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>. observers = []; <span class="comment">// è§‚å¯Ÿè€…åˆ—è¡¨</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ·»åŠ è®¢é˜…è€…</span></span><br><span class="line">  add(observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.push(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ é™¤...</span></span><br><span class="line">  remove(observer) &#123;</span><br><span class="line">    <span class="keyword">let</span> idx = <span class="keyword">this</span>.observers.findIndex(<span class="function"><span class="params">item</span> =&gt;</span> item === observer);</span><br><span class="line">    idx &gt; <span class="number">-1</span> &amp;&amp; <span class="keyword">this</span>.observers.splice(idx, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é€šçŸ¥  å…¨éƒ¨æ‰§è¡Œ</span></span><br><span class="line">  notify(boss) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> o <span class="keyword">of</span> <span class="keyword">this</span>.observers) &#123;</span><br><span class="line">      o.update(boss);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// ç›®æ ‡å¯¹è±¡æ›´æ–°æ—¶è§¦å‘çš„å›è°ƒï¼Œå³æ”¶åˆ°æ›´æ–°é€šçŸ¥åçš„å›è°ƒ</span></span><br><span class="line">  update(boss) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;boss&#125;</span>é€šçŸ¥æˆ‘èŒä½äº†ï¼Œæˆ‘æ˜¯ï¼š<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–ç›®æ ‡è€…</span></span><br><span class="line"><span class="keyword">let</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–ä¸¤ä¸ªè§‚å¯Ÿè€…</span></span><br><span class="line"><span class="keyword">let</span> obs1 = <span class="keyword">new</span> Observer(<span class="string">'é«˜çº§å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ'</span>);</span><br><span class="line"><span class="keyword">let</span> obs2 = <span class="keyword">new</span> Observer(<span class="string">'åˆçº§åç«¯å¼€å‘å·¥ç¨‹å¸ˆ'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å‘ç›®æ ‡è€…æ·»åŠ è§‚å¯Ÿè€…</span></span><br><span class="line">subject.add(obs1);</span><br><span class="line">subject.add(obs2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šçŸ¥</span></span><br><span class="line">subject.notify(<span class="string">'HR'</span>);</span><br><span class="line">subject.notify(<span class="string">'CTO'</span>);</span><br></pre></td></tr></table></figure><h4 id="å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼</h4><p>å‘å¸ƒè€…å’Œè®¢é˜…è€…æ˜¯è§£è€¦çš„ï¼Œä»–ä»¬æ˜¯é€šè¿‡ä¸€ä¸ª<code>ä»‹è´¨</code>ï¼ˆå¾€å¾€æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼‰æ‰§è¡Œä»£ç </p><p>å‘å¸ƒè®¢é˜…æ¨¡å¼ç”±äºæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä»£ç†çš„å­˜åœ¨ï¼Œå¾€å¾€æ˜¯å¼‚æ­¥çš„</p><p><strong>ä»£ç å®ç°</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ§åˆ¶ä¸­å¿ƒ</span></span><br><span class="line"><span class="keyword">let</span> pubSub = &#123;</span><br><span class="line">  list: &#123;&#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// è®¢é˜…</span></span><br><span class="line">  subscribe: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.list[key]) <span class="keyword">this</span>.list[key] = [];</span><br><span class="line">    <span class="comment">//å¯èƒ½æ˜¯å¤šä¸ª</span></span><br><span class="line">    <span class="keyword">this</span>.list[key].push(fn);</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//å–æ¶ˆè®¢é˜…</span></span><br><span class="line">  unsubscribe: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fnList = <span class="keyword">this</span>.list[key];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (!fnList) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (!fn) &#123; <span class="comment">// ä¸ä¼ å…¥æŒ‡å®šçš„æ–¹æ³•ï¼Œæ¸…ç©ºæ‰€ç”¨ key ä¸‹çš„è®¢é˜…</span></span><br><span class="line">      fnList &amp;&amp; (fnList.length = <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> curFn =  fnList.filter(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>  item !== fn </span><br><span class="line">      &#125;);</span><br><span class="line">     <span class="keyword">this</span>.list[key]=curFn</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// å‘å¸ƒ</span></span><br><span class="line">  publish: <span class="function"><span class="keyword">function</span>(<span class="params">key, ...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> fn <span class="keyword">of</span> <span class="keyword">this</span>.list[key]) fn.call(<span class="keyword">this</span>, ...args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> sub1 = <span class="function"><span class="keyword">function</span> (<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`ä¸Šç­äº†ï¼š<span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> sub2 = <span class="function"><span class="keyword">function</span> (<span class="params">time</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`ä¸‹ç­äº†ï¼š<span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¢é˜…</span></span><br><span class="line">pubSub.subscribe(<span class="string">'onwork'</span>,sub1 )</span><br><span class="line">pubSub.subscribe(<span class="string">'onwork'</span>, sub2 )</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å‘å¸ƒ</span></span><br><span class="line">pubSub.publish(<span class="string">'onwork'</span>, <span class="string">'18:00:00'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">pubSub.unsubscribe(<span class="string">'onwork'</span>);</span><br></pre></td></tr></table></figure><p><strong>DOM çš„äº‹ä»¶ç›‘å¬æ˜¯â€å‘å¸ƒè®¢é˜…æ¨¡å¼â€</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span>  hzf = <span class="built_in">document</span>.getElementById(<span class="string">'#hzf'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç›‘å¬å›è°ƒå‡½æ•°ï¼ˆæŒ‡å®šäº‹ä»¶ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notifyClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆ‘è¢«ç‚¹å‡»äº†'</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ·»åŠ äº‹ä»¶ç›‘å¬</span></span><br><span class="line">hzf.addEventListener(<span class="string">'click'</span>, notifyClick);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·è§¦å‘ç‚¹å‡», äº‹ä»¶ä¸­å¿ƒæ´¾å‘æŒ‡å®šäº‹ä»¶</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// å–æ¶ˆäº‹ä»¶ç›‘å¬</span></span><br><span class="line">loginBtn.removeEventListener(<span class="string">'click'</span>, notifyClick);</span><br></pre></td></tr></table></figure><h4 id="ä¸¤ç§æ¨¡å¼çš„å…³è”å’ŒåŒºåˆ«"><a href="#ä¸¤ç§æ¨¡å¼çš„å…³è”å’ŒåŒºåˆ«" class="headerlink" title="ä¸¤ç§æ¨¡å¼çš„å…³è”å’ŒåŒºåˆ«"></a>ä¸¤ç§æ¨¡å¼çš„å…³è”å’ŒåŒºåˆ«</h4><p>å‘å¸ƒè®¢é˜…æ¨¡å¼æ›´çµæ´»ï¼Œæ˜¯è¿›é˜¶ç‰ˆçš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œ<code>æŒ‡å®š</code>å¯¹åº”åˆ†å‘ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼ç»´æŠ¤<code>å•ä¸€</code>äº‹ä»¶å¯¹åº”å¤šä¸ªä¾èµ–è¯¥äº‹ä»¶çš„å¯¹è±¡å…³ç³»ï¼›<br/><br>å‘å¸ƒè®¢é˜…ç»´æŠ¤<code>å¤šä¸ª</code>äº‹ä»¶ï¼ˆä¸»é¢˜ï¼‰åŠä¾èµ–å„äº‹ä»¶ï¼ˆä¸»é¢˜ï¼‰çš„å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼›</p><p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ç›®æ ‡å¯¹è±¡ç›´æ¥è§¦å‘é€šçŸ¥ï¼ˆå…¨éƒ¨é€šçŸ¥ï¼‰ï¼Œè§‚å¯Ÿå¯¹è±¡è¢«è¿«æ¥æ”¶é€šçŸ¥ã€‚<br/><br>å‘å¸ƒè®¢é˜…æ¨¡å¼å¤šäº†ä¸ªä¸­é—´å±‚ï¼ˆäº‹ä»¶ä¸­å¿ƒï¼‰ï¼Œç”±å…¶å»ç®¡ç†é€šçŸ¥å¹¿æ’­ï¼ˆåªé€šçŸ¥è®¢é˜…å¯¹åº”äº‹ä»¶çš„å¯¹è±¡ï¼‰ï¼›</p><p>è§‚å¯Ÿè€…æ¨¡å¼å¯¹è±¡é—´ä¾èµ–å…³ç³»è¾ƒå¼ºï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­å¯¹è±¡ä¹‹é—´å®ç°çœŸæ­£çš„è§£è€¦ã€‚</p><h4 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h4><p><a href="https://juejin.im/post/5c0a9d9bf265da612909ff1b" target="_blank" rel="noopener">è§‚å¯Ÿè€…æ¨¡å¼ vs å‘å¸ƒè®¢é˜…æ¨¡å¼</a></p><p><a href="https://juejin.im/post/5d25a2316fb9a07f04207010" target="_blank" rel="noopener">è§‚å¯Ÿè€…æ¨¡å¼ä¸å‘å¸ƒè®¢é˜…æ¨¡å¼</a></p><p><a href="https://juejin.im/post/591a4f2a128fe1005cda28df" target="_blank" rel="noopener">è§‚å¯Ÿè€…æ¨¡å¼</a></p><h3 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h3><h3 id="æœªå®Œå¾…ç»­â€¦â€¦"><a href="#æœªå®Œå¾…ç»­â€¦â€¦" class="headerlink" title="æœªå®Œå¾…ç»­â€¦â€¦."></a>æœªå®Œå¾…ç»­â€¦â€¦.</h3>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>for inå’Œfor ofåŒºåˆ«</title>
      <link href="/2018/01/16/workspace/Js/for-in-for-of/"/>
      <url>/2018/01/16/workspace/Js/for-in-for-of/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>for inå’Œfor ofåŒºåˆ«</strong></p><p>[[toc]]</p><h3 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a>for in</h3><p>ä»¥ä»»æ„é¡ºåºéå†ä¸€ä¸ªå¯¹è±¡çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Enumerability_and_ownership_of_properties" target="_blank" rel="noopener">å¯æšä¸¾å±æ€§</a>ã€‚éå†æ•°ç»„æ—¶ï¼Œkeyä¸ºæ•°ç»„ä¸‹æ ‡å­—ç¬¦ä¸²ï¼›éå†å¯¹è±¡ï¼Œkeyä¸ºå¯¹è±¡å­—æ®µåã€‚</p><h4 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [&#123;<span class="attr">age</span>: <span class="number">1</span>&#125;, &#123;<span class="attr">age</span>: <span class="number">5</span>&#125;, &#123;<span class="attr">age</span>: <span class="number">100</span>&#125;, &#123;<span class="attr">age</span>: <span class="number">34</span>&#125;]</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> arr) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key, arr[key])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å°</span></span><br><span class="line"><span class="comment">// 0 &#123;age: 1&#125;</span></span><br><span class="line"><span class="comment">// 1 &#123;age: 5&#125;</span></span><br><span class="line"><span class="comment">// 2 &#123;age: 100&#125;</span></span><br><span class="line"><span class="comment">// 3 &#123;age: 34&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> arr) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(arr[key]); <span class="comment">// ä¼šæ­£å¸¸æ‰“å° 1, 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½†æ˜¯å¦‚æœåœ¨ Array åŸå‹é“¾ä¸Šæ·»åŠ ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.test = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> arr) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(arr[key]); <span class="comment">// æ­¤æ—¶ä¼šæ‰“å° 1, 2, Æ’ () &#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">f1</span>: <span class="string">'test1'</span>, <span class="attr">f2</span>: <span class="string">'test2'</span>&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key, obj[key])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å°</span></span><br><span class="line"><span class="comment">// f1 test1</span></span><br><span class="line"><span class="comment">// f2 test2</span></span><br></pre></td></tr></table></figure><h4 id="for-in-ç¼ºç‚¹"><a href="#for-in-ç¼ºç‚¹" class="headerlink" title="for in ç¼ºç‚¹"></a>for in ç¼ºç‚¹</h4><ol><li>for in è¿­ä»£é¡ºåºä¾èµ–äºæ‰§è¡Œç¯å¢ƒï¼Œä¸ä¸€å®šä¿è¯é¡ºåº</li><li>for in ä¸ä»…ä¼šéå†å½“å‰å¯¹è±¡ï¼Œè¿˜åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„å¯æšä¸¾å±æ€§</li><li>for in æ²¡æœ‰breakä¸­æ–­</li><li>for in ä¸é€‚åˆéå†æ•°ç»„ï¼Œä¸»è¦åº”ç”¨ä¸ºå¯¹è±¡</li></ol><h4 id="Object-keys-å’Œfor-inçš„åŒºåˆ«"><a href="#Object-keys-å’Œfor-inçš„åŒºåˆ«" class="headerlink" title="Object.keys()å’Œfor inçš„åŒºåˆ«"></a>Object.keys()å’Œfor inçš„åŒºåˆ«</h4><ul><li>éå†ç»“æœä¸ºç”±å¯¹è±¡è‡ªèº«å¯æšä¸¾å±æ€§ç»„æˆçš„<code>æ•°ç»„</code>ï¼Œæ•°ç»„ä¸­çš„å±æ€§åæ’åˆ—é¡ºåºä¸ä½¿ç”¨for inå¾ªç¯éå†è¯¥å¯¹è±¡æ—¶è¿”å›çš„é¡ºåºä¸€è‡´ï¼›</li><li>ä¸for inåŒºåˆ«åœ¨äº<code>ä¸èƒ½éå†</code>å‡ºåŸå‹é“¾ä¸Šçš„å±æ€§ï¼›</li></ul><h3 id="for-of"><a href="#for-of" class="headerlink" title="for of"></a>for of</h3><p>ES6å¼•å…¥çš„æ–°è¯­æ³•ã€‚åœ¨<code>å¯è¿­ä»£å¯¹è±¡</code>ï¼ˆåŒ…æ‹¬ Arrayï¼ŒMapï¼ŒSetï¼ŒStringï¼ŒTypedArrayï¼Œargumentså¯¹è±¡ï¼ŒNodeListå¯¹è±¡ï¼‰ä¸Šåˆ›å»ºä¸€ä¸ªè¿­ä»£å¾ªç¯,è°ƒç”¨è‡ªå®šä¹‰è¿­ä»£é’©å­ï¼Œå¹¶ä¸ºæ¯ä¸ªä¸åŒå±æ€§çš„å€¼æ‰§è¡Œè¯­å¥ã€‚</p><p><code>Objectå¯¹è±¡ä¸æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œæ•…for of ä¸æ”¯æŒã€‚</code>for ofæœ‰ä¸ªå¾ˆå¤§çš„ç‰¹ç‚¹æ˜¯æ”¯æŒæ•°ç»„çš„breakä¸­æ–­ã€‚</p><h4 id="æ•°ç»„-1"><a href="#æ•°ç»„-1" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [&#123;<span class="attr">age</span>: <span class="number">1</span>&#125;, &#123;<span class="attr">age</span>: <span class="number">5</span>&#125;, &#123;<span class="attr">age</span>: <span class="number">100</span>&#125;, &#123;<span class="attr">age</span>: <span class="number">34</span>&#125;]</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> &#123;age&#125; <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="keyword">if</span> (age &gt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span> <span class="comment">// for of å…è®¸ä¸­æ–­</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(age)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å°</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 5</span></span><br></pre></td></tr></table></figure><h4 id="ä¸‰ä¸ªæ•°ç»„ï¼šarr1-1-2-3-4-arr2-4-5-6-arr3-5-å°†arr1ä¸arr2åˆå¹¶ï¼Œå»é‡ï¼Œç„¶åè¿”å›ä¸åŒ…å«arr3ä¸­å…ƒç´ çš„æ–°æ•°ç»„ï¼ˆç”¨es6æ ‡å‡†çš„æ–°ç‰¹æ€§å®ç°ï¼‰"><a href="#ä¸‰ä¸ªæ•°ç»„ï¼šarr1-1-2-3-4-arr2-4-5-6-arr3-5-å°†arr1ä¸arr2åˆå¹¶ï¼Œå»é‡ï¼Œç„¶åè¿”å›ä¸åŒ…å«arr3ä¸­å…ƒç´ çš„æ–°æ•°ç»„ï¼ˆç”¨es6æ ‡å‡†çš„æ–°ç‰¹æ€§å®ç°ï¼‰" class="headerlink" title="ä¸‰ä¸ªæ•°ç»„ï¼šarr1=[1,2,3,4],arr2=[4,5,6],arr3=[5],å°†arr1ä¸arr2åˆå¹¶ï¼Œå»é‡ï¼Œç„¶åè¿”å›ä¸åŒ…å«arr3ä¸­å…ƒç´ çš„æ–°æ•°ç»„ï¼ˆç”¨es6æ ‡å‡†çš„æ–°ç‰¹æ€§å®ç°ï¼‰"></a>ä¸‰ä¸ªæ•°ç»„ï¼šarr1=[1,2,3,4],arr2=[4,5,6],arr3=[5],å°†arr1ä¸arr2åˆå¹¶ï¼Œå»é‡ï¼Œç„¶åè¿”å›ä¸åŒ…å«arr3ä¸­å…ƒç´ çš„æ–°æ•°ç»„ï¼ˆç”¨es6æ ‡å‡†çš„æ–°ç‰¹æ€§å®ç°ï¼‰</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], arr2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], arr3 = [<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">arr1, arr2, arr3</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> ary4 = [...arr1, ...arr2];</span><br><span class="line">    <span class="keyword">let</span> ary5 = [...new <span class="built_in">Set</span>(ary4)];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> [ind, item] <span class="keyword">of</span> ary5.entries()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr3.includes(item)) &#123;</span><br><span class="line">            ary5.splice(ind, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ary5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="for-of-ä¼˜ç‚¹"><a href="#for-of-ä¼˜ç‚¹" class="headerlink" title="for of ä¼˜ç‚¹"></a>for of ä¼˜ç‚¹</h4><ol><li>for of æœ‰ä¸for in ä¸€æ ·çš„ç®€æ´è¯­æ³•ï¼ˆè¿™ä¹Ÿæ˜¯ä¸¤è€…å®¹æ˜“æ··ä¹±çš„ç‚¹ï¼‰ï¼Œä½†æ²¡æœ‰for inçš„ç¼ºç‚¹</li><li>for of ä¿è¯é¡ºåºä¸”ä¸ä¼šä»…éå†å½“å‰å¯¹è±¡</li><li>for of å¯ä¸breakï¼Œcontinueï¼Œreturné…åˆ</li></ol>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
          <category> for inå’Œfor ofåŒºåˆ« </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Objectçš„æ–¹æ³•ç®€å•æ•´ç†</title>
      <link href="/2018/01/16/workspace/Js/object/"/>
      <url>/2018/01/16/workspace/Js/object/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Objectçš„æ–¹æ³•ç®€å•æ•´ç†</strong></p><p>[[toc]]</p><h3 id="Object-create"><a href="#Object-create" class="headerlink" title="Object.create()"></a>Object.create()</h3><p>æè¿°ï¼šè¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå°†å¯¹è±¡ç»§æ‰¿åˆ°<strong>proto</strong>å±æ€§ä¸Š<br/><br>æ ¼å¼ï¼šObject.create(proto[, propertiesObject])<br/><br>ç”¨æ³•ï¼šå¦‚æœç”¨ä¼ ç»Ÿçš„æ–¹æ³•è¦ç»™ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ä¸Šæ·»åŠ å±æ€§å’Œæ–¹æ³•ï¼Œæ˜¯é€šè¿‡ <strong>propt</strong> å®ç°çš„<br/></p><p>é€šè¿‡æ„é€ å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°æˆ–è€…ç±»</span></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°æˆ–è€…ç±»</span></span><br><span class="line"><span class="keyword">var</span> People = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">People.prototype.y = <span class="number">20</span></span><br><span class="line">People.prototype.showNum = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">//é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> People();</span><br><span class="line"><span class="built_in">console</span>.log(p.__proto__ === People.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>Object.create()</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> proto = &#123;</span><br><span class="line">    y: <span class="number">20</span>,</span><br><span class="line">    z: <span class="number">40</span>,</span><br><span class="line">    showNum()&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> o = <span class="built_in">Object</span>.create(proto);</span><br></pre></td></tr></table></figure><h3 id="Object-defineProperty"><a href="#Object-defineProperty" class="headerlink" title="Object.defineProperty()"></a>Object.defineProperty()</h3><p>Object.defineProperty(obj, prop, descriptor)</p><p>obj: éœ€è¦è¢«æ“ä½œçš„ç›®æ ‡å¯¹è±¡<br/><br>prop: ç›®æ ‡å¯¹è±¡éœ€è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åç§°<br/><br>descriptor: å°†è¢«å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„æè¿°ç¬¦<br/></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">'name'</span>, &#123;</span><br><span class="line">    configurable: <span class="literal">false</span>,</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    value: <span class="string">'å¼ ä¸‰'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.name)  <span class="comment">//å¼ ä¸‰</span></span><br></pre></td></tr></table></figure><h3 id="Object-defineProperties"><a href="#Object-defineProperties" class="headerlink" title="Object.defineProperties()"></a>Object.defineProperties()</h3><p>Object.defineProperties(obj, props)</p><p>obj: å°†è¦è¢«æ·»åŠ å±æ€§æˆ–ä¿®æ”¹å±æ€§çš„å¯¹è±¡<br/><br>props: è¯¥å¯¹è±¡çš„ä¸€ä¸ªæˆ–å¤šä¸ªé”®å€¼å¯¹å®šä¹‰äº†å°†è¦ä¸ºå¯¹è±¡æ·»åŠ æˆ–ä¿®æ”¹çš„å±æ€§çš„å…·ä½“é…ç½®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(obj, &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        value: <span class="string">'å¼ ä¸‰'</span>,</span><br><span class="line">        configurable: <span class="literal">false</span>,</span><br><span class="line">        writable: <span class="literal">true</span>,</span><br><span class="line">        enumerable: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        value: <span class="number">18</span>,</span><br><span class="line">        configurable: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj) <span class="comment">// å¼ ä¸‰, 18</span></span><br></pre></td></tr></table></figure><h3 id="Object-getPrototypeOf"><a href="#Object-getPrototypeOf" class="headerlink" title="Object.getPrototypeOf()"></a>Object.getPrototypeOf()</h3><p>æè¿°ï¼šç”¨äºè¯»å–ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼›</p><p>æ ¼å¼ï¼šObject.getPrototypeOf(obj);</p><p>ç”¨æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getPrototypeOf(<span class="string">'foo'</span>) === <span class="built_in">String</span>.prototype === <span class="string">'foo'</span>.__proto__ <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(<span class="literal">true</span>) === <span class="built_in">Boolean</span>.prototype === <span class="literal">true</span>.__proto__ <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="Object-setPrototypeOf"><a href="#Object-setPrototypeOf" class="headerlink" title="Object.setPrototypeOf("></a>Object.setPrototypeOf(</h3><p>æè¿°: Object.setPrototypeOfæ–¹æ³•çš„ä½œç”¨ä¸_proto_ç›¸åŒï¼Œç”¨æ¥è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„prototypeå¯¹è±¡ï¼Œè¿”å›å‚æ•°å¯¹è±¡æœ¬èº«</p><p>æ ¼å¼ï¼šObject.setPrototypeOf(object, prototype)</p><p>è¯¥æ–¹æ³•ç­‰åŒäºä¸‹é¢çš„å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">obj, proto</span>) </span>&#123;</span><br><span class="line">  obj.__proto__ = proto;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> proto = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">x</span>: <span class="number">10</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(obj, proto);</span><br><span class="line"> </span><br><span class="line">proto.y = <span class="number">20</span>;</span><br><span class="line">proto.z = <span class="number">40</span>;</span><br><span class="line"> </span><br><span class="line">obj.x <span class="comment">// 10</span></span><br><span class="line">obj.y <span class="comment">// 20</span></span><br><span class="line">obj.z <span class="comment">// 40</span></span><br></pre></td></tr></table></figure><h3 id="keys-amp-values-amp-entries"><a href="#keys-amp-values-amp-entries" class="headerlink" title="keys &amp; values &amp; entries"></a>keys &amp; values &amp; entries</h3><ul><li>Object.keys   é”®</li><li>Object.values  å€¼ </li><li>Object.entries  ç»„ä»¶äºŒçº§æ•°ç»„</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj =  &#123;</span><br><span class="line">    address: <span class="string">"434343422"</span>,</span><br><span class="line">    admin: <span class="string">"3434"</span>,</span><br><span class="line">    adminCharater: <span class="string">'4444'</span>,</span><br><span class="line">    adminRecord: <span class="string">'33'</span>,</span><br><span class="line">    article: <span class="string">'22'</span>,</span><br><span class="line">    artist: <span class="string">'11'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">Object</span>.entries(obj)<span class="comment">// [["address", "434343422"]...]</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(obj) <span class="comment">//["address", "admin", "adminCharater", "adminRecord", "article", "artist"]</span></span><br><span class="line">  <span class="built_in">Object</span>.values(obj) <span class="comment">//["434343422", "3434", "4444", "33", "22", "11"]</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//éå†æ•°ç»„ï¼Œå­—ç¬¦ä¸²ç­‰...</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> value <span class="keyword">of</span> <span class="built_in">Object</span>.values(obj)) &#123; </span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//éå†å¯¹è±¡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> value <span class="keyword">in</span> obj) &#123; </span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Object-keysã€Object-getOwnPropertyNamesåŒºåˆ«"><a href="#Object-keysã€Object-getOwnPropertyNamesåŒºåˆ«" class="headerlink" title="Object.keysã€Object.getOwnPropertyNamesåŒºåˆ«"></a>Object.keysã€Object.getOwnPropertyNamesåŒºåˆ«</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="string">"prop1"</span>: <span class="string">"v1"</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"prop2"</span>, &#123; <span class="attr">value</span>: <span class="string">"v2"</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj).length);           <span class="comment">//outputï¼š1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyNames(obj).length);    <span class="comment">//outputï¼š2</span></span><br></pre></td></tr></table></figure><p><strong>å†…ç½®çš„åˆ¤æ–­ï¼Œè®¿é—®å’Œè¿­ä»£æ–¹æ³•</strong></p><table><thead><tr><th align="left">åŠŸèƒ½</th><th align="left">å¯æšä¸¾(writable:true)</th><th align="left">å¯æšä¸¾ã€ä¸å¯æšä¸¾</th></tr></thead><tbody><tr><td align="left">åˆ¤æ–­</td><td align="left">propertyIsEnumerable</td><td align="left">in/hasOwnProperty</td></tr><tr><td align="left">è®¿é—®</td><td align="left">Object.keys</td><td align="left">Object.getOwnPropertyNames</td></tr><tr><td align="left">è¿­ä»£</td><td align="left">for..in..</td><td align="left">Object.getOwnPropertyNames</td></tr></tbody></table><h3 id="lodash-pick"><a href="#lodash-pick" class="headerlink" title="lodash/pick"></a>lodash/pick</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> <span class="variable">obj</span></span> - å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;array&#125;</span> <span class="variable">props</span></span> - è¦å–é‚£äº›å±æ€§</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;function&#125;</span> <span class="variable">predicate</span></span> - å›è°ƒ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;object&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">basePickBy</span>(<span class="params">obj, props, predicate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> props.reduce(<span class="function">(<span class="params">acc, key</span>) =&gt;</span> &#123;</span><br><span class="line">      predicate(obj[key], key) &amp;&amp; (acc[key] = obj[key]);</span><br><span class="line">      <span class="keyword">return</span> acc;</span><br><span class="line">    &#125;, &#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pick</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">obj</span></span> - å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">props</span></span> - è¦å–é‚£äº›å±æ€§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pick</span>(<span class="params">obj, props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> basePickBy(obj, props, (value, key) =&gt; key <span class="keyword">in</span> obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = &#123;<span class="attr">message</span>: <span class="string">"Foo"</span>, <span class="attr">a</span>: <span class="number">11</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>&#125;</span><br><span class="line">pick(data,[<span class="string">'a'</span>,<span class="string">'b'</span>])  <span class="comment">// &#123;a: 11, b: 2&#125;</span></span><br></pre></td></tr></table></figure><h3 id="æµ…æ‹·è´-æ·±æ‹·è´"><a href="#æµ…æ‹·è´-æ·±æ‹·è´" class="headerlink" title="æµ…æ‹·è´/æ·±æ‹·è´"></a>æµ…æ‹·è´/æ·±æ‹·è´</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æµ…å…‹éš† [å±‚çº§åµŒå¥—ä¸èƒ½è¶…è¿‡2çº§,åŒ…æ‹¬2çº§]</span></span><br><span class="line"><span class="keyword">const</span> clone = <span class="function"><span class="params">source</span> =&gt;</span> <span class="built_in">Object</span>.assign(&#123;&#125;, source)</span><br><span class="line"><span class="keyword">const</span> clone = <span class="function"><span class="params">source</span> =&gt;</span> &#123; ...source &#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ·±å…‹éš†</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepclone</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">typeof</span> obj === <span class="string">'object'</span> &amp;&amp; obj !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> o = obj.push?[]:&#123;&#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(obj.push);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> attr <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        <span class="keyword">if</span>(obj.hasOwnProperty(attr))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">typeof</span> obj[attr] === <span class="string">'object'</span>)&#123;</span><br><span class="line">                o[attr] = deepclone(obj[attr]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                o[attr] = obj[attr];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or å–å·§æ–¹æ³• JSON.parse(JSON.stringify());</span></span><br><span class="line"><span class="comment">// æ³¨æ„è¿™ç§å–å·§æ–¹æ³•æ˜¯æœ‰é™åˆ¶çš„</span></span><br><span class="line"><span class="comment">// 1. åªèƒ½è§£æNumberã€Stringã€Arrayç­‰èƒ½å¤Ÿè¢«jsonè¡¨ç¤ºçš„æ•°æ®ç»“æ„ï¼ˆæ— æ³•æ‹·è´ä¸€å†™ç‰¹æ®Šçš„å¯¹è±¡ï¼Œè¯¸å¦‚ RegExp, Date, Set, Mapï¼Œå‡½æ•° ç­‰ã€‚ï¼‰</span></span><br><span class="line"><span class="comment">// 2. ä¸èƒ½å¤„ç†å¾ªç¯å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">val</span>:<span class="number">2</span>&#125;;</span><br><span class="line">obj.target = obj;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‹·è´objä¼šå‡ºç°ç³»ç»Ÿæ ˆæº¢å‡ºï¼Œå› ä¸ºå‡ºç°äº†æ— é™é€’å½’çš„æƒ…å†µã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line"></span><br><span class="line"><span class="comment">//VM913:1 Uncaught TypeError: Converting circular structure to JSON</span></span><br><span class="line"><span class="comment">//--&gt; starting at object with constructor 'Object'</span></span><br><span class="line"><span class="comment">//--- property 'target' closes the circle</span></span><br><span class="line"><span class="comment">//at JSON.stringify (&lt;anonymous&gt;)</span></span><br><span class="line"><span class="comment">//at &lt;anonymous&gt;:1:17</span></span><br><span class="line"><span class="comment">//(anonymous) @ VM913:1</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£å†³æ­»å¾ªç¯çš„é—®é¢˜</span></span><br><span class="line"><span class="keyword">const</span> isObject = <span class="function">(<span class="params">target</span>) =&gt;</span> (<span class="keyword">typeof</span> target === <span class="string">'object'</span> || <span class="keyword">typeof</span> target === <span class="string">'function'</span>) &amp;&amp; target !== <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deepClone = <span class="function">(<span class="params">target, map = <span class="keyword">new</span> <span class="built_in">Map</span>(</span>)) =&gt;</span> &#123; </span><br><span class="line">    </span><br><span class="line">  <span class="comment">//å¦‚æœæœ‰çš„è¯ç›´æ¥è·³è¿‡</span></span><br><span class="line">  <span class="keyword">if</span>(map.get(target))  <span class="keyword">return</span> target; </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (isObject(target)) &#123; </span><br><span class="line">    map.set(target, <span class="literal">true</span>); </span><br><span class="line">    <span class="keyword">const</span> cloneTarget = <span class="built_in">Array</span>.isArray(target) ? []: &#123;&#125;; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> target) &#123; </span><br><span class="line">      <span class="keyword">if</span> (target.hasOwnProperty(prop)) &#123; </span><br><span class="line">          cloneTarget[prop] = deepClone(target[prop],map); </span><br><span class="line">      &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> cloneTarget; </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> target; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//map å’Œ aä¸€ç›´æ˜¯å¼ºå¼•ç”¨çš„å…³ç³»ï¼Œ åœ¨ç¨‹åºç»“æŸä¹‹å‰ï¼Œa æ‰€å çš„å†…å­˜ç©ºé—´ä¸€ç›´ä¸ä¼šè¢«é‡Šæ”¾ã€‚</span></span><br><span class="line"><span class="comment">//å¼±å¼•ç”¨çš„å¯¹è±¡å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è¢«å›æ”¶ï¼Œè€Œå¯¹äºå¼ºå¼•ç”¨æ¥è¯´ï¼Œåªè¦è¿™ä¸ªå¼ºå¼•ç”¨è¿˜åœ¨ï¼Œé‚£ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ES6ç»™æˆ‘ä»¬æä¾›äº†è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œå®ƒçš„åå­—å«WeakMap,å®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„Map, å…¶ä¸­çš„é”®æ˜¯å¼±å¼•ç”¨çš„ã€‚`å…¶é”®å¿…é¡»æ˜¯å¯¹è±¡`ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„çš„</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¨å¾®æ”¹é€ ä¸€ä¸‹å³å¯:</span></span><br><span class="line"><span class="keyword">const</span> deepClone = <span class="function">(<span class="params">target, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>(</span>)) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯¹è±¡è½¬åŸå§‹ç±»å‹æ˜¯æ ¹æ®ä»€ä¹ˆæµç¨‹è¿è¡Œçš„ï¼Ÿ"><a href="#å¯¹è±¡è½¬åŸå§‹ç±»å‹æ˜¯æ ¹æ®ä»€ä¹ˆæµç¨‹è¿è¡Œçš„ï¼Ÿ" class="headerlink" title="å¯¹è±¡è½¬åŸå§‹ç±»å‹æ˜¯æ ¹æ®ä»€ä¹ˆæµç¨‹è¿è¡Œçš„ï¼Ÿ"></a>å¯¹è±¡è½¬åŸå§‹ç±»å‹æ˜¯æ ¹æ®ä»€ä¹ˆæµç¨‹è¿è¡Œçš„ï¼Ÿ</h3><p>å¯¹è±¡è½¬åŸå§‹ç±»å‹ï¼Œä¼šä¼˜å…ˆè°ƒç”¨å†…ç½®çš„[ToPrimitive]å‡½æ•°ï¼Œå¯¹äºè¯¥å‡½æ•°è€Œè¨€ï¼Œå…¶é€»è¾‘å¦‚ä¸‹ï¼š</p><p>å¦‚æœSymbol.toPrimitive()æ–¹æ³•ï¼Œä¼˜å…ˆè°ƒç”¨å†è¿”å›<br/><br>è°ƒç”¨valueOf()ï¼Œå¦‚æœè½¬æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™è¿”å›<br/><br>è°ƒç”¨toString()ï¼Œå¦‚æœè½¬æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™è¿”å›<br/><br>å¦‚æœéƒ½æ²¡æœ‰è¿”å›åŸå§‹ç±»å‹ï¼Œä¼šæŠ¥é”™</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">const</span> obj = &#123;</span><br><span class="line">  value: <span class="number">3</span>,</span><br><span class="line">  valueOf() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'5'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">6</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj + <span class="number">1</span>); <span class="comment">// è¾“å‡º7</span></span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•è®©if-a-1-amp-amp-a-2-æ¡ä»¶æˆç«‹ï¼Ÿ"><a href="#å¦‚ä½•è®©if-a-1-amp-amp-a-2-æ¡ä»¶æˆç«‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®©if(a == 1 &amp;&amp; a == 2)æ¡ä»¶æˆç«‹ï¼Ÿ"></a>å¦‚ä½•è®©if(a == 1 &amp;&amp; a == 2)æ¡ä»¶æˆç«‹ï¼Ÿ</h3><p>å°±æ˜¯ä¸Šé¢ä¾‹å­çš„åº”ç”¨</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">  value: <span class="number">0</span>,</span><br><span class="line">  valueOf() &#123;</span><br><span class="line">    <span class="keyword">this</span>.value++;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(a == <span class="number">1</span> &amp;&amp; a == <span class="number">2</span>,a);<span class="comment">//true</span></span><br></pre></td></tr></table></figure><h3 id="å¯¹è±¡æ¯”è¾ƒ"><a href="#å¯¹è±¡æ¯”è¾ƒ" class="headerlink" title="å¯¹è±¡æ¯”è¾ƒ"></a>å¯¹è±¡æ¯”è¾ƒ</h3><h4 id="hashcode"><a href="#hashcode" class="headerlink" title="hashcode"></a>hashcode</h4><p>javascript å¯¹è±¡çš„æ¯”è¾ƒæ˜¯æ¯”è¾ƒå‘çˆ¹çš„ä¸€ä»¶äº‹ï¼Œå› ä¸ºjavascriptå¯¹è±¡æ¯”è¾ƒçš„æ˜¯å¼•ç”¨åœ°å€ï¼Œå½“ä¸¤ä¸ªå¼•ç”¨åœ°å€ç›¸åŒçš„å¯¹è±¡æ€»æ˜¯ç›¸ç­‰çš„,æˆ–è€…ä¸¤ä¸ªå®Œå…¨ä¸€æ ·çš„å¯¹è±¡ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">var</span> object1=&#123;</span><br><span class="line">    name:<span class="string">"1234 "</span>,</span><br><span class="line">    code:<span class="number">123</span>,</span><br><span class="line">    test:<span class="string">"321"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> object2=&#123;</span><br><span class="line">    name:<span class="string">"1234 "</span>,</span><br><span class="line">    code:<span class="number">123</span>,</span><br><span class="line">    test:<span class="string">"321"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(object1===object2)   <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ä½¿ç”¨hashcode</p><p>è¿™é‡Œåªæ˜¯ç®€å•çš„èµ°ä¸ªæµç¨‹ï¼Œè¯¦ç»†çš„è¯·æŸ¥çœ‹<code>js-hash-code</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hashCode</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> hash = <span class="number">0</span>, i, chr, len;</span><br><span class="line">  <span class="keyword">if</span> (str.length === <span class="number">0</span>) <span class="keyword">return</span> hash;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>, len = str.length; i &lt; len; i++) &#123;</span><br><span class="line">    chr   = str.charCodeAt(i);</span><br><span class="line">    hash  = ((hash &lt;&lt; <span class="number">5</span>) - hash) + chr;</span><br><span class="line">    hash |= <span class="number">0</span>; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;&lt;æ˜¯ç§»ä½ç¬¦ </span><br><span class="line"></span><br><span class="line">ç§»ä½è¿ç®—å°±æ˜¯å¯¹äºŒè¿›åˆ¶è¿›è¡Œæœ‰è§„å¾‹ä½ç§»ä½ã€‚ç§»ä½è¿ç®—å¯ä»¥è®¾è®¡å¾ˆå¤šå¥‡å¦™çš„æ•ˆæœï¼Œåœ¨å›¾å½¢å›¾åƒç¼–ç¨‹ä¸­åº”ç”¨å¹¿æ³›ã€‚</span><br><span class="line"></span><br><span class="line">|&#x3D; æŒ‰ä½æˆ–ï¼ç„¶åèµ‹å€¼ï¼</span><br><span class="line"></span><br><span class="line">i&#x3D;1;&#x2F;&#x2F;äºŒè¿›åˆ¶ä¸º0001</span><br><span class="line">i|2;&#x2F;&#x2F;2çš„äºŒè¿›åˆ¶ä¸º0010 ä¸¤ä¸ªæŒ‰ä½æˆ–ä¸º0011ä¹Ÿå°±æ˜¯3</span><br><span class="line">i|&#x3D;2ç­‰ä»·äºi&#x3D;i|2;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(object1===object2);  <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test1=hashCode(<span class="built_in">JSON</span>.stringify(object1));</span><br><span class="line"><span class="keyword">var</span> test2=hashCode(<span class="built_in">JSON</span>.stringify(object2));</span><br><span class="line"><span class="built_in">console</span>.log(test1,test2,test1===test2);  <span class="comment">//true</span></span><br></pre></td></tr></table></figure><h4 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> åˆ¤æ–­å¯¹è±¡ç›¸ç­‰çš„æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">1.å…ˆåˆ¤æ–­ä¸¤è€…æ˜¯ä¸æ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="comment">2.å¯¹è±¡çš„é”®å€¼å¯¹æ•°é‡æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">3.åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„æ‰€æœ‰keyå€¼æ˜¯å¦ç›¸ç­‰ç›¸åŒ</span></span><br><span class="line"><span class="comment">4.åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„ç›¸åº”çš„keyå¯¹åº”çš„å€¼æ˜¯å¦ç›¸åŒ</span></span><br><span class="line"><span class="comment">æ¥ä¸€ä¸ªé€’å½’åˆ¤æ–­é‡Œé¢çš„å¯¹è±¡å¾ªç¯1-4æ­¥éª¤ä»£ç å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isEqual = <span class="function">(<span class="params">obj1, obj2</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">let</span> isObj1 = obj1 <span class="keyword">instanceof</span> <span class="built_in">Object</span>;</span><br><span class="line">   <span class="keyword">let</span> isObj2 = obj2 <span class="keyword">instanceof</span> <span class="built_in">Object</span>;</span><br><span class="line">   <span class="keyword">if</span> (!isObj1 || !isObj2) <span class="keyword">return</span> <span class="built_in">Object</span>.is(obj1, obj2);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> kyes1 = <span class="built_in">Object</span>.keys(obj1);</span><br><span class="line">   <span class="keyword">let</span> kyes2 = <span class="built_in">Object</span>.keys(obj2);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (kyes1.length !== kyes2.length) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">in</span> kyes1) &#123;</span><br><span class="line">       <span class="keyword">if</span> (!kyes2.includes(kyes1[item])) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> attr <span class="keyword">in</span> obj1) &#123;</span><br><span class="line">       <span class="keyword">let</span> t1 = obj1[attr] <span class="keyword">instanceof</span> <span class="built_in">Object</span>;</span><br><span class="line">       <span class="keyword">let</span> t2 = obj2[attr] <span class="keyword">instanceof</span> <span class="built_in">Object</span>;</span><br><span class="line">       <span class="keyword">if</span> (t1 &amp;&amp; t2) &#123;</span><br><span class="line">           <span class="keyword">return</span> isEqual(obj1[attr], obj2[attr]);</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj1[attr] !== obj2[attr]) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noopener">MDN OBJECT</a></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
          <category> Objectçš„æ–¹æ³•ç®€å•æ•´ç† </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¾“å…¥URLèƒŒåçš„æŠ€æœ¯æ­¥éª¤</title>
      <link href="/2018/01/16/workspace/Js/http-base/"/>
      <url>/2018/01/16/workspace/Js/http-base/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>è¾“å…¥URLèƒŒåçš„æŠ€æœ¯æ­¥éª¤</strong></p><p>[[toc]]</p><p>ä¸€é“ç»å…¸çš„é¢è¯•é¢˜ï¼Œæ¶µç›–çš„çŸ¥è¯†ç‚¹éå¸¸å¤šï¼Œè¿™é‡Œè§£ç­”ä¸‹è¯¥é—®é¢˜ï¼Œä»¥å¯¹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»è¿›è¡Œæ¢³ç†ã€‚</p><ol><li>ç³»ç»Ÿå±‚<ol><li>å‘èµ·httpè¯·æ±‚ï¼Œè§£æåŸŸå</li><li>DNS<ol><li>Chromeæœç´¢è‡ªèº«DNSç¼“å­˜ã€‚chromeè¾“å…¥<code>chrome://net-internals/#dns</code>å¯æŸ¥çœ‹åˆ°</li><li>æœç´¢æ“ä½œç³»ç»Ÿè‡ªèº«DNSç¼“å­˜</li><li>è¯»å–æœ¬åœ°HOSTæ–‡ä»¶</li><li>ä»¥ä¸Šéƒ½æŸ¥è¯¢ä¸åˆ°æ—¶ï¼Œæµè§ˆå™¨å‘é€ä¸€ä¸ªDNSçš„ç³»ç»Ÿè°ƒç”¨ï¼ŒDNSè¯·æ±‚åˆ°è¾¾å®½å¸¦è¿è¥å•†æœåŠ¡å™¨ã€‚</li><li>å®½å¸¦è¿è¥å•†æœåŠ¡å™¨æŸ¥è¯¢è‡ªèº«ç¼“å­˜</li><li>æ²¡æŸ¥è¯¢æ—¶ï¼Œå‘èµ·ä¸€ä¸ªè¿­ä»£ï¼ˆé¡¶çº§åŸŸâ€“æ¬¡çº§åŸŸåâ€“â€¦ï¼‰çš„DNSè§£æè¯·æ±‚,ç›´åˆ°è·å–åˆ°åŸŸåå¯¹åº”çš„IPåœ°å€ã€‚</li></ol></li><li>æ‹¿åˆ°åŸŸåå¯¹åº”çš„IPå¹¶ç¼“å­˜<ol><li>å®½å¸¦è¿è¥å•†æœåŠ¡å™¨ç¼“å­˜DNS</li><li>ç»“æœè¿”å›æ“ä½œç³»ç»Ÿå¹¶ç¼“å­˜DNS</li><li>ç»“æœè¿”å›æµè§ˆå™¨å¹¶ç¼“å­˜DNS</li></ol></li><li>å¾—åˆ°ç›®æ ‡IPï¼Œå‘èµ·Httpâ€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œå»ºç«‹èµ·TCP/IPè¿æ¥<ol><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå¸¦æœ‰SYNæ ‡å¿—çš„æ•°æ®åŒ…ç»™æœåŠ¡ç«¯</li><li>æœåŠ¡å™¨å‘å›ç¡®è®¤åŒ…SYN/ACKæ ‡å¿—çš„æ•°æ®</li><li>å®¢æˆ·ç«¯å†å‘é€ç¡®è®¤åŒ…ACKæ ‡å¿—çš„æ•°æ®åŒ…ç»™æœåŠ¡ç«¯</li></ol></li><li>è¿æ¥æˆåŠŸåï¼Œæµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·æ ‡å‡†Httpè¯·æ±‚<ol><li>æ„å»ºHttpè¯·æ±‚æŠ¥æ–‡<ul><li>è¯·æ±‚è¡Œã€‚<ul><li>æ ¼å¼ï¼šMethod Request-URL HTTP-Version CRLFï¼Œå¦‚ï¼šGET index.html HTTP/1.1</li><li>Methodå¯é€‰é¡¹ï¼šGET, POST, PUT, DELETE, OPTIONS, HEAD</li></ul></li><li>è¯·æ±‚æŠ¥å¤´<ul><li>å…è®¸å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€’è¯·æ±‚çš„é™„åŠ ä¿¡æ¯</li><li>å¸¸è§è¯·æ±‚æŠ¥å¤´ï¼šContent-Type, Cache-Control,CookieAccept-Encoding,Accept-Language,ç­‰</li></ul></li><li>è¯·æ±‚æ­£æ–‡<ul><li>å½“ä½¿ç”¨POST, PUTç­‰æ–¹æ³•æ—¶ï¼Œé€šå¸¸éœ€è¦å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€’æ•°æ®ã€‚</li></ul></li></ul></li><li>é€šè¿‡TCPåè®®ï¼Œå‘é€åˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆHttpåè®®é»˜è®¤80ç«¯å£ã€Httpsåè®®é»˜è®¤443ï¼‰</li></ol></li><li>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç»è¿‡åç«¯å¤„ç†è¿”å›ç»“æœã€‚ï¼ˆå‰åç«¯åˆ†ç¦»ï¼‰<ul><li>å“åº”æŠ¥æ–‡<ul><li>çŠ¶æ€ç <ul><li>1xxï¼šæŒ‡ç¤ºä¿¡æ¯â€“è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†ã€‚</li><li>2xxï¼šæˆåŠŸâ€“è¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥å—ã€‚</li><li>3xxï¼šé‡å®šå‘â€“è¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œã€‚</li><li>4xxï¼šå®¢æˆ·ç«¯é”™è¯¯â€“è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è¯·æ±‚æ— æ³•å®ç°ã€‚</li><li>5xxï¼šæœåŠ¡å™¨ç«¯é”™è¯¯â€“æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚ã€‚</li></ul></li><li>å“åº”æŠ¥å¤´</li><li>å“åº”æŠ¥æ–‡</li></ul></li></ul></li><li>è¿”å›Htmlé¡µé¢ç­‰èµ„æºï¼ŒhtmlåŒ…å«css/jsç­‰èµ„æºï¼Œé‡å¤ä»¥ä¸Šhttpè¯·æ±‚</li></ol></li><li>æ¸²æŸ“å±‚<ol><li>Chromeæµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“ Blinkï¼ˆå¸¸è¯´çš„æµè§ˆå™¨å†…æ ¸ï¼‰è¾¹æ¥æ”¶è¾¹è§£æ HTML å†…å®¹ï¼Œæµè§ˆå™¨è‡ªä¸Šè€Œä¸‹é€è¡Œè§£æ HTML å†…å®¹ï¼Œç»è¿‡è¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œ<code>æ„å»º DOM æ ‘</code>ã€‚HTMLæ–‡æ¡£è¢«åŠ è½½å’Œè§£æå®Œæˆæ—¶ï¼ˆDOMæ ‘æ„å»ºå®Œæˆï¼‰ï¼Œè§¦å‘DOMContentLoadedäº‹ä»¶ï¼Œæ­¤æ—¶é¡µé¢å¯ä»¥æ¸²æŸ“å±•ç¤ºå‡ºå†…å®¹äº†ã€‚ï¼ˆhtmlå¼•ç”¨çš„å›¾ç‰‡å¯èƒ½è¿˜åœ¨httpè¯·æ±‚åŠ è½½ï¼Œå½“æ‰€æœ‰èµ„æºå…¨éƒ¨è¯·æ±‚å®Œæˆï¼Œè§¦å‘loadäº‹ä»¶ï¼‰<ul><li>å½“é‡åˆ°å¤–éƒ¨ CSS é“¾æ¥æ—¶ï¼Œä¸é˜»å¡è€Œç»§ç»­æ„å»º DOM æ ‘ã€‚</li><li>å½“é‡åˆ°å¤–éƒ¨ JS é“¾æ¥æ—¶ï¼Œå¼‚æ­¥è·å–èµ„æºã€‚JSä¸‹è½½åï¼ŒV8å¼•æ“ï¼ˆå¸¸è¯´çš„JavaScriptå¼•æ“ï¼‰ä¼šè§£æã€ç¼–è¯‘JSå†…å®¹ã€‚ç”±äº JS å¯èƒ½ä¼šä¿®æ”¹ DOM æ ‘å’Œ CSSOM æ ‘è€Œé€ æˆå›æµå’Œé‡ç»˜ï¼Œæ•…JSä¼šé˜»å¡DOMæ ‘çš„æ„å»ºã€‚</li></ul></li><li>ä¸‹è½½CSSåï¼Œä¸»çº¿ç¨‹ä¼šåœ¨åˆé€‚æ—¶æœºè§£æCSSå†…å®¹ï¼Œ<code>æ„å»º CSSOM æ ‘</code>ã€‚æœ¬æ¥æ„å»ºDOMæ ‘å’ŒCSSOMæ ‘æ˜¯å¹¶è¡Œçš„ï¼Œäº’ä¸å½±å“ï¼Œä½†å½“è§£æåˆ°ä¸Šæ–‡æåˆ°çš„JavaScriptæ—¶ï¼Œéœ€è¦æ„å»ºå®ŒæˆCSSOMæ ‘åï¼Œæ‰èƒ½æ‰§è¡Œjsä»£ç ï¼ˆDOMæ ‘æ­¤æ—¶è¢«åˆ®èµ·ï¼‰ï¼Œå› ä¸ºjså¯ä»¥æŸ¥è¯¢/ä¿®æ”¹ä»»æ„å¯¹è±¡çš„æ ·å¼ï¼Œæ­¤æ—¶éœ€è¦CSSOMæ ‘æ„å»ºå®Œæˆã€‚</li><li>æµè§ˆå™¨ç»“åˆ DOM æ ‘å’Œ CSSOM æ ‘<code>æ„å»º Render æ ‘</code>ã€‚Renderæ ‘ä¸DOMæ ‘ä¸åŒï¼Œæ¸²æŸ“æ ‘ä¸­å¹¶æ²¡æœ‰headã€displayä¸ºnoneç­‰ä¸å¿…æ˜¾ç¤ºçš„èŠ‚ç‚¹ã€‚</li><li>æµè§ˆå™¨æ¸²æŸ“ï¼ˆå¸ƒå±€ + ç»˜åˆ¶ + å¤åˆå›¾å±‚åŒ–ï¼‰ï¼Œå¸ƒå±€ï¼ˆLayoutï¼‰ç¯èŠ‚ä¸»è¦è´Ÿè´£å„å…ƒç´ å°ºå¯¸ã€ä½ç½®çš„è®¡ç®—ï¼Œç»˜åˆ¶ï¼ˆPaintï¼‰ç¯èŠ‚åˆ™æ˜¯ç»˜åˆ¶é¡µé¢åƒç´ ä¿¡æ¯ï¼Œåˆæˆï¼ˆCompositeï¼‰ç¯èŠ‚æ˜¯å¤šä¸ªå¤åˆå±‚çš„åˆæˆï¼Œæœ€ç»ˆåˆæˆçš„é¡µé¢è¢«ç”¨æˆ·çœ‹åˆ°ã€‚<ol><li>å›æµï¼šDOMèŠ‚ç‚¹ä¸­çš„å„ä¸ªå…ƒç´ éƒ½æ˜¯ä»¥ç›’æ¨¡å‹çš„å½¢å¼å­˜åœ¨ï¼Œè¿™äº›éƒ½éœ€è¦æµè§ˆå™¨å»è®¡ç®—å…¶ä½ç½®å’Œå¤§å°ç­‰</li><li>é‡ç»˜ï¼šå½“ç›’æ¨¡å‹çš„ä½ç½®,å¤§å°ä»¥åŠå…¶ä»–å±æ€§ï¼Œå¦‚é¢œè‰²,å­—ä½“,ç­‰ç¡®å®šä¸‹æ¥ä¹‹åï¼Œæµè§ˆå™¨ä¾¿å¼€å§‹ç»˜åˆ¶å†…å®¹</li></ol></li></ol></li></ol><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H258f15ed94f94b36b10619fde4732b6bn.jpg" alt="image"></p><blockquote><p>htmlå†…å®¹ä»ä¸Šåˆ°ä¸‹è§£æï¼Œæµè§ˆå™¨é‡åˆ°bodyæ ‡ç­¾å¼€å§‹æ˜¾ç¤ºå†…å®¹ã€‚CSS ä¸ä¼šé˜»å¡ DOM çš„è§£æï¼ŒJS ä¼šé˜»æ­¢DOMçš„è§£æã€‚</p></blockquote><blockquote><p>å½“æ–‡æ¡£åŠ è½½è¿‡ç¨‹ä¸­é‡åˆ°JSæ–‡ä»¶ï¼ŒHTMLæ–‡æ¡£ä¼šæŒ‚èµ·æ¸²æŸ“è¿‡ç¨‹ï¼Œä¸ä»…è¦ç­‰åˆ°æ–‡æ¡£ä¸­JSæ–‡ä»¶åŠ è½½å®Œæ¯•è¿˜è¦ç­‰å¾…è§£ææ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šç»§ç»­HTMLçš„æ¸²æŸ“è¿‡ç¨‹ã€‚</p></blockquote><blockquote><p>ç°ä»£æµè§ˆå™¨éƒ½ä½¿ç”¨äº†é¢„åŠ è½½å™¨ï¼Œåœ¨jsæŒ‚èµ·DOMè§£ææ—¶ï¼Œä¼šç»§ç»­è§£æåé¢çš„htmlï¼Œå¯»æ‰¾éœ€è¦ä¸‹è½½çš„èµ„æºã€‚é¢„åŠ è½½å™¨ä¸‹è½½è¿™äº›èµ„æºï¼Œä»¥å‡å°‘JSé˜»å¡å¸¦æ¥çš„å½±å“ã€‚</p></blockquote><h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><p>äº†è§£ä»¥ä¸Šï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“ä»¥ä¸‹è¿™äº›å‰ç«¯ä¼˜åŒ–ç‚¹ï¼š</p><ul><li><strong>httpè¯·æ±‚æ•°å‡å°‘</strong>ï¼Œå¦‚ï¼šé›ªç¢§å›¾ã€åˆå¹¶CSS/JSæ–‡ä»¶ã€ç¼“å­˜èµ„æºç­‰ï¼ˆé’ˆå¯¹http1.1ï¼‰</li><li><strong>httpè¯·æ±‚èµ„æºä½“ç§¯å‡å°‘</strong>ï¼Œå¦‚ï¼šå¯ç”¨gzipå‹ç¼©ã€å›¾ç‰‡å‹ç¼©ã€å‡å°‘cookieã€æŒ‰éœ€åŠ è½½ç­‰</li><li><strong>cssæ”¾åœ¨headä¸­</strong>ã€‚ç”±äºåŒæ—¶å…·æœ‰ DOM å’Œ CSSOM æ‰èƒ½æ„å»ºæ¸²æŸ“æ ‘ï¼Œæ‰€ä»¥HTML å’Œ CSS éƒ½æ˜¯é˜»å¡æ¸²æŸ“çš„èµ„æºï¼Œæ‰€ä»¥å°½é‡ç²¾ç®€CSSä¹Ÿæ˜¯ä¼˜åŒ–æ–¹å¼ä¹‹ä¸€ã€‚</li><li><strong>jsæ”¾åœ¨bodyåº•éƒ¨</strong>ï¼Œå‡å°‘ç™½å±æ—¶é—´ã€‚å› ä¸ºjsä¼šé˜»æ­¢æµè§ˆå™¨è§£æã€‚</li><li><strong>å‡å°‘å›æµå’Œé‡ç»˜åˆ¶</strong>ï¼Œæ¯”å¦‚ä¸è¦ä¸€æ¡ä¸€æ¡ä¿®æ”¹DOMæ ·å¼ã€ä½¿ç”¨documentFragmentæ“ä½œDOMç­‰ã€‚</li></ul><h3 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h3><ol><li>å®¢æˆ·ç«¯Aå‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­å®¢æˆ·Aåˆ°æœåŠ¡å™¨Bçš„æ•°æ®ä¼ é€ã€‚</li><li>æœåŠ¡å™¨Bæ”¶åˆ°è¿™ä¸ªFINï¼Œå®ƒå‘å›ä¸€ä¸ªACKï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1ã€‚å’ŒSYNä¸€æ ·ï¼Œä¸€ä¸ªFINå°†å ç”¨ä¸€ä¸ªåºå·ã€‚</li><li>æœåŠ¡å™¨Bå…³é—­ä¸å®¢æˆ·ç«¯Açš„è¿æ¥ï¼Œå‘é€ä¸€ä¸ªFINç»™å®¢æˆ·ç«¯Aã€‚</li><li>å®¢æˆ·ç«¯Aå‘å›ACKæŠ¥æ–‡ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ 1</li></ol><h3 id="ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜"><a href="#ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜"></a>ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜</h3><p><strong>ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥åè®®æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œå…³é—­è¿æ¥å´æ˜¯å››æ¬¡æ¡æ‰‹å‘¢ï¼Ÿ</strong></p><p>è¿™æ˜¯å› ä¸ºæœåŠ¡ç«¯çš„LISTENçŠ¶æ€ä¸‹çš„SOCKETå½“æ”¶åˆ°SYNæŠ¥æ–‡çš„å»ºè¿è¯·æ±‚åï¼Œ<br>å®ƒå¯ä»¥æŠŠACKå’ŒSYNï¼ˆACKèµ·åº”ç­”ä½œç”¨ï¼Œè€ŒSYNèµ·åŒæ­¥ä½œç”¨ï¼‰æ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œæ¥å‘é€ã€‚<br>ä½†å…³é—­è¿æ¥æ—¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡é€šçŸ¥æ—¶ï¼Œ<code>å®ƒä»…ä»…è¡¨ç¤ºå¯¹æ–¹æ²¡æœ‰æ•°æ®å‘é€ç»™ä½ äº†ï¼›ä½†æœªå¿…ä½ æ‰€æœ‰çš„æ•°æ®éƒ½å…¨éƒ¨å‘é€ç»™å¯¹æ–¹äº†</code>ï¼Œ<br>æ‰€ä»¥ä½ å¯ä»¥æœªå¿…ä¼šé©¬ä¸Šä¼šå…³é—­SOCKET,ä¹Ÿå³ä½ å¯èƒ½è¿˜éœ€è¦å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹ä¹‹åï¼Œ<br>å†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºä½ åŒæ„ç°åœ¨å¯ä»¥å…³é—­è¿æ¥äº†ï¼Œæ‰€ä»¥å®ƒè¿™é‡Œçš„ACKæŠ¥æ–‡å’ŒFINæŠ¥æ–‡å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯åˆ†å¼€å‘é€çš„ã€‚</p><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://segmentfault.com/a/1190000006879700" target="_blank" rel="noopener">ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æŠ€æœ¯æ¸…å•</title>
      <link href="/2018/01/16/workspace/Js/home/"/>
      <url>/2018/01/16/workspace/Js/home/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>æŠ€æœ¯æ¸…å•</strong></p><p>[[toc]]</p><h2 id="æœ¬åœ°ç¼“å­˜"><a href="#æœ¬åœ°ç¼“å­˜" class="headerlink" title="æœ¬åœ°ç¼“å­˜"></a>æœ¬åœ°ç¼“å­˜</h2><p>localStorageçš„åº“</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yarn add store</span><br></pre></td></tr></table></figure><p>JSæ£€æµ‹æœ¬åœ°å‚¨å­˜localStorageçš„å˜åŒ–</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'storage'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(event)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>IndexedDBçš„åº“</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">yarn add hello-indexeddb</span><br></pre></td></tr></table></figure><h2 id="é¡µé¢ç›´æ¥ç¼–è¾‘"><a href="#é¡µé¢ç›´æ¥ç¼–è¾‘" class="headerlink" title="é¡µé¢ç›´æ¥ç¼–è¾‘"></a>é¡µé¢ç›´æ¥ç¼–è¾‘</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.contentEditable = <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="åŒå‘æ•°æ®ç»‘å®š"><a href="#åŒå‘æ•°æ®ç»‘å®š" class="headerlink" title="åŒå‘æ•°æ®ç»‘å®š"></a>åŒå‘æ•°æ®ç»‘å®š</h2><p><code>defineProperty</code>ç‰ˆæœ¬</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;input type=<span class="string">"text"</span> id=<span class="string">"input"</span>&gt;</span><br><span class="line">&lt;span id=<span class="string">"text"</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(data, <span class="string">'text'</span>, &#123;</span><br><span class="line">    <span class="keyword">set</span>(value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line"></span><br><span class="line">        input.value = value;</span><br><span class="line">        text.innerText = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span>(val) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'è·å–å€¼'</span>, <span class="keyword">this</span>);  <span class="comment">//thiså°±æ˜¯å½“å‰çš„å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">input.oninput = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data.text = e.target.value);</span><br><span class="line">    <span class="built_in">console</span>.log(data.text);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>proxy</code>ç‰ˆæœ¬</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;input type=<span class="string">"text"</span> id=<span class="string">"input"</span>&gt;</span><br><span class="line">&lt;span id=<span class="string">"text"</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">    <span class="keyword">set</span>(target, key, value) &#123;  <span class="comment">//å½“å‰å¯¹è±¡  key  å½“å‰å€¼</span></span><br><span class="line">        target[key] = value;</span><br><span class="line">        input.value = value;</span><br><span class="line">        text.innerText = value;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span>(obj, value, target) &#123;<span class="comment">//&#123;key:å½“å‰å€¼&#125; å½“å‰å€¼ å½“å‰å¯¹è±¡</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'è·å–å€¼'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(data, handler);</span><br><span class="line"></span><br><span class="line">input.oninput = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    proxy.text1 = e.target.value</span><br><span class="line">    <span class="built_in">console</span>.log(proxy.text2 = e.target.value);</span><br><span class="line">    <span class="built_in">console</span>.log(proxy.text1);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="èŠ‚æµé˜²æŠ–"><a href="#èŠ‚æµé˜²æŠ–" class="headerlink" title="èŠ‚æµé˜²æŠ–"></a>èŠ‚æµé˜²æŠ–</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¾åˆ°å¹¶è¿”å›åº”é¡¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>list list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>music æŸ¥æ‰¾å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> findIndex = <span class="function">(<span class="params">list, music</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> list.findIndex(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.id === music.id</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// é˜²æŠ–å‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> debounce = <span class="function"><span class="keyword">function</span> (<span class="params">func, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">      clearTimeout(timer)</span><br><span class="line">    &#125;</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      func.apply(<span class="keyword">this</span>, args)</span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŠ‚æµå‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> throttle = <span class="function"><span class="keyword">function</span> (<span class="params">func, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> now = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> current = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">if</span> (current - now &gt;= delay) &#123;</span><br><span class="line">      func.apply(<span class="keyword">this</span>, args);</span><br><span class="line">      now = current</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="å¯¼å‡ºè¡¨æ ¼"><a href="#å¯¼å‡ºè¡¨æ ¼" class="headerlink" title="å¯¼å‡ºè¡¨æ ¼"></a>å¯¼å‡ºè¡¨æ ¼</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="built_in">window</span>.URL.createObjectURL(</span><br><span class="line">  <span class="keyword">new</span> Blob([res], &#123; <span class="attr">type</span>: <span class="string">"application/vnd.ms-excel"</span> &#125;)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> fileName = <span class="string">`æ“ä½œæ—¥å¿—<span class="subst">$&#123;dayjs().format(<span class="string">"YYYY-MM-DD"</span>)&#125;</span>.xls`</span>;</span><br><span class="line"><span class="keyword">let</span> link = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>);</span><br><span class="line">link.style.display = <span class="string">"none"</span>;</span><br><span class="line">link.href = url;</span><br><span class="line">link.setAttribute(<span class="string">"download"</span>, fileName);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(link);</span><br><span class="line">link.click();</span><br><span class="line"><span class="comment">//é‡Šæ”¾URLå¯¹è±¡æ‰€å èµ„æº</span></span><br><span class="line"><span class="built_in">window</span>.URL.revokeObjectURL(url);</span><br><span class="line"><span class="comment">//ç”¨å®Œå³åˆ </span></span><br><span class="line"><span class="built_in">document</span>.body.removeChild(link);</span><br></pre></td></tr></table></figure><h2 id="window-requestAnimationFrame-amp-window-requestIdleCallback"><a href="#window-requestAnimationFrame-amp-window-requestIdleCallback" class="headerlink" title="window.requestAnimationFrame &amp; window.requestIdleCallback"></a>window.requestAnimationFrame &amp; window.requestIdleCallback</h2><p><strong>è½¯çŸ¥è¯†ï¼š</strong></p><ol><li><p><strong>å±å¹•åˆ·æ–°é¢‘ç‡ï¼š</strong> å±å¹•æ¯ç§’å‡ºç°å›¾åƒçš„æ¬¡æ•°,æ™®é€šç¬”è®°æœ¬ä¸º60Hz.</p></li><li><p><strong>åŠ¨ç”»åŸç†ï¼š</strong> è®¡ç®—æœºæ¯16.7msåˆ·æ–°ä¸€æ¬¡ï¼ˆ1000/60ï¼‰ï¼Œç”±äºäººçœ¼çš„è§†è§‰åœç•™ï¼Œæ‰€ä»¥çœ‹èµ·æ¥æ˜¯æµç•…çš„ç§»åŠ¨ã€‚</p></li><li><p><strong>setTimeoutï¼š</strong> é€šè¿‡è®¾å®š<code>é—´éš”æ—¶é—´</code>æ¥ä¸æ–­æ”¹å˜å›¾åƒä½ç½®ï¼Œè¾¾åˆ°åŠ¨ç”»æ•ˆæœã€‚ä½†æ˜¯å®¹æ˜“å‡ºç°å¡é¡¿ã€æŠ–åŠ¨çš„ç°è±¡ï¼›åŸå› æ˜¯ï¼š</p><blockquote><p>1ã€settimeoutä»»åŠ¡è¢«æ”¾å…¥<code>å¼‚æ­¥é˜Ÿåˆ—</code>ï¼Œåªæœ‰å½“ä¸»çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œåæ‰ä¼šæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå› æ­¤å®é™…æ‰§è¡Œæ—¶é—´æ€»æ˜¯æ¯”è®¾å®šæ—¶é—´è¦æ™šï¼›<br/><br>2ã€settimeoutçš„å›ºå®š<code>æ—¶é—´é—´éš”ä¸ä¸€å®šä¸å±å¹•åˆ·æ–°æ—¶é—´ç›¸åŒ</code>ï¼Œä¼šå¼•èµ·ä¸¢å¸§ã€‚</p></blockquote></li><li><p><strong>requestAnimationFrameï¼š</strong> ä¼˜åŠ¿ï¼š</p><blockquote><p>1.ç”±<code>ç³»ç»Ÿå†³å®šå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœº</code>ï¼Œ60Hzçš„åˆ·æ–°é¢‘ç‡ï¼Œé‚£ä¹ˆæ¯æ¬¡åˆ·æ–°çš„é—´éš”ä¸­ä¼šæ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ï¼Œä¸ä¼šå¼•èµ·ä¸¢å¸§ï¼Œä¸ä¼šå¡é¡¿<br/><br>2.CPUèŠ‚èƒ½ï¼šä½¿ç”¨setTimeoutå®ç°çš„åŠ¨ç”»ï¼Œ<code>å½“é¡µé¢è¢«éšè—æˆ–æœ€å°åŒ–æ—¶</code>ï¼Œ<code>setTimeout ä»ç„¶åœ¨åå°æ‰§è¡ŒåŠ¨ç”»ä»»åŠ¡</code>ï¼Œç”±äºæ­¤æ—¶é¡µé¢å¤„äºä¸å¯è§æˆ–ä¸å¯ç”¨çŠ¶æ€ï¼Œ<br>åˆ·æ–°åŠ¨ç”»æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå®Œå…¨æ˜¯æµªè´¹CPUèµ„æºã€‚è€ŒrequestAnimationFrameåˆ™å®Œå…¨ä¸åŒï¼Œå½“é¡µé¢å¤„ç†æœªæ¿€æ´»çš„çŠ¶æ€ä¸‹ï¼Œè¯¥é¡µé¢çš„å±å¹•åˆ·æ–°ä»»åŠ¡ä¹Ÿä¼šè¢«ç³»ç»Ÿæš‚åœï¼Œ<br>å› æ­¤è·Ÿç€ç³»ç»Ÿæ­¥ä¼èµ°çš„<code>requestAnimationFrameä¹Ÿä¼šåœæ­¢æ¸²æŸ“</code>ï¼Œå½“é¡µé¢è¢«æ¿€æ´»æ—¶ï¼ŒåŠ¨ç”»å°±ä»ä¸Šæ¬¡åœç•™çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼Œæœ‰æ•ˆèŠ‚çœäº†CPUå¼€é”€ã€‚<br/><br>3.å‡½æ•°èŠ‚æµï¼šåœ¨é«˜é¢‘ç‡äº‹ä»¶(resize,scrollç­‰)ä¸­ï¼Œä¸ºäº†é˜²æ­¢åœ¨ä¸€ä¸ªåˆ·æ–°é—´éš”å†…å‘ç”Ÿå¤šæ¬¡å‡½æ•°æ‰§è¡Œï¼Œ<br>ä½¿ç”¨requestAnimationFrameå¯ä¿è¯æ¯ä¸ªåˆ·æ–°é—´éš”å†…ï¼Œå‡½æ•°åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æµç•…æ€§ï¼Œä¹Ÿèƒ½æ›´å¥½çš„èŠ‚çœå‡½æ•°æ‰§è¡Œçš„å¼€é”€ã€‚</p></blockquote></li></ol><h3 id="requestAnimationFrame"><a href="#requestAnimationFrame" class="headerlink" title="requestAnimationFrame"></a>requestAnimationFrame</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//å›åˆ°é¡¶éƒ¨</span></span><br><span class="line"><span class="keyword">const</span> goTop=<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> product_content = <span class="built_in">document</span>.getElementById(<span class="string">'product_content'</span>);</span><br><span class="line"><span class="keyword">this</span>.progress = product_content.scrollTop;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.progress &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">window</span>.requestAnimationFrame(<span class="keyword">this</span>.step);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> step= <span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> product_content = <span class="built_in">document</span>.getElementById(<span class="string">'product_content'</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.progress &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.progress -= <span class="number">250</span>;  <span class="comment">//è¿™é‡Œå¯ä»¥æ ¹æ®é«˜åº¦æˆæ¯”ä¾‹å‡å°‘ï¼Œä¸ä¼šçªå…€</span></span><br><span class="line">      product_content.scrollTop = <span class="keyword">this</span>.progress;</span><br><span class="line">      <span class="built_in">window</span>.requestAnimationFrame(<span class="keyword">this</span>.step);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">window</span>.cancelAnimationFrame(<span class="keyword">this</span>.step);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="requestIdleCallback"><a href="#requestIdleCallback" class="headerlink" title="requestIdleCallback"></a>requestIdleCallback</h3><p>æµè§ˆå™¨æ¯ä¸€å¸§éƒ½éœ€è¦å®Œæˆå“ªäº›å·¥ä½œï¼Ÿ</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H2b91ea861e554256b0226556ca50ef791.jpg" alt=""></p><p>é€šè¿‡ä¸Šå›¾å¯çœ‹åˆ°ï¼Œä¸€å¸§å†…éœ€è¦å®Œæˆå¦‚ä¸‹å…­ä¸ªæ­¥éª¤çš„ä»»åŠ¡ï¼š</p><p>å¤„ç†ç”¨æˆ·çš„äº¤äº’<br/><br>JS è§£ææ‰§è¡Œ<br/><br>å¸§å¼€å§‹ã€‚çª—å£å°ºå¯¸å˜æ›´ï¼Œé¡µé¢æ»šå»ç­‰çš„å¤„ç†<br/><br>requestAnimationFrame(rAF)<br/><br>å¸ƒå±€<br/><br>ç»˜åˆ¶<br/></p><p>ä¸Šé¢å…­ä¸ªæ­¥éª¤å®Œæˆåæ²¡è¶…è¿‡16.7ms,è¯´æ˜æ—¶é—´æœ‰å¯Œä½™ï¼Œæ­¤æ—¶å°±ä¼šæ‰§è¡Œ<code>requestIdleCallbacké‡Œæ³¨å†Œçš„ä»»åŠ¡</code>(requestIdleCallbackçš„æ—¶é•¿å¹¶ä¸æ˜¯16ms,ä»–æ˜¯ä¸€ä¸ªè‚‰çœ¼è§‰å¯Ÿä¸åˆ°çš„æ—¶é—´),å¦‚æœæ²¡rAFè¿™æ ·çš„å¾ªç¯å¤„ç†ï¼Œæµè§ˆå™¨ä¸€ç›´å¤„äºç©ºé—²çŠ¶æ€çš„è¯ï¼Œ<code>deadline.timeRemaining</code>å¯ä»¥å¾—åˆ°çš„æœ€é•¿æ—¶é—´</p><p>åœ¨<code>ç©ºé—²æ—¶æ®µ</code>è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»£ç†å¯èƒ½æ²¡æœ‰å³å°†å®Œæˆçš„ä»»åŠ¡ï¼Œå¯ä»¥é™åˆ¶ç©ºé—²å‘¨æœŸçš„ç»“æŸã€‚ä¸ºäº†é¿å…åœ¨ä¸å¯é¢„æµ‹çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ç”¨æˆ·è¾“å…¥çš„å¤„ç†ï¼‰ä¸­å¼•èµ·ç”¨æˆ·å¯å¯Ÿè§‰çš„å»¶è¿Ÿï¼Œè¿™äº›ç©ºé—²å‘¨æœŸçš„é•¿åº¦åº”é™åˆ¶ä¸ºæœ€å¤§å€¼50msã€‚</p><p>æœ€å¤§æœŸé™ä¸º50æ¯«ç§’ï¼Œæ˜¯æ ¹æ®ç ”ç©¶[ RESPONSETIME ] å¾—å‡ºçš„ï¼Œè¯¥ç ”ç©¶è¡¨æ˜ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„100æ¯«ç§’ä»¥å†…çš„å“åº”é€šå¸¸è¢«è®¤ä¸ºå¯¹äººç±»æ˜¯ç¬æ—¶çš„ã€‚å°†é—²ç½®æˆªæ­¢æœŸé™è®¾ç½®ä¸º50msæ„å‘³ç€å³ä½¿åœ¨é—²ç½®ä»»åŠ¡å¼€å§‹åç«‹å³å‘ç”Ÿç”¨æˆ·è¾“å…¥ï¼Œç”¨æˆ·ä»£ç†ä»ç„¶æœ‰å‰©ä½™çš„50mså¯ä»¥åœ¨å…¶ä¸­å“åº”ç”¨æˆ·è¾“å…¥è€Œä¸ä¼šäº§ç”Ÿç”¨æˆ·å¯å¯Ÿè§‰çš„æ»åã€‚</p><p><strong>API</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> handle = <span class="built_in">window</span>.requestIdleCallback(callback[, options])</span><br></pre></td></tr></table></figure><ul><li>callbackï¼šå›è°ƒï¼Œå³ç©ºé—²æ—¶éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¯¥å›è°ƒå‡½æ•°æ¥æ”¶ä¸€ä¸ªIdleDeadlineå¯¹è±¡ä½œä¸ºå…¥å‚ã€‚å…¶ä¸­IdleDeadlineå¯¹è±¡åŒ…å«ï¼š<ul><li><strong>didTimeout</strong>ï¼Œå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºä»»åŠ¡æ˜¯å¦è¶…æ—¶ï¼Œç»“åˆ timeRemaining ä½¿ç”¨ã€‚</li><li><strong>timeRemaining()</strong>ï¼Œè¡¨ç¤ºå½“å‰å¸§å‰©ä½™çš„æ—¶é—´ï¼Œä¹Ÿå¯ç†è§£ä¸ºç•™ç»™ä»»åŠ¡çš„æ—¶é—´è¿˜æœ‰å¤šå°‘ã€‚</li></ul></li><li>optionsï¼šç›®å‰ options åªæœ‰ä¸€ä¸ªå‚æ•°<ul><li><strong>timeout</strong>ã€‚è¡¨ç¤ºè¶…è¿‡è¿™ä¸ªæ—¶é—´åï¼Œå¦‚æœä»»åŠ¡è¿˜æ²¡æ‰§è¡Œï¼Œåˆ™å¼ºåˆ¶æ‰§è¡Œï¼Œä¸å¿…ç­‰å¾…ç©ºé—²</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">requestIdleCallback(myNonEssentialWork, &#123; <span class="attr">timeout</span>: <span class="number">2000</span> &#125;);</span><br><span class="line"><span class="comment">// ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">const</span> tasks = [</span><br><span class="line"> () =&gt; &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"ç¬¬ä¸€ä¸ªä»»åŠ¡"</span>);</span><br><span class="line"> &#125;,</span><br><span class="line"> () =&gt; &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"ç¬¬äºŒä¸ªä»»åŠ¡"</span>);</span><br><span class="line"> &#125;,</span><br><span class="line"> () =&gt; &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"ç¬¬ä¸‰ä¸ªä»»åŠ¡"</span>);</span><br><span class="line"> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myNonEssentialWork</span> (<span class="params">deadline</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// å¦‚æœå¸§å†…æœ‰å¯Œä½™çš„æ—¶é—´ï¼Œæˆ–è€…è¶…æ—¶</span></span><br><span class="line"> <span class="keyword">while</span> ((deadline.timeRemaining() &gt; <span class="number">0</span> || deadline.didTimeout) &amp;&amp; tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">   work();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (tasks.length &gt; <span class="number">0</span>)</span><br><span class="line">   requestIdleCallback(myNonEssentialWork);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">work</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> tasks.shift()();</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'æ‰§è¡Œä»»åŠ¡'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¶…æ—¶çš„æƒ…å†µï¼Œå…¶å®å°±æ˜¯æµè§ˆå™¨å¾ˆå¿™ï¼Œæ²¡æœ‰ç©ºé—²æ—¶é—´ï¼Œæ­¤æ—¶ä¼šç­‰å¾…æŒ‡å®šçš„ timeout é‚£ä¹ˆä¹…å†æ‰§è¡Œ<br>ï¼Œé€šè¿‡å…¥å‚ dealine æ‹¿åˆ°çš„ <code>didTmieout ä¼šä¸º trueï¼ŒåŒæ—¶ timeRemaining () è¿”å›çš„ä¹Ÿæ˜¯ 0</code>ã€‚<br>è¶…æ—¶çš„æƒ…å†µä¸‹å¦‚æœé€‰æ‹©ç»§ç»­æ‰§è¡Œçš„è¯ï¼Œè‚¯å®šä¼šå‡ºç°å¡é¡¿çš„ï¼Œå› ä¸ºå¿…ç„¶ä¼šå°†ä¸€å¸§çš„æ—¶é—´æ‹‰é•¿</p><p><strong>cancelIdleCallback</strong></p><p>ä¸ setTimeout ç±»ä¼¼ï¼Œè¿”å›ä¸€ä¸ªå”¯ä¸€ idï¼Œå¯é€šè¿‡ cancelIdleCallback æ¥å–æ¶ˆä»»åŠ¡ã€‚</p><h2 id="MutationObserver"><a href="#MutationObserver" class="headerlink" title="MutationObserver"></a>MutationObserver</h2><p>MutationObserver æ˜¯ä¸€ä¸ªå¯ä»¥ç›‘å¬DOMç»“æ„å˜åŒ–çš„æ¥å£ã€‚</p><p>å¼‚æ­¥çš„ ï¼ˆå¾®ä»»åŠ¡ï¼‰</p><ul><li>childListï¼šå¦‚æœçªå˜ç›®æ ‡çš„å­ä»£è¢«è§‚å¯Ÿï¼Œåˆ™è®¾ç½®ä¸º trueã€‚</li><li>attributesï¼šå¦‚æœè¦è§‚å¯Ÿç›®æ ‡å±æ€§çš„çªå˜ï¼Œåˆ™è®¾ç½®ä¸º trueã€‚ å¦‚æœæŒ‡å®šäº† attributeOldValue å’Œï¼ˆæˆ–ï¼‰attributeFilterï¼Œåˆ™å¯ä»¥çœç•¥ã€‚</li><li>characterDataï¼šå¦‚æœè¦è§‚å¯Ÿåˆ°ç›®æ ‡æ•°æ®çš„çªå˜ï¼Œåˆ™è®¾ç½®ä¸º trueã€‚ å¦‚æœæŒ‡å®šäº†characterDataOldValueï¼Œåˆ™å¯ä»¥çœç•¥ã€‚</li><li>subtreeï¼šå¦‚æœçªå˜ä¸ä»…ä»…æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œè€Œä¸”åŒ…æ‹¬ç›®æ ‡çš„åä»£ï¼ˆdescendantsï¼‰ï¼Œåˆ™è®¾ç½®ä¸º trueã€‚</li><li>attributeOldValueï¼šå¦‚æœå‰é¢çš„ attributes å±æ€§è®¾ç½®ä¸º true æˆ–çœç•¥ï¼Œå¹¶ä¸”ç›®æ ‡çš„å±æ€§å€¼åœ¨çªå˜å‰è¦åšè®°å½•ï¼Œåˆ™è®¾ç½®ä¸º trueã€‚</li><li>characterDataOldValueï¼šå¦‚æœå‰é¢çš„ characterData å±æ€§è®¾ç½®ä¸º true æˆ–çœç•¥ï¼Œå¹¶ä¸”ç›®æ ‡çš„æ•°æ®åœ¨çªå˜å‰è¦åšè®°å½•ï¼Œåˆ™è®¾ç½®ä¸º trueã€‚</li><li>attributeFilterï¼šè®¾ç½®ä¸ºå±æ€§æœ¬åœ°åç§°åˆ—è¡¨ï¼ˆæ²¡æœ‰å‘½åç©ºé—´ï¼‰ï¼Œå¦‚æœä¸æ˜¯æ‰€æœ‰å±æ€§çªå˜éƒ½éœ€è¦è§‚å¯Ÿï¼Œå±æ€§ä¸º true æˆ–çœç•¥ã€‚ä¾‹å¦‚ï¼š[â€˜classâ€™,â€™srcâ€™]</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> MutationObserver(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> dom =   <span class="built_in">document</span>.body.getAttribute(<span class="string">'data-random'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(dom)  <span class="comment">// å¦‚æœç”¨æˆ·ä¿®æ”¹bodyçš„å±æ€§ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">&#125;).observe(<span class="built_in">document</span>.body, &#123;</span><br><span class="line">  attributes: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.setAttribute(<span class="string">'data-random'</span>, <span class="built_in">Math</span>.random())</span><br><span class="line"><span class="built_in">document</span>.body.setAttribute(<span class="string">'data-random'</span>, <span class="built_in">Math</span>.random())</span><br><span class="line"><span class="built_in">document</span>.body.setAttribute(<span class="string">'data-random'</span>, <span class="built_in">Math</span>.random())</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªä¼šè¾“å‡ºä¸€æ¬¡ ovserver</span></span><br></pre></td></tr></table></figure><h2 id="ç¦»çº¿æ£€æµ‹"><a href="#ç¦»çº¿æ£€æµ‹" class="headerlink" title="ç¦»çº¿æ£€æµ‹"></a>ç¦»çº¿æ£€æµ‹</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//H5å®šä¹‰äº†navigator.onLineå±æ€§ï¼Œä¸ºtrue è¡¨ç¤ºè®¾å¤‡èƒ½ä¸Šç½‘ </span></span><br><span class="line"><span class="comment">//è¿˜å®šä¹‰äº†ä¸¤ä¸ªç›¸å…³äº‹ä»¶ï¼šonLineå’ŒoffLine</span></span><br></pre></td></tr></table></figure><h2 id="userAgent"><a href="#userAgent" class="headerlink" title="userAgent"></a>userAgent</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æµè§ˆå™¨å†…æ ¸ã€æ‰‹æœºç³»ç»Ÿç­‰ï¼Œä½¿ç”¨ browser.userAgent.mobile</span></span><br><span class="line"><span class="keyword">var</span> browser = &#123;</span><br><span class="line">    userAgent: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ua = navigator.userAgent;</span><br><span class="line">        <span class="keyword">var</span> ualower = navigator.userAgent.toLocaleLowerCase();</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            trident: ua.indexOf(<span class="string">'Trident'</span>) &gt; <span class="number">-1</span>, <span class="comment">// IEå†…æ ¸</span></span><br><span class="line">            presto: ua.indexOf(<span class="string">'Presto'</span>) &gt; <span class="number">-1</span>, <span class="comment">// operaå†…æ ¸</span></span><br><span class="line">            webKit: ua.indexOf(<span class="string">'AppleWebKit'</span>) &gt; <span class="number">-1</span>, <span class="comment">//è‹¹æœã€è°·æ­Œå†…æ ¸</span></span><br><span class="line">            gecko: ua.indexOf(<span class="string">'Gecko'</span>) &gt; <span class="number">-1</span> &amp;&amp; ua.indexOf(<span class="string">'KHTML'</span>) == <span class="number">-1</span>, <span class="comment">// ç«ç‹å†…æ ¸</span></span><br><span class="line">            mobile: !!ua.match(<span class="regexp">/AppleWebKit.*Mobile.*/</span>) || !!ua.match(<span class="regexp">/AppleWebKit/</span>), <span class="comment">// æ˜¯å¦ä¸ºç§»åŠ¨ç»ˆç«¯</span></span><br><span class="line">            ios: !!ua.match(<span class="regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>), <span class="comment">// IOSç»ˆç«¯</span></span><br><span class="line">            android: ua.indexOf(<span class="string">'Android'</span>) &gt; <span class="number">-1</span>, <span class="comment">// å®‰å“ç»ˆç«¯</span></span><br><span class="line">            iPhone: ua.indexOf(<span class="string">'iPhone'</span>) &gt; <span class="number">-1</span>, <span class="comment">// æ˜¯å¦ä¸ºiphoneæˆ–QQHDæµè§ˆå™¨</span></span><br><span class="line">            iPad: ua.indexOf(<span class="string">'iPad'</span>) &gt; <span class="number">-1</span>, <span class="comment">// æ˜¯å¦ä¸ºiPad</span></span><br><span class="line">            webApp: ua.indexOf(<span class="string">'Safari'</span>) == <span class="number">-1</span>, <span class="comment">// æ˜¯å¦webåº”ç”¨ç¨‹åºï¼Œæ²¡æœ‰å¤´éƒ¨ä¸åº•éƒ¨</span></span><br><span class="line">            QQbrw: ua.indexOf(<span class="string">'MQQBrowser'</span>) &gt; <span class="number">-1</span>, <span class="comment">// QQæµè§ˆå™¨(æ‰‹æœºä¸Šçš„)</span></span><br><span class="line">            weiXin: ua.indexOf(<span class="string">'MicroMessenger'</span>) &gt; <span class="number">-1</span>, <span class="comment">// å¾®ä¿¡</span></span><br><span class="line">            QQ: ualower.match(<span class="regexp">/\sQQ/i</span>) == <span class="string">" qq"</span>, <span class="comment">// QQ Appå†…ç½®æµè§ˆå™¨ï¼ˆéœ€è¦é…åˆä½¿ç”¨ï¼‰</span></span><br><span class="line">            weiBo: ualower.match(<span class="regexp">/WeiBo/i</span>) == <span class="string">"weibo"</span>, <span class="comment">// å¾®åš</span></span><br><span class="line">            ucLowEnd: ua.indexOf(<span class="string">'UCWEB7.'</span>) &gt; <span class="number">-1</span>, <span class="comment">//</span></span><br><span class="line">            ucSpecial: ua.indexOf(<span class="string">'rv:1.2.3.4'</span>) &gt; <span class="number">-1</span>,</span><br><span class="line">            webview: !(ua.match(<span class="regexp">/Chrome\/([\d.]+)/</span>) || ua.match(<span class="regexp">/CriOS\/([\d.]+)/</span>)) &amp;&amp; ua.match(<span class="regexp">/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/</span>),</span><br><span class="line">            ucweb: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">parseFloat</span>(ua.match(<span class="regexp">/ucweb\d+\.\d+/gi</span>).toString().match(<span class="regexp">/\d+\.\d+/</span>).toString()) &gt;= <span class="number">8.2</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ua.indexOf(<span class="string">'UC'</span>) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;(),</span><br><span class="line">            Symbian: ua.indexOf(<span class="string">'Symbian'</span>) &gt; <span class="number">-1</span>,</span><br><span class="line">            ucSB: ua.indexOf(<span class="string">'Firofox/1.'</span>) &gt; <span class="number">-1</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="importå’ŒrequireåŒºåˆ«"><a href="#importå’ŒrequireåŒºåˆ«" class="headerlink" title="importå’ŒrequireåŒºåˆ«"></a>importå’ŒrequireåŒºåˆ«</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">"./sum"</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//sum.tsx</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sum=<span class="function">(<span class="params">a,b</span>)=&gt;</span>a+b;</span><br><span class="line"></span><br><span class="line"><span class="comment">//result: 2,1,3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//importå‘½ä»¤æ˜¯ç¼–è¯‘é˜¶æ®µæ‰§è¡Œçš„ï¼Œåœ¨ä»£ç è¿è¡Œä¹‹å‰ã€‚å› æ­¤è¿™æ„å‘³ç€è¢«å¯¼å…¥çš„æ¨¡å—ä¼šå…ˆè¿è¡Œï¼Œè€Œå¯¼å…¥æ¨¡å—çš„æ–‡ä»¶ä¼šåæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯require()ç»“æœä¼šä¾æ¬¡æ‰“å°å‡ºæ¥ï¼Œ1ï¼Œ2ï¼Œ3</span></span><br></pre></td></tr></table></figure><h2 id="æ£€æµ‹æ•°æ®ç±»å‹"><a href="#æ£€æµ‹æ•°æ®ç±»å‹" class="headerlink" title="æ£€æµ‹æ•°æ®ç±»å‹"></a>æ£€æµ‹æ•°æ®ç±»å‹</h2><h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//typeofç”¨ä»¥è·å–ä¸€ä¸ªå˜é‡æˆ–è€…è¡¨è¾¾å¼çš„ç±»å‹ï¼Œtypeofä¸€èˆ¬åªèƒ½è¿”å›å¦‚ä¸‹å‡ ä¸ªç»“æœï¼š</span></span><br><span class="line">number,boolean,string,<span class="function"><span class="keyword">function</span>ï¼ˆå‡½æ•°ï¼‰,<span class="title">symbol</span>,<span class="title">object</span>ï¼ˆ<span class="title">NULL</span>,æ•°ç»„ï¼Œå¯¹è±¡ï¼‰,<span class="title">undefined</span>ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">//true</span></span><br><span class="line"><span class="comment">//å¯ä»¥çœ‹åˆ°[1, 2, 3]æ˜¯ç±»å‹Arrayçš„å®ä¾‹</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">instanceof</span> <span class="built_in">Object</span>; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è£…</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myInstanceof</span>(<span class="params">val, type</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">let</span> rightProto = type.prototype; <span class="comment">// å–å³è¾¹ prototypeçš„å€¼</span></span><br><span class="line">    <span class="keyword">let</span> leftPrevProto = val.__proto__; <span class="comment">// å–å·¦è¾¹__proto__å€¼</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (leftPrevProto === <span class="literal">null</span>) &#123; <span class="comment">//å¦‚æœå·¦è¾¹çš„__proto__å€¼ä¸ºnullï¼Œè¿”å›false</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;   </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (leftPrevProto === rightProto) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;    </span><br><span class="line">        &#125; </span><br><span class="line">        leftPrevProto = leftPrevProto.__proto__ ; <span class="comment">//ä»¥ä¸Šéƒ½ä¸æ»¡è¶³ï¼Œå–ä¸Šä¸€å±‚åŸå‹ç»§ç»­å¾ªç¯ï¼Œç›´åˆ°æ²¡å–åˆ°ä¸ºnull</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h3><p>1ï¼šnull å’Œ undefined æ— constructorï¼Œè¿™ç§æ–¹æ³•åˆ¤æ–­ä¸äº†ã€‚</p><p>2ï¼šè¿˜æœ‰ï¼Œå¦‚æœè‡ªå®šä¹‰å¯¹è±¡ï¼Œå¼€å‘è€…é‡å†™prototypeä¹‹åï¼ŒåŸæœ‰çš„constructorä¼šä¸¢å¤±ï¼Œå› æ­¤ï¼Œä¸ºäº†è§„èŒƒå¼€å‘ï¼Œåœ¨é‡å†™å¯¹è±¡åŸå‹æ—¶ä¸€èˆ¬éƒ½éœ€è¦é‡æ–°ç»™ constructor èµ‹å€¼ï¼Œä»¥ä¿è¯å¯¹è±¡å®ä¾‹çš„ç±»å‹ä¸è¢«ç¯¡æ”¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">''</span>.constructor===<span class="built_in">String</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">111</span>).constructor===<span class="built_in">Number</span></span><br><span class="line">(<span class="number">11</span>).constructor===<span class="built_in">Number</span></span><br><span class="line"><span class="literal">false</span>.constructor===<span class="built_in">Boolean</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>().constructor===<span class="built_in">Date</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Function</span>().constructor===<span class="built_in">Function</span></span><br><span class="line">[].constructor===<span class="built_in">Array</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chameleon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(&#123; newColor = <span class="string">"green"</span> &#125; = &#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.newColor = newColor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Chameleon.constructor===<span class="built_in">Function</span></span><br><span class="line"><span class="keyword">new</span> Chameleon().constructor.constructor===<span class="built_in">Function</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> Chameleon().constructor) <span class="comment">//"[object Function]"</span></span><br><span class="line"><span class="keyword">new</span> ew Chameleon().constructor===<span class="built_in">Function</span>  <span class="comment">//false</span></span><br></pre></td></tr></table></figure><h3 id="Object-prototype-toString-call"><a href="#Object-prototype-toString-call" class="headerlink" title="Object.prototype.toString.call()"></a>Object.prototype.toString.call()</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is</span>(<span class="params">type, obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> clas = <span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">Object</span>(obj)).slice(<span class="number">8</span>, <span class="number">-1</span>);   <span class="comment">//Object(null)</span></span><br><span class="line">    <span class="keyword">return</span> obj !== <span class="literal">undefined</span> &amp;&amp; obj !== <span class="literal">null</span> &amp;&amp; clas === type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">is(<span class="string">'String'</span>, <span class="string">'test'</span>); <span class="comment">// true</span></span><br><span class="line">is(<span class="string">'String'</span>, <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">'test'</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="HTMLé¡µé¢åŠ è½½å®Œæ¯•åè¿è¡ŒJS"><a href="#HTMLé¡µé¢åŠ è½½å®Œæ¯•åè¿è¡ŒJS" class="headerlink" title="HTMLé¡µé¢åŠ è½½å®Œæ¯•åè¿è¡ŒJS"></a>HTMLé¡µé¢åŠ è½½å®Œæ¯•åè¿è¡ŒJS</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;  <span class="comment">//å¯ä»¥åˆ¤æ–­jsæ—¶å€™åŠ è½½å®Œæ¯•</span></span><br><span class="line"></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;); </span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)</span><br><span class="line"><span class="comment">//å½“domåŠ è½½å®Œå°±å¯ä»¥æ‰§è¡Œï¼ˆæ¯”window.onloadæ›´æ—©ï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>ä¸¤è€…çš„ä¸»è¦åŒºåˆ«</strong></p><p>å½“ä¸€ä¸ªæ–‡æ¡£å®Œå…¨ä¸‹è½½åˆ°æµè§ˆå™¨ä¸­æ—¶ï¼Œæ‰ä¼šè§¦å‘<code>window.onload</code>äº‹ä»¶</p><p>$(document).ready{ }æ˜¯åœ¨DOMå®Œå…¨å°±ç»ªå¹¶å¯ä»¥ä½¿ç”¨æ—¶è°ƒç”¨ï¼Œæ­¤æ—¶å¯èƒ½å›¾ç‰‡ç­‰è¿˜å¯èƒ½æ²¡æœ‰ä¸‹è½½å®Œæˆ</p><h2 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Symbol æ˜¯åŸºæœ¬æ•°æ®ç±»å‹  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Age=<span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> Age === <span class="string">'symbol'</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å±æ€§å ä¸ºä¸å¯æšä¸¾å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">   [<span class="built_in">Symbol</span>(<span class="string">'name'</span>)]: <span class="string">'ä¸€æ–¤ä»£ç '</span>,</span><br><span class="line">   age: <span class="number">18</span>,</span><br><span class="line">   title: <span class="string">'Engineer'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(obj)   <span class="comment">// ['age', 'title']</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> p <span class="keyword">in</span> obj) &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(p)   <span class="comment">// åˆ†åˆ«ä¼šè¾“å‡ºï¼š'age' å’Œ 'title'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(obj)   <span class="comment">// ['age', 'title']</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(obj)  <span class="comment">// &#123;"age":18,"title":"Engineer"&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸€äº›ä¸“é—¨é’ˆå¯¹Symbolçš„API</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨Objectçš„API</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertySymbols(obj) <span class="comment">// [Symbol(name)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ–°å¢çš„åå°„API</span></span><br><span class="line"><span class="built_in">Reflect</span>.ownKeys(obj) <span class="comment">// [Symbol(name), 'age', 'title']</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨Symbolä»£æ›¿REDUXçš„å¸¸é‡</span></span><br><span class="line"><span class="comment">// const TYPE_AUDIO = 'AUDIO'</span></span><br><span class="line"><span class="comment">// const TYPE_VIDEO = 'VIDEO'</span></span><br><span class="line"><span class="comment">// const TYPE_IMAGE = 'IMAGE'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TYPE_AUDIO = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> TYPE_VIDEO = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> TYPE_IMAGE = <span class="built_in">Symbol</span>()</span><br></pre></td></tr></table></figure><h2 id="IntersectionObserver-æ˜¯å¦å¯è§"><a href="#IntersectionObserver-æ˜¯å¦å¯è§" class="headerlink" title="IntersectionObserver æ˜¯å¦å¯è§"></a>IntersectionObserver æ˜¯å¦å¯è§</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function"><span class="keyword">function</span>(<span class="params">changes</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(changes);</span><br><span class="line">  changes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">element, index</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// statements</span></span><br><span class="line">    <span class="keyword">if</span> (element.intersectionRatio &gt; <span class="number">0</span> &amp;&amp; element.intersectionRatio &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">      element.target.src = element.target.dataset.src;</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;); </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addObserver</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> listItems = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.list-item-img'</span>);</span><br><span class="line">listItems.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">  observer.observe(item);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addObserver();</span><br></pre></td></tr></table></figure><h2 id="å°ä¸œè¥¿"><a href="#å°ä¸œè¥¿" class="headerlink" title="å°ä¸œè¥¿"></a>å°ä¸œè¥¿</h2><ul><li><p>æ˜¾ç¤ºç‰ˆæœ¬å·</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> pkg = <span class="built_in">require</span>(<span class="string">'../package.json'</span>);</span><br><span class="line"><span class="built_in">window</span>.mmPlayer = <span class="built_in">window</span>.mmplayer = <span class="string">`æ¬¢è¿ä½¿ç”¨ </span></span><br><span class="line"><span class="string">å½“å‰ç‰ˆæœ¬ä¸ºï¼šV<span class="subst">$&#123;pkg.version&#125;</span></span></span><br><span class="line"><span class="string">ä½œè€…ï¼š<span class="subst">$&#123;pkg.auter&#125;</span>`</span></span><br><span class="line"><span class="built_in">console</span>.info(<span class="string">`%c<span class="subst">$&#123;<span class="built_in">window</span>.mmPlayer&#125;</span>`</span>, <span class="string">`color:blue`</span>);</span><br></pre></td></tr></table></figure></li><li><p>è€—æ—¶ç›‘æ§</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.time(<span class="number">111</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>(<span class="number">1000000</span>).keys()</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="number">111</span>)  <span class="comment">//111: 8.5390625ms</span></span><br></pre></td></tr></table></figure></li><li><p>table</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.table()</span><br></pre></td></tr></table></figure></li><li><p>æ¸…ç©ºæ§åˆ¶å°å†å²è®°å½•</p><ul><li>åœ¨æ§åˆ¶å°<code>å³é”®</code>ï¼Œæˆ–è€…æŒ‰ä¸‹ <code>Ctrl å¹¶å•å‡»é¼ æ ‡</code>ï¼Œé€‰æ‹© Clear Consoleã€‚</li><li>åœ¨è„šæœ¬çª—å£è¾“å…¥ <code>clear()</code>æ‰§è¡Œã€‚</li><li>ä½¿ç”¨å¿«æ·é”® <code>command + K</code></li></ul></li><li><p>åˆ‡æ¢ä¸»é¢˜</p></li></ul><p>Chrome æä¾›äº† äº®&amp;æš— ä¸¤ç§ä¸»é¢˜,å½“ä½ è§†è§‰ç–²åŠ³çš„æ—¶å€™,å¯ä»¥ switch å“¦, å¿«æ·é”® <code>command+shift+p</code> ,æ‰“å¼€ Command Menu,è¾“å…¥ <code>theme</code> ,å³å¯é€‰æ‹©åˆ‡æ¢</p><h2 id="Think-å¾ªç¯"><a href="#Think-å¾ªç¯" class="headerlink" title="Think å¾ªç¯"></a>Think å¾ªç¯</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">if</span> condition=<span class="string">"$Think.get.edit == 1 OR $Think.get.judge == 1"</span>&gt;disabled&lt;/<span class="keyword">if</span>&gt; </span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span>($_GET[<span class="string">'id'</span>] == $parter[<span class="string">'id'</span>])&#123; <span class="keyword">echo</span> <span class="string">"selected"</span>;&#125;<span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> dump ($vo)<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;volist name=<span class="string">"areas"</span> id=<span class="string">"vo"</span>&gt;&lt;/volist&gt;</span><br></pre></td></tr></table></figure><h2 id="jsæ–‡ä»¶å‹ç¼©åŸå› å’Œå‹ç¼©åŸç†"><a href="#jsæ–‡ä»¶å‹ç¼©åŸå› å’Œå‹ç¼©åŸç†" class="headerlink" title="jsæ–‡ä»¶å‹ç¼©åŸå› å’Œå‹ç¼©åŸç†"></a>jsæ–‡ä»¶å‹ç¼©åŸå› å’Œå‹ç¼©åŸç†</h2><p><strong>å‹ç¼©ï¼š</strong> åˆ é™¤ Javascript ä»£ç ä¸­æ‰€æœ‰æ³¨é‡Šã€è·³æ ¼ç¬¦å·ã€æ¢è¡Œç¬¦å·åŠæ— ç”¨çš„ç©ºæ ¼ï¼Œä»è€Œå‹ç¼© JS æ–‡ä»¶å¤§å°ã€‚<br/><br><strong>æ··æ·†ï¼š</strong> ç»è¿‡ç¼–ç å°†å˜é‡å’Œå‡½æ•°åŸå‘½åæ”¹ä¸ºæ¯«æ— æ„ä¹‰çš„å‘½åï¼Œä»¥é˜²æ­¢ä»–äººçª¥è§†å’Œçªƒå– Javascript æºä»£ç ã€‚</p><p><strong>javascriptæ–‡ä»¶å‹ç¼©çš„åŸç†</strong></p><p>ç¬¬ä¸€ä¸ªå½“ç„¶å°±æ˜¯å»æ‰æ³¨é‡Šäº†ã€‚</p><p>å¦å¤–å°±æ˜¯è·ŸCSSå‹ç¼©ç›¸åŒçš„å»æ‰æ¢è¡Œç¬¦ï¼Œç©ºæ ¼ä»€ä¹ˆçš„ã€‚</p><p>JAVASCRIPTä¸­æœ‰å‡ ç§å˜é‡å½¢å¼ï¼Œå¦‚å˜é‡ï¼Œå‡½æ•°åï¼Œå‡½æ•°çš„å‚æ•°ç­‰ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨æ‰‹å†™JSä»£ç çš„æ—¶å€™ï¼Œä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬éƒ½ä¼šç»™è¿™äº›å˜é‡åä»¥ç›´è§‚æ˜“æ‡‚çš„å­—ç¬¦ä¸²ï¼Œå¦‚ï¼švar title=â€javascriptâ€;è¿™ä¸ªä¹ æƒ¯æ˜¯å€¼å¾—æ¨å´‡çš„ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™äº›å˜é‡å¯¹äºç”¨æˆ·ç†è§£æœ‰å¸®åŠ©ï¼Œå¯¹äºè®¡ç®—æœºå´æ²¡ä»€ä¹ˆå½±å“ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå‰é¢çš„å¥å­å˜æˆï¼švar a=â€javascriptâ€;å¯¹ç”µè„‘æ¥è®²æ˜¯ä¸€æ ·çš„ã€‚</p><p>é€šå¸¸æ·±åº¦å‹ç¼©JSéƒ½å¿…é¡»è¦åšçš„ä¸€æ­¥å°±æ˜¯å°½é‡åœ°ç¼©çŸ­å˜é‡åï¼Œå› ä¸ºä¸€ä»½ä½“ç§¯å·¨å¤§çš„JSä»£ç ï¼Œå…¶ä¸­çš„å˜é‡åä¼šå å»ä¸å°‘ç©ºé—´ã€‚</p><p>26ä¸ªå•å­—æ¯ï¼Œå‡ ä¹å°±å¯ä»¥æŠŠä¸€ä¸ªå‡½æ•°ä¸­æ‰€æœ‰çš„å‚æ•°éƒ½å†™å®Œï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸åœ¨å‹ç¼©ç‰ˆçš„JSä»£ç ä¸­å‘ç°a,b,c,dä¹‹ç±»çš„è¿ç»­å˜é‡ã€‚</p><p>å¦å¤–ï¼ŒJavascriptæœ‰ä¸ªç‰¹æ€§å°±æ˜¯ä¸åŒä½œç”¨åŸŸçš„å˜é‡åå¯ä»¥ä»»æ„é‡å¤ï¼Œæ‰€ä»¥æ­¤å‡½æ•°ä¸­æœ‰a,b,c,dï¼Œå…¶ä»–å‡½æ•°ä¹Ÿå¯ä»¥æœ‰ã€‚è¿™æ ·çŸ­åˆå¤§é‡é‡å¤çš„å˜é‡å¯ä»¥è®©äººç´¢äº‘é‡Œé›¾é‡Œä¸çŸ¥æ‰€äº‘ï¼Œä¹Ÿå˜ç›¸çš„èµ·åˆ°äº†åŠ å¯†JSä»£ç çš„ä½œç”¨.</p><p><strong>æ³¨æ„</strong></p><ol><li>å‹ç¼©å‰çš„ä»£ç æ ¼å¼è¦æ ‡å‡†ã€‚å› ä¸ºå»æ‰æ¢è¡Œä¸ç©ºæ ¼æ—¶ï¼Œæ‰€æœ‰è¯­å¥å°±å˜æˆä¸€è¡Œäº†ï¼Œå¦‚æœä½ çš„ä»£ç æœ‰ç‘•ç–µï¼ˆæ¯”å¦‚æŸè¡Œå°‘äº†ä¸ªåˆ†å·ï¼‰ï¼Œé‚£å°±ä¼šå¯¼è‡´æ•´ä¸ªæ–‡ä»¶æŠ¥é”™ã€‚å½“ç„¶ï¼Œç°åœ¨æœ‰çš„å‹ç¼©å·¥å…·å·²ç»æ¯”è¾ƒæ™ºèƒ½äº†ã€‚</li><li>å¤‡ä»½åŸæ–‡ä»¶</li><li>å‹ç¼©å¾ˆå¯èƒ½ä¸ä¼šä¸€æ¬¡æˆåŠŸï¼Œä¸€èˆ¬è¦å¤šè¯•ï¼Œå¤šæ”¹</li></ol><h2 id="window-performance-API"><a href="#window-performance-API" class="headerlink" title="window.performance API"></a>window.performance API</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPerformanceTiming</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> performance = <span class="built_in">window</span>.performance;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!performance) &#123;</span><br><span class="line">    <span class="comment">// å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ performance æ¥å£'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> t = performance.timing;</span><br><span class="line">  <span class="keyword">var</span> times = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ã€é‡è¦ã€‘é¡µé¢åŠ è½½å®Œæˆçš„æ—¶é—´</span></span><br><span class="line">  <span class="comment">//ã€åŸå› ã€‘è¿™å‡ ä¹ä»£è¡¨äº†ç”¨æˆ·ç­‰å¾…é¡µé¢å¯ç”¨çš„æ—¶é—´</span></span><br><span class="line">  times.loadPage = t.loadEventEnd - t.navigationStart;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ã€é‡è¦ã€‘è§£æ DOM æ ‘ç»“æ„çš„æ—¶é—´</span></span><br><span class="line">  <span class="comment">//ã€åŸå› ã€‘åçœä¸‹ä½ çš„ DOM æ ‘åµŒå¥—æ˜¯ä¸æ˜¯å¤ªå¤šäº†ï¼</span></span><br><span class="line">  times.domReady = t.domComplete - t.responseEnd;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ã€é‡è¦ã€‘é‡å®šå‘çš„æ—¶é—´</span></span><br><span class="line">  <span class="comment">//ã€åŸå› ã€‘æ‹’ç»é‡å®šå‘ï¼æ¯”å¦‚ï¼Œhttp://example.com/ å°±ä¸è¯¥å†™æˆ http://example.com</span></span><br><span class="line">  times.redirect = t.redirectEnd - t.redirectStart;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ã€é‡è¦ã€‘DNS æŸ¥è¯¢æ—¶é—´</span></span><br><span class="line">  <span class="comment">//ã€åŸå› ã€‘DNS é¢„åŠ è½½åšäº†ä¹ˆï¼Ÿé¡µé¢å†…æ˜¯ä¸æ˜¯ä½¿ç”¨äº†å¤ªå¤šä¸åŒçš„åŸŸåå¯¼è‡´åŸŸåæŸ¥è¯¢çš„æ—¶é—´å¤ªé•¿ï¼Ÿ</span></span><br><span class="line">  <span class="comment">// å¯ä½¿ç”¨ HTML5 Prefetch é¢„æŸ¥è¯¢ DNS ï¼Œè§ï¼š[HTML5 prefetch](http://segmentfault.com/a/1190000000633364)</span></span><br><span class="line">  times.lookupDomain = t.domainLookupEnd - t.domainLookupStart;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ã€é‡è¦ã€‘è¯»å–é¡µé¢ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´</span></span><br><span class="line">  <span class="comment">//ã€åŸå› ã€‘è¿™å¯ä»¥ç†è§£ä¸ºç”¨æˆ·æ‹¿åˆ°ä½ çš„èµ„æºå ç”¨çš„æ—¶é—´ï¼ŒåŠ å¼‚åœ°æœºæˆ¿äº†ä¹ˆï¼ŒåŠ CDN å¤„ç†äº†ä¹ˆï¼ŸåŠ å¸¦å®½äº†ä¹ˆï¼ŸåŠ  CPU è¿ç®—é€Ÿåº¦äº†ä¹ˆï¼Ÿ</span></span><br><span class="line">  <span class="comment">// TTFB å³ Time To First Byte çš„æ„æ€</span></span><br><span class="line">  <span class="comment">// ç»´åŸºç™¾ç§‘ï¼šhttps://en.wikipedia.org/wiki/Time_To_First_Byte</span></span><br><span class="line">  times.ttfb = t.responseStart - t.navigationStart;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ã€é‡è¦ã€‘å†…å®¹åŠ è½½å®Œæˆçš„æ—¶é—´</span></span><br><span class="line">  <span class="comment">//ã€åŸå› ã€‘é¡µé¢å†…å®¹ç»è¿‡ gzip å‹ç¼©äº†ä¹ˆï¼Œé™æ€èµ„æº css/js ç­‰å‹ç¼©äº†ä¹ˆï¼Ÿ</span></span><br><span class="line">  times.request = t.responseEnd - t.requestStart;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ã€é‡è¦ã€‘æ‰§è¡Œ onload å›è°ƒå‡½æ•°çš„æ—¶é—´</span></span><br><span class="line">  <span class="comment">//ã€åŸå› ã€‘æ˜¯å¦å¤ªå¤šä¸å¿…è¦çš„æ“ä½œéƒ½æ”¾åˆ° onload å›è°ƒå‡½æ•°é‡Œæ‰§è¡Œäº†ï¼Œè€ƒè™‘è¿‡å»¶è¿ŸåŠ è½½ã€æŒ‰éœ€åŠ è½½çš„ç­–ç•¥ä¹ˆï¼Ÿ</span></span><br><span class="line">  times.loadEvent = t.loadEventEnd - t.loadEventStart;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// DNS ç¼“å­˜æ—¶é—´</span></span><br><span class="line">  times.appcache = t.domainLookupStart - t.fetchStart;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¸è½½é¡µé¢çš„æ—¶é—´</span></span><br><span class="line">  times.unloadEvent = t.unloadEventEnd - t.unloadEventStart;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TCP å»ºç«‹è¿æ¥å®Œæˆæ¡æ‰‹çš„æ—¶é—´</span></span><br><span class="line">  times.connect = t.connectEnd - t.connectStart;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> times;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è®¡ç®—æ€§èƒ½æŒ‡æ ‡</strong></p><pre><code>å¯ä»¥ä½¿ç”¨Navigation.timing ç»Ÿè®¡åˆ°çš„æ—¶é—´æ•°æ®æ¥è®¡ç®—ä¸€äº›é¡µé¢æ€§èƒ½æŒ‡æ ‡ï¼Œæ¯”å¦‚DNSæŸ¥è¯¢è€—æ—¶ã€ç™½å±æ—¶é—´ã€domreadyç­‰ç­‰ã€‚å¦‚ä¸‹ï¼šDNSæŸ¥è¯¢è€—æ—¶ = domainLookupEnd - domainLookupStartTCPé“¾æ¥è€—æ—¶ = connectEnd - connectStartrequestè¯·æ±‚è€—æ—¶ = responseEnd - responseStartè§£ædomæ ‘è€—æ—¶ = domComplete - domInteractiveç™½å±æ—¶é—´ = domloadng - fetchStartdomreadyæ—¶é—´ = domContentLoadedEventEnd - fetchStartonloadæ—¶é—´ = loadEventEnd - fetchStart</code></pre><h2 id="è¯»å–æ³¨é‡Š"><a href="#è¯»å–æ³¨é‡Š" class="headerlink" title="è¯»å–æ³¨é‡Š"></a>è¯»å–æ³¨é‡Š</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eachComment</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> child = ele.childNodes[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (child.nodeType === <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(child.nodeValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> bodyElement = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"body"</span>)[<span class="number">0</span>];</span><br><span class="line">eachComment(bodyElement);</span><br></pre></td></tr></table></figure><h2 id="es5çš„å‡ ç§ç»§æ‰¿æ–¹å¼"><a href="#es5çš„å‡ ç§ç»§æ‰¿æ–¹å¼" class="headerlink" title="es5çš„å‡ ç§ç»§æ‰¿æ–¹å¼"></a>es5çš„å‡ ç§ç»§æ‰¿æ–¹å¼</h2><h3 id="å¯¹è±¡å†’å……å®ç°ç»§æ‰¿"><a href="#å¯¹è±¡å†’å……å®ç°ç»§æ‰¿" class="headerlink" title="å¯¹è±¡å†’å……å®ç°ç»§æ‰¿"></a>å¯¹è±¡å†’å……å®ç°ç»§æ‰¿</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name=<span class="string">'å¼ ä¸‰'</span>;  <span class="comment">/*å±æ€§*/</span></span><br><span class="line">    <span class="keyword">this</span>.age=<span class="number">20</span>;</span><br><span class="line">    <span class="keyword">this</span>.run=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  <span class="comment">/*å®ä¾‹æ–¹æ³•*/</span></span><br><span class="line">        alert(<span class="keyword">this</span>.name+<span class="string">'åœ¨è¿åŠ¨'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;      </span><br><span class="line">Person.prototype.sex=<span class="string">"ç”·"</span>;</span><br><span class="line">Person.prototype.work=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     alert(<span class="keyword">this</span>.name+<span class="string">'åœ¨å·¥ä½œ'</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Webç±» ç»§æ‰¿Personç±»   å¯¹è±¡å†’å……çš„ç»„åˆç»§æ‰¿æ¨¡å¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Web</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Person.call(<span class="keyword">this</span>);    <span class="comment">/*å¯¹è±¡å†’å……å®ç°ç»§æ‰¿*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> w=<span class="keyword">new</span> Web();</span><br><span class="line"><span class="comment">// w.run();  //**å¯¹è±¡å†’å……å¯ä»¥ç»§æ‰¿æ„é€ å‡½æ•°é‡Œé¢çš„å±æ€§å’Œæ–¹æ³•**</span></span><br><span class="line"></span><br><span class="line">w.work();  <span class="comment">//å¯¹è±¡å†’å……å¯ä»¥ç»§æ‰¿æ„é€ å‡½æ•°é‡Œé¢çš„å±æ€§å’Œæ–¹æ³•   ä½†æ˜¯æ²¡æ³•ç»§æ‰¿åŸå‹é“¾ä¸Šé¢çš„å±æ€§å’Œæ–¹æ³•</span></span><br></pre></td></tr></table></figure><h3 id="åŸå‹é“¾å®ç°ç»§æ‰¿"><a href="#åŸå‹é“¾å®ç°ç»§æ‰¿" class="headerlink" title="åŸå‹é“¾å®ç°ç»§æ‰¿"></a>åŸå‹é“¾å®ç°ç»§æ‰¿</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name=<span class="string">'å¼ ä¸‰'</span>;  <span class="comment">/*å±æ€§*/</span></span><br><span class="line">    <span class="keyword">this</span>.age=<span class="number">20</span>;</span><br><span class="line">    <span class="keyword">this</span>.run=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  <span class="comment">/*å®ä¾‹æ–¹æ³•*/</span></span><br><span class="line">        alert(<span class="keyword">this</span>.name+<span class="string">'åœ¨è¿åŠ¨'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;      </span><br><span class="line">Person.prototype.sex=<span class="string">"ç”·"</span>;</span><br><span class="line">Person.prototype.work=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     alert(<span class="keyword">this</span>.name+<span class="string">'åœ¨å·¥ä½œ'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Webç±» ç»§æ‰¿Personç±»   åŸå‹é“¾+å¯¹è±¡å†’å……çš„ç»„åˆç»§æ‰¿æ¨¡å¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Web</span>(<span class="params">name,age</span>)</span>&#123;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Web.prototype=<span class="keyword">new</span> Person();   <span class="comment">//åŸå‹é“¾å®ç°ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">var</span> w=<span class="keyword">new</span> Web();</span><br><span class="line"><span class="comment">//åŸå‹é“¾å®ç°ç»§æ‰¿:å¯ä»¥ç»§æ‰¿æ„é€ å‡½æ•°é‡Œé¢çš„å±æ€§å’Œæ–¹æ³• ä¹Ÿå¯ä»¥ç»§æ‰¿åŸå‹é“¾ä¸Šé¢çš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="comment">//w.run();</span></span><br><span class="line"></span><br><span class="line">w.work();</span><br><span class="line"> <span class="comment">//ç¼ºç‚¹æ˜¯å®ä¾‹åŒ–å­ç±»çš„æ—¶å€™æ²¡æ³•ç»™çˆ¶ç±»ä¼ å‚</span></span><br></pre></td></tr></table></figure><h3 id="åŸå‹é“¾-å¯¹è±¡å†’å……çš„ç»„åˆç»§æ‰¿æ¨¡å¼"><a href="#åŸå‹é“¾-å¯¹è±¡å†’å……çš„ç»„åˆç»§æ‰¿æ¨¡å¼" class="headerlink" title="åŸå‹é“¾+å¯¹è±¡å†’å……çš„ç»„åˆç»§æ‰¿æ¨¡å¼"></a>åŸå‹é“¾+å¯¹è±¡å†’å……çš„ç»„åˆç»§æ‰¿æ¨¡å¼</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name=name;  <span class="comment">/*å±æ€§*/</span></span><br><span class="line">        <span class="keyword">this</span>.age=age;</span><br><span class="line">        <span class="keyword">this</span>.run=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  <span class="comment">/*å®ä¾‹æ–¹æ³•*/</span></span><br><span class="line">            alert(<span class="keyword">this</span>.name+<span class="string">'åœ¨è¿åŠ¨'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;      </span><br><span class="line">Person.prototype.sex=<span class="string">"ç”·"</span>;</span><br><span class="line">Person.prototype.work=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name+<span class="string">'åœ¨å·¥ä½œ'</span>);</span><br><span class="line"></span><br><span class="line">&#125;   </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Web</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">    Person.call(<span class="keyword">this</span>,name,age);   <span class="comment">//å¯¹è±¡å†’å……ç»§æ‰¿   å®ä¾‹åŒ–å­ç±»å¯ä»¥ç»™çˆ¶ç±»ä¼ å‚</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Web.prototype=<span class="keyword">new</span> Person();<span class="comment">//ä¸Šé¢å·²ç»ç»§æ‰¿äº†æ„å‡½æ•°çš„æ–¹æ³• ï¼Œ è¿™é‡Œnew ä¸€ä¸ªä¼šé‡æ–°ç»§æ‰¿ç‹—æ‚å‡½æ•°çš„æ–¹æ³• ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥ -&gt; Web.prototype=Person.prototype;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> w=<span class="keyword">new</span> Web(<span class="string">'èµµå››'</span>,<span class="number">20</span>);   </span><br><span class="line"></span><br><span class="line"><span class="comment">// w.run();</span></span><br><span class="line">w.work();</span><br><span class="line"></span><br><span class="line"><span class="comment">// var w1=new Web('ç‹äº”',22);</span></span><br></pre></td></tr></table></figure><h3 id="classå®ç°ç»§æ‰¿æºç "><a href="#classå®ç°ç»§æ‰¿æºç " class="headerlink" title="classå®ç°ç»§æ‰¿æºç "></a>classå®ç°ç»§æ‰¿æºç </h3><p><code>ES6</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = props.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// å‘çˆ¶ç±»ä¼ å‚</span></span><br><span class="line">    <span class="keyword">super</span>(&#123; <span class="attr">name</span>: <span class="string">'B'</span> &#125;);</span><br><span class="line">    <span class="comment">// this å¿…é¡»åœ¨ super() ä¸‹é¢ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ES5</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__extends</span>(<span class="params">child, parent</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¿®æ”¹å¯¹è±¡åŸå‹</span></span><br><span class="line">  <span class="built_in">Object</span>.setPrototypeOf(child, parent);</span><br><span class="line">  <span class="comment">// å¯„ç”Ÿç»§æ‰¿ï¼Œåˆ›å»ºä¸€ä¸ªå¹²å‡€çš„æ„é€ å‡½æ•°ï¼Œç”¨äºç»§æ‰¿çˆ¶ç±»çš„ prototype</span></span><br><span class="line">  <span class="comment">// è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¿®æ”¹å­ç±»çš„ prototype ä¸ä¼šå½±å“çˆ¶ç±»çš„ prototype</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä¿®æ­£ constructor æŒ‡å‘å­ç±»</span></span><br><span class="line">    <span class="keyword">this</span>.constructor = child;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åŸå‹ç»§æ‰¿ï¼Œç»§æ‰¿çˆ¶ç±»åŸå‹å±æ€§ï¼Œä½†æ˜¯æ— æ³•å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚</span></span><br><span class="line">  child.prototype =</span><br><span class="line">    parent === <span class="literal">null</span></span><br><span class="line">      ? <span class="built_in">Object</span>.create(parent)</span><br><span class="line">      : ((__.prototype = parent.prototype), <span class="keyword">new</span> __());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> B = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = props.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> B;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="keyword">var</span> A = (<span class="function"><span class="keyword">function</span> (<span class="params">_super</span>) </span>&#123;</span><br><span class="line">    __extends(A, _super);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _this = _super.call(<span class="keyword">this</span>, &#123; <span class="attr">name</span>: <span class="string">'B'</span> &#125;) || <span class="keyword">this</span>; <span class="comment">// // å‘çˆ¶ç±»ä¼ å‚</span></span><br><span class="line">        <span class="comment">// this å¿…é¡»åœ¨ super() ä¸‹é¢ä½¿ç”¨</span></span><br><span class="line">        <span class="built_in">console</span>.log(_this);</span><br><span class="line">        <span class="keyword">return</span> _this;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> A;</span><br><span class="line">&#125;(B));</span><br></pre></td></tr></table></figure><h2 id="å‚çœ‹æ–‡æ¡£"><a href="#å‚çœ‹æ–‡æ¡£" class="headerlink" title="å‚çœ‹æ–‡æ¡£"></a>å‚çœ‹æ–‡æ¡£</h2><p><a href="https://sourcegraph.com/github.com/alienzhou/frontend-tech-list@master/-/blob/README.md?utm_source=share" target="_blank" rel="noopener">github</a><br><a href="https://panjiachen.github.io/awesome-bookmarks/repository/" target="_blank" rel="noopener">åšå®¢1</a><br><a href="https://lq782655835.github.io/blogs//" target="_blank" rel="noopener">åšå®¢2</a><br><a href="https://www.muyiy.cn/" target="_blank" rel="noopener">åšå®¢3</a></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
          <category> æŠ€æœ¯æ¸…å• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Promise &amp; async</title>
      <link href="/2018/01/16/workspace/Js/promise/"/>
      <url>/2018/01/16/workspace/Js/promise/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Promise &amp; async</strong></p><p>[[toc]]</p><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><ul><li>ä¸»è¦ç”¨äºå¼‚æ­¥è®¡ç®—</li><li>å¯ä»¥å°†å¼‚æ­¥æ“ä½œé˜Ÿåˆ—åŒ–ï¼ŒæŒ‰ç…§æœŸæœ›çš„é¡ºåºæ‰§è¡Œï¼Œè¿”å›ç¬¦åˆé¢„æœŸçš„ç»“æœ</li><li>å¯ä»¥åœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’å’Œæ“ä½œpromiseï¼Œå¸®åŠ©æˆ‘ä»¬å¤„ç†é˜Ÿåˆ—</li></ul><p><strong>å®ç°ä¸€ä¸ª Promise</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span>  resolvePromise = <span class="function">(<span class="params">promise2,x,resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­xçš„ç±»å‹ æ¥å¤„ç†promise2æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥</span></span><br><span class="line">    <span class="comment">// æ‰€æœ‰çš„promiseéƒ½éµå¾ªè¿™ä¸ªè§„èŒƒï¼Œä¸åŒçš„äººå†™çš„promiseå¯èƒ½ä¼šæ··ç”¨</span></span><br><span class="line">    <span class="comment">// å°½å¯èƒ½è€ƒè™‘çš„å‘¨å…¨ è¦è€ƒè™‘åˆ«äººpromiseå¯èƒ½å‡ºé”™çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span>(promise2 === x)&#123;</span><br><span class="line">        <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'å¾ªç¯å¼•ç”¨'</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­xæ˜¯ä¸æ˜¯ä¸€ä¸ªpromise  ,è¿™ä¸ªx å¯èƒ½ä¸æ˜¯è‡ªå·±çš„promise æ‰€ä»¥ä¸ºäº†å®‰å…¨ éœ€è¦åœ¨è¿›è¡Œæ ¡éªŒï¼Œæ”¾ç½®è°ƒä¸€èµ·ç”¨æˆåŠŸå’Œå¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> x === <span class="string">'function'</span> || (<span class="keyword">typeof</span> x === <span class="string">'object'</span> &amp;&amp; x !== <span class="literal">null</span>))&#123;</span><br><span class="line">        <span class="comment">// å°è¯•å–å½“å‰xçš„thenæ–¹æ³•, è¿™ä¸ªthenæ–¹æ³•å¯èƒ½åˆ«äººå®šä¹‰çš„æ—¶å€™ ç”¨çš„Object.defineProperty</span></span><br><span class="line">        <span class="keyword">let</span> called;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> then = x.then; <span class="comment">// å¦‚æœå–thenæ–¹æ³•å‡ºé”™ é‚£å°±ç”¨é”™è¯¯æ‹’ç»promise2</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">typeof</span> then === <span class="string">'function'</span>)&#123; <span class="comment">// æˆ‘å°±è®¤ä¸ºä»–æ˜¯ä¸€ä¸ªpromise</span></span><br><span class="line">                then.call(x,y=&gt;&#123; <span class="comment">// è®©å½“å‰çš„promiseæ‰§è¡Œ ï¼Œä¸ç”¨å¤šæ¬¡å–thenæ–¹æ³•äº†</span></span><br><span class="line">                    <span class="comment">// y æœ‰å¯èƒ½è¿˜æ˜¯ä¸€ä¸ªpromise , ç»§ç»­è°ƒç”¨resolvePromiseæ–¹æ³•ï¼Œç›´åˆ°è§£æå‡ºä¸€ä¸ªå¸¸é‡ä¸ºæ­¢ï¼Œæœ€ç»ˆæŠŠå¸¸é‡ä¼ é€’ä¸‹å»</span></span><br><span class="line">                    <span class="keyword">if</span>(called) <span class="keyword">return</span>; <span class="comment">// æ”¾ç½®æ­¤æ–¹æ³•å¤šæ¬¡è¢«è°ƒç”¨</span></span><br><span class="line">                    called = <span class="literal">true</span>;</span><br><span class="line">                    resolvePromise(promise2,y,resolve,reject);</span><br><span class="line">                &#125;,r=&gt;&#123;</span><br><span class="line">                    <span class="keyword">if</span>(called) <span class="keyword">return</span>;</span><br><span class="line">                    called = <span class="literal">true</span>;</span><br><span class="line">                    reject(r); <span class="comment">// è®©å½“å‰çš„promiseå˜æˆå¤±è´¥æ€å³å¯</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// xå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ å¹¶æ²¡æœ‰thenæ–¹æ³•</span></span><br><span class="line">                resolve(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            <span class="keyword">if</span>(called) <span class="keyword">return</span>;</span><br><span class="line">            called = <span class="literal">true</span>;</span><br><span class="line">            reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// xè‚¯å®šä¸€ä¸ªå¸¸é‡</span></span><br><span class="line">        resolve(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Promise</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(executor)&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = <span class="string">'pending'</span>;</span><br><span class="line">        <span class="keyword">this</span>.value;</span><br><span class="line">        <span class="keyword">this</span>.reason;</span><br><span class="line">        <span class="keyword">this</span>.resolveCallbacks = []; <span class="comment">// å½“thenæ˜¯pending æˆ‘å¸Œæœ›å§æˆåŠŸçš„æ–¹æ³•éƒ½æ”¾åˆ°æ•°ç»„ä¸­</span></span><br><span class="line">        <span class="keyword">this</span>.rejectCallbacks = [];</span><br><span class="line">        <span class="keyword">let</span> resolve = <span class="function">(<span class="params">value</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯promiseå°±è°ƒç”¨è¿™ä¸ªpromiseçš„thenæ–¹æ³•</span></span><br><span class="line">            <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="built_in">Promise</span>)&#123;</span><br><span class="line">                <span class="comment">// ä¸åœçš„è§£æ ç­‰å¾…ç€è§£æå‡ºä¸€ä¸ªå¸¸é‡ ä¼ é€’ç»™ä¸‹é¢</span></span><br><span class="line">                <span class="keyword">return</span> value.then(resolve,reject);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.status == <span class="string">'pending'</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.status = <span class="string">'fulfilled'</span>;</span><br><span class="line">                <span class="keyword">this</span>.value = value;</span><br><span class="line">                <span class="keyword">this</span>.resolveCallbacks.forEach(<span class="function"><span class="params">fn</span>=&gt;</span>fn()); <span class="comment">// å‘å¸ƒ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> reject = <span class="function">(<span class="params">reason</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.status === <span class="string">'pending'</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.status = <span class="string">'rejected'</span>;</span><br><span class="line">                <span class="keyword">this</span>.reason = reason;</span><br><span class="line">                <span class="keyword">this</span>.rejectCallbacks.forEach(<span class="function"><span class="params">fn</span>=&gt;</span>fn())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            executor(resolve,reject);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    then(onfulfilled,onrejected)&#123; <span class="comment">// onfulfilled,onrejected æ˜¯ä¸¤ä¸ªå¯é€‰å‚æ•°</span></span><br><span class="line">        onfulfilled = <span class="keyword">typeof</span> onfulfilled === <span class="string">'function'</span>?onfulfilled:<span class="function"><span class="params">val</span>=&gt;</span>val;</span><br><span class="line">        onrejected = <span class="keyword">typeof</span> onrejected === <span class="string">'function'</span>?onrejected:<span class="function"><span class="params">r</span>=&gt;</span>&#123;<span class="keyword">throw</span> r&#125;</span><br><span class="line">        <span class="keyword">let</span> promise2;</span><br><span class="line">        promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.status === <span class="string">'fulfilled'</span>)&#123;</span><br><span class="line">                setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">try</span>&#123;</span><br><span class="line">                        <span class="keyword">let</span> x = onfulfilled(<span class="keyword">this</span>.value);</span><br><span class="line">                        <span class="comment">// xæ˜¯æ™®é€šå€¼è¿˜æ˜¯promise å¦‚æœæ˜¯æ™®é€šå€¼ ç›´æ¥è°ƒç”¨promise2çš„resolve</span></span><br><span class="line">                        <span class="comment">// å¦‚æœæ˜¯promise  é‚£åº”è¯¥è®©xè¿™ä¸ªpromiseæ‰§è¡Œ x.then</span></span><br><span class="line">                        resolvePromise(promise2,x,resolve,reject);</span><br><span class="line">                    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">                        reject(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.status === <span class="string">'rejected'</span>)&#123;</span><br><span class="line">                setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">try</span>&#123;</span><br><span class="line">                        <span class="keyword">let</span> x = onrejected(<span class="keyword">this</span>.reason);</span><br><span class="line">                        resolvePromise(promise2,x,resolve,reject);</span><br><span class="line">                    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">                        reject(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,<span class="number">0</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.status === <span class="string">'pending'</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.resolveCallbacks.push(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                        <span class="keyword">try</span>&#123;</span><br><span class="line">                            <span class="keyword">let</span> x = onfulfilled(<span class="keyword">this</span>.value);</span><br><span class="line">                            resolvePromise(promise2,x,resolve,reject);</span><br><span class="line">                        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">                            reject(e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,<span class="number">0</span>)</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">this</span>.rejectCallbacks.push(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                        <span class="keyword">try</span>&#123;</span><br><span class="line">                            <span class="keyword">let</span> x = onrejected(<span class="keyword">this</span>.reason);</span><br><span class="line">                            resolvePromise(promise2,x,resolve,reject);</span><br><span class="line">                        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">                            reject(e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,<span class="number">0</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> promise2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(rejectFunc)&#123;<span class="comment">// catchçš„å®ç°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>,rejectFunc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æš´éœ²ä¸€ä¸ªæ–¹æ³•è¿™ä¸ªæ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªå¯¹è±¡ å¯¹è±¡ä¸Šéœ€è¦æœ‰ promise resolve reject ä¸‰ä¸ªå±æ€§</span></span><br><span class="line"><span class="comment">// å‡å°‘åµŒå¥—</span></span><br><span class="line"><span class="built_in">Promise</span>.defer = <span class="built_in">Promise</span>.deferred = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> dfd = &#123;&#125;</span><br><span class="line">    dfd.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        dfd.resolve = resolve;</span><br><span class="line">        dfd.reject = reject;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> dfd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// äº§ç”ŸæˆåŠŸçš„promise</span></span><br><span class="line"><span class="built_in">Promise</span>.resolve = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        resolve(value);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// äº§ç”Ÿä¸€ä¸ªå¤±è´¥çš„promise</span></span><br><span class="line"><span class="built_in">Promise</span>.reject = <span class="function"><span class="keyword">function</span>(<span class="params">reason</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        reject(reason);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Promise</span>.all = <span class="function"><span class="keyword">function</span>(<span class="params">values</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> results = []; <span class="comment">// ç»“æœæ•°ç»„</span></span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> processData = <span class="function">(<span class="params">value,index</span>)=&gt;</span>&#123;</span><br><span class="line">            results[index] = value;</span><br><span class="line">            <span class="comment">// å½“æˆåŠŸçš„ä¸ªæ•° å’Œ å½“å‰çš„å‚æ•°ä¸ªæ•°ç›¸ç­‰å°±æŠŠç»“æœæŠ›å‡ºå»</span></span><br><span class="line">            <span class="keyword">if</span>(++i === values.length)&#123;</span><br><span class="line">                resolve(results);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i&lt; values.length;i++)&#123;</span><br><span class="line">            <span class="keyword">let</span> current = values[i]; <span class="comment">// æ‹¿åˆ°æ•°ç»„ä¸­æ¯ä¸€é¡¹</span></span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ªpromise</span></span><br><span class="line">            <span class="keyword">if</span>((<span class="keyword">typeof</span> current === <span class="string">'object'</span> &amp;&amp;  current !==<span class="literal">null</span>)|| <span class="keyword">typeof</span> current == <span class="string">'function'</span>)&#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯promise</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">typeof</span> current.then == <span class="string">'function'</span>)&#123;</span><br><span class="line">                    <span class="comment">// å°±è°ƒç”¨è¿™ä¸ªpromiseçš„thenæ–¹æ³•ï¼ŒæŠŠç»“æœå’Œç´¢å¼•å¯¹åº”ä¸Š,å¦‚æœä»»ä½•ä¸€ä¸ªå¤±è´¥äº†è¿”å›çš„proimiseå°±æ˜¯ä¸€ä¸ªå¤±è´¥çš„promise</span></span><br><span class="line">                    current.then(<span class="function"><span class="params">y</span>=&gt;</span>&#123;</span><br><span class="line">                        processData(y,i);</span><br><span class="line">                    &#125;,reject);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    processData(current,i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                processData(current,i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// raceçš„åŸç†</span></span><br><span class="line"><span class="built_in">Promise</span>.race = <span class="function"><span class="keyword">function</span>(<span class="params">values</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i&lt; values.length;i++)&#123;</span><br><span class="line">            <span class="keyword">let</span> current = values[i];</span><br><span class="line">            <span class="keyword">if</span>((<span class="keyword">typeof</span> current === <span class="string">'object'</span> &amp;&amp;  current !==<span class="literal">null</span>)|| <span class="keyword">typeof</span> current == <span class="string">'function'</span>)&#123;</span><br><span class="line">                <span class="keyword">let</span> then = current.then;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">typeof</span> then == <span class="string">'function'</span>)&#123; <span class="comment">// æ¯”è¾ƒå“ªä¸ªpromiseæ¯”è¾ƒå¿«ï¼Œè°å¿«ç”¨å¿«</span></span><br><span class="line">                    then.call(current,resolve,reject)</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    resolve(current);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                resolve(current);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><ul><li>generatorä¹Ÿæ˜¯ä¸ºäº†è§£å†³åœ°ç‹±å›è°ƒé—®é¢˜çš„ï¼Œå’Œpromiseä¸€æ ·éƒ½æ˜¯ä¸ºäº†å®ç°å¼‚æ­¥ç¼–ç¨‹ï¼Œæœ¬è´¨è¿˜æ˜¯å„ç§å›è°ƒï¼›</li><li>generatorä¸ºes6ä¸­æ–°å®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œè¿™ç§æ•°æ®ç±»å‹å’Œå‡½æ•°å¾ˆåƒï¼Œæ¯ä¸ªå‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªç»“æœï¼Œå³åªèƒ½returnä¸€æ¬¡ï¼Œ<br>å¦‚æœåœ¨æŸäº›å‡½æ•°ä¸­æ²¡æœ‰çœ‹åˆ°returnï¼Œå…¶å®è´¨åœ¨å‡½æ•°ç»“å°¾æ˜¯å­˜åœ¨ä¸€ä¸ªéšè—çš„return undefined çš„ï¼Œè€Œgeneratorä¸åŒï¼Œå¯ä»¥è¿”å›å¤šæ¬¡</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"ç»“æŸ"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> g = gen();</span><br><span class="line"><span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="comment">//æ¯é—´éš”500msæ‰§è¡Œä¸€æ¬¡g.next()ï¼Œæ‰§è¡Œ7æ¬¡ï¼Œå¹¶åœ¨æ§åˆ¶å°æ‰“å°</span></span><br><span class="line">      i++;</span><br><span class="line">      <span class="built_in">console</span>.log(g.next()); <span class="comment">//æ‰§è¡Œgenå‡½æ•°</span></span><br><span class="line">      <span class="keyword">if</span>(i&gt;<span class="number">7</span>)&#123;</span><br><span class="line">          clearInterval(timer);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  g.throw(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'test1'</span>))</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¾‹å­ å¯ä»¥çœ‹å‡ºgenerator é‡åˆ°yleldå°±ä¼šæš‚åœï¼Œåªæœ‰å½“è°ƒç”¨<code>generator.next()</code>æ‰ä¼šå‘ä¸‹æ‰§è¡Œï¼Œ<br>è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›<code>{value: x, done: true/false}</code>,è¿™ä¸ªå¯¹è±¡ä¸­valueæ˜¯yieldçš„è¿”å›å€¼ï¼Œ<br>doneè¡¨ç¤ºgeneratoræ˜¯å¦æ‰§è¡Œç»“æŸï¼Œåªæœ‰å½“æ‰§è¡Œåˆ°returnæ—¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­çš„doneæ‰ä¼šå˜æˆtrueï¼Œè¯´æ˜æ‰§è¡Œç»“æŸ</p><h3 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h3><p>åŸç†å°±æ˜¯åˆ©ç”¨ generatorï¼ˆç”Ÿæˆå™¨ï¼‰åˆ†å‰²ä»£ç ç‰‡æ®µã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå‡½æ•°è®©å…¶è‡ªè¿­ä»£ï¼Œæ¯ä¸€ä¸ªyield ç”¨ promise åŒ…è£¹èµ·æ¥ã€‚æ‰§è¡Œä¸‹ä¸€æ­¥çš„æ—¶æœºç”± promise æ¥æ§åˆ¶</p><p>è€Œä¸”ç›¸è¾ƒäºPromise,asyncçš„ä¼˜è¶Šæ€§å°±æ˜¯æŠŠæ¯æ¬¡å¼‚æ­¥è¿”å›çš„ç»“æœä»thenä¸­æ‹¿åˆ°æœ€å¤–å±‚çš„æ–¹æ³•ä¸­ï¼Œä¸éœ€è¦é“¾å¼è°ƒç”¨ï¼Œåªè¦ç”¨åŒæ­¥çš„å†™æ³•å°±å¯ä»¥äº†ã€‚<br>æ›´åŠ ç›´è§‚è€Œä¸”ï¼Œæ›´é€‚åˆå¤„ç†å¹¶å‘è°ƒç”¨çš„é—®é¢˜ã€‚ä½†æ˜¯asyncå¿…é¡»ä»¥ä¸€ä¸ªPromiseå¯¹è±¡å¼€å§‹ ï¼Œæ‰€ä»¥asyncé€šå¸¸æ˜¯å’ŒPromiseç»“åˆä½¿ç”¨çš„</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_asyncToGenerator</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>,</span><br><span class="line">      args = <span class="built_in">arguments</span>;</span><br><span class="line">    <span class="comment">// å°†è¿”å›å€¼promiseåŒ–</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// è·å–è¿­ä»£å™¨å®ä¾‹</span></span><br><span class="line">      <span class="keyword">var</span> gen = fn.apply(self, args);</span><br><span class="line">      <span class="comment">// æ‰§è¡Œä¸‹ä¸€æ­¥</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">_next</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        asyncGeneratorStep(gen, resolve, reject, _next, _throw, <span class="string">'next'</span>, value);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">_throw</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        asyncGeneratorStep(gen, resolve, reject, _next, _throw, <span class="string">'throw'</span>, err);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ç¬¬ä¸€æ¬¡è§¦å‘</span></span><br><span class="line">      _next(<span class="literal">undefined</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncGeneratorStep</span>(<span class="params">gen, resolve, reject, _next, _throw, key, arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> info = gen[key](arg);</span><br><span class="line">    <span class="keyword">var</span> value = info.value;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (info.done) &#123;</span><br><span class="line">    <span class="comment">// è¿­ä»£å™¨å®Œæˆ</span></span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// -- è¿™è¡Œä»£ç å°±æ˜¯ç²¾é«“ --</span></span><br><span class="line">    <span class="comment">// å°†æ‰€æœ‰å€¼promiseåŒ–</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚ yield 1</span></span><br><span class="line">    <span class="comment">// const a = Promise.resolve(1) a æ˜¯ä¸€ä¸ª promise</span></span><br><span class="line">    <span class="comment">// const b = Promise.resolve(a) b æ˜¯ä¸€ä¸ª promise</span></span><br><span class="line">    <span class="comment">// å¯ä»¥åšåˆ°ç»Ÿä¸€ promise è¾“å‡º</span></span><br><span class="line">    <span class="comment">// å½“ promise æ‰§è¡Œå®Œä¹‹åå†æ‰§è¡Œä¸‹ä¸€æ­¥</span></span><br><span class="line">    <span class="comment">// é€’å½’è°ƒç”¨ next å‡½æ•°ï¼Œç›´åˆ° done == true</span></span><br><span class="line">    <span class="built_in">Promise</span>.resolve(value).then(_next, _throw);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>await</strong><br>æ¯æ¬¡é‡åˆ°awaitéƒ½ä¼šä¸­æ–­æ­¤æ¬¡è¿›ç¨‹ï¼Œç„¶åå»æ‰§è¡Œå¤–é¢çš„åŒæ­¥ä»£ç ï¼Œç„¶åå†è¿›æ¥ï¼Œæ ¹æ®ä¸Šæ¬¡ä¿å­˜çš„nextå€¼ï¼Œç»§ç»­æ‰§è¡Œ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">console</span>.log(<span class="number">121212</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">121212</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    _foo = _asyncToGenerator(</span><br><span class="line">        regeneratorRuntime.mark(<span class="function"><span class="keyword">function</span> <span class="title">_callee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> regeneratorRuntime.wrap(<span class="function"><span class="keyword">function</span> <span class="title">_callee$</span>(<span class="params">_context</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">switch</span> (_context.prev = _context.next) &#123;</span><br><span class="line">                        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                            _context.next = <span class="number">2</span>;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="number">121212</span>);</span><br><span class="line">                        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                             <span class="built_in">console</span>.log(<span class="number">121212</span>);</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">"end"</span>:</span><br><span class="line">                            <span class="keyword">return</span> _context.stop();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, _callee);</span><br><span class="line">        &#125;));</span><br><span class="line">    <span class="keyword">return</span> _foo.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> asyncFunc = _asyncToGenerator(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> e = <span class="keyword">yield</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="string">'e'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> a = <span class="keyword">yield</span> <span class="built_in">Promise</span>.resolve(<span class="string">'a'</span>);</span><br><span class="line">  <span class="keyword">const</span> d = <span class="keyword">yield</span> <span class="string">'d'</span>;</span><br><span class="line">  <span class="keyword">const</span> b = <span class="keyword">yield</span> <span class="built_in">Promise</span>.resolve(<span class="string">'b'</span>);</span><br><span class="line">  <span class="keyword">const</span> c = <span class="keyword">yield</span> <span class="built_in">Promise</span>.resolve(<span class="string">'c'</span>);</span><br><span class="line">  <span class="keyword">return</span> [a, b, c, d, e];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">asyncFunc().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res); <span class="comment">// ['a', 'b', 'c', 'd', 'e']</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è¯´ï¼Œasyncå’Œgeneratorå‡½æ•°ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³å¼‚æ­¥çš„å¹¶å‘è°ƒç”¨ä½¿ç”¨çš„ ï¼Œç›´æ¥å°†å‚æ•°ä»thené‡Œå–å‡ºæ¥ï¼Œç›¸æ¯”promiseçš„é“¾å¼è°ƒç”¨ï¼Œä¼ å‚æ›´åŠ æ–¹ä¾¿ï¼Œå¼‚æ­¥é¡ºåºæ›´åŠ æ¸…æ™°</p><h4 id="æ•è·é”™è¯¯"><a href="#æ•è·é”™è¯¯" class="headerlink" title="æ•è·é”™è¯¯"></a>æ•è·é”™è¯¯</h4><p><strong>try catch</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> fn()</span><br><span class="line"> &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'err is -&gt;'</span>, err)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><p>å•ä¸ªè¿˜å¥½ï¼Œå¤šä¸ªawaitå°±æ˜¾å¾—éº»çƒ¦äº†</p><p><strong>åˆ©ç”¨promise</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"> <span class="keyword">const</span> [err, data] = <span class="keyword">await</span> fn().then(<span class="function"><span class="params">data</span> =&gt;</span> [<span class="literal">null</span>, data] ).catch(<span class="function"><span class="params">err</span> =&gt;</span> [err, <span class="literal">null</span>])</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠ½ç¦»æˆå…¬å…±æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> awaitWrap = <span class="function">(<span class="params">promise</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line">   .then(<span class="function"><span class="params">data</span> =&gt;</span> [<span class="literal">null</span>, data])</span><br><span class="line">   .catch(<span class="function"><span class="params">err</span> =&gt;</span> [err, <span class="literal">null</span>])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [err, data] = <span class="keyword">await</span> awaitWrap(fn())</span><br></pre></td></tr></table></figure><h4 id="asyncå‡½æ•°Generatorå‡½æ•°çš„åŒºåˆ«"><a href="#asyncå‡½æ•°Generatorå‡½æ•°çš„åŒºåˆ«" class="headerlink" title="asyncå‡½æ•°Generatorå‡½æ•°çš„åŒºåˆ«"></a>asyncå‡½æ•°Generatorå‡½æ•°çš„åŒºåˆ«</h4><p>1.å†…ç½®æ‰§è¡Œå™¨ã€‚<br/><br>Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œè€Œasyncå‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œasyncå‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚å¦‚æœä½ æ˜¯ä»ä¸Šé¢é¡ºç€çœ‹ä¸‹æ¥çš„ï¼Œè¿™é‡Œçš„æ‰§è¡Œå™¨å°±æ˜¯Generatorå’ŒIteratorçš„yieldå’Œnextæœºåˆ¶ï¼Œä¸ç”¨æ€€ç–‘ï¼</p><p>2.æ›´å¥½çš„è¯­ä¹‰ã€‚<br/><br>asyncå’Œawaitï¼Œæ¯”èµ·æ˜Ÿå·å’Œyieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚asyncè¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawaitè¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚</p><p>3.æ­£å¸¸æƒ…å†µä¸‹ï¼Œawaitå‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚å¦‚æœä¸æ˜¯ï¼Œä¼šè¢«è½¬æˆä¸€ä¸ªç«‹å³resolveçš„ Promise å¯¹è±¡ã€‚</p><p>4.è¿”å›å€¼æ˜¯ Promiseã€‚<br/><br>asyncå‡½æ•°çš„è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ï¼Œè¿™æ¯” Generator å‡½æ•°çš„è¿”å›å€¼æ˜¯ Iterator å¯¹è±¡æ–¹ä¾¿å¤šäº†ã€‚ä½ å¯ä»¥ç”¨thenæ–¹æ³•æŒ‡å®šä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RegExpæ­£åˆ™</title>
      <link href="/2018/01/16/workspace/Js/reg/"/>
      <url>/2018/01/16/workspace/Js/reg/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>RegExpæ­£åˆ™</strong></p><p>[[toc]]</p><h3 id="æ­£åˆ™æ–¹æ³•"><a href="#æ­£åˆ™æ–¹æ³•" class="headerlink" title="æ­£åˆ™æ–¹æ³•"></a>æ­£åˆ™æ–¹æ³•</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">reg.test(str)  <span class="comment">//æ£€éªŒ </span></span><br><span class="line"><span class="comment">//å­—ç¬¦ä¸²ä¸­æœ‰æ²¡æœ‰æ­£åˆ™èƒ½åŒ¹é…åˆ°çš„å†…å®¹ï¼Œè¿”å›å€¼: true false</span></span><br><span class="line">reg.exec(str)  <span class="comment">//æ•è· </span></span><br><span class="line"><span class="comment">//æ–¹æ³•ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ã€‚ </span></span><br><span class="line"><span class="comment">//è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾åŒ¹é…çš„ç»“æœã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…ï¼Œåˆ™è¿”å›å€¼ä¸º nullã€‚</span></span><br><span class="line">str.match(reg) <span class="comment">// æŠŠåŒ¹é…åˆ°çš„å­—ç¬¦æ”¾å…¥åˆ°æ•°ç»„ä¸­ï¼Œä¸åŒ¹é…è¿”å›null</span></span><br><span class="line">str.replace( reg ,<span class="string">""</span>æ›¿æ¢æˆä»€ä¹ˆ | callbackï¼ˆæ›¿æ¢æˆä»€ä¹ˆï¼‰)</span><br></pre></td></tr></table></figure><h3 id="æ­£åˆ™çš„ä¿®é¥°ç¬¦ã€å…ƒå­—ç¬¦"><a href="#æ­£åˆ™çš„ä¿®é¥°ç¬¦ã€å…ƒå­—ç¬¦" class="headerlink" title="æ­£åˆ™çš„ä¿®é¥°ç¬¦ã€å…ƒå­—ç¬¦"></a>æ­£åˆ™çš„ä¿®é¥°ç¬¦ã€å…ƒå­—ç¬¦</h3><h4 id="é‡è¯å…ƒå­—ç¬¦"><a href="#é‡è¯å…ƒå­—ç¬¦" class="headerlink" title="é‡è¯å…ƒå­—ç¬¦"></a>é‡è¯å…ƒå­—ç¬¦</h4><table><thead><tr><th align="left"><span style='display: block;text-align: left;'> å¸¸ç”¨æŒ‡ä»¤    </span></th><th align="left"><span style='display: block;text-align: left;'> æè¿°</span></th></tr></thead><tbody><tr><td align="left">\n</td><td align="left">åœ¨jsä¸­è¡¨ç¤ºæ¢è¡Œ</td></tr><tr><td align="left">*</td><td align="left"><code>è¡¨ç¤ºå‡ºç°0æ¬¡åˆ°å¤šæ¬¡</code></td></tr><tr><td align="left">ï¼Ÿ</td><td align="left"><code>è¡¨ç¤ºå‡ºç°0æ¬¡æˆ–1æ¬¡</code></td></tr><tr><td align="left">+</td><td align="left"><code>è¡¨ç¤ºè‡³å°‘å‡ºç°ä¸€æ¬¡</code></td></tr><tr><td align="left">{n}</td><td align="left">è¡¨ç¤ºå‡ºç°næ¬¡</td></tr><tr><td align="left">{n,}</td><td align="left">è¡¨ç¤ºè‡³å°‘å‡ºç°næ¬¡</td></tr><tr><td align="left">{n,m}</td><td align="left"><code>æœ€å°æ˜¯nï¼Œæœ€å¤§æ˜¯mï¼Œï¼ˆnï¼Œméƒ½æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°</code></td></tr></tbody></table><p><code>ä¸­æ–‡çš„èŒƒå›´ï¼š[ \u4e00 - \u9fa5 ]</code> ï¼ˆè®°å¿†ï¼šæœ‰äº‹100ï¼Œæœ‰é…’ç½šæˆ‘ï¼‰</p><h4 id="ä¿®é¥°ç¬¦æœ‰ä¸‰ç§"><a href="#ä¿®é¥°ç¬¦æœ‰ä¸‰ç§" class="headerlink" title="ä¿®é¥°ç¬¦æœ‰ä¸‰ç§"></a>ä¿®é¥°ç¬¦æœ‰ä¸‰ç§</h4><table><thead><tr><th align="left"><span style='display: block;text-align: left;'>ä¿®é¥°ç¬¦</span></th><th align="left"><span style='display: block;text-align: left;'> è¯´æ˜</span></th></tr></thead><tbody><tr><td align="left">i</td><td align="left">å¿½ç•¥å¤§å°å†™åŒ¹é…</td></tr><tr><td align="left">g</td><td align="left">å…¨å±€åŒ¹é…ï¼Œå³æ˜¯åŒ¹é…ä¸€ä¸ªåç»§ç»­åŒ¹é…ï¼Œç›´åˆ°ç»“æŸ</td></tr><tr><td align="left">m</td><td align="left">å¤šè¡ŒåŒ¹é…ï¼Œå³æ˜¯é‡åˆ°æ¢è¡Œåä¸åœæ­¢åŒ¹é…ï¼Œç›´åˆ°ç»“æŸ</td></tr></tbody></table><h4 id="ç‰¹æ®Šå…ƒå­—ç¬¦"><a href="#ç‰¹æ®Šå…ƒå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå…ƒå­—ç¬¦"></a>ç‰¹æ®Šå…ƒå­—ç¬¦</h4><table><thead><tr><th align="left"><span style='display: block;text-align: left;'>å­—ç¬¦</span></th><th align="left"><span style='display: block;text-align: left;'> è¯´æ˜</span></th></tr></thead><tbody><tr><td align="left">\d</td><td align="left">åŒ¹é…0-9ä¸­ä»»æ„ä¸€ä¸ªæ•°å­—</td></tr><tr><td align="left">\D</td><td align="left">é™¤äº†0-9ä»¥å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td align="left">\w</td><td align="left">æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td align="left">\W</td><td align="left">é™¤äº†æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ä»¥å¤–ä»»æ„ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td align="left">\s</td><td align="left">åŒ¹é…ä¸€ä¸ªç©ºç™½ç¬¦ï¼ˆç©ºæ ¼ï¼›åˆ¶è¡¨ç¬¦ï¼ˆtabï¼‰\t ï¼›\næ¢è¡Œç¬¦ ï¼›\rå›è½¦â€¦ï¼‰</td></tr><tr><td align="left">\S</td><td align="left">é™¤äº†ç©ºç™½ç¬¦ä»¥å¤–ä»»æ„ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td align="left">\b</td><td align="left">åŒ¹é…å•è¯è¾¹ç•Œï¼ˆè¾¹ç•Œå­—æ¯å’Œéå­—æ¯è¿æ¥çš„åœ°æ–¹ï¼‰</td></tr><tr><td align="left">\n</td><td align="left">åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦</td></tr><tr><td align="left">.</td><td align="left">é™¤æ¢è¡Œç¬¦\nä»¥å¤–ä»»æ„ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td align="left">\</td><td align="left">è½¬ä¹‰ç¬¦ï¼ŒæŠŠæœ‰ç‰¹æ®Šæ„ä¹‰çš„å­—ç¬¦è½¬ä¹‰ä¸ºæ™®é€šå­—ç¬¦</td></tr><tr><td align="left">^</td><td align="left">(è¯»ä½œcaretï¼‰è¡¨ç¤ºä»¥æŸä¸ªå…ƒå­—ç¬¦å¼€å¤´</td></tr><tr><td align="left">$</td><td align="left">è¡¨ç¤ºä»¥æŸä¸ªå…ƒå­—ç¬¦ç»“å°¾</td></tr><tr><td align="left">x|y</td><td align="left">è¡¨ç¤ºx/yä¸­ä»»æ„ä¸€ä¸ª</td></tr><tr><td align="left">[]</td><td align="left">è¡¨ç¤ºåŒ¹é…[ ]ä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td align="left">[xyz]</td><td align="left">è¡¨ç¤ºx/y/zä¸­ä»»æ„ä¸€ä¸ª</td></tr><tr><td align="left">[a-z]</td><td align="left">è¡¨ç¤ºåŒ¹é…a-zä¸­çš„ä»»æ„ä¸€ä¸ªå°å†™å­—æ¯</td></tr><tr><td align="left">[A-Z]</td><td align="left">è¡¨ç¤ºåŒ¹é…A-Zä¸­çš„ä»»æ„ä¸€ä¸ªå¤§å†™å­—æ¯</td></tr><tr><td align="left">[0-9]</td><td align="left">è¡¨ç¤ºåŒ¹é…0-9ä¸­çš„ä»»æ„ä¸€ä¸ªæ•°å­—ï¼Œç­‰ä»·äº\d</td></tr><tr><td align="left">[^abc]</td><td align="left">è¡¨ç¤ºé™¤äº†aã€bã€cä»¥å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td align="left">()</td><td align="left">æ­£åˆ™åˆ†ç»„</td></tr><tr><td align="left">(?: )</td><td align="left">è¡¨ç¤ºå½“å‰åˆ†ç»„åªåŒ¹é…ä¸æ•è·ï¼ˆå–æ¶ˆåˆ†ç»„æ•è·ï¼‰</td></tr><tr><td align="left">(?=)</td><td align="left">æ­£å‘é¢„æŸ¥</td></tr><tr><td align="left">(?!)</td><td align="left">è´Ÿå‘é¢„æŸ¥</td></tr></tbody></table><h4 id="æ­£å‘é¢„æŸ¥ã€è´Ÿå‘é¢„æŸ¥"><a href="#æ­£å‘é¢„æŸ¥ã€è´Ÿå‘é¢„æŸ¥" class="headerlink" title="æ­£å‘é¢„æŸ¥ã€è´Ÿå‘é¢„æŸ¥"></a>æ­£å‘é¢„æŸ¥ã€è´Ÿå‘é¢„æŸ¥</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> reg1 = <span class="regexp">/x(?=y)/</span> <span class="comment">// è¡¨ç¤ºåŒ¹é…xï¼Œå¹¶ä¸”ä»…å½“xåç´§è·Ÿç€ä¸€ä¸ªyï¼ˆåŒ¹é…ç´§è·Ÿç€yçš„xï¼‰</span></span><br><span class="line"><span class="keyword">let</span> reg2 = <span class="regexp">/x(?!y)/</span> <span class="comment">// è¡¨ç¤ºåŒ¹é…xï¼Œå¹¶ä¸”ä»…å½“xåæ²¡æœ‰yï¼ˆåŒ¹é…åé¢æ²¡æœ‰yçš„xï¼‰</span></span><br></pre></td></tr></table></figure><h3 id="æ„é€ å‡½æ•°æ–¹å¼"><a href="#æ„é€ å‡½æ•°æ–¹å¼" class="headerlink" title="æ„é€ å‡½æ•°æ–¹å¼"></a>æ„é€ å‡½æ•°æ–¹å¼</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\d'</span>, <span class="string">'gi'</span>);</span><br></pre></td></tr></table></figure><h3 id="å­—é¢é‡æ–¹å¼"><a href="#å­—é¢é‡æ–¹å¼" class="headerlink" title="å­—é¢é‡æ–¹å¼"></a>å­—é¢é‡æ–¹å¼</h3><p>ä¸¤ä¸ªæ–œçº¿å†…ä¸ºæ­£åˆ™çš„å†…å®¹ï¼Œåé¢å¯ä»¥è·Ÿä¿®é¥°ç¬¦ï¼Œä¸ç¬¬ä¸€ç§æ„é€ å‡½æ•°æ–¹å¼ç›¸æ¯”æ›´ç®€æ´ï¼Œç¼ºç‚¹æ˜¯æ­£åˆ™å†…å®¹<code>ä¸èƒ½æ‹¼æ¥</code>.</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">'aBcd efg'</span>.match(<span class="regexp">/[a-z]+/</span>);<span class="comment">// ["a"]</span></span><br><span class="line"><span class="string">'aBcd efg'</span>.match(<span class="regexp">/[a-z]+/i</span>);<span class="comment">// ["aBcd"]</span></span><br><span class="line"><span class="string">'aBcd efg'</span>.match(<span class="regexp">/[a-z]+/g</span>);<span class="comment">// ["a", "cd", "efg"]</span></span><br><span class="line"><span class="string">'aBcd efg'</span>.match(<span class="regexp">/[a-z]+/gi</span>);<span class="comment">// ["aBcd", "efg"]</span></span><br><span class="line"><span class="string">'aB\ncd\n efg'</span>.match(<span class="regexp">/^[a-z]+/m</span>);<span class="comment">// ["a"]</span></span><br><span class="line"><span class="string">'aB\ncd\n efg'</span>.match(<span class="regexp">/^[a-z]+/g</span>);<span class="comment">// ["a"]</span></span><br><span class="line"><span class="string">'aB\ncd\n efg'</span>.match(<span class="regexp">/^[a-z]+/gm</span>);<span class="comment">// ["a", "cd"]</span></span><br><span class="line"><span class="comment">// æ³¨æ„ä¸æ˜¯ ["a", "cd", "efg"]</span></span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p><code>æ‰‹æœºå·*è¿‡æ»¤</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">'123567905849'</span>.replace(<span class="regexp">/^(\d&#123;3&#125;)(\d*?)(\d&#123;4&#125;)$/</span>, <span class="string">'$1****$3'</span>)  <span class="comment">// æ‰©å±•æ€§å¥½</span></span><br><span class="line"><span class="string">'123567905849'</span>.substr(<span class="number">0</span>, <span class="number">3</span>) + <span class="string">'****'</span> + <span class="string">'123567905849'</span>.substr(<span class="number">7</span>, <span class="number">11</span>)  <span class="comment">// å¿«</span></span><br></pre></td></tr></table></figure><p><code>ç”¨æ­£åˆ™å†™ä¸€ä¸ªéªŒè¯23-68ä¸­çš„æ•°å­—</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> reg6 = <span class="regexp">/[23-68]/</span> <span class="comment">// ä¸æ˜¯è¡¨ç¤º23-68ï¼›è€Œæ˜¯è¡¨ç¤º2æˆ–3-6æˆ–8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å°†èŒƒå›´æ‹†åˆ†ä¸º23-29ï¼›30-59ï¼›60-68 */</span></span><br><span class="line"><span class="keyword">let</span> reg7 = <span class="regexp">/^(2[3-9]|[3-5]\d|6[0-8])$/</span></span><br></pre></td></tr></table></figure><p><code>å†™ä¸€ä¸ªæ­£åˆ™ï¼ŒåŒ¹é…ç¬¬äºŒä¸ªå­—æ¯å’Œç¬¬å››ä¸ªå­—æ¯ç›¸åŒ</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//\æ•°å­— è¡¨ç¤º(å¼•ç”¨)æ•°å­—ä»£è¡¨çš„åˆ†ç»„çš„å†…å®¹</span></span><br><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/^[a-z]([a-z])[a-z]\1$/</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">'data'</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">'java'</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(<span class="string">'fear'</span>)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p><code>æ•°æ®ç±»å‹æ£€æµ‹</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.isTypeOf = <span class="function"><span class="keyword">function</span> (<span class="params">val</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 1. ç»™ä¼ è¿›æ¥çš„valè¿›è¡Œæ•°æ®ç±»å‹æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">let</span> result = <span class="built_in">Object</span>.prototype.toString.call(val)</span><br><span class="line">    <span class="comment">// 2. ç”¨ä¸€ä¸ªæ­£åˆ™æŠŠéœ€è¦çš„ä»£è¡¨ç±»å‹çš„å­—ç¬¦ä¸²è·å–åˆ°</span></span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/^\[object ([a-zA-Z]+)\]$/</span></span><br><span class="line">    <span class="keyword">let</span> [,catches] = reg.exec(result) <span class="comment">// ä»æ•è·ç»“æœä¸­æŠŠç±»å‹å­—ç¬¦ä¸²è§£æ„å‡ºæ¥</span></span><br><span class="line">    <span class="comment">// 3. æŠŠä¸Šä¸€æ­¥å¾—åˆ°çš„ä»£è¡¨ç±»å‹çš„å­—ç¬¦ä¸²è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> catches</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.isTypeOf(<span class="number">1</span>)) <span class="comment">// Number</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.isTypeOf(<span class="literal">true</span>)) <span class="comment">// Boolean</span></span><br></pre></td></tr></table></figure><p><code>urlæŸ¥è¯¢å‚æ•°åºåˆ—åŒ–</code></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. æ–¹ä¾¿ç†è§£ä½†æ–¹æ³•ç¹æ‚</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="string">'https://www.baidu.com/s?name=mars&amp;age=18&amp;address=hebei'</span></span><br><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/([^?=&amp;]+)=([^?=&amp;]+)/ig</span></span><br><span class="line"><span class="keyword">let</span> urlAry = url.match(reg)</span><br><span class="line"><span class="keyword">let</span> params = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; urlAry.length ; i++)&#123;</span><br><span class="line">    <span class="keyword">let</span> item = urlAry[i]</span><br><span class="line">    <span class="keyword">let</span> itemAry = item.split(<span class="string">'='</span>) <span class="comment">// æŒ‰ç…§=æŠŠå­—ç¬¦ä¸²æ‹†åˆ†æˆä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€é¡¹å°±æ˜¯keyï¼Œç¬¬äºŒé¡¹å°±æ˜¯value</span></span><br><span class="line">    params[itemAry[<span class="number">0</span>]] = itemAry[<span class="number">1</span>] <span class="comment">// ä½paramsæ·»åŠ å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(params)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸å®¹æ˜“ç†è§£ä½†æ–¹æ³•ç®€æ´</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="string">'https://www.baidu.com/s?name=mars&amp;age=18&amp;address=hebei'</span></span><br><span class="line"><span class="keyword">let</span> params = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/([^?=&amp;]+)=([^?=&amp;]+)/ig</span>;</span><br><span class="line">url.replace(reg, (str, key, value) =&gt; params[key] = value);</span><br><span class="line"><span class="built_in">console</span>.log(params);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ–¹ä¾¿ç†è§£2çš„</span></span><br><span class="line"><span class="keyword">const</span> queryURLParameter=<span class="function">(<span class="params">url</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> regParam = <span class="regexp">/([^?&amp;=#]+)=?([^?&amp;=#]+)?/ig</span>,</span><br><span class="line">    obj = &#123;&#125;;</span><br><span class="line">    url.replace(regParam, (...arg) =&gt; &#123;</span><br><span class="line">        obj[arg[<span class="number">1</span>]] = arg[<span class="number">2</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://github.com/any86/any-rule" target="_blank" rel="noopener">æ­£åˆ™å¤§å…¨</a></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
          <category> RegExpæ­£åˆ™ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WebSocket &amp; socket.io</title>
      <link href="/2018/01/16/workspace/Js/socket/"/>
      <url>/2018/01/16/workspace/Js/socket/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>WebSocket &amp; socket.io</strong></p><p>[[toc]]</p><p><strong>å‰è¨€</strong></p><p>å¤§å®¶å‚ä¸çš„é¡¹ç›®é‡Œå¤šå°‘éƒ½ä¼šæœ‰web serverä¸browseréœ€è¦é•¿è¿æ¥äº’è”çš„åœºæ™¯ï¼Œ<br>æ¯”å¦‚å³æ—¶é€šè®¯ã€å³æ—¶æŠ¥ä»·ç­‰ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¾¿å‡ºç°äº† WebSocket åè®®ï¼Œå®ç°äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒå‘é€šä¿¡çš„èƒ½åŠ›ã€‚<br>ä»‹ç» WebSocket ä¹‹å‰ï¼Œè¿˜æ˜¯è®©æˆ‘ä»¬å…ˆäº†è§£ä¸‹è½®è¯¢å®ç°æ¨é€çš„æ–¹å¼ã€‚</p><h3 id="çŸ­è½®è¯¢ï¼ˆPollingï¼‰"><a href="#çŸ­è½®è¯¢ï¼ˆPollingï¼‰" class="headerlink" title="çŸ­è½®è¯¢ï¼ˆPollingï¼‰"></a>çŸ­è½®è¯¢ï¼ˆPollingï¼‰</h3><p>çŸ­è½®è¯¢çš„å®ç°æ€è·¯å°±æ˜¯æµè§ˆå™¨ç«¯æ¯éš”å‡ ç§’é’Ÿå‘æœåŠ¡å™¨ç«¯å‘é€ HTTP è¯·æ±‚ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œ<br>ä¸è®ºæ˜¯å¦æœ‰æ•°æ®æ›´æ–°ï¼Œéƒ½ç›´æ¥è¿›è¡Œå“åº”ã€‚åœ¨æœåŠ¡ç«¯å“åº”å®Œæˆï¼Œå°±ä¼šå…³é—­è¿™ä¸ª TCP è¿æ¥ï¼Œ<br>ä»£ç å®ç°ä¹Ÿæœ€ç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨ XHR ï¼Œ é€šè¿‡ setInterval å®šæ—¶å‘åç«¯å‘é€è¯·æ±‚ï¼Œä»¥è·å–æœ€æ–°çš„æ•°æ®</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fetch(url).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// success code</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure><ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ã€‚</li><li>ç¼ºç‚¹ï¼šä¼šé€ æˆæ•°æ®åœ¨ä¸€å°æ®µæ—¶é—´å†…ä¸åŒæ­¥å’Œå¤§é‡æ— æ•ˆçš„è¯·æ±‚ï¼Œå®‰å…¨æ€§å·®ã€æµªè´¹èµ„æºã€‚</li></ul><h3 id="é•¿è½®è¯¢ï¼ˆLong-Pollingï¼‰"><a href="#é•¿è½®è¯¢ï¼ˆLong-Pollingï¼‰" class="headerlink" title="é•¿è½®è¯¢ï¼ˆLong-Pollingï¼‰"></a>é•¿è½®è¯¢ï¼ˆLong-Pollingï¼‰</h3><p>å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚å,æœåŠ¡å™¨ç«¯ä¸ä¼šç›´æ¥è¿›è¡Œå“åº”ï¼Œè€Œæ˜¯å…ˆå°†è¿™ä¸ªè¯·æ±‚æŒ‚èµ·ï¼Œ<br>ç„¶ååˆ¤æ–­æœåŠ¡å™¨ç«¯æ•°æ®æ˜¯å¦æœ‰æ›´æ–°ã€‚å¦‚æœæœ‰æ›´æ–°ï¼Œåˆ™è¿›è¡Œå“åº”ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰æ•°æ®ï¼Œåˆ™åˆ°è¾¾ä¸€å®šçš„æ—¶é—´é™åˆ¶(æœåŠ¡å™¨ç«¯è®¾ç½®)æ‰è¿”å›ã€‚<br>å®¢æˆ·ç«¯JavaScriptå“åº”å¤„ç†å‡½æ•°ä¼šåœ¨å¤„ç†å®ŒæœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯åï¼Œå†æ¬¡å‘å‡ºè¯·æ±‚ï¼Œé‡æ–°å»ºç«‹è¿æ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queryData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    fetch(url).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        queryData()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼˜ç‚¹ï¼šæ¯” Polling åšäº†ä¼˜åŒ–ï¼Œæœ‰è¾ƒå¥½çš„æ—¶æ•ˆæ€§ã€‚</li><li>ç¼ºç‚¹ï¼šä¿æŒè¿æ¥æŒ‚èµ·ä¼šæ¶ˆè€—èµ„æºï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿”å›æœ‰æ•ˆæ•°æ®ï¼Œç¨‹åºè¶…æ—¶ã€‚</li></ul><p>è½®è¯¢ä¸é•¿è½®è¯¢éƒ½æ˜¯åŸºäºHTTPçš„ï¼Œä¸¤è€…æœ¬èº«å­˜åœ¨ç€ç¼ºé™·:<code>è½®è¯¢éœ€è¦æ›´å¿«çš„å¤„ç†é€Ÿåº¦ï¼›é•¿è½®è¯¢åˆ™æ›´è¦æ±‚å¤„ç†å¹¶å‘çš„èƒ½åŠ›</code>;<br>ä¸¤è€…éƒ½æ˜¯â€œè¢«åŠ¨å‹æœåŠ¡å™¨â€çš„ä½“ç°:æœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨æ¨é€ä¿¡æ¯ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯å‘é€ajaxè¯·æ±‚åè¿›è¡Œè¿”å›çš„å“åº”ã€‚<br>è€Œç†æƒ³çš„æ¨¡å‹æ˜¯â€åœ¨æœåŠ¡å™¨ç«¯æ•°æ®æœ‰äº†å˜åŒ–åï¼Œå¯ä»¥ä¸»åŠ¨æ¨é€ç»™å®¢æˆ·ç«¯â€,è¿™ç§â€ä¸»åŠ¨å‹â€æœåŠ¡å™¨æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„å¾ˆå¥½çš„æ–¹æ¡ˆã€‚Web Socketså°±æ˜¯è¿™æ ·çš„æ–¹æ¡ˆã€‚</p><h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><p>WebSocketæ˜¯Html5å®šä¹‰çš„ä¸€ä¸ªæ–°åè®®ï¼Œä¸ä¼ ç»Ÿçš„httpåè®®ä¸åŒï¼Œè¯¥åè®®å¯ä»¥å®ç°æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´å…¨åŒå·¥é€šä¿¡ã€‚ç®€å•æ¥è¯´ï¼Œé¦–å…ˆéœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å»ºç«‹èµ·ä¸€ä¸ªè¿æ¥ï¼Œè¿™éƒ¨åˆ†éœ€è¦httpã€‚<br>è¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å°±å¤„äºå¹³ç­‰çš„åœ°ä½ï¼Œå¯ä»¥ç›¸äº’å‘é€æ•°æ®ï¼Œä¸å­˜åœ¨è¯·æ±‚å’Œå“åº”çš„åŒºåˆ«ã€‚</p><p>å½“å®¢æˆ·ç«¯è¦å’ŒæœåŠ¡ç«¯å»ºç«‹ WebSocket è¿æ¥æ—¶ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯é¦–å…ˆä¼šå‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œ<br>åŒ…å«ä¸€ä¸ª<strong>Upgrade è¯·æ±‚å¤´</strong> æ¥å‘ŠçŸ¥æœåŠ¡ç«¯å®¢æˆ·ç«¯æƒ³è¦å»ºç«‹ä¸€ä¸ª WebSocket è¿æ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Accept: ZUip34t+bCjhkvxxwhmdEOyx9hE=</span><br><span class="line">Upgrade: websocket</span><br></pre></td></tr></table></figure><p>WebSocketçš„ä¼˜ç‚¹æ˜¯å®ç°äº†åŒå‘é€šä¿¡ï¼Œç¼ºç‚¹æ˜¯æœåŠ¡å™¨ç«¯çš„é€»è¾‘éå¸¸å¤æ‚ã€‚ç°åœ¨é’ˆå¯¹ä¸åŒçš„åå°è¯­è¨€æœ‰ä¸åŒçš„æ’ä»¶å¯ä»¥ä½¿ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;useEffect&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:9000'</span>);</span><br><span class="line">    <span class="comment">// ç›‘å¬è¿æ¥æˆåŠŸ</span></span><br><span class="line">    ws.onopen = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'è¿æ¥æœåŠ¡ç«¯WebSocketæˆåŠŸ'</span>);</span><br><span class="line">        </span><br><span class="line">        ws.send(<span class="built_in">JSON</span>.stringify(msgData));<span class="comment">// send æ–¹æ³•ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬æœåŠ¡ç«¯æ¶ˆæ¯(æ¥æ”¶æ¶ˆæ¯)</span></span><br><span class="line">    ws.onmessage = <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> message = <span class="built_in">JSON</span>.parse(msg.data);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'æ”¶åˆ°çš„æ¶ˆæ¯ï¼š'</span>, message)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬è¿æ¥å¤±è´¥</span></span><br><span class="line">    ws.onerror = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'è¿æ¥å¤±è´¥ï¼Œæ­£åœ¨é‡è¿...'</span>);</span><br><span class="line">        connectWebsocket();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬è¿æ¥å…³é—­</span></span><br><span class="line">    ws.onclose = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'è¿æ¥å…³é—­'</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    &#125;,[])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index;</span><br></pre></td></tr></table></figure><h4 id="å¿ƒè·³æ£€æµ‹"><a href="#å¿ƒè·³æ£€æµ‹" class="headerlink" title="å¿ƒè·³æ£€æµ‹"></a>å¿ƒè·³æ£€æµ‹</h4><p>åœ¨å®é™…ä½¿ç”¨ WebSocket ä¸­ï¼Œé•¿æ—¶é—´ä¸é€šæ¶ˆæ¯å¯èƒ½ä¼šå‡ºç°ä¸€äº›è¿æ¥ä¸ç¨³å®šçš„æƒ…å†µï¼Œè¿™äº›æœªçŸ¥æƒ…å†µå¯¼è‡´çš„è¿æ¥ä¸­æ–­ä¼šå½±å“å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹å‰çš„é€šä¿¡ï¼Œ</p><p>ä¸ºäº†é˜²æ­¢è¿™ç§çš„æƒ…å†µçš„å‡ºç°ï¼Œæœ‰ä¸€ç§å¿ƒè·³ä¿æ´»çš„æ–¹æ³•ï¼šå®¢æˆ·ç«¯å°±åƒå¿ƒè·³ä¸€æ ·æ¯éš”å›ºå®šçš„æ—¶é—´å‘é€ä¸€æ¬¡ ping ï¼Œ<br>æ¥å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘è¿˜æ´»ç€ï¼Œè€ŒæœåŠ¡å™¨ä¹Ÿä¼šè¿”å› pong ï¼Œæ¥å‘Šè¯‰å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨è¿˜æ´»ç€ã€‚ping/pong,<br>å…¶å®æ˜¯ä¸€æ¡ä¸ä¸šåŠ¡æ— å…³çš„å‡æ¶ˆæ¯ï¼Œä¹Ÿç§°ä¸ºå¿ƒè·³åŒ…ã€‚</p><p>å¯ä»¥åœ¨è¿æ¥æˆåŠŸä¹‹åï¼Œæ¯éš”ä¸€ä¸ªå›ºå®šæ—¶é—´å‘é€å¿ƒè·³åŒ…ï¼Œæ¯”å¦‚ 60s:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ws.send(<span class="string">'è¿™æ˜¯ä¸€æ¡å¿ƒè·³åŒ…æ¶ˆæ¯'</span>);</span><br><span class="line">&#125;, <span class="number">60000</span>)</span><br></pre></td></tr></table></figure><img style="border: .3em solid #e0dfcc;border-radius: 1em;widthï¼š98%"  src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://ae01.alicdn.com/kf/H2ca9851f8d104b37bfe96f78b39e34966.png"><p>å…¶ä¸­<code>ç»¿è‰²</code>ç®­å¤´è¡¨ç¤º<code>å‘å‡º</code>çš„æ¶ˆæ¯ï¼Œ<code>çº¢è‰²</code>ç®­å¤´è¡¨ç¤º<code>æ”¶åˆ°</code>çš„æ¶ˆæ¯ã€‚</p><h3 id="Socket-IO"><a href="#Socket-IO" class="headerlink" title="Socket.IO"></a>Socket.IO</h3><ul><li>å¯é æ€§ï¼ŒSocker.IOåŸºäºengine.ioå®ç°ï¼Œå…ˆå»ºç«‹é•¿è½®è¯¢è¿æ¥åå†å‡çº§ä¸ºåŸºäºwebsocketå…¨åŒå·¥çš„é•¿è¿æ¥</li><li>è‡ªåŠ¨é‡è¿ä¸æ–­è¿æ£€æŸ¥</li><li>å¤šè·¯ä¼ è¾“/å¤šç§æ•°æ®æ ¼å¼ä¼ è¾“ï¼ˆè¿™ä¸ªå’Œwebsocketç‰¹æ€§ä¸€æ ·)</li><li>å¹¿æ’­æœºåˆ¶ï¼ˆè¿™ä¸ªç”¨æ³•åœ¨å¼€å‘ä¸Šè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå¼€å‘åŒå­¦ä¸éœ€è¦åšå¤ªå¤šé¢å¤–çš„å·¥ä½œï¼Œbroadcastå‡½æ•°å³å¯ï¼Œä¸ç”¨åƒè‡ªå·±å®ç°websocketæœåŠ¡ç«¯ä¸€æ ·è¦åštopicå’Œè¿æ¥ç®¡ç†åŠå¹¶å‘æ¨é€çš„å¤„ç†ï¼‰</li></ul><p>Socket.ioå…è®¸ä½ è§¦å‘æˆ–å“åº”è‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œé™¤äº†connectï¼Œmessageï¼Œdisconnectè¿™äº›äº‹ä»¶çš„åå­—ä¸èƒ½ä½¿ç”¨ä¹‹å¤–ï¼Œä½ å¯ä»¥è§¦å‘ä»»ä½•<code>è‡ªå®šä¹‰</code>çš„äº‹ä»¶åç§°ã€‚</p><h4 id="å»ºç«‹è¿æ¥"><a href="#å»ºç«‹è¿æ¥" class="headerlink" title="å»ºç«‹è¿æ¥"></a>å»ºç«‹è¿æ¥</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> query = &#123;</span><br><span class="line">    admin_id: adminid().id,</span><br><span class="line">    scenic_id: scenicid().id</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">this</span>.socket = io(scenicAnalysis, &#123;</span><br><span class="line">    transports: [<span class="string">'websocket'</span>, <span class="string">'xhr-polling'</span>, <span class="string">'jsonp-polling'</span>],</span><br><span class="line">    query</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">this</span>.socket.on(<span class="string">'connect'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;id&#125; = <span class="keyword">this</span>.socket;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'è¿æ¥æˆåŠŸ,'</span>, id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯æ”¶å‘"><a href="#æ¶ˆæ¯æ”¶å‘" class="headerlink" title="æ¶ˆæ¯æ”¶å‘"></a>æ¶ˆæ¯æ”¶å‘</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‘é€æ•°æ®</span></span><br><span class="line"> <span class="keyword">this</span>.socket.emit(<span class="string">`ä¸€èˆ¬æ˜¯åç«¯å®šä¹‰çš„å­—æ®µ`</span>, data);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="keyword">this</span>.socket.on(<span class="string">`ä¸€èˆ¬æ˜¯åç«¯å®šä¹‰çš„å­—æ®µ`</span>, (data) =&gt; &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="æ–­å¼€è¿æ¥"><a href="#æ–­å¼€è¿æ¥" class="headerlink" title="æ–­å¼€è¿æ¥"></a>æ–­å¼€è¿æ¥</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–­å¼€</span></span><br><span class="line"><span class="keyword">this</span>.socket.close();</span><br><span class="line"><span class="keyword">this</span>.socket=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ£€æµ‹æ˜¯å¦æ–­å¼€</span></span><br><span class="line"><span class="keyword">this</span>.socket.on(<span class="string">'disconnect'</span>, (msg: any) =&gt; <span class="built_in">console</span>.log(msg));</span><br><span class="line"><span class="comment">//å¤±è´¥æ•è·</span></span><br><span class="line"><span class="keyword">this</span>.socket.on(<span class="string">'error'</span>, (err: any) =&gt; <span class="built_in">console</span>.log(<span class="string">'error'</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(err)))</span><br></pre></td></tr></table></figure><h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><p>åªä»ä¸¤ä¸ªæ–¹é¢åˆ†æï¼š</p><p><strong>æ˜“ç”¨æ€§:</strong> Socket.IOçš„æ˜“ç”¨æ€§æ›´å¥½ï¼Œå¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œæ²¡æœ‰å¤ªå¤šå¿ƒæ™ºè´Ÿæ‹…ï¼Œæ¯”å¦‚éœ€è¦å…³å¿ƒé‡è¿ã€pushè½¬pollingç­‰å®¹é”™é€»è¾‘; æœåŠ¡ç«¯ä¸Šä¹Ÿæ²¡æœ‰å¤ªå¤šçš„è¿æ¥ç®¡ç†çš„è®¾è®¡ï¼ŒSocker.IOå·²ç»æ‰“åŒ…å¤„ç†äº†ã€‚</p><p><strong>çµæ´»æ€§:</strong> ä¸ªäººè§‰å¾—websocketçš„çµæ´»æ€§æ›´é«˜ä¸€äº›ï¼Œä¸ç®¡æ˜¯å‰ç«¯è¿˜æ˜¯åç«¯ï¼Œå¯ä»¥åšæ›´å¤šçš„è®¾è®¡ä¸ä¼˜åŒ–ï¼Œæ¯”å¦‚è¿æ¥ç®¡ç†ï¼Œå®¹é”™é‡è¿ï¼Œç”¨æˆ·è®¤è¯ç­‰ï¼Œè‡³å°‘åœ¨æå‡æŠ€æœ¯èƒ½åŠ›ä¸Šè¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©ã€‚</p><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="https://juejin.im/post/5cbd154be51d456e442ff348" target="_blank" rel="noopener">åŸºäº socket.io å¿«é€Ÿå®ç°ä¸€ä¸ªå®æ—¶é€šè®¯åº”ç”¨</a></p><p><a href="https://blog.csdn.net/u013243347/article/details/86661778" target="_blank" rel="noopener">engine.io åŸç†è¯¦è§£</a></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Web Worker</title>
      <link href="/2018/01/16/workspace/Js/webWorker/"/>
      <url>/2018/01/16/workspace/Js/webWorker/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Web Worker</strong></p><p>[[toc]]</p><p>JavaScript è¯­è¨€é‡‡ç”¨çš„æ˜¯<code>å•çº¿ç¨‹æ¨¡å‹</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ä»»åŠ¡åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šå®Œæˆï¼Œä¸€æ¬¡åªèƒ½åšä¸€ä»¶äº‹ã€‚å‰é¢çš„ä»»åŠ¡æ²¡åšå®Œï¼Œåé¢çš„ä»»åŠ¡åªèƒ½ç­‰ç€ã€‚éšç€ç”µè„‘è®¡ç®—èƒ½åŠ›çš„å¢å¼ºï¼Œå°¤å…¶æ˜¯å¤šæ ¸ CPU çš„å‡ºç°ï¼Œå•çº¿ç¨‹å¸¦æ¥å¾ˆå¤§çš„ä¸ä¾¿ï¼Œæ— æ³•å……åˆ†å‘æŒ¥è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›ã€‚</p><p>Web Worker çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸º JavaScript <code>åˆ›é€ å¤šçº¿ç¨‹ç¯å¢ƒ</code>ï¼Œå…è®¸ä¸»çº¿ç¨‹åˆ›å»º Worker çº¿ç¨‹ï¼Œå°†ä¸€äº›ä»»åŠ¡åˆ†é…ç»™åè€…è¿è¡Œã€‚<br>åœ¨ä¸»çº¿ç¨‹è¿è¡Œçš„åŒæ—¶ï¼ŒWorker çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œä¸¤è€…äº’ä¸å¹²æ‰°ã€‚ç­‰åˆ° Worker çº¿ç¨‹å®Œæˆè®¡ç®—ä»»åŠ¡ï¼Œå†æŠŠç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹ã€‚<br>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œä¸€äº›è®¡ç®—å¯†é›†å‹æˆ–é«˜å»¶è¿Ÿçš„ä»»åŠ¡ï¼Œè¢« Worker çº¿ç¨‹è´Ÿæ‹…äº†ï¼Œä¸»çº¿ç¨‹ï¼ˆé€šå¸¸è´Ÿè´£ UI äº¤äº’ï¼‰å°±ä¼šå¾ˆæµç•…ï¼Œä¸ä¼šè¢«é˜»å¡æˆ–æ‹–æ…¢ã€‚</p><p>Worker çº¿ç¨‹ä¸€æ—¦æ–°å»ºæˆåŠŸï¼Œå°±ä¼šå§‹ç»ˆè¿è¡Œï¼Œä¸ä¼šè¢«ä¸»çº¿ç¨‹ä¸Šçš„æ´»åŠ¨ï¼ˆæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ã€æäº¤è¡¨å•ï¼‰æ‰“æ–­ã€‚<br>è¿™æ ·æœ‰åˆ©äºéšæ—¶å“åº”ä¸»çº¿ç¨‹çš„é€šä¿¡ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿé€ æˆäº† Worker æ¯”è¾ƒè€—è´¹èµ„æºï¼Œä¸åº”è¯¥è¿‡åº¦ä½¿ç”¨ï¼Œè€Œä¸”ä¸€æ—¦ä½¿ç”¨å®Œæ¯•ï¼Œå°±åº”è¯¥å…³é—­ã€‚</p><h4 id="Web-Worker-æœ‰ä»¥ä¸‹å‡ ä¸ªä½¿ç”¨æ³¨æ„ç‚¹"><a href="#Web-Worker-æœ‰ä»¥ä¸‹å‡ ä¸ªä½¿ç”¨æ³¨æ„ç‚¹" class="headerlink" title="Web Worker æœ‰ä»¥ä¸‹å‡ ä¸ªä½¿ç”¨æ³¨æ„ç‚¹"></a>Web Worker æœ‰ä»¥ä¸‹å‡ ä¸ªä½¿ç”¨æ³¨æ„ç‚¹</h4><p>(1)<strong>åŒæºé™åˆ¶</strong><br/><br>åˆ†é…ç»™ Worker çº¿ç¨‹è¿è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼Œå¿…é¡»ä¸ä¸»çº¿ç¨‹çš„è„šæœ¬æ–‡ä»¶åŒæºã€‚</p><p>(2)<strong>DOM é™åˆ¶</strong><br/><br>Worker çº¿ç¨‹æ‰€åœ¨çš„å…¨å±€å¯¹è±¡ï¼Œä¸ä¸»çº¿ç¨‹ä¸ä¸€æ ·ï¼Œæ— æ³•è¯»å–ä¸»çº¿ç¨‹æ‰€åœ¨ç½‘é¡µçš„ DOM å¯¹è±¡ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨<code>documentã€windowã€parent</code>è¿™äº›å¯¹è±¡ã€‚<br>ä½†æ˜¯ï¼ŒWorker çº¿ç¨‹å¯ä»¥<code>navigatorå¯¹è±¡å’Œlocation</code>å¯¹è±¡ã€‚</p><p>(3)<strong>é€šä¿¡è”ç³»</strong><br/><br>Worker çº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå®ƒä»¬ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œå¿…é¡»é€šè¿‡æ¶ˆæ¯å®Œæˆã€‚</p><p>(4)<strong>è„šæœ¬é™åˆ¶</strong><br/><br>Worker çº¿ç¨‹ä¸èƒ½æ‰§è¡Œ<code>alert()</code>æ–¹æ³•å’Œ<code>confirm()</code>æ–¹æ³•ï¼Œä½†å¯ä»¥ä½¿ç”¨ <code>XMLHttpRequest</code> å¯¹è±¡å‘å‡º AJAX è¯·æ±‚ã€‚</p><p>(5)<strong>æ–‡ä»¶é™åˆ¶</strong><br/><br>Worker çº¿ç¨‹æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå³ä¸èƒ½æ‰“å¼€æœ¬æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆ<code>file://</code>ï¼‰ï¼Œå®ƒæ‰€åŠ è½½çš„è„šæœ¬ï¼Œå¿…é¡»æ¥è‡ªç½‘ç»œã€‚</p><h4 id="Workerç”¨æ³•"><a href="#Workerç”¨æ³•" class="headerlink" title="Workerç”¨æ³•"></a>Workerç”¨æ³•</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒWorker è½½å…¥çš„æ˜¯ä¸€ä¸ª<code>å•ç‹¬çš„ JavaScript è„šæœ¬æ–‡ä»¶</code>ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è½½å…¥ä¸ä¸»çº¿ç¨‹åœ¨åŒä¸€ä¸ªç½‘é¡µçš„ä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"worker"</span> <span class="attr">type</span>=<span class="string">"app/worker"</span>&gt;</span></span><br><span class="line"><span class="actionscript">      addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        postMessage(<span class="string">'some message'</span>);</span></span><br><span class="line"><span class="actionscript">      &#125;, <span class="literal">false</span>);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ä¸€æ®µåµŒå…¥ç½‘é¡µçš„è„šæœ¬ï¼Œæ³¨æ„å¿…é¡»æŒ‡å®šscriptæ ‡ç­¾çš„typeå±æ€§æ˜¯ä¸€ä¸ªæµè§ˆå™¨ä¸è®¤è¯†çš„å€¼ï¼Œä¸Šä¾‹æ˜¯<code>app/worker</code>ã€‚</p><p>ç„¶åï¼Œè¯»å–è¿™ä¸€æ®µåµŒå…¥é¡µé¢çš„è„šæœ¬ï¼Œç”¨ Worker æ¥å¤„ç†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="built_in">document</span>.querySelector(<span class="string">'#worker'</span>).textContent]);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">window</span>.URL.createObjectURL(blob);</span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(url);</span><br><span class="line"></span><br><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// e.data === 'some message'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå…ˆå°†åµŒå…¥ç½‘é¡µçš„è„šæœ¬ä»£ç ï¼Œè½¬æˆä¸€ä¸ªäºŒè¿›åˆ¶å¯¹è±¡ï¼Œç„¶åä¸ºè¿™ä¸ªäºŒè¿›åˆ¶å¯¹è±¡ç”Ÿæˆ URLï¼Œå†è®© Worker åŠ è½½è¿™ä¸ª URLã€‚è¿™æ ·å°±åšåˆ°äº†ï¼Œä¸»çº¿ç¨‹å’Œ Worker çš„ä»£ç éƒ½åœ¨åŒä¸€ä¸ªç½‘é¡µä¸Šé¢ã€‚</p><p><code>å¯ä»¥é…åˆwebpack ä½¿ç”¨worker-loader æ–¹ä¾¿å…¶æ“ä½œ</code></p><h4 id="ä¸»çº¿ç¨‹åˆå§‹åŒ–WebWorker"><a href="#ä¸»çº¿ç¨‹åˆå§‹åŒ–WebWorker" class="headerlink" title="ä¸»çº¿ç¨‹åˆå§‹åŒ–WebWorker"></a>ä¸»çº¿ç¨‹åˆå§‹åŒ–WebWorker</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•ä¸€ åŒé¡µé¢çš„ Web Worker</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebWorker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(worker) &#123;</span><br><span class="line">        <span class="keyword">const</span> code = worker.toString();</span><br><span class="line">        <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([<span class="string">'('</span> + code + <span class="string">')()'</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Worker(URL.createObjectURL(blob));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>.worker = <span class="keyword">new</span> WebWorker(worker,&#123;<span class="attr">name</span>:<span class="string">'è¿™æ˜¯workerçš„åç§°  self.nameèƒ½è·å–å‡ºæ¥'</span>&#125;);  </span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•äºŒ worker.jsæ”¾åˆ°publicç›®å½•</span></span><br><span class="line"><span class="keyword">this</span>.worker = <span class="keyword">new</span> Worker(<span class="string">'worker.js'</span>);</span><br></pre></td></tr></table></figure><h4 id="ä¸»çº¿ç¨‹å‘Workerå‘æ¶ˆæ¯"><a href="#ä¸»çº¿ç¨‹å‘Workerå‘æ¶ˆæ¯" class="headerlink" title="ä¸»çº¿ç¨‹å‘Workerå‘æ¶ˆæ¯"></a>ä¸»çº¿ç¨‹å‘Workerå‘æ¶ˆæ¯</h4><p>ç„¶åï¼Œ<code>ä¸»çº¿ç¨‹è°ƒç”¨worker.postMessage()</code>æ–¹æ³•ï¼Œå‘ Worker å‘æ¶ˆæ¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> params = &#123;</span><br><span class="line">    users,</span><br><span class="line">    types:<span class="string">'users'</span>  <span class="comment">//è¿™é‡ŒåŠ ä¸ªç±»å‹ï¼Œæ–¹ä¾¿å­çº¿ç¨‹åˆ¤æ–­  ã€e.data.typesã€‘</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.worker.postMessage(params);</span><br></pre></td></tr></table></figure><p>worker.postMessage()æ–¹æ³•çš„å‚æ•°ï¼Œå°±æ˜¯ä¸»çº¿ç¨‹ä¼ ç»™ Worker çš„æ•°æ®ã€‚å®ƒå¯ä»¥æ˜¯<code>å„ç§æ•°æ®ç±»å‹</code>ï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶æ•°æ®ã€‚</p><h4 id="å­çº¿ç¨‹å‘å›å¤„ç†åçš„æ•°æ®"><a href="#å­çº¿ç¨‹å‘å›å¤„ç†åçš„æ•°æ®" class="headerlink" title="å­çº¿ç¨‹å‘å›å¤„ç†åçš„æ•°æ®"></a>å­çº¿ç¨‹å‘å›å¤„ç†åçš„æ•°æ®</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//worker.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">    self.addEventListener(<span class="string">'message'</span>, e =&gt; &#123; <span class="comment">// eslint-disable-line no-restricted-globals</span></span><br><span class="line">        <span class="keyword">if</span> (!e) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">let</span> &#123;users,types&#125; = e.data;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; users.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; users.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (users[i].id &gt; users[j].id) &#123;</span><br><span class="line">                    <span class="keyword">const</span> t = users[i];</span><br><span class="line">                    users[i] = users[j];</span><br><span class="line">                    users[j] = t;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        postMessage(users);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//selfä»£è¡¨å­çº¿ç¨‹è‡ªèº«ï¼Œå³å­çº¿ç¨‹çš„å…¨å±€å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œå¯ä»¥æ·»åŠ åˆ¤æ–­ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> &#123;types,user&#125; = e.data;</span><br><span class="line"><span class="keyword">switch</span> (types) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'users'</span>:</span><br><span class="line">        self.postMessage(user);</span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å­çº¿ç¨‹å†…éƒ¨å…³é—­è‡ªèº«ã€‚</span></span><br><span class="line">self.close()</span><br></pre></td></tr></table></figure><h4 id="ä¸»çº¿ç¨‹æ¥æ”¶æ•°æ®"><a href="#ä¸»çº¿ç¨‹æ¥æ”¶æ•°æ®" class="headerlink" title="ä¸»çº¿ç¨‹æ¥æ”¶æ•°æ®"></a>ä¸»çº¿ç¨‹æ¥æ”¶æ•°æ®</h4><p>æ¥ç€ï¼Œ<code>ä¸»çº¿ç¨‹é€šè¿‡worker.onmessage</code>æŒ‡å®šç›‘å¬å‡½æ•°ï¼Œæ¥æ”¶å­çº¿ç¨‹å‘å›æ¥çš„æ¶ˆæ¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">this</span>.worker.addEventListener(<span class="string">'message'</span>, (event) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> sortedList = event.data;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        users: sortedList,</span><br><span class="line">        isSorting: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="å…³é—­Worker"><a href="#å…³é—­Worker" class="headerlink" title="å…³é—­Worker"></a>å…³é—­Worker</h4><p>Worker å®Œæˆä»»åŠ¡ä»¥åï¼Œ<code>ä¸»çº¿ç¨‹</code>å°±å¯ä»¥æŠŠå®ƒå…³æ‰ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.worker.terminate();</span><br></pre></td></tr></table></figure><h4 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h4><p>ä¸»çº¿ç¨‹å¯ä»¥ç›‘å¬ Worker æ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ŒWorker ä¼šè§¦å‘ä¸»çº¿ç¨‹çš„erroräº‹ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.worker.addEventListener(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å­çº¿ç¨‹å†…éƒ¨ä¹Ÿå¯ä»¥ç›‘å¬erroräº‹ä»¶ã€‚</p><h4 id="Workerçº¿ç¨‹å®Œæˆè½®è¯¢"><a href="#Workerçº¿ç¨‹å®Œæˆè½®è¯¢" class="headerlink" title="Workerçº¿ç¨‹å®Œæˆè½®è¯¢"></a>Workerçº¿ç¨‹å®Œæˆè½®è¯¢</h4><p>æœ‰æ—¶ï¼Œæµè§ˆå™¨éœ€è¦è½®è¯¢æœåŠ¡å™¨çŠ¶æ€ï¼Œä»¥ä¾¿ç¬¬ä¸€æ—¶é—´å¾—çŸ¥çŠ¶æ€æ”¹å˜ã€‚è¿™ä¸ªå·¥ä½œå¯ä»¥æ”¾åœ¨ Worker é‡Œé¢ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebWorker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(worker) &#123;</span><br><span class="line">        <span class="keyword">const</span> code = worker.toString();</span><br><span class="line">        <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([<span class="string">'('</span> + code + <span class="string">')()'</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Worker(URL.createObjectURL(blob));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pollingWorker = WebWorker( <span class="function">(<span class="params">e</span>)=&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> cache;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compare</span>(<span class="params">new, old</span>) </span>&#123; ... &#125;;</span><br><span class="line"></span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    fetch(<span class="string">'/my-api-endpoint'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> data = res.json();</span><br><span class="line">      <span class="comment">//å¦‚æœä¸ä¸€è‡´</span></span><br><span class="line">      <span class="keyword">if</span> (!compare(data, cache)) &#123;</span><br><span class="line">        cache = data;</span><br><span class="line">        self.postMessage(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸»è¿›ç¨‹</span></span><br><span class="line">worker.addEventListener(<span class="string">'message'</span>, (event) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> sortedList = event.data;</span><br><span class="line">    .....</span><br><span class="line">&#125;);</span><br><span class="line">pollingWorker.postMessage(<span class="string">'success'</span>);</span><br></pre></td></tr></table></figure><p>Worker æ¯ç§’é’Ÿè½®è¯¢ä¸€æ¬¡æ•°æ®ï¼Œç„¶åè·Ÿç¼“å­˜åšæ¯”è¾ƒã€‚å¦‚æœä¸ä¸€è‡´ï¼Œå°±è¯´æ˜æœåŠ¡ç«¯æœ‰äº†æ–°çš„å˜åŒ–ï¼Œå› æ­¤å°±è¦é€šçŸ¥ä¸»çº¿ç¨‹ã€‚</p><h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><p><strong>ä¸»çº¿ç¨‹</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myWorker = <span class="keyword">new</span> Worker(jsUrl, options);</span><br></pre></td></tr></table></figure><p>Worker()æ„é€ å‡½æ•°ï¼Œå¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è„šæœ¬çš„ç½‘å€ï¼ˆå¿…é¡»éµå®ˆåŒæºæ”¿ç­–ï¼‰ï¼Œè¯¥å‚æ•°æ˜¯å¿…éœ€çš„ï¼Œä¸”<code>åªèƒ½åŠ è½½JSè„šæœ¬</code>ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯é…ç½®å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯é€‰ã€‚å®ƒçš„ä¸€ä¸ªä½œç”¨å°±æ˜¯<code>æŒ‡å®šWorkerçš„åç§°</code>ï¼Œç”¨æ¥åŒºåˆ†å¤šä¸ªWorkerçº¿ç¨‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸»çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">let</span> myWorker = <span class="keyword">new</span> Worker(<span class="string">'worker.js'</span>, &#123; <span class="attr">name</span> : <span class="string">'myWorker'</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Worker çº¿ç¨‹</span></span><br><span class="line">self.name <span class="comment">// myWorker</span></span><br></pre></td></tr></table></figure><p>Worker()æ„é€ å‡½æ•°è¿”å›ä¸€ä¸ª Worker çº¿ç¨‹å¯¹è±¡ï¼Œç”¨æ¥ä¾›ä¸»çº¿ç¨‹æ“ä½œ Workerã€‚</p><p><strong>ä¸»çº¿ç¨‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Worker.onerrorï¼šæŒ‡å®š error äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</span><br><span class="line">Worker.onmessageï¼šæŒ‡å®š message äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œå‘é€è¿‡æ¥çš„æ•°æ®åœ¨Event.dataå±æ€§ä¸­ã€‚</span><br><span class="line">Worker.onmessageerrorï¼šæŒ‡å®š messageerror äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚å‘é€çš„æ•°æ®æ— æ³•åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ—¶ï¼Œä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚</span><br><span class="line">Worker.postMessage()ï¼šå‘ Worker çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚</span><br><span class="line">Worker.terminate()ï¼šç«‹å³ç»ˆæ­¢ Worker çº¿ç¨‹ã€‚</span><br></pre></td></tr></table></figure><p><strong>Worker çº¿ç¨‹</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">self.nameï¼š Worker çš„åå­—ã€‚è¯¥å±æ€§åªè¯»ï¼Œç”±æ„é€ å‡½æ•°æŒ‡å®šã€‚</span><br><span class="line">self.onmessageï¼šæŒ‡å®šmessageäº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</span><br><span class="line">self.onmessageerrorï¼šæŒ‡å®šmessageerroräº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚å‘é€çš„æ•°æ®æ— æ³•åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ—¶ï¼Œä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚</span><br><span class="line">self.close()ï¼šå…³é—­Workerçº¿ç¨‹ã€‚</span><br><span class="line">self.postMessage()ï¼šå‘ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚</span><br><span class="line">self.importScripts()ï¼šåŠ è½½JSè„šæœ¬ã€‚</span><br></pre></td></tr></table></figure><h4 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h4><p>webWorkerè§£å†³çš„æ˜¯jsä¸­æ•°æ®å¤„ç†å¯¼è‡´çš„UIçº¿ç¨‹é˜»å¡</p><ul><li>è®¡ç®—é‡æ•°æ®å¤§çš„ï¼Œä¸èƒ½æ§åˆ¶åœ¨æ¯«ç§’çº§å†…çš„è¿ç®—éƒ½å¯ä»¥è€ƒè™‘æ”¾åœ¨web workerä¸­æ‰§è¡Œã€‚</li><li>é«˜é¢‘çš„ç”¨æˆ·äº¤äº’æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ä¹ æƒ¯ã€å†å²è®°å½•ä»¥åŠç¼“å­˜ç­‰ä¿¡æ¯æ¥ååŠ©ç”¨æˆ·å®Œæˆè¾“å…¥çš„çº é”™ã€æ ¡æ­£åŠŸèƒ½ç­‰ç±»ä¼¼åœºæ™¯ï¼Œç”¨æˆ·é¢‘ç¹è¾“å…¥çš„å“åº”å¤„ç†åŒæ ·å¯ä»¥è€ƒè™‘æ”¾åœ¨web workerä¸­æ‰§è¡Œ</li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fetchå’ŒAxiosçš„åŒºåˆ«</title>
      <link href="/2018/01/16/workspace/Js/xhr/"/>
      <url>/2018/01/16/workspace/Js/xhr/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>Fetchå’ŒAxiosçš„åŒºåˆ«</strong></p><p>[[toc]]</p><h3 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> keyText = xhr.responseText;</span><br><span class="line">        <span class="built_in">console</span>.log(keyText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xhr.onprogress = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event.position); <span class="comment">//è¿›åº¦æ¡</span></span><br><span class="line">    <span class="built_in">console</span>.log(event.totalSize);<span class="comment">//æ•°æ®çš„å­—èŠ‚</span></span><br><span class="line">&#125;;</span><br><span class="line">xhr.open(<span class="string">"POST"</span>, url, <span class="literal">true</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">"Authorization"</span>, <span class="string">`UpToken <span class="subst">$&#123;uptoken&#125;</span>`</span>);</span><br><span class="line">xhr.send(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">xhr.abort()<span class="comment">//ç»ˆæ­¢è¯·æ±‚</span></span><br></pre></td></tr></table></figure><h3 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h3><p><strong>ã€ -version:0.19.0ã€‘</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å…¨å±€çš„ä¸€äº›é…ç½®</span></span><br><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/json;charset=UTF-8'</span>;</span><br><span class="line">axios.defaults.headers.put[<span class="string">'Content-Type'</span>] = <span class="string">'application/json'</span>;</span><br><span class="line">axios.defaults.headers.delete[<span class="string">'Content-Type'</span>] = <span class="string">'application/json'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//axios.defaults.baseURL = 'https://xxxxx.xx.cn;</span></span><br><span class="line"><span class="comment">//axios.defaults.headers.Authorization = `$&#123;getCookie('token')&#125;`;   //è¿™é‡Œæ·»åŠ è¿™ä¸ªå¯èƒ½å¯¼è‡´å‡ºç°optionså¯¼è‡´è·¨åŸŸ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å‡½æ•°ç”¨æ³•</span></span><br><span class="line">axios(&#123;</span><br><span class="line">    url: baseUrl,</span><br><span class="line">    method: <span class="string">'get'</span>,</span><br><span class="line">    params: params, <span class="comment">//å¦‚æœä¸æ˜¯getè¯·æ±‚ç”¨ data</span></span><br><span class="line">    onDownloadProgress: <span class="function">(<span class="params">progress</span>) =&gt;</span> &#123;<span class="comment">//è¿›åº¦æ¡</span></span><br><span class="line">         <span class="built_in">console</span>.log(<span class="built_in">Math</span>.round(progress.loaded / progress.total * <span class="number">100</span>) + <span class="string">'%'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">`application/octet-stream`</span>,</span><br><span class="line">        <span class="string">'Authorization'</span>: <span class="string">`UpToken `</span>  <span class="comment">//è¿™é‡Œå¯ä»¥ä¿®æ”¹é»˜è®¤çš„token</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ™®é€šç”¨æ³•</span></span><br><span class="line"><span class="keyword">const</span> baseUrl = <span class="string">`<span class="subst">$&#123;DEVURL&#125;</span>/shop/<span class="subst">$&#123;id&#125;</span>/productOrders`</span>;</span><br><span class="line"><span class="keyword">const</span> CancelToken = axios.CancelToken;</span><br><span class="line">axios.post(baseUrl, &#123;</span><br><span class="line">    data,</span><br><span class="line">    timeout: <span class="number">3000</span>,</span><br><span class="line">    onUploadProgress:<span class="function">(<span class="params">progress</span>)=&gt;</span>&#123;<span class="comment">//è¿›åº¦æ¡</span></span><br><span class="line">        <span class="comment">// total å­—èŠ‚å¤§å°</span></span><br><span class="line">        <span class="comment">// loaded åŠ è½½çš„å­—èŠ‚</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">Math</span>.round(progress.loaded / progress.total * <span class="number">100</span>) + <span class="string">'%'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    cancelToken: <span class="keyword">new</span> CancelToken(<span class="function"><span class="params">cancel</span>=&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//cancelå°±æ˜¯CancelTokenæ„é€ å‡½æ•°é‡Œé¢è‡ªå¸¦çš„å–æ¶ˆè¯·æ±‚çš„å‡½æ•°ï¼Œå‚æ•°ä¼šåœ¨rejecté‡Œé¢æ‹¿åˆ°</span></span><br><span class="line">            <span class="built_in">console</span>.log(cancel(<span class="string">'å–æ¶ˆè¯·æ±‚'</span>));</span><br><span class="line">        &#125;, <span class="number">100</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿®æ”¹token</span></span><br><span class="line"><span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">    baseURL: <span class="string">`<span class="subst">$&#123;url&#125;</span>`</span></span><br><span class="line">&#125;);</span><br><span class="line">instance.defaults.headers.common[<span class="string">'Authorization'</span>] = <span class="string">`Bearer <span class="subst">$&#123;getCookie(<span class="string">'token'</span>)&#125;</span>`</span>;</span><br><span class="line">axios.post(baseUrl,&#123;<span class="attr">data</span>:&#123;&#125;&#125;)</span><br></pre></td></tr></table></figure><p><strong>é…ç½®axios</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ·»åŠ å“åº”å™¨</span></span><br><span class="line">axios.interceptors.response.use(<span class="literal">undefined</span>, (err)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;config, code, response, message&#125; = err;</span><br><span class="line">    <span class="comment">// è¶…æ—¶å†æ¬¡è¯·æ±‚æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> (code === <span class="string">'ECONNABORTED'</span> &amp;&amp; message.indexOf(<span class="string">'timeout'</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">        notification[<span class="string">'error'</span>](&#123;</span><br><span class="line">            message: <span class="string">'è¿æ¥è¶…æ—¶'</span>,</span><br><span class="line">            description: <span class="string">'æ­£åœ¨é‡æ–°ä¸ºæ‚¨è¯·æ±‚æ•°æ®ï¼'</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> axios.request(config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (message === <span class="string">'å–æ¶ˆè¯·æ±‚'</span>) &#123;</span><br><span class="line">        notification[<span class="string">'error'</span>](&#123;</span><br><span class="line">            message: <span class="string">'å·²å–æ¶ˆ'</span>,</span><br><span class="line">            description: <span class="string">'å·²æ‚¨ç»å–æ¶ˆæ­¤æ¬¡æäº¤ï¼'</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123;status, <span class="attr">data</span>: &#123;<span class="attr">error</span>: msg&#125;&#125; = response;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">        notification[<span class="string">'error'</span>](&#123;</span><br><span class="line">            message: status,</span><br><span class="line">            description: (response &amp;&amp; msg) || HTTP_ERROR[status]</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Fetch"><a href="#Fetch" class="headerlink" title="Fetch"></a>Fetch</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fetch(<span class="string">'http://xxxxx/xx.cn'</span>, </span><br><span class="line">     &#123; </span><br><span class="line">        method: <span class="string">"POST"</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">           <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        body: <span class="string">"q=å‚æ•°q"</span>,</span><br><span class="line">        cache?: RequestCache;</span><br><span class="line">        credentials?: RequestCredentials;</span><br><span class="line">        integrity?: string;</span><br><span class="line">        keepalive?: boolean;</span><br><span class="line">        mode?: RequestMode;</span><br><span class="line">        redirect?: RequestRedirect;</span><br><span class="line">        referrer?: string;</span><br><span class="line">        referrerPolicy?: ReferrerPolicy;</span><br><span class="line">        signal?: AbortSignal | <span class="literal">null</span>;</span><br><span class="line">        <span class="built_in">window</span>?: any;</span><br><span class="line">     &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="Fetch-vs-Axios"><a href="#Fetch-vs-Axios" class="headerlink" title="Fetch vs Axios"></a>Fetch vs Axios</h3><h4 id="æµè§ˆå™¨æ”¯æŒ"><a href="#æµè§ˆå™¨æ”¯æŒ" class="headerlink" title="æµè§ˆå™¨æ”¯æŒ"></a>æµè§ˆå™¨æ”¯æŒ</h4><p><code>Fetchæš‚æ—¶ä¸æ”¯æŒæ‰€æœ‰ç‰ˆæœ¬çš„IE</code><br/><br>ä¸æˆç†Ÿçš„XHRå¯¹è±¡ç›¸æ¯”ï¼ŒFetch APIè¾ƒæ–°ï¼Œé¢„è®¡æœªæ¥å‡ å¹´ä¼šè¿›è¡Œä¸€å®šçš„ç»´æŠ¤å·¥ä½œ,å¯èƒ½åæœŸä¼šè¿”å·¥ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å°†Fetch polyfillä¸Promise polyfillç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨IEä¸­æ‰§è¡ŒFetchä»£ç </p><h4 id="Fetché»˜è®¤æ— Cookie"><a href="#Fetché»˜è®¤æ— Cookie" class="headerlink" title="Fetché»˜è®¤æ— Cookie"></a>Fetché»˜è®¤æ— Cookie</h4><p>ä¸XMLHttpRequestä¸åŒ,Fetchå¹¶ä¸ä¼šé»˜è®¤å‘é€Cookieï¼Œå› æ­¤åº”ç”¨çš„èº«ä»½éªŒè¯å¯èƒ½ä¼šå¤±è´¥,å¯ä»¥é€šè¿‡æ›´æ”¹ç¬¬äºŒä¸ªå‚æ•°ä¸­ä¼ é€’çš„åˆå§‹å€¼æ¥è§£å†³æ­¤é—®é¢˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fetch(<span class="string">'http://xxxxx/xx.cn'</span>, </span><br><span class="line">     &#123; </span><br><span class="line">        method: <span class="string">'GET'</span>, </span><br><span class="line">        credentials: <span class="string">'same-origin'</span> </span><br><span class="line">     &#125;</span><br><span class="line"> )</span><br></pre></td></tr></table></figure><h4 id="é”™è¯¯ä¸ä¼šè¢«æ‹’ç»"><a href="#é”™è¯¯ä¸ä¼šè¢«æ‹’ç»" class="headerlink" title="é”™è¯¯ä¸ä¼šè¢«æ‹’ç»"></a>é”™è¯¯ä¸ä¼šè¢«æ‹’ç»</h4><p>HTTPé”™è¯¯ï¼ˆä¾‹å¦‚404 500ï¼‰ä¸ä¼šå¯¼è‡´ Fetchè¿”å›çš„Promiseæ ‡è®°ä¸ºrejectï¼Œ.catch()ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œã€‚<br>æƒ³è¦ç²¾ç¡®çš„åˆ¤æ–­fetchæ˜¯å¦æˆåŠŸï¼Œéœ€è¦åŒ…å« promise.resolved çš„æƒ…å†µï¼Œæ­¤æ—¶å†åˆ¤æ–­ response.okæ˜¯ä¸æ˜¯ä¸º trueã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> fetch(<span class="string">'http://xxxxx/xx.cn'</span>, &#123;<span class="attr">method</span>: <span class="string">'GET'</span>&#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (response.ok) &#123; <span class="comment">//è¿™é‡Œæ·»åŠ ä¸€ä¸ªåˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Network response was not ok.'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">json</span> =&gt;</span> <span class="built_in">console</span>.log(json)).catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.error(<span class="string">'error:'</span>, error));</span><br></pre></td></tr></table></figure><p>ä»…å½“è¯·æ±‚æ— æ³•å®Œæˆæ—¶æ‰è§¦å‘rejectï¼Œä¾‹å¦‚ç½‘ç»œæ•…éšœæˆ–è¯·æ±‚è¢«é˜»æ­¢ã€‚è¿™ä¼šä½¿é”™è¯¯æ•è·æ›´åŠ å¤æ‚ã€‚</p><h4 id="ä¸æ”¯æŒè¶…æ—¶"><a href="#ä¸æ”¯æŒè¶…æ—¶" class="headerlink" title="ä¸æ”¯æŒè¶…æ—¶"></a>ä¸æ”¯æŒè¶…æ—¶</h4><p>Fetchä¸æ”¯æŒè¶…æ—¶ï¼Œåªè¦æµè§ˆå™¨å…è®¸ï¼Œè¯·æ±‚å°†ç»§ç»­ã€‚è§£å†³æ–¹æ³•æ˜¯å¯ä»¥å°†FetchåŒ…è£…åœ¨ä¸€ä¸ª Promiseä¸­ï¼Œä¾‹å¦‚:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fetchTimeout = <span class="function">(<span class="params">url, init, timeout = <span class="number">3000</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fetch(url, init).then(resolve).catch(reject);</span><br><span class="line">        setTimeout(reject, timeout);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æˆ–è€… Promise.race([])</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fetchTimeout = <span class="function">(<span class="params">url, init, timeout = <span class="number">30</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.race(</span><br><span class="line">        [</span><br><span class="line">            fetch(url, init),</span><br><span class="line">            <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> setTimeout(resolve, timeout))  <span class="comment">//æƒ³è¦æ›´å…·ä½“çš„æ•è·è¿™æ¬¡è¶…æ—¶ï¼Œéœ€è¦åŠ å…·ä½“çš„åˆ¤æ–­</span></span><br><span class="line">        ]</span><br><span class="line">    ).then(<span class="function"><span class="params">response</span> =&gt;</span> response.json()); </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ä¸­æ­¢Fetch"><a href="#ä¸­æ­¢Fetch" class="headerlink" title="ä¸­æ­¢Fetch"></a>ä¸­æ­¢Fetch</h4><p>é€šè¿‡xhr.abort()å¾ˆå®¹æ˜“ç»“æŸä¸€ä¸ªXHRè¯·æ±‚ï¼Œå¦å¤–ä¹Ÿå¯ä»¥é€šè¿‡xhr.onabortå‡½æ•°ç›‘æµ‹äº‹ä»¶è§£å†³ã€‚</p><p>ä¹‹å‰ä¸€ç›´æ— æ³•ä¸­æ­¢ä¸€ä¸ªFetchè¯·æ±‚ï¼Œä½†æ˜¯ç°åœ¨å®ç°äº†AbortController APIçš„æµè§ˆå™¨å¯ä»¥æ”¯æŒå®ƒã€‚è¿™å°†è§¦å‘ä¸€ä¸ªä¿¡å·ï¼Œè¯¥ä¿¡å·å¯ä»¥ä¼ é€’ç»™Fetchå¯åŠ¨å¯¹è±¡ï¼š</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FetchController" target="_blank" rel="noopener">AbortControlleræ¥å£ä»£è¡¨ä¸€ä¸ªæ§åˆ¶å™¨å¯¹è±¡ï¼Œå…è®¸ä½ åœ¨éœ€è¦æ—¶ä¸­æ­¢ä¸€ä¸ªæˆ–å¤šä¸ªDOMè¯·æ±‚</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> AbortController();</span><br><span class="line">fetch(<span class="string">'http://xxxx/xx.cn'</span>, &#123;</span><br><span class="line">    method: <span class="string">'GET'</span>,</span><br><span class="line">    signal: controller.signal</span><br><span class="line">&#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">  .then(<span class="function"><span class="params">json</span> =&gt;</span> <span class="built_in">console</span>.log(json))</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.error(<span class="string">'Error:'</span>, error));</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡è°ƒç”¨ <strong>controller.abort()</strong> æ¥ä¸­æ­¢,Promiseè¢«æ ‡è®°rejectåï¼Œä¼šè°ƒç”¨.catch()å‡½æ•°ã€‚</p><h4 id="æ²¡æœ‰-progress"><a href="#æ²¡æœ‰-progress" class="headerlink" title="æ²¡æœ‰ progress"></a>æ²¡æœ‰ progress</h4><p>åˆ°ç›®å‰ä¸ºæ­¢Fetchä»ä¸æ”¯æŒè¿›åº¦äº‹ä»¶ï¼Œå› æ­¤ï¼Œä¸å¯èƒ½æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ æˆ–å¤§å‹è¡¨å•æäº¤çš„è¿›åº¦çŠ¶æ€ã€‚</p><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://www.sitepoint.com/xmlhttprequest-vs-the-fetch-api-whats-best-for-ajax-in-2019/" target="_blank" rel="noopener">æ–‡æ¡£</a></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
          <category> Fetchå’ŒAxiosçš„åŒºåˆ« </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æ˜“å°è£…Cookie</title>
      <link href="/2018/01/16/workspace/Project/cookie/"/>
      <url>/2018/01/16/workspace/Project/cookie/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>ç®€æ˜“å°è£…Cookie</strong></p><p>[[toc]]</p><p>Cookieä¸ä»…ä»…æœ‰åå­—å’Œå€¼ä¸¤ä¸ªå±æ€§ï¼Œè¿˜æœ‰åŸŸï¼ˆdomainï¼‰ã€è·¯å¾„ï¼ˆpathï¼‰ç­‰å±æ€§ã€‚å…¶ä¸­ï¼Œä¸åŒçš„åŸŸã€ä¸åŒçš„è·¯å¾„ä¸‹å¯ä»¥å­˜åœ¨åŒæ ·åå­—çš„cookieã€‚<br>ä¸€èˆ¬æˆ‘ä»¬è®¾ç½®cookieçš„æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªåŒæ ·åå­—ã€ä¸€ä¸ªå€¼ã€‚è¿™æ—¶å°±ä¸€å®šè¦ææ¸…æ¥šä½ è¦è®¾ç½®çš„cookieçš„åŸŸå’Œè·¯å¾„ï¼Œå¦åˆ™å°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆè¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number|Infinity&#125;</span> </span>day è¿‡æœŸå¤©æ•° é»˜è®¤ Infinity</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">generateExpires</span>(<span class="params">day</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> getDay = day || <span class="literal">Infinity</span>;</span><br><span class="line">    <span class="keyword">const</span> getNow = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> getYearNumber = getNow.getFullYear();</span><br><span class="line">    <span class="keyword">const</span> getMonthNumber = getNow.getMonth() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> getDateNumber = getNow.getDate();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> getFullToday = <span class="string">`<span class="subst">$&#123;getYearNumber&#125;</span>-<span class="subst">$&#123;getMonthNumber&#125;</span>-<span class="subst">$&#123;getDateNumber&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    getNow.setTime(<span class="keyword">new</span> <span class="built_in">Date</span>(getFullToday).getTime() + (getDay * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> getNow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½® Cookie</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>name Cookie å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String|Number|Boolean&#125;</span> </span>value Cookie å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>expires è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name, value, expires = generateExpires(Infinity</span>)) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.cookie = <span class="string">`<span class="subst">$&#123;name&#125;</span>=<span class="subst">$&#123;value&#125;</span>; expires=<span class="subst">$&#123;expires.toUTCString()&#125;</span>; path=/`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å– Cookie</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>name å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> cname = <span class="string">`<span class="subst">$&#123;name&#125;</span>=`</span>;</span><br><span class="line">    <span class="keyword">const</span> Cookie = <span class="built_in">document</span>.cookie.split(<span class="string">';'</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; Cookie.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> item = Cookie[i];</span><br><span class="line">        <span class="keyword">while</span> (item.charAt(<span class="number">0</span>) === <span class="string">' '</span>) item = item.substring(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (item.indexOf(cname) === <span class="number">0</span>) <span class="keyword">return</span> item.substring(cname.length, item.length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç§»é™¤ Cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>name å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!name) <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'è¯·è¾“å…¥Cookieå'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> expires = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        expires.setTime(expires.getTime() - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> value = getCookie(name);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">            setCookie(name, value, expires);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSSä½¿ç”¨æŒ‡å—</title>
      <link href="/2017/01/16/workspace/Css/css/"/>
      <url>/2017/01/16/workspace/Css/css/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong class='old-blog'>CSSä½¿ç”¨æŒ‡å—</strong></p><p>[[toc]]</p><div style="margin-left: -6px; margin-right: -6px;">    <div class="el-col-6" style="padding-left: 6px; padding-right: 6px;">        <div class="demo-color-box" style="background: #409EFF;">        Brand Color        <div class="value">#409EFF</div>        </div>    </div>     <div class="el-col-6" style="padding-left: 6px; padding-right: 6px;">        <div class="demo-color-box" style="background: rgb(103, 194, 58);">        Success        <div class="value">#67C23A</div>        </div>    </div>    <div class="el-col-6 " style="padding-left: 6px; padding-right: 6px;">        <div class="demo-color-box" style="background: rgb(230, 162, 60);">        Warning        <div class="value">#E6A23C</div>        </div>    </div>    <div class="el-col-6" style="padding-left: 6px; padding-right: 6px;">        <div class="demo-color-box" style="background: rgb(245, 108, 108);">        Danger        <div class="value">#F56C6C</div>        </div>    </div>    <div class="el-col-6 " style="padding-left: 6px; padding-right: 6px;">        <div class="demo-color-box" style="background: rgb(144, 147, 153);">        Info        <div class="value">#909399</div>        </div>    </div>    <div style="padding-left: 6px; padding-right: 6px">         <div class="demo-color-box" style="background: linear-gradient(to right,#fcb045,#fd1d1d,#833ab4);">          æ¸å˜           <div class="value">âœ linear-gradient(to right,#fcb045,#fd1d1d,#833ab4)</div>         </div>    </div> </div><h3 id="calcæ–¹æ³•"><a href="#calcæ–¹æ³•" class="headerlink" title="calcæ–¹æ³•"></a>calcæ–¹æ³•</h3><ul><li>html{ font-size: calc(1em + 1vw); }</li></ul><p> <strong>less</strong>ä¸‹</p><ul><li>e(â€œcalc(100% - 260px)â€) </li><li>calc(~â€100% - 30pxâ€)</li></ul><h3 id="animateåŠ¨ç”»-åœåœ¨åŠ¨ç”»æœ€åçš„çš„é‚£ä¸ªç”»é¢"><a href="#animateåŠ¨ç”»-åœåœ¨åŠ¨ç”»æœ€åçš„çš„é‚£ä¸ªç”»é¢" class="headerlink" title="animateåŠ¨ç”»-åœåœ¨åŠ¨ç”»æœ€åçš„çš„é‚£ä¸ªç”»é¢"></a>animateåŠ¨ç”»-åœåœ¨åŠ¨ç”»æœ€åçš„çš„é‚£ä¸ªç”»é¢</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">animation</span>: <span class="selector-tag">downIn</span> 0<span class="selector-class">.5s</span>;</span><br><span class="line"><span class="selector-tag">animation-fill-mode</span>: <span class="selector-tag">forwards</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> downIn &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;<span class="attribute">top</span>: -<span class="number">88px</span>&#125;;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;<span class="attribute">top</span>: <span class="number">0</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nth-child-amp-nth-of-type"><a href="#nth-child-amp-nth-of-type" class="headerlink" title="nth-child() &amp; nth-of-type()"></a>nth-child() &amp; nth-of-type()</h3><p><strong>:nth-child(n)</strong> é€‰æ‹©å™¨åŒ¹é…çˆ¶å…ƒç´ å’Œå±äºå…¶çˆ¶å…ƒç´ çš„ç¬¬Nä¸ªå­å…ƒç´ ï¼Œ<code>ä¸è®ºå…ƒç´ çš„ç±»å‹</code>ã€‚</p><p><strong>:nth-of-type(n)</strong> é€‰æ‹©å™¨åŒ¹é…å’Œçˆ¶å…ƒç´ å±äºçˆ¶å…ƒç´ çš„<code>ç‰¹å®šç±»å‹</code>çš„ç¬¬Nä¸ªå­å…ƒç´ çš„æ¯ä¸ªå…ƒç´ ã€‚</p><p><strong>nth-last-child()</strong> ä»åé¢å¼€å§‹ï¼Œç±»ä¼¼nth-child()</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color:coral;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color:lightblue;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> // nth-of-type(2)</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color:khaki;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  // nth-child(6)</span><br></pre></td></tr></table></figure><h3 id="è¶…å‡ºéšè—"><a href="#è¶…å‡ºéšè—" class="headerlink" title="è¶…å‡ºéšè—"></a>è¶…å‡ºéšè—</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.info</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  //ä¸å¤ªå®ç”¨ï¼Œä»»ä½•æ—¶å€™éƒ½æœ‰...</span><br><span class="line">  <span class="selector-tag">content</span>: "";</span><br><span class="line">  <span class="selector-tag">font-weight</span>: <span class="selector-tag">bold</span>;</span><br><span class="line">  <span class="selector-tag">text-align</span>: <span class="selector-tag">right</span>;</span><br><span class="line">  <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">  <span class="selector-tag">bottom</span>: 0;</span><br><span class="line">  <span class="selector-tag">right</span>: 0;</span><br><span class="line">  <span class="selector-tag">width</span>: 90<span class="selector-tag">px</span>;</span><br><span class="line">  <span class="selector-tag">height</span>: 16<span class="selector-tag">px</span>;</span><br><span class="line">  <span class="selector-tag">background</span>: <span class="selector-tag">linear-gradient</span>(<span class="selector-tag">to</span> <span class="selector-tag">right</span>, <span class="selector-tag">rgba</span>(255, 255, 255, 0), <span class="selector-tag">rgba</span>(255, 255, 255, 1) 50%);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤šè¡Œè¶…å‡ºéšè—"><a href="#å¤šè¡Œè¶…å‡ºéšè—" class="headerlink" title="å¤šè¡Œè¶…å‡ºéšè—"></a>å¤šè¡Œè¶…å‡ºéšè—</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.info</span>&#123;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">-webkit-box-orient</span>: vertical;</span><br><span class="line">  <span class="attribute">-webkit-line-clamp</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰è§’å½¢-æ—‹è½¬ä¸‰è§’æ•ˆæœ-0-5åƒç´ çš„çº¿"><a href="#ä¸‰è§’å½¢-æ—‹è½¬ä¸‰è§’æ•ˆæœ-0-5åƒç´ çš„çº¿" class="headerlink" title="ä¸‰è§’å½¢ | æ—‹è½¬ä¸‰è§’æ•ˆæœ | 0.5åƒç´ çš„çº¿"></a>ä¸‰è§’å½¢ | æ—‹è½¬ä¸‰è§’æ•ˆæœ | 0.5åƒç´ çš„çº¿</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"> &amp;<span class="selector-pseudo">:nth-child(1)</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: -<span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">45%</span>);</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#FD5E4E</span> transparent transparent transparent;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">background</span>: <span class="selector-id">#72B4FD</span>;</span><br><span class="line"><span class="selector-tag">width</span>: 100%;</span><br><span class="line"><span class="selector-tag">height</span>: 100%;</span><br><span class="line"><span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line"><span class="selector-tag">top</span>: 0;</span><br><span class="line"><span class="selector-tag">right</span>: <span class="selector-tag">-0</span><span class="selector-class">.23rem</span>;</span><br><span class="line"><span class="selector-tag">-webkit-transform</span>: <span class="selector-tag">skewX</span>(<span class="selector-tag">-20deg</span>);</span><br><span class="line"><span class="selector-tag">transform</span>: <span class="selector-tag">skewX</span>(<span class="selector-tag">-20deg</span>);</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&amp; <span class="selector-class">.line</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">236px</span>;</span><br><span class="line">  <span class="attribute">float</span>: right;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">11px</span> <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  &amp;:after &#123;</span><br><span class="line">    <span class="selector-tag">content</span>: "";</span><br><span class="line">    <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">    <span class="selector-tag">bottom</span>: 0;</span><br><span class="line">    <span class="selector-tag">background</span>: <span class="selector-id">#ccc</span>;</span><br><span class="line">    <span class="selector-tag">width</span>: 100%;</span><br><span class="line">    <span class="selector-tag">height</span>: 1<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">-webkit-transform</span>: <span class="selector-tag">scaleY</span>(0<span class="selector-class">.5</span>);</span><br><span class="line">    <span class="selector-tag">transform</span>: <span class="selector-tag">scaleY</span>(0<span class="selector-class">.5</span>);</span><br><span class="line">    <span class="selector-tag">-webkit-transform-origin</span>: 0 0;</span><br><span class="line">    <span class="selector-tag">transform-origin</span>: 0 0;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="loading"><a href="#loading" class="headerlink" title="loading"></a>loading</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.loading</span></span><br><span class="line">    <span class="selector-tag">width</span>: 159<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">height</span>: 151<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">margin</span>: 0 <span class="selector-tag">auto</span>;</span><br><span class="line">    <span class="selector-tag">position</span>: <span class="selector-tag">relative</span>;</span><br><span class="line"> <span class="selector-class">.loading</span><span class="selector-pseudo">::before</span>,<span class="selector-class">.loading</span><span class="selector-pseudo">::after</span></span><br><span class="line">    content: '';</span><br><span class="line">    <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">    <span class="selector-tag">width</span>: 0<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">height</span>: 0<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">background</span>: <span class="selector-tag">black</span>;</span><br><span class="line">    <span class="selector-tag">border-radius</span>: 50%;</span><br><span class="line">    <span class="selector-tag">top</span><span class="selector-pseudo">:0</span>;      </span><br><span class="line">    <span class="selector-tag">bottom</span>: 0;</span><br><span class="line">    <span class="selector-tag">left</span>: 0;</span><br><span class="line">    <span class="selector-tag">right</span>: 0;</span><br><span class="line">    <span class="selector-tag">margin</span>: <span class="selector-tag">auto</span>;   <span class="comment">/*ä¸Šä¸‹å·¦å³éƒ½ä¸º0ï¼Œå†åŠ ä¸Šmargin:auto; å°±æ˜¯è‡ªåŠ¨å±…ä¸­*/</span></span><br><span class="line">    <span class="selector-tag">animation</span>: <span class="selector-tag">s</span> 1<span class="selector-class">.5s</span> <span class="selector-tag">linear</span> <span class="selector-tag">infinite</span>;  <span class="comment">/*åŠ ä¸ŠsçŠ¶æ€ï¼ŒçŠ¶æ€å¼€å§‹åˆ°ç»“æŸä¸º1.5s*/</span></span><br><span class="line"><span class="selector-class">.loading</span><span class="selector-pseudo">::after</span></span><br><span class="line">    <span class="selector-tag">animation-delay</span>: 0<span class="selector-class">.75s</span>;     <span class="comment">/*ç¬¬äºŒä¸ªåœ†å‡ºç°çš„æ—¶é—´*/</span></span><br><span class="line">    </span><br><span class="line"> <span class="keyword">@keyframes</span> s&#123;</span><br><span class="line">    0%&#123;             <span class="comment">/*åˆå§‹çŠ¶æ€*/</span></span><br><span class="line">        <span class="attribute">width</span>: <span class="number">0px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">0px</span>;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>; <span class="comment">/*é€æ˜åº¦*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    100%&#123;           <span class="comment">/*ç»“æŸçŠ¶æ€*/</span></span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¼ªç±»é¢åŒ…å±‘"><a href="#ä¼ªç±»é¢åŒ…å±‘" class="headerlink" title="ä¼ªç±»é¢åŒ…å±‘"></a>ä¼ªç±»é¢åŒ…å±‘</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;ul class="breadcrumb"&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href="#"&gt;Home&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href="#"&gt;Pictures&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href="#"&gt;Summer 15&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li&gt;Italy&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.breadcrumb</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.breadcrumb</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.breadcrumb</span> <span class="selector-tag">li</span>+<span class="selector-tag">li</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">color</span>: black;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">"/\00a0"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.breadcrumb</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">const elm = document.documentElement</span><br><span class="line">//å…¨å±€æ§åˆ¶ </span><br><span class="line"><span class="selector-tag">elm</span><span class="selector-class">.style</span><span class="selector-class">.setProperty</span>("<span class="selector-tag">background-color</span>", "<span class="selector-tag">yellow</span>");</span><br></pre></td></tr></table></figure><h3 id="Cssçš„ä¸¤ç§ç›’æ¨¡å‹"><a href="#Cssçš„ä¸¤ç§ç›’æ¨¡å‹" class="headerlink" title="Cssçš„ä¸¤ç§ç›’æ¨¡å‹"></a>Cssçš„ä¸¤ç§ç›’æ¨¡å‹</h3><p><a href="/2019/01/21/workspace/Css/box-sizing/">Cssçš„ä¸¤ç§ç›’æ¨¡å‹</a> </p><h3 id="æ¸…é™¤æµ®åŠ¨"><a href="#æ¸…é™¤æµ®åŠ¨" class="headerlink" title="æ¸…é™¤æµ®åŠ¨"></a>æ¸…é™¤æµ®åŠ¨</h3><p><a href="/2018/01/20/workspace/Css/clearfix/">æ¸…é™¤æµ®åŠ¨çš„å‡ ç§æ–¹æ³•</a></p><h3 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h3><p><a href="/2018/01/20/workspace/Css/bfc/">bfcè¯¦è§£</a></p><h3 id="CSSä¹å®«æ ¼å¸ƒå±€å®ç°"><a href="#CSSä¹å®«æ ¼å¸ƒå±€å®ç°" class="headerlink" title="CSSä¹å®«æ ¼å¸ƒå±€å®ç°"></a>CSSä¹å®«æ ¼å¸ƒå±€å®ç°</h3><p><a href="/2018/01/20/workspace/Css/lattice/">CSSä¹å®«æ ¼å¸ƒå±€å®ç°</a></p><h3 id="CSSå®ç°æ­£å…­è¾¹å½¢"><a href="#CSSå®ç°æ­£å…­è¾¹å½¢" class="headerlink" title="CSSå®ç°æ­£å…­è¾¹å½¢"></a>CSSå®ç°æ­£å…­è¾¹å½¢</h3><p><a href="https://github.com/web-tiki/responsive-grid-of-hexagons" target="_blank" rel="noopener">github</a></p><h3 id="ç§»åŠ¨ç«¯viewport"><a href="#ç§»åŠ¨ç«¯viewport" class="headerlink" title="ç§»åŠ¨ç«¯viewport"></a>ç§»åŠ¨ç«¯viewport</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,viewport-fit=cover"</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">contentå±æ€§å€¼ :</span><br><span class="line">width:å¯è§†åŒºåŸŸçš„å®½åº¦ï¼Œå€¼å¯ä¸ºæ•°å­—æˆ–å…³é”®è¯device-width</span><br><span class="line">height:åŒwidth</span><br><span class="line">intial-scale:é¡µé¢é¦–æ¬¡è¢«æ˜¾ç¤ºæ˜¯å¯è§†åŒºåŸŸçš„ç¼©æ”¾çº§åˆ«ï¼Œå–å€¼1.0åˆ™é¡µé¢æŒ‰å®é™…å°ºå¯¸æ˜¾ç¤ºï¼Œæ— ä»»ä½•ç¼©æ”¾</span><br><span class="line">maximum-scale&#x3D;1.0, minimum-scale&#x3D;1.0;å¯è§†åŒºåŸŸçš„ç¼©æ”¾çº§åˆ«ï¼Œ</span><br><span class="line">maximum-scaleç”¨æˆ·å¯å°†é¡µé¢æ”¾å¤§çš„ç¨‹åºï¼Œ1.0å°†ç¦æ­¢ç”¨æˆ·æ”¾å¤§åˆ°å®é™…å°ºå¯¸ä¹‹ä¸Šã€‚</span><br><span class="line">user-scalable:æ˜¯å¦å¯å¯¹é¡µé¢è¿›è¡Œç¼©æ”¾ï¼Œno ç¦æ­¢ç¼©æ”¾</span><br><span class="line">viewport-fit&#x3D;coverï¼šå…¼å®¹iPhoneXåˆ˜æµ·å…¨å±</span><br></pre></td></tr></table></figure><h3 id="ç§»åŠ¨ç«¯1pxå¾ˆç²—çš„é—®é¢˜"><a href="#ç§»åŠ¨ç«¯1pxå¾ˆç²—çš„é—®é¢˜" class="headerlink" title="ç§»åŠ¨ç«¯1pxå¾ˆç²—çš„é—®é¢˜"></a>ç§»åŠ¨ç«¯1pxå¾ˆç²—çš„é—®é¢˜</h3><p>åœ¨åšç§»åŠ¨ç«¯å¼€å‘æ—¶,è®¾è®¡å¸ˆæä¾›çš„è§†è§‰ç¨¿ä¸€èˆ¬æ˜¯750px,å½“ä½ å®šä¹‰ border-width:1pxæ—¶,åœ¨iphone6æ‰‹æœºä¸Šå´å‘ç°:è¾¹æ¡†å˜ç²—äº†ã€‚<br>è¿™æ˜¯å› ä¸º,1pxæ˜¯ç›¸å¯¹äº750pxçš„(ç‰©ç†åƒç´ ),è€Œæˆ‘ä»¬å®šä¹‰çš„1pxæ˜¯ç›¸å¯¹äº375pxçš„(cssåƒç´ )â€œå®é™…ä¸Šåº”è¯¥æ˜¯border-width:0.5pxâ€.</p><p><strong>å…³äºç‰©ç†åƒç´ å’Œç‹¬ç«‹åƒç´ </strong></p><p>ç‰©ç†åƒç´ <br/><br>ç§»åŠ¨è®¾å¤‡å‡ºå‚æ—¶,ä¸åŒè®¾å¤‡è‡ªå¸¦çš„ä¸åŒåƒç´ ,ä¹Ÿç§°ç¡¬ä»¶åƒç´ ;</p><p>ç‹¬ç«‹åƒç´ <br/><br>å³cssä¸­è®°å½•çš„åƒç´ ã€‚</p><p><strong>æ‰‹æœºå±å¹•åˆ†ä¸ºï¼š</strong></p><p>ä¸€ï¼šéè§†ç½‘è†œå±å¹• ï¼ˆç‰©ç†åƒç´ 375ï¼Œè¯¥è®¾å¤‡çš„ç‹¬ç«‹åƒç´ ï¼ˆè§†åŒºå®½åº¦ï¼‰ä¹Ÿæ˜¯375ï¼‰<br/><br>äºŒï¼šè§†ç½‘è†œå±å¹•  ï¼ˆç‰©ç†åƒç´ æ˜¯750ï¼Œè¯¥è®¾å¤‡çš„ç‹¬ç«‹çš„ç‹¬ç«‹åƒç´ è¿˜æ˜¯375ï¼‰</p><p><code>pxéƒ½ä¼šå—å“ªäº›å› ç´ çš„å½±å“è€Œå˜åŒ–ï¼Ÿ</code></p><ul><li>åƒç´ å¯†åº¦(pixel per inch, PPI)</li><li>è®¾å¤‡åƒç´ æ¯”(device pixel ratio, DPR)</li></ul><p><strong>PPI</strong></p><p>æ¯è‹±å¯¸ç‰©ç†åƒç´ ç‚¹æ•°ï¼‰ï¼Œæ›´ç¡®åˆ‡çš„è¯´æ³•åº”è¯¥æ˜¯åƒç´ å¯†åº¦ï¼Œä¹Ÿå°±æ˜¯è¡¡é‡å•ä½ç‰©ç†é¢ç§¯å†…æ‹¥æœ‰åƒç´ å€¼çš„æƒ…å†µ,æ”¾åˆ°æ˜¾ç¤ºå™¨ä¸Šè¯´çš„æ˜¯æ¯è‹±å¯¸å¤šå°‘ç‰©ç†åƒç´ æˆ–æ˜¾ç¤ºå™¨è®¾å¤‡çš„ç‚¹è·ã€‚</p><p><strong>DPR</strong></p><p>è®¾å¤‡åƒç´ æ¯” ï¼ ç‰©ç†åƒç´  / è®¾å¤‡ç‹¬ç«‹åƒç´ </p><p>é€šä¿—ç‚¹è®²ï¼š<strong>è®¾å¤‡åƒç´ æ¯”(dpr)</strong> æ˜¯æŒ‡åœ¨ç§»åŠ¨å¼€å‘åŒä¸€æ–¹å‘ä¸Šï¼ˆxè½´æˆ–yè½´ï¼‰ä¸­1ä¸ªcssåƒç´ å ç”¨å¤šå°‘è®¾å¤‡åƒç´ ï¼Œ</p><p>å¦‚è§†ç½‘è†œå±å¹• dpr = 2ï¼Œä»£è¡¨1ä¸ªcssåƒç´ ç”¨2x2ä¸ªè®¾å¤‡åƒç´ æ¥ç»˜åˆ¶ã€‚</p><p>åœ¨ JavaScript ä¸­ï¼Œå¯ä»¥é€šè¿‡window.devicePixelRatioè·å–åˆ°å½“å‰è®¾å¤‡çš„ dprã€‚<br>è€Œåœ¨ CSS ä¸­ï¼Œå¯ä»¥é€šè¿‡-webkit-device-pixel-ratioï¼Œ-webkit-min-device-pixel-ratioå’Œ-webkit-max-device-pixel-ratioè¿›è¡Œåª’ä½“æŸ¥è¯¢ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™æ‹¿åˆ°è®¾å¤‡çš„devicePixelRatioï¼ŒåŠ¨æ€æ”¹å˜viewportçš„initial-scaleä¸º 1/devicePixelRatioï¼Œ<br>è¿™æ ·å°±èƒ½ä¿è¯1pxçš„å®½åº¦å°±æ˜¯çœŸæ­£çš„1ç‰©ç†åƒç´ å®½ï¼Œå…¶ä»–é€‚é…ä½¿ç”¨remï¼ˆå› ä¸ºä½¿ç”¨pxçš„è¯éƒ½ä¼šè¢«ç¼©å°ï¼‰</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clientWidth = <span class="built_in">window</span>.screen.width;</span><br><span class="line">  <span class="keyword">var</span> dpr = <span class="built_in">window</span>.devicePixelRatio;</span><br><span class="line">  <span class="keyword">var</span> vp = <span class="built_in">document</span>.createElement(<span class="string">'meta'</span>);</span><br><span class="line">  <span class="built_in">document</span>.documentElement.style.fontSize = clientWidth &gt; <span class="number">414</span> ? <span class="string">'20px'</span> : <span class="number">20</span> * dpr * clientWidth / <span class="number">360</span> + <span class="string">'px'</span>;</span><br><span class="line">  vp.name = <span class="string">'viewport'</span>;</span><br><span class="line">  vp.content = <span class="string">`initial-scale=<span class="subst">$&#123;<span class="number">1.0</span> * <span class="number">1</span> <span class="regexp">/ dpr&#125;, maximum-scale=$&#123;1.0 * 1 /</span> dpr&#125;</span>, minimum-scale=<span class="subst">$&#123;<span class="number">1.0</span> * <span class="number">1</span> <span class="regexp">/ dpr&#125;, user-scalable=no, width=device-width`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  var m = document.getElementsByTagName('meta')[0];</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  m.parentNode.insertBefore(vp, m);</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  </span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  /</span><span class="regexp">/ var vp = document.getElementsByTagName('meta')[1];</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  /</span><span class="regexp">/ vp.content = `initial-scale=$&#123;1.0 * 1 /</span> dpr&#125;</span>, maximum-scale=<span class="subst">$&#123;<span class="number">1.0</span> * <span class="number">1</span> <span class="regexp">/ dpr&#125;, minimum-scale=$&#123;1.0 * 1 /</span> dpr&#125;</span>, user-scalable=no, width=device-width`</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onresize = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    fn()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/maqingbo/p/7528861/" target="_blank" rel="noopener">https://www.cnblogs.com/maqingbo/p/7528861/</a></p><h3 id="remåŸç†"><a href="#remåŸç†" class="headerlink" title="remåŸç†"></a>remåŸç†</h3><p>remå¸ƒå±€çš„æœ¬è´¨æ˜¯<code>ç­‰æ¯”ç¼©æ”¾</code>ï¼Œä¸€èˆ¬æ˜¯åŸºäºå®½åº¦ï¼Œå‡è®¾å°†å±å¹•å®½åº¦åˆ†ä¸º100ä»½ï¼Œæ¯ä»½å®½åº¦æ˜¯1remï¼Œ1remçš„å®½åº¦æ˜¯å±å¹•å®½åº¦/100,ï¼Œç„¶åå­å…ƒç´ è®¾ç½®remå•ä½çš„å±æ€§ï¼Œ<br>é€šè¿‡æ”¹å˜htmlå…ƒç´ çš„å­—ä½“å¤§å°ï¼Œå°±å¯ä»¥è®¾ç½®å­å…ƒç´ çš„å®é™…å¤§å°ã€‚<br>remå¸ƒå±€åŠ è½½é—ªçƒçš„é—®é¢˜</p><p>è§£å†³æ–¹æ¡ˆï¼Œåª’ä½“æŸ¥è¯¢è®¾ç½®æ ¹å…ƒç´ å­—ä½“å¤§å°ï¼Œæ¯”å¦‚è®¾è®¡ç¨¿æ˜¯750px;å¯¹åº”çš„å¼€å‘æ–¹å¼æ˜¯1rem=100px,é‚£375pxçš„font-size å¤§å°å°±æ˜¯50pxï¼ˆå…·ä½“æ–¹æ³•å¯ä»¥ç™¾åº¦ä¸€ä¸‹ï¼‰</p><p>æ¯”remæ›´å¥½çš„æ–¹æ¡ˆï¼ˆç¼ºç‚¹å…¼å®¹ä¸å¥½ï¼‰</p><p>vw(1vwæ˜¯è§†å£å®½åº¦çš„1%ï¼Œ100vwå°±æ˜¯è§†å£å®½åº¦),vh(100vhå°±æ˜¯è§†å£é«˜åº¦)</p><h3 id="scss-Mixins"><a href="#scss-Mixins" class="headerlink" title="scss Mixins"></a>scss Mixins</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">$warning: #ead1a6;</span><br><span class="line">$danger: #f44f4d;</span><br><span class="line"></span><br><span class="line">$dpr: 2 !default;</span><br><span class="line"><span class="keyword">@function</span> second($val) &#123;</span><br><span class="line">  <span class="keyword">@return</span> round($val * $dpr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* methods</span></span><br><span class="line"><span class="comment">-------------------------- */</span></span><br><span class="line">// èƒŒæ™¯å›¾ç‰‡åœ°å€å’Œå¤§å°</span><br><span class="line"><span class="keyword">@mixin</span> bg($url) &#123;</span><br><span class="line">  background-image: url($url);</span><br><span class="line">  <span class="selector-tag">background-repeat</span>: <span class="selector-tag">no-repeat</span>;</span><br><span class="line">  <span class="selector-tag">background-size</span>: 100% 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä½ä¸Šä¸‹å·¦å³å±…ä¸­</span><br><span class="line"><span class="keyword">@mixin</span> center &#123;</span><br><span class="line">  <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">  <span class="selector-tag">top</span>: 50%;</span><br><span class="line">  <span class="selector-tag">left</span>: 50%;</span><br><span class="line">  <span class="selector-tag">transform</span>: <span class="selector-tag">translate</span>(<span class="selector-tag">-50</span>%, <span class="selector-tag">-50</span>%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä½ä¸Šä¸‹å±…ä¸­</span><br><span class="line"><span class="keyword">@mixin</span> ct &#123;</span><br><span class="line">  <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">  <span class="selector-tag">top</span>: 50%;</span><br><span class="line">  <span class="selector-tag">transform</span>: <span class="selector-tag">translateY</span>(<span class="selector-tag">-50</span>%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä½å·¦å³å±…ä¸­</span><br><span class="line"><span class="keyword">@mixin</span> cl &#123;</span><br><span class="line">  <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">  <span class="selector-tag">left</span>: 50%;</span><br><span class="line">  <span class="selector-tag">transform</span>: <span class="selector-tag">translateX</span>(<span class="selector-tag">-50</span>%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å¤šè¡Œæ˜¾ç¤ºçœç•¥å·</span><br><span class="line"><span class="keyword">@mixin</span> noWrapline($<span class="attribute">line:</span><span class="number">2</span>) &#123;</span><br><span class="line">  <span class="selector-tag">display</span>: <span class="selector-tag">-webkit-box</span>;</span><br><span class="line">  -webkit-line-clamp: $line;</span><br><span class="line">  <span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br><span class="line">  <span class="selector-tag">text-overflow</span>: <span class="selector-tag">ellipsis</span>;</span><br><span class="line">  <span class="comment">/*! autoprefixer: off */</span></span><br><span class="line">  <span class="selector-tag">-webkit-box-orient</span>: <span class="selector-tag">vertical</span>;</span><br><span class="line">  <span class="comment">/* autoprefixer: on */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// flex å¸ƒå±€å’Œ å­å…ƒç´  å¯¹å…¶æ–¹å¼</span><br><span class="line"><span class="keyword">@mixin</span> fj($<span class="attribute">type:</span> space-between) &#123;</span><br><span class="line">  <span class="selector-tag">display</span>: <span class="selector-tag">flex</span>;</span><br><span class="line">  justify-content: $type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//ç”¨æ³•</span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line"> @include fj(center);</span><br><span class="line"> background: $page-bg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="less-Mixins"><a href="#less-Mixins" class="headerlink" title="less Mixins"></a>less Mixins</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@import &#39;~antd&#x2F;es&#x2F;style&#x2F;themes&#x2F;default.less&#39;;</span><br><span class="line"></span><br><span class="line">@pro-header-hover-bg: rgba(0, 0, 0, 0.025);</span><br><span class="line"></span><br><span class="line">@blue: #3190e8;</span><br><span class="line">@bc: #e4e4e4;</span><br><span class="line">@fc:#fff;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; èƒŒæ™¯å›¾ç‰‡åœ°å€å’Œå¤§å°</span><br><span class="line">.bis(@url) &#123;</span><br><span class="line">  background-image: url(@url);</span><br><span class="line">  background-repeat: no-repeat;</span><br><span class="line">  background-size: 100% 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å®šä½å…¨å±</span><br><span class="line">.allcover&#123;</span><br><span class="line">  position:absolute;</span><br><span class="line">  top:0;</span><br><span class="line">  right:0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; æ°´å¹³å‚ç›´å±…ä¸­</span><br><span class="line">.center () &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 50%;</span><br><span class="line">  left: 50%;</span><br><span class="line">  transform: translate(-50%, -50%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å®šä½ä¸Šä¸‹å±…ä¸­</span><br><span class="line">.tb &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 50%;</span><br><span class="line">  transform: translateY(-50%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å®šä½å·¦å³å±…ä¸­</span><br><span class="line">.lr &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  left: 50%;</span><br><span class="line">  transform: translateX(-50%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å•è¡Œæ˜¾ç¤ºçœç•¥å·</span><br><span class="line">.noWrap &#123;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  text-overflow: ellipsis;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å¤šè¡Œæ˜¾ç¤ºçœç•¥å·</span><br><span class="line">.noWrapline(@line) &#123;</span><br><span class="line">  display: -webkit-box;</span><br><span class="line">  -webkit-line-clamp: @line;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  text-overflow: ellipsis;</span><br><span class="line">  &#x2F;*! autoprefixer: off *&#x2F;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">  &#x2F;* autoprefixer: on *&#x2F;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ç”¨æ³•</span><br><span class="line">.ant-menu-item-selected &#123;</span><br><span class="line">  .center;</span><br><span class="line">  background-color: @all-color </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line"></span><br><span class="line">### cssModules</span><br><span class="line"></span><br><span class="line">[cssModules](&#x2F;2018&#x2F;01&#x2F;20&#x2F;workspace&#x2F;Css&#x2F;cssModules&#x2F;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### âœ„ Flexå¼¹æ€§å¸ƒå±€</span><br><span class="line"></span><br><span class="line">[Flexå¼¹æ€§å¸ƒå±€](&#x2F;2018&#x2F;01&#x2F;20&#x2F;workspace&#x2F;Css&#x2F;flex&#x2F;)</span><br><span class="line"></span><br><span class="line">### PostCSS</span><br><span class="line"></span><br><span class="line">**ä»€ä¹ˆæ˜¯postcss**</span><br><span class="line"></span><br><span class="line">postcss ä¸€ç§å¯¹cssç¼–è¯‘çš„å·¥å…·ï¼Œç±»ä¼¼babelå¯¹jsçš„å¤„ç†ï¼Œå¸¸è§çš„åŠŸèƒ½å¦‚ï¼š&lt;br&#x2F;&gt;</span><br><span class="line">1.ä½¿ç”¨ä¸‹ä¸€ä»£cssè¯­æ³•&lt;br&#x2F;&gt;</span><br><span class="line">2.è‡ªåŠ¨è¡¥å…¨æµè§ˆå™¨å‰ç¼€&lt;br&#x2F;&gt;</span><br><span class="line">3.è‡ªåŠ¨æŠŠpxä»£ä¸ºè½¬æ¢æˆrem&lt;br&#x2F;&gt;</span><br><span class="line">4.cssä»£ç å‹ç¼©ç­‰ç­‰&lt;br&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">**å¦‚ä½•ä½¿ç”¨**</span><br><span class="line"></span><br><span class="line">è¿™é‡Œåªè¯´åœ¨webpacké‡Œé›†æˆä½¿ç”¨ï¼Œé¦–å…ˆéœ€è¦ loader</span><br><span class="line"></span><br><span class="line">&#96;sudo yarn add -D postcss-loader  postcss-preset-env&#96;</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;javascript</span><br><span class="line"> &#123;</span><br><span class="line">    loader: require.resolve(&#39;postcss-loader&#39;),</span><br><span class="line">    options: &#123;</span><br><span class="line">        ident: &#39;postcss&#39;,</span><br><span class="line">        plugins: () &#x3D;&gt; [</span><br><span class="line">            require(&#39;postcss-flexbugs-fixes&#39;),</span><br><span class="line">            require(&#39;postcss-preset-env&#39;)(&#123;</span><br><span class="line">                autoprefixer: &#123;</span><br><span class="line">                    flexbox: &#39;no-2009&#39;,</span><br><span class="line">                &#125;,</span><br><span class="line">                stage: 3,</span><br><span class="line">            &#125;),</span><br><span class="line">        ],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>postcss-flexbugs-fixes  ä¿®å¤Flexbugs<br/></li><li>postcss-preset-env  å°†ç°ä»£CSSè½¬æ¢æˆæµè§ˆå™¨èƒ½ç†è§£çš„ä¸œè¥¿ã€å®‰è£…postcss-preset-envï¼Œæ— éœ€å†å®‰è£…autoprefixerï¼Œç”±äºpostcss-preset-envå·²ç»å†…ç½®äº†ç›¸å…³åŠŸèƒ½ã€‚ã€‘<br/></li><li>postcss-cssnext  ä½¿ç”¨ä¸‹ä¸ªç‰ˆæœ¬çš„cssè¯­æ³•ï¼›å¦‚css4ï¼ˆå¯ä»¥ç†è§£ä¸ºcssä¸­çš„Babelï¼‰</li><li>postcss-sprites è‡ªåŠ¨åˆ¶ä½œé›ªç¢§å›¾ï¼Œä¸ç”¨æ‰‹åŠ¨æ‹¼æ¥å•¦</li><li>postcss-hash-classname æŠŠè½¬æ¢åçš„cssæ–‡ä»¶åé™„ä¸Šå“ˆå¸Œå€¼</li><li>postcss-pxtorem  æŠŠpxè½¬æ¢æˆrem</li><li>pixrem å°†remè½¬æ¢ä¸ºpx</li><li>postcss-px-to-viewport æŠŠpxè½¬æ¢æˆviewportå•ä½ã€viewport-units-buggyfill(vwçš„å…¼å®¹å¤„ç†)ã€‘</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   plugins: &#123;</span><br><span class="line">       <span class="string">'postcss-px-to-viewport'</span>: &#123;</span><br><span class="line">           viewportWidth: <span class="number">750</span>,   <span class="comment">// è§†çª—çš„å®½åº¦ï¼Œå¯¹åº”çš„æ˜¯æˆ‘ä»¬è®¾è®¡ç¨¿çš„å®½åº¦ï¼Œä¸€èˆ¬æ˜¯750</span></span><br><span class="line">           viewportHeight: <span class="number">1334</span>, <span class="comment">// è§†çª—çš„é«˜åº¦ï¼Œæ ¹æ®750è®¾å¤‡çš„å®½åº¦æ¥æŒ‡å®šï¼Œä¸€èˆ¬æŒ‡å®š1334ï¼Œä¹Ÿå¯ä»¥ä¸é…ç½®</span></span><br><span class="line">           unitPrecision: <span class="number">3</span>,     <span class="comment">// æŒ‡å®š`px`è½¬æ¢ä¸ºè§†çª—å•ä½å€¼çš„å°æ•°ä½æ•°</span></span><br><span class="line">           viewportUnit: <span class="string">"vw"</span>,   <span class="comment">//æŒ‡å®šéœ€è¦è½¬æ¢æˆçš„è§†çª—å•ä½ï¼Œå»ºè®®ä½¿ç”¨vw</span></span><br><span class="line">           selectorBlackList: [<span class="string">'.ignore'</span>],<span class="comment">// æŒ‡å®šä¸è½¬æ¢ä¸ºè§†çª—å•ä½çš„ç±»ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œå¯ä»¥æ— é™æ·»åŠ ,å»ºè®®å®šä¹‰ä¸€è‡³ä¸¤ä¸ªé€šç”¨çš„ç±»å</span></span><br><span class="line">           minPixelValue: <span class="number">1</span>,     <span class="comment">// å°äºæˆ–ç­‰äº`1px`ä¸è½¬æ¢ä¸ºè§†çª—å•ä½ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºä½ æƒ³è¦çš„å€¼</span></span><br><span class="line">           mediaQuery: <span class="literal">false</span>     <span class="comment">// å…è®¸åœ¨åª’ä½“æŸ¥è¯¢ä¸­è½¬æ¢`px`</span></span><br><span class="line">       &#125;   </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æš—é»‘æ¨¡å¼"><a href="#æš—é»‘æ¨¡å¼" class="headerlink" title="æš—é»‘æ¨¡å¼"></a>æš—é»‘æ¨¡å¼</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@media (prefers-color-scheme: dark) &#123; // é»‘æš—æ¨¡å¼ </span><br><span class="line">  .guide-page &#123;</span><br><span class="line">    background: #292929;</span><br><span class="line">    .guide-title &#123;</span><br><span class="line">      font-size: 28px;</span><br><span class="line">      color: white</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media (prefers-color-scheme: light) &#123; // æ­£å¸¸çš„</span><br><span class="line">  .guide-page &#123;</span><br><span class="line">    background: white;</span><br><span class="line">    .guide-title &#123;</span><br><span class="line">      font-size: 28px;</span><br><span class="line">      color: #222222eb</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme" target="_blank" rel="noopener">æ–‡æ¡£</a></p><h3 id="SVG-favicon"><a href="#SVG-favicon" class="headerlink" title="SVG favicon"></a>SVG favicon</h3><p>favicon æ”¯æŒå®ç°é»‘ç™½æ¨¡å¼</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"100"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        circle &#123;</span><br><span class="line">            fill: yellow;</span><br><span class="line">            stroke: black;</span><br><span class="line">            stroke-width: 3px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="keyword">@media</span> (<span class="attribute">prefers-color-scheme:</span> dark) &#123;</span></span><br><span class="line">            circle &#123;</span><br><span class="line">            fill: black;</span><br><span class="line">            stroke: yellow;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"50"</span> <span class="attr">r</span>=<span class="string">"47"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•è®¾ç½®bodyèƒŒæ™¯è‰²ï¼Œheight-100-ä¸ç”Ÿæ•ˆï¼Ÿ"><a href="#å¦‚ä½•è®¾ç½®bodyèƒŒæ™¯è‰²ï¼Œheight-100-ä¸ç”Ÿæ•ˆï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¾ç½®bodyèƒŒæ™¯è‰²ï¼Œheight:100%,ä¸ç”Ÿæ•ˆï¼Ÿ"></a>å¦‚ä½•è®¾ç½®bodyèƒŒæ™¯è‰²ï¼Œheight:100%,ä¸ç”Ÿæ•ˆï¼Ÿ</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//åŒæ—¶è®¾ç½®htmlï¼Œbodyçš„é«˜åº¦</span><br><span class="line"><span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">100%</span>ï¼›</span><br><span class="line">&#125; </span><br><span class="line">æˆ–</span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">  height: 100vh; // ä»£è¡¨å å±å¹•100%</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å»é™¤ios-æ‰‹æœºç«¯inputè¾“å…¥æ¡†çš„å†…é˜´å½±"><a href="#å»é™¤ios-æ‰‹æœºç«¯inputè¾“å…¥æ¡†çš„å†…é˜´å½±" class="headerlink" title="å»é™¤ios æ‰‹æœºç«¯inputè¾“å…¥æ¡†çš„å†…é˜´å½±"></a>å»é™¤ios æ‰‹æœºç«¯inputè¾“å…¥æ¡†çš„å†…é˜´å½±</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">input</span>&#123; </span><br><span class="line">    <span class="attribute">-webkit-appearance</span>: none; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="iOSç«¯inputè¾“å…¥æ¡†å…‰æ ‡é”™ä½"><a href="#iOSç«¯inputè¾“å…¥æ¡†å…‰æ ‡é”™ä½" class="headerlink" title="iOSç«¯inputè¾“å…¥æ¡†å…‰æ ‡é”™ä½"></a>iOSç«¯inputè¾“å…¥æ¡†å…‰æ ‡é”™ä½</h3><p>æ˜¯ç”±äºfixedå®šä½å¼•èµ·çš„ï¼Œæ”¹æˆabsoluteå°±è§£å†³äº†ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å›¾ç‰‡æ˜¾ç¤ºä¸­é—´éƒ¨åˆ†"><a href="#å›¾ç‰‡æ˜¾ç¤ºä¸­é—´éƒ¨åˆ†" class="headerlink" title="å›¾ç‰‡æ˜¾ç¤ºä¸­é—´éƒ¨åˆ†"></a>å›¾ç‰‡æ˜¾ç¤ºä¸­é—´éƒ¨åˆ†</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit" target="_blank" rel="noopener">object-fit</a></p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//1</span><br><span class="line"><span class="selector-tag">object-fit</span>: <span class="selector-tag">cover</span>;</span><br><span class="line">//2</span><br><span class="line"><span class="selector-tag">object-position</span>: 50% 50%;</span><br></pre></td></tr></table></figure><h3 id="iOSä¸‹å–æ¶ˆinputåœ¨è¾“å…¥çš„æ—¶å€™è‹±æ–‡é¦–å­—æ¯çš„é»˜è®¤å¤§å†™"><a href="#iOSä¸‹å–æ¶ˆinputåœ¨è¾“å…¥çš„æ—¶å€™è‹±æ–‡é¦–å­—æ¯çš„é»˜è®¤å¤§å†™" class="headerlink" title="iOSä¸‹å–æ¶ˆinputåœ¨è¾“å…¥çš„æ—¶å€™è‹±æ–‡é¦–å­—æ¯çš„é»˜è®¤å¤§å†™"></a>iOSä¸‹å–æ¶ˆinputåœ¨è¾“å…¥çš„æ—¶å€™è‹±æ–‡é¦–å­—æ¯çš„é»˜è®¤å¤§å†™</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;input type="text" autocapitalize="none"&gt;</span><br></pre></td></tr></table></figure><h3 id="ç¦æ­¢-iOS-è¯†åˆ«é•¿ä¸²æ•°å­—ä¸ºç”µè¯"><a href="#ç¦æ­¢-iOS-è¯†åˆ«é•¿ä¸²æ•°å­—ä¸ºç”µè¯" class="headerlink" title="ç¦æ­¢ iOS è¯†åˆ«é•¿ä¸²æ•°å­—ä¸ºç”µè¯"></a>ç¦æ­¢ iOS è¯†åˆ«é•¿ä¸²æ•°å­—ä¸ºç”µè¯</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;meta name="format-detection" content="telephone=no" /&gt;</span><br></pre></td></tr></table></figure><h3 id="ä¸€äº›æƒ…å†µä¸‹å¯¹éå¯ç‚¹å‡»å…ƒç´ å¦‚-label-span-ç›‘å¬clickäº‹ä»¶ï¼Œiosä¸‹ä¸ä¼šè§¦å‘"><a href="#ä¸€äº›æƒ…å†µä¸‹å¯¹éå¯ç‚¹å‡»å…ƒç´ å¦‚-label-span-ç›‘å¬clickäº‹ä»¶ï¼Œiosä¸‹ä¸ä¼šè§¦å‘" class="headerlink" title="ä¸€äº›æƒ…å†µä¸‹å¯¹éå¯ç‚¹å‡»å…ƒç´ å¦‚(label,span)ç›‘å¬clickäº‹ä»¶ï¼Œiosä¸‹ä¸ä¼šè§¦å‘"></a>ä¸€äº›æƒ…å†µä¸‹å¯¹éå¯ç‚¹å‡»å…ƒç´ å¦‚(label,span)ç›‘å¬clickäº‹ä»¶ï¼Œiosä¸‹ä¸ä¼šè§¦å‘</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">cursor</span>: <span class="selector-tag">pointer</span>;</span><br></pre></td></tr></table></figure><h3 id="ç¦æ­¢ioså’Œandroidç”¨æˆ·é€‰ä¸­æ–‡å­—"><a href="#ç¦æ­¢ioså’Œandroidç”¨æˆ·é€‰ä¸­æ–‡å­—" class="headerlink" title="ç¦æ­¢ioså’Œandroidç”¨æˆ·é€‰ä¸­æ–‡å­—"></a>ç¦æ­¢ioså’Œandroidç”¨æˆ·é€‰ä¸­æ–‡å­—</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-webkit-user-select</span>: <span class="selector-tag">none</span>;</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨ç°è‰²æ»¤é•œåšç°è‰²å›¾"><a href="#åˆ©ç”¨ç°è‰²æ»¤é•œåšç°è‰²å›¾" class="headerlink" title="åˆ©ç”¨ç°è‰²æ»¤é•œåšç°è‰²å›¾"></a>åˆ©ç”¨ç°è‰²æ»¤é•œåšç°è‰²å›¾</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-webkit-filter</span>: <span class="selector-tag">grayscale</span>(1);</span><br></pre></td></tr></table></figure><h3 id="é¡µé¢è‡ªé€‚åº”æœ€ä½³å®è·µ"><a href="#é¡µé¢è‡ªé€‚åº”æœ€ä½³å®è·µ" class="headerlink" title="é¡µé¢è‡ªé€‚åº”æœ€ä½³å®è·µ"></a>é¡µé¢è‡ªé€‚åº”æœ€ä½³å®è·µ</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width:</span> <span class="number">375px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/* iPhone6çš„375pxå°ºå¯¸ä½œä¸º16pxåŸºå‡†ï¼Œ414pxæ­£å¥½18pxå¤§å°, 600 20px */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">100%</span> + <span class="number">2</span> * (<span class="number">100vw</span> - <span class="number">375px</span>) / <span class="number">39</span>);</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">16px</span> + <span class="number">2</span> * (<span class="number">100vw</span> - <span class="number">375px</span>) / <span class="number">39</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width:</span> <span class="number">414px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/* 414px-1000pxæ¯100åƒç´ å®½å­—ä½“å¢åŠ 1px(18px-22px) */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">112.5%</span> + <span class="number">4</span> * (<span class="number">100vw</span> - <span class="number">414px</span>) / <span class="number">586</span>);</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">18px</span> + <span class="number">4</span> * (<span class="number">100vw</span> - <span class="number">414px</span>) / <span class="number">586</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width:</span> <span class="number">600px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/* 600px-1000pxæ¯100åƒç´ å®½å­—ä½“å¢åŠ 1px(20px-24px) */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">125%</span> + <span class="number">4</span> * (<span class="number">100vw</span> - <span class="number">600px</span>) / <span class="number">400</span>);</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">20px</span> + <span class="number">4</span> * (<span class="number">100vw</span> - <span class="number">600px</span>) / <span class="number">400</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width:</span> <span class="number">1000px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/* 1000pxå¾€åæ˜¯æ¯100åƒç´ 0.5pxå¢åŠ  */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">137.5%</span> + <span class="number">6</span> * (<span class="number">100vw</span> - <span class="number">1000px</span>) / <span class="number">1000</span>);</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">22px</span> + <span class="number">6</span> * (<span class="number">100vw</span> - <span class="number">1000px</span>) / <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
          <category> Css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
